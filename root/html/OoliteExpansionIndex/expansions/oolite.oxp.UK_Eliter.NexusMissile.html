<html>
    <head>
        <title>Expansion Nexus Missile</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Nexus Missile</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">5 Equipment</a></li>
          <li><a href="#ships">10 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">5 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN CAPITAL LETTER W)(&#39;[]&#39; vs &#39;[Weapons]&#39;)</li>
                <li>Conflict Expansions mismatch between OXP Manifest and Expansion Manager at character position 0047 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
                <li>Unknown key &#39;upload_date&#39; at https://wiki.alioth.net/img_auth.php/d/da/Oolite.oxp.UK_Eliter.NexusMissile.oxz!manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Provides various multi-warhead, semi-automatically-targetting, missiles. Available for purchase in various locations.</td>
                    <td>Provides various multi-warhead, semi-automatically-targetting, missiles. Available for purchase in various locations.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.UK_Eliter.NexusMissile</td>
                    <td>oolite.oxp.UK_Eliter.NexusMissile</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Nexus Missile</td>
                    <td>Nexus Missile</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Weapons</td>
                    <td>Weapons</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>UK_Eliter</td>
                    <td>UK_Eliter</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.79</td>
                    <td>2.79</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>Weapons</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                            <li>Nexus missile:0</li>
                    </td>
                    <td>
                            <li>Nexus missile:</li>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://www.aegidian.org/bb/viewtopic.php?f=4&amp;t=14420">http://www.aegidian.org/bb/viewtopic.php?f=4&amp;t=14420</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/d/da/Oolite.oxp.UK_Eliter.NexusMissile.oxz">https://wiki.alioth.net/img_auth.php/d/da/Oolite.oxp.UK_Eliter.NexusMissile.oxz</a></td>
                    <td><a target="_blank" href="http://wiki.alioth.net/img_auth.php/d/da/Oolite.oxp.UK_Eliter.NexusMissile.oxz">http://wiki.alioth.net/img_auth.php/d/da/Oolite.oxp.UK_Eliter.NexusMissile.oxz</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 4.0 license</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 4.0 license</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1646067340</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Nexus%20Missile'>http://wiki.alioth.net/index.php/Nexus%20Missile</a></p>
        <h3>Readme &amp; License.txt</h3>
        <pre>==========================================
&quot;Nexus missile&quot; OXP by (the unimaginatively named) &#39;UK_Eliter&#39;
==========================================

--------------------------
GENERAL NOTES
--------------------------

This OXP provides various multi-warhead, semi-automatically-targetting, missiles.

--------------------------
LICENSE
--------------------------

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license.

This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike License. 
To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/2.0/ 
or send a letter to Creative Commons, 559 Nathan Abbott Way, Stanford, California 94305, USA. 

You are free: 

� to copy, distribute, display, and perform the work 
� to make derivative works 

Under the following conditions.

� Attribution. You must give the original author credit. 
� Non-commercial. You may not use this work for commercial purposes. 
� Share Alike. If you alter, transform, or build upon this work, you may distribute the resulting work only under a license materially identical to this one. 

For any reuse or distribution, you must make clear to others the license terms of this work. 
Any of these conditions can be waived if you get permission from the copyright holder. 
Your fair use and other rights are in no way affected by the above.


ACKNOWLEDGEMENTS

The following provided advice and/or materials for this OXP.

- Eric Walch;
- Thargoid;
- Ramirez;
- Rustem.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_NEXUS_BASIC_MISSILE.html">Nexus Missile</a></td>
                    <td>yes</td>
                    <td align="right">10950</td>
                    <td align="center">8+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_NEXUS_BUG_MISSILE.html">Nexus Bug-Off Missile</a></td>
                    <td>yes</td>
                    <td align="right">82500</td>
                    <td align="center">13+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_NEXUS_BUG_R_MISSILE.html">Nexus Bug-Off Missile (naval reject)</a></td>
                    <td>yes</td>
                    <td align="right">40000</td>
                    <td align="center">3+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_NEXUS_PREMIUM_MISSILE.html">Nexus Missile (premium version)</a></td>
                    <td>yes</td>
                    <td align="right">19000</td>
                    <td align="center">9+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_NEXUS_ULTIMATE_MISSILE.html">Nexus Missile (ultimate version)</a></td>
                    <td>yes</td>
                    <td align="right">56000</td>
                    <td align="center">12+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/nexus Bug-Off Missile (naval reject).html">nexus Bug-Off Missile (naval reject)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/nexus-basic-missile.html">Nexus missile (basic version)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/nexus-bugOff-missile.html">Nexus bug-off missile</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/nexus-bugOff-warheadPRIMARY.html">Nexus warhead (bug-off version)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/nexus-bugOff-warheadSECONDARY.html">nexus-bugOff-warheadSECONDARY</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/nexus-premium-missile.html">Nexus missile (premium version)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/nexus-premium-warhead.html">Nexus warhead (premium version)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/nexus-ultimate-missile.html">Nexus missile (ultimate version)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/nexus-ultimate-warhead.html">Nexus warhead (ultimate version)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/nexus_warhead.html">Nexus warhead</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/nexus_conditions.js</td>
                    <td><pre>/* nexus_conditions.js */

/*
------------------------
JSHINT: Options
------------------------
*/

/*jshint esversion: 6*/
/*jshint sub:true*/


this.name = &quot;nexus_conditionsScript&quot;;
this.author = &quot;UK_Eliter&quot;;
this.description = &quot;Conditions script for Nexus missile&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;


/*
--------------
DEBUG SWITCHES
--------------
*/

//this.logging = true; // THIS SHOULD BE COMMENTED OUT WHEN NOT TESTING
//this.debug = false;



/*
------------------------
JSHINT: start of wrapper
------------------------
*/

(function() {
	&quot;use strict&quot;;


	/*
	---------
	MAIN CODE
	---------
	*/

	this.allowAwardEquipment = function(eqKey, ship, context) {
		var chance = 0;
		//
		switch (eqKey) {
			case &quot;EQ_NEXUS_BASIC_MISSILE&quot;:
				chance = 0.9;
				break;
			case &quot;EQ_NEXUS_PREMIUM_MISSILE&quot;:
				chance = 0.8;
				break;
			case &quot;EQ_NEXUS_ULTIMATE_MISSILE&quot;:
				chance = 0.6;
				break;
			case &quot;EQ_NEXUS_BUG_MISSILE&quot;:
				if (player.ship.dockedStation === &quot;Navy SecCom Station&quot;) {
					chance = 0.9;
				} else {
					chance = 0.4;
				}
				break;
			case &quot;EQ_NEXUS_BUG_R_MISSILE&quot;:
				if (player.ship.dockedStation === &quot;Navy SecCom Station&quot;) {
					chance = 0.5;
				} else {
					chance = 0.8;
				}
		}
		if (chance === 0) {
			return false;
		}
		if (Math.random() &lt; 0.9) {
			if (system.scrambledPseudoRandomNumber(5922) &lt; chance) {
				return true;
			}
		} else if (Math.random() &lt; chance) {
			return true;
		}
		return false;
	};


	/*
	----------------------
	JSHINT: end of wrapper
	----------------------
	*/

}).call(this);

// EOF</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/nexus_missile_basicOrPremiumOrUltimate.js</td>
                    <td><pre>/* nexus_missile_basicOrPremiumOrUltimate.js */

/*
------------------------
JSHINT: Options
------------------------
*/

/*jshint esversion: 6*/
/*jshint sub:true*/


this.name = &quot;nexus_missile_basicOrPremiumOrUltimate&quot;;
this.author = &quot;UK_Eliter&quot;;
this.description = &quot;&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;


/*
------------------
DEBUGGING SWTICHES
------------------
*/

//this.logging = true; // THIS SHOULD BE COMMENTED OUT WHEN NOT TESTING


/*
-------
GLOBALS
-------
*/

this.debug = false;

this.typeOfNexusMissile = &quot;undetermined&quot;;


/*
------------------------
JSHINT: start of wrapper
------------------------
*/

(function() {
	&quot;use strict&quot;;


	/*
	====================
	MAIN CODE
	====================
	*/

	this.shipSpawned = function() {
		this.MissileEnergyThreshhold = this.ship.maxEnergy * 0.8;
		if (this.ship.hasRole(&quot;EQ_NEXUS_BASIC_MISSILE&quot;)) {
			this.typeOfNexusMissile = &quot;basic&quot;;
		} else if (this.ship.hasRole(&quot;EQ_NEXUS_PREMIUM_MISSILE&quot;)) {
			this.typeOfNexusMissile = &quot;premium&quot;;
		} else {
			this.typeOfNexusMissile = &quot;ultimate&quot;;
		}
		delete this.shipSpawned;
	};

	this.shipTakingDamage = function(amount, whom, type) {
		if (this.ship.target) {
			if (whom == this.ship.target) {
				if (type === &quot;scrape damage&quot;) {
					this.$detonate();
					return;
				}
			}
		}
		if (amount &gt; 60 &amp;&amp; Math.random() &lt; 0.9) {
			return;
		}
		if (this.ship.energy &gt; this.MissileEnergyThreshhold || Math.random() &gt; 0.8) {
			return;
		}
		this.$spawnWarheads();
	};

	this.$isHostile = function(e) {
		// if (this.debug) {player.consoleMessage(&quot;Hostile scan from MISSILE script&quot;, 6);}
		return e.isShip &amp;&amp; e.hasHostileTarget &amp;&amp; (e.target == this.ship.owner);
	};


	this.$spawnWarheads = function() {
		// SPAWN THE WARHEADS &amp; do related stuff *

		// Note: original missile will be removed by its AI
		if (!this.ship || !this.ship.owner || !this.ship.owner.isValid) {
			return;
		}	

		var numWarheads;
		var submunition;
		switch (this.typeOfNexusMissile) {
			case &quot;basic&quot;:
				numWarheads = 3;
				submunition = &quot;nexus_warhead&quot;;
				break;
			case &quot;premium&quot;:
				numWarheads = 3;
				submunition = &quot;nexus-premium-warhead&quot;;
				break;
			case &quot;ultimate&quot;:
				numWarheads = 4;
				submunition = &quot;nexus-ultimate-warhead&quot;;
		}

		// Actual spawn
		var warheads = this.ship.spawn(submunition, numWarheads); // this will set warheads targets to the missile&#39;s target
		var counter;
		// set the owner of the warhead to the original missile&#39;s owner. Can&#39;t set &#39;.owner&#39; because read-only.
		for (counter = 0; counter &lt; numWarheads; counter++) {
			warheads[counter].ultimateOwner = this.ship.owner;
		}

		// ALLOCATE TARGETS etc TO THE WARHEADS *
		var targets = system.filteredEntities(this, this.$isHostile, this.ship.owner, this.ship.owner.scannerRange);
		var numTargets = targets.length;
		// NN: NOT &#39;if (numTargets &lt; 2)&#39; - i.e. abort if no target or one target - because could be one hostile AND missile&#39;s original target. We will investigate that below.
		if (numTargets &lt; 1) {
			// if (this.debug) {player.consoleMessage(&quot;Missile script - No hostiles&quot;, 8);}
			this.ship.explode(); // Do need this here!
			return; // need do nothing else, because all the warheads will be set to what is, presently, their only possible target, = the original one. (If that target&#39;s been lost, the warhead AI will deal with that.)
		}
		// Create an array of possible targets, and a corresponding array that will record whether a potential target has yet been targeted
		var isTargetTargetted = new Array(numTargets);
		for (counter = 0; counter &lt; numTargets; counter++) {
			isTargetTargetted[counter] = false;
		}
		var startWarheadCounterAt;
		if (this.ship.target &amp;&amp; this.ship.target.isValid) {
			// if (this.debug) {player.consoleMessage(&quot;Warhead 0 target is&quot;+warheads[0].target, 8);player.consoleMessage(&quot;Num targets is &quot;+numTargets, 8);}
			// Now see if the target warheads inherited from the missile is *amongst the array of possible targets.* If it is (may not be, &#39;cos initial target may not be hostile) mark the ship as targetted. 
			for (counter = 0; counter &lt; numTargets; counter++) {
				if (targets[counter] == warheads[0].target) {
					isTargetTargetted[counter] = true;
					break;
				}
			}
			startWarheadCounterAt = 1; // determine which warhead the targetting procedure should start with
		} else {
			startWarheadCounterAt = 0;
		}
		// Use the array of potential targets (hostiles) to assign targets to rest of the warheads (that &#39;rest&#39; being either (1) all of them or (2) all but the first one)
		// if (this.debug) {player.consoleMessage(&quot;Script targetting starts with (could be 0): &quot;+startWarheadCounterAt, 6);}
		var warheadCounter;
		for (warheadCounter = startWarheadCounterAt; warheadCounter &lt; numWarheads; warheadCounter++) {
			for (counter = 0; counter &lt; numTargets; counter++) {
				if (!isTargetTargetted[counter]) {
					warheads[warheadCounter].target = targets[counter];
					isTargetTargetted[counter] = true;
					// if (this.debug) {player.consoleMessage(&quot;Warhead &quot;+ warheadCounter +&quot; target: &quot;+ targets[counter], 6);}
					break; // have given the warhead a target, so should stop trying to do that!
				}
			}
		}
		this.ship.explode();
	};

	this.$detonate = function() {
		// function dealEnergyDamage(damage : Number, idealRange : Number [, velocityBias : Number])
		// The standard Oolite missile uses dealEnergyDamage(170, 32.5, 0.25), has a maximum speed of 0.75LM, and its AI tries to detonate it 25m from its target. [NB: If target within ideal range, takes full damage.]
		switch (this.typeOfNexusMissile) {
			case &quot;basic&quot;:
				this.ship.dealEnergyDamage(330, 50, 0.25);
				break;
			case &quot;premium&quot;:
				this.ship.dealEnergyDamage(470, 70, 0.25);
				break;
			case &quot;ultimate&quot;:
				this.ship.dealEnergyDamage(600, 90, 0.25);
		}
		this.ship.explode();
	};


	/*
	=======================
	JSHINT: end of wrapper
	=======================
	*/

}).call(this);

// EOF</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/nexus_missile_bugOff.js</td>
                    <td><pre>/* nexus_missile_bugOff.js */

/*
------------------------
JSHINT: Options
------------------------
*/

/*jshint esversion: 6*/
/*jshint sub:true*/


this.name = &quot;nexus_missile_bugOff&quot;;
this.author = &quot;UK_Eliter&quot;;
this.description = &quot;Script for Nexus BugOff missile&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;


/*
--------------
DEBUG SWTICHES
--------------
*/

// this.logging = true; // THIS SHOULD BE COMMENTED OUT WHEN NOT TESTING
// this.debug = false;


/*
------------------------
JSHINT: start of wrapper
------------------------
*/

(function() {
	&quot;use strict&quot;;


	/*
	---------
	MAIN CODE
	---------
	*/

	this.shipSpawned = function() {
		this.MissileEnergyThreshhold = this.ship.maxEnergy * 0.7;
		delete this.shipSpawned;
	};

	this.shipTakingDamage = function(amount) {
		if (amount &gt; 65 || this.ship.energy &gt; this.MissileEnergyThreshhold) {
			return;
		}
		if (Math.random() &lt; 0.9) {
			this.$spawnWarheads();
		}
	};

	this.$spawnWarheads = function() {
		var chanceMalfunction;
		if (this.ship.hasRole(&quot;EQ_NEXUS_BUG_R_MISSILE&quot;)) {
			chanceMalfunction = 0.1;
		} else {
			chanceMalfunction = 0.025;
		}
		var totalNumberOfWarheadsToBeSpawned;
		if (Math.random() &lt; chanceMalfunction) {
			// Malfunctioning missile
			totalNumberOfWarheadsToBeSpawned = ~~(Math.random() * 5); // = Between - and 4.
			if (totalNumberOfWarheadsToBeSpawned &lt; 3) {
				if (Math.random() &lt; 0.7) {
					totalNumberOfWarheadsToBeSpawned++;
				} else if (totalNumberOfWarheadsToBeSpawned === 0) {
					if (Math.random() &lt; 0.3) {
						this.ship.explode();
					} else {
						this.ship.switchAI(&quot;nullAI.plist&quot;);
					}
					return;
				}
			}
		} else {
			totalNumberOfWarheadsToBeSpawned = 5;
		}

		var primaryWarhead = this.ship.spawnOne(&quot;nexus-bug-warhead-primary&quot;);
		// PRIMARY warhead. Its target will be the missile&#39;s target

		if (totalNumberOfWarheadsToBeSpawned &gt; 1) {
			var secondaryWarheads;
			if (!primaryWarhead || !primaryWarhead.isValid) {
				secondaryWarheads = this.ship.spawn(&quot;nexus-bug-warhead-secondary&quot;, totalNumberOfWarheadsToBeSpawned);
				// this will set warheads targets to the missile&#39;s target
			} else {
				secondaryWarheads = this.ship.spawn(&quot;nexus-bug-warhead-secondary&quot;, (totalNumberOfWarheadsToBeSpawned - 1));
				// this will set warheads targets to the missile&#39;s target
			}
		}
		// this.ship.switchAI(&quot;nullAI.plist&quot;);
		this.ship.explode();
	};

	this.$detonate = function() {
		// Called only by AI.
		this.ship.dealEnergyDamage(650, 50, 0.25);
		this.ship.explode();
	};


	/*
	----------------------
	JSHINT: end of wrapper
	----------------------
	*/

}).call(this);


// EOF</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/nexus_warhead_basicOrPremiumOrUltimate.js</td>
                    <td><pre>/* nexus_warhead_basicOrPremiumOrUltimate.js */

/*
------------------------
JSHINT: Options
------------------------
*/

/*jshint esversion: 6*/
/*jshint sub:true*/


this.name = &quot;nexus_warhead_basicPremiumOrUltimate&quot;;
this.author = &quot;UK_Eliter&quot;;
this.description = &quot;Script for Nexus missile warheads&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;

// Associated AI: nexus_warheadAI.PLIST


/*
--------------
DEBUG SWTICHES
--------------
*/

//this.logging = true; // THIS SHOULD BE COMMENTED OUT WHEN NOT TESTING
//this.debug = false;


/*
-------
GLOBALS
-------
*/

this.typeOfWarhead = 0; // This gets set to something meaningful below.


/*
------------------------
JSLINT: start of wrapper
------------------------
*/

(function() {
	&quot;use strict&quot;;


	/*
	--------------
	EVENT HANDLERS
	--------------
	*/

	this.shipSpawned = function() {
		if (this.ship.primaryRole === &quot;nexus_warhead&quot;) {
			this.typeOfWarhead = 1; // 1 = basic
		} else if (this.ship.primaryRole === &quot;nexus-premium-warhead&quot;) {
			this.typeOfWarhead = 2; // 2 = premium;
		} else {
			this.typeOfWarhead = 3; // 3 = ultimate;
		}
		this.oldTarget = 0;
		delete this.shipSpawned;
	};

	this.shipTakingDamage = function(amount, whom, type) {
		//if (this.debug) {player.consoleMessage(&quot;Warhead AI - taking damage:&quot; + amount, 5);}
		if (amount &gt; 14) {
			return;
		}
		if (Math.random() &lt; 0.2) {
			this.ship.energy = this.ship.energy + amount; // Prevent it from being destroyed - but also so that we can *detonate* it.
			this.$detonate();
		}
	};


	/*
	---------------
	OTHER FUNCTIONS
	---------------
	*/

	this.$detonateOrSeek = function() {
		if (this.ship.target &amp;&amp; !this.ship.target.isValid) {
			this.$detonate();
			return;
		}
		this.ship.reactToAIMessage(&quot;SCRIPT_SEEK&quot;);
	};


	this.$scanForTargets = function() {
		//if (this.debug) {player.consoleMessage(&quot;Scanning for targets&quot;, 6);}
		function $isHostileToOwnerOrWarhead(e) {
			if (this.ship.ultimateOwner &amp;&amp; this.ship.ultimateOwner.isValid) {
				return e.isShip &amp;&amp; e.hasHostileTarget &amp;&amp; (e.target == this.ship.ultimateOwner || e.target == this.ship);
			} else {
				return e.isShip &amp;&amp; e.hasHostileTarget &amp;&amp; (e.target == this.ship);
			}
		}
		var targetsArray = system.filteredEntities(this, $isHostileToOwnerOrWarhead, this.ship, this.ship.scannerRange);
		if (targetsArray.length &gt; 0) {
			this.ship.target = targetsArray[0]; // go for nearest
			this.ship.reactToAIMessage(&quot;TARGET&quot;);
			this.ship.oldTarget = this.ship.target;
		} else if ((this.oldTarget !== 0) &amp;&amp; this.oldTarget.isValid) {
			//if (this.debug) {player.consoleMessage(&quot;Nexus warhead - located first found target&quot;, 4);}
			this.ship.target = this.oldTarget;
			this.ship.reactToAIMessage(&quot;TARGET&quot;);
			this.oldTarget = 0; // reset it
		} else {
			this.ship.reactToAIMessage(&quot;NO_TARGET&quot;);
		}
	};

	this.$detonate = function() {
		// function dealEnergyDamage(damage : Number, idealRange : Number [, velocityBias : Number])
		// The standard Oolite missile uses dealEnergyDamage(170, 32.5, 0.25), has a maximum speed of 0.75LM, and its AI tries to detonate it 25m from its target. [NB: If target within ideal range, takes full damage.]
		//
		// 1 = basic; 2 = premium; 3 = ultimate.
		switch (this.typeOfWarhead) {
			case 1:
				this.ship.dealEnergyDamage(110, 27, 0.25);
				break;
			case 2:
				this.ship.dealEnergyDamage(150, 31, 0.22);
				break;
			case 3:
				this.ship.dealEnergyDamage(195, 36, 0.15);
		}
		this.ship.explode();
	};


	/*
	----------------------
	JSHINT: end of wrapper
	----------------------
	*/

}).call(this);

// EOF</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/nexus_warhead_bugOff.js</td>
                    <td><pre>/* nexus_warhead_bugOff.js */

/*
------------------------
JSHINT: Options
------------------------
*/

/*jshint esversion: 6*/
/*jshint sub:true*/


this.name = &quot;nexus_warhead_bugOff&quot;;
this.author = &quot;UK_Eliter&quot;;
this.description = &quot;Script for Nexus BugOff warhead&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;

// Associated AI	nexus_warheadAI.PLIST


/*
--------------
DEBUG SWTICHES
---------------
*/
//this.logging = true; // THIS SHOULD BE COMMENTED OUT WHEN NOT TESTING
//this.debug = false;


/*
------------------------
JSHINT: start of wrapper
------------------------
*/

(function() {
	&quot;use strict&quot;;


	/*
	---------
	MAIN CODE
	---------
	*/

	this.$isBug = function(e) {
		return e.isShip &amp;&amp; e.isThargoid;
	};


	// Called only by AI.
	this.$detonate = function() {
		this.ship.dealEnergyDamage(140, 30, 0.14);
		// function dealEnergyDamage(damage : Number, idealRange : Number [, velocityBias : Number])
		// The standard Oolite missile uses dealEnergyDamage(170, 32.5, 0.25), has a maximum speed of 0.75LM, and its AI tries to detonate it 25m from its target. [NB: If target within ideal range, takes full damage.]

		// Deal additional damage to anything thargoid.
		var s = system.filteredEntities(this, this.$isBug, this.ship, 150);
		var i = s.length;
		while (i--) {
			s[i].energy -= 65;
		}

		// Remove the warhead.
		this.ship.explode();
	};


	/*
	----------------------
	JSHINT: end of wrapper
	----------------------
	*/

}).call(this);


// EOF</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
