<html>
    <head>
        <title>Expansion Free Trade Zones</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Free Trade Zones</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">22 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">3 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds Free Trade Zones to Multi-Government systems (TL7+).</td>
                    <td>Adds Free Trade Zones to Multi-Government systems (TL7+).</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Disembodied.FreeTradeZone</td>
                    <td>oolite.oxp.Disembodied.FreeTradeZone</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Free Trade Zones</td>
                    <td>Free Trade Zones</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Dockables</td>
                    <td>Dockables</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Disembodied, Griff, phkb</td>
                    <td>Disembodied, Griff, phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.31</td>
                    <td>0.31</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Free_Trade_Zone">http://wiki.alioth.net/index.php/Free_Trade_Zone</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/3/34/FTZ.oxz">https://wiki.alioth.net/img_auth.php/3/34/FTZ.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 3</td>
                    <td>CC BY-NC-SA 3</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1626941722</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Free%20Trade%20Zones'>http://wiki.alioth.net/index.php/Free%20Trade%20Zones</a></p>
        <h3>readme.txt</h3>
        <pre>Oolite OXP

FTZ v0.31

Partick Enterprises, 18 August 2007
Updated 8 October 2010
Updated 20 May 2016 (v0.21)

Overview
========
This is a small flavour OXP that adds a &quot;Free Trade Zone&quot; to Multi-Government systems. These are mined-out rock-hermits, dragged beyond the witchpoint beacon, where various morally dyslexic ship captains can trade outside the official, GalCop-protected, network. There are some bargains to be found -- as you might expect, given how most of the goods are acquired -- but quantities are often low and there are often unscrupulous individuals in the area. It&#39;s really a buyer&#39;s market, unless you find it awkward to go near main stations. Fuel and basic equipment are available, at a premium. Their out-of-the-way location can make FTZs hard to find, but they are marked as &quot;Z&quot; on the Advanced Space Compass.

Free Trade Zones exist because of the highly complex legal nature of Multi-Government planets, their collective paranoia over perceived sovereignty infringements by GalCop, and their general inability to make collective decisions. Although FTZs are recognised as nation states by the planetary authorities, GalCop currently regard those who visit these stations as (minor) Offenders, and will garnish your legal status accordingly. As part of the deal with GalCop, the FTZs are obliged to provide information on all who enter and leave. Despite persistent GalCop requests, however, they still refuse to give details of those ships&#39; cargo manifests, citing &quot;commercial confidentiality&quot;.

New rules from GalCop have meant that FTZ&#39;s can, as an alternative to marking docking ships as offenders, pay GalCop a premium of 1000cr for each ship that visits the station. As the governing bodies of the FTZ&#39;s are in no position to subsidise this expenditure, they have instead given the captains the option. When a ship docks, they will be asked what their preferred option is: accept the bounty increase, or pay the 1000cr. Regular visitors to FTZ&#39;s will find that the 1000cr amount will reduce over time as a &quot;frequent dockers&quot; system has recently been implemented.

Also, visitors to FTZ&#39;s will now need to request docking clearance, as a series of accidents in the docking tunnel have had a serious impact on prices.

License
=======
This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike License version 3.0. For more information see the Oolite ReadMe or the Creative Commons&#39; website.

Thanks to Disembodied for coming up with the original idea and OXP. Disembodied has very kindly allowed phkb to update and maintain it.

FTZ logo image from http://simpleicon.com/d_zone.html

Version History
===============
0.31
- Updates to shipdata to link into randomshipnames and Skilled NPC&#39;s (thanks to Rustum for the entries).
- Update the spawning mechanism to allow for games to be saved at FTZ&#39;s.

0.30
- Updated FTZ model to use the Griff shadered rock hermit.

0.22
- Frequent visitors to Free Trade Zones will now receive a discount on the fine amount.
- Increased destroyed station recreation wait period to 60 days.
- Added code to utilise Station Validator OXP, if installed.
- Tweaks to the market script to cater for non-core commodities.

0.21
* Converted model to be a variation of the new Rock Hermit.
* Added a customised docking tunnel texture for use by BGS.
* Turned on docking requests.
* Limited FTZ&#39;s to only appear in TL7 systems or higher.
* Converted plist-style script to Javascript.
* Updated the populator routine to use the new Oolite populator methods.
* Added routines to check if the FTZ was destroyed in a system, and only recreate the station after 30 days have passed.
* Updated the market script to use the new style.
* Added an option for commanders who dock at the station to either take the bounty increase, or pay a fine.

0.15:
* Changed &quot;legalStatus_number&quot; to &quot;commanderLegalStatus_number&quot; to conform with trunk changes. Docking with an FTZ once again *adds* 5 to your bounty, instead of *setting it* to 5 ...

0.14:
* Corrected error where FTZ escorts could get called up as ordinary escorts. Thanks to Eric Walch for the correction.

0.13:
* Pirates around the FTZ now carry some cargo.
* GalCop may, from time to time, put on a show of force in the vicinity of an FTZ -- cries of &quot;restrictive trade practices&quot; notwithstanding.

0.11:
* There is now an automatic 5-point fine to your legal record for visiting an FTZ (v0.1 just added 5 to your record if you were clean: now bad people get fined too). Thanks to Commander McLane on the Oolite BBS for the coding.

</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. 
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/free-trade-zone.html">Free Trade Zone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftz_dock.html">FTZ (docking slit)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzcargo1.html">ftzcargo1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzcargo2.html">ftzcargo2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzcargo3.html">ftzcargo3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzcargo4.html">ftzcargo4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzescort1.html">ftzescort1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzescort2.html">ftzescort2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzescort3.html">ftzescort3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate1.html">ftzpirate1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate10.html">ftzpirate10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate11.html">ftzpirate11</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate12.html">ftzpirate12</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate13.html">ftzpirate13</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate2.html">ftzpirate2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate3.html">ftzpirate3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate4.html">ftzpirate4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate5.html">ftzpirate5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate6.html">ftzpirate6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate7.html">ftzpirate7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate8.html">ftzpirate8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ftzpirate9.html">ftzpirate9</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;FTZ_Core&quot;;
this.author      = &quot;Disembodied and phkb&quot;;
this.copyright   = &quot;2016 Disembodied and phkb&quot;;
this.description = &quot;Populator and dock checking routines for FTZ&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;

/*
Other ideas:
- post some FTZ-keyed missions to the BB
	- transfer some docs/data files/docking list/etc to the main station	
		- have player hounded by police on way?
	- (at main station) offer player the chance to install some monitoring software at ftz to enable galcop to collect trading data
		- player could have chance to sell the software at the FTZ, rather than install it.
			- if they do, the failure of this mission will lead to bounty *and* assassins
			
Ideas for future releases (from Disembodied):
- visits from nice pirates
- trips between main station and ftz by &quot;clean&quot; ships
- unofficial &quot;aegis&quot; patrolled by specialised pirates
- if player is a known bounty hunter
	- forbid entry/have ships launch to ward off player
	- kill player on dock?
	- remove equipment on dock?
Political situation is tense so...
- have viper ships tag ships outside the station as offenders, rather than attack
- keep vipers from attacking anything but fugitives outside a FTZ, keep pirates from attacking patrolling police 
*/

this.local_freetradezone_marked = false;
this._doDockingPenalty = false;
this._penaltyAmount = 1000;
this._destroyed = [];
this._dockFrequency = 0;
this._daysUntilNewStation = 60;
this._trueValues = [&quot;yes&quot;, &quot;1&quot;, 1, &quot;true&quot;, true];

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function() {
	// load our mission variables
	if (missionVariables.FTZ_Marked) this.local_freetradezone_marked = (this._trueValues.indexOf(missionVariables.FTZ_Marked) &gt;= 0 ? true : false);
	if (missionVariables.FTZ_Destroyed) this._destroyed = JSON.parse(missionVariables.FTZ_Destroyed);
	if (missionVariables.FTZ_DockCount) this._dockFrequency = parseInt(missionVariables.FTZ_DockCount);
}

//-------------------------------------------------------------------------------------------------------------
this.playerWillSaveGame = function() {
	// save our mission variables
	missionVariables.FTZ_Marked = this.local_freetradezone_marked;
	missionVariables.FTZ_Destroyed = JSON.stringify(this._destroyed);
	missionVariables.FTZ_DockCount = this._dockFrequency;
}

//-------------------------------------------------------------------------------------------------------------
this.shipExitedWitchspace = function() {
	// reset our docking flag
	this.local_freetradezone_marked = false;
	this._doDockingPenalty = false;
}

//-------------------------------------------------------------------------------------------------------------
this.systemWillPopulate = function() {
	// will we be creating a FTZ in this system?
	// only in a normal system (not interstellar space), and only in multi-giv systems (gov = 2), and only when tl is &gt; = 6, and only if it hasn&#39;t been previously destroyed
	if (system.ID &gt;= 0 &amp;&amp; system.info.government == 2 &amp;&amp; system.info.techlevel &gt;= 6 &amp;&amp; this.$checkForDestroyedFTZ(system.ID) == false) {
		// create the FTZ
		var posFTZ = Vector3D(0, 0, -0.3).fromCoordinateSystem(&quot;wpu&quot;);
		system.setPopulator(&quot;ftz&quot;, {
			callback: function(pos) {
					if (system.countShipsWithRole(&quot;free_trade_zone&quot;) == 0) {
						var ftz = system.addShips(&quot;free_trade_zone&quot;, 1, pos, 1)[0];
						if (ftz.script.shipDied) ftz.script.$ftz_ovr_shipDied = ftz.script.shipDied;
						ftz.script.shipDied = worldScripts.FTZ_Core.$ftz_shipDied;
					}
				},
			location:&quot;COORDINATES&quot;,
			coordinates:posFTZ,
			deterministic:true
		});

		// add a lurking pirate 
		var posFTZPirates1 = Vector3D(0, 0, -0.25).fromCoordinateSystem(&quot;wpu&quot;);
		system.setPopulator(&quot;ftzpirates1&quot;, {
			callback: function(pos) {
					var ftzp1 = system.addShips(&quot;ftzpirate&quot;, 1, pos, 1);
				},
			location:&quot;COORDINATES&quot;,
			coordinates:posFTZPirates1
		});
		
		// 25% chance of adding some additional lurking pirates
		if (Math.random() &gt; 0.75) {
			var posPirates2 = Vector3D(0, 0, -0.25).fromCoordinateSystem(&quot;wpu&quot;);
			system.setPopulator(&quot;pirates1&quot;, {
				callback: function(pos) {
						var ftzp2 = system.addShips(&quot;ftzpirate&quot;, 2, pos, 1);
					},
				location:&quot;COORDINATES&quot;,
				coordinates:posPirates2
			});
		}

		// 70% of some more pirates a bit closer to the witchpoint
		if (Math.random() &gt; 0.3) {
			var posFTZPirates3 = Vector3D(0, 0, -0.2).fromCoordinateSystem(&quot;wpu&quot;);
			system.setPopulator(&quot;ftzpirates2&quot;, {
				callback: function(pos) {
						var ftzp3 = system.addShips(&quot;ftzpirate&quot;, 2, pos, 1);
					},
				location:&quot;COORDINATES&quot;,
				coordinates:posFTZPirates3
			});
		}

		// 70% chance of creating some more pirates halfway between witchpoint and the FTZ
		if (Math.random() &gt; 0.7) {
			var posFTZPirates4 = Vector3D(0, 0, -0.15).fromCoordinateSystem(&quot;wpu&quot;);
			system.setPopulator(&quot;ftzpirates3&quot;, {
				callback: function(pos) {
						var ftzp4 = system.addShips(&quot;ftzpirate&quot;, 4, pos, 1);
					},
				location:&quot;COORDINATES&quot;,
				coordinates:posFTZPirates4
			});
		}

		// 50% chance of creating a pirate trader
		if (Math.random() &gt; 0.5) {
			var posHauler1 = Vector3D(0, 0, -0.2).fromCoordinateSystem(&quot;wpu&quot;);
			system.setPopulator(&quot;ftzhauler1&quot;, {
				callback: function(pos) {
						var ftzh1 = system.addShips(&quot;ftzhauler&quot;, 1, pos, 5000);
					},
				location:&quot;COORDINATES&quot;,
				coordinates:posHauler1
			});
		}

		// 25% chance of creating another pirate trader
		if (Math.random() &gt; 0.75) {
			var posHauler2 = Vector3D(0, 0, -0.25).fromCoordinateSystem(&quot;wpu&quot;);
			system.setPopulator(&quot;ftzhauler2&quot;, {
				callback: function(pos) {
						var ftzh2 = system.addShips(&quot;ftzhauler&quot;, 1, pos, 5000);
					},
				location:&quot;COORDINATES&quot;,
				coordinates:posHauler2
			});
		}

		// 10% chance of adding some police around the FTZ
		if (Math.random() &gt; 0.9) {
			var posPolice = Vector3D(0, 0, -0.3).fromCoordinateSystem(&quot;wpu&quot;);
			system.setPopulator(&quot;ftzPolice&quot;, {
				callback: function(pos) {
						var ftzPol = system.addShips(&quot;police&quot;, 6, pos, 5000);
					},
				location:&quot;COORDINATES&quot;,
				coordinates:posPolice
			});
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
// Original concept
/*this.shipWillDockWithStation = function(station) {
	if (station.name == &quot;Free Trade Zone&quot; &amp;&amp; this.local_freetradezone_marked == false) {
		this.local_freetradezone_marked = true;
		player.ship.setBounty(player.bounty + 5, &quot;illegal activity&quot;);
		player.addMessageToArrivalReport(&quot;As per the stringent GalCop law, you have been given a small bounty for docking at this Free Trade Zone.&quot;);
	}
}*/

//-------------------------------------------------------------------------------------------------------------
this.shipWillDockWithStation = function(station) {
	this._doDockingPenalty = false;
	// if this station is a FTZ, and we haven&#39;t docked at it since arriving insystem....
	if (station.name === &quot;Free Trade Zone&quot; &amp;&amp; this.local_freetradezone_marked === false) {
		this.local_freetradezone_marked = true;
		// check if the player has enough cash to cover the cash penalty
		var finalamt = (this._dockFrequency &gt; 0 ? parseInt(Math.pow((this._penaltyAmount * 0.75) / 1000, this._dockFrequency) * 100) * 10 : this._penaltyAmount);
		if (finalamt &lt; 100) finalamt = 100;
		
		if (player.credits &gt; finalamt) {
			// if so, we can run the mission screen where we ask the player which one they want
			this._doDockingPenalty = true;
		} else {
			// if we don&#39;t have enough cash, just add the bounty
			player.ship.setBounty(player.bounty + 5, &quot;illegal activity&quot;);
			player.addMessageToArrivalReport(&quot;As per the stringent GalCop law, you have been given a small bounty for docking at this Free Trade Zone.&quot;);
			this._dockFrequency += 1;
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
// displays the mission screen where the player can select their penalty
this.missionScreenOpportunity = function() {
	if (this._doDockingPenalty == true) {
		this._doDockingPenalty = false;
		// ask player what they want to do
		var finalamt = (this._dockFrequency &gt; 0 ? parseInt(Math.pow((this._penaltyAmount * 0.75) / 1000, this._dockFrequency) * 100) * 10 : this._penaltyAmount);
		if (finalamt &lt; 100) finalamt = 100;
		var curChoices = {};
		var text = &quot;&quot;;
		var def = &quot;&quot;;
		text += &quot;Welcome to the &quot; + expandDescription(&quot;%I&quot;) + &quot; Free Trade Zone. We hope you enjoy your visit.\n\n&quot; + 
			&quot;By GalCop law, and to prevent GalCop reprisals, we are required to penalise you on arrival at the station. &quot; + 
			&quot;The penalty can come in one of two ways. You can select to either have a small bounty amount added to your legal status, &quot; + 
			&quot;or to pay a fine of &quot; + formatCredits(finalamt, false, true) + &quot;. You may choose which penalty to accept.&quot;;
		
		curChoices[&quot;01_BOUNTY&quot;] = {text:&quot;Accept bounty&quot;, color:this._menuColor};
		curChoices[&quot;02_FINE&quot;] = {text:&quot;Accept fine&quot;, color:this._menuColor};

		def = &quot;01_BOUNTY&quot;;

		var opts = {
			screenID: &quot;oolite-ftz-penalty-map&quot;,
			title: &quot;Free Trade Zone&quot;,
			overlay: {name:&quot;ftz_logo.png&quot;, height:546},
			allowInterrupt: false,
			exitScreen: &quot;GUI_SCREEN_STATUS&quot;,
			choices: curChoices,
			initialChoicesKey: def,
			message: text
		};

		mission.runScreen(opts, this.$screenHandler, this);

		opts = null;
		curChoices = null;
	}
}

//-------------------------------------------------------------------------------------------------------------
// processes the option selected by the player
this.$screenHandler = function(choice) {
	if (choice == null) return;
	
	this.local_freetradezone_marked = true;
	switch (choice) {
		case &quot;01_BOUNTY&quot;:
			player.ship.setBounty(player.bounty + 5, &quot;illegal activity&quot;);
			player.consoleMessage(&quot;Your bounty has been increased.&quot;);
			break;
		case &quot;02_FINE&quot;:
			var finalamt = (this._dockFrequency &gt; 0 ? parseInt(Math.pow((this._penaltyAmount * 0.75) / 1000, this._dockFrequency) * 100) * 10 : this._penaltyAmount);
			if (finalamt &lt; 100) finalamt = 100;
			player.credits -= finalamt;
			player.consoleMessage(formatCredits(finalamt, false, true) + &quot; has been deducted from your account.&quot;);
			break;
	}
	this._dockFrequency += 1;
}

//-------------------------------------------------------------------------------------------------------------
// returns true if the FTZ has been destroyed in the selected system, otherwise false
this.$checkForDestroyedFTZ = function(sysID) {
	if (worldScripts.station_validator)  {
		if (worldScripts.station_validator.$deaths(&quot;free_trade_zone&quot;, this._daysUntilNewStation).length === 0) {
			return false;
		} else {
			return true;
		}
	}
	if (this._destroyed &amp;&amp; this._destroyed.length &gt; 0) {
		for (var i = 0; i &lt; this._destroyed.length; i++) {
			// check if the elapsed time since being destroyed is less than 60 days - if so, we return true
			if (this._destroyed[i].system == sysID &amp;&amp; (clock.adjustedSeconds - this._destroyed[i].destroyedDate) &lt; (86400 * this._daysUntilNewStation)) return true;
		}
	}
	return false;
}

//-------------------------------------------------------------------------------------------------------------
// removes any historic records from the destroyed array for the selected system
this.$clearDestroyedInfo = function(sysID) {
	if (this._destroyed &amp;&amp; this._destroyed.length &gt; 0) {
		for (var i = this._destroyed.length - 1; i &gt;= 0; i--) {
			if (this._destroyed[i].system == sysID) this._destroyed.splice(i, 1);
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
// script attached to shipDied event of the FTZ
this.$ftz_shipDied = function(whom, why) {
	if (this.ship.script.$ftz_ovr_shipDied) this.ship.script.$ftz_ovr_shipDied(whom, why);
	// clear out any historic data for this system
	worldScripts.FTZ_Core.$clearDestroyedInfo(system.ID);
	// add this system to the data array
	worldScripts.FTZ_Core._destroyed.push({system:system.ID, destroyedDate:clock.adjustedSeconds});
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/ftz_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;FTZ_Conditions&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2016 phkb&quot;;
this.description = &quot;Condition script for populating FTZ&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;

this.allowSpawnShip = function(shipKey) {
	if (system.info.government != 2) {
		return false;
	} else {
		return true;
	}
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/ftz_market.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;ftz_market&quot;;
this.author = &quot;spara&quot;;
this.copyright = &quot;2014 spara&quot;;
this.license     = &quot;CC BY-NC-SA 4.0&quot;;

this.$originalDefs = {
      &quot;food&quot; : [0, 0, 21, 1, 2, 0, 1, 1, 0],
      &quot;textiles&quot; : [0, 0, 16, 1, 3, -5, 3, 7, 0],
      &quot;radioactives&quot; : [0, 0, 52, 1, 3, -5, 3, 7, 0],
      &quot;slaves&quot; : [0, 0, 20, 0, 0, 10, 15, 0, 0],
      &quot;liquor_wines&quot; : [0, 0, 75, 1, 2, 4, 1, 1, 0],
      &quot;luxuries&quot; : [0, 0, 170, -3, -1, -5, 31, 3, 0],
      &quot;narcotics&quot; : [0, 0, 235, 29, 0, 0, 120, 0, 0],
      &quot;computers&quot; : [0, 0, 140, -7, -1, -3, 15, 7, 0],
      &quot;machinery&quot; : [0, 0, 105, -4, -1, 0, 7, 7, 0],
      &quot;alloys&quot; : [0, 0, 75, -1, -1, 10, 3, 31, 0],
      &quot;firearms&quot; : [0, 0, 124, -7, -1, -2, 15, 3, 0],
      &quot;furs&quot; : [0, 0, 135, 3, 2, 3, 7, 1, 0],
      &quot;minerals&quot; : [0, 0, 18, 3, 3, 9, 3, 7, 0],
      &quot;gold&quot; : [0, 0, 102, 1, 0, 0, 20, 0, 1],
      &quot;platinum&quot; : [0, 0, 181, 2, 0, 0, 21, 0, 1],
      &quot;gem_stones&quot; : [0, 0, 50, 1, 0, 0, 15, 0, 2],
      &quot;alien_items&quot; : [0, 0, 10, 1, 0, 0, 7, 0, 0]
};

this.updateLocalCommodityDefinition = function(goodDefinition) {
	var commodity = goodDefinition.key;
	var oldDefs = this.$originalDefs[commodity];
	//old style definition found for the good. calculate it the old way
	if (oldDefs) {
		var market_base_price = oldDefs[2];
		var market_eco_adjust_price = oldDefs[3];
		var market_eco_adjust_quantity = oldDefs[4];
		var market_base_quantity = oldDefs[5];
		var market_mask_price = oldDefs[6];
		var market_mask_quantity = oldDefs[7];
		var market_rnd = Math.floor(Math.random() * 256);

		var economy = system.economy;

		var price = (market_base_price + (market_rnd &amp; market_mask_price) + (economy * market_eco_adjust_price)) &amp; 255;
		price *= 0.4;

		var quantity = (market_base_quantity + (market_rnd &amp; market_mask_quantity) - (economy * market_eco_adjust_quantity)) &amp; 255;
		if (quantity &gt; 127) quantity = 0;
		quantity &amp;= 63;

		goodDefinition.price = price * 10;
		goodDefinition.quantity = quantity;
	} else {
		// hit or miss variation
		var price = goodDefinition.price * (1 + (system.scrambledPseudoRandomNumber(clock.days) * 0.6 - 0.3));
		// make sure there aren&#39;t lots of units to buy if the price is cheaper
		if (price &lt; goodDefinition.price &amp;&amp; goodDefinition.quantity &gt; 0) {
			goodDefinition.quantity = parseInt(goodDefinition.quantity * 0.5);
		}
	}
	return goodDefinition;
};
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
