<html>
    <head>
        <title>Expansion Commanders Log</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Commanders Log</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER E)(&#39;[]&#39; vs &#39;[equipment]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds a log of the last 100 major events in the current Commander&#39;s life, which can be dumped out to latest.log. The latest 10 are viewable in-game when docked.</td>
                    <td>Adds a log of the last 100 major events in the current Commander&#39;s life, which can be dumped out to latest.log. The latest 10 are viewable in-game when docked.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.CommandersLog</td>
                    <td>oolite.oxp.Thargoid.CommandersLog</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Commanders Log</td>
                    <td>Commanders Log</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.01</td>
                    <td>1.01</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>equipment</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Commanders_Log_OXP">http://wiki.alioth.net/index.php/Commanders_Log_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/3/32/Commanders_Log_1.00.oxz">https://wiki.alioth.net/img_auth.php/3/32/Commanders_Log_1.00.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873262</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Commanders%20Log'>http://wiki.alioth.net/index.php/Commanders%20Log</a></p>
        <h3>Commanders Log v1.01 ReadMe &amp; License.txt</h3>
        <pre>Commanders Log OXP by Thargoid.

A little OXP by forum request of &quot;Sendraks&quot; and others to keep a log of the last 100 occasions where the Commander performed a landmark action or achievement. The most recent 15 can be viewed in-game, with the full list available via the latest.log dump.

The logged actions and achievements currently include:

* Purchase of a new ship.
* Galactic jump into a new galaxy.
* A witchspace mis-jump.
* Purchase of a maintenance overhaul (including location and cost).
* Attaining a new rank.

The recent list is accessible via the F4 screen when docked (just select Commander&#39;s Log), and from there can either be reset or the full log dumped out to the latest.log file for further manipulation or storage.

This OXP is based on (and is a variant of) my existing Flight Log OXP. Both will work quite happily together, but are independent of each other.

Requires v1.79 or later of Oolite. It will not run on older versions.

--------------------------------------------------------------

License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement. Basically if it&#39;s unique or would identify or overwrite anything in the original OXP, then you may not re-use it (for obvious compatibility reasons).
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* The license information (either as this file or merged into a larger one) must be included in the OXP.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)

--------------------------------------------------------------

Instructions:

For those who have downloaded the OXP version, unzip the file, and then move the folder &quot;Commanders Log 1.01.oxp&quot; to the AddOns directory of your Oolite installation. Then start the game up and the ships should be added. 

The OXZ version downloaded via the Expansion manager should be installed and operational directly. For a manual download, move the .oxz folder to the addons directory and restart the game.

--------------------------------------------------------------

Version history:

10/02/2014 - Version 1.00, initial release.
07/08/2014 - Version 1.01, adjusted the script to run on startUpComplete rather than startUp, to allow for saves at non-main stations.

--------------------------------------------------------------

Acknowledgements:

With thanks to Sendraks for the original inspiration, and to Diogenese Senna, Cody and Diziet Sma for idea inputs.

Also thanks to Neelix for the heads-up about the save at non-main station glitch and fix suggestion.</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>this.name					= &quot;commandersLog&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Saves a list of significant events to the Commander&quot;;
this.version				= &quot;1.01&quot;;

this.startUpComplete = function()
	{
	if(!missionVariables.commandersLogText) // if this is the first run of the OXP
		{ missionVariables.commandersLogText = &quot;Log system first initialised&quot;; }
	
	if(!missionVariables.commandersLogDate) // if this is the first run of the OXP
		{ missionVariables.commandersLogDate = clock.days + &quot;:&quot; + clock.hoursComponent + &quot;:&quot; + clock.minutesComponent + &quot;:&quot; + clock.secondsComponent; }

	this.textArray = missionVariables.commandersLogText.split(&quot;,&quot;);
	this.dateArray = missionVariables.commandersLogDate.split(&quot;,&quot;);

	this.oldRank = player.rank;
	this.oldCredits = player.credits;

	this.maxLogSize = 100; // set how max number of entries to store
	this.setInterface();
	}

this.shipDockedWithStation = function()
	{
	this.setInterface();
	this.playerWillSaveGame();
	}

this.playerWillSaveGame = function()
	{ 
	missionVariables.commandersLogText = this.textArray;
	missionVariables.commandersLogDate = this.dateArray;
	}

this.setInterface = function()
	{
	player.ship.dockedStation.setInterface(&quot;CommandersLog&quot;,
		{ title: &quot;Commander&#39;s Log&quot;,
		category: &quot;Logs&quot;,
		summary: &quot;Displays the Commander&#39;s ship purchase and galactic jump history.&quot;,
		callback: this.$showLog.bind(this) });
	}	
	
this.$showLog = function()
	{
	mission.runScreen({title:&quot;Commander&#39;s Log&quot;, messageKey:&quot;commandersLog_header&quot;, choicesKey:&quot;commandersLog_choices&quot;}, this.choice);
	this.startPoint = 0;
	this.endPoint = this.textArray.length;
	if(this.endPoint &gt; 14)
		{this.startPoint = this.endPoint - 15;}
	let listCounter = 0; // reset the counter
	for(listCounter = this.startPoint; listCounter &lt; this.endPoint; listCounter++)
		{ mission.addMessageText(this.dateArray[listCounter] + &quot; - &quot; + this.textArray[listCounter]); }
	}

this.choice = function(choice)
	{
	switch(choice)
		{
		case &quot;COMMANDERSLOG_1_DUMP&quot;:
			{
			player.consoleMessage(&quot;Commanders log written to latest.log&quot;, 6);
			log(this.name, &quot;==========================================================&quot;);
			log(this.name, &quot; &quot;);
			
			let logCounter = 0 ; // reset the counter
			for(logCounter = 0;logCounter&lt;this.dateArray.length;logCounter++)
				{ log(this.name, (this.dateArray[logCounter] + &quot; - &quot; + this.textArray[logCounter])); }
			log(this.name, &quot; &quot;);
			log(this.name, &quot;==========================================================&quot;);
			break;
			}

			case &quot;COMMANDERSLOG_2_RESET&quot;:
			{
			delete this.textArray;
			delete this.dateArray;
			this.textArray = new Array;
			this.dateArray = new Array;
			this.textArray[0] = &quot;Commanders log reset&quot;;
			this.dateArray[0] = clock.days + &quot;:&quot; + clock.hoursComponent + &quot;:&quot; + clock.minutesComponent + &quot;:&quot; + clock.secondsComponent; 
			player.consoleMessage(&quot;Commander&#39;s log reset.&quot;, 6);
			this.playerWillSaveGame();
			break;
			}
		}
	}
	
this.playerEnteredNewGalaxy = function(galaxyNumber)
	{
	this.galaxyNumber = (galaxyNumber * 1 ) + 1;
	this.clockString = clock.days + &quot;:&quot; + clock.hoursComponent + &quot;:&quot; + clock.minutesComponent + &quot;:&quot; + clock.secondsComponent; 
	this.dateArray.push(this.clockString);
	this.textArray.push(&quot;Ship jumped to galaxy &quot; + this.galaxyNumber);
	this.trimArrays();
	}
	
this.playerBoughtNewShip = function(ship)
	{
	this.clockString = clock.days + &quot;:&quot; + clock.hoursComponent + &quot;:&quot; + clock.minutesComponent + &quot;:&quot; + clock.secondsComponent; 
	this.dateArray.push(this.clockString);
	this.firstLetter = ship.name.charAt(0).toLowerCase();
	this.vowels = &quot;aeiou&quot;;
	if(this.vowels.indexOf(this.firstLetter))
		{ this.prefix = &quot;a &quot;;}
	else
		{this.prefix = &quot;an &quot;;}
	this.textArray.push(&quot;Commander purchased &quot;+ this.prefix + ship.name);
	this.trimArrays();
	}
	
this.shipWillExitWitchspace = function()
	{
	if(system.ID === -1)
		{
		this.clockString = clock.days + &quot;:&quot; + clock.hoursComponent + &quot;:&quot; + clock.minutesComponent + &quot;:&quot; + clock.secondsComponent; 
		this.dateArray.push(this.clockString);
		this.textArray.push(&quot;Witchspace misjump occurred&quot;);
		this.trimArrays();
		}
	}

this.guiScreenChanged = function(to, from)
	{
	if(to &amp;&amp; to === &quot;GUI_SCREEN_EQUIP_SHIP&quot;)
		{ this.oldCredits = player.credits; }
	}
	
this.playerBoughtEquipment = function(equip)
	{
	if(equip &amp;&amp; equip == &quot;EQ_RENOVATION&quot;)
		{	
		this.clockString = clock.days + &quot;:&quot; + clock.hoursComponent + &quot;:&quot; + clock.minutesComponent + &quot;:&quot; + clock.secondsComponent; 
		this.dateArray.push(this.clockString);
		this.textArray.push(&quot;Maintenance overhaul purchased at &quot; + system.name + &quot; for &quot; + (this.oldCredits - player.credits) + &quot;cr&quot;);
		this.trimArrays();
		}
	this.oldCredits = player.credits;	
	}
	
this.shipKilledOther = function(whom, damageType)
	{
	if(player.rank !== this.oldRank)
		{
		this.clockString = clock.days + &quot;:&quot; + clock.hoursComponent + &quot;:&quot; + clock.minutesComponent + &quot;:&quot; + clock.secondsComponent; 
		this.dateArray.push(this.clockString);
		this.textArray.push(&quot;Rank of &quot; + player.rank + &quot; achieved&quot;);
		this.trimArrays();
		}
	this.oldRank = player.rank;
	}
	
this.trimArrays = function()
	{
	if(this.dateArray[0] === &quot;&quot; || this.dateArray.length &gt; this.maxLogSize) // remove the first empty item if present after adding first entry, or if array is too large
		{
		this.dateArray.shift();
		this.textArray.shift();
		}
	}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
