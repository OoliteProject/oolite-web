<html>
    <head>
        <title>Expansion N-Shields</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion N-Shields</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">2 Equipment</a></li>
          <li><a href="#ships">41 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">3 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Optional Expansions mismatch between OXP Manifest and Expansion Manager at character position 0466 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
                <li>Unresolved dependency reference to oolite.oxp.Ngalo.NPC_Energy_Units:0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Fair NPC fore/aft shield simulation and associated visual effects, intended as an improved alternative to the CustomShields and NPC-Shields OXPs.</td>
                    <td>Fair NPC fore/aft shield simulation and associated visual effects, intended as an improved alternative to the CustomShields and NPC-Shields OXPs.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Ngalo.N-Shields</td>
                    <td>oolite.oxp.Ngalo.N-Shields</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>N-Shields</td>
                    <td>N-Shields</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Ngalo</td>
                    <td>Ngalo</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.0.2</td>
                    <td>1.0.2</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                            <li>oolite.oxp.Ngalo.NPC_Equipment_Damage:0</li>
                            <li>oolite.oxp.Ngalo.NPC_Energy_Units:0</li>
                            <li>oolite.oxp.dybal.NPC_Energy_Units:0</li>
                            <li>oolite.oxp.Lone_Wolf.NavalGridNext:0</li>
                            <li>oolite.oxp.Norby.ShipVersion:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Ngalo.NPC_Equipment_Damage:0</li>
                            <li>oolite.oxp.Ngalo.NPC_Energy_Units:0</li>
                            <li>oolite.oxp.dybal.NPC_Energy_Units:</li>
                            <li>oolite.oxp.Lone_Wolf.NavalGridNext:</li>
                            <li>oolite.oxp.Norby.ShipVersion:</li>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                            <li>N-Shields.oxp:0</li>
                            <li>oolite.oxp.CommonSenseOTB.CustomShields:0</li>
                            <li>oolite.oxp.phkb.ShipConfiguration:0</li>
                    </td>
                    <td>
                            <li>N-Shields.oxp:0</li>
                            <li>oolite.oxp.CommonSenseOTB.CustomShields:0</li>
                            <li>oolite.oxp.phkb.ShipConfiguration:0</li>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/9/9c/N-Shields-1.0.2.oxz">https://wiki.alioth.net/img_auth.php/9/9c/N-Shields-1.0.2.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1666825761</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/N-Shields'>http://wiki.alioth.net/index.php/N-Shields</a></p>
        <h3>Readme.txt</h3>
        <pre>N-Shields OXP
-------------
v1.0.2, by &#39;Ngalo&#39;


Gives NPCs simulated shields, with the default setting (as in CustomShields) being a &#39;fair&#39; emulation of the player&#39;s shields.

Calls Shield Cycler (versions 2.x and above), if installed, to adjust shields after taking the damage from the shield.

Acts as a hub for handling damage to NPCs, calling damage handlers from other OXPs after the shields are depleted and the damage reach the ship&#39;s hull.

Awards Shield Cycler for a percentage of the ships that don&#39;t have them, configures Shield Booster and Military SHield Booster for NPCs that have them, apply shield recharge enhancements from Energy Grid (civillian and naval) for ships that have them.


Settings in the N-Shields.js script
-----------------------------------

* this._NPC_shields = true;
    Switch simulated shields on or off. If false, visual effects will be drawn based on energy level.
    
* this._Thargoid_shields = true;
    As above, but applies to Thargoids.
    
* this._Thargoid_energyReduction = true;
    Reduce Thargoids&#39; energy banks to balance their new shields.

* this._NPC_flasherColours = 1;
    Pre-defined flasher list to use for standard NPC shields.
    Options:
        0: &quot;_multicolour1&quot;, simple and bright
        1: &quot;_multicolour2&quot;, slightly different colours, reduced alpha when low
        2: &quot;_multicolour3&quot;, reverse colour order (red high, blue low)
        3: &quot;_green&quot;, the Thargoid default (but can be used for other NPCs too)
        4: &quot;_blue&quot;, various shades of blue
        
* this._Thargoid_flasherColours = 3;
    Colour for Thargoid shields, options as above.
    
* this._flasherScale = 1;
    Scale factor for flasher effects.


Notes For OXP Developers
------------------------

* script_info properties (in shipdata.plist):

    * npc_shields = &quot;no&quot;;
        N-Shields ignores the ship and doesn&#39;t do anything.

    * NShields_flasherKeys = (&quot;myRed1&quot;, &quot;myRed2&quot;, &quot;myRed3&quot;, &quot;myRed3&quot;, &quot;myRed4&quot;);
        A list of partial effectdata.plist keys, which will be prefixed with &quot;N-Shields_flasher_&quot; to obtain the full key for each flasher or other visualEffect.
        Ordered from lowest shield level to highest in 32-point increments.
    
    * NShields_flasherPreset = 3;
        Number indicating one of the pre-defined flasher lists.
        See above for available options.
        
    * max_shield_aft = 128;
    * max_shield_forward = 128;
    * shield_recharge_aft = 2.0;
    * shield_recharge_forward = 2.0;
        Customise shield levels and recharge rates for this ship.
        The example above shows the standard default shields.
        Note that these can apply to player ships as well as NPCs.
        For Thargoid vessels, use &#39;upper&#39; and &#39;lower&#39; instead of &#39;forward&#39; and &#39;aft&#39;.
    
    * NShields_energyReduction = 128;
        Specify an energy-bank reduction which will be applied when shields are set up.
        This is intended for two purposes:
        1) For mission ships, to prevent already-difficult opponents becoming impossible
        2) For ships which are &#39;supposed&#39; to have strong shields, but &#39;fake it&#39; with bigger energy banks when N-Shields is not installed.
    
    * NShields_exploders = (&quot;NShields-explode-ring-red&quot;)
        Custom exploder effect list. The example would make your ship spawn red(ish) ring explosions when its shields are hit.
    
    * NShields_protect_subentities = &quot;no&quot;;
        If defined as shown, shields will not protect frangible subentities on this ship.
        The subentities may be left exposed, or given their own shield configurations like any other ship.

    The script_info keys &quot;NShields_config&quot; and &quot;NShields_colours&quot; are no longer supported.
    

* Compatibility with other shipTakingDamage handler overrides

    N-Shields provides an array onto which other OXPs can push their NPC shipTakingDamage handlers instead of actually overriding the handler in the ship script. Functions in this array will imitate the player&#39;s world-script shipTakingDamage handler; that is, they are called for every hit but with the &#39;amount&#39; parameter only conveying damage which actually penetrated the shields (0 if the hit was entirely absorbed by shields). This approach ensures your handler will be called in the same manner regardless of OXP loading order and avoids any need for your OXP to detect which shield was hit and whether it&#39;s still up.

    There are two ways to use this feature:

    1) In your script&#39;s startUp handler:

        if (worldScripts.NShields &amp;&amp; worldScripts.NShields.$shipHasShields(ship)) {
            worldScripts.NShields._damageHandlers.push(my_shipTakingDamage_override) //replace my_shipTakingDamage_override with your handler name
        } else {
            //apply your handler override directly here
        }

       This approach applies your handler to all ships which have simulated shields, but not to those which don&#39;t. If you need to choose which ships get the handler yourself, use the other option:

    2) In your script&#39;s shipSpawned handler, once you have decided that a ship should get your shipTakingDamage override:

        if (worldScripts.NShields &amp;&amp; worldScripts.NShields.$shipHasShields(ship)) {
            if (!ship.script._NShields_damageHandlers) ship.script._NShields_damageHandlers = []; //set up the array if N-Shields hasn&#39;t run its shipSpawned handler yet
            ship.script._NShields_damageHandlers.push(my_shipTakingDamage_override) //replace my_shipTakingDamage_override with your handler name
        } else {
            //apply your handler override directly here
        }
    
* function to configure NPC ship

    N-Shields makes available to other OXPs a function to configure the NPC&#39;s shields after awarding of any defense-related equipment to it:

    worldScripts.NShields.$configureShip(ship)

    This idempotent (i.e. can be called several times without adverse effects) function will configure the ship&#39;s shields taking into account any script_info properties defined and the equipments isntalled in the ship, like Shield Booster, Military Shield Enhancement, Energy Grid, Shield Cycler, etc.


License
-------

You may use, adapt, distribute etc. this Oolite Expansion Pack as permitted by the Creative Commons Attribution-NonCommercial-ShareAlike License (CC-BY-NC-SA).


Acknowledgements
----------------

This OXP owes most of its inspiration and a little code to CustomShields OXP by CommonSenseOTB.
phkb and Norby have been very helpful in finding and fixing bugs.


Version History
---------------

1.0.2
* Fixes bug: once fully recharged, NPC and Thargoid shidels didn&#39;t recharge anymore.

1.0.1 (by Dybal)
* Doesn&#39;t add shields to scoopable &quot;ships&quot; (that includes all variations of escape capsules, even if their primary role happens to be different from escape-capsule).
* Fixes bugs that broke idempotency of $configureShip (leading to infinite loops at damage handling if $configureShip was called twice on the same ship).
* Fixes bug that led to &quot;invulnerable ship&quot; if the ship&#39;s script had its own shipTakingDamage event handler.


1.0 (by Dybal)
* Drops support for Shield Cycler (and Shield Cycler Next) 1.x for NPCs.
* Creates idempotent function for OXPs to call to configure a NPC&#39;s shields.
* Encapsulates modifications of ship&#39;s energy to verify for NaN before assigning a value into ship.energy (to prevent &quot;invulnerable ship&quot; bug).
* Adds delay to shipSpawned before setting up the ship to allow other OXPs&#39; shipSpawned to award equipments.
* Configures shield recharge rate with Energy Grid (civilian and naval) upgrades if the NPC has them installed.
* Configures both Military Shield Enhancement and Shield Enhancer for NPCs.
* Doesn&#39;t award Shield Cycler to NPCs that have Shield Equalizer.
* Fixes bugs in handling of damage to subentities.
* Standardizes script object properties names: functions references start with &#39;$&#39; (except event handlers), everything else starts with &#39;_&#39;;

0.7.1    
* Fixed missing &quot;use strict&quot; in N-Shields.js.
* Removed Ship Configuration compatibility script entry from world-scripts.plist (the actual script was removed in 0.7.0).
* Reduced Thargoids&#39; max shields (and compensatory energy reduction) slightly.

0.7
* Removed support for unusual/configurable shield types, except dorsal/ventral which now applies to Thargoids only, in order to simplify the scripts.
* Changed flashers from Ship entities to VisualEffects.
* Pre-defined flasher colour options: 3x Multicolour, Green, Blue.
* Hemisphere glow effects removed.
* New script_info keys NShields_flasherPreset, NShields_flasherKeys, max_shield_forward etc. to replace the now-unsupported NShields_colours, NShields_config.
* Config interface now works correctly (requires Oolite 1.83 or higher and Library OXP).
* Improved efficiency of hit-location code.
* Tentative support for Shield Cyclers on NPCs.

0.6.4
* Fixed bug in $locateHit cloaked-attacker handling (missing a &quot;.position&quot; or two).

0.6.3
* Fixed some bugs in NPC Equipment Damage compatibility code

0.6.2
* Fixed bug in manifest (missing &quot;}&quot;).

0.6.1
* Added correctly functioning shipconfig version check and fixed small variable non-declaration in $drawSparks

0.6
* Added user-friendly configuration options via Library OXP.
* Hemisphere glow effects now work, although they still look awful.
* Added compatibility with NPC Equipment Damage OXP.

0.5.4
* Removed non-functioning version check; tested &amp; corrected quaternion multiplication.

0.5.3
* Added version check in NShields-shipconfig-compatibility.js as requested by phkb

0.5.2
* Attempt to fix buggy aft shield effect orientation by using quaternion multiplication. Untested due to oolite-trunk launching error.

0.5.1
* Fixed bug in subentity shielding code which didn&#39;t check whether a shipTakingDamage handler had been stored before trying to call it
* Added hemisphere glow effects (disabled by default because very under-debugged &amp; not really working yet)

0.5
* Added explosion-based shield effects.

0.4
* Improved recharge code for fore/aft shields works more like the core player version.
* Correct handling of heat damage (hopefully?).
* $locateHit now attempts to identify a cloaked attacker if the parameter passed is null.
* Added dorsal/ventral shield configuration option and changed Thargoid default to use this.
* Fixed bug in $configureShieldsFromArray which caused Thargoid shield config failure.

0.3
* New features: Player shield effects, NPC shields protect subentities, spark effects for unshielded hits.
* Support for Ship Configuration OXP&#39;s shield upgrades/downgrades.
* Fixed bug in recharge code which resulted in excessive energy drain.
* Not released.
    
0.2
* Extensive re-write implementing some configuration options.
* &#39;single&#39; and &#39;fore/aft&#39; shield types supported.
* Damage handler array added for compatibility with other OXPs.
* Not released.
    
0.1
* Very basic shield simulation. Not released.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_NSHIELDS_NPC_NAVAL_SHIELD_BOOSTER.html">Military Shield Enhancement</a></td>
                    <td>yes</td>
                    <td align="right">475500</td>
                    <td align="center">14+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_NSHIELDS_NPC_SHIELD_BOOSTER.html">Shield Boosters</a></td>
                    <td>yes</td>
                    <td align="right">147500</td>
                    <td align="center">11+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingBL.html">N-Shields_explRingBL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingBM.html">N-Shields_explRingBM</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingBS.html">N-Shields_explRingBS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingBXL.html">N-Shields_explRingBXL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingBXS.html">N-Shields_explRingBXS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingGL.html">N-Shields_explRingGL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingGM.html">N-Shields_explRingGM</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingGS.html">N-Shields_explRingGS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingGXL.html">N-Shields_explRingGXL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingGXS.html">N-Shields_explRingGXS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingRL.html">N-Shields_explRingRL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingRM.html">N-Shields_explRingRM</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingRS.html">N-Shields_explRingRS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingRXL.html">N-Shields_explRingRXL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingRXS.html">N-Shields_explRingRXS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingWL.html">N-Shields_explRingWL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingWM.html">N-Shields_explRingWM</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingWS.html">N-Shields_explRingWS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingWXL.html">N-Shields_explRingWXL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explRingWXS.html">N-Shields_explRingWXS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarBL.html">N-Shields_explStarBL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarBM.html">N-Shields_explStarBM</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarBS.html">N-Shields_explStarBS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarBXL.html">N-Shields_explStarBXL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarBXS.html">N-Shields_explStarBXS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarGL.html">N-Shields_explStarGL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarGM.html">N-Shields_explStarGM</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarGS.html">N-Shields_explStarGS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarGXL.html">N-Shields_explStarGXL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarGXS.html">N-Shields_explStarGXS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarRL.html">N-Shields_explStarRL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarRM.html">N-Shields_explStarRM</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarRS.html">N-Shields_explStarRS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarRXL.html">N-Shields_explStarRXL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarRXS.html">N-Shields_explStarRXS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarWL.html">N-Shields_explStarWL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarWM.html">N-Shields_explStarWM</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarWS.html">N-Shields_explStarWS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarWXL.html">N-Shields_explStarWXL</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_explStarWXS.html">N-Shields_explStarWXS</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/N-Shields_sparks.html">N-Shields exploder</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/N-Shields-player.js</td>
                    <td><pre>notYetParsed</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/N-Shields.js</td>
                    <td><pre>notYetParsed</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/N-Shields_flasher_script.js</td>
                    <td><pre>this.name           = &quot;NShields_flasher&quot;;
this.author         = &quot;Ngalo&quot;;
this.copyright      = &quot;(C) 2015 &#39;Ngalo&#39;.&quot;;
this.licence        = &quot;CC-NC-by-SA 3.0&quot;;
this.description    = &quot;handles scaling, moving and lifespan of N-Shields flasher effects&quot;;

this.effectSpawned = function _NShields_effectSpawned() {
    //log (this.ship)
    //this.visualEffect.scale(this.ship.collisionRadius / 8)
    this._removalTimer = new Timer(this, this.$removeEffect, 0.25);
    this._FCB = addFrameCallback(this.$update.bind(this))
}

/*this.effectRemoved = function()
{
    if (this.$removalTimer)
    {
        this.$removalTimer.stop()
        delete this.$removalTimer;
    }
}*/

this.$removeEffect = function _NShieds_removeEffect() {
    removeFrameCallback(this._FCB)
    this.visualEffect.remove()
}

this.$update = function _NShieds_update(delta) {
    if (this.$parent.isValid)
        this.visualEffect.position = this.visualEffect.position.add(this.$parent.velocity.multiply(delta));
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
