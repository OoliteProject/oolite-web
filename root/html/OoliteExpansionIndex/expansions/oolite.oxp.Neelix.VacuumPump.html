<html>
    <head>
        <title>Expansion Vacuum Pump</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Vacuum Pump</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Consolidates multiple small quantities of Gold, Platinum or Gem Stones into the minimum number of Tonne Containers that they will fit into.</td>
                    <td>Consolidates multiple small quantities of Gold, Platinum or Gem Stones into the minimum number of Tonne Containers that they will fit into.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Neelix.VacuumPump</td>
                    <td>oolite.oxp.Neelix.VacuumPump</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Vacuum Pump</td>
                    <td>Vacuum Pump</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Neelix</td>
                    <td>Neelix</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.3</td>
                    <td>0.3</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Vacuum_Pump">http://wiki.alioth.net/index.php/Vacuum_Pump</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/d/d0/VacuumPump_0.3.oxz">https://wiki.alioth.net/img_auth.php/d/d0/VacuumPump_0.3.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873477</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Vacuum%20Pump'>http://wiki.alioth.net/index.php/Vacuum%20Pump</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_VACUUM_PUMP.html">Vacuum Pump</a></td>
                    <td>yes</td>
                    <td align="right">15000</td>
                    <td align="center">5+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. 
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/vacuum_pump.js</td>
                    <td><pre>&quot;use strict&quot;;
this.author			= &quot;Neelix&quot;; 
this.copyright		= &quot;Â© 2011-2014 Neelix.&quot;; 
this.licence		= &quot;CC-BY-NC-SA 4.0&quot;;
this.version		= &quot;0.3&quot;; 
this.name			= &quot;VacuumPump&quot;;
this.description	= &quot;Vacuum Pump World Script&quot;;


this.startUp = function() {
	//Prepare data storage and mode selection
	this.$commodities = [
		{commName: &quot;gold&quot;, mask: 1}, 
		{commName: &quot;platinum&quot;, mask: 2}, 
		{commName: &quot;gem_stones&quot;, mask: 4}
	];
	this.$mode = 0;
	//Prepare data storage for &quot;crushed cargo pods&quot; functionality
	this.$alloysStored = missionVariables.vacuumPump_alloysStored;
	if (!this.$alloysStored) {
		this.$alloysStored = 0;
	}
	this.$maxStorage = 20;
	//setup sound
	this.$pumpSound = new SoundSource;
	this.$pumpSound.sound = &quot;vacuumpump.ogg&quot;;
	this.$pumpSound.loop = false;
}

this.playerWillSaveGame = function() {
	//Keep record of internally stored crushed pods across sessions
	missionVariables.vacuumPump_alloysStored = this.$alloysStored;
}

this.shipWillLaunchFromStation = function() {
	// Record amount of gold, platinum and gem stones stored in the safe on launch.
	if (manifest.gold &gt; 499) {
		this.$commodities[0].inSafe = 499;
	} else {
		this.$commodities[0].inSafe = manifest.gold;
	}
	if (manifest.platinum &gt; 499) {
		this.$commodities[1].inSafe = 499;
	} else {
		this.$commodities[1].inSafe = manifest.platinum;
	}
	if (manifest.gemStones &gt; 499999) {
		this.$commodities[2].inSafe = 499999;
	} else {
		this.$commodities[2].inSafe = manifest.gemStones;
	}
}

this._startPump = function() {
	var $i, $j;
	var $ml = manifest.list;
	var $commInfo = [{},{},{}];
	var $activated = false;
	var $totalRecovered = 0;
	var $alloyTotal = 0;

	//Calculate how much of each commodity is in the hold, and whether or not it needs to be consolidated
	for ($i = 0; $i &lt; $ml.length; $i++) {
		for ($j = 0; $j &lt; 3; $j++) {
			if ($ml[$i].commodity == this.$commodities[$j].commName) {
				$commInfo[$j].index = $i;
				$commInfo[$j].inHold = $ml[$i].quantity-this.$commodities[$j].inSafe;
				$commInfo[$j].minContainers = Math.ceil($commInfo[$j].inHold / (($j == 2) ? 1000000 : 1000));
				$commInfo[$j].pumpUseful = ($commInfo[$j].minContainers &lt; $ml[$i].containers) ? true : false;
			}
		}
	}
	// Actvate pump based on mode and whether or not it is useful for a given commodity
	for ($j = 0; $j &lt; 3; $j++) {
		if (player.alertCondition == 1 &amp;&amp; player.ship.energy &gt;= 64 &amp;&amp; $commInfo[$j].pumpUseful &amp;&amp; 
			(this.$commodities[$j].mask &amp; this.$mode || this.$mode == 0 &amp;&amp; !$activated)) {
			
			this.$pumpSound.play();
			this._pumpAct($j,$commInfo[$j]);
			$totalRecovered += $ml[$commInfo[$j].index].containers - $commInfo[$j].minContainers;
			$activated = true;
			//Convert cargo pods to alloys and add to internal storage or cargo bay
			this.$alloysStored += $totalRecovered;
			while (this.$alloysStored &gt;= this.$maxStorage) {
				manifest.alloys += 1;
				this.$alloysStored -= this.$maxStorage;
				$alloyTotal += 1;
			}
		}
	}
	if ($activated) {
		//notify player how much cargo space has been recovered.
		player.consoleMessage(&quot;Cargo load &quot; + player.ship.cargoSpaceUsed + &quot; of &quot; + player.ship.cargoSpaceCapacity + &quot; t. &quot;,10);
		player.consoleMessage($totalRecovered + &quot; t. Recovered&quot;,10);
		if ($alloyTotal &gt; 0) {
			player.consoleMessage($alloyTotal + &quot; t Alloys added to Cargo bay&quot;,10);
		}
	} else {
		//equipment failed to operate - notify the player
		if (player.alertCondition != 1) {
			player.consoleMessage(&quot;Vacuum Pump can not be operated unless condition is Green&quot;,5);
		} else {
			player.consoleMessage(&quot;Unable to recover any cargo space&quot;,5);
		}
	}
}   

this._pumpAct = function($commNo, $commData) {
	//adding entire amount of the item to the manifest in one go should put it in the minimum number of containers.
	player.ship.energy -= 48;
	switch ($commNo) {
		case 0:
			manifest.gold -= $commData.inHold;
			manifest.gold += $commData.inHold;
			player.consoleMessage(&quot;Gold Consolidated&quot;,7);
			break;
		case 1:
			manifest.platinum -= $commData.inHold;
			manifest.platinum += $commData.inHold;
			player.consoleMessage(&quot;Platinum Consolidated&quot;,7);
			break;
		case 2:
			manifest.gemStones -=$commData.inHold;
			manifest.gemStones +=$commData.inHold;
			player.consoleMessage(&quot;Gem Stones Consolidated&quot;,7);
	}
}

this._modeCycle = function() {
	this.$mode++;
	if (this.$mode == 8) {
		this.$mode = 0;
	}
	switch (this.$mode) {
		case 0:
			player.consoleMessage(&quot;Vacuum Pump: Single Use Mode&quot;);
			break;
		case 1:
			player.consoleMessage(&quot;Vacuum Pump: Gold Only&quot;);
			break;
		case 2:
			player.consoleMessage(&quot;Vacuum Pump: Platinum Only&quot;);
			break;
		case 3:
			player.consoleMessage(&quot;Vacuum Pump: Gold and Platinum&quot;);
			break;
		case 4:
			player.consoleMessage(&quot;Vacuum Pump: Gem Stones Only&quot;);
			break;
		case 5:
			player.consoleMessage(&quot;Vacuum Pump: Gold and Gem Stones&quot;);
			break;
		case 6:
			player.consoleMessage(&quot;Vacuum Pump: Platinum and Gem Stones&quot;);
			break;
		case 7:
			player.consoleMessage(&quot;Vacuum Pump: Everything&quot;);
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/vacuum_pump_eq.js</td>
                    <td><pre>&quot;use strict&quot;;
this.author			= &quot;Neelix&quot;; 
this.copyright		= &quot;Â© 2011-2014 Neelix.&quot;; 
this.licence		= &quot;CC-BY-NC-SA 4.0&quot;;
this.version		= &quot;0.3&quot;; 
this.name			= &quot;VacuumPumpEQ&quot;;
this.description	= &quot;Vacuum Pump Equipment Script&quot;;

this.activated = function() {
		worldScripts[&quot;VacuumPump&quot;]._startPump.bind(worldScripts[&quot;VacuumPump&quot;])();
}

this.mode = function() {
		worldScripts[&quot;VacuumPump&quot;]._modeCycle.bind(worldScripts[&quot;VacuumPump&quot;])();
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
