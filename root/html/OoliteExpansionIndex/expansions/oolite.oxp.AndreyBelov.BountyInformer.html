<html>
    <head>
        <title>Expansion Bounty Informer</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Bounty Informer</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">2 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>This device gives you access to the bounty registry of police criminal database.</td>
                    <td>This device gives you access to the bounty registry of police criminal database.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.AndreyBelov.BountyInformer</td>
                    <td>oolite.oxp.AndreyBelov.BountyInformer</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Bounty Informer</td>
                    <td>Bounty Informer</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Andrey Belov aka timer</td>
                    <td>Andrey Belov aka timer</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.0</td>
                    <td>2.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Bounty_Informer_OXP">http://wiki.alioth.net/index.php/Bounty_Informer_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/b/b7/BountyInformer.oxz">https://wiki.alioth.net/img_auth.php/b/b7/BountyInformer.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1677574456</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Bounty%20Informer'>http://wiki.alioth.net/index.php/Bounty%20Informer</a></p>
        <h3>Readme.txt</h3>
        <pre>Bounty Informer OXP
===================

== Overview ==

This device gives you access to the bounty registry of the GalCop (Police) criminal database.


== Requires ==

- Oolite 1.81
- You must have bought the &quot;Scanner Targeting Enhancement&quot; before this becomes available.


== About original version ==

The original idea and implementation of this useful OXP was written by Frame - Bounty Scanner.
In this version of the OXP a different code base has been used.


== History ==

2023-02-28 v2.0 - Total refactoring and use another API for display bounty.
                  Now compatible with &quot;Randomshipnames OXP&quot;

2014-08-31 v1.0 - Initial release


== Links ==

https://wiki.alioth.net/index.php/Bounty_Informer_OXP
http://aegidian.org/bb/viewtopic.php?p=233763


== Licence ==

CC BY-NC-SA 3.0
see http://creativecommons.org/licenses/by-nc-sa/3.0/ for more info.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_BOUNTY_INFORMER.html">Bounty Informer</a></td>
                    <td>yes</td>
                    <td align="right">18500</td>
                    <td align="center">10+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_BOUNTY_INFORMER_REMOVER.html">Sell Bounty Informer</a></td>
                    <td>yes</td>
                    <td align="right">150</td>
                    <td align="center">10+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. 
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/bounty-informer.js</td>
                    <td><pre>(function(){
&#39;use strict&#39;;

this.name        = &#39;Bounty Informer&#39;;
this.author      = &#39;Andrey Belov&#39;;
this.copyright   = &#39;© 2023 Andrey Belov aka timer [ TiNe Corp. ]&#39;;
this.licence     = &#39;CC BY-NC-SA 3.0&#39;; // see http://creativecommons.org/licenses/by-nc-sa/3.0/ for more info.
this.description = &#39;This device gives you access to the bounty registry of police criminal database.&#39;;
this.version     = &#39;2.0&#39;;


let _binf_disabled = false;
let _binf_timer    = false;
let _binf_bountyRE = /((?:Bounty )? )([\d\.]+)( ₢)/;


this.$disableBountyInformer = function() {
    _binf_disabled = true;
    this._binf_stopPeriodicalCheck( player.ship.target );
};

this.$enableBountyInformer = function() {
    _binf_disabled = false;
};

this.shipWillDockWithStation = function(station) {
    this._binf_stopPeriodicalCheck(false);
};

this.shipTargetLost = this.shipTargetCloaked = function(target) {
    this._binf_stopPeriodicalCheck(target);
};

this._binf_stopPeriodicalCheck = function(target) {
    if ( _binf_timer &amp;&amp; _binf_timer.isRunning ) {
        _binf_timer.stop();
    }
    if (target) {
        this._binf_removeBountyInfo(target);
    }
};

this._binf_startPeriodicalCheck = function(delay) {
    if ( _binf_timer ) {
        if ( ! _binf_timer.isRunning ) _binf_timer.start();
    }
    else {
        _binf_timer = new Timer( this, this._binf_scanAndUpdate, delay||0, 5 );
    }
};

this.shipTargetAcquired = function(target) {
    if ( _binf_disabled ) return;
    if ( this._binf_scanAndUpdate(target) ) this._binf_startPeriodicalCheck(5);
};

this._binf_scanAndUpdate = function(target) {
    let pship = player.ship;
    target = target || pship.target;

    if ( ! target || _binf_disabled
         || pship.equipmentStatus(&#39;EQ_BOUNTY_INFORMER&#39;) !== &#39;EQUIPMENT_OK&#39;
         || pship.status === &#39;STATUS_DOCKED&#39;
         || ! target.isShip
         || target.isCloaked
         || target.isJamming
         || target.isCargo ) {

        this._binf_stopPeriodicalCheck(target);
        return false;
    }

    let bounty = this.$getBounty(target);

    if ( bounty &gt; 0 ) {
        let desc  = target.scanDescription || this.$initialScanDescription( target, bounty );
        let found = desc.match(_binf_bountyRE);
        if ( found &amp;&amp; found.length === 4 ) {
            if ( (+found[2]) !== bounty ) {
                target.scanDescription = desc.replace( _binf_bountyRE, &#39;$1&#39;+bounty+&#39;$3&#39; );
            }
        }
        else {
            target.scanDescription = desc+&#39; &#39;+bounty+&#39; ₢&#39;;
        }
    }
    else {
        this._binf_removeBountyInfo(target);
    }

    if ( target.scanClass === &#39;CLASS_ROCK&#39; ) return false;

    return true;
};

this._binf_removeBountyInfo = function(target) {
    if ( ! target || target.scanDescription === null ) return;
    let initDesc = target.scanDescription;
    target.scanDescription = initDesc.replace( _binf_bountyRE, &#39;&#39; ) || null;
}

this.$getBounty = function(ship) {
    let bounty = ship.bounty;
    let sc = ship.scanClass;

    return sc === &#39;CLASS_BUOY&#39; || sc === &#39;CLASS_ROCK&#39;
        ? bounty / 10
        : bounty;
};

this.playerBoughtEquipment = function(equipment) {
    if ( equipment !== &#39;EQ_BOUNTY_INFORMER_REMOVER&#39; ) return;

    this._binf_stopPeriodicalCheck(false);
    player.ship.removeEquipment(&#39;EQ_BOUNTY_INFORMER_REMOVER&#39;);
    player.ship.removeEquipment(&#39;EQ_BOUNTY_INFORMER&#39;);
    player.credits += ( EquipmentInfo.infoForKey(&#39;EQ_BOUNTY_INFORMER&#39;).price * 0.06 );
};

this.$initialScanDescription = function( ship, bounty ) {
    let sc = ship.scanClass;
    if ( sc === &#39;CLASS_NEUTRAL&#39; ) {
        return bounty &gt; 0
            ? ( bounty &gt; 50 ? &#39;Fugitive&#39; : &#39;Offender&#39; )
            : &#39;Clean&#39;;
    }
    let tmp = sc === &#39;CLASS_THARGOID&#39; ? &#39;legal-desc-alien&#39;
            : sc === &#39;CLASS_POLICE&#39;   ? &#39;legal-desc-system-vessel&#39;
            : sc === &#39;CLASS_MILITARY&#39; ? &#39;legal-desc-military-vessel&#39;
            : false;
    return tmp ? expandDescription(&#39;[&#39;+tmp+&#39;]&#39;)
               : bounty &gt; 0 ? &#39;Bounty&#39;
               : &#39;&#39;;
}

}).call(this);
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
