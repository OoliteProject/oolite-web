<html>
    <head>
        <title>Expansion Trophy Collector</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Trophy Collector</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">2 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Keep track of your kills. When in-flight, view your 10 last kills (Bounty Log) in an MFD. When docked, view your all-time kills (Trophy Collection) along with a kill log (Trophy Log) of 38 events in the interfaces screen.</td>
                    <td>Keep track of your kills. When in-flight, view your 10 last kills (Bounty Log) in an MFD. When docked, view your all-time kills (Trophy Collection) along with a kill log (Trophy Log) of 38 events in the interfaces screen.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.spara.trophy_collector</td>
                    <td>oolite.oxp.spara.trophy_collector</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Trophy Collector</td>
                    <td>Trophy Collector</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>spara</td>
                    <td>spara</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.3.1</td>
                    <td>2.3.1</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/9/9e/TrophyCollector.oxz">https://wiki.alioth.net/img_auth.php/9/9e/TrophyCollector.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873393</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Trophy%20Collector'>http://wiki.alioth.net/index.php/Trophy%20Collector</a></p>
        <h3>TrophyCollector_readme_&amp;_license.txt</h3>
        <pre>Trophy Collector OXP ver 2.3.1 (27.06.2020)

Author: spara (Mika Sp√•ra)

_The_Story_

A usual situation at a GalCop station. After a hard days work, pilots are sitting in a bar and having a drink or two. After a while the talk goes to their Elite rankings. And it all ends up in a fight over whose ranking is better than others. The main argument being something like: &quot;I have killed at least 500 Kraits...&quot;

GalCop authorities recognized the problem and ordered a solution from Spara, PrOog &amp; Ming Agency.

The solution is a list of killed shiptypes and quantities. The list is called the Trophy Collection. You kill someone and you get a trophy, simple as that. 

When you are in flight, your ship starts collecting trophies. You can view your 10 latest trophies from a MFD screen as a Bounty Log. 

You can view a log of trophies collected including their bounties and systems in a chronological list (MANIFEST - F7). This list is called Trophy Log. Log holds 38 entries.

When you are docked, you can view your Trophy Log of 38 entries and full Trophy Collection from the interfaces screen (F4). Collection shows ship types and quantity of trophies collected. Log shows ship type, bounty received and system the trophy was achieved in.

_Requirements_

Oolite version 1.79.

_Installing_

Install the OXP by copying TrophyCollector.oxp to your AddOns-folder.

------

This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/3.0/
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TROPHY_MFD.html">Trophy Log MFD</a></td>
                    <td>yes</td>
                    <td align="right">3000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TROPHY_MFD_REMOVE.html">Remove Trophy Log MFD</a></td>
                    <td>yes</td>
                    <td align="right">100</td>
                    <td align="center">5+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;trophy_col&quot;;
this.author      = &quot;spara&quot;;
this.copyright   = &quot;2012-2014 Mika Spara&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Manage Trophy Collection&quot;;
this.version     = &quot;2.3.0&quot;;

this.startUp = function() {
	this.$lines = 19; 	//Number of rows printed to screen. Number of entries shown is 2*rows.
	if (!missionVariables.trophyArray) {
		this.$trophyArray = new Array();
	}
	else {
		this.$trophyArray = JSON.parse(missionVariables.trophyArray);
	}
	if (!missionVariables.trophyLog) {
		this.$trophyLog = new Array();
	}
	else {
		this.$trophyLog = JSON.parse(missionVariables.trophyLog);
	}
	this.$nextPage = false;
	this.$printInd = 0;
	this.$showLog = false;
	this.$cleanTrophyCollection();
	this.$trophyArrayFull = this.$trophyArray;
}

this.startUpComplete = function() {
	this.$addTrophyInterface();
	if (this.$isBigGuiActive() == true) this.$lines = 25;
}

//Clean bogus entries from the array.
this.$cleanTrophyCollection = function() {
	var bogusEntries = [&quot;?&quot;];
	for (var j = this.$trophyArray.length - 1; j &gt;= 0; j--) {
		if (bogusEntries.indexOf(this.$trophyArray[j][0])!== -1)
			this.$trophyArray.splice(j,1);
	}
}

this.playerWillSaveGame = function () {
	missionVariables.trophyArray = JSON.stringify(this.$trophyArray);
	missionVariables.trophyLog = JSON.stringify(this.$trophyLog);
}

//Add new trophy to the collection.
this.shipKilledOther = function(whom, damageType) {
	if (!whom.hasRole(&quot;escape-capsule&quot;) &amp;&amp; (whom.isPiloted || whom.isDerelict || whom.hasRole(&quot;tharglet&quot;) || whom.hasRole(&quot;thargon&quot;))) {
		var name = expandMissionText(&quot;trophy_&quot;+whom.dataKey);
		if (!name) name = whom.name;
		if (whom.primaryRole == &quot;pirate-cove&quot;) //distinguish pirate coves from rock hermits
			name = &quot;Pirate Cove&quot;;
		this.$trophyArray.unshift([name, formatCredits(whom.bounty, true, true) +&quot;, &quot;+system.name]);
		if (this.$trophyArray.length == 2 * this.$lines + 1)
			this.$trophyArray.pop();
		this.$addTrophyToCollection(name);
		this.$setMFD();
	}
}

//Go to next page, if more than one screen of trophies.
this.missionScreenEnded = function() {
	if (this.$nextPage) {
		this.$showTrophyScreen(&quot;trophy_collection&quot;);
	}
	//show log after kill pages
	else if (this.$showLog) {
		this.shipWillLaunchFromStation();
		this.$showTrophyScreen(&quot;log&quot;);
		this.shipDockedWithStation();
		this.$nextPage = false;
		this.$printInd = 0;
	}
}

//Show mission screen of trophies
this.$showTrophyScreen = function(mode) {
	var largeGUI = this.$isBigGuiActive();
	this.$lines = 19;
	if (largeGUI == true) this.$lines = 25;
	//show log after kill pages
	this.$showLog = true;
	this.$nextpage = false;
	var titleText = &quot;Trophy Collection&quot;;
	var bgImage = &quot;trophy_bg.png&quot;;
	if (largeGUI == true) bgImage = &quot;trophy_bg_lg.png&quot;;
	if (mode === &quot;log&quot;) {
		titleText = &quot;Trophy Log&quot;;
		bgImage = &quot;trophy_inflight.png&quot;;
		if (largeGUI == true) bgImage = &quot;trophy_inflight_lg.png&quot;;
	}
	var messageText = this.$createColumns();
	mission.runScreen({
		title: titleText,
		screenID:&quot;trophy-collector&quot;,
		message: messageText,
		background: bgImage,
		allowInterrupt: true,
		exitScreen:&quot;GUI_SCREEN_INTERFACES&quot;
	});
}

//Swap collection to log on launch. Reset page count.
this.shipWillLaunchFromStation = function(station) {
	this.$trophyArray = this.$trophyLog;
	this.$printInd = 0;
	this.$nextPage = false;
	this.$setMFD();
}

this.$setMFD = function() {
	// no need to set the MFD if we&#39;re docked
	if (player.ship.isInSpace == false) return;
	if (player.ship.equipmentStatus(&quot;EQ_TROPHY_MFD&quot;) === &quot;EQUIPMENT_OK&quot;) {
		var message = &quot;&quot;
		var line = 0
		if (this.$trophyArray.length &gt; 0) {
			while (line &lt; 10 &amp;&amp; line &lt; this.$trophyArray.length) {
				var details = this.$trophyArray[line][1].split(&quot;, &quot;)
				message = message + this.$truncate(this.$trophyArray[line][0], details[0], details[1]) + &quot;\n&quot;;
				line++;
			}
		}
		else message = &quot;No trophies logged yet.\n\nGo hunt some trophies, Commander.&quot;;
		player.ship.setMultiFunctionText(&quot;trophy_mfd&quot;, message);
	}
	else player.ship.setMultiFunctionText(&quot;trophy_mfd&quot;, null);
}

this.equipmentDamaged = this.equipmentDestroyed = function(equipment) {
	if (equipment === &quot;EQ_TROPHY_MFD&quot;) {
		player.ship.setMultiFunctionText(&quot;trophy_mfd&quot;, null);
	}
}

this.equipmentRepaired = function(equipment) {
	if (equipment === &quot;EQ_TROPHY_MFD&quot;) {
		this.$setMFD();
	}
}

this.playerBoughtEquipment = function(equipment) {
	if (equipment === &quot;EQ_TROPHY_MFD_REMOVE&quot;) {
		player.ship.removeEquipment(&quot;EQ_TROPHY_MFD&quot;);
		player.ship.removeEquipment(&quot;EQ_TROPHY_MFD_REMOVE&quot;);
	}
}

//squeezing looks ugly, so I&#39;ll truncate instead.
this.$truncate = function(tShip, tBounty, tSystem) {
	var line = tBounty + &quot;, &quot; + tShip + &quot; (&quot; + tSystem + &quot;)&quot;;
	//first we chop the system down to 4 chars max
	while (global.defaultFont.measureString(line) &gt; 14 &amp;&amp; tSystem.length &gt; 4) {
		tSystem = tSystem.slice(0, -1);
		line = tBounty + &quot;, &quot; + tShip + &quot; (&quot; + tSystem + &quot;.)&quot;;
	}
	//if that&#39;s not enough, then we chop the shipname
	while (global.defaultFont.measureString(line) &gt; 14) {
		var lastChar = tShip.charAt(tShip.length - 1);
		tShip = tShip.slice(0, -1);
		if (lastChar !== &quot; &quot; &amp;&amp; tShip.charAt(tShip.length - 1) !== &quot; &quot;)
			line = tBounty + &quot;, &quot; + tShip + &quot;. (&quot; + tSystem + &quot;.)&quot;;
		else
			line = tBounty + &quot;, &quot; + tShip + &quot; (&quot; + tSystem + &quot;.)&quot;;
	}
	return line;
}

//Swap log to collection on docking.
this.shipDockedWithStation = function(station) {
	this.$trophyLog = this.$trophyArray;
	this.$trophyArrayFull.sort();
	this.$trophyArray = this.$trophyArrayFull;
	this.$addTrophyInterface();
	this.$showLog = false;
}

//Merge new trophy into the collection.
this.$addTrophyToCollection = function(name) {
	for (var j = 0; j &lt; this.$trophyArrayFull.length; j++) {
		if (this.$trophyArrayFull[j][0] == name) {
			this.$trophyArrayFull[j][1] = this.$trophyArrayFull[j][1] + 1;
			return;
		}
	}
	this.$trophyArrayFull.push([name, 1]);
}

this.$addTrophyInterface = function() {
	player.ship.dockedStation.setInterface(&quot;trophy_collection&quot;,{
		title: &quot;Trophy collection&quot;,
		category: &quot;Statistical&quot;,
		summary: &quot;Your collection of Trophies. You get trophies by killing piloted or derelict ships including thargoid drones and excluding escape pods.&quot;,
		callback: this.$showTrophyScreen.bind(this)
	});
}

//Format data into two columns.
this.$createColumns = function() {
	var columnized = &quot;&quot;;
	var nameWidth = 0;
	var countWidth = 0;
	var spaceWidth = defaultFont.measureString(&quot; &quot;);
	var tabChar = String.fromCharCode(31);//hair-space
	var tabCharWidth = defaultFont.measureString(String.fromCharCode(31));//hair-space
	var entryWidth = 0;
	var start = this.$printInd;
	var lines = this.$lines; //maximum number of rows
	//less entries than rows?
	if (this.$trophyArray.length - start &lt; lines)
		lines = this.$trophyArray.length - start;
	//last page?
	if (this.$trophyArray.length - (start+1) &lt; 2*lines) {
		this.$printInd = 0;
		this.$nextPage = false;
	}
	else {
		this.$printInd = this.$printInd + 2 * lines;
		this.$nextPage = true;
	}
	var trunkName = &quot;&quot;;
	for (var i = 0; i &lt; lines ; i++) {
		nameWidth = defaultFont.measureString(this.$trophyArray[start+i][0]);
		countWidth = defaultFont.measureString(&quot;(&quot;+this.$trophyArray[start+i][1]+&quot;)&quot;);
		entryWidth = nameWidth + spaceWidth + countWidth;
		//Two column layout
		if (start+i+lines &lt; this.$trophyArray.length) {

			//Left column
			if (entryWidth &lt;= 15) {
				columnized = columnized + this.$trophyArray[start+i][0]+&quot; (&quot;+this.$trophyArray[start+i][1]+&quot;)&quot;;
				for (var j = 0; j &lt; (17 - entryWidth) / tabCharWidth; j++)//spaceWidth
					columnized = columnized + tabChar;
			}
			else {
			//Entry too wide, truncate
				trunkName = this.$trophyArray[start+i][0];
				while (defaultFont.measureString(trunkName)+countWidth &gt; 15) {
					trunkName = trunkName.substring(0,trunkName.length-1);
				}
				columnized = columnized + trunkName + &quot;(&quot;+this.$trophyArray[start+i][1]+&quot;)&quot;;
				entryWidth = defaultFont.measureString(trunkName + &quot;(&quot;+this.$trophyArray[start+i][1]+&quot;)&quot;);
				for (var j = 0; j &lt; (17 - entryWidth) / tabCharWidth; j++)
					columnized = columnized + tabChar;
			}
			nameWidth = defaultFont.measureString(this.$trophyArray[start+i+lines][0]);
			countWidth = defaultFont.measureString(&quot;(&quot;+this.$trophyArray[start+i+lines][1]+&quot;)&quot;);
			entryWidth = nameWidth + spaceWidth + countWidth;
			//Right column
			if (entryWidth &lt;= 15)
				columnized = columnized + this.$trophyArray[start+i+lines][0]+&quot; (&quot;+this.$trophyArray[start+i+lines][1]+&quot;)\n&quot;;
			else {
			//Entry too wide, truncate
				trunkName = this.$trophyArray[start+i+lines][0];
				while (defaultFont.measureString(trunkName)+countWidth &gt; 15)
					trunkName = trunkName.substring(0,trunkName.length-1);
				columnized = columnized + trunkName + &quot;(&quot;+this.$trophyArray[start+i+lines][1]+&quot;)\n&quot;;
			}
		}
		//One column layout
		else {
			if (entryWidth &lt;= 32)
				columnized = columnized + this.$trophyArray[start+i][0]+&quot; (&quot;+this.$trophyArray[start+i][1]+&quot;)\n&quot;;
			else {
			//Entry too wide, truncate
				trunkName = this.$trophyArray[start+i][0];
				while (defaultFont.measureString(trunkName)+countWidth &gt; 32)
					trunkName = trunkName.substring(0,trunkName.length-1);
				columnized = columnized + trunkName + &quot;(&quot;+this.$trophyArray[start+i][1]+&quot;)\n&quot;
			}
		}
	}
	//No trophies?
	if (this.$trophyArray.length == 0) {
		columnized = &quot;No trophies collected yet.\n\nGo hunt some trophies Commander.&quot;;
		this.$showLog = false;
	}
	return columnized;
}

//-------------------------------------------------------------------------------------------------------------
// returns true if a HUD with allowBigGUI is enabled, otherwise false
this.$isBigGuiActive = function() {
	if (oolite.compareVersion(&quot;1.83&quot;) &lt;= 0) {
		return player.ship.hudAllowsBigGui;
	} else {
		var bigGuiHUD = [&quot;XenonHUD.plist&quot;, &quot;coluber_hud_ch01-dock.plist&quot;]; 	// until there is a property we can check, I&#39;ll be listing HUD&#39;s that have the allow_big_gui property set here
		if (bigGuiHUD.indexOf(player.ship.hud) &gt;= 0) {
			return true;
		} else {
			return false;
		}
	}
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
