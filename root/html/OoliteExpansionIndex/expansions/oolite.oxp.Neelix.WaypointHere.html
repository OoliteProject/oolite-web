<html>
    <head>
        <title>Expansion Waypoint Here</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Waypoint Here</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Allows you to set up to 8 waypoints to mark your current location so you can find your way back there later. Does not use any missile pylons.</td>
                    <td>Allows you to set up to 8 waypoints to mark your current location so you can find your way back there later. Does not use any missile pylons.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Neelix.WaypointHere</td>
                    <td>oolite.oxp.Neelix.WaypointHere</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Waypoint Here</td>
                    <td>Waypoint Here</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Neelix</td>
                    <td>Neelix</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.8</td>
                    <td>0.8</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Waypoint_Here">http://wiki.alioth.net/index.php/Waypoint_Here</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/7/72/WaypointHere.oxz">https://wiki.alioth.net/img_auth.php/7/72/WaypointHere.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873335</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Waypoint%20Here'>http://wiki.alioth.net/index.php/Waypoint%20Here</a></p>
        <h3>readme.txt</h3>
        <pre>Waypoint Here
By Neelix and phkb

Overview
========
Want to be able to find your way back to a specific location within a system without leaving behind an expensive piece of equipment that uses up a valuable missile pylon and could be damaged or scooped before you get back? The latest advances in HUD technology allow Talaxian Enterprises to offer a solution.

Waypoint here is a software upgrade for your Advanced Space Compass.  It allows you to set up to eight waypoints, anywhere in the system. If your HUD is configured to display waypoints these will be visible on-screen, with a range indicator.

Usage
=====
To use Waypoint Here functions, you&#39;ll need to first prime it with &#39;Shift-N&#39;.
To add a waypoint at your current location, press &#39;n&#39;. Your position and orientation will be recorded and one of 8 ASC beacons will be assigned.
To clear a waypoint, select the waypoint you want to remove on the ASC and press &#39;b&#39;.

Details
=======
* Tech Level: 10
* Price 2500Cr

There are 8 available beacons, called Alpha, Bravo, Charlie, Delta, Echo, Foxtrot, Golf and Hotel. When you add a new waypoint through Waypoint Here the first available beacon will be used.  The symbol on the ASC will be the first letter of the beacon name.

As with other methods of marking a specific locations the waypoints are cleared when you leave the system. Waypoints are not currently saved, so if you save and reload the game any Waypoint Here waypoints you had set will be lost.

Being a software upgrade, Waypoint Here cannot itself take damage in combat. It will however stop working if the ASC is damaged.

If the waypoints do not show up on your screen you may need to adjust your HUD settings to include a drawWaypoints dial or switch to a HUD that already includes it. This dial was introduced in Oolite version 1.79 so older HUDs probably won&#39;t include it unless they have been recently updated.

Requirements
============
This OXP needs Oolite v1.80.

Licence/Author
==============
This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/.

Version History
===============
0.8
- Better handling of ejecting in interstellar space.

0.7
- Bug fixes.

0.6
- Auto-deployment of waypoint in interstellar space now dependant on having the Waypoint Here equipment item installed.

0.5
- Added a auto-deployment of a waypoint at the witchspace entry point when entering interstellar space.

0.4
- Corrected flagging set for debugging. Directional helpers should now appear in interstellar space.

0.3
- Increased the number of deployable beacons from 5 to 8.
- Added an MFD window which displays the first 9 waypoints defined in the current system.
- If a waypoint is deployed in Interstellar space, the MFD will include basic directional markers to aid in finding the waypoint again, as the Advanced Space Compass is deactivated when in Interstellar space.
- Added &quot;readme.txt&quot; file to package.

0.2 
- Fixed issue with waypoints not resetting after a hyperspace jump.

0.1
- Initial Release
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_WPH_ASC_UPGRADE.html">Waypoint Here</a></td>
                    <td>yes</td>
                    <td align="right">25000</td>
                    <td align="center">10+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. 
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/waypoint_here_eq.js</td>
                    <td><pre>&quot;use strict&quot;;
this.author			= &quot;Neelix&quot;; 
this.copyright		= &quot;Â© 2014 Neelix.&quot;; 
this.licence		= &quot;CC-BY-NC-SA 4.0&quot;;
this.name			= &quot;tlxn_waypointHere_eq&quot;;
this.description	= &quot;Waypoint Here Equipment Script&quot;;

// setup internal waypoint identifiers
this.$wph_waypoints = [
	{key: &quot;wph_alpha&quot;, wname: &quot;Waypoint Alpha&quot;, code: &quot;A&quot;, wpset: false},
	{key: &quot;wph_bravo&quot;, wname: &quot;Waypoint Bravo&quot;, code: &quot;B&quot;, wpset: false},
	{key: &quot;wph_charlie&quot;, wname: &quot;Waypoint Charlie&quot;, code: &quot;C&quot;, wpset: false},
	{key: &quot;wph_delta&quot;, wname: &quot;Waypoint Delta&quot;, code: &quot;D&quot;, wpset: false},
	{key: &quot;wph_echo&quot;, wname: &quot;Waypoint Echo&quot;, code: &quot;E&quot;, wpset: false},
	{key: &quot;wph_foxtrot&quot;, wname: &quot;Waypoint Foxtrot&quot;, code: &quot;F&quot;, wpset: false},
	{key: &quot;wph_golf&quot;, wname: &quot;Waypoint Golf&quot;, code: &quot;G&quot;, wpset: false},
	{key: &quot;wph_hotel&quot;, wname: &quot;Waypoint Hotel&quot;, code: &quot;H&quot;, wpset: false},
];


// Add waypoint at current location
this.activated = function() {
	var wph = worldScripts[&quot;tlxn_waypointHere_eq&quot;];
	// look for an unused waypoint identifier
	for (var i = 0; i &lt; wph.$wph_waypoints.length; i++) {
		if (!wph.$wph_waypoints[i].wpset) {
			//unused identifier found - use it and exit function
			system.setWaypoint(
				wph.$wph_waypoints[i].key, player.ship.position, player.ship.orientation,
				{size: 100, beaconCode: wph.$wph_waypoints[i].code, beaconLabel: wph.$wph_waypoints[i].wname}
			);
			wph.$wph_waypoints[i].wpset = true;
			player.consoleMessage(wph.$wph_waypoints[i].wname + &quot; set.&quot;, 5);
			worldScripts.Waypoint_Here_MFD.$updateWaypointMFD();
			return;
		}
	}
	//if we get this far then all waypoint identifiers are in use.
	player.consoleMessage(&quot;Waypoint Here Memory Full. Please clear a waypoint before attempting to set another&quot;,5);
}

// Clear waypoint currently selected on ASC
this.mode = function() {
	var $ct = player.ship.compassTarget;
	var $sw = system.waypoints;
	var wph = worldScripts[&quot;tlxn_waypointHere_eq&quot;];
	
	// check position of each waypoint against the postion of the compass target
	for (var i = 0; i &lt; wph.$wph_waypoints.length; i ++) {
		if ($ct &amp;&amp; $sw &amp;&amp; $sw[wph.$wph_waypoints[i].key] &amp;&amp; $ct.position.distanceTo($sw[wph.$wph_waypoints[i].key].position) == 0) {
			//match found - clear the waypoint and exit function
			system.setWaypoint(wph.$wph_waypoints[i].key);
			wph.$wph_waypoints[i].wpset = false;
			player.consoleMessage(wph.$wph_waypoints[i].wname + &quot; cleared&quot;,5);
			worldScripts.Waypoint_Here_MFD.$updateWaypointMFD();
			return;
		}
	}
	//if we get this far the compass target did not match one of our waypoints
	player.consoleMessage(&quot;No waypoint selected&quot;);
}

// reset waypoints on entering a new system
this.shipWillExitWitchspace = function() {
	var wph = worldScripts[&quot;tlxn_waypointHere_eq&quot;];
	for (var i = 0; i &lt; wph.$wph_waypoints.length; i ++) {
		if (wph.$wph_waypoints[i].wpset === true) {
			wph.$wph_waypoints[i].wpset = false;
		}
	}	
}

this.shipExitedWitchspace = function() {
	if (system.isInterstellarSpace === true &amp;&amp; player.ship.equipmentStatus(&quot;EQ_WPH_ASC_UPGRADE&quot;) === &quot;EQUIPMENT_OK&quot;) {
		// auto-deploy a waypoint at 0, 0, 0
		var wph = worldScripts[&quot;tlxn_waypointHere_eq&quot;];
		// always use the &quot;Alpha&quot; waypoint - it should always be free whenever we first arrive in a system
		system.setWaypoint(
			wph.$wph_waypoints[0].key, [0, 0, 0], player.ship.orientation,
			{size: 100, beaconCode: wph.$wph_waypoints[0].code, beaconLabel: wph.$wph_waypoints[0].wname}
		);
		wph.$wph_waypoints[0].wpset = true;
		worldScripts.Waypoint_Here_MFD.$updateWaypointMFD();
		player.consoleMessage(&quot;Auto-deploying waypoint for witchspace exit point&quot;, 5);
	}
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/waypoint_here_mfd.js</td>
                    <td><pre>&quot;use strict&quot;;
this.author			= &quot;phkb&quot;; 
this.copyright		= &quot;Â© 2017 phkb&quot;; 
this.licence		= &quot;CC-BY-NC-SA 4.0&quot;;
this.name			= &quot;Waypoint_Here_MFD&quot;;
this.description	= &quot;Waypoint Here MFD Script&quot;;

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function() {
	// add interface to HUD selector
	var h = worldScripts.hudselector;
	if (h) h.$HUDSelectorAddMFD(this.name, this.name);
	h = null;
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillLaunchFromStation = function(station) {
    // only start the waypoint timer if we have the equipment installed
    if (player.ship.equipmentStatus(&quot;EQ_WPH_ASC_UPGRADE&quot;) === &quot;EQUIPMENT_OK&quot;)
        this._updateWaypointMFD = new Timer(this, this.$updateWaypointMFD, 5, 0.5);
}

//-------------------------------------------------------------------------------------------------------------
this.shipDied = function(whom, why) {
	this.$stopTimer();
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillDockWithStation = function(station) {
    this.$stopTimer();
}

//-------------------------------------------------------------------------------------------------------------
this.$stopTimer = function() {
    if (this._updateWaypointMFD &amp;&amp; this._updateWaypointMFD.isRunning) this._updateWaypointMFD.stop();
}

//-------------------------------------------------------------------------------------------------------------
// updates the text of the damage report MFD
this.$updateWaypointMFD = function $updateWaypointMFD() {
    var p = player.ship;
    var output = &quot;SYSTEM WAYPOINTS:\n&quot;;
    var keys = [];
    if (system.waypoints) keys = Object.keys(system.waypoints);
    if (keys.length === 0) {
        output += &quot;\n  No waypoints set&quot;;
    } else {
        for (var i = 0; i &lt; keys.length; i++) {
            if (i &gt; 8) break;
			var wp = system.waypoints[keys[i]];
            output += this.$padTextRight(
				(p.compassTarget &amp;&amp; p.compassTarget == wp ? &quot;â¢&quot; : &quot;&quot;) + 
				(wp.beaconLabel !== &quot;&quot; ? wp.beaconLabel : &quot;(Unlabelled)&quot;), 
				(system.isInterstellarSpace === true ? 7.5 : 8.5)
				) +	(wp.position.distanceTo(p) / 1000).toFixed(1) + &quot;kms&quot;;
			// give the player some waypoint direction information in interstellar space
			// because the space compass doesn&#39;t work
			if (system.isInterstellarSpace === true &amp;&amp; p &amp;&amp; p.vectorForward) {
				var f_dev = p.vectorForward.angleTo(wp.position.subtract(p));
				var r_dev = p.vectorRight.angleTo(wp.position.subtract(p));
				var u_dev = p.vectorUp.angleTo(wp.position.subtract(p));
				var s = &quot;&quot;;
				// &gt; 1.56 means oppposite side (3.12 exact opposite)
				// so, f_dev &lt; 0.01, r_dev = 1.57, u_dev = 1.57  -- aligned
				if (f_dev &lt; 0.25) {
					if (f_dev &lt; 0.25) s = &quot;O&quot;;
					if (f_dev &lt; 0.12) s = &quot;o&quot;;
					if (f_dev &lt; 0.05) s = &quot;X&quot;;
				}
				if (f_dev &gt;= 0.25) {
					if (r_dev &gt; 1.69) {
						s += &quot;&lt;&quot;;
					}
					if (u_dev &lt; 1.45) {
						s += &quot;^&quot;;
					} else if(u_dev &gt; 1.69) {
						s += &quot;v&quot;;
					}
					if (r_dev &lt; 1.45) {
						s += &quot;&gt;&quot;;
					}
					if (f_dev &gt; 1.57) s+= &quot;A&quot;;
				}
				output += &quot;  &quot; + s;
			}
			output += &quot;\n&quot;;
        }
    }
	// set the text in the MFD
	p.setMultiFunctionText(this.name, output, false);
}

//-------------------------------------------------------------------------------------------------------------
// appends space to currentText to the specified length in &#39;em&#39;
this.$padTextRight = function(currentText, desiredLength, leftSwitch) {
	if (currentText == null) currentText = &quot;&quot;;
	var hairSpace = String.fromCharCode(31);
	var ellip = &quot;â¦&quot;;
	var currentLength = defaultFont.measureString(currentText.toString().replace(/%%/g, &quot;%&quot;));
	var hairSpaceLength = defaultFont.measureString(hairSpace);
	// calculate number needed to fill remaining length
	var padsNeeded = Math.floor((desiredLength - currentLength) / hairSpaceLength);
	if (padsNeeded &lt; 1)	{
		// text is too long for column, so start pulling characters off
		var tmp = currentText;
		do {
			tmp = tmp.substring(0, tmp.length - 2) + ellip;
			if (tmp == ellip) break;
		} while (defaultFont.measureString(tmp.replace(/%%/g, &quot;%&quot;)) &gt; desiredLength);
		currentLength = defaultFont.measureString(tmp);
		padsNeeded = Math.floor((desiredLength - currentLength) / hairSpaceLength);
		currentText = tmp;
	}
	// quick way of generating a repeated string of that number
	if (!leftSwitch || leftSwitch == false) {
		return currentText + new Array(padsNeeded).join(hairSpace);
	} else {
		return new Array(padsNeeded).join(hairSpace) + currentText;
	}
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
