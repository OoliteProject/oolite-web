<html>
    <head>
        <title>Expansion Combo F7 Layout</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Combo F7 Layout</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Conflict Expansions mismatch between OXP Manifest and Expansion Manager at character position 0068 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Moves all standard F7 data to the top of the screen. Modified to use with Sun Gear and SW Economy.</td>
                    <td>Moves all standard F7 data to the top of the screen. Modified to use with Sun Gear and SW Economy.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.stranger.ComboF7Layout</td>
                    <td>oolite.oxp.stranger.ComboF7Layout</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Combo F7 Layout</td>
                    <td>Combo F7 Layout</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Miscellaneous</td>
                    <td>Miscellaneous</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>stranger</td>
                    <td>stranger</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.1</td>
                    <td>0.1</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                            <li>oolite.oxp.phkb.CompressedF7Layout:0</li>
                            <li>oolite.oxp.phkb.SystemDataConfig:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.phkb.CompressedF7Layout:</li>
                            <li>oolite.oxp.phkb.SystemDataConfig:</li>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://aegidian.org/bb/viewtopic.php?f=4&amp;t=21330">http://aegidian.org/bb/viewtopic.php?f=4&amp;t=21330</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/4/4b/ComboF7Layout.oxz">https://wiki.alioth.net/img_auth.php/4/4b/ComboF7Layout.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1670032443</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Combo%20F7%20Layout'>http://wiki.alioth.net/index.php/Combo%20F7%20Layout</a></p>
        <h3>readme.txt</h3>
        <pre>Combo F7 Layout
By stranger

Overview
========
This OXP is providing customized F7 layout with removed blank spaces similar to Compressed F7 Layout (author phkb), but modified to display sun spectrum from Sun Gear instead Distant Suns. It also displays system economy according to modified SW Economy classification. Code is tightly based on phkb&#39;s Compressed G7 Layout and System Data Config.

Compatibility
=============

This OXP is declared as incompatible to Compressed G7 Layout and System Data Config due to similar functionality. Use original Compressed G7 Layout and System Data Config if you have no plans to install Sun Gear.

Aknowledgements
===============

phkb - for original code

License
=======
This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/

Version History
===============

Version 0.1	02.12.2022	Public release
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/combo_F7_layout.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;CompboF7Layout&quot;;
this.author      = &quot;phkb @ stranger&quot;;
this.copyright   = &quot;2022 stranger&quot;;
this.description = &quot;Moves all standard F7 data to the top of the screen. Tightly based on phkb&#39;s Compressed G7 Layout. Adopted to use with Sun Gear&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function()
    {

	var sd = worldScripts[&quot;oolite-system-data-config&quot;];
    sd.setSystemDataLine(1, &quot;[sysdata-eco]\t[economy_desc]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(2, &quot;[sysdata-govt]\t[government_desc]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(3, &quot;[sysdata-tl]\t[sysdata-tl-value]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(4, &quot;[sysdata-pop]\t[sysdata-pop-value]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(5, &quot;\t([inhabitants])&quot;, &quot;system&quot;);
    sd.setSystemDataLine(6, &quot;[sysdata-prod]\t[sysdata-prod-value]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(7, &quot;[sysdata-radius]\t[sysdata-radius-value]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(8, &quot;[sysdata-distance]\t[distanceInfo]&quot;, &quot;system&quot;);
    sd.resetSystemDataLine(9);
    sd.resetSystemDataLine(10);
    sd.resetSystemDataLine(11);
    sd.resetSystemDataLine(12);
    sd.resetSystemDataLine(13);
    sd.resetSystemDataLine(14);
    sd.resetSystemDataLine(15);
    sd.resetSystemDataLine(16);

	if (worldScripts[&quot;SunSpectralAnalyzer&quot;])
        {
		// we&#39;re overriding Sun Gear&#39;s guiScreenChanged so it doesn&#39;t add text to the bottom part of the F7 screen
		worldScripts[&quot;SunSpectralAnalyzer&quot;].$overrideGUI = worldScripts[&quot;SunSpectralAnalyzer&quot;].guiScreenChanged;
		delete worldScripts[&quot;SunSpectralAnalyzer&quot;].guiScreenChanged;
		// instead, we&#39;ll add a callback to do the update
		sd.addChangeCallback(this.name, &quot;$stars_updateData&quot;);
        }

	if (worldScripts[&quot;Explorers Club&quot;])
        {
		// we&#39;re overriding EC&#39;s guiScreenChanged so we can capture and ignore any change to GUI_SCREEN_SYSTEM_DATA
		worldScripts[&quot;Explorers Club&quot;].$ovr_guiScreenChanged = worldScripts[&quot;Explorers Club&quot;].guiScreenChanged;
		delete worldScripts[&quot;Explorers Club&quot;].guiScreenChanged;
		// we&#39;ll also add a callback to do the update
		sd.addChangeCallback(this.name, &quot;$explorersClub_updateData&quot;);
        }

    }

//-------------------------------------------------------------------------------------------------------------
this.guiScreenChanged = function(to, from) {
	// for anything other than GUI_SCREEN_SYSTEM_DATA fire EC&#39;s original guiScreenChanged event
	if (guiScreen !== &quot;GUI_SCREEN_SYSTEM_DATA&quot; &amp;&amp; worldScripts[&quot;Explorers Club&quot;]) worldScripts[&quot;Explorers Club&quot;].$ovr_guiScreenChanged(to, from);
}

//-------------------------------------------------------------------------------------------------------------
this.$explorersClub_updateData = function(ctype, to, from) {
	var ec = worldScripts[&quot;Explorers Club&quot;];
	var sd = worldScripts[&quot;oolite-system-data-config&quot;];
	// find the first free slot (or the one we&#39;re currently using)
	for (var i = 1; i &lt;= 16; i++) {
		if (sd.systemDataLineOwner(i) === &quot;&quot; || sd.systemDataLineOwner(i) === &quot;explorers_club&quot;) {
			// found it! now work out what system we&#39;re looking at
			var sysID = -1;
			if (ctype === &quot;guiScreenWillChange&quot;) {
				// for this event, we need to check out the infoSystem or targetSystem of the player ship
				var sysID = player.ship.targetSystem;
				if (player.ship.hasOwnProperty(&quot;infoSystem&quot;)) sysID = player.ship.infoSystem;
			} else {
				// for an infoSystemWillChange, the &quot;to&quot; property has the value we need
				sysID = to;
			}
			// make sure we have a valid system ID
			if (isNaN(sysID) === false &amp;&amp; sysID &gt;=0 &amp;&amp; sysID &lt;= 255) {
				// extract the correct text from missionText
				var text = &quot;&quot;;
				if (ec.$xc_record[galaxyNumber].indexOf(sysID) === -1) {
					text = expandMissionText(&quot;explorers_club_never_visited&quot;);
				} else if (player.ship.targetSystem === system.ID) {
					text = expandMissionText(&quot;explorers_club_here_now&quot;);
				} else {
					text = expandMissionText(&quot;explorers_club_already_visited&quot;);
				}
				// and update the data line
				sd.setSystemDataLine(i, text, &quot;explorers_club&quot;);
			} else {
				// if we have an invalid system ID, reset the line
				if (sd.systemDataLineOwner(i) === &quot;explorers_club&quot;) sd.resetSystemDataLine(i);
			}
			break;
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$stars_updateData = function(ctype, to, from) {
	var sd = worldScripts[&quot;oolite-system-data-config&quot;];
	// find the first free slot (or the one we&#39;re currently using)
	for (var i = 1; i &lt;= 16; i++) {
		if (sd.systemDataLineOwner(i) === &quot;&quot; || sd.systemDataLineOwner(i) === &quot;stars&quot;) {
			// found it! now work out what system we&#39;re looking at
			var sysID = -1;
			if (ctype === &quot;guiScreenWillChange&quot;) {
				// for this event, we need to check out the infoSystem or targetSystem of the player ship
				var sysID = player.ship.targetSystem;
				if (player.ship.hasOwnProperty(&quot;infoSystem&quot;)) sysID = player.ship.infoSystem;
			} else {
				// for an infoSystemWillChange, the &quot;to&quot; property has the value we need
				sysID = to;
			}
			// make sure we have a valid system ID
			if (isNaN(sysID) === false &amp;&amp; sysID &gt;=0 &amp;&amp; sysID &lt;= 255) {
				// and update the data line
				sd.setSystemDataLine(i, this.$starInfo(sysID), &quot;stars&quot;);
			} else {
				// if we have an invalid system ID, reset the line
				if (sd.systemDataLineOwner(i) === &quot;stars&quot;) sd.resetSystemDataLine(i);
			}
			break;
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
// slightly modified from Sun Gear&#39;s original code
this.$starInfo = function(sysID)
    {
	var info = System.infoForSystem(galaxyNumber, sysID);
	if (info.sun_gone_nova) return &quot;&quot;;

    var w = worldScripts.AstroLibrary;
    var name = info.name;
    var sunName = info.sun_name;
    var sunRadius = info.sun_radius;
    var spectrumText = w.$astroLib_sunSpectrum(sunRadius);
    var text = &quot;&quot;;

    if (spectrumText &amp;&amp; sunName) text += &quot;The planet &quot; + name + &quot; orbits the &quot; + spectrumText + &quot; &quot; + sunName + &quot;.&quot;;
    else if (spectrumText) text += &quot;The planet &quot; + name + &quot; orbits a &quot; + spectrumText + &quot; &quot; + &quot;star.&quot;;
    else if (sunName) text += &quot;The planet &quot; + name + &quot; orbits the star &quot; + sunName + &quot;.&quot;;
	
	return text;
    }
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/oolite-system-data-config.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;oolite-system-data-config&quot;;
this.author      = &quot;phkb &amp; stranger&quot;;
this.copyright   = &quot;2022 stranger&quot;;
this.description = &quot;Provides an interface for configuring the layout of the System Data (F7) screen.&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;

// set up our configuration dictionary with the default settings
this._config = {
    1: {owner:&quot;system&quot;, text:&quot;[sysdata-eco]\t[economy_desc]&quot;},
    2: {owner:&quot;&quot;, text:&quot;&quot;},
    3: {owner:&quot;system&quot;, text:&quot;[sysdata-govt]\t[government_desc]&quot;},
    4: {owner:&quot;&quot;, text:&quot;&quot;},
    5: {owner:&quot;system&quot;, text:&quot;[sysdata-tl]\t[sysdata-tl-value]&quot;},
    6: {owner:&quot;&quot;, text:&quot;&quot;},
    7: {owner:&quot;system&quot;, text:&quot;[sysdata-pop]\t[sysdata-pop-value]&quot;},
    8: {owner:&quot;system&quot;, text:&quot;\t([inhabitants])&quot;},
    9: {owner:&quot;&quot;, text:&quot;&quot;},
    10: {owner:&quot;system&quot;, text:&quot;[sysdata-prod]\t\t[sysdata-prod-value]&quot;},
    11: {owner:&quot;&quot;, text:&quot;&quot;},
    12: {owner:&quot;system&quot;, text:&quot;[sysdata-radius]\t\t[sysdata-radius-value]&quot;},
    13: {owner:&quot;&quot;, text:&quot;&quot;},
    14: {owner:&quot;system&quot;, text:&quot;[sysdata-distance]\t[distanceInfo]&quot;},
    15: {owner:&quot;&quot;, text:&quot;&quot;},
    16: {owner:&quot;&quot;, text:&quot;&quot;},
};

this._governmentList = [&quot;Anarchy&quot;,&quot;Feudal&quot;,&quot;Multi-Government&quot;,&quot;Dictatorship&quot;,&quot;Communist&quot;,&quot;Confederacy&quot;,
    &quot;Democracy&quot;,&quot;Corporate State&quot;];
this._economyList = [&quot;Extreme Industrial&quot;,&quot;Strong Industrial&quot;,&quot;Common Industrial&quot;,&quot;Mainly Industrial&quot;,
    &quot;Mainly Agricultural&quot;,&quot;Common Agricultural&quot;,&quot;Strong Agricultural&quot;,&quot;Extreme Agricultural&quot;];

this._callbacks = [];

//-------------------------------------------------------------------------------------------------------------
this.startUp = function() {
    this.$updateData();
}

//-------------------------------------------------------------------------------------------------------------
this.guiScreenWillChange = function(to, from) {
    if (to === &quot;GUI_SCREEN_SYSTEM_DATA&quot;) {
        this.$performCallbacks(&quot;guiScreenWillChange&quot;, to, from);
        this.$updateData();
    }
}

//-------------------------------------------------------------------------------------------------------------
this.infoSystemWillChange = function(to, from) {
    this.$performCallbacks(&quot;infoSystemWillChange&quot;, to, from);
    this.$updateData();
}

//-------------------------------------------------------------------------------------------------------------
// returns the current owner of a particular data line
this.systemDataLineOwner = function(ln) {
    if (isNaN(ln) || ln &lt; 1 || ln &gt; 16) {
        throw &quot;Invalid line number specified: &quot; + ln + &quot; - must be number between 1 and 16&quot;;
    }
    return this._config[ln].owner;
}

//-------------------------------------------------------------------------------------------------------------
// returns the current text of a particular data line
this.systemDataLineText = function(ln) {
    if (isNaN(ln) || ln &lt; 1 || ln &gt; 16) {
        throw &quot;Invalid line number specified: &quot; + ln + &quot; - must be number between 1 and 16&quot;;
    }
    return this._config[ln].text;
}

//-------------------------------------------------------------------------------------------------------------
// sets the text and optionally the owner of a particular data line
this.setSystemDataLine = function(ln, text, owner) {
    if (isNaN(ln) || ln &lt; 1 || ln &gt; 16) {
        throw &quot;Invalid line number specified: &quot; + ln + &quot; - must be number between 1 and 16&quot;;
    }
    if (owner) {
        // if we&#39;ve been passed an owner, update the whole entry
        this._config[ln] = {owner:owner, text:text};
    } else {
        // otherwise just update the text element
        this._config[ln].text = text;
    }
    this.$updateData(ln);
}

//-------------------------------------------------------------------------------------------------------------
// resets a particular data line to being blank with no owner
this.resetSystemDataLine = function(ln) {
    if (isNaN(ln) || ln &lt; 1 || ln &gt; 16) {
        throw &quot;Invalid line number specified: &quot; + ln + &quot; - must be number between 1 and 16&quot;;
    }
    this._config[ln] = {owner:&quot;&quot;, text:&quot;&quot;};
    this.$updateData(ln);
}

//-------------------------------------------------------------------------------------------------------------
// adds a worldscript/callback function name to the list of callbacks to execute whenever the information
// on the F7 screen is about to change
this.addChangeCallback = function(ws, cb) {
    var found = false;
    if (this._callbacks.length &gt; 0) {
        for (var i = 0; i &lt; this._callbacks.length; i++) {
            if (this._callbacks[i].worldScript === ws &amp;&amp; this._callbacks[i].callback === cb) {
                found = true;
                break;
            }
        }
    }
    if (found === false) {
        this._callbacks.push({worldScript:ws, callback:cb});
    }
}

//-------------------------------------------------------------------------------------------------------------
// removes a worldscript/callback function name from the list of callbacks
this.removeChangeCallback = function(ws, cb) {
    for (var i = this._callbacks.length - 1; i &gt;= 0; i--) {
        if (this._callbacks[i].worldScript === ws &amp;&amp; this._callbacks[i].callback === cb) {
            this._callbacks.splice(i, 1);
            break;
        }
    }
}

//-------------------------------------------------------------------------------------------------------------
// executes all the callbacks
this.$performCallbacks = function(c_type, to, from) {
    if (this._callbacks.length &gt; 0) {
        for (var i = 0; i &lt; this._callbacks.length; i++) {
            worldScripts[this._callbacks[i].worldScript][this._callbacks[i].callback](c_type, to, from);
        }
    }
}

//-------------------------------------------------------------------------------------------------------------
// updats the data for all lines (if no line number is passed) or for a specific line
this.$updateData = function(ln) {
    // if we&#39;ve been passed a line number, just update that line
    var data = this.$getSystemData(player.ship.infoSystem);
    if (ln) {
        missionVariables[&quot;oolite_sysdata_line_&quot; + ln] = expandDescription(this._config[ln].text, data);
        return;
    }
    // otherwise update all the lines with the latest config
    for (var i = 1; i &lt;= 16; i++) {
        missionVariables[&quot;oolite_sysdata_line_&quot; + i] = expandDescription(this._config[i].text, data);
    }
}

//-------------------------------------------------------------------------------------------------------------
// returns a dictionary object containing the details of a particular system
this.$getSystemData = function(sysID) {
    var sys = System.infoForSystem(galaxyNumber, sysID);
    var rt = system.info.routeToSystem(sys, player.ship.routeMode);
    var data = {};
    if (sys.sun_gone_nova) {
        data[&quot;economy_desc&quot;] = expandDescription(&quot;[nova-system-economy]&quot;);
        data[&quot;government_desc&quot;] = expandDescription(&quot;[nova-system-government]&quot;);;
        data[&quot;sysdata-tl-value&quot;] = 0;
        data[&quot;population&quot;] = 0;
        data[&quot;inhabitants&quot;] = expandDescription(&quot;[nova-system-inhabitants]&quot;);
        data[&quot;productivity&quot;] = 0;
        data[&quot;radius&quot;] = 0;
    } else {
        data[&quot;economy_desc&quot;] = this._economyList[sys.economy];
        data[&quot;government_desc&quot;] = this._governmentList[sys.government];
        data[&quot;sysdata-tl-value&quot;] = sys.techlevel + 1;
        data[&quot;population&quot;] = sys.population;
        data[&quot;inhabitants&quot;] = sys.inhabitants;
        data[&quot;productivity&quot;] = sys.productivity;
        data[&quot;radius&quot;] = sys.radius;
    } 
    if (rt) {
        data[&quot;distanceInfo&quot;] = rt.distance.toFixed(1) + &quot; LY / &quot; + 
            rt.time.toFixed(1) + &quot; &quot; + (rt.time &gt; 0.95 &amp;&amp; rt.time &lt; 1.05 ? expandDescription(&quot;[sysdata-route-hours%0]&quot;) : expandDescription(&quot;[sysdata-route-hours%1]&quot;))  + &quot; / &quot; + 
            (rt.route.length - 1) + &quot; &quot; + (rt.route.length === 2 ? expandDescription(&quot;[sysdata-route-jumps%0]&quot;) : expandDescription(&quot;[sysdata-route-jumps%1]&quot;));
    } else {
        data[&quot;distanceInfo&quot;] = system.info.distanceToSystem(sys).toFixed(1) + &quot; LY&quot;;
    }
    return data;
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
