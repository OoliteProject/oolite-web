<html>
    <head>
        <title>Expansion Maintenance Tune Up</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Maintenance Tune Up</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Provides the ability to do a maintenance tune up, even when the normal overhaul is not available.</td>
                    <td>Provides the ability to do a maintenance tune up, even when the normal overhaul is not available.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.phkb.MaintenanceTuneUp</td>
                    <td>oolite.oxp.phkb.MaintenanceTuneUp</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Maintenance Tune Up</td>
                    <td>Maintenance Tune Up</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>phkb</td>
                    <td>phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.4</td>
                    <td>0.4</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/8/80/MaintenanceTuneUp.oxz">https://wiki.alioth.net/img_auth.php/8/80/MaintenanceTuneUp.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1656910538</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Maintenance%20Tune%20Up'>http://wiki.alioth.net/index.php/Maintenance%20Tune%20Up</a></p>
        <h3>readme.txt</h3>
        <pre>Maintenance Tune Up
By Nick Rogers

Overview
========
This OXP provides the facility for pilots to further tune up their ships, getting closer to brand-new performance. A tune up will only be offered at the same stations a maintenance overhaul is offered, and similar rules will apply (that is, you&#39;ll get a better tune up at higher tech level systems).

Operations
==========
The &quot;Maintenance Tune Up&quot; will be offered if the tech level of the system is high enough (ie. TL7 or greater). If an overhaul is currently due, the tune up will not be offered, although once the overhaul is performed, you may have an additional opportunity to purchase the tune up.

License
=======
This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/

Version History
===============
0.4
- Turned off debug flag to reduce messages in log file.

0.3
- Tune Up will now generate a maintenance-related email if the Email System is installed.
- Code refactoring.

0.2
- Correction to the minimum cost check.
- Reset variables after overhaul to ensure tune up will reappear.

0.1
- Initial release.</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_MAINTENANCE_TUNEUP.html">Maintenance Tune Up</a></td>
                    <td>no</td>
                    <td align="right">1000</td>
                    <td align="center">7+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name					= &quot;MaintenanceTuneUp_Core&quot;;
this.author					= &quot;phkb&quot;;
this.copyright              = &quot;2019 phkb&quot;;
this.description			= &quot;Core operational script for Maintenance Tune Up&quot;;
this.licence                = &quot;CC BY-NC-SA 4.0&quot;;

this._storedServiceLevel = 0;
this._storedTechLevel = 0;
this._debug = false;
this._cost = 0;

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function() {
    if (!missionVariables.MaintenanceTuneUp_SL) missionVariables.MaintenanceTuneUp_SL = 0;
    if (!missionVariables.MaintenanceTuneUp_TL) missionVariables.MaintenanceTuneUp_TL = 0;
    this._storedServiceLevel = missionVariables.MaintenanceTuneUp_SL;
    this._storedTechLevel = missionVariables.MaintenanceTuneUp_TL;

    if (worldScripts.GalCopAdminServices) {
        var ga = worldScripts.GalCopAdminServices;
        ga._purchase_ignore_equip.push(&quot;EQ_MAINTENANCE_TUNEUP&quot;); // don&#39;t sent a normal purchase email for this one
    }
}

//-------------------------------------------------------------------------------------------------------------
this.shipDockedWithStation = function(station) {
    if (this._debug) log(this.name, &quot;Servicelevel when docking = &quot; + player.ship.serviceLevel);
    if (this._debug) log(this.name, &quot;Station TL = &quot; + (station.equivalentTechLevel + 1));
}

//-------------------------------------------------------------------------------------------------------------
this.guiScreenChanged = function(to, from) {
    if (to === &quot;GUI_SCREEN_EQUIP_SHIP&quot;) {
        this._cost = player.ship.renovationCost;
    }
}

//-------------------------------------------------------------------------------------------------------------
this.playerBoughtEquipment = function(equipment) {
    if (equipment === &quot;EQ_RENOVATION&quot;) {
        if (this._debug) log(this.name, &quot;Servicelevel after overhaul = &quot; + player.ship.serviceLevel);
        if (this._debug) log(this.name, &quot;Station TL = &quot; + (player.ship.dockedStation.equivalentTechLevel + 1));
        // reset tune up observation variables
        this._storedServiceLevel = 0;
        this._storedTechLevel = 0;
    }
    if (equipment === &quot;EQ_MAINTENANCE_TUNEUP&quot;) {
        // normal service level range is 75-84
        // calc for addition to service level is 5 + techLevel (of station or system, whichever applies)
        // worst service level is 75, best tech level is 14, lowest tech level is 6

        // in best scenario, for a normal renovation, the player would get back to a service level of 103 (84 + 19) but reduced to max 100.
        // in worst scenario, the player would get back to a service level of 86 (75 + 11)

        // so, if the player has servicelevel of 93, best would be +7, worst reno would be +1
        // if player has a servicelevel of 85, best would be +15, worst would be +1
        var diff = Math.floor((100 - player.ship.serviceLevel) * ((player.ship.dockedStation.equivalentTechLevel + 1) / 15));
        if (diff &lt; 1) diff = 1;
        player.ship.serviceLevel += diff;
        this._storedServiceLevel = player.ship.serviceLevel;
        this._storedTechLevel = player.ship.dockedStation.equivalentTechLevel;
        player.ship.removeEquipment(&quot;EQ_MAINTENANCE_TUNEUP&quot;);

        if (worldScripts.GalCopAdminServices) {
            var ga = worldScripts.GalCopAdminServices;
            ga._maintCost = this._cost / 10;
            ga.$setupRepNames();
            ga.$sendMaintenanceEmail();
        }
    }
}

//-------------------------------------------------------------------------------------------------------------
this.playerWillSaveGame = function() {
    missionVariables.MaintenanceTuneUp_SL = this._storedServiceLevel;
    missionVariables.MaintenanceTuneUp_TL = this._storedTechLevel;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/maintenance_tuneup_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name					= &quot;MaintenanceTuneUp_Conditions&quot;;
this.author					= &quot;phkb&quot;;
this.copyright              = &quot;2019 phkb&quot;;
this.description			= &quot;Condition script for Maintenance Tune Up&quot;;
this.licence                = &quot;CC BY-NC-SA 4.0&quot;;

//-------------------------------------------------------------------------------------------------------------
this.allowAwardEquipment = function(equipment, ship, context) {
    if (context === &quot;scripted&quot;) return true;
    if (equipment === &quot;EQ_MAINTENANCE_TUNEUP&quot;) {
        if (ship.canAwardEquipment(&quot;EQ_RENOVATION&quot;) == true) return false;
        if (ship.serviceLevel &gt;= 98) return false;
        var mtu = worldScripts.MaintenanceTuneUp_Core;
        var p = player.ship;
        if (p.serviceLevel.toFixed(0) == mtu._storedServiceLevel.toFixed(0) &amp;&amp; p.dockedStation.equivalentTechLevel &lt;= mtu._storedTechLevel) {
            return false;
        }
    
        return true;
    }
    return false;
}

//-------------------------------------------------------------------------------------------------------------
this.updateEquipmentPrice = function(equipment, price) {
    var newprice = price;
    var p = player.ship;
    if (equipment === &quot;EQ_MAINTENANCE_TUNEUP&quot;) {
        newprice = p.renovationCost;
        if (newprice &lt; 10000) newprice = 10000; // set a minimum price
    }
    return newprice;
}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
