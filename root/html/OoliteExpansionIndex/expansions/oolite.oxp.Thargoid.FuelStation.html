<html>
    <head>
        <title>Expansion Fuel Station</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Fuel Station</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">3 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">3 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER A)(&#39;[]&#39; vs &#39;[activities, system]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>For the Commander on the go, fly-thru witchpoint and route 1 fuel stations and fuel satellites.</td>
                    <td>For the Commander on the go, fly-thru witchpoint and route 1 fuel stations and fuel satellites.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.FuelStation</td>
                    <td>oolite.oxp.Thargoid.FuelStation</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Fuel Station</td>
                    <td>Fuel Station</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Activities</td>
                    <td>Activities</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid, gsagostinho</td>
                    <td>Thargoid, gsagostinho</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.2</td>
                    <td>2.2</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>activities, system</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Fuel_Station_OXP">http://wiki.alioth.net/index.php/Fuel_Station_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/7/7d/Oolite.oxp.Thargoid.FuelStation.oxz">https://wiki.alioth.net/img_auth.php/7/7d/Oolite.oxp.Thargoid.FuelStation.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873345</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Fuel%20Station'>http://wiki.alioth.net/index.php/Fuel%20Station</a></p>
        <h3>Fuel Station  v2.2 ReadMe.txt</h3>
        <pre>Fuel Station OXP by Thargoid, Eric Walch and gsagostinho.

For the hurried Commander on the go! No time to dock, just want to grab some fuel and run, then this is the place for you...

To grab some fuel, just fly into the yellow glow in the centre of the station (or approach the fuel satellite which sometimes are used in place of a station) and come to a halt. Your ship will notify you when transfer begins and when your tank is full (and if you run out of cash during the transfer, sorry no credit will be given to broke Commanders). Then just fly on out, check your summary receipt and carry on with your journey.

Stations are limited to tech levels of 4 and above and will not appear in Anarchy or Feudal systems. Not every system has them, but some have at both the witchpoint and half-way between the witchpoint and the main planet to fill-up on Route One (see below for update on this). To find one quickly just look for the fuel station logo on the ASC.

Oh and these stations are solidly built, but aren&#39;t designed for big ships (no Dredgers!). And Galcop don&#39;t take too kindly to acts of vandalism on them...

Requires Oolite v1.74 or later - will not work with any lower version

--------------------------------------------------------------

Update - Spawning Locations and Frequency:

With v1.33 and later of the OXP there is now built-in the option of whether to have the stations spawned in their default locations (randomly near the witchpoint and half-way along route 1) or in fixed place (at the edge of the scanner range on the far side of the witchpoint only). 

To change from the default original to the fixed, simply open up the file &quot;fuelStation_stationSetup.js&quot; in a text editor (not notepad under Windows!) and change &quot;this.positionOverride = false&quot; in line 11 to &quot;this.positionOverride = true&quot;. Then restart the game with the shift-key held down until the spinning Cobra Mk III appears. 

To revert to the default just change the line back to false and repeat the shift-restart procedure.

The v1.33 also now includes pseudo-random spawning, so if the stations appear in a system then they should always do so (except for when the long way around mission is running).

--------------------------------------------------------------

License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement.
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)

--------------------------------------------------------------

Instructions:

Unzip the file, and then move the folder &quot;Fuel Station 1.36.oxp&quot; to the AddOns directory of your Oolite installation. Then start the game up whilst holding down the shift key (until the spinning Cobra Mk III screen appears) and the stations will appear in appropriate systems.

--------------------------------------------------------------

Version History:

10/02/2009 - Version 1.00, Initial release.
11/02/2009 - Version 1.01, set-up script tweak:
	* no stations in Nova systems (to prevent interference with Nova mission)
	* less chance (1 in 5 : 1 in 10 halfway : witchpoint) when the longwayround mission is active.
	* raise the price from 2cr/ly to 3cr/ly
16/02/2009 - Version 1.10, added the fuel satellite at a 1 in 3 chance where a fuel station could be, for ships which can&#39;t fly through the stations
19/02/2009 - Version 1.11, bugfix for situation where player jumps when within range of a satellite into system without one. Prevents system crash occurring.
20/07/2009 - Version 1.12, NPC traders using the fuel stations, plus 1.73 compatability.
27/08/2009 - Version 1.2, fuel satellite script upgrade for 1.73 compatibility, plus AI/script adjustment to stop NPCs using station if player is there.
03/09/2009 - Version 1.21, OXPConfig additions for turretted ships.
08/09/2009 - Version 1.22, bugfix for NPC scripting.
12/09/2009 - Version 1.23, bugfix to prevent spawning of stations and satellites in systems that have gone nova.
24/03/2010 - Version 1.30, update for 1.74 - will not run on lower versions.
19/06/2010 - Version 1.31, remove testing code left in by mistake
13/02/2011 - Version 1.32, removal of upper limit, to allow running with 1.75
23/08/2011 - Version 1.33, script tidy-up and merging, plus a little extra checking included after some log error reports.
24/01/2012 - Version 1.34, fix for the compass icon (again) - thanks to Makara for the heads-up.
05/02/2013 - Version 1.35, update for compatibility with OXPConfig.
25/09/2013 - Version 1.36, added compatibility with variable fuel pricing, plus new colour schemes and messages. 
30/07/2017 - Version 2.0, new textures including normal maps (by gsagostinho)
01/08/2017 - Version 2.1, small improvement to the 3D model (by gsagostinho)
20/08/2017 - Version 2.2, improvement to light reflection on satellite surfaces (by gsagostinho)

--------------------------------------------------------------

Acknowledgements:

With thanks to laxori666 for the thoughts on the variable fuel pricing for v1.36
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/fuelStation_burningFuel.html">Burning quirium fuel</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/fuelStation_satellite.html">Fuel Satellite</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/fuelStation_station.html">Fuel Station</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/fuelStation_satellite.js</td>
                    <td><pre>this.name					= &quot;FuelSatellite&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Script for fuel satellite&quot;;
this.version				= &quot;2.02&quot;;

this.shipSpawned = function()
	{ //  line the station up with the route one. Code borrowed from Anarchies for convenience.
	this.ship.scannerDisplayColor1 = &quot;greenColor&quot;;
	this.ship.scannerDisplayColor2 = &quot;darkGrayColor&quot;;

	if(system.isInterstellarSpace || !system.mainPlanet) {return;}
	var targetVector = system.mainPlanet.position.subtract(this.ship.position).direction()
	var angle = this.ship.heading.angleTo(targetVector)
	var cross = this.ship.heading.cross(targetVector).direction()
	this.ship.orientation = this.ship.orientation.rotate(cross, -angle);
	// this.setColour();
	this.setPrice();
	}

//this.setColour = function()
//	{
//	this.colRand = system.scrambledPseudoRandomNumber(45.32)
//	colName = &quot;yellowColor&quot;;
//	if(this.colRand &lt; 0.25) { colName = &quot;blueColor&quot;; }
//	if(this.colRand &lt; 0.75) { colName = &quot;redColor&quot;; }
//	if(this.colRand &gt; 0.25 &amp;&amp; this.colRand &lt; 0.5) { colName = &quot;magentaColor&quot;; }
//	this.ship.setMaterials({&quot;fuelStation_satellite.png&quot;: { diffuse: colName }});
//	}	
	
this.setPrice = function()	
	{
	this.fuelPrice = 0.15 * EquipmentInfo.infoForKey(&quot;EQ_FUEL&quot;).price * player.ship.fuelChargeRate; // price per 0.1LY of fuel
	if(system.economy === 0 || system.economy === 5) { this.fuelPrice *= 1.2; } //  rich industrial or agricultural
	if(system.techLevel &gt; 4 &amp;&amp; system.techLevel &lt; 11) { this.fuelPrice *= 1.1; } //  mid-tech level
	this.fuelPrice = this.decPlaces(this.fuelPrice,2);
	}

this.decPlaces = function(number, places)
	{
	if(!places || places &lt; 0) {places = 0;}
	if(!number) {return 0;}
	return ((Math.round(number * Math.pow(10,places))) / Math.pow(10,places));
	}
		
this.playerDetected = function()
	{
	this.firstMessage = true;
	this.secondMessage = true;
	this.thirdMessage = true;
	this.fuelTransferred = 0; // how many 0.1LY units are transferred
	this.fuelBill = 0;
	this.ship.commsMessage(&quot;Greetings Commander &quot; + player.name + &quot;. Refuel here for only &quot; + this.decPlaces((10 * this.fuelPrice),1) + &quot; credits per ly&quot;);
	if(this.scanTimer)
		{
		this.scanTimer.start();
		}
	else
		{
		this.scanTimer = new Timer(this, this.locatePlayer, 0, 0.50);
		}
	}

this.locatePlayer = function()
	{
	if(!this.ship || !this.ship.isValid || !this.ship.position || !player.ship.isValid) // if the ship no longer exists but timer is running, e.g. if player has jumped whilst near a satellite into a system without one
		{
		this.playerGone();
		return;
		}

	if(this.ship.position.distanceTo(player.ship.position) &lt; 150) // player ship within 150m of the centre of the satellite
		{
		if(player.ship.fuel &lt; 7)
			{
			if(player.credits &gt; this.fuelBill)
				{ // player in place, fuel tank not full and credit balance not empty
				player.ship.fuel += 0.1;
				this.fuelBill += this.fuelPrice;
				this.fuelTransferred++;

				if(this.firstMessage)
					{
					player.consoleMessage(&quot;Fuel transfer is underway, please come to a halt.&quot;, 6);
					this.firstMessage = false;
					}
				return;
				}
			else
				{ // not enough funds left
				if(this.secondMessage)
					{
					player.consoleMessage(&quot;Insufficient credits remaining for further transfer.&quot;, 6);
					this.secondMessage = false;
					}
				return;
				}
			}
		else
			{ // Fuel tank full
			if(this.thirdMessage)
				{
				player.consoleMessage(&quot;Fuel tanks are full.&quot;, 6);
				this.thirdMessage = false;
				}
			return;
			
			}
		}
	else
		{
		if(this.fuelTransferred &gt; 0)
			{
			this.fuelBill = this.decPlaces(this.fuelPrice * this.fuelTransferred,1);
			player.consoleMessage(&quot;Summary - &quot; + (this.fuelTransferred / 10) + &quot; ly transferred, &quot; + this.fuelBill + &quot; credits charged.&quot;, 6);
			player.credits -= this.fuelBill;
			this.fuelTransferred = 0;
			this.fuelBill = 0;
			this.firstMessage = true;
			this.secondMessage = true;
			this.thirdMessage = true;
			}
		}
	}

this.playerWillEnterWitchspace = this.playerGone = function()
	{
	if(this.scanTimer)
		{
		this.scanTimer.stop();
		delete this.scanTimer;
		}
	}

this.shipDied = function(whom, why) 
	{
	this.playerGone();
	this.fuelCount = (Math.ceil(Math.random() * 30) + 30);
	this.ship.spawn(&quot;fuelStation_burningFuel&quot;, this.fuelCount); // lets make this go with a bang!

	if(whom &amp;&amp; whom.isPlayer)
		{
		player.consoleMessage(&quot;CCTV beam towards the main station detected.&quot;, 6);
		player.score -=1; // don&#39;t condone vandalism!
		player.bounty += 20;
		}
	}
	
this.attackedMessage = function()
	{
	this.ship.commsMessage(&quot;ALERT - fuel satellite under attack, explosion danger!&quot;);
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/fuelStation_station.js</td>
                    <td><pre>this.name					= &quot;FuelStation&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Script for fuel station&quot;;
this.version				= &quot;2.02&quot;;

this.shipSpawned = function()
	{ 
	this.ship.scannerDisplayColor1 = &quot;greenColor&quot;;
	this.ship.scannerDisplayColor2 = &quot;lightGrayColor&quot;;

	var traders = system.shipsWithPrimaryRole(&quot;trader&quot;, this.ship, 50E3)	
	if(traders.length &gt; 0 &amp;&amp; worldScripts[&quot;FuelStation-Setup&quot;].extraB &amp;&amp; traders[0].AIState == &quot;HEAD_FOR_PLANET&quot;) 
		{
		traders[0].script.checkFuelStationDistance = this.checkFuelStationDistance; // attach function to script.
		traders[0].script.checkUsage = this.checkUsage; // attach function to script.
		traders[0].setAI(&quot;fuelStation_gotoFuelStationAI.plist&quot;);
		}
		
	//  line the station up with the route one. Code borrowed from Anarchies for convenience.
	if(system.isInterstellarSpace || !system.mainPlanet) {return;}
	var targetVector = system.mainPlanet.position.subtract(this.ship.position).direction();
	var angle = this.ship.heading.angleTo(targetVector);
	var cross = this.ship.heading.cross(targetVector).direction();
	this.ship.orientation = this.ship.orientation.rotate(cross, -angle);	
//	this.setColour();
	this.setPrice();
	}

//this.setColour = function()
//	{
//	this.colRand = system.scrambledPseudoRandomNumber(45.32)
//	colName = &quot;yellowColor&quot;;
//	if(this.colRand &lt; 0.25) { colName = &quot;blueColor&quot;; }
//	if(this.colRand &lt; 0.75) { colName = &quot;redColor&quot;; }
//	if(this.colRand &gt; 0.25 &amp;&amp; this.colRand &lt; 0.5) { colName = &quot;magentaColor&quot;; }
//	this.ship.setMaterials({&quot;fuelStation_station.png&quot;: { diffuse: colName }});
//	}
	
this.setPrice = function()	
	{
	this.fuelPrice = 0.15 * EquipmentInfo.infoForKey(&quot;EQ_FUEL&quot;).price * player.ship.fuelChargeRate; // price per 0.1LY of fuel
	if(system.economy === 0 || system.economy === 5) { this.fuelPrice *= 1.2; } //  rich industrial or agricultural
	if(system.techLevel &gt; 4 &amp;&amp; system.techLevel &lt; 11) { this.fuelPrice *= 1.1; } //  mid-tech level
	this.fuelPrice = this.decPlaces(this.fuelPrice,2);
	}	

this.decPlaces = function(number, places)
	{
	if(!places || places &lt; 0) {places = 0;}
	if(!number) {return 0;}
	return ((Math.round(number * Math.pow(10,places))) / Math.pow(10,places));
	}
	
this.playerDetected = function()
	{
	this.firstMessage = true;
	this.fuelTransferred = 0; // how many 0.1LY units are transferred
	this.fuelBill = 0;
	this.ship.commsMessage(&quot;Greetings Commander &quot; + player.name + &quot;. Refuel here for only &quot; + this.decPlaces((10 * this.fuelPrice),1) + &quot; credits per ly&quot;);
	if(this.scanTimer)
		{
		this.scanTimer.start();
		}
	else
		{
		this.scanTimer = new Timer(this, this.locatePlayer, 0, 0.50);
		}
	}

this.locatePlayer = function()
	{
	if(!this.ship ||!this.ship.isValid || !this.ship.position || !player.ship.isValid) // if the ship no longer exists but timer is running, e.g. if player has jumped whilst near a satellite into a system without one
		{
		this.playerGone();
		return;
		}

	if(this.ship.position.distanceTo(player.ship.position) &lt; 150) // player ship within 150m of the centre of the fuel station
		{
		if(player.ship.fuel &lt; 7)
			{
			if(player.credits &gt; this.fuelBill)
				{ // player in place, fuel tank not full and credit balance not empty
				player.ship.fuel += 0.1;
				this.fuelBill += this.fuelPrice;
				this.fuelTransferred++;

				if(this.firstMessage)
					{
					player.consoleMessage(&quot;Fuel transfer is underway, please come to a halt.&quot;, 6);
					this.firstMessage = false;
					}
				return;
				}
			else
				{ // not enough funds left
				player.consoleMessage(&quot;Insufficient credits remaining, transfer terminated.&quot;, 6);
				this.scanTimer.stop();
				return;
				}
			}
		else
			{ // Fuel tank full
			player.consoleMessage(&quot;Fuel tanks are full.&quot;, 6);
			this.scanTimer.stop();
			return;
			
			}
		}
	}

this.shipTraversePositiveZ = this.shipTraverseNegativeZ = function(ship)
	{
	if(ship.isPlayer) this.playerLeaving()
	}

this.playerLeaving = function()
	{
	this.fuelBill = this.decPlaces(this.fuelPrice * this.fuelTransferred,1);
	player.consoleMessage(&quot;Summary - &quot; + (this.fuelTransferred / 10) + &quot; ly transferred, &quot; + this.fuelBill + &quot; credits charged.&quot;, 6);
	player.credits -= this.fuelBill;
	this.fuelTransferred = 0;
	this.fuelBill = 0;
	this.firstMessage = true;
	}
    
this.playerWillEnterWitchspace = this.playerGone = function()
	{
	if(this.scanTimer)
		{
		this.scanTimer.stop();
		delete this.scanTimer;
		}
	}

this.shipDied = function(whom, why) 
	{
	this.playerGone();
	this.fuelCount = (Math.ceil(Math.random() * 30) + 30);
	this.ship.spawn(&quot;fuelStation_burningFuel&quot;, this.fuelCount); // lets make this go with a bang!

	if(whom &amp;&amp; whom.isPlayer)
		{
		player.consoleMessage(&quot;CCTV beam towards the main station detected.&quot;, 6);
		player.score -=1; // don&#39;t condone vandalism!
		player.bounty += 20;
		}
	}
    

// below not used by stationscript but is attached to traderscript.
this.checkFuelStationDistance = function()
	{	
	if(this.ship.position.distanceTo(this.ship.target.position) &gt; 50E3)
		{
		this.ship.reactToAIMessage(&quot;NEXT_FUELSTATION&quot;)
		}
	}

this.checkUsage = function()
	{
	 if(this.ship.target.position.distanceTo(player.ship.position) &lt; 1000)
		{
		this.ship.reactToAIMessage(&quot;NEXT_FUELSTATION&quot;)
		}
	else
		{
		this.ship.reactToAIMessage(&quot;STATION_CLEAR&quot;)
		}
	}
	
this.attackedMessage = function()
	{
	this.ship.commsMessage(&quot;ALERT - fuel station under attack, explosion danger!&quot;);
	}	
	
this.collisionMessage = function()
	{
	this.ship.commsMessage(&quot;ALERT - proximity detection, please take evasive action&quot;);
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/fuelStation_stationSetup.js</td>
                    <td><pre>this.name					= &quot;FuelStation-Setup&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Script to add fuel station to certain systems&quot;;
this.version				= &quot;2.02&quot;;

this.extraA = true;	// for use with turretted ships - set to false to only get fuel satellites
this.extraB = true;	// if set to false, no NPCs will use the stations (if extraA is false, has no effect)
	
this.oxpcSettings = {
	Info: {Name:this.name,Display:this.name,InfoB:&quot;1 - If false only fuel satellites will appear.\n2 - If false NPCs will not use fuel stations (ignored if extraA is false).&quot;},
	Bool0: {Name:&quot;extraA&quot;,Def:true,Desc:&quot;Suppress fuel stations.&quot;},
	Bool1: {Name:&quot;extraB&quot;,Def:false,Desc:&quot;Allow NPCs to use fuel stations.&quot;}
};	

this.startUp = function()
	{
	this.positionOverride = false; // set this to true to use alternative station positioning at far side of witchpoint only.
	}

this.shipWillLaunchFromStation = function()
	{
	this.shipExitedWitchspace();
	delete this.shipWillLaunchFromStation;
	}
	
this.shipExitedWitchspace = function()
	{
	if(this.positionOverride === false)
		{ this.originalStationSetup(); }
	else
		{ this.witchpointStationSetup(); }
	}
	
this.witchpointStationSetup = function() // fixed station position on far side of witchpoint area.
	{
	if(system.isInterstellarSpace || system.sun.isGoingNova || system.sun.hasGoneNova || missionVariables.longwayround === &quot;STAGE1&quot; || missionVariables.longwayround === &quot;STAGE2&quot;) 
	// stop the script if interstellar space, or system is going Nova(to allow Nova mission unhindered) or indeed if it has gone nova already.
		{ return; }

	if(system.government &gt; 1 &amp;&amp; system.techLevel &gt; 3 &amp;&amp; system.countShipsWithRole(&quot;fuelStation_location&quot;) === 0)
		{
		if(this.extraA &amp;&amp; system.scrambledPseudoRandomNumber(19.7) &gt; 0.33)
			{ system.legacy_addShipsAt(&quot;fuelStation_station&quot;, 1, &quot;wpm&quot;, [0, 0, -24000]); }
		else
			{ system.legacy_addShipsAt(&quot;fuelStation_satellite&quot;, 1, &quot;wpm&quot;, [0, 0, -24000]); }
		}
	}	
	
this.originalStationSetup = function() // original locations, near witchpoint and on route 1.
	{
	if(system.isInterstellarSpace || system.sun.isGoingNova || system.sun.hasGoneNova) 
		{ // stop the script if interstellar space, or system is going Nova(to allow Nova mission unhindered) or indeed if it has gone nova already.
		return;
		}

	this.halfwayChance = 0.25; // 3 in 4 chance to add a station at the half-way point of route 1.
	this.witchpointChance = 0.33; // 2 in 3 chance to add a station near the witchpoint.

	if(missionVariables.longwayround === &quot;STAGE1&quot; || missionVariables.longwayround === &quot;STAGE2&quot;)
		{ // drastically reduce the chances if you&#39;re in the middle of Long Way Round mission
		this.halfwayChance = 0.9; // 1 in 10 chance to add a station at the half-way point of route 1.
		this.witchpointChance = 0.95; // 1 in 20 chance to add a station near the witchpoint.
		}

	if(system.government &gt; 1 &amp;&amp; system.techLevel &gt; 3 &amp;&amp; system.countShipsWithRole(&quot;fuelStation_location&quot;) === 0)
		{
		if(system.scrambledPseudoRandomNumber(13.7) &gt; this.witchpointChance)
			{
			if(this.extraA &amp;&amp; system.scrambledPseudoRandomNumber(17.4) &gt; 0.33)
				{
	 			system.legacy_addShipsAt(&quot;fuelStation_station&quot;, 1, &quot;pwu&quot;, [0.02, 0, 1]);
				}
			else
				{
	 			system.legacy_addShipsAt(&quot;fuelStation_satellite&quot;, 1, &quot;pwu&quot;, [0.02, 0, 1]);
				}
			}

		if(system.scrambledPseudoRandomNumber(25.3) &gt; this.halfwayChance)
			{
			if(this.extraA &amp;&amp; system.scrambledPseudoRandomNumber(24.1) &gt; 0.33)
				{
	 			system.legacy_addShipsAt(&quot;fuelStation_station&quot;, 1, &quot;pwu&quot;, [0.02, 0, 0.5]);
				}
			else
				{
	 			system.legacy_addShipsAt(&quot;fuelStation_satellite&quot;, 1, &quot;pwu&quot;, [0.02, 0, 0.5]);
				}
			}

		}
	}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
