<html>
    <head>
        <title>Expansion Energy Rebalance SCC</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Energy Rebalance SCC</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER S)(&#39;[]&#39; vs &#39;[shields, energy, damage]&#39;)</li>
                <li>Conflict Expansions mismatch between OXP Manifest and Expansion Manager at character position 0069 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>This OXP rebalances energy between shields and energy banks. If forward/aft shield level dropped below 25% of max capacity, energy from banks is transferred onto shield in question, preventing damage of equipment and cargo. Version compatible with Ship Configuration.</td>
                    <td>This OXP rebalances energy between shields and energy banks. If forward/aft shield level dropped below 25% of max capacity, energy from banks is transferred onto shield in question, preventing damage of equipment and cargo. Version compatible with Ship Configuration.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.stranger.EnergyRebalance_SCC</td>
                    <td>oolite.oxp.stranger.EnergyRebalance_SCC</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Energy Rebalance SCC</td>
                    <td>Energy Rebalance SCC</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>stranger &amp; phkb</td>
                    <td>stranger &amp; phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.2.0</td>
                    <td>0.2.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>shields, energy, damage</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.phkb.ShipConfiguration:1.2.3</li>
                    </td>
                    <td>
                            <li>oolite.oxp.phkb.ShipConfiguration:1.2.3</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                            <li>oolite.oxp.stranger.EnergyRebalance:0</li>
                            <li>oolite.oxp.Lone_Wolf.ShieldCycler:0</li>
                            <li>oolite.oxp.Lone_Wolf.ShieldCyclerNext:0</li>
                            <li>oolite.oxp.CommonSenseOTB.ShieldEqualizer+Capacitors:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.stranger.EnergyRebalance:</li>
                            <li>oolite.oxp.Lone_Wolf.ShieldCycler:</li>
                            <li>oolite.oxp.Lone_Wolf.ShieldCyclerNext:</li>
                            <li>oolite.oxp.CommonSenseOTB.ShieldEqualizer+Capacitors:</li>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://aegidian.org/bb/viewtopic.php?f=4&amp;t=19567">http://aegidian.org/bb/viewtopic.php?f=4&amp;t=19567</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/4/47/EnergyRebalance_SCC.oxz">https://wiki.alioth.net/img_auth.php/4/47/EnergyRebalance_SCC.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873289</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Energy%20Rebalance%20SCC'>http://wiki.alioth.net/index.php/Energy%20Rebalance%20SCC</a></p>
        <h3>ReadMe &amp; License.txt</h3>
        <pre>Energy Rebalance SCC (Ship Configuration Compatible) OXP by Stranger &amp; phkb

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license.
You are free to use and distribute this OXP on non-commercial basis. 
Rebundling of this OXP within another distribution is permitted as long as it is unchanged.
Any mods/derivatives of this OXP must be distributed under another names.
The license information (either as this file or merged into a larger one) must be included in the OXP.

--------------------------------------------------------------

This OXP rebalances energy between shields and energy banks. Then forward/aft shield level dropped below 25% of max capacity under fire, energy from banks is transferred directly onto shield in question until energy banks are drained under 64 units, preventing damage of equipment and cargo.
If energy level drops below critical 32 unit level, energy transfer switches back from remaining shields to energy bank.
Energy Rebalance looks as extremely simplified and fully automated &quot;lite&quot; version of Shield Cycler, but it is not equipment upgrade. It is redefined game mechanics.
Energy Rebalance SCC is version of original Energy Rebalance, adopted by phkb to provide compatibility with Ship Configuration.

Dependencies:

Energy Rebalance SCC OXP requires Ship Configuration (author phkb).

Conflicts:

Energy Rebalance OXP is incompatible with Shield Equaliser+Capacitors (author CommonSense OTB) and with Shield Cycler / Shield Cycler Next (author Lone_Wolf).

Credits:

Shield Cycler / Shield Cycler Next (Lone_Wolf) - clear formulation of problem with energy damage and working way for fixing it.
IronHide (Thargoid) - some code tricks (not included onto final code, but very helpful in testing of some ideas).

--------------------------------------------------------------

Version history:

28.04.2019 - Version 0.2.0	Added energy transfer from shields to depleted energy banks.
				Converted to OXZ 
12.04.2018 - Version 0.1	Reworked version based on original Energy Rebalance

</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/energy_rebalance_sc.js</td>
                    <td><pre>&quot;use strict&quot;;
// Standard attributes 
this.name           = &quot;Energy Rebalance SCC&quot;; 
this.author         = &quot;Stranger &amp; phkb&quot;; 
this.copyright      = &quot;Stranger&quot;;
this.licence        = &quot;Creative Commons Attribution - Non-Commercial - Share Alike 3.0&quot;;
this.version        = &quot;0.2&quot;; 
this.description    = &quot;Simple rebalance of default energy distribution between shields and energy banks. Version compatible with Ship Configuration.&quot;; 

// this part of original script from Energy Rebalance was modified by phkb to provide compatibility with Ship Configuration
this.shipLaunchedFromStation = function(station) 
    {
    if(worldScripts.ShipConfiguration_Core)
        {
        var sc = worldScripts.ShipConfiguration_Core;
        var p = player.ship;
        this.$aftShieldID = sc.$equipmentItemInUse(&quot;aftshields&quot;, p);
        this.$foreShieldID = sc.$equipmentItemInUse(&quot;frontshields&quot;, p);
        this.$energyUnitID = sc.$equipmentItemInUse(&quot;energy&quot;, p);
        }
    }
// original script
this.shipTakingDamage = function(amount, fromEntity, damageType)	
	{
    var p = player.ship;
    if(p.equipmentStatus(this.$energyUnitID) !== &quot;EQUIPMENT_OK&quot;) return; // needs breakable energy unit
    if(p.fuel == 0) return;   // fuel empty - shields switch to auxiliary battery
    if(p.energy &gt;= 64)      // transfer energy to shields
        {
        var aftShieldDelta;
        var foreShieldDelta;
        if(p.equipmentStatus(this.$aftShieldID) === &quot;EQUIPMENT_OK&quot; &amp;&amp; p.aftShield &lt; 0.25 * p.maxAftShield)
            {
            aftShieldDelta = 0.25 * p.maxAftShield - p.aftShield;
            if(aftShieldDelta &gt; 16)
                {
                aftShieldDelta = 16;
                }
            p.aftShield += aftShieldDelta;
            p.energy -= aftShieldDelta;
            }
        if(p.equipmentStatus(this.$foreShieldID) === &quot;EQUIPMENT_OK&quot; &amp;&amp; p.forwardShield &lt; 0.25 * p.maxForwardShield)
            {
            foreShieldDelta = 0.25 * p.maxForwardShield - p.forwardShield;
            if(foreShieldDelta &gt; 16)
                {
                foreShieldDelta = 16;
                }        
            p.forwardShield += foreShieldDelta;
            p.energy -= foreShieldDelta;
            }
        }
    else                    // transfer energy from shields
        {
        if(p.energy &gt;= 32) return;
        if(p.aftShield == 0 &amp;&amp; p.forwardShield == 0) return;  // both shields completely depleted
        var energyDelta;
        if(p.aftShield &gt;= p.forwardShield)                  // transfer energy from aft shield
            {
            energyDelta = p.aftShield;
                {                
                if(energyDelta &gt; 16)
                    {
                    energyDelta = 16;
                    }
                p.aftShield -= energyDelta;
                p.energy += energyDelta;
                }
            }
        else                                                // transfer energy from fore shield
            {
            energyDelta = p.forwardShield;
                {                
                if(energyDelta &gt; 16)
                    {
                    energyDelta = 16;
                    }
                p.forwardShield -= energyDelta;
                p.energy += energyDelta;
                }            
            }
        }
	}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
