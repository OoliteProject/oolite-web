<html>
    <head>
        <title>Expansion Skilled NPCs</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Skilled NPCs</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Optional Expansions mismatch between OXP Manifest and Expansion Manager at character position 0063 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Enables higher-quality flight AI for routine NPCs. Can be configured with OXPConfig or Library for even more challenge.</td>
                    <td>Enables higher-quality flight AI for routine NPCs. Can be configured with OXPConfig or Library for even more challenge.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.cim.skilled-npcs</td>
                    <td>oolite.oxp.cim.skilled-npcs</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Skilled NPCs</td>
                    <td>Skilled NPCs</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>cim</td>
                    <td>cim</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.6</td>
                    <td>1.6</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                            <li>oolite.oxp.Svengali.OXPConfig:0</li>
                            <li>oolite.oxp.Svengali.Library:1.2</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Svengali.OXPConfig:</li>
                            <li>oolite.oxp.Svengali.Library:1.2</li>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Skilled_NPCs_OXP">http://wiki.alioth.net/index.php/Skilled_NPCs_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/0/02/Skilled_NPCs.oxz">https://wiki.alioth.net/img_auth.php/0/02/Skilled_NPCs.oxz</a></td>
                    <td><a target="_blank" href="http://wiki.alioth.net/img_auth.php/0/02/Skilled_NPCs.oxz">http://wiki.alioth.net/img_auth.php/0/02/Skilled_NPCs.oxz</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-SA 3.0</td>
                    <td>CC-BY-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1695264420</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Skilled%20NPCs'>http://wiki.alioth.net/index.php/Skilled%20NPCs</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/skilled-npcs.js</td>
                    <td><pre>&quot;use strict&quot;;
this.author      = &quot;cim&quot;; 
this.copyright   = &quot;Â© 2011-2014 cim.&quot;; 
this.licence     = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Skilled NPCs&quot;;
this.description = &quot;OXP to enable high-skill combat routines on most standard NPCs&quot;;

this.$baseline = 0;
this.$baselinePirate = this.$baseline;
this.$baselineAssassin = this.$baseline;
this.$baselineHunter = this.$baseline;
this.$baselineTrader = this.$baseline;
this.$baselineAliens = this.$baseline;
this.$baselineOthers = this.$baseline;
this.$boostPirate = true;
this.$boostAssassin = true;
this.$boostHunter = true;
this.$boostTrader = true;
this.$boostAliens = true;
this.$boostOthers = false;
this.$defaultReaction = 1.5;
this.$reactionPirate = this.$defaultReaction;
this.$reactionAssassin = this.$defaultReaction;
this.$reactionHunter = this.$defaultReaction;
this.$reactionTrader = this.$defaultReaction;
this.$reactionAliens = this.$defaultReaction;
this.$reactionOthers = this.$defaultReaction;

this.oxpcSettings = { 
		Info: {Name: this.name, Display: &quot;Skilled NPCs&quot;, InfoS:&quot;0=some good pilots, rarer very good. 3=common good pilots, many very good. 5=all pilots have some skill, many have max skill. 10=all pilots have max skill.&quot;, InfoB:&quot;Select the groups of roles to apply changes to.&quot;},
		SInt0: {Name:&quot;$baseline&quot;, Def:0, Max:10, Desc:&quot;Difficulty level.&quot;},
		Bool0: {Name:&quot;$boostPirate&quot;, Def: true, Desc: &quot;Improve pirates and assassins&quot;},
		Bool1: {Name:&quot;$boostHunter&quot;, Def: true, Desc: &quot;Improve hunters and police&quot;},
		Bool2: {Name:&quot;$boostTrader&quot;, Def: true, Desc: &quot;Improve traders, miners, escorts&quot;},
		Bool3: {Name:&quot;$boostAliens&quot;, Def: true, Desc: &quot;Improve thargoids&quot;},
		Bool4: {Name:&quot;$boostOthers&quot;, Def: false, Desc: &quot;Improve others&quot;}
};

this.libSettings = { 
	Name: this.name, Display: &quot;NPC Levels&quot;, Alias:&quot;Skilled NPCs&quot;, Alive:&quot;libSettings&quot;,
	Bool: {
		B0:{Name:&quot;$boostPirate&quot;, Def:true, Desc:&quot;Pirates&quot;},
		B1:{Name:&quot;$boostAssassin&quot;, Def:true, Desc:&quot;Assassins&quot;},
		B2:{Name:&quot;$boostHunter&quot;, Def:true, Desc:&quot;Hunters, police&quot;},
		B3:{Name:&quot;$boostTrader&quot;, Def:true, Desc:&quot;Traders, miners, escorts&quot;},
		B4:{Name:&quot;$boostAliens&quot;, Def:true, Desc:&quot;Thargoids&quot;},
		B5:{Name:&quot;$boostOthers&quot;, Def:false, Desc:&quot;Others&quot;}, 
		Info:&quot;Select the groups of roles to apply changes to.&quot;},
	SInt: {
		S0:{Name:&quot;$baselinePirate&quot;, Def:0, Min:0, Max:10, Desc:&quot;Pirate difficulty level&quot;},
		S1:{Name:&quot;$baselineAssassin&quot;, Def:0, Min:0, Max:10, Desc:&quot;Assassin difficulty level&quot;},
		S2:{Name:&quot;$baselineHunter&quot;, Def:0, Min:0, Max:10, Desc:&quot;Hunter difficulty level&quot;},
		S3:{Name:&quot;$baselineTrader&quot;, Def:0, Min:0, Max:10, Desc:&quot;Trader difficulty level&quot;},
		S4:{Name:&quot;$baselineAliens&quot;, Def:0, Min:0, Max:10, Desc:&quot;Aliens difficulty level&quot;},
		S5:{Name:&quot;$baselineOthers&quot;, Def:0, Min:0, Max:10, Desc:&quot;Others difficulty level&quot;},
		Info:&quot;0=some good pilots, rarer very good. 3=common good pilots, many very good. 5=all pilots have some skill, many have max skill. 10=all pilots have max skill.&quot;},
};

this.libSettings2 = {
	Name: this.name, Display: &quot;NPC Reaction Times&quot;, Alias:&quot;Skilled NPCs&quot;, Alive:&quot;libSettings2&quot;,
	SInt: {
		S0:{Name:&quot;$reactionPirate&quot;, Def:1.5, Float:1, Min:0.1, Max:3, Desc:&quot;Pirate reaction time&quot;},
		S1:{Name:&quot;$reactionAssassin&quot;, Def:1.5, Float:1, Min:0.1, Max:3, Desc:&quot;Assassin reaction time&quot;},
		S2:{Name:&quot;$reactionHunter&quot;, Def:1.5, Float:1, Min:0.1, Max:3, Desc:&quot;Hunter reaction time&quot;},
		S3:{Name:&quot;$reactionTrader&quot;, Def:1.5, Float:1, Min:0.1, Max:3, Desc:&quot;Trader reaction time&quot;},
		S4:{Name:&quot;$reactionAliens&quot;, Def:1.5, Float:1, Min:0.1, Max:3, Desc:&quot;Aliens reaction time&quot;},
		S5:{Name:&quot;$reactionOthers&quot;, Def:1.5, Float:1, Min:0.1, Max:3, Desc:&quot;Others reaction time&quot;},
		Info:&quot;0.1=Insane reaction time, 1.5=normal reaction time, 3.0=slow reaction time\nWARNING: Decreasing reaction time below 1.5 will greatly increase lethality of NPC ships.&quot;},
};

this._trueValues = [&quot;yes&quot;, &quot;1&quot;, 1, &quot;true&quot;, true];

this.startUp = function() {
	if (worldScripts.Lib_Config) {
		if (missionVariables.SkilledNPC_Baseline) this.$baseline = parseInt(missionVariables.SkilledNPC_Baseline);
		if (missionVariables.SkilledNPC_BaselinePirate) this.$baselinePirate = parseInt(missionVariables.SkilledNPC_BaselinePirate);
		else this.$baselinePirate = this.$baseline;
		if (missionVariables.SkilledNPC_BaselineAssassin) this.$baselineAssassin = parseInt(missionVariables.SkilledNPC_BaselineAssassin);
		else this.$baselineAssassin = this.$baselinePirate;
		if (missionVariables.SkilledNPC_BaselineHunter) this.$baselineHunter = parseInt(missionVariables.SkilledNPC_BaselineHunter);
		else this.$baselineHunter = this.$baseline;
		if (missionVariables.SkilledNPC_BaselineTrader) this.$baselineTrader = parseInt(missionVariables.SkilledNPC_BaselineTrader);
		else this.$baselineTrader = this.$baseline;
		if (missionVariables.SkilledNPC_BaselineAliens) this.$baselineAliens = parseInt(missionVariables.SkilledNPC_BaselineAliens);
		else this.$baselineAliens = this.$baseline;
		if (missionVariables.SkilledNPC_BaselineOthers) this.$baselineOthers = parseInt(missionVariables.SkilledNPC_BaselineOthers);
		else this.$baselineOthers = this.$baseline;

		if (missionVariables.SkilledNPC_DefaultReaction) this.$defaultReaction = parseFloat(missionVariables.SkilledNPC_DefaultReaction);
		if (missionVariables.SkilledNPC_ReactionPirate) this.$reactionPirate = parseFloat(missionVariables.SkilledNPC_ReactionPirate);
		else this.$reactionPirate = this.$defaultReaction;
		if (missionVariables.SkilledNPC_ReactionAssassin) this.$reactionAssassin = parseFloat(missionVariables.SkilledNPC_ReactionAssassin);
		else this.$reactionAssassin = this.$defaultReaction;
		if (missionVariables.SkilledNPC_ReactionHunter) this.$reactionHunter = parseFloat(missionVariables.SkilledNPC_ReactionHunter);
		else this.$reactionHunter = this.$defaultReaction;
		if (missionVariables.SkilledNPC_ReactionTrader) this.$reactionTrader = parseFloat(missionVariables.SkilledNPC_ReactionTrader);
		else this.$reactionTrader = this.$defaultReaction;
		if (missionVariables.SkilledNPC_ReactionAliens) this.$reactionAliens = parseFloat(missionVariables.SkilledNPC_ReactionAliens);
		else this.$reactionAliens = this.$defaultReaction;
		if (missionVariables.SkilledNPC_ReactionOthers) this.$reactionOthers = parseFloat(missionVariables.SkilledNPC_ReactionOthers);
		else this.$reactionOthers = this.$defaultReaction;

		if (missionVariables.SkilledNPC_BoostPirate) this.$boostPirate = (this._trueValues.indexOf(missionVariables.SkilledNPC_BoostPirate) &gt;= 0 ? true : false);
		if (missionVariables.SkilledNPC_BoostAssassin) this.$boostAssassin = (this._trueValues.indexOf(missionVariables.SkilledNPC_BoostAssassin) &gt;= 0 ? true : false);
		if (missionVariables.SkilledNPC_BoostHunter) this.$boostHunter = (this._trueValues.indexOf(missionVariables.SkilledNPC_BoostHunter) &gt;= 0 ? true : false);
		if (missionVariables.SkilledNPC_BoostTrader) this.$boostTrader = (this._trueValues.indexOf(missionVariables.SkilledNPC_BoostTrader) &gt;= 0 ? true : false);
		if (missionVariables.SkilledNPC_BoostAliens) this.$boostAliens = (this._trueValues.indexOf(missionVariables.SkilledNPC_BoostAliens) &gt;= 0 ? true : false);
		if (missionVariables.SkilledNPC_BoostOthers) this.$boostOthers = (this._trueValues.indexOf(missionVariables.SkilledNPC_BoostOthers) &gt;= 0 ? true : false);
		// disable OXP config, in preference to Library
		if (worldScripts.OXPConfig) {
		}
	}
}

this.startUpComplete = function() {
	// register our settings, if Lib_Config is present
	if (worldScripts.Lib_Config) {
		worldScripts.Lib_Config._registerSet(this.libSettings);
		worldScripts.Lib_Config._registerSet(this.libSettings2);
	} else if (worldScripts.OXPConfig) {
		this.$baselinePirate = this.$baseline;
		this.$baselineAssassin = this.$baseline;
		this.$baselineHunter = this.$baseline;
		this.$baselineTrader = this.$baseline;
		this.$baselineAliens = this.$baseline;
		this.$baselineOthers = this.$baseline;
	}
}

this.missionScreenOpportunity = function() {
	// we need to monitor the baseline setting, in case it gets updated by OXP config
	this.$backup = this.$baseline;
}

this.missionScreenEnded = function() {
	// check for OXP config changing the baseline
	if (worldScripts.OXPConfig) {
		if (this.$baseline != this.$backup) {
			this.$baselinePirate = this.$baseline;
			this.$baselineAssassin = this.$baseline;
			this.$baselineHunter = this.$baseline;
			this.$baselineTrader = this.$baseline;
			this.$baselineAliens = this.$baseline;
			this.$baselineOthers = this.$baseline;
		}
		// if library isn&#39;t installed, make sure the assassin flag mirrors the pirate one
		if (!worldScripts.Lib_Config) this.$boostAssassin = this.$boostPirate;
	}
}

this.playerWillSaveGame = function() {
	if (worldScripts.Lib_Config) {
		missionVariables.SkilledNPC_Baseline = this.$baseline;
		missionVariables.SkilledNPC_BaselinePirate = this.$baselinePirate;
		missionVariables.SkilledNPC_BaselineAssassin = this.$baselineAssassin;
		missionVariables.SkilledNPC_BaselineHunter = this.$baselineHunter;
		missionVariables.SkilledNPC_BaselineTrader = this.$baselineTrader;
		missionVariables.SkilledNPC_BaselineAliens = this.$baselineAliens;
		missionVariables.SkilledNPC_BaselineOthers = this.$baselineOthers;
		missionVariables.SkilledNPC_BoostPirate = this.$boostPirate;
		missionVariables.SkilledNPC_BoostAssassin = this.$boostAssassin;
		missionVariables.SkilledNPC_BoostHunter = this.$boostHunter;
		missionVariables.SkilledNPC_BoostTrader = this.$boostTrader;
		missionVariables.SkilledNPC_BoostAliens = this.$boostAliens;
		missionVariables.SkilledNPC_BoostOthers = this.$boostOthers;
		missionVariables.SkilledNPC_ReactionPirate = this.$reactionPirate;
		missionVariables.SkilledNPC_ReactionAssassin = this.$reactionAssassin;
		missionVariables.SkilledNPC_ReactionHunter = this.$reactionHunter;
		missionVariables.SkilledNPC_ReactionTrader = this.$reactionTrader;
		missionVariables.SkilledNPC_ReactionAliens = this.$reactionAliens;
		missionVariables.SkilledNPC_ReactionOthers = this.$reactionOthers;
	}
}

this.shipSpawned = function(ship) {
	if (ship.accuracy &gt;= 5) { 
		return; // already been custom-set, so don&#39;t adjust it
	}
	if (!ship.autoWeapons) {
		return; // ship does not agree to 3rd-party adjustments
	}

	var role = ship.primaryRole;
	if (ship.scriptInfo.skilled_npc_role) {
		role = ship.scriptInfo.skilled_npc_role;
	}
	
	var gov = System.infoForSystem(galaxyNumber,ship.homeSystem).government;

	switch (role) {
		case &quot;off&quot;:
			break; // never boosted, ever, even if has auto_weapons for other purposes
		case &quot;assassin-light&quot;:
		case &quot;assassin-medium&quot;:
		case &quot;assassin-heavy&quot;:
			if (!this.$boostAssassin) break;
			if (ship.accuracy &lt; 0) { 
				ship.accuracy = -ship.accuracy;
			}
			ship.accuracy += this.$baselineAssassin;
			ship.accuracy += Math.random()*(7-gov);
			if (ship.accuracy &lt; (7-gov)) {
				ship.accuracy += (7-gov)*0.75;
			}
			ship.reactionTime = this.$reactionAssassin;
			break;
		case &quot;pirate&quot;:
		case &quot;pirate-light-fighter&quot;:
		case &quot;pirate-medium-fighter&quot;:
		case &quot;pirate-heavy-fighter&quot;:
		case &quot;pirate-light-freighter&quot;:
		case &quot;pirate-medium-freighter&quot;:
		case &quot;pirate-heavy-freighter&quot;:
		case &quot;pirate-interceptor&quot;:
		case &quot;pirate-aegis-raider&quot;:
			if (!this.$boostPirate) break;
			if (ship.accuracy &lt; 0) { 
				ship.accuracy = -ship.accuracy;
			}
			ship.accuracy += this.$baselinePirate;
			ship.accuracy += Math.random()*(7-gov);
			if (ship.accuracy &lt; (7-gov)) {
				ship.accuracy += (7-gov)*0.75;
			}
			ship.reactionTime = this.$reactionPirate;
			break;
		case &quot;hunter&quot;:
		case &quot;hunter-medium&quot;:
		case &quot;hunter-heavy&quot;:
			if (!this.$boostHunter) break;
			if (ship.accuracy &lt; 0) { 
				ship.accuracy = -ship.accuracy;
			}
			ship.accuracy += this.$baselineHunter;
			ship.accuracy += Math.random()*(gov);
			if (ship.accuracy &lt; (gov)) {
				ship.accuracy += (gov)*0.75;
			}
			ship.reactionTime = this.$reactionHunter;
			break;
		case &quot;escort&quot;:
		case &quot;escort-medium&quot;:
		case &quot;escort-heavy&quot;:
		case &quot;defense_ship&quot;:
			if (!this.$boostTrader) break;
			if (ship.accuracy &lt; 0) { 
				ship.accuracy = -ship.accuracy;
			}
			ship.accuracy += this.$baseline;
			if (ship.scanClass == &quot;CLASS_POLICE&quot;) {
				ship.accuracy *= 2;
			}				
			ship.accuracy += Math.random()*5;
			if (ship.escortGroup.leader &amp;&amp; ship.accuracy &lt; ship.escortGroup.leader.accuracy) {
				ship.accuracy += Math.random()*ship.escortGroup.leader.accuracy;
			} 
			ship.reactionTime = this.$reactionTrader;
			break;
		case &quot;miner&quot;:
		case &quot;scavenger&quot;:
		case &quot;trader&quot;:
		case &quot;trader-courier&quot;:
		case &quot;trader-smuggler&quot;:
			if (!this.$boostTrader) break;
			if (ship.accuracy &lt; 0) { 
				ship.accuracy = -ship.accuracy;
			}
			ship.accuracy += this.$baselineTrader;
			ship.accuracy += Math.random()*(7-gov)*0.5;
			ship.reactionTime = this.$reactionTrader;
			break;
		case &quot;police&quot;:
		case &quot;interceptor&quot;:
		case &quot;wingman&quot;:
			if (!this.$boostHunter) break;
			if (ship.accuracy &lt; 0) { 
				ship.accuracy = -ship.accuracy;
			}
			ship.accuracy += this.$baselineHunter;
			ship.accuracy *= 2;
			ship.accuracy += Math.random()*gov;
			ship.reactionTime = this.$reactionHunter;
			break;
		case &quot;thargoid&quot;:
		case &quot;thargon&quot;:
		case &quot;griff_robot_thargon&quot;:
		case &quot;griff_organic_thargon&quot;:
			if (!this.$boostAliens) break;
			if (ship.accuracy &lt; 0) { 
				ship.accuracy = -ship.accuracy;
			}
			ship.accuracy += this.$baselineAliens;
			ship.accuracy *= 2;
			ship.reactionTime = this.$reactionAliens;
			break;
		default:
			if (!this.$boostOthers) break;
			if (ship.accuracy &lt; 0) { 
				ship.accuracy = -ship.accuracy;
			}
			ship.accuracy += this.$baselineOthers;
			ship.accuracy += Math.random()*this.$baselineOthers;
			ship.reactionTime = this.$reactionOthers;
	}
}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
