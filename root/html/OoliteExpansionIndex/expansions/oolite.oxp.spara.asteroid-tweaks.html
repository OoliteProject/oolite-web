<html>
    <head>
        <title>Expansion Asteroid tweaks</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Asteroid tweaks</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>http://wiki.alioth.net/index.php/Asteroid%20tweaks -&gt; 404 Not Found</li>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Control asteroid respawning and the number of asteroids the game spawns at system creation. Configure settings via an interface screen.</td>
                    <td>Control asteroid respawning and the number of asteroids the game spawns at system creation. Configure settings via an interface screen.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.spara.asteroid-tweaks</td>
                    <td>oolite.oxp.spara.asteroid-tweaks</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Asteroid tweaks</td>
                    <td>Asteroid tweaks</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>spara</td>
                    <td>spara</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.3</td>
                    <td>1.3</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/e/ef/Asteroid_tweaks_1.3.oxz">https://wiki.alioth.net/img_auth.php/e/ef/Asteroid_tweaks_1.3.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873507</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        
        <h3>asteroid_tweaks_readme_&amp;_license.txt</h3>
        <pre>Asteroid Tweaks OXP ver 1.3 (24.10.2015)

Author: spara (Mika Spåra)

_Description_

This oxp combines two of my previous small experimental OXPs, Moar Rocks and Asteroid Respawn, into one and adds an interface screen to configure them.

1. Control the number of asteroids spawned at system population by setting a multiplier that multiplies every spawned asteroid. Multiplication factor can be selected from 1-5. Note that multiplying asteroids means more entities and that means more stress to the computer.
2. Respawn destroyed asteroids when the player docks by creating new asteroids around hermits and/or an asteroid field somewhere in system. The size of the field is the number of destroyed asteroids before docking and the placement is around random asteroid far enough from the player. If no suitable asteroid can be found, then the asteroids are scattered around.
3. Configure settings via an interface screen. Interface screen is available at the main station and any rock hermit. If preferred, the interface can be disabled from the main stations.

------

This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;spara&quot;; 
this.copyright   = &quot;2015 spara&quot;; 
this.description = &quot;asteroid respawner and multiplier&quot;; 
this.name        = &quot;asteroid_tweaks&quot;;

this.startUp = function() {
	//asteroid respawn
	if (!missionVariables.asteroid_tweaks_respawn) {
		this.$respawn = false;
	}
	else this.$respawn = true;
	
	//asteroid multiplier
	if (!missionVariables.asteroid_tweaks_multiplier) {
		missionVariables.asteroid_tweaks_multiplier = 1;
	}
	this.$asteroidMultiplier = missionVariables.asteroid_tweaks_multiplier;
	
	//main station configuration interface
	if (!missionVariables.asteroid_tweaks_config_main) {
		this.$configMain = true;
	}
	else this.$configMain = false;
}

this.missionScreenOpportunity= function() {
	if (!missionVariables.asteroid_tweaks_run_once) {
		this._showAsteroidConfig();
		missionVariables.asteroid_tweaks_run_once = true;
	}
	delete this.missionScreenOpportunity;
}

//multiply the number of asteroids when populating
this.systemWillPopulate = function (){
	var addition = this.$asteroidMultiplier - 1;
	if (addition &gt; 0) {
		system.setPopulator(&quot;moar_rocks&quot;, {
			callback: function(pos) {
				var asteroids = system.shipsWithPrimaryRole(&quot;asteroid&quot;);
				for (var i = 0; i &lt; asteroids.length; i++) {
					var position = asteroids[i].position;
					system.addShips(&quot;asteroid&quot;, addition, position, 25E3);
				};
			}.bind(this),
			location: &quot;INNER_SYSTEM_OFFPLANE&quot;
		});
	}
}

this.shipExitedWitchspace = function() {
	function $findHermits(entity) {
		if (entity.primaryRole &amp;&amp; entity.primaryRole.indexOf(&quot;rockhermit&quot;) !== -1) {
			return true;
		}
		return false;
	}
	if (this.$respawn) {
		
		//count the total number of asteroids
		this.$asteroidsTotal = system.countShipsWithPrimaryRole(&quot;asteroid&quot;);
		
		//define upper and lower limits for asteroid spawning around hermits.
		var hermits = system.filteredEntities(this, $findHermits, player.ship);
		if (hermits.length &gt; 0) {
			var asteroidsAroundHermits = 0;
			for (var i = 0; i &lt; hermits.length; i++) {
				var hermit = hermits[i];
				asteroidsAroundHermits += system.countShipsWithPrimaryRole(&quot;asteroid&quot;, hermit, 25E3);
			}
			var average = asteroidsAroundHermits / hermits.length;
			this.$upperHermitLimit = Math.ceil(average / 2);
			this.$lowerHermitLimit = Math.floor(average / 4);
		}
	}
}

this.startUpComplete = function() {
	this.shipWillDockWithStation(player.ship.dockedStation);
	this.shipExitedWitchspace();
}

//replace destroyed asteroids when docking.
this.shipDockedWithStation = function(station) {
	function $findHermits(entity) {
		if (entity.primaryRole &amp;&amp; entity.primaryRole.indexOf(&quot;rockhermit&quot;) !== -1) {
			return true;
		}
		return false;
	}
	function $findFarawayAsteroids(entity){
		if (entity.primaryRole &amp;&amp; entity.primaryRole === &quot;asteroid&quot; &amp;&amp; entity.position.distanceTo(player.ship.position) &gt; 500E3) {
			return true;
		}
		return false;
	}
	if (this.$respawn) {
		//how many asteroids are we missing?
		//4 boulders count as one asteroid and 4 splinters count as one boulder
		//these are averages. an asteroid spawns 2-6 boulders and a boulder 2-6 splinters
		var reSpawnCount = Math.floor(this.$asteroidsTotal - system.countShipsWithPrimaryRole(&quot;asteroid&quot;) - (system.countShipsWithPrimaryRole(&quot;boulder&quot;) + system.countShipsWithPrimaryRole(&quot;GriffBoulderBrown&quot;) + system.countShipsWithPrimaryRole(&quot;GriffBoulderBlue&quot;) + system.countShipsWithPrimaryRole(&quot;GriffBoulderGrey&quot;)) / 4 - system.countShipsWithPrimaryRole(&quot;splinter&quot;) / 16);
		
		//log(this.name, &quot;missing &quot; + reSpawnCount + &quot; asteroids&quot;);
		
		//check hermits
		if (reSpawnCount &gt; 0) {
			var hermits = system.filteredEntities(this, $findHermits);
			if (hermits.length &gt; 0) {
				for (var i = 0; i &lt; hermits.length; i++) {
					var hermit = hermits[i];
					var asteroids = Math.floor(system.countShipsWithPrimaryRole(&quot;asteroid&quot;, hermit, 25E3) - (system.countShipsWithPrimaryRole(&quot;boulder&quot;, hermit, 25E3) + system.countShipsWithPrimaryRole(&quot;GriffBoulderBrown&quot;, hermit, 25E3) + system.countShipsWithPrimaryRole(&quot;GriffBoulderBlue&quot;, hermit, 25E3) + system.countShipsWithPrimaryRole(&quot;GriffBoulderGrey&quot;, hermit, 25E3)) / 4 - system.countShipsWithPrimaryRole(&quot;splinter&quot;, hermit, 25E3) / 16);
					//check if we&#39;re between the spawn limits
					if (asteroids &lt; this.$upperHermitLimit &amp;&amp; asteroids &gt; this.$lowerHermitLimit) {
						var difference = this.$upperHermitLimit - asteroids;
						while (difference &gt; 0 &amp;&amp; reSpawnCount &gt; 0) {
							system.addShips(&quot;asteroid&quot;, 1, hermit.position, 25E3);
							
							//log(this.name, &quot;spawned a hermit asteroid&quot;);
							
							difference--;
							reSpawnCount--;
						}
					}
				}
			}
		};
		//Do we still have more asteroids to respawn? If so, try to create a new field into space
		if (reSpawnCount &gt; 0) {
			//report asteroids over min distance away from player
			var asteroids = system.filteredEntities(this, $findFarawayAsteroids);	
			//Add field only if it can be added around an asteroid far away enough
			if (asteroids.length &gt; 0) {
				var spawnPosition = asteroids[Math.floor(Math.random(asteroids.length))].position;
				//add asteroids as a cloud
				system.addShips(&quot;asteroid&quot;, reSpawnCount, spawnPosition, 25E3);
				
				//log(this.name, &quot;spawned a field of &quot; +reSpawnCount + &quot; asteroids&quot;);
				
			}
			//In case there&#39;s no suitable asteroid to be used as a spawn position, spread &#39;em around the player
			else {
				for (var i = 0; i &lt; reSpawnCount; i++) {
					var spawnPosition = player.ship.position.add(Vector3D.randomDirection(500E3)).multiply(1 + Math.random());
					system.addShips(&quot;asteroid&quot;, 1, spawnPosition, 25E3);
					
					//log(this.name, &quot;spawned a scattered asteroid&quot;);
					
				}
			}
		};
	}
}

this.shipWillDockWithStation = function(station) {
	if (station.primaryRole.indexOf(&quot;rockhermit&quot;) !== -1 || (station.isMainStation &amp;&amp; this.$configMain)) {
		station.setInterface(&quot;asteroid_tweaks&quot;,{
			title: &quot;Asteroid tweaks&quot;,
			category: &quot;Config&quot;,
			summary: &quot;Configure asteroid tweaks.&quot;,
			callback: this._showAsteroidConfig.bind(this)
		});
	}
}

this._showAsteroidConfig = function() {
	var options = {
		&quot;1_X&quot; : &quot;1x&quot;,
		&quot;2_X&quot; : &quot;2x&quot;,
		&quot;3_X&quot; : &quot;3x&quot;,
		&quot;4_X&quot; : &quot;4x&quot;,
		&quot;5_X&quot; : &quot;5x&quot;
	};
	mission.runScreen({
		title: &quot;Asteroid Tweaks&quot;,
		message: &quot;Do you want moar asteroids? Multiply the number of asteroids the game spawns when a system is being created. Note though, more asteroids means more stress for your computer. Current multiplier is &quot; + this.$asteroidMultiplier + &quot;.&quot;,
		choices: options
	},
	function (choice) {
		this.$asteroidMultiplier = choice.split(&#39;_&#39;)[0];
		missionVariables.asteroid_tweaks_multiplier = this.$asteroidMultiplier;
		this._showRespawnConfig();
	});
}

this._showRespawnConfig = function() {
	var options = {
		&quot;1_NO&quot; : &quot;No, don&#39;t respawn asteroids&quot;,
		&quot;2_YES&quot; : &quot;Yes, respawn asteroids&quot;
	};
	mission.runScreen({
		title: &quot;Asteroid Tweaks&quot;,
		message: &quot;In the default game, it&#39;s possible to empty a system from asteroids by destroying them all. This setting makes the game respawn destroyed asteroids as a new asteroid field somewhere in system when the player docks. Current asteroid respawn setting is: &quot; + this.$respawn + &quot;.&quot;,
		choices: options
	},
	function (choice) {
		if (choice === &quot;1_NO&quot; &amp;&amp; this.$respawn) {
			this.$respawn = false;
			delete missionVariables.asteroid_tweaks_respawn;
		}
		else if (choice === &quot;2_YES&quot; &amp;&amp; !this.$respawn) {
			this.$respawn = true;
			this.shipExitedWitchspace();
			missionVariables.asteroid_tweaks_respawn = 1;
		}
		this._showMainConfig();
	});
}

this._showMainConfig = function() {
	var options = {
		&quot;1_YES&quot; : &quot;Yes, show it at the main station&quot;,
		&quot;2_NO&quot; : &quot;No, don&#39;t show it at the main station&quot;
	};
	mission.runScreen({
		title: &quot;Asteroid Tweaks&quot;,
		message: &quot;Show this config interface at the main station interfaces. Interface is always available at any rock hermit.\n\nDon&#39;t worry, the settings you have chosen will remain active even if you decide to hide the interface from the main station.&quot;,
		choices: options
	},
	function (choice) {
		if (choice === &quot;1_YES&quot; &amp;&amp; !this.$configMain) {
			this.$configMain = true;
			delete missionVariables.asteroid_tweaks_config_main;
		}
		else if (choice === &quot;2_NO&quot; &amp;&amp; this.$configMain){
			this.$configMain = false;
			missionVariables.asteroid_tweaks_config_main = 1;
			system.mainStation.setInterface(&quot;asteroid_tweaks&quot;,null);
		}
	});
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
