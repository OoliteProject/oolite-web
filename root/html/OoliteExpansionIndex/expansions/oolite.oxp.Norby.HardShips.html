<html>
    <head>
        <title>Expansion HardShips</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion HardShips</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">60 Equipment</a></li>
          <li><a href="#ships">58 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">11 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER W)(&#39;[]&#39; vs &#39;[wip]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Ships get 6 side armours, 10 Hard ships with Hard Armour, many new defensive equipments and Drones.</td>
                    <td>Ships get 6 side armours, 10 Hard ships with Hard Armour, many new defensive equipments and Drones.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Norby.HardShips</td>
                    <td>oolite.oxp.Norby.HardShips</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>HardShips</td>
                    <td>HardShips</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Norby</td>
                    <td>Norby</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.89</td>
                    <td>0.89</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>wip</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                            <li>oolite.oxp.CommonSenseOTB.CustomShields:0.83</li>
                            <li>oolite.oxp.CommonSenseOTB.ShieldEqualizer+Capacitors:1.3</li>
                            <li>oolite.oxp.Thargoid.IronHide:2.00</li>
                            <li>oolite.oxp.Norby.ShipVersion:1.21</li>
                    </td>
                    <td>
                            <li>oolite.oxp.CommonSenseOTB.CustomShields:0.83</li>
                            <li>oolite.oxp.CommonSenseOTB.ShieldEqualizer+Capacitors:1.3</li>
                            <li>oolite.oxp.Thargoid.IronHide:2.00</li>
                            <li>oolite.oxp.Norby.ShipVersion:1.21</li>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/HardShips">http://wiki.alioth.net/index.php/HardShips</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/4/45/HardShips_0.89.oxz">https://wiki.alioth.net/img_auth.php/4/45/HardShips_0.89.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 4</td>
                    <td>CC BY-NC-SA 4</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873287</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/HardShips'>http://wiki.alioth.net/index.php/HardShips</a></p>
        <h3>HardShips readme.txt</h3>
        <pre>
HardShips OXP

This OXP contains:
1. New Hard Ships based on the player ships with the new Hard Armour.
2. Standard Armour on 6 sides of all ships including NPCs.
3. Defensive Equipments.
4. Drones: Laser Drone and Hard Drone.


1. Hard Ships

The following ships can be choosed at new game from the start menu:
Hard Cobra Mark III, Hard Cobra Mark I, Hard Adder and Hard Moray.
If you choose cheaper ship then more will be left from the starting 100.000 credits to buy equipments and goods.

The Cobra III is seems to be pretty cheap, but it is an old ship: if you installed ShipVersion OXP then you will always see the lowest v1.0. All others get many equipments and you can search for a very high version by call another offer again and again.

If you want to try your next ship then the more costly ships allow a test drive for 20 minutes:
Hard Anaconda, Hard Asp, Hard Boa, Har-de-Lance and Hard Python.

But what offer the Hard Armour?

It is not a damage holder as the standard melting armours: it is a very hard material which can partially deflect lasers and other attacks before any damage!
It has a base value of 3 which deducted from all attacks. The large Hard Anaconda has 5 due to can hold higher mass.
If the power of an attack is less than the base value, then no damage at all, as small bullets will never penetrate thick plates.
If more, then only the difference deducted from the standard armour of the ship.
If no armour left then the deflection effect of the Hard Armour still remain, so all energy damages will be reduced also!

It is different from an additional energy bank because the less damage means faster regeneration, so it is equal with if there are more banks and higher recharge values also, and more standard armour with faster armour repair rates, and larger IronHide armour (if installed), and raise all other bonuses and effects of the equipments, and.., and.., and..

If it is not enough for you, then install ShipVersion OXP and see what endurance can come from a trader if supported with some good equipments which multiplied by the Hard Armour. :)

To count the high mass of the Hard Armour these ships get only half thrust so accelerate (and brake!) much slower, but the maximum speed unchanged due to some physical blah about inertialess drives (or to do not unbalance the game, who knows?).

To visualize the Hard Armour these ships got orange tiled textures from Gimp (Terra pattern, Granite to pirates, Pool Bottom to police).
Please use it if you make your own Hard Armoured ships: set hardarmour=10 in script_info, set density=2, halve the thrust, make orange tiled textures and done. A good question is why not reduce the acceleration (named thrust) more on the ships with thicker armour. I can say some technical blah again but better if imagine that the given Hard Armours matched to the ship size: larger armour set on ships with larger mass already. Additional decrease needed only if a ship get (somehow) larger Hard Armour than the default.

The spread of the armour usage inspired the weapon makers to invent Armour Piercing Lasers and Missiles.
The best against Hard Armour is the Armour Piercing weapons (coming soon as secondary weapons):

-Hammer Laser is an advanced Mining Laser with double power (technically two tube fire together) which not reduced by Hard Armour and a bit faster (1.5x) recharge. But the range is the original 12.5km only and reduced by Hard Shield until there are enough shield to catch the whole damage.

-Sniper Laser is developed as a twin Military Laser to get Armour Piercing ability and 30km effective range, but usable in pulse mode only and can not pierce shield.

-All type of Railguns in the Railgun OXP has Armour Piercing ability, as all other collision (scrape) type damage also.


2. Armour sides to all ships

The standard armour of the ships divided into 6 side: Fore, Aft, Port, Starboard, Top, Bottom.
There are two &quot;inner&quot; side also: IronHide armour and Core hull.

After taken enough (maxEnergy/2) damage either outer side to destroy it, the next hits from the damaged side counted to Core hull hit.
Taking equal amount with maxEnergy of Core hull hit cause internal damage or if it happen in short time then more likely Fuel Leak.
The chance of the Leak is higher if the ship is low in energy.

Armour Repair Bots can fix 1 points of armour in every seconds, and works on all side at one time but use up 1t Alloy for each 100 damage points.
Buy Alloys before undock otherwise the Bots can fix only as little as 100 points from the Alloy which already in the hand of the Bots.
NPCs always start to fly with 1-5t alloys and if damaged (or died) then can leave some alloy, but you also if at least one side of your ship lost all armour (leaked).
If you scoop it the Repair Bot can put back some armour.

Core repairs do not use Alloys due to it is hull and not Armour (but need more time to fix the larger amount).
The main difference is that hull can not prevent energy loss if get hit but the armour can.

Technically the Core hull is another counter of the energy damage but repaired much slower than the energy recharged.
If you get many hit in short time then the energy will be low also when the Core hull run out so it can cause Fuel Leak.
But if there was enough pause between hits to recharge many energy (but not enough to repair the hull) then get internal damage.
The Fuel Leak will be sealed if repaired the 25% of the hull, then continues until fully repaired, but can be leaked again if run out next time.

The maximum armour of small ships under 30t (Adder, Mamba, Sidewinder and below) is 100 regardless of maxEnergy.
The standard armour damages will be fixed in any dock for free.

No Core Armour which can defend from all directions because the sides founded to make more reality.
But if you want, install IronHide OXP because the usage of the IronHide Armours is supported and additive.
Placed inside of the side armours to get damage after the in-flight repairable part is depleleted only.

To compensate NPCs if IronHide OXP present (which is player-only), the HardShips OXP will award extra armour to NPCs.
It will be an one-time armour without in-flight repair as the player version.

NPC ships with larger random entityPersonality value will get more IronHide Armour:
-30% get as many as the normal IronHide Armour (200 points, if ShipVersion OXP present then v5-v7),
-20% get Military IronHide Armour (400 points, v8-v9),
-1% get 1.5x of the Military IronHide Armour (600 points, v10).
To tell the truth, the IronHide support is made to create some really hard enemy. :)
For example you can see Vipers with not only the basic 180 energy points but with 490 armour and 384 shield points, which is 6x more.

In addition there are harder ones in Granite suit for NPC hunters and pirates.


3. Defensive Equipments

Additional Armour Equipments

The Front and Aft side can hold an extra layer standard armour which is repairable in dock only (and for a fee), so give an one-time defense only.
Other sides can not hold additions, it would be too much extra mass to any ship.

If an Additional Armour Equipment damaged then the defense still remain in this fly but need repair when docked to use again.
The repair team can not restore the armour value of a damaged equipment, furthermore wipes the remaining armour value after landing to prevent accidents in dock, but the equipment remain in damaged status to can buy repair.
If you do not pay the repair then you will undock without working additional defense.

A surprise can happen due to the game mechanics: a frontal hit can damage the Additional Aft Armour also as any other equipments.
But it is rare enough to accept as an unlucky hit which managed to go through the whole ship.

 Cost: 2*5000.0 Cr.
 Techlevel: 5


Additional Core Hull Equipment

Doubles the damage amount before start to get internal damage or Fuel Leak.
Repaired in-flight automatically as the normal part of the Core hull due to it is not an armour.
If the equipment is damaged then repairable in dock only, but the added hull remains as an one-time defense.

You can fix all of the Additional equipments in one step when docked in all system, but you can buy in tech level 5 or above.
The showed price is enough to fix a single damaged equipment, if all three damaged then will deduct three times more.

 Cost: 5000.0 Cr.
 Techlevel: 5


Dummy Equipments

Many metal fragments placed between equipments to take out damage with high odds, but take cargo space also.
There are different packages: 1t, 5t, 10t, 50t and 100t with 10, 50, 100, 500 and 1000 times higher odds to damage before others.
You can buy all of them if you have 166t cargo space and use together because the size of the fragments are different and can put the small ones into the remaining spaces of the large ones.
But never found these in the buyable ships by default, so you must get it by hand after bought a new ship.
(Technically not possible, a bug in Oolite v1.77 cause sometime disappearing eqipments with cargo space reqirement in shipyard.plist.)
Fortunately you can buy worthless metals in all systems. :)

 Cost: 10.0 Cr./1 t
 Techlevel: 1


Engine Repair Bot

Can fix damaged Injectors, Q-charger and Broken Engines in a minute to help survive and run from a bad situation.
Need 1t Machinery for each fix.
Can not fit into ships under 30t mass.

 Cost: 1000.0 Cr.
 Techlevel: 5


Equipment Box

This armoured box can defend all equipments. This will be damaged first, the equipments later only.
Does not require cargo space but you can place into the ship a single Equipment Box only.
More specific boxes available also which placed inside this box to save the most important equipments which can help in retreat.
Other equipments can not be boxed separatedly due to not enough space in the ships, these guarded by the general Equipment Box only.
All damaged boxes repaired automatically in a minute but need 100kg alloys to fix a damage.
Can not fit any of the boxes into ships under 30t.

 Cost: 100.0 Cr.
 Techlevel: 1


Electronics Box

Defend your Docking Computers, E.C.M. System, Multi-Targeting System, Scanner Targeting Enhancement and Target System Memory Expansion until penetrated.

 Cost: 200.0 Cr.
 Techlevel: 1


Injector Box

Armoured box around Witchdrive Fuel Injectors to take over the first damage.
A must-have due to Injectors is the best escape tool in a hot situation and can be fatal if suddenly damaged.
You can retreat instantly when this box damaged before losing your ability to run.
Protect your Engine Repair Bot, Q-Charger from Q-Charger OXP and your engines also if Breakable Engines OXP is installed.

 Cost: 200.0 Cr.
 Techlevel: 1


Life Box

Put your Escape Pod and Passenger Berths into a protecting box.
Protect your HUD and IFF scanner due to these are in your cockpit also if Breakable_HUD_IFF_Scanner OXP is installed.

 Cost: 200.0 Cr.
 Techlevel: 1


Shield Box

Defend Shield Boosters, Shield Capacitors and Military Shield Enhancement, but not Hard Shields which placed outside of the hull.
Protect your normal shields also if Breakable Shield Generators OXP is installed.

 Cost: 200.0 Cr.
 Techlevel: 1


Emergency Energy Generator

Refill all energy banks from Radioactives and Platinum as catalyst but once only due to need repair after used.
Need 1t Radioactives and 1kg Platinum for each bank, beware: storing radioactives are illegal in some systems.
Triggered when the last energy bank is remaining only.
The speedy recharge can cause internal damage to the ship (in cargo, equipment or service level).

 Cost: 10000.0 Cr.
 Techlevel: 5


Emergency Shield Generator

Need an Emergency Energy Generator which can recharge shields also with this equipment.
Can not refill Shield Capacitors.

 Cost: 10000.0 Cr.
 Techlevel: 12


High-Tech Catalyst

EEG can use Fuel with Gold catalyst if no more Radioactives or Platinum on board.
Need clean status because these tools are regulated, drain 0.1ly fuel and 1kg Gold to refill one energy bank.
Can take the first damage from an emergency refill so Emergency Energy Generator can trigger another times.

 Cost: 10000.0 Cr.
 Techlevel: 12


Renewable Energy Generator

Generate two banks of energy when the last bank is touched and will renew in any dock for free.
Need unclean status to buy due to use old unsafe technology which cause many internal damages to the ship when break down.

 Cost: 5000.0 Cr.
 Techlevel: 3


Hard Nose

The front of the ship can hold an additional Hard Armour layer which increase the deflected amount of any damage which hit the front side by 1 points in addition to the base Hard Armour.
Other sides can not hold similar addition.
Can put on non-HardShips, and can be damaged (base Hard Armour can not).

 Cost: 5000.0 Cr.
 Techlevel: 5


Very Hard Nose

Doubled Hard Nose can deflect additional 2 points in any ship, but can buy at tech level 12 planets or above only and a bit costly.

Can not use in addition to the normal Hard Nose, if you buy the better then the normal will be sold and refunded.
You can downgrade also if you need money.

Your equipments still can get damaged from a hit which not caused armour damage if no shield by short circuit and shock, and the Armour Piercing weapons still can strike through these very hard front armours.

If you use ShipVersion OXP then you must go around the best NPCs after the shield is out because you can not scratch the front also. The Detectors equipment can help to check the caused damage if installed.

 Cost: 10000.0 Cr.
 Techlevel: 12


Hard Shield Equipments

Similar with the Hard Armour but hardening the shield by placing more shield emitters denser, but the cost growth also lineal.
Every hit reduced with the level of the Hard Shield Equipment.
Exists from level 1 to 10, the best sold only at techlevel 14 planets or above and costs 10.000 credits.
Can found only in systems where the tech level is 4 level more than the level of the Hard Shield, but all is repairable from tech level 5.
Can use only one at a time, if you buy another then the old will be sold and you will get full refund from it.
This means also if you need some money then you can downgrade it and get back the difference to buy another important things.
It is not additive with the Hard Armour, can not protect the hull of the ship after the shield is depleted.

The (incoming) Shield-Sapper weapons also very affected by Hard Shield: can reduce the 5x depleting ability to 5-HSLevel/6.
If you are not mathematician, then here is a table:
HSLevel  	0	2	4	6	8	10
Depleting	5	4.667	4.333	4	3.667	3.333

The 1x damage of the Sapper and the range is similar with a dual predecessor Beam Laser: 30 energy points and 15km, need 5x energy per shot and usable in pulse mode only, but it is more effective against shield than the Beam laser in beam mode and not only for 3 seconds due to never overheated.
The dual mode means one shot and 150 points (2*5*15) gone from a soft shield.
The 256 points of a full Boosted (but not Military) normal shield can be Sapped in 1 second: the first instant hit more than halving it then the next after a second clearing out.
A Military shield with Hard Shield 8 (default on v8 NPCs if ShipVersion OXP present) need at least 6 second (if all shot hit), but against armour and hull or a shield with Anti-Sapper equipment is working as a dual Pulse Laser only.

 Cost: 1000.0 Cr./level
 Techlevel: 5-14


Anti-Sapper Shield Equipment

Please use the full name in nice talk, do not say the short acronym as pirates does.
Requires Hard Shield 10, and can not reduce the normal hits, but totally negate the Shield-Sapper effect.
Cost as much as a mid-class ship itself, and your vehicle will be look as a hedgehog from the exceptionally densely placed emitters.
The many parts cause that can be damaged with 10x more probability than other equipments.
Can found only in systems with tech level 14 or above but can repair from tech level 5.
The repair is cheap due to usually a small piece damaged only in the same time.
But if you install the Realistic Damage OXP then can be totally destroyed which maybe cost more to worth, so in in this case buy only after you are earned really much money.

 Cost: 20000.0 Cr.
 Techlevel: 14


Big Shield Capacitors

Extend the Shield Capacitors (if any) to 4 times of the original size (256).
Available at tech level 14 planets (as normal capacitors), and need installed ShieldEqualizer+Capacitors OXP.
Cost many credits, but you get in one equipment not only the forward but the aft extension also.
At least v3.1 needed from the Numeric HUD to show the big values of the capacitors (older show max. 99).

 Cost: 10000.0 Cr
 Techlevel: 14


There are some hidden equipments in this OXP, please do not ask or publish it in the forum if you found one, think on others who want to find it in the game. If you are unsure to something is a bug or feature then ask the author in email (norbylite@gmail.com) or in private message (Norby).



Ship size restrictions

Ships with less than 30t mass can not get any equipments from this OXP due to the small inner space:
Adder (11t), Gecko (23t), Mamba (27t), Sidewinder (25t) and Viper (23t).
But can get standard and Hard Armour.

Ships under 130t can not get Big Shield Capacitors, Very Hard Nose and Military IronHide Armour:
Asp (59t), Cobra I (47t), Constrictor (33t), Fer-de-Lance (51t), Krait (80t), Moray (40t), Viper Interceptor (43t) and the previous small ships.

Large ships can get anything (be wise): Anaconda, Boa, Boa Mk2, Cobra III and Python.
The ship size is more important if ShipVersion OXP is installed.


4. Drones

Fast and agile tiny remote controlled ships, designed to reach as little hull size as possible to minimalize the aimable area.
No Life Support so can fight in automatic mode only, but large ships like Cobra III can hold and launch drones if needed.
Can not hold Injectors, Shield Boosters or any other extras, and no Hyperdrive so must call back before jump.

Laser Drones hold a Pulse Laser and 2 energy banks with very slow recharge rate (1) but fast (500).
Hard Drones equipped with Hard Amour, better recharge (2) and a Mini Turret also, but slower and less agile.




Dependencies:
Oolite v1.77 or later.

Instructions:
In Oolite v1.79 or later do not unzip the .oxz file, just move into the AddOns folder of your Oolite installation.

In Oolite v1.77 make a HardShips.oxp subfolder in your AddOns folder and unzip the .oxz file into the newly created subfolder.

If you use a custom replacement shipset (from Griff, Smivs or others) and you want to see the custom ship designs as hard ships also instead of the ships in this oxp then rename the shipdata.plistforcustomshipsets to shipdata.plist in the Config folder.

Conflicts:
-CustomShields OXP included Fuel Leak support also, turn it off if you do not want double chance to leaking.
-Start Choices OXP was the source of the new game screen. To insert new menu items HardShips OXP included all ships from the Start Choices 1.3 and disabled the original script, but if a new Start Choices will arrive then it will not shown until somebody port the changes into the HardShips OXP.

Recommended OXPs:
-CustomShields OXP to put shields into NPC ships, Hard Shields is player-only without this.
-Detectors OXP to show important ship data including facing armour value in the target box.
-Griff&#39;s replacement shipset supported with hard and granite textures.
-IronHide OXP to get extra armour, NPCs will get also if HardShips present.
-Numeric HUD v3.11 to show Shield Capacitor values.
-Realistic Damage OXP to fear for your ASS (oh sorry I said).
-ShieldEqualizer+Capacitors OXP if you want to use Big Shield Capacitors.
-ShipVersion OXP to maintain balance with awarded equipments from HardShips OXP to NPCs.

License:
This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike License version 4.0
If you are re-using any piece of this OXP, please let me know by sending an e-mail to norbylite@gmail.com .

Thanks to the community for:
* Feedbacks by Oolite Forum members.
* Main program by the core programmer team.
* Programming instructions by all Wiki writers.
* Recommended OXPs by its authors.
* Start menu from Start Choices OXP by Mika Spara.

Changelog:
2016.10.20. v0.89 Fix Hard Boa Mk2 to allow fitting Military Shields, thanks to javirodriguez.
2015.03.10. v0.88 Hard Armor made less hard, following reduced laser power in Oolite 1.81.
                  Allow selection of extra ships in Start Choices OXP.
                  Send less emails with Email System OXP.
2014.11.09. v0.87 Fixed the discharge of Big Shield Capacitor 2, thanks to V12.
                  Small fix in start menu for Oolite v1.79.
2013.11.21. v0.86 Small fix in texture of hardballturret.
2013.11.18. v0.85 Granite player ships in shipdata.plistforgriffgranite.
2013.11.16. v0.84 New textures for Griff ships.
2013.10.19. v0.83 Equipment boxes repaired from alloys in a minute.
                   Engine Repair Bot added.
2013.10.19. v0.82 Made compatible with Renegade Pirates OXP.
2013.10.14. v0.81 Added an alternative shipdata.plist for custom shipsets.
2013.10.13. v0.8  Granite hunters and Energy Generator equipments added.
2013.06.12. v0.7  Drones added.
2013.06.09. v0.6  More equipments added.
2013.05.05. v0.5  Some equipments added.
2013.04.08. v0.2  Second test version.
2013.03.31. v0.1  First test files.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ADDITIONAL_AFT_ARMOUR.html">Additional Aft Armour</a></td>
                    <td>yes</td>
                    <td align="right">50000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ADDITIONAL_AFT_ARMOUR_REFUND.html">Refund Additional Aft Armour</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ADDITIONAL_ARMOUR_REPAIR.html">Repair Armours, Core Hull, Hard Nose and Energy Gen.</a></td>
                    <td>yes</td>
                    <td align="right">10000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ADDITIONAL_CORE_HULL.html">Additional Core Hull</a></td>
                    <td>yes</td>
                    <td align="right">50000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ADDITIONAL_CORE_HULL_REFUND.html">Refund Additional Core Hull</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ADDITIONAL_FRONT_ARMOUR.html">Additional Front Armour</a></td>
                    <td>yes</td>
                    <td align="right">50000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ADDITIONAL_FRONT_ARMOUR_REFUND.html">Refund Additional Front Armour</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ANTISAPPER.html">Anti-Sapper Shield</a></td>
                    <td>yes</td>
                    <td align="right">200000</td>
                    <td align="center">14+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ANTISAPPER_REFUND.html">Refund Anti-Sapper Shield</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">14+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_BIGSHCAP.html">Big Shield Capacitors</a></td>
                    <td>yes</td>
                    <td align="right">100000</td>
                    <td align="center">4+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_BIGSHCAP2.html">Big Shield Capacitors 2</a></td>
                    <td>yes</td>
                    <td align="right">200000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_BIGSHCAP2_REFUND.html">Refund Big Shield Capacitors 2</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_BIGSHCAP3.html">Station Shield Capacitors</a></td>
                    <td>yes</td>
                    <td align="right">1000000</td>
                    <td align="center">100+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_BIGSHCAP_REFUND.html">Refund Big Shield Capacitors</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">4+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUMMY1.html">1t Dummy</a></td>
                    <td>yes</td>
                    <td align="right">100</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUMMY10.html">10t Dummy</a></td>
                    <td>yes</td>
                    <td align="right">1000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUMMY100.html">100t Dummy</a></td>
                    <td>yes</td>
                    <td align="right">10000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUMMY100_REFUND.html">Refund 100t Dummy</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUMMY10_REFUND.html">Refund 10t Dummy</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUMMY1_REFUND.html">Refund 1t Dummy</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUMMY5.html">5t Dummy</a></td>
                    <td>yes</td>
                    <td align="right">500</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUMMY50.html">50t Dummy</a></td>
                    <td>yes</td>
                    <td align="right">5000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUMMY50_REFUND.html">Refund 50t Dummy</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUMMY5_REFUND.html">Refund 5t Dummy</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_EEG.html">Emergency Energy Generator</a></td>
                    <td>yes</td>
                    <td align="right">100000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_EEG_REFUND.html">Refund Emergency Energy Generator</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ELECTRONICS_BOX.html">Electronics Box</a></td>
                    <td>yes</td>
                    <td align="right">2000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_EQUIPMENT_BOX.html">Equipment Box</a></td>
                    <td>yes</td>
                    <td align="right">1000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_EQUIPMENT_BOX_REFUND.html">Refund Equipment Box</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_EQUIPMENT_BOX_REPAIR.html">Repair Boxes and Dummy Eqs in one step</a></td>
                    <td>yes</td>
                    <td align="right">200</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ERB.html">Engine Repair Bot</a></td>
                    <td>yes</td>
                    <td align="right">10000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ESG.html">Emergency Shield Generator</a></td>
                    <td>yes</td>
                    <td align="right">100000</td>
                    <td align="center">12+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ESG_REFUND.html">Refund Emergency Shield Generator</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">12+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDARMOUR_III.html">Hard Armour</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">100+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDARMOUR_V.html">Hard Armour V</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">100+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDARMOUR_X.html">Hard Armour X</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">100+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDNOSE.html">Hard Nose</a></td>
                    <td>yes</td>
                    <td align="right">50000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDNOSE_REFUND.html">Refund Hard Nose</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_1.html">Hard Shield I</a></td>
                    <td>yes</td>
                    <td align="right">10000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_10.html">Hard Shield X</a></td>
                    <td>yes</td>
                    <td align="right">100000</td>
                    <td align="center">14+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_1_REFUND.html">Refund Hard Shield I</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_2.html">Hard Shield II</a></td>
                    <td>yes</td>
                    <td align="right">20000</td>
                    <td align="center">6+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_3.html">Hard Shield III</a></td>
                    <td>yes</td>
                    <td align="right">30000</td>
                    <td align="center">7+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_4.html">Hard Shield IV</a></td>
                    <td>yes</td>
                    <td align="right">40000</td>
                    <td align="center">8+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_5.html">Hard Shield V</a></td>
                    <td>yes</td>
                    <td align="right">50000</td>
                    <td align="center">9+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_6.html">Hard Shield VI</a></td>
                    <td>yes</td>
                    <td align="right">60000</td>
                    <td align="center">10+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_7.html">Hard Shield VII</a></td>
                    <td>yes</td>
                    <td align="right">70000</td>
                    <td align="center">11+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_8.html">Hard Shield VIII</a></td>
                    <td>yes</td>
                    <td align="right">80000</td>
                    <td align="center">12+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_9.html">Hard Shield IX</a></td>
                    <td>yes</td>
                    <td align="right">90000</td>
                    <td align="center">13+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HARDSHIELD_REPAIR.html">Repair Hard Shield</a></td>
                    <td>yes</td>
                    <td align="right">5000</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HTCAT.html">High-Tech Catalyst</a></td>
                    <td>yes</td>
                    <td align="right">100000</td>
                    <td align="center">12+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HTCAT_REFUND.html">Refund High-Tech Catalyst</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">12+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_INJECTOR_BOX.html">Injector Box</a></td>
                    <td>yes</td>
                    <td align="right">2000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_LIFE_BOX.html">Life Box</a></td>
                    <td>yes</td>
                    <td align="right">2000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_REG.html">Renewable Energy Generator</a></td>
                    <td>yes</td>
                    <td align="right">50000</td>
                    <td align="center">3+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_REG_REFUND.html">Refund Renewable Energy Generator</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">3+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SAPPERNULLIFIER.html">Sapper Nullifier</a></td>
                    <td>yes</td>
                    <td align="right">300000</td>
                    <td align="center">15+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SHIELD_BOX.html">Shield Box</a></td>
                    <td>yes</td>
                    <td align="right">2000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_VERYHARDNOSE.html">Very Hard Nose</a></td>
                    <td>yes</td>
                    <td align="right">100000</td>
                    <td align="center">12+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_VERYVERYHARDNOSE.html">Very Very Hard Nose</a></td>
                    <td>yes</td>
                    <td align="right">1000000</td>
                    <td align="center">15+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/constrictor-player.html">constrictor-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/drones.html">drones</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/gecko-player.html">gecko-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hard-adder.html">Hard Adder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hard-anaconda.html">Hard Anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hard-asp.html">Hard Asp</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hard-boa.html">Hard Boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hard-boa2.html">Hard Boa Mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hard-cobra3.html">Hard Cobra Mk III</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hard-cobramk1.html">Hard Cobra Mk I</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hard-moray.html">Hard Moray</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hard-python.html">Hard Python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardadder-player.html">hardadder-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardanaconda-player.html">hardanaconda-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardanacondax.html">Anaconda X</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardanacondax-pirate.html">Granite Anaconda X</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardasp-pirate.html">Granite Asp</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardasp-player.html">hardasp-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardasp-police.html">Police Asp</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardboa-pirate.html">Granite Boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardboa-player.html">hardboa-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardboa2-pirate.html">Granite Boa Mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardboa2-player.html">hardboa2-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardcobra3-pirate.html">Granite Cobra Mk III</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardcobra3-player.html">hardcobra3-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardcobramk1-player.html">hardcobramk1-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/harddrone.html">Hard Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardelance.html">Har-de-Lance</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardelance-pirate.html">Granite Fer-de-Lance</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardelance-player.html">hardelance-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardescape-capsule-player.html">Hard Pod</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardmoray-pirate.html">Granite Moray</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardmoray-player.html">hardmoray-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardpython-pirate.html">Granite Python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardpython-player.html">hardpython-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardship.html">HardShip</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardship-miniblueturret.html">Mini Blue Turret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardship-miniredturret.html">Mini Red Turret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardship-miniturret.html">Mini Turret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardship-strongblueturret.html">Strong Blue Turret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardship-strongredturret.html">Strong Red Turret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardship-strongturret.html">Strong Turret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hardship-turret.html">Hard Turret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/krait-player.html">krait-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laserdrone.html">Laser Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mamba-player.html">mamba-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/piratedrone.html">piratedrone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/pirateharddrone.html">Granite Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/policedrone.html">Police Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/policeharddrone.html">Hard Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/shuttle-player.html">shuttle-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/sidewinder-player.html">sidewinder-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/tharglet-player.html">tharglet-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/thargoid-player.html">thargoid-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/transporter-player.html">transporter-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/viper-interceptor-player.html">viper-interceptor-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/viper-player.html">viper-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/worm-player.html">worm-player</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/armourrepair.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;armourrepair&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Repair Additional Armour and Core Hull Equipments if damaged.&quot;;
this.version     = &quot;1.0&quot;;

this.allowAwardEquipment = function(eqKey, ship, context)
{
	if(eqKey===&quot;EQ_ADDITIONAL_ARMOUR_REPAIR&quot; &amp;&amp; ship === player.ship &amp;&amp; context === &quot;purchase&quot;
		&amp;&amp; ( player.ship.equipmentStatus(&quot;EQ_ADDITIONAL_FRONT_ARMOUR&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
		|| player.ship.equipmentStatus(&quot;EQ_ADDITIONAL_AFT_ARMOUR&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
		|| player.ship.equipmentStatus(&quot;EQ_ADDITIONAL_CORE_HULL&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
		|| player.ship.equipmentStatus(&quot;EQ_HARDNOSE&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
		|| player.ship.equipmentStatus(&quot;EQ_VERYHARDNOSE&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
		|| player.ship.equipmentStatus(&quot;EQ_VERYVERYHARDNOSE&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
		|| player.ship.equipmentStatus(&quot;EQ_EEG&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
		|| player.ship.equipmentStatus(&quot;EQ_ESG&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
		|| player.ship.equipmentStatus(&quot;EQ_HTCAT&quot;) === &quot;EQUIPMENT_DAMAGED&quot; &amp;&amp; player.bounty == 0
		|| player.ship.equipmentStatus(&quot;EQ_REG&quot;) === &quot;EQUIPMENT_DAMAGED&quot; &amp;&amp; player.bounty &gt; 0 ) )
		return true;
	else return false;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/eqboxrepair.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;eqboxrepair&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Repair Additional Armour equipments if damaged.&quot;;
this.version     = &quot;1.0&quot;;

this.allowAwardEquipment = function(eqKey, ship, context)
{
	if(eqKey===&quot;EQ_EQUIPMENT_BOX_REPAIR&quot; &amp;&amp; ship === player.ship &amp;&amp; context === &quot;purchase&quot;
		&amp;&amp; player.ship.equipmentStatus(&quot;EQ_EQUIPMENT_BOX&quot;) === &quot;EQUIPMENT_DAMAGED&quot; )
		return true;
	else return false;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/hardarmour.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;hardarmour&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Ship script to call a function to give back the energy loss which is prevented by armour&quot;;
this.version     = &quot;1.0&quot;;

this.shipTakingDamage = function(amount, whom, type) {
//	if(whom.isPlayer) player.consoleMessage(Math.floor(amount)+&quot; --&gt; &quot;+this.ship.name);//debug
	worldScripts[&quot;hardships&quot;].$HardShips_TakingDamage(this.ship, amount, whom, type);
}

this.shipDied = function(whom, why) {
	var a = worldScripts[&quot;hardships&quot;].$HardShips_Alloys[ worldScripts[&quot;hardships&quot;].$HardShips_Ships.indexOf(this.ship) ];
	var min = worldScripts[&quot;hardships&quot;].$HardShips_ArmourMinToSpawnAlloy;
	if( a &gt; min ) this.ship.spawnOne(&quot;alloy&quot;);
	if( a &gt; 2 * min ) this.ship.spawnOne(&quot;alloy&quot;);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/hardescape-capsule-player.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;hardescape-capsule-player&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Set the shields to 0&quot;;
this.version     = &quot;1.0&quot;;

this.shipSpawned = function() {
	if(this.ship.isPlayer)  {
		this.$EscapeCapsulePlayerFCB = addFrameCallback(function (delta)
			{
				if(player.ship.forwardShield &gt; 0 || player.ship.aftShield &gt; 0) {
					player.ship.forwardShield = 0; //no shield on escape capsule
					player.ship.aftShield = 0;
				}
			});
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/hardmenu.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;hardmenu&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Hard Ships with armours and defensive equipments&quot;;

//customizable properties
this.$HardMenu_StartCredits = 100000; //Buy your first ship from this, the rest will be your starting money
this.$HardMenu_StartFuel = 0; //set to 7 if you want to start with full tank
this.$HardMenu_TestDriveTime = 20; //minutes

//internal properties, should not touch
this.$HardMenu_TestDriveTimer = null;
this.$HardMenu_TestDriveTimerEnd = null;
this.$HardMenu_TestDriveTimerEnd2 = null;
this.$HardMenu_Name = [ &quot;hardcobra3-player&quot;,
	&quot;hardcobramk1-player&quot;,
	&quot;hardadder-player&quot;,
	&quot;hardmoray-player&quot;,
	&quot;hardanaconda-player&quot;,
	&quot;hardasp-player&quot;,
	&quot;hardboa-player&quot;,
	&quot;hardboa2-player&quot;,
	&quot;hardelance-player&quot;,
	&quot;hardpython-player&quot;,
	&quot;gecko-player&quot;,//90k
	&quot;krait-player&quot;,//80k
	&quot;mamba-player&quot;,//85k
	&quot;sidewinder-player&quot;,//75k
	&quot;shuttle-player&quot;,//guess:20k
	&quot;transporter-player&quot;,//guess:40k
	&quot;worm-player&quot;,//guess:30k
	&quot;viper-player&quot;,//520k
	&quot;viper-interceptor-player&quot;,//620k
	&quot;constrictor-player&quot;,//10M
	&quot;thargoid-player&quot;,//guess:10M
	&quot;tharglet-player&quot;];//guess:200k
this.$HardMenu_LastMainMenuItem = 0;
this.$HardMenu_serviceLevel = 95;

this.startUp = function() {
	if( worldScripts[&quot;start_choices&quot;] ) delete worldScripts[&quot;start_choices&quot;].guiScreenChanged;
}

this.guiScreenChanged = function(to, from) {
	if( missionVariables.oolite_tutorial ) return;
	//start in HardCobra v1.0 if press F1 before choose any ship
	if( !worldScripts[&quot;rocketmenu&quot;] &amp;&amp; ( from == &quot;GUI_SCREEN_INTRO2&quot; || from == &quot;GUI_SCREEN_NEWGAME&quot;)
		&amp;&amp; to == &quot;GUI_SCREEN_STATUS&quot;) {
//		log(this.name, oolite.compareVersion(&quot;1.79&quot;)+&quot; &quot;+player.ship.dataKey);//debug
		if( 0 &lt; oolite.compareVersion(&quot;1.79&quot;) //if version is less than 1.79
 			//or the ship in hardships-menu.oolite-save loaded by scenario.plist
			|| player.ship.dataKey == &quot;hardcobra3-player&quot; ) { //to allow starting in hauler, etc.
			this.$HardMenu_ReplacePlayerShip2(this.$HardMenu_Name[0], 0); 
			this.$HardMenu_NewGameScreen();
		}
	}
	delete this.guiScreenChanged;
}

this.shipWillExitWitchspace = function() {//place some HardShip into the system
	if(this.ship === player.ship &amp;&amp; !system.isInterstellarSpace) {
		//setup the ambush, less probable in safe governments
		if (Math.random() &gt; system.government / 7 ) {//government:0-7 Anarchy-Corporate State
			//more pirate with techlevel and unsafety
			var tech = Math.random() * system.techLevel / 5;//same bonus to pirates and police
			var num = Math.ceil(tech + ( 7 - system.government) / 2);//number of pirate ships, 1-7
			var rnum = 1 + Math.floor(Math.random() * (num - 1));//about the half is hardpirate
			var radius = 10000 + Math.random() * 30000;
			system.addShips(&quot;hardpirate&quot;, rnum, player.ship.position, radius);
			if(num &gt; rnum) system.addShips(&quot;pirate&quot;, num - rnum, player.ship.position, radius);
			if ( system.government &gt; 0 ) {//no police in Anarchy
				//more police with techlevel and safety
				num = Math.ceil(tech + system.government / 3);///number of police ships, 1-5 
				rnum = Math.floor(1 + Math.random() * (num - 1));//about the half is hardpolice
				radius = 1000 + Math.random() * 29000; //closer to the player
				if(rnum &gt; 0) system.addShips(&quot;hardpolice&quot;, rnum, player.ship.position, radius);
				if(num &gt; rnum) system.addShips(&quot;police&quot;, num - rnum, player.ship.position, radius);
			}
		}
		this.$HardMenu_AddHardShipsToTheSystem();
	}
}

this.shipWillLaunchFromStation = function() {
	player.ship.hudHidden = false;
	this.$HardMenu_AddHardShipsToTheSystem();
	//Test Drive
	if(!this.$HardMenu_TestDriveTimer &amp;&amp; missionVariables.HardShips_LoanAtStart
		&amp;&amp; missionVariables.HardShips_LoanAtStart&lt;0) {
		missionVariables.HardShips_TestDriveTime = this.$HardMenu_TestDriveTime;//minutes
		this.$HardMenu_TestDriveTimer = new Timer(this, this.$HardMenu_TestDrive, 0, 60);
	}
}

this.$HardMenu_AddHardShipsToTheSystem = function() {
	if( system.isInterstellarSpace ) return;
	system.addShips(&quot;policedrone&quot;, 1, system.mainStation.position, 20000);//demo
	system.addShips(&quot;policeharddrone&quot;, 1, system.mainStation.position, 20000);//demo
	//setup a hardShip combat somewhere between the witchpoint and the planet
	var pos = player.ship.position;
	var place = Math.random() * 0.9; //here will be the ships
	var ships = system.addShipsToRoute(&quot;hardtrader&quot;, 1, place, &quot;wp&quot;);
	//player.consoleMessage(&quot;addShips &quot;+ships);
	//player.consoleMessage(pos.x+&quot; &quot;+pos.y+&quot; &quot;+pos.z);	
	if(ships) if(ships[0]) if(ships[0].position) pos = ships[0].position;
	//player.consoleMessage(&quot;pos &quot;+pos);
	system.addShips(&quot;hardhunter&quot;, 1, Vector3D(pos.x, pos.y, pos.z), 10000);
	system.addShips(&quot;hardpirate&quot;, 3, pos);
	if ( system.government &gt; 0 ) system.addShips(&quot;hardpolice&quot;, 1, pos); //no police in Anarchy		
	//add sun guards
	system.addShipsToRoute(&quot;hardpirate&quot;, 2, 0.9, &quot;ws&quot;);
	system.addShipsToRoute(&quot;hardpirate&quot;, 2, 0.9, &quot;ps&quot;);
	//add solo ships
	system.addShipsToRoute(&quot;hardtrader&quot;, 1, Math.random(), &quot;wp&quot;);
	system.addShipsToRoute(&quot;hardtrader&quot;, 1, Math.random(), &quot;ps&quot;);
	system.addShipsToRoute(&quot;hardhunter&quot;, 1, Math.random(), &quot;ws&quot;);
	system.addShipsToRoute(&quot;hardpirate&quot;, 1, Math.random(), &quot;wp&quot;);
	system.addShipsToRoute(&quot;hardpirate&quot;, 1, Math.random(), &quot;ps&quot;);
	system.addShipsToRoute(&quot;hardpirate&quot;, 1, Math.random(), &quot;ws&quot;);
	if ( system.government &gt; 0 ) //no police in Anarchy
		system.addShipsToRoute(&quot;hardpolice&quot;, 1, Math.random(), &quot;wp&quot;);
}

this.$HardMenu_TestDrive = function() {
	var t = missionVariables.HardShips_TestDriveTime;
	if(t &gt; 0) {
		if(t == this.$HardMenu_TestDriveTime || t &lt; 6)
			player.commsMessage(t+&quot; minutes left from your test drive.&quot;,10);
		missionVariables.HardShips_TestDriveTime--;
	} else {//time out
		missionVariables.HardShips_TestDriveTime = 0;
		missionVariables.HardShips_LoanAtStart = 0;
		//player.ship.launch();
		player.consoleMessage(&quot;Thank you for the testing! Your game will be over in 10 seconds.&quot;,5);
		if(this.$HardMenu_TestDriveTimer) {
			this.$HardMenu_TestDriveTimer.stop();
			delete this.$HardMenu_TestDriveTimer;
		}
		this.$HardMenu_TestDriveTimerEnd = new Timer(this, this.$HardMenu_TestDriveEnd, 5, 0);
	}
}

this.$HardMenu_TestDriveEnd = function() {
	player.consoleMessage(&quot;You can begin new game and select a ship.&quot;,5);
	if(this.$HardMenu_TestDriveTimerEnd) {
		this.$HardMenu_TestDriveTimerEnd.stop();
		delete this.$HardMenu_TestDriveTimerEnd;
	}
	this.$HardMenu_TestDriveTimerEnd = new Timer(this, this.$HardMenu_TestDriveEnd2, 5, 0);
}

this.$HardMenu_TestDriveEnd2 = function() {
	if(this.$HardMenu_TestDriveTimerEnd) {
		this.$HardMenu_TestDriveTimerEnd.stop();
		delete this.$HardMenu_testDriveTimerEnd;
	}
	player.ship.launch();//needed to explode
	player.ship.explode();//Game Over
}

this.$HardMenu_ShipConfirmed = function(shipid) {
	player.ship.hudHidden = false;
	player.ship.fuel = this.$HardMenu_StartFuel;
	if(shipid == 5) {//HardRacer start with a missile to test
		player.ship.awardEquipment(&quot;EQ_MISSILE&quot;);
	}
	if(missionVariables.HardShips_LoanAtStart &amp;&amp; missionVariables.HardShips_LoanAtStart&lt;0 
	  || player.ship.dataKey == &quot;hardescape-capsule-player&quot;)
		player.ship.fuel = 7;//test ship or ecape pod, needed to Injectors
	var credits = this.$HardMenu_StartCredits - player.ship.price; //less than 0 if test drive
	missionVariables.HardShips_LoanAtStart = credits;//trigger the test drive timer if negative
	player.credits = credits; //the game set it to 0 if negative
}

this.$HardMenu_ReplacePlayerShip = function(shipname) {
	this.$HardMenu_ReplacePlayerShip2(shipname, Math.floor(Math.random()*32767) ); //must give correct number to make other entityPersonalyit than 0
}

this.$HardMenu_ReplacePlayerShip2 = function(shipname, pers) {
//	player.consoleMessage(player.ship.name);//debug
	player.replaceShip(shipname, pers);
	player.replaceShip(shipname, pers);//bugfix for eqs with conditions scripts: need double replace to work!
	if(worldScripts[&quot;shipversion&quot;]) {
		var shipVersion = worldScripts[&quot;shipversion&quot;].$ShipVersion_Int(player.ship);
		if(player.ship.equipmentStatus(&quot;EQ_SHIP_VERSION_&quot;+shipVersion) === &quot;EQUIPMENT_UNAVAILABLE&quot;)
			player.ship.awardEquipment(&quot;EQ_SHIP_VERSION_&quot;+shipVersion);
	}
	if(worldScripts[&quot;hardships&quot;]) {
		if( player.ship.scriptInfo ) {
			var h = parseInt(player.ship.scriptInfo.hardarmour); //award Hard Armour equipment to show version
			if( h &gt; 0 &amp;&amp; player.ship.equipmentStatus(&quot;EQ_HARDARMOUR_III&quot;) == &quot;EQUIPMENT_UNAVAILABLE&quot;
				&amp;&amp; player.ship.equipmentStatus(&quot;EQ_HARDARMOUR_V&quot;) == &quot;EQUIPMENT_UNAVAILABLE&quot;
				&amp;&amp; player.ship.equipmentStatus(&quot;EQ_HARDARMOUR_X&quot;) == &quot;EQUIPMENT_UNAVAILABLE&quot; ) {
				var v = &quot;III&quot;;
				if( h &gt;= 10 ) v = &quot;X&quot;;
				else if( h &gt;= 5 ) v = &quot;V&quot;;
				player.ship.awardEquipment(&quot;EQ_HARDARMOUR_&quot;+v);
			}
		}
	}
//	player.consoleMessage(player.ship.name);//debug
}

this.$HardMenu_GetPlayerShipData = function() { //called from shipversion.js of Ship Version OXP also
	//detailed ship info old version, new can be found in rocketmenu.js of the RocketShips OXP
	player.ship.hudHidden = true;
	var equip=&quot;&quot;;
	var s=&quot;&quot;; 
	s=player.ship.forwardWeapon;
	if( s!=null ) equip+=&quot;Forward &quot;+s.name;
	s=player.ship.aftWeapon;
	if( s!=null ) equip+=&quot;, Aft &quot;+s.name;
	s=player.ship.portWeapon;
	if( s!=null ) equip+=&quot;\nPort &quot;+s.name;
	s=player.ship.starboardWeapon;
	if( s!=null ) equip+=&quot;, Starboard &quot;+s.name;
	if(equip.length &gt; 0) equip+=&quot;\n&quot;;
	else equip+=&quot;No Laser\n&quot;;
	var eqs = &quot;&quot;;
	var n = &quot;&quot;;
	var eq = player.ship.equipment;
	var i=-1;
	while(eq[++i]) {
		n = eq[i].name;
//		eqs += n + &quot;, &quot;; if( n.length == 0 &amp;&amp; !skipped ) { //debug
		if( n.length &gt; 0 ) eqs += n + &quot;, &quot;;
		else {	//skip noname eqs awarded by NumericHUD to avoid timeLimit error
			//bugfix for timeLimit caused by many noname eqs from NumericHUD on slow computer:
			//[script.javaScript.timeLimit] OperationCallback (OOJSEngineTimeManagement.m:221):
			//***** ERROR: Script &quot;hardmenu&quot; ran for 1.07 seconds and has been terminated.
			for( var j = i + 10; j &lt; eq.length; j+=10 ) {
				if( eq[j].name.length != 0 ) {
					i = j - 10; //end of skip
					j = eq.length;
				}
			}
			while( i &lt; eq.length &amp;&amp; eq[i].name.length == 0 ) i++;
			i--;
		}
	}
	eqs = eqs.substr(0, eqs.length - 2); //cut last comma
	if( eqs.length &gt; 0 ) equip+=eqs+&quot;\n\n&quot;;
	else equip+=&quot;\n&quot;;//empty line before desc if no eqs
	var desc = &quot;&quot;;
	var sh = player.ship.maxForwardShield;
	if( player.ship.dataKey.indexOf(&quot;escape-capsule-player&quot;) &gt; -1 ) sh = 0;
	else if( worldScripts[&quot;shieldequalizercapacitors&quot;] ) {
		if( player.ship.equipmentStatus(&quot;E//internal properties, should not touchQ_BIGSHCAP&quot;) == &quot;EQUIPMENT_OK&quot;
			&amp;&amp; player.ship.equipmentStatus(&quot;EQ_FORWARD_SHIELD_CAPACITOR&quot;) == &quot;EQUIPMENT_OK&quot; )
			sh = sh + &quot;+256&quot;;
		else if( player.ship.equipmentStatus(&quot;EQ_FORWARD_SHIELD_CAPACITOR&quot;) == &quot;EQUIPMENT_OK&quot; )
			sh = sh + &quot;+64&quot;;
	}
	if( player.ship.scriptInfo &amp;&amp; player.ship.scriptInfo.buydesc )//show ship description if any
		desc=&quot;\&quot;&quot;+player.ship.scriptInfo.buydesc+&quot;\&quot;\n\n&quot;;
	var psd = &quot;&quot;;//player.ship.displayName+
	var hd = &quot;&quot;;
	if(!player.ship.hasHyperspaceMotor ) hd = &quot;   No Hyperdrive&quot;;
	psd += &quot;Speed: &quot;+(player.ship.maxSpeed)+&quot; mLS  Thrust: &quot;+player.ship.maxThrust+
		&quot;  Pitch: &quot;+Math.round(player.ship.maxPitch*100)/100+
		&quot;  Roll: &quot;+Math.round(player.ship.maxRoll*100)/100+
		&quot;  Yaw: &quot;+Math.round(player.ship.maxYaw*100)/100+hd+
//		&quot;  Version: &quot;+this.$shipVersion(player.ship)+
//		&quot;  Service &quot;+player.ship.serviceLevel+
		&quot;\nCargo Space: &quot;+player.ship.cargoSpaceCapacity;
	if( player.ship.scriptInfo &amp;&amp; player.ship.scriptInfo.cargoext &amp;&amp; parseInt(player.ship.scriptInfo.cargoext) &gt; 0 )
		psd += &quot;+&quot;+parseInt(player.ship.scriptInfo.cargoext);
	var r = &quot;&quot;;
	if( player.ship.scriptInfo &amp;&amp; player.ship.scriptInfo.recharge &amp;&amp; parseInt(player.ship.scriptInfo.recharge) &gt; 0 )
		r = &quot;  Recharge: &quot;+parseInt(player.ship.scriptInfo.recharge);
	var sp = &quot;&quot;;
	var sph = Math.round(player.ship.collisionRadius*player.ship.collisionRadius*Math.PI);
	if( sph &lt; 1000000 ) sp = sph;
	else sp = Math.round(sph/100000)/10+&quot;k&quot;;//show large sphere in km^2
	psd += &quot;t  Mass: &quot;+Math.max(Math.round(player.ship.mass/1000), 1)+ //min.1t
		&quot;t  Size: &quot;+Math.round(player.ship.boundingBox.x)+&quot;*&quot;+
		Math.round(player.ship.boundingBox.y)+&quot;*&quot;+Math.round(player.ship.boundingBox.z)+
		&quot;m Radius: &quot;+Math.round(player.ship.collisionRadius)+&quot;m Sphere: &quot;+sp+
		&quot;m^2\nEnergy: &quot;+player.ship.maxEnergy+r+&quot;  Shield: &quot;+sh+&quot;  Max.Missile: &quot;+player.ship.missileCapacity;
	if( player.ship.scriptInfo &amp;&amp; player.ship.scriptInfo.hardarmour &amp;&amp; parseInt(player.ship.scriptInfo.hardarmour) &gt; 0 )
		psd += &quot;\nHard Armour deflect &quot;+parseInt(player.ship.scriptInfo.hardarmour)+&quot; points from any damage&quot;;
	psd += &quot;\n&quot;+equip+desc+&quot;Price: &quot;+formatCredits(player.ship.price, false, true);
	return(psd);
}

this.$HardMenu_NewGameScreen = function() {
	player.ship.hudHidden = true;
	player.ship.removeEquipment(&quot;EQ_FUEL_INJECTION&quot;);
	player.ship.removeEquipment(&quot;EQ_FUEL_SCOOPS&quot;);
	player.ship.removeEquipment(&quot;EQ_WEAPON_MINING_LASER&quot;);
	var options = {
                &quot;_0&quot; : &quot;HardShips&quot;,
		&quot;_1&quot; : &quot;Classic: Cobra Mk III&quot;,
		&quot;_2&quot; : &quot;Fast-track: Cobra Mk III with extra equipment&quot;,
		&quot;_3&quot; : &quot;Medium: Cobra Mk I&quot;,
		&quot;_4&quot; : &quot;Hard: Adder&quot;,
		&quot;_5&quot; : &quot;Harder: Adder Broke&quot;,
		&quot;_6&quot; : &quot;Hardest: Escaped Broke&quot;,
		&quot;_7&quot; : &quot;Hauler: Beaten-up Python&quot;,
		&quot;_8&quot; : &quot;Exotic Ships&quot;
	};
	mission.runScreen({
		title: &quot;New Game Selection&quot; ,
		message: &quot;Greetings Commander. You are about to start your new career of space flight, combat and trading starting from the space station orbiting the planet Lave. Before embarking you will need to select a starting ship.\n\n&quot;+
			&quot;HardShips covered by orange Hard Armour to partially deflect laser and other attacks at a cost of the lower acceleration and brake.\n\n&quot;+
			&quot;Costly HardShips are available for a test drive only: you will set back here in &quot;+this.$HardMenu_TestDriveTime+&quot; minutes. There are more choices below if you want the Classic start or some harder situations.\n\nAfter having made your choice, go to options and choose your name by saving the game.&quot;,
		choices: options,
		initialChoicesKey: &quot;_&quot;+this.$HardMenu_LastMainMenuItem,
		model: &quot;[hard-cobra3]&quot;,
		spinModel: true,
		background: &quot;start_choices_bg.png&quot;
	},		
	function (choice)
	{
                if (choice === &quot;_0&quot;) this.$HardMenu_Choice(0);
                else if (choice === &quot;_1&quot;) this.$HardMenu_Choice(1);
                else if (choice === &quot;_2&quot;) this.$HardMenu_Choice(2);
                else if (choice === &quot;_3&quot;) this.$HardMenu_Choice(3);
		else if (choice === &quot;_4&quot;) this.$HardMenu_Choice(4);
		else if (choice === &quot;_5&quot;) this.$HardMenu_Choice(5);
		else if (choice === &quot;_6&quot;) this.$HardMenu_Choice(6);
		else if (choice === &quot;_7&quot;) this.$HardMenu_Choice(7);
		else if (choice === &quot;_8&quot;) this.$HardMenu_Choice(8);
	});		
}

this.$HardMenu_Choice = function(select) {
	this.$HardMenu_LastMainMenuItem = select;
	player.ship.hudHidden = true;
        var shipnum = 0;
	switch(select) {
                case 0:
			this.$HardMenu_NewGameScreen2(0);
			break;
		case 1: //classic start
			this.$HardMenu_ReplacePlayerShip2(&quot;cobra3-player&quot;, 0); //always get ShipVersion 1.0
			while (player.ship.missiles.length &lt; 3)
				player.ship.awardEquipment(&quot;EQ_MISSILE&quot;);
			player.credits = 100;
			player.ship.fuel = 100;
			var dname=player.ship.displayName;
			if( worldScripts[&quot;shipversion&quot;] ) dname = worldScripts[&quot;shipversion&quot;].$ShipVersion_PlayerShipName();
			var options = {
				&quot;1_NO&quot; : &quot;Go Back&quot;,
				&quot;2_YES&quot; : &quot;Confirm Choice&quot;
			};
			mission.runScreen({
				title: &quot;Classic Start&quot; ,
				message: &quot;Ship: &quot;+dname+&quot;\nSpeed: 0.35 lm\nCargo Space: 20 t\nBase Equipment: Pulse Laser, 3 Missiles\n\Fuel: 7.0 ly\nCredits: &quot;+formatCredits(100, true, true)+
					&quot;\n\n\&quot;The most successful medium-size ship ever built and a versatile fighter/trader ship.\&quot;&quot;,
				choices: options,
				model: &quot;[cobra3-player]&quot;,
				background: &quot;start_choices_bg.png&quot;
			},
			function (choice) {
				if (choice === &quot;1_NO&quot;) this.$HardMenu_NewGameScreen();
			});
			break;
		case 2: //easy start
			this.$HardMenu_ReplacePlayerShip2(&quot;cobra3-player&quot;, 0); //always get ShipVersion 1.0
			player.credits = 100;
			player.ship.fuel = 100;
			while (player.ship.missiles.length &lt; 3)
				player.ship.awardEquipment(&quot;EQ_MISSILE&quot;);
			player.ship.awardEquipment(&quot;EQ_FUEL_INJECTION&quot;);
			player.ship.awardEquipment(&quot;EQ_FUEL_SCOOPS&quot;);
			player.ship.aftWeapon = &quot;EQ_WEAPON_MINING_LASER&quot;;
			var dname=player.ship.displayName;
			if( worldScripts[&quot;shipversion&quot;] ) dname = worldScripts[&quot;shipversion&quot;].$ShipVersion_PlayerShipName();
			var options = {
				&quot;1_NO&quot; : &quot;Go Back&quot;,
				&quot;2_YES&quot; : &quot;Confirm Choice&quot;
			};
			mission.runScreen({
				title: &quot;Fast-track Start&quot; ,
				message: &quot;Ship: &quot;+dname+&quot;\nSpeed: 0.35 lm\nCargo Space: 20 t\nBase Equipment: Pulse Laser, Mining Laser, 3 Missiles,  Fuel Scoops, Witchspace Fuel Injectors\n\Fuel: 7.0 ly\nCredits: &quot;+formatCredits(100, true, true)+&quot;\n\n* Bounty Hunter: Collect bounties for pirate/fugitive craft destoyed. Capture/rescue escape pods for rewards.\n* Carrier Service: Deliver goods for some-one else and get paid. You can do parcel deliveries right from the start, but for carrier contracts you&#39;ll need a ship with larger cargo bays. Find contracts from the interfaces screen.\n* Miner: Blast the asteroids with your mining laser, scoop the fragments and sell the minerals. Aim for the sun to find asteroids.\n* Passenger Service: Carry passengers for profit. You&#39;ll need a passenger berth installed to do passenger contracts. Find contracts from the interfaces screen.\n* Trader: Buy low-priced commodities on one world and sell at a higher price on another.&quot;,
				choices: options,
				model: &quot;[cobra3-player]&quot;,
				background: &quot;start_choices_bg.png&quot;
			},		
			function (choice) {
				if (choice === &quot;1_NO&quot;) this.$HardMenu_NewGameScreen();
			});					
			break;
		case 3: //medium start
			this.$HardMenu_ReplacePlayerShip2(&quot;cobramk1-player&quot;, 0); //always get ShipVersion 1.0
			player.credits = 100;
			player.ship.fuel = 100;
			var dname=player.ship.displayName;
			if( worldScripts[&quot;shipversion&quot;] ) dname = worldScripts[&quot;shipversion&quot;].$ShipVersion_PlayerShipName();
			var options = {
				&quot;1_NO&quot; : &quot;Go Back&quot;,
				&quot;2_YES&quot; : &quot;Confirm Choice&quot;
			};
			mission.runScreen({
				title: &quot;Medium Start&quot; ,
				message: &quot;Ship: &quot;+dname+&quot;\nSpeed: 0.26 lm\nCargo Space: 10 t\nBase Equipment: Pulse Laser, 1 Missile\n\Fuel: 7.0 ly\nCash: &quot;+formatCredits(100, true, true)+
					&quot;\n\n\&quot;The first truly effective solo fighter/trader ship, but now superceded by the Mk III.\&quot;&quot;,
				choices: options,
				model: &quot;[cobramk1-player]&quot;,
				background: &quot;start_choices_bg.png&quot;
			},
			function (choice) {
				if (choice === &quot;1_NO&quot;) this.$HardMenu_NewGameScreen();
			});
			break;
		case 4: //hard start
			this.$HardMenu_ReplacePlayerShip2(&quot;adder-player&quot;, 0); //always get ShipVersion 1.0
			player.credits = 100;
			player.ship.fuel = 100;
			var dname=player.ship.displayName;
			if( worldScripts[&quot;shipversion&quot;] ) dname = worldScripts[&quot;shipversion&quot;].$ShipVersion_PlayerShipName();
			var options = {
				&quot;1_NO&quot; : &quot;Go Back&quot;,
				&quot;2_YES&quot; : &quot;Confirm Choice&quot;
			};
			mission.runScreen({
				title: &quot;Hard Start&quot; ,
				message: &quot;Ship: &quot;+dname+&quot;\nSpeed: 0.24 lm\nCargo Space: 2+3 t\nBase Equipment: Pulse Laser, 1 Missile, External Heat Shielding\n\Fuel: 7.0 ly\nCash: &quot;+formatCredits(100, true, true)+
				&quot;\n\n\&quot;An agile and compact ship favored by couriers, customizers and professional racers.\&quot;&quot;,
				choices: options,
				model: &quot;[adder-player]&quot;,
				background: &quot;start_choices_bg.png&quot;
			},
			function (choice) {
				if (choice === &quot;1_NO&quot;) this.$HardMenu_NewGameScreen();
			});
			break;
		case 5: //harder start
			this.$HardMenu_ReplacePlayerShip2(&quot;adder-player&quot;, 0); //always get ShipVersion 1.0
			var dname=player.ship.displayName;
			if( worldScripts[&quot;shipversion&quot;] ) dname = worldScripts[&quot;shipversion&quot;].$ShipVersion_PlayerShipName();
			player.credits = 0;
			player.ship.fuel = 0;
			player.ship.removeEquipment(&quot;EQ_HEAT_SHIELD&quot;);
			player.ship.removeEquipment(&quot;EQ_MISSILE&quot;);
			var options = {
				&quot;1_NO&quot; : &quot;Go Back&quot;,
				&quot;2_YES&quot; : &quot;Confirm Choice&quot;
			};
			mission.runScreen({
				title: &quot;Harder Start&quot; ,
				message: &quot;Ship: &quot;+dname+&quot;\nSpeed: 0.24 lm\nCargo Space: 2+3 t\nBase Equipment: Pulse Laser\n\Fuel: 0.0 ly\nCash: &quot;+formatCredits(0, true, true)+
					&quot;\n\n\&quot;An agile and compact ship favored by couriers, customizers and professional racers, although you must find a way to earn credits for fuel, equipment and upgrades.\&quot;&quot;,
				choices: options,
				model: &quot;[adder-player]&quot;,
				background: &quot;start_choices_bg.png&quot;
			},		
			function (choice) {
				if (choice === &quot;1_NO&quot;) {
					player.credits = 100;
					player.ship.fuel = 100;
					player.ship.awardEquipment(&quot;EQ_MISSILE&quot;);
					player.ship.awardEquipment(&quot;EQ_HEAT_SHIELD&quot;);
					this.$HardMenu_NewGameScreen();
				}
			});
			break;
		case 6: //hardest
			player.replaceShip(&quot;hardescape-capsule-player&quot;, 0);
			player.credits = 0;
			player.ship.fuel = 0;
			player.ship.removeEquipment(&quot;EQ_HEAT_SHIELD&quot;);
			player.ship.removeEquipment(&quot;EQ_MISSILE&quot;);
			var dname=player.ship.displayName;
			var options = {
				&quot;1_NO&quot; : &quot;Go Back&quot;,
				&quot;2_YES&quot; : &quot;Confirm Choice&quot;
			};
			mission.runScreen({
				title: &quot;Hard Pod&quot;,
				message: this.$HardMenu_GetPlayerShipData(0),
				choices: options,
				model: &quot;[hardescape-capsule-player]&quot;,
				background: &quot;start_choices_bg.png&quot;
			},
			function (choice) {
				if (choice === &quot;1_NO&quot;) {
					player.credits = 100;
					player.ship.fuel = 100;
					player.ship.awardEquipment(&quot;EQ_MISSILE&quot;);
					player.ship.awardEquipment(&quot;EQ_HEAT_SHIELD&quot;);
					this.$HardMenu_NewGameScreen();
				}
				player.ship.hudHidden = false;
                                player.ship.fuel = 7;
			});
			break;
		case 7: //hauler start
			player.replaceShip(&quot;python-player&quot;, 0);
			this.$HardMenu_serviceLevel = player.ship.serviceLevel;
			player.ship.serviceLevel = 75;
			var options = {
				&quot;1_YES&quot; : &quot;Confirm Choice&quot;,
				&quot;2_NO&quot; : &quot;Go Back&quot;
			};
			mission.runScreen({
				title: &quot;Harder Start&quot; ,
				message: &quot;Ship: Python\nSpeed: 0.20 lm\nCargo Space: 100 t\nBase Equipment: Pulse Laser\n\Fuel: 7.0 ly\nCash: &quot;+formatCredits(100, true, true)+&quot;\n\n\&quot;An ageing design that’s still popular with commanders needing a simple robust freighter. She&#39;s in a bad shape though, be ready for malfunctions until you can afford a maintenance overhaul.\&quot;&quot;,
				choices: options,
				model: &quot;[python-player]&quot;,
				background: &quot;start_choices_bg.png&quot;
			},		
			function (choice) {
				if (choice === &quot;2_NO&quot;) {
					player.ship.serviceLevel = this.$HardMenu_serviceLevel;
					this.$HardMenu_NewGameScreen();
				}
			});	
			break;
                case 8:
			this.$HardMenu_NewGameScreen2(10);
			break;
	}
}

this.$HardMenu_NewGameScreen2 = function(lastship) {
	player.ship.hudHidden = true;
	if( lastship &lt; 0 ) lastship = 0;
	missionVariables.targetAutolock = null;//bugfix for ships equipped with Autolock in shipyard.plist
	if( lastship == 0 ) this.$HardMenu_ReplacePlayerShip2(this.$HardMenu_Name[lastship], 0); //Cobra III always get ShipVersion 1.0
	else this.$HardMenu_ReplacePlayerShip(this.$HardMenu_Name[lastship]);
	if(player.ship.equipmentStatus(&quot;EQ_HEAT_SHIELD&quot;) != &quot;EQUIPMENT_UNAVAILABLE&quot;)
		player.ship.removeEquipment(&quot;EQ_HEAT_SHIELD&quot;);
	while(player.ship.equipmentStatus(&quot;EQ_MISSILE&quot;) != &quot;EQUIPMENT_UNAVAILABLE&quot;)
		player.ship.removeEquipment(&quot;EQ_MISSILE&quot;);
	var shipname = $HardMenu_Name[lastship];
	var dname=player.ship.displayName;
//	log(&quot;hardmenu&quot;,shipname+&quot; &quot;+dname);
	if( worldScripts[&quot;shipversion&quot;] ) dname = worldScripts[&quot;shipversion&quot;].$ShipVersion_PlayerShipName();	
	if( lastship &lt; 10 ) {
		var options = {
			&quot;_&quot; : &quot;Confirm Choice&quot;,
			&quot;_0&quot; : &quot;Hard Cobra Mk III&quot;,
			&quot;_1&quot; : &quot;Hard Cobra Mk I&quot;,
			&quot;_2&quot; : &quot;Hard Adder&quot;,
			&quot;_3&quot; : &quot;Hard Moray&quot;,
			&quot;_4&quot; : &quot;Test: Hard Anaconda&quot;,
			&quot;_5&quot; : &quot;Test: Hard Asp&quot;,
			&quot;_6&quot; : &quot;Test: Hard Boa&quot;,
			&quot;_7&quot; : &quot;Test: Hard Boa Mk2&quot;,
			&quot;_8&quot; : &quot;Test: Har-de-Lance&quot;,
			&quot;_9&quot; : &quot;Test: Hard Python&quot;,
			&quot;X&quot; : &quot;Go Back&quot;
		};		
//player.consoleMessage(this.$HardMenu_Name[lastship]+&quot;[&quot;+player.ship.dataKey.substr(0,player.ship.dataKey.length-7)+&quot;-model]&quot;);
		mission.runScreen({
			title: dname,
			message: this.$HardMenu_GetPlayerShipData(lastship),
			choices: options,
			initialChoicesKey: &quot;_&quot;+(lastship),
			model: &quot;[&quot;+player.ship.dataKey+&quot;]&quot;,//.substr(0,player.ship.dataKey.length-7)+&quot;]&quot;,
			background: &quot;start_choices_bg.png&quot;
		},
		function (choice)
		{
			player.ship.hudHidden = true;
			if (choice == &quot;_0&quot;) this.$HardMenu_NewGameScreen2(0);
			else if (choice == &quot;_1&quot;) this.$HardMenu_NewGameScreen2(1);
			else if (choice == &quot;_2&quot;) this.$HardMenu_NewGameScreen2(2);
			else if (choice == &quot;_3&quot;) this.$HardMenu_NewGameScreen2(3);
			else if (choice == &quot;_4&quot;) this.$HardMenu_NewGameScreen2(4);
			else if (choice == &quot;_5&quot;) this.$HardMenu_NewGameScreen2(5);
			else if (choice == &quot;_6&quot;) this.$HardMenu_NewGameScreen2(6);
			else if (choice == &quot;_7&quot;) this.$HardMenu_NewGameScreen2(7);
			else if (choice == &quot;_8&quot;) this.$HardMenu_NewGameScreen2(8);
			else if (choice == &quot;_9&quot;) this.$HardMenu_NewGameScreen2(9);
			else if (choice == &quot;X&quot;) this.$HardMenu_NewGameScreen();
			this.$HardMenu_ShipConfirmed(lastship);
		});
	} else {
		var options = {
			&quot;_A&quot; : &quot;Confirm Choice&quot;,
			&quot;_B&quot; : &quot;Gecko&quot;,
			&quot;_C&quot; : &quot;Krait&quot;,
			&quot;_D&quot; : &quot;Mamba&quot;,
			&quot;_E&quot; : &quot;Sidewinder&quot;,
			&quot;_F&quot; : &quot;Shuttle&quot;,
			&quot;_G&quot; : &quot;Transporter&quot;,
			&quot;_H&quot; : &quot;Worm&quot;,
			&quot;_I&quot; : &quot;Test: Viper&quot;,
			&quot;_J&quot; : &quot;Test: Viper Interceptor&quot;,
			&quot;_K&quot; : &quot;Test: Constrictor&quot;,
			&quot;_L&quot; : &quot;Test: Thargoid&quot;,
			&quot;_M&quot; : &quot;Test: Tharglet&quot;,
			&quot;X&quot; : &quot;Go Back&quot;
		};		
//player.consoleMessage(this.$HardMenu_Name[lastship]+&quot;[&quot;+player.ship.dataKey.substr(0,player.ship.dataKey.length-7)+&quot;-model]&quot;);
		var init=&quot;B&quot;;
		switch(lastship) {
                	case 10: init=&quot;B&quot;; break;
                	case 11: init=&quot;C&quot;; break;
			case 12: init=&quot;D&quot;; break;
                	case 13: init=&quot;E&quot;; break;
                	case 14: init=&quot;F&quot;; break;
                	case 15: init=&quot;G&quot;; break;
                	case 16: init=&quot;H&quot;; break;
                	case 17: init=&quot;I&quot;; break;
                	case 18: init=&quot;J&quot;; break;
                	case 19: init=&quot;K&quot;; break;
                	case 20: init=&quot;L&quot;; break;
                	case 21: init=&quot;M&quot;; break;
		}
		mission.runScreen({
			title: dname,
			message: this.$HardMenu_GetPlayerShipData(lastship),
			choices: options,
			initialChoicesKey: &quot;_&quot;+init,
			model: &quot;[&quot;+player.ship.dataKey+&quot;]&quot;,//.substr(0,player.ship.dataKey.length-7)+&quot;]&quot;,
			background: &quot;start_choices_bg.png&quot;
		},
		function (choice)
		{
			player.ship.hudHidden = true;
			if (choice == &quot;_B&quot;) this.$HardMenu_NewGameScreen2(10);
			else if (choice == &quot;_C&quot;) this.$HardMenu_NewGameScreen2(11);
			else if (choice == &quot;_D&quot;) this.$HardMenu_NewGameScreen2(12);
			else if (choice == &quot;_E&quot;) this.$HardMenu_NewGameScreen2(13);
			else if (choice == &quot;_F&quot;) this.$HardMenu_NewGameScreen2(14);
			else if (choice == &quot;_G&quot;) this.$HardMenu_NewGameScreen2(15);
			else if (choice == &quot;_H&quot;) this.$HardMenu_NewGameScreen2(16);
			else if (choice == &quot;_I&quot;) this.$HardMenu_NewGameScreen2(17);
			else if (choice == &quot;_J&quot;) this.$HardMenu_NewGameScreen2(18);
			else if (choice == &quot;_K&quot;) this.$HardMenu_NewGameScreen2(19);
			else if (choice == &quot;_L&quot;) this.$HardMenu_NewGameScreen2(20);
			else if (choice == &quot;_M&quot;) this.$HardMenu_NewGameScreen2(21);
			else if (choice == &quot;X&quot;) this.$HardMenu_NewGameScreen();
			this.$HardMenu_ShipConfirmed(lastship);
		});		
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/hardnose.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;hardnose&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Hard Nose check to fit in the Max with the base Hard Armour.&quot;;
this.version     = &quot;1.0&quot;;

this.allowAwardEquipment = function(eqKey, ship, context)
{
	if( ship.mass &lt; 30000 ) return false; //small ship can not get nose
	if( eqKey===&quot;EQ_HARDNOSE&quot; &amp;&amp; (!ship.scriptInfo || !ship.scriptInfo.hardarmour) )
		return true; //can get nose a ship without Hard Armour also
	if( eqKey===&quot;EQ_HARDNOSE&quot; &amp;&amp; ship.scriptInfo &amp;&amp; ship.scriptInfo.hardarmour //awardable only if fit in Max
		&amp;&amp; parseInt(ship.scriptInfo.hardarmour) + 5 &lt;= worldScripts[&quot;hardships&quot;].$HardShips_MaxHardArmour )
		return true;

	if( ship.mass &lt; 130000 ) return false; //only a large ship can get the following things
	if( (eqKey===&quot;EQ_VERYHARDNOSE&quot; || eqKey===&quot;EQ_VERYVERYHARDNOSE&quot;)
		&amp;&amp; (!ship.scriptInfo || !ship.scriptInfo.hardarmour) )
		return true; //can get nose a ship without Hard Armour also
	if( eqKey===&quot;EQ_VERYHARDNOSE&quot; &amp;&amp; ship.scriptInfo &amp;&amp; ship.scriptInfo.hardarmour
		&amp;&amp; parseInt(ship.scriptInfo.hardarmour) + 10 &lt;= worldScripts[&quot;hardships&quot;].$HardShips_MaxHardArmour )
		return true;
	if( eqKey===&quot;EQ_VERYVERYHARDNOSE&quot; &amp;&amp; ship.scriptInfo &amp;&amp; ship.scriptInfo.hardarmour
		&amp;&amp; parseInt(ship.scriptInfo.hardarmour) + 15 &lt;= worldScripts[&quot;hardships&quot;].$HardShips_MaxHardArmour )
		return true;
	return false;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/hardships.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;hardships&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Armour on 6 side and Fuel Leak if the damage break the Core.&quot;;
this.version     = &quot;0.88&quot;;

//customizable properties
this.$HardShips_AlloyStart = 100; //How many damage can be repaired without using alloys from cargo
this.$HardShips_ArmourDivider = 2; //Armour = maxEnergy / ArmourDivider
this.$HardShips_ArmourFixableWith1tAlloy = 100;//How many damage can be repaired using up 1t Alloy
this.$HardShips_ArmourMinToSpawnAlloy = 120; //leave more than the fixable amount with 1t Alloy for some waste
this.$HardShips_FuelLeakRate = 0.1; //ly/second
this.$HardShips_MaxHardArmour = 35; //reduce to 20 if you do not want ships with harder noses than the Military Laser can damage

//internal properties, should not touch
this.$HardShips_Alloys = [];//partial metal left from an 1t alloy in ships to fix later damages
this.$HardShips_AMax = [[0, 0, 0, 0, 0, 0, 0, 0]]; //maximum armour values of the ship given by $HardShips_AllSideFixed()
this.$HardShips_Armour = [[0, 0, 0, 0, 0, 0, 0, 0]]; //6 side plus Core hull plus IronHide armour, the -1. side is allocated to choose random side around facing corner from 0 to 5 but the direction is determine which 3 is possible and the odds also
this.$HardShips_Damaged = [[false, false, false, false, false, false, false, false]]; //from depleted until full restored
this.$HardShips_Debug = false; //Show extra messages to help developing if uncomment the related lines
this.$HardShips_OrigShieldCapMax = 64; //must be equal with the value coded in shieldequalizercapacitors.js
this.$HardShips_Ships = [player.ship]; //this array will contain all spawned ships, the 0. is the player
this.$HardShips_ShipsBigSC = 0; //Big Shield Capacitor existence check on NPCs in timed BigSC setup
this.$HardShips_Side = [&quot;Fore&quot;, &quot;Aft&quot;, &quot;Port&quot;, &quot;Starboard&quot;, &quot;Top&quot;, &quot;Bottom&quot;, &quot;Core&quot;, &quot;IronHide&quot;]; //name of the side
this.$HardShips_Timer = null; //timed repairs
this.$HardShips_TimerB = null; //timer for Big Shield Capacitor setup to surely do after ShipVersion award and customshields setup

//world script events
this.startUp = function() {
	this.$HardShips_Timer = new Timer(this, this.$HardShips_Timed, 0, 1);//in every 1 second
	this.$HardShips_AllSideFixed(player.ship, 0);//initialize player data
	this.$HardShips_Alloys[0] = this.$HardShips_AlloyStart;
	if( worldScripts[&quot;IronHide Armour Script&quot;] &amp;&amp;
		worldScripts[&quot;IronHide Armour Script&quot;].shipTakingDamage ) { //do not get back the double of the lost energy
		delete worldScripts[&quot;IronHide Armour Script&quot;].shipTakingDamage;
	}
}

this.equipmentDamaged = function(equipment) {
	//Hard Armour eq can not be damaged, it is a player-only to display the version.
	var e=&quot;EQ_HARDARMOUR_III&quot;; if(equipment === e) player.ship.setEquipmentStatus(e,&quot;EQUIPMENT_OK&quot;);
	e=&quot;EQ_HARDARMOUR_V&quot;; if(equipment === e) player.ship.setEquipmentStatus(e,&quot;EQUIPMENT_OK&quot;);
	e=&quot;EQ_HARDARMOUR_X&quot;; if(equipment === e) player.ship.setEquipmentStatus(e,&quot;EQUIPMENT_OK&quot;);
	var s = worldScripts[&quot;shieldequalizercapacitors&quot;];
	if( s &amp;&amp; ( equipment == &quot;EQ_BIGSHCAP&quot; || equipment == &quot;EQ_BIGSHCAP2&quot; || equipment == &quot;EQ_BIGSHCAP3&quot; ) ) {
		this.$HardShips_SetupPlayerBigShCap(); //reduce the max value and discharge additional power if any
		s.secforwardshieldcapacitor = Math.min( s.secforwardshieldcapacitormax, s.secforwardshieldcapacitor );
		s.secaftshieldcapacitor = Math.min( s.secaftshieldcapacitormax, s.secaftshieldcapacitor );
	} 
	if( player.ship.equipmentStatus(&quot;EQ_ELECTRONICS_BOX&quot;) == &quot;EQUIPMENT_OK&quot; &amp;&amp;
		( equipment == &quot;EQ_ECM&quot; || equipment == &quot;EQ_SCANNER_SHOW_MISSILE_TARGET&quot;
			|| equipment == &quot;EQ_TARGET_MEMORY&quot; || equipment == &quot;EQ_MULTI_TARGET&quot;
			|| equipment == &quot;EQ_DOCK_COMP&quot; ) ) {
		player.ship.setEquipmentStatus(&quot;EQ_ELECTRONICS_BOX&quot;,&quot;EQUIPMENT_DAMAGED&quot;); //help only once
		player.ship.setEquipmentStatus(equipment,&quot;EQUIPMENT_OK&quot;);
	}
	if( player.ship.equipmentStatus(&quot;EQ_INJECTOR_BOX&quot;) == &quot;EQUIPMENT_OK&quot; &amp;&amp;
		( ( equipment == &quot;EQ_FUEL_INJECTION&quot;
			&amp;&amp; ( !worldScripts[&quot;towbar&quot;] || worldScripts[&quot;towbar&quot;].$TowbarInjectors != 1 ) )
			|| equipment == &quot;EQ_ERB&quot;
			|| equipment == &quot;EQ_Q-CHARGER&quot;
			|| equipment.indexOf(&quot;EQ_BREAKABLE_ENGINE&quot;) &gt; -1 ) ) {
		player.ship.setEquipmentStatus(&quot;EQ_INJECTOR_BOX&quot;,&quot;EQUIPMENT_DAMAGED&quot;); //help only once
		player.ship.setEquipmentStatus(equipment,&quot;EQUIPMENT_OK&quot;);
	} else if( player.ship.equipmentStatus(&quot;EQ_ERB&quot;) == &quot;EQUIPMENT_OK&quot; &amp;&amp;
		( equipment == &quot;EQ_BREAKABLE_ENGINE_SMALL&quot;
		|| equipment == &quot;EQ_BREAKABLE_ENGINE_MEDIUM&quot;
		|| equipment == &quot;EQ_BREAKABLE_ENGINE_LARGE&quot;
		|| equipment == &quot;EQ_BREAKABLE_ENGINE_MONSTER&quot;
		|| equipment == &quot;EQ_FUEL_INJECTION&quot;
		|| equipment == &quot;EQ_Q-CHARGER&quot; ) ) {
			if( player.ship.manifest.machinery &gt; 0 )
				player.consoleMessage(&quot;Engine repair started&quot;, 10);
			else player.consoleMessage(&quot;Engine repair need Machinery&quot;, 10);
		}

	
	if( player.ship.equipmentStatus(&quot;EQ_LIFE_BOX&quot;) == &quot;EQUIPMENT_OK&quot; &amp;&amp;
		( equipment == &quot;EQ_ESCAPE_POD&quot; || equipment == &quot;EQ_PASSENGER_BERTH&quot;
			||  equipment == &quot;EQ_BREAKABLE_HUD_IFF_SCANNER&quot; ) ) {
		player.ship.setEquipmentStatus(&quot;EQ_LIFE_BOX&quot;,&quot;EQUIPMENT_DAMAGED&quot;); //help only once
		player.ship.setEquipmentStatus(equipment,&quot;EQUIPMENT_OK&quot;);
	}
	if( player.ship.equipmentStatus(&quot;EQ_SHIELD_BOX&quot;) == &quot;EQUIPMENT_OK&quot; &amp;&amp;
		( equipment == &quot;EQ_SHIELD_BOOSTER&quot; || equipment == &quot;EQ_NAVAL_SHIELD_BOOSTER&quot;
			|| equipment.indexOf(&quot;SHIELD_CAPACITOR&quot;) &gt; -1
			|| equipment.indexOf(&quot;EQ_BIGSHCAP&quot;) &gt; -1
			|| equipment.indexOf(&quot;EQ_BREAKABLE_SHIELD&quot;) &gt; -1 ) ) {
		player.ship.setEquipmentStatus(&quot;EQ_SHIELD_BOX&quot;,&quot;EQUIPMENT_DAMAGED&quot;); //help only once
		player.ship.setEquipmentStatus(equipment,&quot;EQUIPMENT_OK&quot;);
	}
}

this.equipmentDestroyed = function(equipment) { //Hard Armour can not be destroyed
	var e=&quot;EQ_HARDARMOUR_III&quot;; if(equipment === e) player.ship.awardEquipment(e);
	e=&quot;EQ_HARDARMOUR_V&quot;; if(equipment === e) player.ship.awardEquipment(e);
	e=&quot;EQ_HARDARMOUR_X&quot;; if(equipment === e) player.ship.awardEquipment(e);
}

this.guiScreenWillChange = function(to, from) {
	if(to === &quot;GUI_SCREEN_STATUS&quot;) {//fix a bug when the player got new ship without shipSpawned
//		if( this.$HardShips_Debug ) player.consoleMessage(player.ship.name);
		if( player.ship.scriptInfo ) {
			var h = parseInt(player.ship.scriptInfo.hardarmour); //award Hard Armour equipment to show version
			if( h &gt; 0 &amp;&amp; player.ship.equipmentStatus(&quot;EQ_HARDARMOUR_III&quot;) == &quot;EQUIPMENT_UNAVAILABLE&quot;
				&amp;&amp; player.ship.equipmentStatus(&quot;EQ_HARDARMOUR_V&quot;) == &quot;EQUIPMENT_UNAVAILABLE&quot;
				&amp;&amp; player.ship.equipmentStatus(&quot;EQ_HARDARMOUR_X&quot;) == &quot;EQUIPMENT_UNAVAILABLE&quot; ) {
				var v = &quot;III&quot;;
				if( h &gt;= 10 ) v = &quot;X&quot;;
				else if( h &gt;= 5 ) v = &quot;V&quot;;
				player.ship.awardEquipment(&quot;EQ_HARDARMOUR_&quot;+v);
			}
		}
	}
}

this.playerBoughtEquipment = function(equipmentKey) {
	if( equipmentKey.substr(-7,7) == &quot;_REFUND&quot; ) { //any eq which end with _refund means full refund the eq named before
		player.ship.removeEquipment( equipmentKey ); //remove the &quot;bought&quot; refund eq
		var eq = equipmentKey.substr( 0, equipmentKey.length-7 );//the real eq
		if( player.ship.equipmentStatus( eq ) == &quot;EQUIPMENT_OK&quot; ) this.$HardShips_RefundEQ( eq );
		else if( player.ship.equipmentStatus( eq ) == &quot;EQUIPMENT_DAMAGED&quot; ) //need check to avoid message at refund
			player.consoleMessage(&quot;Need repair first&quot;); //do not get full price back for a damaged eq
		return;
	}
	var repeq = &quot;EQ_ADDITIONAL_ARMOUR_REPAIR&quot;; //Front, Aft Add. Armour, Core, Nose and Energy Generator repairs in one step
	if( equipmentKey == repeq ) {
		var price = EquipmentInfo.infoForKey( repeq ).price / 10;
		player.ship.removeEquipment( repeq );
		var firstfix = true; //first fix do not need additional money, deducted by the game
		firstfix = this.$HardShips_FixEQ(&quot;EQ_ADDITIONAL_FRONT_ARMOUR&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_ADDITIONAL_AFT_ARMOUR&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_ADDITIONAL_CORE_HULL&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_HARDNOSE&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_VERYHARDNOSE&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_VERYVERYHARDNOSE&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_EEG&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_ESG&quot;, price, firstfix);
		if( player.bounty == 0 ) firstfix = this.$HardShips_FixEQ(&quot;EQ_HTCAT&quot;, price, firstfix);
		if( player.bounty &gt; 0 ) firstfix = this.$HardShips_FixEQ(&quot;EQ_REG&quot;, price, firstfix);
	}
	repeq = &quot;EQ_EQUIPMENT_BOX_REPAIR&quot;;
	if( equipmentKey == repeq ) {
		var price = EquipmentInfo.infoForKey( repeq ).price / 10;
		player.ship.removeEquipment( repeq );
		var firstfix = true; //first fix do not need additional money, deducted by the game
		firstfix = this.$HardShips_FixEQ(&quot;EQ_EQUIPMENT_BOX&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_ELECTRONICS_BOX&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_LIFE_BOX&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_INJECTOR_BOX&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_SHIELD_BOX&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_DUMMY100&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_DUMMY50&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_DUMMY10&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_DUMMY5&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_DUMMY1&quot;, price, firstfix);
	}
	repeq = &quot;EQ_HARDSHIELD_REPAIR&quot;; //Hard Shield and Anti-Sapper Shield repairs in one step
	if( equipmentKey == repeq ) {
		var price = EquipmentInfo.infoForKey( repeq ).price / 10;
		player.ship.removeEquipment( repeq );
		var firstfix = true; //first fix do not need additional money, deducted by the game
		firstfix = this.$HardShips_FixEQ(&quot;EQ_HARDSHIELD_1&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_HARDSHIELD_2&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_HARDSHIELD_3&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_HARDSHIELD_4&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_HARDSHIELD_5&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_HARDSHIELD_6&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_HARDSHIELD_7&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_HARDSHIELD_8&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_HARDSHIELD_9&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_HARDSHIELD_10&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_BIGSHCAP&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_BIGSHCAP2&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_BIGSHCAP3&quot;, price, firstfix);
		firstfix = this.$HardShips_FixEQ(&quot;EQ_SAPPERNULLIFIER&quot;, price, firstfix); //for sure only
		firstfix = this.$HardShips_FixEQ(&quot;EQ_ANTISAPPER&quot;, price, firstfix);
	}
	if( equipmentKey === &quot;EQ_HARDNOSE&quot; ) { //downgrade
		if( player.ship.equipmentStatus( &quot;EQ_VERYHARDNOSE&quot; ) == &quot;EQUIPMENT_DAMAGED&quot; ||
			player.ship.equipmentStatus( &quot;EQ_VERYVERYHARDNOSE&quot; ) == &quot;EQUIPMENT_DAMAGED&quot; ) {
			player.consoleMessage(&quot;Nose need repair first&quot;); //do not get full price back for a damaged eq
			player.ship.removeEquipment( equipmentKey );
			player.credits += EquipmentInfo.infoForKey( equipmentKey ).price / 10;
		} else {
			this.$HardShips_RefundEQ(&quot;EQ_VERYHARDNOSE&quot;);
			this.$HardShips_RefundEQ(&quot;EQ_VERYVERYHARDNOSE&quot;);
		}
	}
	if( equipmentKey === &quot;EQ_VERYHARDNOSE&quot; ) { //upgrade or downgrade
		if( player.ship.equipmentStatus( &quot;EQ_HARDNOSE&quot; ) == &quot;EQUIPMENT_DAMAGED&quot; ||
			player.ship.equipmentStatus( &quot;EQ_VERYVERYHARDNOSE&quot; ) == &quot;EQUIPMENT_DAMAGED&quot; ) {
			player.consoleMessage(&quot;Nose need repair first&quot;); //do not get full price back for a damaged eq
			player.ship.removeEquipment( equipmentKey );
			player.credits += EquipmentInfo.infoForKey( equipmentKey ).price / 10;
		} else {
			this.$HardShips_RefundEQ(&quot;EQ_HARDNOSE&quot;);
			this.$HardShips_RefundEQ(&quot;EQ_VERYVERYHARDNOSE&quot;);
		}
	}
	if( equipmentKey === &quot;EQ_VERYVERYHARDNOSE&quot; ) { //upgrade
		if( player.ship.equipmentStatus( &quot;EQ_HARDNOSE&quot; ) == &quot;EQUIPMENT_DAMAGED&quot; ||
			player.ship.equipmentStatus( &quot;EQ_VERYHARDNOSE&quot; ) == &quot;EQUIPMENT_DAMAGED&quot; ) {
			player.consoleMessage(&quot;Nose need repair first&quot;); //do not get full price back for a damaged eq
			player.ship.removeEquipment( equipmentKey );
			player.credits += EquipmentInfo.infoForKey( equipmentKey ).price / 10;
		} else {
			this.$HardShips_RefundEQ(&quot;EQ_HARDNOSE&quot;);
			this.$HardShips_RefundEQ(&quot;EQ_VERYHARDNOSE&quot;);
		}
	}
	var i = 1;
	while( i &lt; 11 &amp;&amp; equipmentKey != &quot;EQ_HARDSHIELD_&quot; + i ) i++;
	if( i &lt; 11 ) for( var j = 1; j &lt; 11; j++) {//found, refund old HS
		if( j != i ) {
			var ok = true; //only if no damaged HardShield
			for( var k = 1; k &lt; 11; k++) {
				if( player.ship.equipmentStatus( &quot;EQ_HARDSHIELD_&quot; + i ) == &quot;EQUIPMENT_DAMAGED&quot;  ) {
					player.consoleMessage(&quot;Hard Shield need repair first&quot;); //do not get full refund
					player.ship.removeEquipment( equipmentKey );
					player.credits += EquipmentInfo.infoForKey( equipmentKey ).price * 0.1;
					ok = false; //flag to fail
				}
			}
			if( ok ) this.$HardShips_RefundEQ( &quot;EQ_HARDSHIELD_&quot; + j );  //upgrade or downgrade
		}
	}
}

this.playerBoughtNewShip = function() {
	this.$HardShips_AllSideFixed(player.ship, 0);//initialize player data
	this.$HardShips_Alloys[0] = this.$HardShips_AlloyStart;
}

this.shipAttackedOther = function(other) { //player hits other
	this.$HardShips_EEG(other); //check Emergency Energy Generator
	if( !other || !other.isValid || other.isDerelict ) return; //exit if the target is died or escaped meantime
	if( !other.isPlayer &amp;&amp; other.energy &lt;= 23 ) { //the next Military Laser hit can destroy the target
		other.fireMissile();//last resort
		if( other.equipmentStatus(&quot;EQ_ESCAPE_POD&quot;) === &quot;EQUIPMENT_OK&quot;
			&amp;&amp; other.abandonShip()) {//eject to save life but only if has Escape Pod
			var dn = other.displayName;
			if( worldScripts[&quot;detectors&quot;] &amp;&amp; other.script )
				dn = other.script.$Detectors_Origname;//short name with version
			player.consoleMessage(dn+&quot; ejected to save life.&quot;);
		}
	}
	this.$HardShips_CanLeaveAlloy(other); //can escape some cargo
}

this.shipBeingAttacked = function(other) { //player get hit from other
//	if( !other || !other.isValid || other.isDerelict ) return; //exit if the target is died or escaped meantime
	this.$HardShips_CanLeaveAlloy( player.ship );
	this.$HardShips_EEG(player.ship); //check Emergency Energy Generator
}


this.shipDockedWithStation = this.shipWillLaunchFromStation = function() {
//	player.ship.setEquipmentStatus(&quot;EQ_FUEL_INJECTION&quot;, &quot;EQUIPMENT_DAMAGED&quot;);//debug
//	player.ship.setEquipmentStatus(&quot;EQ_FUEL_INJECTION&quot;, &quot;EQUIPMENT_DAMAGED&quot;);//debug
	if( player.ship.docked ) {
		if( player.ship.equipmentStatus(&quot;EQ_REG&quot;) == &quot;EQUIPMENT_DAMAGED&quot; )
			player.ship.setEquipmentStatus(&quot;EQ_REG&quot;, &quot;EQUIPMENT_OK&quot;); //renew for free
		this.$HardShips_AllSideFixed(player.ship, 0);//initialize player data
		this.$HardShips_Alloys[0] = this.$HardShips_AlloyStart;
	}
}

this.shipSpawned = function(ship) {
	if( !ship || ship.isPlayer || !ship.isPiloted || ship.isThargoid || ship.isStation) return; //do not fix cargo, etc.
	var shipno = this.$HardShips_Ships.length;
	this.$HardShips_AllSideFixed(ship, shipno);
	this.$HardShips_Alloys[shipno] = 100*(1+Math.min(ship.cargoSpaceCapacity, Math.random()*7)); //as like NPC carry 1-8t alloy
//	if( this.$HardShips_Debug ) player.consoleMessage(shipno+&quot;. &quot;+ship.name + &quot; armoured&quot;);//debug

 	//award Standard Armour to all ships but do not overwite ship scripts
	if( !ship.script ) ship.setScript(&quot;hardarmour.js&quot;); //for sure, usually has oolite-default-ship-script, but if not then must set script to make usable the NPC Fuel Leak timer also
	else if( !ship.script.shipTakingDamage ) {//set callback function into ship script to get damage amount
		ship.script.shipTakingDamage = worldScripts[&quot;hardships&quot;].$HardShips_ShipTakingDamage;
//		if( this.$HardShips_Debug ) player.consoleMessage(ship.name + &quot; armour handled&quot;);
	} else {
		ship.script.$HardShips_oldShipTakingDamage = ship.script.shipTakingDamage; //save the original function
		
		var std = function(amount, whom, type) {
//			player.consoleMessage(&quot;HSTD &quot;+Math.round(amount)+&quot; &quot;+whom.name+&quot; &quot;+type);//debug
			amount = worldScripts[&quot;hardships&quot;].$HardShips_ArmourDamage(this.ship, amount, whom); //damage armour first
			if(ship.script.$HardShips_oldShipTakingDamage)
//				ship.script.$HardShips_oldShipTakingDamage.apply(this, arguments); //call the original function
				ship.script.$HardShips_oldShipTakingDamage(amount, whom, type); //call the original function
			if(this.ship.script.$HardShips_oldShipTakingDamage)
				this.ship.script.$HardShips_oldShipTakingDamage(amount, whom, type); //call the original function
		}
		ship.script.shipTakingDamage = std;
		var s = ship.script.shipTakingDamage.toString();
		if( ship.script.shipTakingDamage.toString() != s ) { //for sure, if ever will be changed to read-only
			player.consoleMessage(ship.name + &quot; script can NOT changed!&quot;);//debug
			log(&quot;hardships.js armour handler addition failed&quot;, &quot;***&quot;+ship.script.shipTakingDamage.toString());
		}
//		else log(&quot;hardships.js armour handler added&quot;, &quot;***&quot;+ship.script.shipTakingDamage.toString());//debug
	}
	if( ship.dataKey == &quot;hardanacondax&quot; || ship.dataKey == &quot;hardanacondax-pirate&quot; ) { //extras for the kings of the enemies
		ship.awardEquipment(&quot;EQ_BIGSHCAP&quot;);
		ship.awardEquipment(&quot;EQ_BIGSHCAP2&quot;); //ShipVersion will not award these to make more rare so awarded here only
		ship.awardEquipment(&quot;EQ_SAPPERNULLIFIER&quot;);
		ship.awardEquipment(&quot;EQ_VERYVERYHARDNOSE&quot;);
	}
	this.$HardShips_TimerB = new Timer(this, this.$HardShips_TimedB, 2, 0);//after the end of other shipSpawneds setup BigShCap
}

//this.shipTakingDamage = function(amount, whom, type) { //not working here for NPC ships due to it is a worldscript and must be in ship script
//	worldScripts[&quot;hardships&quot;].$HardShips_ArmourDamage(this.ship, amount, whom);
//}

this.shipWillEnterWitchspace = function(cause)
{
//	if( this.$HardShips_Debug )
//		player.consoleMessage(&quot;Deleted &quot;+this.$HardShips_Ships.length+&quot; ship, doing &quot;+cause+&quot;.&quot;, 10);
	delete this.$HardShips_Ships;
	this.$HardShips_Ships = [ player.ship ]; //start a new array in the new system
	this.$HardShips_ShipsBigSC = 0;
}


//HardShips methods
this.$HardShips_AftShieldFacing = function(ship, whom) { //determine which shield of the ship facing to the attacker
	if( whom &amp;&amp; whom.isValid &amp;&amp; whom.vectorForward.angleTo(whom.position.subtract(ship.position)) &lt;= 1.57) return(true);
//player.consoleMessage(&quot;Front hit&quot;);
	return(false);
}

this.$HardShips_AllSideFixed = function(ship, shipno) {
	this.$HardShips_SetupPlayerBigShCap();
	this.$HardShips_Ships[shipno] = ship;//save the new ship, increase the array
	var ar = this.$HardShips_ArmourMax(ship);
	var frontar = ar;
	if( ship.equipmentStatus(&quot;EQ_ADDITIONAL_FRONT_ARMOUR&quot;) === &quot;EQUIPMENT_OK&quot; ) frontar = 2 * frontar;
	var aftar = ar;
	if( ship.equipmentStatus(&quot;EQ_ADDITIONAL_AFT_ARMOUR&quot;) === &quot;EQUIPMENT_OK&quot; ) aftar = 2 * aftar;
	var corear = ship.maxEnergy;
	if( ship.equipmentStatus(&quot;EQ_ADDITIONAL_CORE_HULL&quot;) === &quot;EQUIPMENT_OK&quot; ) corear = 2 * corear;
	var ih = 0;
	if( worldScripts[&quot;IronHide Armour Script&quot;] ) {
		if( ship.isPlayer ) { //copy player&#39;s IronHide armour
			if(player.ship.equipmentStatus(&quot;EQ_IRONHIDE&quot;) == &quot;EQUIPMENT_OK&quot; )
				ih = EquipmentInfo.infoForKey(&quot;EQ_IRONHIDE&quot;).scriptInfo.ironHideStrength //200
					* missionVariables.ironHide_percentage * 0.01; //can be damaged after a fly
			if(player.ship.equipmentStatus(&quot;EQ_IRONHIDE_MIL&quot;) == &quot;EQUIPMENT_OK&quot; )
				ih = EquipmentInfo.infoForKey(&quot;EQ_IRONHIDE_MIL&quot;).scriptInfo.ironHideStrength //400
					* missionVariables.ironHide_percentage * 0.01; //can be damaged after a fly
		} else if ( ship.mass &gt;= 30000 ) {
			//compensate the large NPCs with IronHide armour, do the same math as with ShipVersion OXP
			var v = null;
			if( ship.scriptInfo ) { //support regardless from shipversion OXP is present
				var sv = parseInt( ship.scriptInfo.shipversion );
				if( sv ) {
					if( sv &lt;= 1 ) v = 10;
					if( sv &gt;= 10 ) v = 100;
					if( sv &gt; 1 &amp;&amp; sv &lt; 10 ) v = 10 * sv;
				}
			}
			if( !v ) v = Math.floor( ship.entityPersonality / 328 ) + 1; //
			if( v &gt;= 100 &amp;&amp; ship.mass &gt;= 130000) ih = 600; //v10.0 get uber-armour
			else if( v &gt;= 80 &amp;&amp; ship.mass &gt;= 130000 ) //from ShipVersion 8.0
				ih = EquipmentInfo.infoForKey(&quot;EQ_IRONHIDE_MIL&quot;).scriptInfo.ironHideStrength; //400
			else if( v &gt;= 50 ) //from ShipVersion 5.0
				ih = EquipmentInfo.infoForKey(&quot;EQ_IRONHIDE&quot;).scriptInfo.ironHideStrength; //200
		}
	}
	this.$HardShips_AMax[shipno] = this.$HardShips_Armour[shipno] = [frontar, aftar, ar, ar, ar, ar, corear, ih];
	this.$HardShips_Damaged[shipno] = [false, false, false, false, false, false, false, false]; 
}


this.$HardShips_ArmourPiercingDamage = function(ship, amount, whom) { //callable from other OXPs to do Armour Piercing damage
	return( this.$HardShips_ArmourDamage2( ship, amount, whom, true ) );
}

this.$HardShips_ArmourDamage = function(ship, amount, whom) { //callable from other OXPs to normal damage
	return( this.$HardShips_ArmourDamage2( ship, amount, whom, false ) ); //no Armour Piercing
}

this.$HardShips_ArmourDamage2 = function(ship, amount, whom, ap) { //callable from other OXPs to either AP or normal damage
	if( !ship || !ship.isValid ) return;
	var side = -1;
	if( ship &amp;&amp; ship.isValid &amp;&amp; whom &amp;&amp; whom.isValid )
		side = worldScripts[&quot;hardships&quot;].$HardShips_WhichSideHit( ship, whom ); //which side damaged
	if( !side || side == -1 ) side = 0; //if side not known then assume front hit as most attacked side
	return( worldScripts[&quot;hardships&quot;].$HardShips_ArmourDamageSide( ship, amount, whom, side, ap ) );
}

this.$HardShips_ArmourPiercingDamageSide = function(ship, amount, whom, side) { //callable from other OXPs to do Armour Piercing damage to a specific side
	return( this.$HardShips_ArmourDamageSide2( ship, amount, whom, side, true ) );
}

this.$HardShips_ArmourDamageSide = function(ship, amount, whom, side) { //callable from other OXPs to normal damage to a side
	return( this.$HardShips_ArmourDamageSide2( ship, amount, whom, side, false ) );
}

this.$HardShips_ArmourDamageSide2 = function(ship, amount, whom, side, ap) {//called from RocketShips OXPs after WhichSideHit called once to check armour size and now do damage on the previously randomly choosed side around facing corner
	if( !ship || !ship.isValid ) return(amount);
	var ws = worldScripts[&quot;hardships&quot;];
	if( player.ship.target == ship &amp;&amp; ws.$HardShips_Debug )
		player.consoleMessage(&quot;AD &quot;+Math.round(amount)+&quot; &quot;+ship.name+&quot; &quot;+side+&quot; &quot;+ap);//debug
	if( amount == 0 ) { //HardShield support, get back some if no shield penetrating damage only to do not add to HardArmour
		var hardsh = ws.$HardShips_GetHardShieldLevel( ship );
		if(hardsh &gt; 0 &amp;&amp; whom &amp;&amp; whom.isValid ) { //get shield back only if attacker is valid
			if(ship.isPlayer) {
				if(ws.$HardShips_AftShieldFacing(ship, whom)) ship.aftShield += hardsh;
				else ship.forwardShield += hardsh;
			} else if(worldScripts[&quot;customshields&quot;]) { //check if CustomShields installed
				if(ws.$HardShips_AftShieldFacing(ship, whom)) ship.script.customshieldsaftshieldlevel += hardsh;
				else ship.script.customshieldsforwardshieldlevel += hardsh;
			}
		}
	}
	if( amount &lt;= 0 ) return(0); //amount=0 if shield damage only
	var j = ws.$HardShips_Ships.indexOf( ship ); //where is the damaged ship in the Ships array?
	if( j &lt; 0 ) return(amount);//not found, the whole damage remain
	var ha = ws.$HardShips_GetHardArmourValue( ship, side );
	if( !ap &amp;&amp; ha &gt; 0 ) { //Hard Armour if not Armour Piercing
		var d = Math.max( 0, Math.min( ha, amount - 1 ) ); //get back the prevented energy damage
		 	//but leave at least one point damage
		if( ship.energy &gt; 5 ) ship.energy += d; //bugfix: hardly explode without if
		amount -= d; //do less armour damage
	}
	if( amount &lt;= 0 ) return(0);
	
//if( player.ship.target == ship || this.$HardShips_Debug ) player.consoleMessage(j+&quot;. &quot;+ship.name+&quot; &quot;+Math.round(amount)+&quot; &quot;+side+&quot; &quot;+Math.round(ws.$HardShips_Armour[j][side]));
	//additional armours give more starting values than max, if drop to or below max then set to damaged
	if( side == 0 &amp;&amp; ship.equipmentStatus(&quot;EQ_ADDITIONAL_FRONT_ARMOUR&quot;) === &quot;EQUIPMENT_OK&quot;
		&amp;&amp; ws.$HardShips_Armour[j][0] - amount &lt;= ws.$HardShips_ArmourMaxShipNo(j) )
		ship.setEquipmentStatus(&quot;EQ_ADDITIONAL_FRONT_ARMOUR&quot;, &quot;EQUIPMENT_DAMAGED&quot;);
	if( side == 1 &amp;&amp; ship.equipmentStatus(&quot;EQ_ADDITIONAL_AFT_ARMOUR&quot;) === &quot;EQUIPMENT_OK&quot;
		&amp;&amp; ws.$HardShips_Armour[j][1] - amount &lt;= ws.$HardShips_ArmourMaxShipNo(j) )
		ship.setEquipmentStatus(&quot;EQ_ADDITIONAL_AFT_ARMOUR&quot;, &quot;EQUIPMENT_DAMAGED&quot;);

	var prevented = Math.max( 0, Math.min( ws.$HardShips_Armour[j][side], amount - 1 ) ); //min 1 damage
//	if( this.$HardShips_Debug )
//		player.consoleMessage(j+&quot;. &quot;+ship.name+&quot; &quot;+Math.round(prevented)+&quot; &quot;+Math.round(ws.$HardShips_Armour[j][side]));
	if( ship.energy &gt; 5 ) ship.energy += prevented; //give back the prevented energy loss
	ws.$HardShips_Armour[j][side] -= prevented; //side damage
	if( ws.$HardShips_Armour[j][side] &lt;= 0 ) {//too much cumulated damage
		if( ws.$HardShips_Damaged[j][side] === false ) {
			ws.$HardShips_Damaged[j][side] = true;
//			if(ws.$HardShips_ArmourMaxShipNo(j) &gt;= ws.$HardShips_ArmourMinToSpawnAlloy
//				&amp;&amp; ws.$HardShips_Ships[j].mass &gt; 30 ) //too light ship to produce a full alloy
//				ship.spawnOne(&quot;alloy&quot;); //fragmented from the ship - removed when CanLeaveAlloy coded
			if(j == 0) player.consoleMessage(ws.$HardShips_Side[side]+&quot; armour leaked&quot;);
		}
	} else if( j == 0 )//player ship
		player.consoleMessage(ws.$HardShips_Side[side]+&quot; hit, &quot;
			+Math.ceil(ws.$HardShips_Armour[j][side])+&quot; left (&quot;
			+Math.floor((ws.$HardShips_Armour[j][side]/(ws.$HardShips_ArmourMaxShipNo(j)))*100)+&quot;%)&quot;);
	var ramount = amount - prevented; //remaining amount
	if( ramount &gt; 1 ) { //if there are remaining damage over the min. 1 then Core damage
		ramount = ws.$HardShips_CoreDamage(ship, j, ramount - 1 );
		//ramount means how many damage penertated both shield and armour and do energy loss
		if( this.$HardShips_Debug )
			if( j == 0 ) player.consoleMessage(ramount+&quot; energy lost&quot;);
	}
//	if( player.ship.target == ship || this.$HardShips_Debug ) player.consoleMessage(j+&quot;. &quot;+ship.name+&quot; &quot;+Math.round(amount)+&quot;-&quot;+Math.round(prevented)+&quot;:&quot;+Math.round(ramount));//debug
	return( ramount );
}

this.$HardShips_ArmourFacing = function(ship, whom) { //how many armour of ship facing whom (called from Detectors OXP)
	var side = worldScripts[&quot;hardships&quot;].$HardShips_WhichSide(ship, whom);//which side facing to whom
	return( worldScripts[&quot;hardships&quot;].$HardShips_ArmourOnSide(ship, side) );
}

this.$HardShips_ArmourMax = function(ship) {
	if( ship.mass &lt; 30)
		return(Math.min(100, ship.maxEnergy / worldScripts[&quot;hardships&quot;].$HardShips_ArmourDivider)); //small ship max. 100
	return(ship.maxEnergy / worldScripts[&quot;hardships&quot;].$HardShips_ArmourDivider); //the start Armour value for each side
}

this.$HardShips_ArmourMaxShipNo = function(shipno) {
	return( worldScripts[&quot;hardships&quot;].$HardShips_ArmourMax( worldScripts[&quot;hardships&quot;].$HardShips_Ships[shipno] ) );
}

this.$HardShips_ArmourOnSide = function(ship, side) { //how many armour left on this side of the ship
	var ar = 0;
	var ws = worldScripts[&quot;hardships&quot;];
	var j = ws.$HardShips_Ships.indexOf(ship);
	if( j &gt; -1 &amp;&amp; ws.$HardShips_Armour[j] ) { //found
		ar = ws.$HardShips_Armour[j][side]; //armour facing
		if( ws.$HardShips_Armour[j][7] ) //IronHide armour
			ar += parseInt(ws.$HardShips_Armour[j][7]); //is additive
	}
	return( ar );
}

this.$HardShips_ArmourMaxOnSide = function(ship, side) { //how many armour was originally on this side of the ship
	var ar = 0;
	var ws = worldScripts[&quot;hardships&quot;];
	var j = ws.$HardShips_Ships.indexOf(ship);
	if( j &gt; -1 &amp;&amp; ws.$HardShips_AMax[j] ) { //found
		ar = ws.$HardShips_AMax[j][side]; //armour facing
		if( ws.$HardShips_AMax[j][7] ) //IronHide armour
			ar += parseInt(ws.$HardShips_AMax[j][7]); //is additive
	}
	return( ar );
}

this.$HardShips_CanLeaveAlloy = function( ship ) {
	var lowenergy = ship.maxEnergy * 0.5; //below this can leave alloy the player and NPCs also
	var odds = 10; //below this t alloy reduced odds to leave, same to player and NPCs
	var ws = worldScripts[&quot;hardships&quot;];
	if( ship.isPlayer ) {
		if( ship.energy &lt;= lowenergy &amp;&amp; ship.manifest.alloys &gt; odds * Math.random()
			&amp;&amp; ws.$HardShips_Armour[0][7] == 0 &amp;&amp; //IronHide armour 0
			( ws.$HardShips_Damaged[0][0]
			|| ws.$HardShips_Damaged[0][1]
			|| ws.$HardShips_Damaged[0][2]
			|| ws.$HardShips_Damaged[0][3]
			|| ws.$HardShips_Damaged[0][4]
			|| ws.$HardShips_Damaged[0][5] ) ) {
			ship.manifest.alloys--;
			ship.spawnOne(&quot;alloy&quot;);
			player.consoleMessage(&quot;RepairBot: Oh, we leaved 1t Alloy!&quot;);
		}
	} else {  //NPC
		var i = ws.$HardShips_Ships.indexOf(ship);
		var a = ws.$HardShips_Alloys[ i ];
		var min = ws.$HardShips_ArmourMinToSpawnAlloy;
		if( a &gt; min * ( 1 + odds * Math.random() ) &amp;&amp; ship.energy &lt;= lowenergy
			&amp;&amp; ws.$HardShips_Armour[i][7] == 0 &amp;&amp; //IronHide armour 0
			( ws.$HardShips_Damaged[i][0]
			|| ws.$HardShips_Damaged[i][1]
			|| ws.$HardShips_Damaged[i][2]
			|| ws.$HardShips_Damaged[i][3]
			|| ws.$HardShips_Damaged[i][4]
			|| ws.$HardShips_Damaged[i][5] ) ) {
			ws.$HardShips_Alloys[ i ] -= min;
			ship.spawnOne(&quot;alloy&quot;);
		}
	}
}

this.$HardShips_CoreDamage = function(ship, shipno, ramount) {
	//remaining damage amount after shield and normal armour cause first IronHide armour loss then Core damage
	var ihdamage = 0;
	var ws = worldScripts[&quot;hardships&quot;];
	if( ws.$HardShips_Armour[shipno][7] &gt; 0 ) { //simulated IronHide armour damage
		ihdamage = Math.min( ws.$HardShips_Armour[shipno][7], ramount );
		ws.$HardShips_Armour[shipno][7] -= ihdamage; //reduce the simulated IronHide armour variable
		ramount -= ihdamage; //either the armour or the remaining amount will be 0
		if( ship.energy &gt; 5 ) ship.energy += ihdamage; //give back the prevented energy loss
		if( shipno === 0 ) missionVariables.ironHide_percentage -= //reduce the original IronHide armour also
			Math.floor(100 * (ihdamage / missionVariables.ironHide_strength));
		if( shipno === 0 &amp;&amp; ws.$HardShips_Armour[shipno][7] &lt;= 0 ) {//player lost IronHide armour
			if(player.ship.equipmentStatus(&quot;EQ_IRONHIDE&quot;) == &quot;EQUIPMENT_OK&quot; ) 
				player.ship.removeEquipment(&quot;EQ_IRONHIDE&quot;);
			if(player.ship.equipmentStatus(&quot;EQ_IRONHIDE_MIL&quot;) == &quot;EQUIPMENT_OK&quot; ) 
				player.ship.removeEquipment(&quot;EQ_IRONHIDE_MIL&quot;);
			missionVariables.ironHide_percentage = 0;
       			missionVariables.ironHide_milFlag = 0;
			player.consoleMessage(&quot;IronHide armour has been destroyed!&quot;, 6);
			mission.setInstructionsKey(null, &quot;IronHide Armour Script&quot;); //copyed from the IronHide script.js
		}
	}
	var coredamage = ramount; //remaining after ironhide armour cause
//	if( ship.equipmentStatus(&quot;EQ_ADDITIONAL_CORE_HULL&quot;) === &quot;EQUIPMENT_OK&quot; //repairable over max due to it is hull not armour
//		&amp;&amp; ws.$HardShips_Armour[shipno][6] - coredamage &lt;= ship.maxEnergy ) 
//		ship.setEquipmentStatus(&quot;EQ_ADDITIONAL_CORE_HULL&quot;, &quot;EQUIPMENT_DAMAGED&quot;);
	ws.$HardShips_Armour[6] -= coredamage; //Core can hold negative values to store real fixable amount
	//do not give back energy due to Core is hull and not armour, can not prevent energy loss if hit
	if( ws.$HardShips_Armour[6] &lt;= 0 ) { //Core hull damaged to 0
		if( ws.$HardShips_Damaged[6] === false ) {
			ws.$HardShips_Damaged[6] = true;
			var ship = ws.$HardShips_Ships[shipno];
			if( ship.fuel &gt; 0 &amp;&amp; Math.random() &gt; ship.energy/ship.maxEnergy ) { //Fuel Leak
				// 25% odds to Fuel Leak at 3/4 energy, 50% at 1/2, 75% at 1/4.
				if( shipno === 0 &amp;&amp; player.ship.fuelLeakRate == 0) {//player ship with no Leak
					player.ship.fuelLeakRate = 10 * ws.$HardShips_FuelLeakRate; //leaked
					player.commsMessage(&quot;Core damaged, fuel leaking!&quot;,10);
				} else {
					if( ship.script &amp;&amp; !ship.script.$HardShips_TimerNFL ) //NPC Fuel Leak timer
						ship.script.$HardShips_TimerNFL = new Timer(ship,
							ws.$HardShips_TimedNFL, 0, 1);
					else ship.fuel = 0;//NPCs without script sustain very fast fuel leak but this should not happen due to the awarded hardarmour.js
//todo: spawn scoopable Fuel cloud if CustomShields installed
//				if(worldScripts[&quot;customshields&quot;]) {
//var sparksfuelleaks = ship.spawnOne(&quot;customshieldssparksfuelleaks&quot;);
//sparksfuelleaks.position = ship.position.add([0, -30, 0]);//30m down
//sparksfuelleaks.orientation = (0, 0, -1, 0);
//sparksfuelleaks.target = ship;
				}
			} else { //no fuel or successful roll
				if(ship.takeInternalDamage()) //cause cargo, equipment or service level damage
					if( shipno === 0 ) player.consoleMessage(&quot;Core hit caused internal damage.&quot;);
			}
		}
	}
//	if( shipno &gt; 0 &amp;&amp; ship.script &amp;&amp; !ship.script.$HardShips_TimerNFL) //debug: all hit after shield cause fuel leak
//		ship.script.$HardShips_TimerNFL = new Timer(ship, ws.$HardShips_TimedNFL, 0, 1);
	return(ramount - ihdamage); //Core damage is not deducted from amount as it is not armour
}

this.$HardShips_DamageEQ = function(ship, eq) {  //set to damaged and equipment box can not catch the damage
	if( ship &amp;&amp; ship.equipmentStatus(eq) == &quot;EQUIPMENT_OK&quot;) {
		var boxok = false;
		if( ship.equipmentStatus(&quot;EQ_EQUIPMENT_BOX&quot;) == &quot;EQUIPMENT_OK&quot; ) {
			ship.setEquipmentStatus(&quot;EQ_EQUIPMENT_BOX&quot;, &quot;EQUIPMENT_DAMAGED&quot;); //disable temporary
			boxok = true;
		}
		ship.setEquipmentStatus(eq, &quot;EQUIPMENT_DAMAGED&quot;);
		if( boxok ) ship.setEquipmentStatus(&quot;EQ_EQUIPMENT_BOX&quot;, &quot;EQUIPMENT_OK&quot;); //restore if disabled
	}
}

this.$HardShips_EEG = function(ship) { //Emergency Energy Generator handler
	if( !ship || !ship.isValid || ship.energy &gt; 64 ) return; //trigger when the last bank is touched
	var npc = true;
	if( ship == player.ship ) npc = false;
//	if( this.$HardShips_Debug ) log(&quot;hardships&quot;, ship.displayName+&quot; EQ_REG &quot;+ship.equipmentStatus(&quot;EQ_REG&quot;));
	if( ship.equipmentStatus(&quot;EQ_REG&quot;)==&quot;EQUIPMENT_OK&quot; ) { //Renewable Energy Generator
		if( Math.random() &gt; 0.1 ) { //90% to work well
			ship.energy += 128;
			this.$HardShips_DamageEQ(ship, &quot;EQ_REG&quot;); //one shot but will renew in dock
			if( !npc ) player.consoleMessage(&quot;Renewable Energy Generator triggered&quot;, 5);
//			if( this.$HardShips_Debug ) log(&quot;hardships&quot;, ship.displayName+&quot; EQ_REG triggered&quot;);
		} else { //10% to break down
			ship.removeEquipment( &quot;EQ_REG&quot; );
//			if( this.$HardShips_Debug ) log(&quot;hardships&quot;, ship.displayName+&quot; EQ_REG break down&quot;);
			if( !npc ) {
				player.consoleMessage(&quot;Renewable Energy Generator break down, cause internal damages!&quot;, 10);
				ship.takeInternalDamage(); //only player ship has takeInternalDamage method
				ship.takeInternalDamage();
				ship.takeInternalDamage();
			}
		}
	}
	if( ship.energy &lt; 64 &amp;&amp; ship.equipmentStatus(&quot;EQ_EEG&quot;)==&quot;EQUIPMENT_OK&quot; ) { //skip EEG if REG is triggered
		var htc = false;
		if( ship.equipmentStatus(&quot;EQ_HTCAT&quot;)==&quot;EQUIPMENT_OK&quot; ) htc = true; //High-Tech Catalyst
		if( ( (npc || ship.manifest.radioactives &gt;= 1)
			|| htc &amp;&amp; ship.fuel &gt;= 0.1 &amp;&amp; (npc || ship.manifest.gold &gt;= 1) )
			&amp;&amp; (npc || ship.manifest.platinum &gt;= 1 )) {
			var ebank = 0;
			var fue = 0;
			if( npc ) {
				ebank = 1 + 50 * Math.random(); //NPCs has resources to trigger EEG
				if( htc ) ebank += ship.fuel * 10;
			} else {
				if( htc ) ebank = Math.min(ship.manifest.gold, ship.fuel * 10); //max.regen.ebanks
				fue = ebank;
				ebank += Math.min(ship.manifest.radioactives, ship.manifest.platinum);
			}
				
			
			if( htc ) this.$HardShips_DamageEQ(ship, &quot;EQ_HTCAT&quot;); //one more shot
			else this.$HardShips_DamageEQ(ship, &quot;EQ_EEG&quot;); //one shot

			if( !npc ) { //only player ship has takeInternalDamage method
				var g = &quot;&quot;;
				if( htc &amp;&amp; fue &gt; 0 ) g += &quot; using fuel&quot;;
				if( ship.takeInternalDamage() ) g += &quot;, internal damage taken&quot;;
				player.consoleMessage(&quot;Emergency Energy Generator triggered&quot;+g, 10);
			}
			
			var need = ship.maxEnergy - ship.energy;
			var adde = Math.min(ebank * 64, need);
			ship.energy += adde;
			ebank -= adde / 64;
			if( ship.equipmentStatus(&quot;EQ_ESG&quot;)==&quot;EQUIPMENT_OK&quot; &amp;&amp; ebank &gt; 0 ) {
				if( npc ) {
					var wsc = false;
					if( worldScripts[&quot;customshields&quot;] ) wsc = true; //check if CustomShields installed
					if( wsc ) need = ship.script.customshieldsmaxforwardshieldlevel -
						ship.script.customshieldsforwardshieldlevel;
					else need = 0;
				} else need = ship.maxForwardShield - ship.forwardShield;
				var addfs = Math.min(ebank * 64, need);
				if( npc ) {
					if( wsc ) ship.script.customshieldsforwardshieldlevel += addfs;
				} else ship.forwardShield += addfs;
				ebank -= addfs / 64;
				adde += addfs;
				if( ebank &gt; 0 ) {
					if( npc ) {
						if( wsc ) need = ship.script.customshieldsmaxaftshieldlevel -
							ship.script.customshieldsaftshieldlevel;
						else need = 0;
					} else need = ship.maxAftShield - ship.aftShield;
					var addas = Math.min(ebank * 64, need);
					if( npc ) {
						if( wsc ) ship.script.customshieldsaftshieldlevel += addas;
					} else ship.aftShield += addas;
					ebank -= addas / 64;
					adde += addas;
				}
			}
			if( npc ) {
				if( htc ) {
					var f = Math.ceil( adde / 64 ) / 10;
					if( ship.fuel &lt;= f ) ship.fuel = 0;
					else ship.fuel -= f;
				}
			} else {
				var fu = Math.min(fue, adde / 64);
				if( htc ) {
					ship.fuel -= Math.ceil( adde / 64 ) / 10;
					ship.manifest.gold -= Math.ceil( fu );
				}
				adde -= fu * 64;
				if( adde &gt; 0 ) {
					ship.manifest.radioactives -= Math.ceil( adde / 64 );
					ship.manifest.platinum -= Math.ceil( adde / 64 );
				}
			}
		} else {
			if( !npc ) {
				var g = &quot;&quot;;
				if( htc ) g = &quot; or Fuel and Gold&quot;;
				player.consoleMessage(&quot;Emergency Energy Generator can not triggered,&quot;+
					&quot; need more Radioactives and Platinum&quot;+g, 10);
			}
		}
	}
}

this.$HardShips_FixEQ = function(eq, price, firstfix) {
	if(player.ship.equipmentStatus(eq) === &quot;EQUIPMENT_DAMAGED&quot;) {
		if(!firstfix) {
			if( player.credits &lt; pr ) {
				player.consoleMessage(&quot;Not enough money to fix &quot;+EquipmentInfo.infoForKey(eq).name);
				return(firstfix); //exit before fixing
			} else player.credits -= price; //deduct additional price to pay non-first fixing
		}
		player.ship.setEquipmentStatus(eq, &quot;EQUIPMENT_OK&quot;); //do fixing
		clock.addSeconds(&quot;3600&quot;); //fixing time per equipment
		firstfix = false; //next need additional money
	}
	return(firstfix);
}

this.$HardShips_GetHardArmourValue = function( ship, side ) {
	if( !ship ) return( 0 );
	var ha = 0;
	if( ship.scriptInfo &amp;&amp; parseInt(ship.scriptInfo.hardarmour) &gt; 0 )
		ha = Math.max( 0, Math.min( parseInt(ship.scriptInfo.hardarmour), 10 ) ); //from 0 to 10
	if( side == 0 ) {
		if( ship.equipmentStatus(&quot;EQ_VERYVERYHARDNOSE&quot;) == &quot;EQUIPMENT_OK&quot; ) ha += 3; //undamaged VVHard Nose
		else if( ship.equipmentStatus(&quot;EQ_VERYHARDNOSE&quot;) == &quot;EQUIPMENT_OK&quot; ) ha += 2; //undamaged VHard Nose
		else if( ship.equipmentStatus(&quot;EQ_HARDNOSE&quot;) == &quot;EQUIPMENT_OK&quot; ) ha += 1; //undamaged Hard Nose
	}
	return( Math.min( ha, this.$HardShips_MaxHardArmour ) ); //the sum can not be more than MaxHardArmour
}

this.$HardShips_GetHardShieldLevel = function( ship ) {
	var hardsh = 0;
	for( var i = 10; i &gt; 0; i-- ) { //check HardShield equipment
		if( ship.equipmentStatus(&quot;EQ_HARDSHIELD_&quot;+i) == &quot;EQUIPMENT_OK&quot; ) {
			hardsh = i / 2; //highest match, lower HardShields unnecessary
			i = 0; //amount halved to match the lower laser powers from Oolite 1.81
//			if( this.$HardShips_Debug ) player.consoleMessage(ship.name+&quot; HardShield &quot;+hardsh);
		}
	}
	return( hardsh );
}

this.$HardShips_GetSapperMultiplier = function( ship ) {
	if( ship.equipmentStatus(&quot;EQ_SAPPERNULLIFIER&quot;) == &quot;EQUIPMENT_OK&quot; ) return( 0 ); //Equipment of the Kings
	if( ship.equipmentStatus(&quot;EQ_EQ_ANTISAPPER&quot;) == &quot;EQUIPMENT_OK&quot; ) return( 1 );
	return( 5 - worldScripts[&quot;hardships&quot;].$HardShips_GetHardShieldLevel( ship ) / 3 );
//HSLevel  	0	1	2	3	4	5	6	7	8	9	10
//Depleting	5	4.667	4.333	4	3.667	3.333	3	2.667	2.333	2	1.667
}

this.$HardShips_GetShieldCap = function( ship ) {
	if( !worldScripts[&quot;shieldequalizercapacitors&quot;] ) return( 0 );
	var m = this.$HardShips_OrigShieldCapMax;
	var b = 0;
	if( player.ship.equipmentStatus(&quot;EQ_BIGSHCAP&quot;) == &quot;EQUIPMENT_OK&quot; ) b++;
	if( player.ship.equipmentStatus(&quot;EQ_BIGSHCAP2&quot;) == &quot;EQUIPMENT_OK&quot; ) b++;
	if( b &gt; 0 ) m = b * 256;
	if( player.ship.equipmentStatus(&quot;EQ_BIGSHCAP3&quot;) == &quot;EQUIPMENT_OK&quot; ) m = 960; //for bases only
	return( m );
}

this.$HardShips_RefundEQ = function( eq ) {
	if( player.ship.equipment.indexOf( eq ) ) {
		if( player.ship.equipmentStatus( eq ) == &quot;EQUIPMENT_DAMAGED&quot; )
			player.consoleMessage(&quot;Need repair first&quot;); //do not get back full price for a damaged eq
		else if( player.ship.equipmentStatus( eq ) == &quot;EQUIPMENT_OK&quot; ) {
			player.ship.removeEquipment( eq );
			clock.addSeconds (&quot;3600&quot;);
			var refund = EquipmentInfo.infoForKey( eq ).price * 0.1;
			player.credits += refund;
			player.consoleMessage(&quot;Refunded &quot;+refund+&quot; credits for &quot;+EquipmentInfo.infoForKey( eq ).name);
			return( refund );
		}
	}
	return( 0 );
}

this.$HardShips_ShipTakingDamage = function(amount, whom, type) { //used to add shipTakingDamage() to ship script
//	if(whom.isPlayer) player.consoleMessage(Math.floor(amount)+&quot; --&gt; &quot;+this.ship.name);//debug
	worldScripts[&quot;hardships&quot;].$HardShips_TakingDamage(this.ship, amount, whom, type);
}

this.$HardShips_TakingDamage = function(ship, amount, whom, type) { //used to add shipTakingDamage() to ship script
//	if(whom.isPlayer) player.consoleMessage(Math.floor(amount)+&quot; --&gt; &quot;+ship.name);//debug
	if(type == &quot;scrape damage&quot; ) {//Railgun support
		//if(player.ship.target == whom) player.consoleMessage(Math.floor(amount)+&quot; &quot;+type+&quot; --&gt; &quot;+ship.name);//debug2
		worldScripts[&quot;hardships&quot;].$HardShips_ArmourPiercingDamage(ship, amount, whom);
	}
	else worldScripts[&quot;hardships&quot;].$HardShips_ArmourDamage(ship, amount, whom);
}

this.$HardShips_Timed = function() {//repair run in every 1 sec
	var hslen = this.$HardShips_Ships.length;
	for( var j = 0; j &lt; hslen; j++) {
		var amax = this.$HardShips_AMax[j];
		var armour = this.$HardShips_Armour[j];
		var ship = this.$HardShips_Ships[j];
		
//		if( this.$HardShips_Debug )
//		if( j==0 ) log(&quot;HardShips&quot;, ship.isInSpace+&quot; &quot;+ship.isPiloted+&quot; &quot;+this.$HardShips_Alloys[j]);
		if( ship &amp;&amp; ship.isValid &amp;&amp; ship.isInSpace &amp;&amp; ship.isPiloted ) {//equipment repairs
			var r = Math.random();
			if( r &lt; 0.02 //engine repair need 50sec in average
				&amp;&amp; ship.equipmentStatus(&quot;EQ_ERB&quot;) == &quot;EQUIPMENT_OK&quot; ) { //and working engine repair bot
				var eq = &quot;EQ_BREAKABLE_ENGINE_SMALL&quot;; if( ship.equipmentStatus(eq) != &quot;EQUIPMENT_DAMAGED&quot; ) {
				eq = &quot;EQ_BREAKABLE_ENGINE_MEDIUM&quot;; if( ship.equipmentStatus(eq) != &quot;EQUIPMENT_DAMAGED&quot; ) {
				eq = &quot;EQ_BREAKABLE_ENGINE_LARGE&quot;; if( ship.equipmentStatus(eq) != &quot;EQUIPMENT_DAMAGED&quot; ) {
				eq = &quot;EQ_BREAKABLE_ENGINE_MONSTER&quot;; if( ship.equipmentStatus(eq) != &quot;EQUIPMENT_DAMAGED&quot; ) {
				eq = &quot;EQ_FUEL_INJECTION&quot;; if( ship.equipmentStatus(eq) != &quot;EQUIPMENT_DAMAGED&quot; ) {
				eq = &quot;EQ_Q-CHARGER&quot;; if( ship.equipmentStatus(eq) != &quot;EQUIPMENT_DAMAGED&quot; ) eq = null;
				}}}}}
//				if(ship.isPlayer) log(&quot;HardShips&quot;, ship.equipmentStatus(&quot;EQ_ERB&quot;)+&quot; &quot;+eq);//debug
				if( eq ) {
					if( ship.isPlayer &amp;&amp; player.ship.manifest.machinery &lt; 1 ) {
						player.consoleMessage(&quot;Need Machinery to fix &quot;
							+EquipmentInfo.infoForKey(eq).name, 10);
					} else  {
						ship.setEquipmentStatus(eq, &quot;EQUIPMENT_OK&quot;);
						if( ship.isPlayer ) {
							player.ship.manifest.machinery--;
							player.consoleMessage(EquipmentInfo.infoForKey(eq).name+&quot; fixed.&quot;, 10);
						}
					}
				}
			}
			if( r &gt; 0.98 &amp;&amp; this.$HardShips_Alloys[j] &gt; 0 ) { //box repair need alloys
				var eq = &quot;EQ_INJECTOR_BOX&quot;; if( ship.equipmentStatus(eq) != &quot;EQUIPMENT_DAMAGED&quot; ) {
				eq = &quot;EQ_LIFE_BOX&quot;; if( ship.equipmentStatus(eq) != &quot;EQUIPMENT_DAMAGED&quot; ) {
				eq = &quot;EQ_SHIELD_BOX&quot;; if( ship.equipmentStatus(eq) != &quot;EQUIPMENT_DAMAGED&quot; ) {
				eq = &quot;EQ_ELECTRONICS_BOX&quot;; if( ship.equipmentStatus(eq) != &quot;EQUIPMENT_DAMAGED&quot; ) {
				eq = &quot;EQ_EQUIPMENT_BOX&quot;; if( ship.equipmentStatus(eq) != &quot;EQUIPMENT_DAMAGED&quot; ) eq = null;
				}}}}
				if( eq ) {
					ship.setEquipmentStatus(eq, &quot;EQUIPMENT_OK&quot;);
					this.$HardShips_Alloys[j] -= 10; //one box fix need 100kg alloy
					if( ship.isPlayer )
						player.consoleMessage(EquipmentInfo.infoForKey(eq).name+&quot; fixed.&quot;, 5);
				}
			}
		}
	
		if( ship &amp;&amp; ship.isInSpace &amp;&amp; ship.isPiloted &amp;&amp; armour )//no timed repairs in dock
		//restoring armour damages
		for(var i=0; i &lt; 7; i++) //sides and Core
		if( armour[i] &lt; amax[i] ) {
			var damaged = this.$HardShips_Damaged[j];
			//Additional Core Hull is repairable in-flight due to it is not armour
//			|| i == 6 &amp;&amp; ship.equipmentStatus(&quot;EQ_ADDITIONAL_CORE_HULL&quot;) === &quot;EQUIPMENT_OK&quot;
//			&amp;&amp; armour[i] &lt; 2 * this.$HardShips_ArmourMaxShipNo(j) ) {
//			if(!damaged[6] || i === 6) {//Core damage means restore Core only - old idea, removed

			//fix the armour
			if( i != 6 &amp;&amp; this.$HardShips_Alloys[j] &lt; 1) { //check if alloys left in cargo
				if( j != 0 ) return; //NPC no alloys left, no fix
				if( player.ship.manifest.alloys &gt; 0) {//player ship
					player.ship.manifest.alloys--;// -1t
					this.$HardShips_Alloys[j] = this.$HardShips_ArmourFixableWith1tAlloy;
					player.consoleMessage(&quot;1t Alloy used to fixing, &quot;+player.ship.manifest.alloys+&quot;t left.&quot;, 	5);
				} else {//if out of alloys first time then send a message
					if(this.$HardShips_Alloys[j] &gt; -this.$HardShips_ArmourFixableWith1tAlloy) {
						player.commsMessage(&quot;Out of Alloys. Scoop some or go to Dock.&quot;, 5);
						this.$HardShips_Alloys[j] = -this.$HardShips_ArmourFixableWith1tAlloy; //flag to no more message
					}
					return;//no alloys left, no fix
				}
			}
			armour[i]++; //restore 1 points of armour per second
			if( i != 6 ) this.$HardShips_Alloys[j]--; //Core repair do not need alloy, it is hull and not armour
			if( j == 0 &amp;&amp; i != 6 &amp;&amp; damaged[i]) { //player ship armour
				var x = Math.floor(amax[i]-armour[i]) / 10;
				if( x === Math.floor(x) &amp;&amp; x &gt; 0) //divisible means x*10 seconds left
					 player.consoleMessage(this.$HardShips_Side[i]+
						&quot; armour will be fixed in &quot;+x+&quot;0 seconds.&quot;, 10);
			}

//			}
			if( damaged[i] || j == 0 &amp;&amp; i == 6) { //player core fixed later than set to undamaged
				if( armour[i] &gt;= amax[i] ) {//damage reached 0
					damaged[i] = false;//restored
					if( j === 0 ) {//player ship
						var name = &quot;armour&quot;;
						if( i === 6 ) name = &quot;hull&quot;; //Core
						player.commsMessage(this.$HardShips_Side[i]+&quot; &quot;+name+&quot; fixed.&quot;);
					}
				}
				if( i == 6 ) {//Core
//					if(worldScripts[&quot;customshields&quot;]) { //if CustomShields OXP installed
//						//stop the leak somehow
//					} else {
					if( armour[i] &gt;= amax[i] / 4) {
						if( j == 0 ) {
							//not only if Rate&gt;0 to inform regardless from out of fuel
							player.ship.fuelLeakRate = 0;
							player.commsMessage(&quot;Fuel leak sealed.&quot;);
						} else if( ship.script.$HardShips_TimerNFL ) { //NPC Fuel Leak
							ship.script.$HardShips_TimerNFL.stop();
							delete ship.script.$HardShips_TimerNFL; //sealed
						}
						damaged[i] == false;//after sealed make leakable again
					}
				}
			}
		}
	}
}

this.$HardShips_TimedB = function() { //NPC with Big Shield Capacitor setup
	if( !worldScripts[&quot;shieldequalizercapacitors&quot;] || !worldScripts[&quot;customshields&quot;] ) return;
	while( this.$HardShips_ShipsBigSC &lt; this.$HardShips_Ships.length ) { //all spawned ships after last check
		var ship = this.$HardShips_Ships[ this.$HardShips_ShipsBigSC++ ];
		var m = this.$HardShips_GetShieldCap( ship ) - this.$HardShips_OrigShieldCapMax;
		if( ship.script ) {
			ship.script.customshieldsmaxforwardshieldlevel += m;
			ship.script.customshieldsmaxaftshieldlevel += m;
		}
	}
}

this.$HardShips_TimedNFL = function() {//NPC Fuel Leak run in every sec
	if( !this.ship || !this.ship.isValid || this.ship.isPlayer ) return;
	this.ship.fuel -= Math.max( 0.1, worldScripts[&quot;hardships&quot;].$HardShips_FuelLeakRate ); //min. 0.1ly/second needed
	if( player.ship.target == this.ship || this.$HardShips_Debug ) {
		var n = this.ship.name;
		if( this.ship.script &amp;&amp; this.ship.script.$Detectors_Origname )
			n = this.ship.script.$Detectors_Origname;
		var r = &quot;&quot;;
//		if(this.$HardShips_Debug)
			r = &quot;, remain: &quot;+Math.round(this.ship.fuel*10)/10;
		player.consoleMessage( n + &quot; fuel leak&quot; + r );
	}
	if( this.ship.fuel &lt; 0.1 &amp;&amp; this.ship.script &amp;&amp; this.ship.script.$HardShips_TimerNFL ) {
		this.ship.script.$HardShips_TimerNFL.stop();
		delete this.ship.script.$HardShips_TimerNFL; //ended
	}
}

this.$HardShips_WhichSide = function(ship, whom) { //which side of ship facing to whom
	return worldScripts[&quot;hardships&quot;].$HardShips_FindWhichSide(ship, whom, false);
}

this.$HardShips_WhichSideHit = function(ship, whom) { //which side of ship hit by whom using angle based randomness
	return worldScripts[&quot;hardships&quot;].$HardShips_FindWhichSide(ship, whom, true);
//	var side = worldScripts[&quot;hardships&quot;].$HardShips_FindWhichSide(ship, whom, true);//debug
//	if( this.$HardShips_Debug ) if(whom.isPlayer) player.consoleMessage(ship.name+&quot; &quot;+this.$HardShips_Side[this.$HardShips_FindWhichSide(ship, whom, false)]+&quot; side &quot;+this.$HardShips_Side[side]+&quot; hit&quot;);
}

this.$HardShips_FindWhichSide = function(ship, whom, hit) { //which side of ship facing to whom or hit by whom
	var side = -1;
	var v = ship.position.subtract(whom.position);  //cube face comparsions
	var f = ship.vectorForward.angleTo(v);
	var r = ship.vectorRight.angleTo(v);
	var u = ship.vectorUp.angleTo(v);
//	if( this.$HardShips_Debug )  player.consoleMessage(f+&quot; &quot;+r+&quot; &quot;+u);
	var pi = Math.PI; //3.1416...
	var pi2 = pi / 2;   //1.5708...
	var fw = true;
	if( f &lt;= pi2 ) fw = false; //small f
	if( fw ) f = pi - f; //make comparable, either fwd or aft
	var ri = true;
	if( r &lt;= pi2 ) ri = false; //small r
	if( ri ) r = pi - r; //make comparable, either right or left
	var up = true;
	if( u &lt;= pi2 ) up = false; //small u
	if( up ) u = pi - u; //make comparable, either up or down
	if( hit ) { //requested to hit side
		//randomize which side get damaged around facing corner using the angle of the whom position
		var min = 0.175;//do not randomize if in the center 10 degree cone of the best side (0.175=pi/180*10)
		if( f &lt; min ) f = 0;
		else f = Math.random() * f / pi2; //as high odds to front or aft as low the f angle
		if( r &lt; min ) r = 0;
		else r = Math.random() * r / pi2; //as high odds to right or left as low the r angle
		if( u &lt; min ) u = 0;
		else u = Math.random() * u / pi2; //as high odds to top or bottom as low the u angle
	} //if requested facing side then f, r and u remain unchanged
	//side compares, new method using &quot;make comparable&quot; lines to find the smallest angle
	if( f &lt;= r &amp;&amp; f &lt;= u ) { //Front or Aft
		if( fw ) side = 0; //Front
		else side = 1; //Aft
	} else if( r &lt;= f &amp;&amp; r &lt;= u ) { //Right or left
		if( ri ) side = 2; //Right
		else  side = 3; //Left
	} else if( u &lt;= r &amp;&amp; u &lt;= f ) { //Top or Bottom
		if( up ) side = 4; //Top
		else  side = 5; //Bottom
	}
	return(side);
}
	//old side compares without &quot;make comparable&quot; lines, leaved here to demonstrate complexity
//	if( fw &amp;&amp; ( ri &amp;&amp; f &gt;= r || !ri &amp;&amp; f &gt;= pi - r ) &amp;&amp; ( up &amp;&amp; f &gt;= u || !up &amp;&amp; f &gt;= pi - u ) ) side = 0; //Front
//	else if( !fw &amp;&amp; ( !ri &amp;&amp; f &lt;= r || ri &amp;&amp; f &lt;= pi - r ) &amp;&amp; ( !up &amp;&amp; f &lt;= u || up &amp;&amp; f &lt;= pi - u ) ) side = 1; //Aft
//	else if( ri &amp;&amp; ( fw &amp;&amp; r &gt;= f || !fw &amp;&amp; r &gt;= pi - f ) &amp;&amp; ( up &amp;&amp; r &gt;= u || !up &amp;&amp; r &gt;= pi - u ) ) side = 2; //Right
//	else if( !ri &amp;&amp; ( !fw &amp;&amp; r &lt;= f || fw &amp;&amp; r &lt;= pi - f ) &amp;&amp; ( !up &amp;&amp; r &lt;= u || up &amp;&amp; r &lt;= pi - u ) ) side = 3; //Left
//	else if( up &amp;&amp; ( ri &amp;&amp; u &gt;= r || !ri &amp;&amp; pi - u &lt;= r ) &amp;&amp; ( fw &amp;&amp; u &gt;= f || !fw &amp;&amp; pi - u &lt;= f ) ) side = 4; //Top
//	else if( !up &amp;&amp; ( !ri &amp;&amp; u &lt;= r || ri &amp;&amp; u &lt;= pi - r ) &amp;&amp; ( !fw &amp;&amp; u &lt;= f || fw &amp;&amp; u &lt;= pi - f ) ) side = 5; //Bottom

this.$HardShips_SetupPlayerBigShCap = function() {
	if( !worldScripts[&quot;shieldequalizercapacitors&quot;] ) return;
	if( !worldScripts[&quot;shieldequalizercapacitors&quot;].secforwardshieldcapacitormax ) { //update the original script if too old
		worldScripts[&quot;shieldequalizercapacitors&quot;].secforwardshieldcapacitormax = this.$HardShips_OrigShieldCapMax;
		worldScripts[&quot;shieldequalizercapacitors&quot;].secaftshieldcapacitormax = this.$HardShips_OrigShieldCapMax;
		worldScripts[&quot;shieldequalizercapacitors&quot;].forwardshieldcapacitor = function()
   {
   if(player.ship.equipmentStatus(&quot;EQ_FORWARD_SHIELD_CAPACITOR&quot;) == &quot;EQUIPMENT_OK&quot;)
      {
      if(player.ship.forwardShield == player.ship.maxForwardShield)// shield full so charge capacitor
         {
         this.secforwardshieldcapacitor = (this.secforwardshieldcapacitor + (player.ship.forwardShieldRechargeRate * 0.5));
		 if(this.secforwardshieldcapacitor &lt;= this.secforwardshieldcapacitormax - 1.5)
		    {
			if(this.togglemessages == &quot;ON&quot;)
			   {
			   this.fscpause += 1.0;
			   if(this.fscpause &gt; 3.0)
			      {
			      this.fscpause = 1.0;
			      }
               if(this.fscpause == 2.0)
			      {
				  player.consoleMessage(&quot;Forward Shield Capacitor ===&gt; CHARGING...&quot;,1.5);
				  }
			   }			
			if(this.togglesoundfx2 == &quot;ON&quot;)
               {
			   if(!this.mySound3.isPlaying)
			      {
                  this.mySound3.play();
				  }
               }
			}   			
         if((this.secforwardshieldcapacitor &lt;= this.secforwardshieldcapacitormax) &amp;&amp; 
		 (this.secforwardshieldcapacitor &gt; this.secforwardshieldcapacitormax - 1.5))
            {
			if(this.togglemessages == &quot;ON&quot;)
			   {
               player.consoleMessage(&quot;Forward Shield Capacitor ===&gt; FULLY CHARGED&quot;,6);
			   }
			this.secforwardshieldcapacitor = this.secforwardshieldcapacitormax; // v1.1 fix
			if(this.mySound3.isPlaying)
               {
               this.mySound3.stop();
               }
			if(this.togglesoundfx2 == &quot;ON&quot;)
               {
			   this.mySound5.play();
			   }
            }			
         if(this.secforwardshieldcapacitor &gt; this.secforwardshieldcapacitormax)
            {
            this.secforwardshieldcapacitor = this.secforwardshieldcapacitormax;
            }
         return;
         }
      if(player.ship.forwardShield &lt; 10 ||
	      player.ship.forwardShield &lt; (player.ship.maxForwardShield - (this.secforwardshieldcapacitor + (player.ship.forwardShieldRechargeRate * 0.5))))
         {
		 if(this.mySound3.isPlaying)
            {
            this.mySound3.stop();
            }
	 var s = this.secforwardshieldcapacitor;
         if(s &gt; 0.0)// shield below capacitor level so discharge capacitor
            {
	    var c = 0;
	    var r = player.ship.maxForwardShield - player.ship.forwardShield;
            if( s &gt; r ) { //some energy left in capacitor
		s = player.ship.maxForwardShield - player.ship.forwardShield;
		c = this.secforwardshieldcapacitor - s;
	    }
            player.ship.forwardShield += s;
            this.secforwardshieldcapacitor = c;
			if(this.togglemessages == &quot;ON&quot;)
			   {
               player.consoleMessage(&quot;Forward Shield Capacitor DISCHARGED!!!&quot;,6);
			   }
			if(this.togglesoundfx1 == &quot;ON&quot;)
               {
			   this.mySound1.play();
			   }
            }
         return;
         }
      }
	if(this.mySound3.isPlaying)
      {
      this.mySound3.stop();
      }
   return;
   }

		worldScripts[&quot;shieldequalizercapacitors&quot;].aftshieldcapacitor = function()
   {
   if(player.ship.equipmentStatus(&quot;EQ_AFT_SHIELD_CAPACITOR&quot;) == &quot;EQUIPMENT_OK&quot;)
      {
      if(player.ship.aftShield == player.ship.maxAftShield)// shield full so charge capacitor
         {
         this.secaftshieldcapacitor = (this.secaftshieldcapacitor + (player.ship.aftShieldRechargeRate * 0.5));
		 if(this.secaftshieldcapacitor &lt;= this.secaftshieldcapacitormax - 1.5)
		    {
			if(this.togglemessages == &quot;ON&quot;)
			   {
			   this.ascpause += 1.0;
			   if(this.ascpause &gt; 3.0)
			      {
			      this.ascpause = 1.0;
			      }
               if(this.ascpause == 2.0)
			      {
				  player.consoleMessage(&quot;Aft Shield Capacitor ===&gt; CHARGING...&quot;,1.5);
				  }
			   }			
			if(this.togglesoundfx2 == &quot;ON&quot;)
               {
			   if(!this.mySound4.isPlaying)
			      {
                  this.mySound4.play();
				  }
               }
			} 
		 if((this.secaftshieldcapacitor &lt;= this.secaftshieldcapacitormax) 
			 &amp;&amp; (this.secaftshieldcapacitor &gt; this.secaftshieldcapacitormax - 1.5))
            {
			if(this.togglemessages == &quot;ON&quot;)
			   {
               player.consoleMessage(&quot;Aft Shield Capacitor ===&gt; FULLY CHARGED&quot;,6);
			   }
			this.secaftshieldcapacitor = this.secaftshieldcapacitormax;// v1.1 fix
			if(this.mySound4.isPlaying)
               {
               this.mySound4.stop();
               }
            if(this.togglesoundfx2 == &quot;ON&quot;)
               {
			   this.mySound5.play();
			   }
            }
         if(this.secaftshieldcapacitor &gt; this.secaftshieldcapacitormax)
            {
            this.secaftshieldcapacitor = this.secaftshieldcapacitormax;
            }
         return;
         }
      if(player.ship.aftShield &lt; 10 ||
	      player.ship.aftShield &lt; (player.ship.maxAftShield - (this.secaftshieldcapacitor + (player.ship.aftShieldRechargeRate * 0.5))))
         {
		 if(this.mySound4.isPlaying)
            {
            this.mySound4.stop();
            }
	 var s = this.secaftshieldcapacitor;
         if(s &gt; 0.0)// shield below capacitor level so discharge capacitor
            {
	    var c = 0;
	    var r = player.ship.maxAftShield - player.ship.aftShield;
            if( s &gt; r ) { //some energy left in capacitor
		s = player.ship.maxAftShield - player.ship.aftShield;
		c = this.secaftshieldcapacitor - s;
	    }
            player.ship.aftShield += s;
            this.secaftshieldcapacitor = c;
			if(this.togglemessages == &quot;ON&quot;)
			   {
               player.consoleMessage(&quot;Aft Shield Capacitor DISCHARGED!!!&quot;,6);
			   }
			if(this.togglesoundfx1 == &quot;ON&quot;)
               {
			   this.mySound1.play();
			   }
            }
         return;
         }
       }
    if(this.mySound4.isPlaying)
       {
       this.mySound4.stop();
       }
   return;
   }
	}

	var m = this.$HardShips_GetShieldCap( player.ship );
	worldScripts[&quot;shieldequalizercapacitors&quot;].secforwardshieldcapacitormax = m;
	worldScripts[&quot;shieldequalizercapacitors&quot;].secaftshieldcapacitormax = m;
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/hardturret.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;hardturret&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.description = &quot;Reduce damages, place turret inside of the shields and send message if a turret gone.&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.version     = &quot;1.0&quot;;

this.$Hardturret_HitTimer = null;

//this.shipBeingAttacked = function(whom) {
this.shipTakingDamage = function(amount, whom, type) {
	if(amount&lt;=0) return;//player shield can take the whole damage
//if(this.ship.isPlayer) {var a=Math.round(amount); var e=Math.round(this.ship.energy);}//debug
	if(this.ship.scriptInfo.hardarmour &gt; 0) { //Hard Armour support
		var d = Math.min(this.ship.scriptInfo.hardarmour, amount);
		if(this.ship.energy &gt; 5) this.ship.energy += d; //Hardly explode without if
		amount -= d;
	}
//if(this.ship.isPlayer) player.commsMessage(a+&quot; &quot;+Math.round(amount)+&quot; &quot;+e+&quot; &quot;+Math.round(this.ship.energy));//debug
	if(amount&lt;=0) return;//extra check after armor
	var energydamage = amount;
	var owner = this.ship.owner;
	if(owner.isValid &amp;&amp; !this.ship.scriptInfo.noturretshield
		&amp;&amp; !owner.scriptInfo.noturretshield) {//can disable turret shield in shipdata.plist
		var angle = 3.14;//unknown attacker assumed in front
		if(whom &amp;&amp; whom.isValid)
			angle = owner.vectorForward.angleTo(owner.position.subtract(whom.position));
		if(owner.isPlayer) {
			if(angle &gt; 1.57) {//forward
				if(energydamage &gt; owner.forwardShield) { //hit the shield first
					this.ship.energy += owner.forwardShield;
					energydamage -= owner.forwardShield;
					owner.forwardShield = 0;
				} else {
					if(owner.isPlayer) var d = Math.round(this.ship.energy);//debug
					this.ship.energy += energydamage;
					if(this.ship.isPlayer) player.console(this.ship.name+&quot; &quot;+d+&quot; &quot;+Math.round(this.ship.energy)
						+&quot; &quot;+Math.round(amount));//debug
					owner.forwardShield -= energydamage;
					energydamage = 0;
				}
			} else { //aft
				if(energydamage &gt; owner.aftShield) {
					this.ship.energy += owner.aftShield;
					energydamage -= owner.aftShield;
					owner.aftShield = 0;
				} else {
					this.ship.energy += energydamage;
					owner.aftShield -= energydamage;
					energydamage = 0;
				}
			}
		} else if(worldScripts[&quot;customshields&quot;]) { //NPC, check if CustomShields installed
			if(angle &lt; 1.57) {
				if(energydamage &gt; owner.script.customshieldsaftshieldlevel) {
					this.ship.energy += owner.script.customshieldsaftshieldlevel;
					energydamage -= owner.script.customshieldsaftshieldlevel;
					owner.script.customshieldsaftshieldlevel = 0;
				} else {
					this.ship.energy += energydamage;
					owner.script.customshieldsaftshieldlevel -= energydamage;
					energydamage = 0;
				}
			} else {
				if(energydamage &gt; owner.script.customshieldsforwardshieldlevel) {
					this.ship.energy += owner.script.customshieldsforwardshieldlevel;
					energydamage -= owner.script.customshieldsforwardshieldlevel;
					owner.script.customshieldsforwardshieldlevel = 0;
				} else {
					this.ship.energy += energydamage;
					owner.script.customshieldsforwardshieldlevel -= energydamage;
					energydamage = 0;
				}
			}
		}
	}
	if(energydamage &gt; 0 &amp;&amp; owner.isPlayer) {
		if(!this.$Hardturret_HitTimer)  { 
			//delayed show the energy of the turret after hit to avoid too many messages
			this.$Hardturret_HitTimer = new Timer(this, this.$Hardturret_Hit, 1);
		}
	}
}

this.$Hardturret_Pos = function() {
	var pos = &quot;&quot;;
	if(this.ship.name === &quot;Main Turret&quot;) pos+=&quot;Main &quot;;//Main Turret always placed in Front
	else if(this.ship.position.z&gt;2)  pos+=&quot;Fore &quot;;
	if(this.ship.position.z&lt;-2)  pos+=&quot;Aft &quot;;
	if(this.ship.position.x&gt;2)  pos+=&quot;Port &quot;;
	if(this.ship.position.x&lt;-2)  pos+=&quot;Starboard &quot;;
	if(this.ship.position.y&gt;2)  pos+=&quot;Up &quot;;
	if(this.ship.position.y&lt;-2)  pos+=&quot;Down &quot;;
	return(pos);
}

this.$Hardturret_Hit = function() {
	player.consoleMessage(this.$Hardturret_Pos()+&quot;Turret &quot;+Math.ceil(this.ship.energy)+&quot; armor left.&quot;);
	if(this.$Hardturret_HitTimer) {
		this.$Hardturret_HitTimer.stop();
		delete this.$Hardturret_HitTimer;
	}
}

this.shipDied = function () {
	if(this.ship.owner === player.ship) //switch(this.ship.primaryRole)
	{
//		case &quot;ballturret&quot;:
//		case &quot;ball_turret&quot;:
//		{
			player.commsMessage(this.$Hardturret_Pos()+&quot;Turret gone.&quot;);
//			break;
//		}
//		default: break
	}
};
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/largeonly.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;largeonly&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;This equipment is usable only for ships over 130t like the Cobra III or Rocket Miner.&quot;;
this.version     = &quot;1.0&quot;;

this.allowAwardEquipment = function(eqKey, ship, context)
{
//	player.consoleMessage( eqKey+&quot; &quot;+ship+&quot; &quot;+context );//debug
	if( ship.mass &gt;= 130000 ) return true;
	else return false;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/notforsmall.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;notforsmall&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;This equipment can not fit into small ships like the Rocket Fighter.&quot;;
this.version     = &quot;1.0&quot;;

this.allowAwardEquipment = function(eqKey, ship, context)
{
//bugfix for eqs with conditions scripts: need double replaceShip() to work!
//player.replaceShip(shipname, pers); player.replaceShip(shipname, pers);
//call twice! the first always got false for allow without run this script.
//Proof: if you uncomment the following line, only the 2nd call will write into the log.
//log(&quot;notforsmall&quot;, eqKey+&quot; &quot;+ship.name+&quot; &quot;+ship.mass+&quot; &quot;+context );

	if( ship.mass &gt;= 30000 ) return true;
	else return false;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/shieldrepair.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;shieldrepair&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Repair Hard Shield and Anti-Sapper Shield Equipments if damaged only.&quot;;
this.version     = &quot;1.0&quot;;

this.allowAwardEquipment = function(eqKey, ship, context)
{
	if( eqKey===&quot;EQ_HARDSHIELD_REPAIR&quot; //Repair Hard Shield and Anti-Sapper Shield Equipments if damaged only
			&amp;&amp; ( player.ship.equipmentStatus(&quot;EQ_HARDSHIELD_1&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
			|| player.ship.equipmentStatus(&quot;EQ_HARDSHIELD_2&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
			|| player.ship.equipmentStatus(&quot;EQ_HARDSHIELD_3&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
			|| player.ship.equipmentStatus(&quot;EQ_HARDSHIELD_4&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
			|| player.ship.equipmentStatus(&quot;EQ_HARDSHIELD_5&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
			|| player.ship.equipmentStatus(&quot;EQ_HARDSHIELD_6&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
			|| player.ship.equipmentStatus(&quot;EQ_HARDSHIELD_7&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
			|| player.ship.equipmentStatus(&quot;EQ_HARDSHIELD_8&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
			|| player.ship.equipmentStatus(&quot;EQ_HARDSHIELD_9&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
			|| player.ship.equipmentStatus(&quot;EQ_HARDSHIELD_10&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
			|| player.ship.equipmentStatus(&quot;EQ_BIGSHCAP&quot;) === &quot;EQUIPMENT_DAMAGED&quot;
			|| player.ship.equipmentStatus(&quot;EQ_SAPPERNULLIFIER&quot;) === &quot;EQUIPMENT_DAMAGED&quot; //for sure only
			|| player.ship.equipmentStatus(&quot;EQ_ANTISAPPER&quot;) === &quot;EQUIPMENT_DAMAGED&quot; ) )
			return true;
	return false;
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
