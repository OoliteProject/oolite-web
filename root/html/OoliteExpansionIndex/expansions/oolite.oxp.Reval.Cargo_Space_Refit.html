<html>
    <head>
        <title>Expansion Cargo Space Refit</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Cargo Space Refit</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>http://wiki.alioth.net/index.php/Cargo%20Space%20Refit -&gt; 404 Not Found</li>
                <li>Low hanging fuit: Information URL exists...</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>A complete dismantling and refurbishment of a ship&#39;s utilizable interior, this radical refit has been found to double the hold capacity of most vessels.</td>
                    <td>A complete dismantling and refurbishment of a ship&#39;s utilizable interior, this radical refit has been found to double the hold capacity of most vessels.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Reval.Cargo_Space_Refit</td>
                    <td>oolite.oxp.Reval.Cargo_Space_Refit</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Cargo Space Refit</td>
                    <td>Cargo Space Refit</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Reval</td>
                    <td>Reval</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.0</td>
                    <td>1.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Cargo_Space_Refit_OXZ">http://wiki.alioth.net/index.php/Cargo_Space_Refit_OXZ</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/1/1e/Cargo_Space_Refit.oxz">https://wiki.alioth.net/img_auth.php/1/1e/Cargo_Space_Refit.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1669784057</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_CARGO_REFIT.html">Cargo Space Refit</a></td>
                    <td>yes</td>
                    <td align="right">1000</td>
                    <td align="center">5+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/csr_conditions.js</td>
                    <td><pre>// conditions for award of Cargo Space Refit
&quot;use strict&quot;;
this.name = &quot;CSR Conditions&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	
	if (equipment == &quot;EQ_CARGO_REFIT&quot;) {
		var charges = 0, csc = 0;
		// if containers are fitted, this will include their capacity
		// so the refit should be ordered before fitting them
		var csc = ship.cargoSpaceCapacity;
		for (var i=1; i&lt;=csc; i++) charges += 500;
		if (player.credits&gt;=charges) return true;
			else return false;
	}
	return true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/csr_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Cargo Space Refit&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_CARGO_REFIT&quot;) {
		if (this.$csrFitted==&quot;no&quot;) {
			// increase space by ship&#39;s nominal capacity
			player.ship.cargoSpaceCapacity += this.$csrNominal;
			var pcc=player.ship.cargoSpaceCapacity;
			pc(&quot;Refitting ship to &quot;+pcc+&quot; TC capacity...&quot;,9);
			this.$csrSpace = pcc;
			// charge refit fee according to ship size
			for (var i=1; i&lt;= this.$csrNominal; i++)
				this.$csrCharges += 500;
			// debit customer&#39;s account
			// note: player.credits won&#39;t go into the red!
			player.credits -= this.$csrCharges;
			// reimburse deposit
			var pd = paid/10; // decicredits, so convert
			this.$csrDeposit = pd;
			player.credits += pd;
			pc(&quot;Total cost: &quot;+this.$csrCharges+&quot; cr&quot;,9);
			pc(&quot;F4 to check your invoice.&quot;,9);
			this.$csrFitted = &quot;yes&quot;;
			// prepare Invoice Interface
			var sta = player.ship.dockedStation;			
			this._csrPrepInv(sta);
		} else pc(&quot;Ship already refitted.&quot;,7);
	}	
}


this.equipmentRemoved = function(equipmentKey) {
    var pc=player.consoleMessage;
	if (equipmentKey == &quot;EQ_CARGO_REFIT&quot;) {
		pc(&quot;We cannot un-refit your ship!&quot;,7);
	}
}


this.playerBoughtNewShip = function(ship, price) {
	var pc = player.consoleMessage;
	// reset csr globals and note new capacity
	this.$csrNominal = ship.cargoSpaceCapacity;
	this.$csrSpace = 0;
	this.$csrFitted = &quot;no&quot;;
	this.$csrCharges = 0;
	this.$csrDeposit = 0;	
}


this.shipDockedWithStation = function(station) {
	// conditionally, prepare Invoice Interface
	if (this.$csrFitted==&quot;yes&quot;)	this._csrPrepInv(station);
}


this.startUpComplete = function () {
	var pc = player.consoleMessage;
	if (missionVariables.csrSpace != null) 
		player.ship.cargoSpaceCapacity += missionVariables.csrSpace;
	if (missionVariables.csrFitted != null) 
		this.$csrFitted = missionVariables.csrFitted;
	if (missionVariables.csrCharges != null) 
		this.$csrCharges = missionVariables.csrCharges;
	if (missionVariables.csrDeposit != null) 
		this.$csrDeposit = missionVariables.csrDeposit;
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	this.$csrSpace = 0;
	this.$csrFitted = &quot;no&quot;;
	// record nominal capacity in case Containers are present
	this.$csrNominal = player.ship.cargoSpaceCapacity;
	// initialize charges
	this.$csrCharges = 0;
	// initialize deposit
	this.$csrDeposit = 0;	
}


this.playerWillSaveGame = function(message) {
	missionVariables.csrSpace = this.$csrSpace;
	missionVariables.csrFitted = this.$csrFitted;
	missionVariables.csrCharges = this.$csrCharges;
	missionVariables.csrDeposit = this.$csrDeposit;
}


// create F.E.S. Cargo Space Invoice sheet  
this._csrPrepInv = function(station) {
	station.setInterface(&quot;csrInv&quot;,{
	title: &quot;Your FE Shipyards Invoice for CSR work&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards invites you to check your Invoice for the recent Cargo Space Refit undertaken on your behalf.&quot; ,
	callback: this._csrShowInv.bind(this)
	});	
}


// show F.E.S. Invoice for Cargo Space Refit
this._csrShowInv = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards Invoice for Cargo Space Refit&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;This constitutes your invoice for our successful cargo space refit recently undertaken on your &quot;+player.ship.name+&quot; with nominal capacity &quot;+this.$csrNominal+&quot;  TC.\n\n&quot;;
	
	parameters.message += &quot;Total Charges: &quot;+this.$csrCharges+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;The amount debited from your account includes your initial deposit of &quot;+ this.$csrDeposit + &quot; cr. \n\n&quot;;
	
	parameters.message += &quot;We count, as always, on your satisfaction with our service.\n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;csrAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)
			player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}	
}

</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
