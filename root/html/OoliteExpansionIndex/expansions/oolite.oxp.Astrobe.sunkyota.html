<html>
    <head>
        <title>Expansion Wildships Kiota stations relocator</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Wildships Kiota stations relocator</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Required Expansions mismatch between OXP Manifest and Expansion Manager at character position 0063 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
                <li>Unknown key &#39;upload_date&#39; at https://wiki.alioth.net/img_auth.php/c/ca/Oolite.oxp.astrobe.sunkyota.oxz!manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Restricts Wildships to spawn at most one Kiota station near the sun. Also prevents it from replacing main stations.</td>
                    <td>Restricts Wildships to spawn at most one Kiota station near the sun. Also prevents it from replacing main stations.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Astrobe.sunkyota</td>
                    <td>oolite.oxp.Astrobe.sunkyota</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Wildships Kiota stations relocator</td>
                    <td>Wildships Kiota stations relocator</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Dockables</td>
                    <td>Dockables</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Astrobe</td>
                    <td>Astrobe</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.1</td>
                    <td>1.1</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.Thargoid.Wildships:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Thargoid.Wildships:</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://www.aegidian.org/bb/viewtopic.php?f=4&amp;t=19033">http://www.aegidian.org/bb/viewtopic.php?f=4&amp;t=19033</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/c/ca/Oolite.oxp.astrobe.sunkyota.oxz">https://wiki.alioth.net/img_auth.php/c/ca/Oolite.oxp.astrobe.sunkyota.oxz</a></td>
                    <td><a target="_blank" href="http://wiki.alioth.net/img_auth.php/c/ca/Oolite.oxp.astrobe.sunkyota.oxz">http://wiki.alioth.net/img_auth.php/c/ca/Oolite.oxp.astrobe.sunkyota.oxz</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873473</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Wildships%20Kiota%20stations%20relocator'>http://wiki.alioth.net/index.php/Wildships%20Kiota%20stations%20relocator</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name           = &quot;Kyota_relocator&quot;;
this.author         = &quot;Astrobe&quot;;
this.copyright      = &quot;Astrobe&quot;;
this.licence        = &quot;Public domain&quot;;
this.description    = &quot;Only one Kyota station per system at most, located near the sun.&quot;;
this.version        = &quot;1.0.1&quot;;

this.kyotaPopulator = function ()
{
	//calculate distances
	var planetToSun = system.sun.position.distanceTo(system.mainPlanet.position);
	var wpToSun = system.sun.position.magnitude();

	var distanceFromPlanetSurface = 0.9 * (planetToSun  - system.sun.radius - system.mainPlanet.radius);
	//randomize the position a bit
	var x_coord = system.scrambledPseudoRandomNumber(600) * 25E3;
	var y_coord = system.scrambledPseudoRandomNumber(484) * 25E3;
	var z_coord = system.mainPlanet.radius + distanceFromPlanetSurface;
	var exactPosition = Vector3D(x_coord, y_coord, z_coord).fromCoordinateSystem(&quot;psm&quot;);

	 if(system.scrambledPseudoRandomNumber(188) &lt; 0.2 ) {
		// add Disc stations
		if(system.population &gt; 40)
			var solar_station = &quot;wildShips_kiota4Disc&quot;;
		else
			var solar_station = &quot;wildShips_kiota2Disc&quot;;
		system.setPopulator(&quot;wild_ships_disc&quot;, {
			callback: function(pos) {			
				system.addShips(solar_station, 1, pos, 0);					
			}.bind(this),
			location: &quot;COORDINATES&quot;,
			coordinates: exactPosition,
			deterministic: true
		})		
	 }
	 else if(system.scrambledPseudoRandomNumber(189) &lt; 0.2 ) {
		// add solar stations
		if(system.population &gt; 40)
			var solar_station = &quot;wildShips_kiota4Solar&quot;;
		else
			var solar_station = &quot;wildShips_kiota2Solar&quot;;
		system.setPopulator(&quot;wild_ships_solar&quot;, {
			callback: function(pos) {			
				system.addShips(solar_station, 1, pos, 0);					
			}.bind(this),
			location: &quot;COORDINATES&quot;,
			coordinates: exactPosition,
			deterministic: true
		})		
	}
	else if(system.scrambledPseudoRandomNumber(127) &lt; 0.2) {
		//comms stations
		// add comms stations
		if(system.population &gt; 40)
			var comms_station = &quot;wildShips_kiota4Comms&quot;;
		else
			var comms_station = &quot;wildShips_kiota2Comms&quot;;
		system.setPopulator(&quot;wild_ships_comms&quot;, {
			callback: function(pos) {			
				system.addShips(comms_station, 1, pos, 0);					
			}.bind(this),
			location: &quot;COORDINATES&quot;,
			coordinates: exactPosition,
			deterministic: true
		})
	}
	else if(system.scrambledPseudoRandomNumber(891) &lt; 0.2 ) {
		if (system.population &lt; 30)
			var hab_station = &quot;wildShips_kiota2Ring&quot;;
		else {
			if (system.population &gt; 45) {
				if (system.scrambledPseudoRandomNumber(319) &gt; 0.5)
					var hab_station = &quot;wildShips_kiota8Ring&quot;;
				else
					var hab_station = &quot;wildShips_kiota8RingV&quot;;
			}
			else {
				if(system.scrambledPseudoRandomNumber(319) &gt; 0.5)
					var hab_station = &quot;wildShips_kiota4Ring&quot;;
				else
					var hab_station = &quot;wildShips_kiota4RingV&quot;;
			}
		}
		system.setPopulator(&quot;wild_ships_habitat&quot;, {
			callback: function(pos) {			
				system.addShips(hab_station, 1, pos, 0);					
			}.bind(this),
			location: &quot;COORDINATES&quot;,
			coordinates: exactPosition,
			deterministic: true
		})
	}
	else if(system.techLevel &gt; 6 &amp;&amp; system.scrambledPseudoRandomNumber(713) &lt; 0.2 ) {
		// add research stations to higher tech systems
		if(system.techLevel &gt; 11)
			var research_station = &quot;wildShips_kiota4Spur&quot;;
		else
			var research_station = &quot;wildShips_kiota2Spur&quot;;

		system.setPopulator(&quot;wild_ships_research&quot;, {
			callback: function(pos) {			
				system.addShips(research_station, 1, pos, 0);					
			}.bind(this),
			location: &quot;COORDINATES&quot;,
			coordinates: exactPosition,
			deterministic: true
		})
	}
	else if (system.scrambledPseudoRandomNumber(301) &lt; 0.2 ) {
		// add manufacturing stations to industrial systems
		if (system.economy &lt; 3) {
			if(system.productivity &gt; (30000 - (system.economy * 2500)))
				var man_station = &quot;wildShips_kiota4Sphere&quot;;
			else
				var man_station = &quot;wildShips_kiota2Sphere&quot;;
		}
		else if (system.economy &gt; 4) {
			if(system.productivity &gt; (30000 - ((system.economy - 5) * 2500)))
				var man_station = &quot;wildShips_kiota4Sphere&quot;;
			else
				var man_station = &quot;wildShips_kiota2Sphere&quot;;
		}
		else return;

		system.setPopulator(&quot;wild_ships_manufacturing&quot;, {
			callback: function(pos) {			
				system.addShips(man_station, 1, pos, 0);					
			}.bind(this),
			location: &quot;COORDINATES&quot;,
			coordinates: exactPosition,
			deterministic: true
		})
	}
	log(this.name, &quot;relocated a station succesfully&quot;);
}

this.startUp = function()
{
	// This is taken from http://wiki.alioth.net/index.php/Handling_OXP_Dependencies_with_JavaScript
      delete this.startUp;


      // function to handle the initialising of other scripts
      function runOtherStartUp(s) {
	if (worldScripts[s].startUp) worldScripts[s].startUp(); // Call the other startUp.
	if (worldScripts[s].startUp) delete worldScripts[s].startUp; // Make sure the other startUp is deleted as it may not be written using
                                                                     // this template.
      };

      runOtherStartUp(&quot;wildShips_populator.js&quot;);


      // Test for existence of an OXP that isn&#39;t required but effects the way this OXP works.
      this.Oxp_X_Script_Exists = !!worldScripts[&quot;wildShips_populator.js&quot;];


      worldScripts[&quot;wildShips_populator.js&quot;].systemWillPopulate=this.kyotaPopulator; // This is what I want to do.

      log(this.name, this.version +&quot; loaded.&quot;); // This goes last so the load messages appear in a sensible order.

}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
