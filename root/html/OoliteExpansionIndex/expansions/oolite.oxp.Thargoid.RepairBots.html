<html>
    <head>
        <title>Expansion Repair Bots</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Repair Bots</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">6 Equipment</a></li>
          <li><a href="#ships">1 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">3 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER E)(&#39;[]&#39; vs &#39;[equipment]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Pylon-stored and triggered nanobots, can repair damaged ships systems. Also now available a new repair system, which gives full damage control for any ship not already featuring it.</td>
                    <td>Pylon-stored and triggered nanobots, can repair damaged ships systems. Also now available a new repair system, which gives full damage control for any ship not already featuring it.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.RepairBots</td>
                    <td>oolite.oxp.Thargoid.RepairBots</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Repair Bots</td>
                    <td>Repair Bots</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.14</td>
                    <td>2.14</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>equipment</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Repair_Bots_OXP">http://wiki.alioth.net/index.php/Repair_Bots_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/0/05/RepairBots-2.14.oxz">https://wiki.alioth.net/img_auth.php/0/05/RepairBots-2.14.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 3.0</td>
                    <td>CC BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1660778714</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Repair%20Bots'>http://wiki.alioth.net/index.php/Repair%20Bots</a></p>
        <h3>Readme.txt</h3>
        <pre>RepairBots OXP
--------------
by Thargoid

The Ships Systems Department of the Aquarian Shipbuilding Corporation would like to present to you their latest products, the repair nanobots. These useful little things come in a pylon-mounted cannister, which when released (with the cannister selected, activate them by pressing &quot;T&quot; and then release by pressing &quot;M&quot;) scan the player&#39;s ship for broken equipment.

They can fix almost any broken item, although their chances decrease as the complexity of the equipment increases. For the higher tech items they may not succeed in their task, although a second attempt (via another cannister) may work.

If there is nothing that the &#39;bots can fix, then the cannister will simply be wasted.


Breaking News:

Just announced by the Corporation is their latest product - the Self-Repair System. Declassified documents recently released details of a heavily wounded Caduceus bioship arriving at Corporate HQ for repairs, its own damage control systems having been destroyed. In the course of the treatment it was discovered that the system had evolved from the assimilation and adaptation of the Corporations own nanobots by the craft&#39;s ancestors. The craft was successfully treated and returned to full health, and in return shared its knowledge of using the &#39;bots for adaptive self-healing and regeneration.

There are two versions of the system: the normal version with enough &#39;bots for 10 repair attempts, the light version for 5 repair attempts. Supplies can be refilled once around half are used. If the system empties then no further repairs (except for itself) can be performed until it is refilled. A note of how many attempts are left is available on the ships manifest (F5) screen.

The system also takes cargo space in the ships hold, to store the nanobot charges: the normal system takes 2 TCs and the light takes one TC. Both consume energy when repairing equipment, 1 energy unit per second, double that when self-repairing, and will shutdown when there is a single energy bank left, resuming operation once energy levels come back to at least 2 energy banks.

Requires v1.79 or later of Oolite. It will not run on older versions.


Notes of OXP developers
-----------------------

OXPs can control how Repair Bots repairs their equipment through the equipment&#39;s script_info. To do that, add to the equipment difinition in equipment.plist:

        script_info = { thargoidRepairBotChance = X; };

here X is the probability of a successfull repair, a number between 0 (never repaired) and 1 (always repaired).

Other OXPs can also temporarily inhibit Repair Bots from repairing an equipment through the use of the disabling/enabling equipment functions described bellow.

worldScripts[&quot;Repair System&quot;].$disableEquipment(eqKey, who, why)
    eqkey: string, equipment key
    who: string, identifies the caller
    why: string, describes the reason why the equipment is disabled

    Sets the equipment as DAMAGED and inserts it in the disabled equipment list (equipment in th disabled list is not repaired)

worldScripts[&quot;Repair System&quot;].$enableEquipment(eqKey, who)
    eqkey: string, equipment key
    who: string, identifies the caller
    
    Removes the caller from the disablers of the equipment and if there is no disabler left, sets the equipmenty status to OK 

License
-------

iThis OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license. 
(https://creativecommons.org/licenses/by-nc-sa/3.0/)

Version history
---------------

05/09/2008 - Version 0.10, beta test release.
25/09/2008 - Version 0.99, pre-release version with some OXP equipment support (more to follow). Inclusion of chance of failure for more complex equipment (above equipment tech level 8) and lowering of price to 3000 credits.
10/11/2008 - Version 1.00, script update for v1.72 compatability.
02/09/2009 - Version 1.10, ditto for v1.73.
17/05/2010 - Version 2.00, update for v1.74 (only) - now uses script to scan players equipment, so can fix anything not explicitly in the exclusion list. Also new addition of the repair system
13/02/2011 - Version 2.01, removal of upper limit, to allow running with 1.75
02/04/2011 - Version 2.02, superb new pylon icon for the repair bot cannister, by Eldon.
02/11/2011 - Version 2.03, script speed hack courtesy of Capt. Murphy.
03/11/2011 - Version 2.04, further optimisation by Eric Walch.
19/03/2012 - Version 2.05, corrected error in script - thanks to Cmdr Cheyd.
09/05/2012 - Version 2.06, made repair system require 2t of cargo space ready for v1.77 implementation. Also will only work for 10 repairs before needing a recharge.
03/06/2012 - Version 2.07, removing minor glitch so remaining charges only show on F5 manifest screen when the Repair System is actually installed - thanks to JazHaz for the heads-up.
23/07/2012 - Version 2.08, small bugfix to cope better with selling of ships and persistence of mission variables.
07/08/2012 - Version 2.09, temporary removal of requirement for 2t cargo due to bug in 1.76.1 (rollback of v2.06 in part)
xx/xx/2012 - Version 2.10, requirement now for 1.77. Restored the 2t space requirement. Also added an 0.5s delay to activation on damage, to allow other scripts to run first (OXP equipment self-repair and also realistic damage OXP).
24/08/2020 - Version 2.11, introduced Repair System Light, with 5 charges taking 1 TC of cargo space, and Recharge 5-Pack; introduced energy cost while repairing, with minimum of one energy bank to work. (Dybal)
13/09/2020 - Version 2.12, checks for repair controller existence before starting the repair system.

04/10/2020 - Version 2.13
* Energy thresholds are now proportional to the ship&#39;s maxEnergy and not absolute: repair stops when energry drops to 20% and resumes when it reaches 40%.
* Self-repair, i.e., repairing the Repair System Controller, consumes 2 charges.
* New functions for other OXPs tell Repair Systems that an equipment is disabled, i.e., it&#39;s damaged but should not be repaired. This allows OXPs to inhibit Repair Systems actions on a given equipment during a period of time, while the probabilities in the scriptInfo are &quot;hard-coded&quot;, i.e., can&#39;t be changed by scripts.

17/08/2022 - Version 2.14
* Changes the to remove the &quot;Thargoid clauses&quot; after Thargoid allowed modification when retired from maintaining his OXps (http://aegidian.org/bb/viewtopic.php?f=4&amp;t=17085).
* Fixes typo that prevented resuming operation after a low energy period (thanks to cag and UK_Eliter!).

Acknowledgements
----------------
With thanks to ClymAngus and Commander Wyvern for the inspiration for the self-repair system, from their recycling of the repair bots code to form the DCN node in the Caduceus family of ships.

And to DredgerMan and Cim about the issue with 1.76.1 and required cargo space.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_REPAIRBOTS_CONTROLLER.html">Self-Repair System</a></td>
                    <td>yes</td>
                    <td align="right">120000</td>
                    <td align="center">11+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_REPAIRBOTS_CONTROLLER_LIGHT.html">Self-Repair System Light</a></td>
                    <td>yes</td>
                    <td align="right">100000</td>
                    <td align="center">12+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_REPAIRBOTS_MINE.html">Repair Nanobots</a></td>
                    <td>yes</td>
                    <td align="right">30000</td>
                    <td align="center">9+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_REPAIRBOTS_RECHARGE_10.html">Self-Repair System Recharge, 10-Pack</a></td>
                    <td>yes</td>
                    <td align="right">10000</td>
                    <td align="center">9+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_REPAIRBOTS_RECHARGE_5.html">Self-Repair System Recharge, 5-Pack</a></td>
                    <td>yes</td>
                    <td align="right">6000</td>
                    <td align="center">9+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/Sell Self-Repair System.html">1000</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">12+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/repairBots_Bots.html">Repair Nanobots</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/repairBots_Repair.js</td>
                    <td><pre>this.name        = &quot;Repair Nanobots&quot;;
this.author      = &quot;Thargoid&quot;;
this.copyright   = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Scan through a list of possible broken equipment, see what the player has, and then fix one of them&quot;;
this.version     = &quot;2.11&quot;;
&quot;use strict&quot;;

//------------------------------------------------------------------------------------------//
this.$repairSystems = function() {
    var _fname = &quot;repairSystems&quot;;
    this.$playerDamagedList = [];
    var _ship = player.ship;
    var _equipment = _ship.equipment;
    var _listCounter = 0 ; // reset the counter
    var _eqInfo;

    for(_listCounter = 0; _listCounter &lt; _equipment.length; _listCounter++) {
        if (_ship.equipmentStatus(equipment[_listCounter].equipmentKey) !== &quot;EQUIPMENT_DAMAGED&quot;)
            continue; 
        _eqInfo = _equipment[_listCounter];
        log(this.name, _fname+&quot;: Equipment damaged:&quot;+_eqInfo.equipmentKey+&quot;, RepairBotChance:&quot;+_eqInfo.scriptInfo.thargoidRepairBotChance);
        if (_eqInfo.scriptInfo.thargoidRepairBotChance === undefined 
                || isNaN(_eqInfo.scriptInfo.thargoidRepairBotChance)
                || (!isNaN(_eqInfo.scriptInfo.thargoidRepairBotChance) &amp;&amp; _eqInfo.scriptInfo.thargoidRepairBotChance &gt; 0) ) { 
            // if it&#39;s broke and fixable, add it to the list.
            log(this.name, _fname+&quot;: Putting damaged equipment in repair list:&quot;+_eqInfo.equipmentKey);
            this.$playerDamagedList.push(eqInfo.equipmentKey); 
        }
    }
 
    if (this.$playerDamagedList.length === 0) {
        log(this.name, _fname+&quot;: Nothing damaged that the repair bots can fix.&quot;);
        player.consoleMessage(&quot;Nothing damaged that the repair bots can fix.&quot;, 5);
        return;
    } else {
        var damagedEquipment = Math.floor(Math.random() * this.$playerDamagedList.length); // pick a random element from the list...
        _fixedItem = this.$playerDamagedList[damagedEquipment]; // ...define the item...
        _eqInfo = EquipmentInfo.infoForKey(_fixedItem);
        _fixedName = _eqInfo.name; // define it&#39;s screen name
        let _fixedTech = _eqInfo.effectiveTechLevel // tech level of the item
        log(this.name, _fname+&quot;: Choose &quot;+_fixedItem+&quot; to repair from list: &quot;+this.$playerDamagedList);
        log(this.name, _fname+&quot;: Choosen equipment &quot;+_fixedItem+&quot; RepairBotChance: &quot;+_eqInfo.scriptInfo.thargoidRepairBotChance+&quot;, fixedTech: &quot;+_fixedTech+&quot;, Name: &quot;+_fixedName);

        switch (true) {
            case (_eqInfo.scriptInfo.thargoidRepairBotChance !== undefined &amp;&amp; !isNaN(_eqInfo.scriptInfo.thargoidRepairBotChance)): {
                let _fixChance = _eqInfo.scriptInfo.thargoidRepairBotChance;
                break;
            }
            case (_fixedTech &lt; 9): { 
                let _fixChance = 1; 
                break; 
            }
            case (_fixedTech &gt; 8 &amp;&amp; _fixedTech &lt; 17): {
                let _fixChance = 1 - ((_fixedTech - 8)/10); 
                break;
            }
            case (_fixedTech === 99): {
                let _fixChance = 0.1; 
                break;
            }
            default: {
                let _fixChance = 0.2; 
                break;
            }
        }

        log(this.name, _fname+&quot;: fixChance: &quot;+_fixChance);
        if(Math.random() &lt; _fixChance)
            this.$fixItem(_eqInfo); 
        else { 
            log(this.name, _fname+&quot;: &quot;+_fixedName + &quot; repair attempt has failed.&quot;);
            player.consoleMessage(_fixedName + &quot; repair attempt has failed.&quot;, 5); 
        }
    }
}

//------------------------------------------------------------------------------------------//
this.$fixItem = function(eqInfo) {
    var _fname = &quot;fixItem&quot;;
    var _ship = player.ship;
    var _eqKey = eqInfo.equipmentKey;

    _ship.setEquipmentStatus(_eqKey,&quot;EQUIPMENT_OK&quot;); // and actually fix the thing!
    log(this.name, _fname+&quot;: &quot;+eqInfo.name + &quot; fixed by the repair bots.&quot;);
    player.consoleMessage(eqInfo.name + &quot; fixed by the repair bots.&quot;, 5)
    switch (_eqKey) { // specific OXP equipment which need rebooting after fixing, or have other issues.
        case &quot;EQ_FRAME_FUEL_COLLECTOR&quot;: {
            if (worldScripts[&quot;Fuel Collector&quot;]) 
                worldScripts[&quot;Fuel Collector&quot;].shipLaunchedFromStation(); // restart the timers in it&#39;s world script
            break;
        }
        case &quot;EQ_FRAME_BOUNTY_SCANNER&quot;: {
            if (worldScripts[&quot;Bounty Scanner&quot;])  
                worldScripts[&quot;Bounty Scanner&quot;].shipLaunchedFromStation(); // restart the timers in it&#39;s world script
            break;
        }
        case &quot;EQ_EEU&quot;: {
            if (worldScripts[&quot;Emergency Energy Unit&quot;])
                worldScripts[&quot;Emergency Energy Unit&quot;].shipLaunchedFromStation(); // restart the timers in it&#39;s world script
            break;
        }
        case &quot;EQ_ROCKHERMIT_SCANNER&quot;: { 
            if (worldScripts[&quot;rockHermit_Locator&quot;]) {
                if (worldScripts[&quot;rockHermit_Locator&quot;].version === &quot;1.2.3&quot;)
                    worldScripts[&quot;rockHermit_Locator&quot;].shipLaunchedFromStation() // use the inbuild scripting of the OXP to restart it.
                else {
                    let _beacons = system.shipsWithPrimaryRole(&quot;rockbeacof&quot;); // list the inactive beacons (no lights or &quot;R&quot; on compass) 
                    if (_beacons.length &gt; 0) { 
                        for (let i=0; i &lt; _beacons.length;i++) { 
                            if (oolite.compareVersion(&#39;1.73&#39;) &lt;= 0) 
                                _beacons[i].position = _beacons[i].position.multiply(100); //throw the rockbeacof into space... 
                            else 
                                _beacons[i].setPosition(_beacons[i].position.multiply(100)); //throw the rockbeacof into space... 
                            _beacons[i].explode(); //...and blow it up. 
                        } 
                    } 
                    worldScripts[&quot;rockHermit_Locator&quot;].buoy = &quot;rockbeacon&quot; 
                    worldScripts[&quot;rockHermit_Locator&quot;].addBuoys() // no inactive beacons, so use original code to add active beacons. 
                }
            }
            break; 
        } 
    }
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/repairBots_System.js</td>
                    <td><pre>notYetParsed</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/repair_system_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;repair_system_conditions&quot;;
this.author         = &quot;Dybal&quot;
this.copyright      = &quot;2020 Dybal&quot;;
this.license        = &quot;CC BY-NC-SA 4.0&quot;;
this.description    = &quot;Repair System Equipment Conditions&quot;;
this.version        = &quot;2.11&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
    var _controller = worldScripts[&quot;Repair System&quot;].$controllerVersion;
    var _charges_left = missionVariables.repairCounter;
    var ret = false;    

    if (equipment === &quot;EQ_REPAIRBOTS_RECHARGE_10&quot;) {
        if (_charges_left &lt;= 5)    
            ret = true;
    } else if (equipment === &quot;EQ_REPAIRBOTS_RECHARGE_5&quot;) {
        if (_controller === &quot;EQ_REPAIRBOTS_CONTROLLER_LIGHT&quot; &amp;&amp;  _charges_left &lt;= 2 ||
            _controller === &quot;EQ_REPAIRBOTS_CONTROLLER&quot; &amp;&amp;  _charges_left &lt;= 7)    
            ret = true;
    }
    return ret;
}

</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
