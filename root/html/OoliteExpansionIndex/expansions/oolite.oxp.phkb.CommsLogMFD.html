<html>
    <head>
        <title>Expansion CommsLog MFD</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion CommsLog MFD</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">4 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">3 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>http://wiki.alioth.net/index.php/CommsLog%20MFD -&gt; 404 Not Found</li>
                <li>Low hanging fuit: Information URL exists...</li>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER M)(&#39;[]&#39; vs &#39;[mfd, comms]&#39;)</li>
                <li>Unknown key &#39;upload_date&#39; at https://wiki.alioth.net/img_auth.php/e/e4/CommsLogMFD.oxz!manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Stores all communications received by the player and displays them in a multi-function display.</td>
                    <td>Stores all communications received by the player and displays them in a multi-function display.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.phkb.CommsLogMFD</td>
                    <td>oolite.oxp.phkb.CommsLogMFD</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>CommsLog MFD</td>
                    <td>CommsLog MFD</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>HUDs</td>
                    <td>HUDs</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>phkb</td>
                    <td>phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.7.10</td>
                    <td>1.7.10</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>mfd, comms</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/index.php/CommsLogMFD">https://wiki.alioth.net/index.php/CommsLogMFD</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/e/e4/CommsLogMFD.oxz">https://wiki.alioth.net/img_auth.php/e/e4/CommsLogMFD.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1697012082</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        
        <h3>readme.txt</h3>
        <pre>Comms Log MFD
By Nick Rogers

Overview
========
Communication messages can sometimes happen very quickly. When this happens, the messages may scroll off the screen before they are viewed by the player. Or the player might be busy doing something else (like fighting off pirates) and miss seeing a request for help from his escort. This addon aims to solve these problems.

This oxp stores all communications received by the player and then displays them in an MFD which can be scrolled during flight with primable equipment. Press &quot;B&quot; to select the function and &quot;N&quot; to activate it. The available functions are:
	Scroll back mode:               Message list will be scrolled backwards.
	Scroll forward mode:            Message list will be scrolled forwards.
	Scroll to previous launch:      Message list will be scrolled back to your previous launch message.
	Scroll to next launch:          Message list will be scrolled forward to the next launch message.
	View current:                   Message list will be scrolled to the most current message.
	View oldest:                    Message list will be scrolled to the oldest message in the list.
	Clear log mode:                 This will clear all messages from the log.
	Write comms to lastest log:     This will write all messages to the &quot;latest.log&quot; file.
	Switch to message scrolling:    This will switch the list to scroll by messages.
	Switch to line scrolling:       This will switch the list to scroll by line.

When docked, a &quot;Communications Log&quot; item will appear in the Interfaces (F4) screen. When opened, all messages received by the player will be listed, in date order (oldest first, newest last). From this screen there are several options:
	Previous Page:                  Move the list back one page.
	Next Page:                      Move the list forward one page.
	First Page:                     Go to the first page of the list.
	Last Page:                      Go to the last page of the list.
	Write comms to latest log:      Write all messages to the latest log file.
	Clear the log:                  Clears all messages from the log.
	Set log size:                   Allows the user to define how big the log file will be. You will be asked to enter a number between 1 and 32.
	MFD currently in Active mode:   This means the MFD will be scrollable during flight using the primable equipment. Select this item to change the mode to Passive (see next item).
	MFD currently in Passive mode:  This means the MFD will not be scrollable during flight. There will be no primable equipment. Select this item to change the mode to Active (see previous item).

Only works with Oolite 1.79 or greater.

Installation
============
Install the OXP by copying CommsLogMFD.oxz to your AddOns folder, or downloading via the Expansion Manager in the game itself.

License
=======
This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/

Image from http://simpleicon.com/radar.html

Version history
===============
1.7.10
- Updated background overlay image for Oolite 1.91.

1.7.9
- Made the current mode value readable by other OXP&#39;s.

1.7.8
- Fixed some potential referencing errors on mission screens.
- Fixed integration issue with &quot;Interface Reordering OXP&quot;.
- Fixed some UI glitches when the log is empty.

1.7.7
- Code refactoring.

1.7.6
- Using an escape pod was showing &quot;(adjusting)&quot; in the log.

1.7.5
- Launching when the clock shows &quot;(adjusting)&quot; would include the incorrect launch date/time and this text would be included in the log.
- Code refactoring.

1.7.4
- Better handling of null values being passed to the commsMessageReceived event.

1.7.3
- Fixed error when attempting to remove the comms log MFD.
- Changed &quot;==&quot; comparisons to &quot;===&quot; for performance improvements.
- Sound effects added for mode/activate functions of MFD.

1.7.2
- Fixed Javascript bug called by mis-named function call.
- Updated check for &quot;Allow Big GUI&quot;.

1.7.1
- Internal improvements to save game format (using JSON), and other code improvements.
- If the font is changed between saves, the MFD will have its text reformatted to suit.
- Added escape pod usage notification to comms log history.
- Updated screenID&#39;s to enable BGS background sounds.
- Renamed background overlay image to prevent possibility of future duplication.
- Toned down overlay image.
- Trimmed unnecessary items out of equipment.plist.

1.7.0
- Added overlay background image to interface screen.
- Changed color of menu items on interface screen, so it&#39;s less yellow.
- Fixed issue where last page of log was not visible on the interface screen.

1.6.1
- Added routine to use 1.83/4 code to check for big GUI HUD&#39;s.
- Fixed issue where &quot;(adjusting)&quot; was appearing in messages when docking.

1.6.0
- MFD can now be removed.
- MFD can be switched between active (MFD can be scrolled with primable equipment) and passive (MFD can&#39;t be scrolled - no primable equipment) via the &quot;Communication Log&quot; interface screen

1.5.2
- Code improvements as suggested by Wildeblood.

1.5.1
- You can now exit the comms log interface screen at any time using a function key. For real this time.

1.5
- Added ability to set the log file size.
- You can now exit the comms log interface screen at any time using a function key.

1.4
- Comms messages are now viewable in the dockside F4 Communications log, even if the scroller hasn&#39;t been purchased.
- Fixed bug where clearing the log while docked would hide the HUD.
- Fixed JS bug when clearing the log in flight.
- F4 comms log options will now show all options, with various items disabled based on the log viewing position and content.
- Code refactoring and cleanup.

1.3
- Whole MFD now puchasable equipment, not just the scroller.
- New price of 250cr, which, along with the previous point, make it feel more &quot;real&quot; in game
- New modes
	* Dump messages to log, which sends all current messages to the lastest log file
	* switch scroll mode to be either by message (default) or by line
- Added &quot;Communications log&quot; to the system interfaces (f4) screen, so you can view your comms log while docked.
- Code refactoring

1.2.1
- no functional changes, just removed some debug code

1.2
- Mode selection now changes scroll function between scroll back, scroll forward, scroll to previous launch, scroll to next launch, view current, view oldest, and clear log.
- If log is scrolled and left for 90 seconds, log will automatically revert to viewing the current message
- updated license reference in manifest.plist to match with the license specified in &quot;comms_mfd.js&quot;
- split up the js files, putting the MFD code in one, and the scroller code in another.
- fixed case when first line of first message might not be viewable in some circumstances
- improved speed and memory management

1.1
- Scrolling by message, rather than by line (can be changed to line by line if you change a setting)
- Better handling of local variables
- Fixed the name of the MFD used to be consistent with the OXP name
- Log is kept between launches (can be changed to clear on launch if you change a setting)
- Log size limit added
- Added &quot;Launch&quot; and &quot;Dock&quot; messages to the comms log to help delineate between message sections
- Corrected the readme file license link to match with the license specified in &quot;comms_mfd.js&quot;
- Adjusted the width setting to leave more of a margin on the right side of the box
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_COMMSLOGMFD.html">CommsLog MFD</a></td>
                    <td>yes</td>
                    <td align="right">2500</td>
                    <td align="center">3+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_COMMSLOGMFD_PASSIVE.html">CommsLog MFD</a></td>
                    <td>yes</td>
                    <td align="right">2500</td>
                    <td align="center">3+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_COMMSLOGMFD_PASSIVE_REMOVAL.html">Remove CommsLog MFD</a></td>
                    <td>no</td>
                    <td align="right">500</td>
                    <td align="center">3+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_COMMSLOGMFD_REMOVAL.html">Remove CommsLog MFD</a></td>
                    <td>no</td>
                    <td align="right">500</td>
                    <td align="center">3+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/commslog_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;CommsLogMFD_Conditions&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2016 phkb&quot;;
this.description = &quot;Condition script for the CommsLog MFD (Passive Mode)&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;

//-------------------------------------------------------------------------------------------------------------
this.allowAwardEquipment = function(equipment, ship, context) {
	if (equipment === &quot;EQ_COMMSLOGMFD_PASSIVE&quot;) {
		if (context != &quot;scripted&quot;) return false;
	}
	if (equipment === &quot;EQ_COMMSLOGMFD&quot;) {
		var p = player.ship;
		if (p.equipmentStatus(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;) === &quot;EQUIPMENT_OK&quot; || p.equipmentStatus(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) return false;
	}
	return true
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/commslog_mfd.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;CommsLogMFD&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2016 phkb&quot;;
this.description = &quot;Stores all communications received by the player and displays them in a multi-function display.&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;

this._debug = false;		    // change to false for less logging
this._scrollTimeout = 90;		// number of seconds it will take for a scrolled view to revert to viewing current message
this._clearOnLaunch = 0;	   	// 0 = message log kept indefinitely, 1 = messages clear on launch
this._logSize = 32000;			// maximum length of log (in bytes) when clear on launch is off. Should not be set over 32k which is the maximum string length
this._lineLength = 14.2;        // horizontal measure of the max width of a line in the MFD (15 is the width of an MFD, minus some margin)
this._commsMFD_maxlines = 9;	// maximum number of lines visible in the MFD (10 - 1 for the header line)
this._syslines = [];
this._msRows = 18;				// rows to display on the mission screen
this._msCols = 32;				// columns to display on the mission screen
this._menuColor = &quot;orangeColor&quot;;
this._exitColor = &quot;yellowColor&quot;;

//-------------------------------------------------------------------------------------------------------------
this.startUp = function() {
	this._scrollMethod = 1;			// 0 = by line, 1 = by message;
	this._hudHidden = false;
	this._commsLogOpen = false;
	this._commsMFD_lines = [];
	this._commsMFD_log = &quot;&quot;;
	if (missionVariables.CommsLogMFD_logsize) this._logSize = missionVariables.CommsLogMFD_logsize;

	if (this._clearOnLaunch === 0) {
		if (missionVariables.CommsLogMFD_log == null) {
			missionVariables.CommsLogMFD_log = &quot;&quot;;
			missionVariables.CommsLogMFD_maxscroll = 0;
		}
		if (missionVariables.CommsLogMFD_scrollmethod == null) missionVariables.CommsLogMFD_scrollmethod = 1;

		if (missionVariables.CommsLogMFD_data) {
			var dta = JSON.parse(missionVariables.CommsLogMFD_data);
			this.$reformatData(dta, this._commsMFD_lines, this._lineLength);
			dta = [];
		}
		if (missionVariables.CommsLogMFD_log) {
			this.$convertLogToArray(missionVariables.CommsLogMFD_log);		// storage string of messages
			delete missionVariables.CommsLogMFD_log;
			var dta = [];
			this.$reformatData(this._commsMFD_lines, dta, this._lineLength);
			this._commsMFD_lines = dta;
			dta = [];
		}
		// make sure we&#39;re only holding one set of data
		delete missionVariables.CommsLogMFD_data;
		delete missionVariables.CommsLogMFD_log;

		this._commsMFD_maxscroll = missionVariables.CommsLogMFD_maxscroll;	// storage of maximum scroll amount
		this._scrollMethod = missionVariables.CommsLogMFD_scrollmethod;
	} else {
		this._commsMFD_maxscroll = 0;	// storage of maximum scroll amount
	}
	this._commsMFD_scroll = 0;		// storage scroll amount
	this._scrollLaunch = 0;			// used to scroll to paricular launch record, 1 = most recent, 2 = second most recent, etc
	this.$commsMFD_updateview();
}

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function() {
	if (player.ship.docked) this.$initInterface(player.ship.dockedStation);
}

//=============================================================================================================
// ship interfaces

//-------------------------------------------------------------------------------------------------------------
this.shipDockedWithStation = function(station) {
	this.$initInterface(station);
}

//-------------------------------------------------------------------------------------------------------------
this.playerWillSaveGame = function() {
	// only save if we aren&#39;t clearing every launch
	if (this._clearOnLaunch === 0) {
		missionVariables.CommsLogMFD_data = JSON.stringify(this._commsMFD_lines);
		missionVariables.CommsLogMFD_maxscroll = this._commsMFD_maxscroll;
		missionVariables.CommsLogMFD_scrollmethod = this._scrollMethod;
		missionVariables.CommsLogMFD_logsize = this._logSize;
		this._commsMFD_log = &quot;&quot;;
	}
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillDockWithStation = function(station) {
	this.commsMessageReceived(&quot;Docked in &quot; + system.name + &quot; system at &quot; + clock.clockStringForTime(clock.adjustedSeconds), station);
	// force the log to be resized to prevent it becoming too large between save games
	this.$convertArrayToString();
	this.$convertLogToArray(this._commsMFD_log);
	this._commsMFD_log = &quot;&quot;;
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillLaunchFromStation = function() {
	if (missionVariables.CommsLogMFD_data) delete missionVariables.CommsLogMFD_data;
	// reset comms log settings
	if (this._clearOnLaunch === 1) {
		this._commsMFD_log = &quot;&quot;;
		this._commsMFD_lines = [];
		this._commsMFD_maxscroll = 0;
	}
	this._commsMFD_scroll = 0;
}

//-------------------------------------------------------------------------------------------------------------
this.shipLaunchedFromStation = function(station) {
	// we&#39;re doing this here so that the &quot;(adjusting)&quot; text doesn&#39;t appear in the time stamp
	this._syslines = [];
	this.commsMessageReceived(&quot;Launched in &quot; + system.name + &quot; system at &quot; + clock.clockStringForTime(clock.adjustedSeconds), station);
	this.$commsMFD_updateview();
}

//-------------------------------------------------------------------------------------------------------------
this.shipLaunchedEscapePod = function(escapepod, passengers) {
     this.$addCommsMessage(&quot;Escape pod activated in &quot; + system.name + &quot; system at &quot; + clock.clockString.replace(&quot;(adjusting)&quot;, &quot;&quot;), &quot;GalCop Emergency Beacon&quot;);
}

//-------------------------------------------------------------------------------------------------------------
this.guiScreenChanged = function(to, from) {
	if (from === &quot;GUI_SCREEN_MISSION&quot; &amp;&amp; this._commsLogOpen) {
		this._commsLogOpen = false;
		player.ship.hudHidden = this.$hudHidden;
	}
}

//-------------------------------------------------------------------------------------------------------------
this.playerBoughtEquipment = function(equipment) {
	if (equipment === &quot;EQ_COMMSLOGMFD_REMOVAL&quot;) {
		var p = player.ship;
		p.removeEquipment(&quot;EQ_COMMSLOGMFD&quot;);
		p.removeEquipment(&quot;EQ_COMMSLOGMFD_REMOVAL&quot;);
	}
	if (equipment === &quot;EQ_COMMSLOGMFD_PASSIVE_REMOVAL&quot;) {
		var p = player.ship;
		p.removeEquipment(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;);
		p.removeEquipment(&quot;EQ_COMMSLOGMFD_PASSIVE_REMOVAL&quot;);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$initInterface = function(station) {
	station.setInterface(this.name,{
		title:&quot;Communications log&quot;,
		category:expandDescription(&quot;[interfaces-category-logs]&quot;),
		summary:&quot;Views all entries in the communications log&quot;,
		callback:this.$showCommLog.bind(this)
	});
}

//=============================================================================================================
// General functions

//-------------------------------------------------------------------------------------------------------------
// converts a single string to an array
this.$convertLogToArray = function(commLog) {
	this._commsMFD_lines = commLog.split(&quot;\n&quot;);
}

//-------------------------------------------------------------------------------------------------------------
// converts the comm log array to a single string
this.$convertArrayToString = function() {
	var log = &quot;&quot;;
	var nl = &quot;&quot;;
	for (var i = this._commsMFD_lines.length - 1; i &gt;= 0; i--) {
		// check for log file size limit
		if ((log + this._commsMFD_lines[i]).length &gt; this._logSize) {
			// remove the top message
			// look for &quot;\n[A-Z]&quot; (which should indicate the start of the second message in the log
			var re = new RegExp(&quot;\\n[A-Z]&quot;, &quot;i&quot;);
			var iSec = log.search(re);
			// cut out the first message
			log = log.substring(iSec + 1);
			break;
		}
		log = this._commsMFD_lines[i] + nl + log;
		nl = &quot;\n&quot;;
	}
	this._commsMFD_log = log;
}

//-------------------------------------------------------------------------------------------------------------
// custom handler for special comms messages (that don&#39;t get raised through &#39;commsMessageReceived&#39;)
this.$addCommsMessage = function(message, altSender) {
	var msg = &quot;&quot;;
	if (altSender &amp;&amp; altSender != &quot;&quot;) {
		msg = altSender + &quot;: &quot; + message;
	} else {
		msg = &quot;{unidentified source}: &quot; + message;
	}
	this.$appendMessage(msg);
}

//-------------------------------------------------------------------------------------------------------------
// worldscript handler for comms messages
this.commsMessageReceived = function(message, sender) {
	var msg = &quot;&quot;;
	if (sender) {
		msg = sender.displayName + &quot;: &quot; + message;
	} else {
		msg = &quot;{unidentified source}: &quot; + message;
	}
	this.$appendMessage(msg);
}

//-------------------------------------------------------------------------------------------------------------
// adds message to the comm log
this.$appendMessage = function(message) {
	if (this._debug === true) log(this.name, &quot;comms::&quot; + message);

	// add the message to the list
	this.$addMsgToArray(message, this._commsMFD_lines, this._lineLength);

	var p = player.ship;
	// only update MFD if the equipment is installed
	if(p.equipmentStatus(&quot;EQ_COMMSLOGMFD&quot;) === &quot;EQUIPMENT_OK&quot; || p.equipmentStatus(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;) === &quot;EQUIPMENT_OK&quot;) {
		this.$commsMFD_updateview();
	}	
}

//-------------------------------------------------------------------------------------------------------------
this.$reformatData = function(srcArray, destArray, lineWidth) {
	//rebuild comms into wide screen format
	var msg = &quot;&quot;;
	var output = &quot;&quot;;
	for (var i = 0; i &lt; srcArray.length; i++) {
		if (srcArray[i].substring(0,1) != &quot; &quot; &amp;&amp; msg != &quot;&quot;) {
			// this is a new message, so output the current one and reset
			//output = output + &quot;&gt; &quot; + msg + &quot;\n&quot;;
			this.$addMsgToArray(msg, destArray, lineWidth);
			msg = &quot;&quot;;
		}
		// add the message line to the current message
		// we&#39;ll trim off any leading and trailing spaces and add them back manually
		msg += srcArray[i].trim() + &quot; &quot;;
	}
	if (msg != &quot;&quot;) {
		// output the remaining message
		//output = output + &quot;&gt; &quot; + msg;
		this.$addMsgToArray(msg, destArray, lineWidth);
	}
}

//-------------------------------------------------------------------------------------------------------------
// displays a part of the comms log in the MFD
this.$commsMFD_updateview = function() {

	var p = player.ship;
	if (p.equipmentStatus(&quot;EQ_COMMSLOGMFD&quot;) === &quot;EQUIPMENT_OK&quot; || p.equipmentStatus(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;) === &quot;EQUIPMENT_OK&quot;) {

		var output = &quot;&quot;;
		var iStart = 0;
		var iEnd = 0;
		var iCount = 0;
		var iLast = 0;

		// if we have lines, work out what to display, based on the current scroll position
		if ((this._commsMFD_lines != null) &amp;&amp; (this._commsMFD_lines.length != 1 || this._commsMFD_lines[0] != &quot;&quot;)) {

			// determine the maximum amount of scroll
			this._commsMFD_maxscroll = this._commsMFD_lines.length - this._commsMFD_maxlines;

			// if the max scroll is less than 0, reset to 0
			if (this._commsMFD_maxscroll &lt; 0) this._commsMFD_maxscroll = 0;


			// work out the start and end points of the log to view
			// scroll line by line
			iEnd = this._commsMFD_lines.length;
			if (this._scrollMethod === 0) iEnd -= this._commsMFD_scroll;

			// scroll message by message
			if (this._scrollMethod === 1 &amp;&amp; this._commsMFD_scroll &gt; 0 &amp;&amp; this._scrollLaunch === 0) {
				this._holdscrollLaunch = 0;
				// cycle back through the lines, from the bottom up
				for (var i = iEnd - 1; i &gt;= 0; i--) {
					// look for a line that doesn&#39;t start with a space character
					if (this._commsMFD_lines[i].substring(0,1) != &quot; &quot;) {
						// when found, increment our message counter
						iCount += 1;
						// and make a note of the position of this message start
						iLast = i;
						// if our counter equals our scroll value, we&#39;re done
						if (iCount === this._commsMFD_scroll) {
							// set the end point to be the point we are in the loop
							iEnd = i;
							// jump out of the loop
							break;
						}
					}
					// this check is to, essentially, stop the last page of messages from being scrolled.
					// check if we&#39;re inside the last 9 lines of the log
					//   AND the log length is greater than 9 lines
					//   AND the position of the last message we found is greater than 0 (that is, we found one)
					if (i &lt; 9 &amp;&amp; this._commsMFD_lines.length &gt;= 9 &amp;&amp; iLast &gt; 0) {
						// don&#39;t scroll the last page of messages
						iEnd = 9;
						this._commsMFD_scroll = iCount;
						break;
					}
				}
			}
			// scroll launch by launch
			if (this._scrollLaunch != 0) {
				var newScroll = 0;
				var check = 0;
				// when the scroll method is by line and we&#39;re scrolling to the previous launch,
				// we need to pad out the current scroll amount otherwise we&#39;ll end up going to the same spot over and over
				var addln = 3;
				// however, going in the other direction we wont&#39; need this
				if (this._scrollLaunch === -1) addln = 0;

				for (var i = this._commsMFD_lines.length - 1; i &gt;= 0; i--) {
					// look for a line that doesn&#39;t start with a space character
					if (this._commsMFD_lines[i].substring(0,1) != &quot; &quot;) {
						// is this message a launch message?
						if ((this._commsMFD_lines[i].indexOf(&quot;: Launched in&quot;) &gt; 0) ||
							(this._commsMFD_lines[i].indexOf(&quot;: Launched&quot;) &gt; 0 &amp;&amp; this._commsMFD_lines[i + 1].indexOf(&quot; in&quot;) &gt; 0) ||
							(this._commsMFD_lines[i].indexOf(&quot;:&quot;) &gt; 0 &amp;&amp; this._commsMFD_lines[i + 1].indexOf(&quot; Launched in&quot;) &gt; 0)) {

							// only used for line-by-line scrolling
							check = this._commsMFD_lines.length - i;
							// if we scrolling to the next launch, and we&#39;ve passed the current scroll point, then we can break out of the loop
							// because we should now have the right values
							if (this._scrollLaunch === -1 &amp;&amp; ((this._scrollMethod === 1 &amp;&amp; iCount &gt; this._commsMFD_scroll) || (this._scrollMethod === 0 &amp;&amp; check &gt; this._commsMFD_scroll + addln))) {
								break;
							}

							// look for a launch, that is, before or after the current scroll position (depanding on the scroll direction)
							if ((this._scrollLaunch === 1 &amp;&amp; ((this._scrollMethod === 1 &amp;&amp; iCount &gt; this._commsMFD_scroll) || (this._scrollMethod === 0 &amp;&amp; check &gt; this._commsMFD_scroll + addln))) ||
								(this._scrollLaunch === -1 &amp;&amp; ((this._scrollMethod === 1 &amp;&amp; iCount &lt; this._commsMFD_scroll) || (this._scrollMethod === 0 &amp;&amp; check &lt; this._commsMFD_scroll + addln)))) {
								// we&#39;ve found it
								// we need to move forward 1 message so the full launch message is in the view
								iEnd = this._commsMFD_lines.length;
								for (var j = i + 1; j &lt; this._commsMFD_lines.length - 1; j++) {
									if (this._commsMFD_lines[j].substring(0,1) != &quot; &quot;) {
										// this is it
										iEnd = j;
										break;
									}
								}
								// set the new scroll value
								if (this._scrollMethod === 1) {
									newScroll = iCount;
								} else {
									newScroll = this._commsMFD_lines.length - iEnd;
								}
								// if we&#39;re scrolling to the previous launch we can break out now, because we have all the info we need
								if (this._scrollLaunch === 1) break;
							}
						}
						// when found, increment our message counter
						iCount += 1;
						// and make a note of the position of this message start
						iLast = i;
					}
					// this check is to, essentially, stop the last page of messages from being scrolled.
					// check if we&#39;re inside the last 9 lines of the log
					//   AND the log length is greater than 9 lines
					//   AND the position of the last message we found is greater than 0 (that is, we found one)
					if (this._scrollLaunch === 1 &amp;&amp; i &lt; 9 &amp;&amp; this._commsMFD_lines.length &gt;= 9 &amp;&amp; iLast &gt; 0) {
						// don&#39;t scroll the last page of messages
						iEnd = 9;
						newScroll = iCount - 1;
						// edge case, where the last message found is outside the 9 line limit, which would leave the first line of the message invisible
						if (iLast &gt;= 9) {
							iEnd = 9;
							if (this._scrollMethod === 1) {
								newScroll = iCount;
							} else {
								newScroll = this._commsMFD_lines.length - 9;
							}
						}
						break;
					}
				}
				this._commsMFD_scroll = newScroll;
			}

			// the start position is always 9 lines less than the end point
			iStart = iEnd - this._commsMFD_maxlines;
			// this condition should never happen, but just in case...
			// make sure our end point is inside the bounds of the array of lines
			if (iEnd &lt; 0) {
				iEnd = this._commsMFD_lines.length;
				this._commsMFD_scroll = 0;
			}
			// make sure our start point is inside the bounds of the array
			if (iStart &lt; 0) {
				iStart = 0;
			}

			// build the header
			output = &quot;COMMS LOG: &quot;;
			if (this._commsMFD_scroll != 0) {
				output = output + &quot;Scroll &quot; + this._commsMFD_scroll.toString() + &quot;\n&quot;;
			} else {
				output = output + &quot;\n&quot;;
			}

			// add the lines
			if (iEnd &gt; 0) {
				for (var i = iStart; i &lt; iEnd; i++) {
					output = output + this._commsMFD_lines[i] + &quot;\n&quot;;
				}
			} else {
				output = output + &quot;(empty)&quot;;
			}
		} else {
			output = &quot;COMMS LOG:\n(empty)&quot;;
		}

		// send output to MFD
		p.setMultiFunctionText(&quot;CommsLogMFD&quot;, output, false);
	}
}

//-------------------------------------------------------------------------------------------------------------
// output the comms to the latest log
this.$dumpLog = function() {
	var msg = &quot;&quot;;
	for (var i = 0; i &lt; this._commsMFD_lines.length; i++) {
		if (this._commsMFD_lines[i].substring(0,1) != &quot; &quot; &amp;&amp; msg != &quot;&quot;) {
			// this is a new message, so output the current one and reset
			log(this.name, msg);
			msg = &quot;&quot;;
		}
		// add the message line to the current message
		// we&#39;ll trim off any leading and trailing spaces and add them back manually
		// we&#39;ll also replace any instances of &quot;…&quot; with &quot;...&quot;
		msg += this._commsMFD_lines[i].trim().replace(&quot;…&quot;, &quot;...&quot;).replace(&quot;–&quot;, &quot;-&quot;) + &quot; &quot;;
	}
	if (msg != &quot;&quot;) {
		// output the remaining message
		log(this.name, msg);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$showCommLog = function $showCommLog() {

	this._syslines = [];
	this.$reformatData(this._commsMFD_lines, this._syslines, this._msCols);

	var p = player.ship;
	this._msRows = 18;
	// one less row if the comms log MFD is installed
	if (p.equipmentStatus(&quot;EQ_COMMSLOGMFD&quot;) === &quot;EQUIPMENT_OK&quot; || p.equipmentStatus(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;) === &quot;EQUIPMENT_OK&quot;) {
		this._msRows = 17;
	}

	this._maxpage = Math.ceil(this._syslines.length / this._msRows);
	this._curpage = 0;
	this.$showPage();
}

//-------------------------------------------------------------------------------------------------------------
// adds a message to an array, splitting the lines based on a line width
this.$addMsgToArray = function(msg, ary, linewidth) {

	var prt = &quot;&quot;;

	if (defaultFont.measureString(msg) &gt; linewidth) {
		var words = msg.split(&quot; &quot;);
		var iPoint = 0
		var nextWord = &quot;&quot;;
		do {
			// add the space in (after the first word)
			if (prt != &quot;&quot;) {
				prt += &quot; &quot;;
			}
			// add the word on
			prt = prt + words[iPoint];
			// get the next word in the array
			if (iPoint &lt; words.length - 1) {
				nextWord = &quot; &quot; + words[iPoint + 1];
			} else {
				nextWord = &quot;&quot;
			}
			// check the width of the next with the nextword added on
			if (defaultFont.measureString(prt + nextWord) &gt; linewidth) {
				// hit the max width - add the line and start again
				ary.push(prt);
				// subsequent lines of a message will be indented slightly
				prt = &quot; &quot;;
			}
			iPoint += 1;
			// check for the end of the array, and output remaining text
			if ((iPoint &gt;= words.length) &amp;&amp; (prt.trim() != &quot;&quot;)) {
				ary.push(prt);
			}
		} while (iPoint &lt; words.length);
		words = [];
	} else {
		ary.push(msg);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$commLogPage = function(cpage, lines) {
	var output = &quot;&quot;;

	var iStart = 0;
	var iEnd = 0;
	var textCount = 0;

	// set out initial end point
	iEnd = iStart + lines;
	if (cpage != 0) {
		iStart = cpage * lines;
		iEnd = iStart + lines;
	}
	if (iEnd &gt; this._syslines.length) iEnd = this._syslines.length;

	for (var i = iStart; i &lt; iEnd; i++) {
		textCount += this._syslines[i].trim().length;
		output += this._syslines[i] + &quot;\n&quot;;
	}

	if (cpage === 0 &amp;&amp; iStart === 0 &amp;&amp; iEnd === 0 &amp;&amp; (this._syslines[0] == null || textCount == 0)) output = &quot;(empty)&quot;;

	return output;
}

//-------------------------------------------------------------------------------------------------------------
this.$showPage = function $showPage() {
	var p = player.ship;

	this._hudHidden = p.hudHidden;
	if (this.$isBigGuiActive() === false) p.hudHidden = true;

	this._commsLogOpen = true;
	this._msRows = 18;
	// one less row if the comms log MFD is installed
	if (p.equipmentStatus(&quot;EQ_COMMSLOGMFD&quot;) === &quot;EQUIPMENT_OK&quot; || p.equipmentStatus(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;) === &quot;EQUIPMENT_OK&quot;) this._msRows = 17;

	var text = this.$commLogPage(this._curpage,this._msRows);
	var opts;
	var curChoices = {};
	var def = &quot;09_NEXT&quot;;

	if (this._maxpage &lt;= 1) {
		def = &quot;99_EXIT&quot;;
		curChoices[&quot;01_PREV&quot;] = {text:&quot;Previous page&quot;, color:&quot;darkGrayColor&quot;, unselectable:true};
		curChoices[&quot;09_NEXT&quot;] = {text:&quot;Next page&quot;, color:&quot;darkGrayColor&quot;, unselectable:true};
		curChoices[&quot;10_FIRST&quot;] = {text:&quot;First page&quot;, color:&quot;darkGrayColor&quot;, unselectable:true};
		curChoices[&quot;11_LAST&quot;] = {text:&quot;Last page&quot;,color:&quot;darkGrayColor&quot;, unselectable:true};
	} else {
		if (this._curpage === 0) {
			curChoices[&quot;01_PREV&quot;] = {text:&quot;Previous page&quot;, color:&quot;darkGrayColor&quot;, unselectable:true};
			curChoices[&quot;09_NEXT&quot;] = {text:&quot;Next page&quot;, color:this._menuColor};
			curChoices[&quot;10_FIRST&quot;] = {text:&quot;First page&quot;, color:&quot;darkGrayColor&quot;, unselectable:true};
			curChoices[&quot;11_LAST&quot;] = {text:&quot;Last page&quot;,color:&quot;orangeColor&quot;};
		} else {
			curChoices[&quot;01_PREV&quot;] = {text:&quot;Previous page&quot;, color:this._menuColor};
			if (this._curpage + 1 === this._maxpage) {
				def = &quot;01_PREV&quot;;
				curChoices[&quot;09_NEXT&quot;] = {text:&quot;Next page&quot;, color:&quot;darkGrayColor&quot;, unselectable:true};
				curChoices[&quot;10_FIRST&quot;] = {text:&quot;First page&quot;, color:this._menuColor};
				curChoices[&quot;11_LAST&quot;] = {text:&quot;Last page&quot;,color:&quot;darkGrayColor&quot;, unselectable:true};
			} else {
				curChoices[&quot;09_NEXT&quot;] = {text:&quot;Next page&quot;, color:this._menuColor};
				curChoices[&quot;10_FIRST&quot;] = {text:&quot;First page&quot;, color:this._menuColor};
				curChoices[&quot;11_LAST&quot;] = {text:&quot;Last page&quot;,color:this._menuColor};
			}
		}
	}

	if (text != &quot;(empty)&quot;) {
		curChoices[&quot;15_DUMPLOG&quot;] = {text:&quot;Write comms to latest log&quot;,color:this._menuColor};
		curChoices[&quot;20_CLEARLOG&quot;] = {text:&quot;Clear the log&quot;, color:this._menuColor};
	} else {
		curChoices[&quot;15_DUMPLOG&quot;] = {text:&quot;Write comms to latest log&quot;,color:&quot;darkGrayColor&quot;, unselectable:true};
		curChoices[&quot;20_CLEARLOG&quot;] = {text:&quot;Clear the log&quot;, color:&quot;darkGrayColor&quot;, unselectable:true};
	}
	curChoices[&quot;30_SETLOGSIZE&quot;] = {text:&quot;Set log size&quot;, color:this._menuColor};
	if (p.equipmentStatus(&quot;EQ_COMMSLOGMFD&quot;) === &quot;EQUIPMENT_OK&quot;) {
		curChoices[&quot;80_TYPE1&quot;] = {text:&quot;MFD currently in Active Mode&quot;, color:this._menuColor};
	}
	if (p.equipmentStatus(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;) === &quot;EQUIPMENT_OK&quot;) {
		curChoices[&quot;80_TYPE2&quot;] = {text:&quot;MFD currently in Passive Mode&quot;, color:this._menuColor};
	}
	curChoices[&quot;99_EXIT&quot;] = {text:&quot;Exit communications log&quot;, color:this._exitColor};

	var opts = {
		screenID: &quot;oolite-communicationslog-main-map&quot;,
		title: &quot;Communications log&quot; + (this._maxpage == 0 ? &quot;&quot; : &quot; - page &quot; + (this._curpage + 1).toString() + &quot; of &quot; + this._maxpage.toString()),
		allowInterrupt: true,
		choices: curChoices,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
		overlay: {name:&quot;commlog-radar.png&quot;, height:546},
		initialChoicesKey: this._lastchoice?this._lastchoice:def,
		message: text
	};
	mission.runScreen(opts,this.$logHandler.bind(this));
}

//-------------------------------------------------------------------------------------------------------------
this.$logHandler = function $logHandler(choice) {
	delete this._lastchoice;

	var newChoice = null;

	if (!choice) {
		if (this._debug) log(this.name, &quot;no choice&quot;);
		return; // launched while reading?
	} else if (choice === &quot;01_PREV&quot;) {
		if (this._curpage &gt; 0) this._curpage -= 1;
	} else if (choice === &quot;09_NEXT&quot;) {
		if (this._curpage &lt; this._maxpage - 1) this._curpage += 1;
	} else if (choice === &quot;10_FIRST&quot;) {
		this._curpage = 0;
	} else if (choice === &quot;11_LAST&quot;) {
		this._curpage = this._maxpage - 1;
	} else if (choice === &quot;15_DUMPLOG&quot;) {
		this.$dumpLog();
	} else if (choice === &quot;20_CLEARLOG&quot;) {
		this._scrollLaunch = 0;
		this._commsMFD_log = &quot;&quot;;
		this._commsMFD_lines = [];
		this._syslines = [];
		this._maxpage = 1;
		this._curpage = 0;
	} else if (choice === &quot;30_SETLOGSIZE&quot;) {
		this.$setLogSize();
	} else if (choice === &quot;80_TYPE1&quot;) {
		this.$changeMFDType(&quot;TYPE2&quot;);
		newChoice = &quot;80_TYPE2&quot;;
	} else if (choice === &quot;80_TYPE2&quot;) {
		this.$changeMFDType(&quot;TYPE1&quot;);
		newChoice = &quot;80_TYPE1&quot;;
	}
	this._lastchoice = choice;
	if (newChoice) this._lastchoice = newChoice;

	if (choice != &quot;99_EXIT&quot; &amp;&amp; choice != &quot;30_SETLOGSIZE&quot;) {
		this.$showPage();
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$changeMFDType = function(mfdType) {
	var p = player.ship;
	switch (mfdType) {
		case &quot;TYPE2&quot;:
			if (p.equipmentStatus(&quot;EQ_COMMSLOGMFD&quot;) != &quot;EQUIPMENT_OK&quot;) return;
			if (p.equipmentStatus(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;) === &quot;EQUIPMENT_OK&quot;) return;
			p.removeEquipment(&quot;EQ_COMMSLOGMFD&quot;);
			p.awardEquipment(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;);
			break;
		case &quot;TYPE1&quot;:
			if (p.equipmentStatus(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;) != &quot;EQUIPMENT_OK&quot;) return;
			if (p.equipmentStatus(&quot;EQ_COMMSLOGMFD&quot;) === &quot;EQUIPMENT_OK&quot;) return;
			p.removeEquipment(&quot;EQ_COMMSLOGMFD_PASSIVE&quot;);
			p.awardEquipment(&quot;EQ_COMMSLOGMFD&quot;);
			break;
	}
}

//-------------------------------------------------------------------------------------------------------------
// prompts the user for a new log file size
this.$setLogSize = function() {

	var text = &quot;Enter the desired size of the log file, in kilobytes. This must be a whole number (no decimals) between 1 and 32.\n\n&quot; +
		&quot;The current setting is &quot; + parseInt(this._logSize / 1000) + &quot;k.\n\n&quot; +
		&quot;Press enter to leave this value unchanged.\n\n&quot; +
		&quot;Changes to the log size will be reflected the next time the log file is opened, or when your ship next launches.&quot;;

	var opts = {
		screenID: &quot;oolite-communicationslog-logsize-map&quot;,
		title: &quot;Set Log File Size&quot;,
		allowInterrupt: false,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
		overlay: {name:&quot;commlog-radar.png&quot;, height:546},
		message: text,
		textEntry: true
	};
	mission.runScreen(opts,this.$getNewLogSize, this);
}

//-------------------------------------------------------------------------------------------------------------
// parses the input from the setLogSize screen
this.$getNewLogSize = function(param) {
	if (parseInt(param) &gt;= 1 &amp;&amp; parseInt(param) &lt;= 32) {
		this._logSize = parseInt(param) * 1000;
		this.$convertArrayToString()
		this.$convertLogToArray(this._commsMFD_log);
	}
	this.$showPage();
}

//-------------------------------------------------------------------------------------------------------------
// returns true if a HUD with allowBigGUI is enabled, otherwise false
this.$isBigGuiActive = function() {
	if (oolite.compareVersion(&quot;1.83&quot;) &lt;= 0) {
		return player.ship.hudAllowsBigGui;
	} else {
		var bigGuiHUD = [&quot;XenonHUD.plist&quot;, &quot;coluber_hud_ch01-dock.plist&quot;]; 	// until there is a property we can check, I&#39;ll be listing HUD&#39;s that have the allow_big_gui property set here
		if (bigGuiHUD.indexOf(player.ship.hud) &gt;= 0) {
			return true;
		} else {
			return false;
		}
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/commslog_scroller.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;CommsLogMFD_Equipment&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2016 phkb&quot;;
this.description = &quot;Allows the communications log multi-function display to be scrolled and cleared.&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;

//-------------------------------------------------------------------------------------------------------------
this.activated = function () {
	var w = worldScripts.CommsLogMFD;
	if (w._currMode == null) {
		w._currMode = 0;
	}
	w._nextMode = -1;
	var bResetTimer = false;
	var p = player;
	switch(w._currMode) {
		case 0:
			// scroll further into history (increase the amount of scroll)
			w._scrollLaunch = 0;
			if (w._commsMFD_scroll &lt; w._commsMFD_maxscroll) {
				w._commsMFD_scroll += 1;
				w.$commsMFD_updateview();
				bResetTimer = true;
			}
			break;
		case 1:
			// scroll back towards current (reduce the amount of scroll)
			w._scrollLaunch = 0;
			if (w._commsMFD_scroll &gt; 0) {
				w._commsMFD_scroll -= 1;
				// set the next mode to be mode 0, so we can quickly go back and forwards between messages
				this._nextMode = 0;
				w.$commsMFD_updateview();
				if (w._commsMFD_scroll != 0) {
					bResetTimer = true;
				}
			}
			break;
		case 2:
			// scroll back to previous launch
			w._scrollLaunch = 1;
			w.$commsMFD_updateview();
			bResetTimer = true;
			break;
		case 3:
			// scroll to next launch
			w._scrollLaunch = -1;
			// set the next mode to be mode 2, so we can quickly go back and forwards between launches
			w._nextMode = 2;
			w.$commsMFD_updateview();
			bResetTimer = true;
			break;
		case 4:
			// view current
			w._commsMFD_scroll = 0;
			w._scrollLaunch = 0;
			w.$commsMFD_updateview();
			w._currMode = 0;
			this.$stoptimer();
			p.consoleMessage(&quot;Scroll back mode autoselected&quot;);
			break;
		case 5:
			// view oldest
			w._scrollLaunch = 0;
			w._commsMFD_scroll = w._commsMFD_maxscroll;
			w.$commsMFD_updateview();
			w._currMode = 1;
			p.consoleMessage(&quot;Scroll forward mode autoselected&quot;);
			bResetTimer = true;
			break;
		case 6:
		    // clear log
			w._scrollLaunch = 0;
			w._commsMFD_log = &quot;&quot;;
			w._commsMFD_lines = [];
			w._commsMFD_scroll = 0;
			w.$commsMFD_updateview();
			w._currMode = 0;
			this.$stoptimer();
			p.consoleMessage(&quot;Log cleared&quot;);
			break;
		case 7:
			// write comms to log
			w.$dumpLog();
			p.consoleMessage(&quot;Output of comms to log complete&quot;);
			w._currMode = 0;
			this.$stoptimer();
			p.consoleMessage(&quot;Scroll back mode autoselected&quot;);
			break;
		case 8:
			if (w._scrollMethod === 0) {
				p.consoleMessage(&quot;Scroll mode = By message&quot;);
				w._scrollMethod = 1;
			} else {
				p.consoleMessage(&quot;Scroll mode = By line&quot;);
				w._scrollMethod = 0;
			}
			w._currMode = 0;
			w._scrollLaunch = 0;
			w._commsMFD_scroll = 0;
			w.$commsMFD_updateview();
			this.$stoptimer();
			break;
	}
	if (bResetTimer === true) this.$resettimer();
	this.$playSound(&quot;activate&quot;);
}

//-------------------------------------------------------------------------------------------------------------
this.$stoptimer = function() {
	if (this._timeout &amp;&amp; this._timeout.isRunning) this._timeout.stop();
}

//-------------------------------------------------------------------------------------------------------------
this.mode = function () {
	var w = worldScripts.CommsLogMFD;
	// change the mode
	// if the nextMode value has been set, make this the next mode
	if (w._nextMode != null &amp;&amp; w._nextMode != -1) {
		w._currMode = w._nextMode;
		w._nextMode = -1;
	} else {
		// if the value hasn&#39;t been set yet, start at default mode (0)
		if (w._currMode == null) {
			w._currMode = 0;
		} else {
			// otherwise, increment the mode
			w._currMode += 1;
			// once we get to 9, switch back to 0
			if (w._currMode === 9) {
				w._currMode = 0;
			}
		}
	}

	var p = player;

	// display a console message about which mode we&#39;re in now
	switch(w._currMode) {
		case 0:
			p.consoleMessage(&quot;Scroll back mode&quot;);
			break;
		case 1:
			p.consoleMessage(&quot;Scroll forward mode&quot;);
			break;
		case 2:
			p.consoleMessage(&quot;Scroll to previous launch&quot;);
			break;
		case 3:
			p.consoleMessage(&quot;Scroll to next launch&quot;);
			break;
		case 4:
			p.consoleMessage(&quot;View current&quot;);
			break;
		case 5:
			p.consoleMessage(&quot;View oldest&quot;);
			break;
		case 6:
			p.consoleMessage(&quot;Clear log mode&quot;);
			break;
		case 7:
			p.consoleMessage(&quot;Write comms to lastest log&quot;);
			break;
		case 8:
			if (worldScripts.CommsLogMFD._scrollMethod === 0) {
				p.consoleMessage(&quot;Switch to message scrolling&quot;);
			} else {
				p.consoleMessage(&quot;Switch to line scrolling&quot;);
			}
	}
	this.$playSound(&quot;mode&quot;);
}

//-------------------------------------------------------------------------------------------------------------
this.$resettimer = function() {
	this.$stoptimer();
	this._timeout = new Timer(this, this.$timerdone, worldScripts.CommsLogMFD._scrollTimeout, 0);
}

//-------------------------------------------------------------------------------------------------------------
this.$timerdone = function $timerdone() {
	var w = worldScripts.CommsLogMFD;
	w._currMode = 0;
	w._commsMFD_scroll = 0;
	w._scrollLaunch = 0;
	w.$commsMFD_updateview();
}

//-------------------------------------------------------------------------------------------------------------
// play sound effects
this.$playSound = function(soundtype) {
	var mySound = new SoundSource;

	switch (soundtype) {
		case &quot;mode&quot;:
			mySound.sound = &quot;[@click]&quot;;
			break;
		case &quot;activate&quot;:
			mySound.sound = &quot;[@beep]&quot;;
			break;
			
	}
	mySound.loop = false;
	mySound.play();
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
