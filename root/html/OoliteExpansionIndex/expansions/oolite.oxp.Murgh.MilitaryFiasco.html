<html>
    <head>
        <title>Expansion Military Fiasco</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Military Fiasco</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">24 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">5 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>License not specified</li>
                <li>XML script list found</li>
                <li>XML Manifest found</li>
                <li>Unknown key &#39;licence&#39; in XML manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Equips the Galactic Navy with the powerful Leviathan Cruiser, supported by the Military Wolf Mark II, the Basilisk, the Hydra and the Rattle Cutter. These ships are occasionally seen in the space lanes, but are more often encountered in Witch Space fighting the Thargoid menace. Also adds a mission that can start in any galaxy.</td>
                    <td>Equips the Galactic Navy with the powerful Leviathan Cruiser, supported by the Military Wolf Mark II, the Basilisk, the Hydra and the Rattle Cutter. These ships are occasionally seen in the space lanes, but are more often encountered in Witch Space fighting the Thargoid menace. Also adds a mission that can start in any galaxy.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Murgh.MilitaryFiasco</td>
                    <td>oolite.oxp.Murgh.MilitaryFiasco</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Military Fiasco</td>
                    <td>Military Fiasco</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Missions</td>
                    <td>Missions</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Murgh</td>
                    <td>Murgh</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.5.3</td>
                    <td>2.5.3</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Military_Fiasco">http://wiki.alioth.net/index.php/Military_Fiasco</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/d/db/MilitaryFiasco_2.5.3.oxz">https://wiki.alioth.net/img_auth.php/d/db/MilitaryFiasco_2.5.3.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873485</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Military%20Fiasco'>http://wiki.alioth.net/index.php/Military%20Fiasco</a></p>
        <h3>Military Fiasco readme.rtf</h3>
        <pre>{\rtf1\ansi\ansicpg1252\cocoartf1038\cocoasubrtf360
{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
\paperw11900\paperh16840\margl1440\margr1440\vieww23640\viewh16560\viewkind0
\pard\tx586\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ql\qnatural\pardirnatural

\f0\b\fs48 \cf0 Military Fiasco
\b0\fs24 \
Version 2.5.3 Written by Murgh.\
\
The Military Fiasco OXP equips the Galactic Navy with the powerful Leviathan Cruiser, supported by the Military Wolf Mark II, the Basilisk, the Hydra and the Rattle Cutter. These ships are occasionally seen in the space lanes, but are more often encountered in Witch Space fighting the Thargoid menace.\
A mission is also added. Wouldn\&#39;92t you know it, those careless chaps at the Military have lost the secret plans to these gruesome battleships, allowing a clan of pirates to mass-produce them. Guess who they will contact for assistance!\
\
Minimum version Oolite 1.74\
\pard\tx586\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\li180\fi-180\ql\qnatural\pardirnatural
\cf0 -----\
\
version 2.5.3\
- Added fix to prevent update missions to be shown before mission start.\
\
version 2.5.2\
- Added compatibility for future 1.75.\
\
version 2.5\
- Added the new mission screen concept .\
- Raised minimum Oolite version to 1.74\
\
Version 2.4.4\
- Added a incompatibility code for future Oolite 1.74 (Needs new code than)\
\
Version 2.4.3\
- Removed a bug that only affected Oolite 1.65: The initial briefing stopped halfway.\
\
Version 2.4.2\
- Adapted for Oolite 1.72 and 1.73.\
- Added better cloaking detection.\
- When a laser is shot of and it stays intact, it can be scooped now.\
- Pirates are now likely to jump to the next system when all subentities with lasers are shot of and their energy is low.\
\
Version 2.4.1\
- Removed a bug introduced in version 2.4 with the carrier escorts.\
\
Version 2.4\
- Subentities now sometimes fall off in one piece before they explode.\
\
Version 2.3 Additions by Eric Walch:\
- Adapted to Oolite 1.71 Runs now only on Oolite versions until 1.65 and on the current test version 1.71.2+ It does not work with the Oolite test versions 1.68 till 1.71.1 although some of the pirate ships will be there when played on those versions.\
- Removed a bug that made most defence ships of the stolen Leviathan crashing into the carrier on launch. To keep the game in balance I lowered the number of maximum defenders to the value of the plain Leviathan. Changed Leviathan and defence ship AI so they still keep monitoring for an approaching player during docking procedure of the defenders. (only the AI used on the restart of the mission. The first time the mission run they keeps using the original AI.)\
\
Version 2.2.3\
- There is a bug in the oolite 1.70 command that placed one of the targets at the wrong location. This command is replaced by an other placement command so it will also work on the current oolite version.\
\
Version 2.2.2\
- The Java version had an other spelled name than the legacy spelled name. (military-fiasco &amp; military-Fiasco) This resulted in that they did not see each others mission text when switching versions during a mission. Although the missions runs fine, the briefing on the F5 screen is missing. This one now has the right name. (all lowercase) However, when already accepted a mission with version 2.2.0 or 2.2.1 that briefing will miss in this version.\
\
Version 2.2.1\
- Removed a typo the prevented the new progress screen to appear.\
\
Version 2.2  Additions by Eric Walch:\
- Translated the script into JavaScript. On Oolite 1.65 or older the old scripting will be used. On version 1.70 and newer the JS scripting will be used. It will not run on the intermediate test versions 1.68 or 1.69 because they use an to incomplete implementation of the JS commands.\
- Added a progress message that pop&#39;s up occasionally to confirm to the player that the script is still doing something.\
- With the JavaScript version, the mission will restart sometimes after completion. You will have the choice to accept or reject the restart of the mission.\
\
Version 2.1  Additions by Eric Walch:\
- The version of Murgh was not compatible with other mission OXP&#39;s running simultaniously. Now added code for compatibility with other mission offering OXP&#39;s. So called MOP code (Mission Offering Protection).\
- Changed the program structure slightly so that is uses less processor time. The game itself is in no way altered. Specially after finishing the game it still kept checking all possible game conditions and thereby consuming useless time. Will now use a minimum of time when finished but should stay in place when one still wants to see all the nice new ships to randomly appear. \
- Removed a bug that made it impossible to restart the game after a delay.\
- Gave leviathan escorts a separate entry in shipdata.plist with its own AI file and added code to make that they always get role &quot;escort&quot;. (needed to fix a bug in Oolite itself that was present until at least the current version 1.70). Gave one ship a higher max_flight_speed to be able to follow the mother.\
- Changed intelligence code of the leviathan defenders so they do a 5 seconds speed burst after launching. In the old situation they regularly were hit by the mother when launching at full speed.\
- Changed intelligence code of the military leviathan. Main noticeable difference is that he will move around obstacles instead of just flying through it. This is standard practice for current Oolite internal ships.\
- Renamed several &quot;military&quot; AI.plist references into &quot;militaryFiasco&quot; AI.plist references to avoid potential name conflicts with other OXP&#39;s.\
The game play itself is in no way altered. I didn&#39;t change the intelligence of the target ships. It is just as easy or difficult as it was before.\
Renamed version to &quot;Military Fiasco 2.1&quot;\
\
Version 2.0  Original version by Murgh\
\
Link to wiki page: http://wiki.alioth.net/index.php/Military_Fiasco}</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/basilisk.html">Basilisk</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/basilisk-defender.html">basilisk-defender</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/basiltooth.html">Basilisk Laser Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hydra1.html">Hydra</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hydra1-defender.html">hydra1-defender</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hydra2.html">Hydra 2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hydra2-defender.html">hydra2-defender</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hydraspike.html">Hydra Laser Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/leviathan.html">Leviathan</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/leviathan-pirate.html">leviathan-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/levibridge.html">Leviathan Bridge</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mil-ballturret.html">mil-ballturret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mil-basilisk.html">Military Basilisk</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mil-basiltooth.html">Basilisk Laser Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mil-hydra1.html">Military Hydra</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mil-hydra2.html">Military Hydra 2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mil-hydraspike.html">Hydra Laser Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mil-rattle.html">Military Rattle Cutter</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mil-rattlefang.html">Rattle Laser Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mil-wolfmk2.html">Wolf Mark II Paragon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mil-wolftooth.html">Wolf Laser Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rattle.html">Rattle Cutter</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rattle-defender.html">rattle-defender</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rattlefang.html">Rattle Laser Mount</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/leviathanFighter.js</td>
                    <td><pre>this.name      = &quot;leviathanFighter&quot;; 
this.author    = &quot;eric walch&quot;; 
this.copyright = &quot;� 2008 the Oolite team.&quot;;
this.description = &quot;ship script for the military defenders &amp; escorts&quot;;
this.version   = &quot;1.03&quot;;

this.shipLaunchedFromStation = function (station)
{
    this.ship.switchAI(&quot;militaryFiascoInterceptAI.plist&quot;);
    
    // sometimes the target is already destroyd on launch. AI alone can&#39;t handle this.
    if(!this.ship.target) this.ship.reactToAIMessage(&quot;TARGET_LOST&quot;);
    
    
    if (station.speed &gt; 0 &amp;&amp; this.ship.equipmentStatus(&quot;EQ_FUEL_INJECTION&quot;) != &quot;EQUIPMENT_OK&quot;)
    {
        this.ship.awardEquipment(&quot;EQ_FUEL_INJECTION&quot;); // allow for a fast launch!
    }
    if (this.ship.fuel &lt; 5) this.ship.fuel = 5;
}

this.shipBeingAttacked = function (attacker)
{
	// correcting friendly fire
	if (attacker &amp;&amp; attacker.isShip &amp;&amp; this.ship.group &amp;&amp; attacker.group == this.ship.group)
	{
		if (this.ship.bounty) this.ship.bounty = 0;
		if (attacker.bounty) attacker.bounty = 0;
		if (attacker.target == this.ship)
		{
			attacker.target = null;
			attacker.reactToAIMessage(&quot;LOST_TARGET&quot;);
		}
	}
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/militaryFiasco.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;military_fiasco&quot;; 
this.author      = &quot;Written by Murgh&quot;; 
this.copyright   = &quot;� 2008 the Oolite team.&quot;; 
this.description = &quot;Translation into JS by Eric Walch&quot;; 
this.version     = &quot;2.5.3&quot;; 

this.startUp = function ()
{
	 if (!missionVariables.military_fiasco)  missionVariables.military_fiasco = &quot;MIL_START&quot;;
	 if (!missionVariables.military_fiasco_progresscount) missionVariables.military_fiasco_progresscount = 0;
	 if (!missionVariables.military_fiasco_killcount) missionVariables.military_fiasco_killcount = 0;
}

this.missionScreenOpportunity = function ()
{
    if (player.ship.docked) 
    {
        this.missionOffers();
    }
}

this.missionOffers = function ()
{
	var fiascoStatus = missionVariables.military_fiasco;
	if (fiascoStatus === &quot;MIL_COMPLETE&quot; || fiascoStatus === &quot;MIL_DELAY&quot; || fiascoStatus === &quot;MIL_NEVER&quot;) return;
    if (player.ship.dockedStation.isMainStation)
    {
        if ((fiascoStatus === &quot;MIL_START&quot; || fiascoStatus === &quot;MIL_RESTART&quot;))
        {
            if (player.score &gt; 1000 &amp;&amp; player.bounty &lt; 5)
            {
                missionVariables.military_fiasco_old_killcount = missionVariables.military_fiasco_killcount;
                mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_intro&quot;, 
                                    choicesKey: &quot;military_fiasco_offer1_yesnonever&quot;, music: &quot;military_fiasco_theme.ogg&quot;},
                                    this.choiceEvaluation);
                this.offer = &quot;military_fiasco_first&quot;;
                missionVariables.military_fiasco_progresscount = 0;
            }
            return;
        }
		var killCount = missionVariables.military_fiasco_killcount - missionVariables.military_fiasco_old_killcount;
        if (fiascoStatus === &quot;MIL_ACTIVE&quot; &amp;&amp; killCount &gt; 0)
        {
			mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_disp1&quot;,
                                overlay: &quot;military_star.png&quot;, choicesKey: &quot;military_fiasco_disp1_yesno&quot;,
                                music: &quot;military_fiasco_teaser.ogg&quot;}, this.choiceEvaluation);
			this.offer = &quot;military_fiasco_second&quot;;
			missionVariables.military_fiasco_progresscount = 0;
        }
        if (fiascoStatus === &quot;MIL_STAGE1&quot; &amp;&amp; killCount &gt; 8)
        {
			mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_disp1&quot;,
                                overlay: &quot;military_star.png&quot;, choicesKey: &quot;military_fiasco_disp2_yesno&quot;,
                                music: &quot;military_fiasco_teaser.ogg&quot;}, this.choiceEvaluation);
			this.offer = &quot;military_fiasco_third&quot;;
			missionVariables.military_fiasco_progresscount = 0;
        }
        if (fiascoStatus === &quot;MIL_STAGE2&quot; &amp;&amp; killCount &gt; 19)
        {
			mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_disp1&quot;, 
                                overlay: &quot;military_star.png&quot;, choicesKey: &quot;military_fiasco_disp3_yesno&quot;,
                                music: &quot;military_fiasco_teaser.ogg&quot;}, this.choiceEvaluation);
			this.offer = &quot;military_fiasco_fourth&quot;;
			missionVariables.military_fiasco_progresscount = 0;
        }
        if (fiascoStatus === &quot;MIL_LEVI_DESTROYED&quot;)
        {
            mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_disp1&quot;, 
                                overlay: &quot;military_star.png&quot;, choicesKey: &quot;military_fiasco_disp4_justyes&quot;,
                                music: &quot;military_fiasco_theme.ogg&quot;}, this.choiceEvaluation);
            this.offer = &quot;military_fiasco_fifth&quot;;
            missionVariables.military_fiasco_progresscount = 0;
        }
        if (missionVariables.military_fiasco_progresscount &gt; 4)
        {
            mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_progress&quot;,
                                overlay: &quot;military_star.png&quot;, music: &quot;military_fiasco_teaser.ogg&quot;});
            missionVariables.military_fiasco_progresscount = 0;
        }
    }
}

this.choiceEvaluation = function (choice)
{
    if (!player.ship.docked) return;
    if (choice === &quot;YesFiasco&quot;)
    {
        switch (this.offer)
        {
        case &quot;military_fiasco_first&quot;:
            {
                player.credits -= 5;
                if(missionVariables.military_fiasco == &quot;MIL_START&quot;)
                    mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_brief1a&quot;,
                                        overlay: &quot;military_star.png&quot;, choicesKey: &quot;military_fiasco_cont1_yesno&quot;,
                                        model: &quot;mil-rattle&quot;}, this.choiceEvaluation)
                else 
                    mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_brief1aBis&quot;,
                                        overlay: &quot;military_star.png&quot;, choicesKey: &quot;military_fiasco_cont1_yesno&quot;, 
                                        model: &quot;mil-rattle&quot;}, this.choiceEvaluation);
                this.offer = &quot;military_fiasco_first2&quot;;
                break;
            }
        case &quot;military_fiasco_first2&quot;:
            {
                mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_brief1b&quot;,
                                    overlay: &quot;military_star.png&quot;, choicesKey: &quot;military_fiasco_cont1_yesno&quot;, 
                                    model: &quot;mil-basilisk&quot;}, this.choiceEvaluation);
                this.offer = &quot;military_fiasco_first3&quot;;
                break;
            }
        case &quot;military_fiasco_first3&quot;:
            {
                mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_brief1c&quot;,
                                    overlay: &quot;military_star.png&quot;, choicesKey: &quot;military_fiasco_cont1_yesno&quot;, 
                                    model: &quot;mil-hydra1&quot;}, this.choiceEvaluation);
                this.offer = &quot;military_fiasco_first4&quot;;
                break;
            }
        case &quot;military_fiasco_first4&quot;:
            {
                mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_brief1d&quot;, overlay: &quot;military_star.png&quot;});
                player.credits += 100;
                mission.setInstructionsKey(&quot;mission_military_desc1&quot;);
                missionVariables.military_fiasco = &quot;MIL_ACTIVE&quot;;
                this.offer = null;
                break;
            }
        case &quot;military_fiasco_second&quot;:
            {
                mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_message1&quot;, overlay: &quot;military_star.png&quot;});
                mission.setInstructionsKey(&quot;mission_military_desc1&quot;);
                missionVariables.military_fiasco = &quot;MIL_STAGE1&quot;;
                this.offer = null;
                break;
            }
        case &quot;military_fiasco_third&quot;:
            {
                mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_message2&quot;, overlay: &quot;military_star.png&quot;});
                mission.setInstructionsKey(&quot;mission_military_desc1&quot;);
                missionVariables.military_fiasco = &quot;MIL_STAGE2&quot;;
                this.offer = null;
                break;
            }
        case &quot;military_fiasco_fourth&quot;:
            {
                mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_message3&quot;, overlay: &quot;military_star.png&quot;});
                mission.setInstructionsKey(&quot;mission_military_desc2&quot;);
                missionVariables.military_fiasco = &quot;MIL_STAGE3&quot;;
                missionVariables.military_fiasco_helpers = Math.round(missionVariables.military_fiasco_killcount/100) + 3;
                this.offer = null;
                break;
            }
        case &quot;military_fiasco_fifth&quot;:
            {
                mission.runScreen({title: &quot;Military Fiasco&quot;, messageKey: &quot;military_fiasco_debrief&quot;, overlay: &quot;military_star.png&quot;});
                mission.setInstructionsKey(null);
                missionVariables.military_fiasco = &quot;MIL_COMPLETE&quot;;
                missionVariables.military_fiasco_old_killcount = null;
				missionVariables.military_fiasco_helpers = null;
                player.ship.manifest[&quot;gold&quot;] += 100;
                this.offer = null;
                break;
            }
        default:
                break;
        };
    }
    if (choice === &quot;NoFiasco&quot;)
    {
        missionVariables.military_fiasco_delay = missionVariables.military_fiasco;
        missionVariables.military_fiasco = &quot;MIL_DELAY&quot;;
        mission.setInstructionsKey(&quot;mission_military_desc3&quot;);
        this.offer = null;
    }
    if (choice === &quot;NeverFiasco&quot;)
    {
        missionVariables.military_fiasco = &quot;MIL_NEVER&quot;;
        missionVariables.military_fiasco_old_killcount = null;
        this.offer = null;
    }
}

this.shipExitedWitchspace = function ()
{
    if (system.isInterstellarSpace)
	{
		if (Math.random() &lt; 0.10) this.leviathan = new Timer(this, this.addCarrier, Math.random()*23.5+1.5);
		return;
	}
	// Scanning for offenders does nothing in anarchies and only little in low gevernments. So don&#39;t add the real military vessel there.
	// keep those governments dangerous
	switch (missionVariables.military_fiasco)
	{
	case &quot;MIL_ACTIVE&quot;:
		{
			if (Math.random() &lt; 0.17) system.addShipsToRoute(&quot;smship&quot;, 1, 0.2+Math.random()*0.5);
			if (Math.random() &lt; 0.06 &amp;&amp; system.government &gt; Math.random()*3) this.leviathan = new Timer(this, this.addCarrier, Math.random()*8+0.5);
			break;
		}
	case &quot;MIL_STAGE1&quot;:
		{
			if (Math.random() &lt; 0.26) system.addShipsToRoute(&quot;smship&quot;, 2, 0.3+Math.random()*0.5);
			if (Math.random() &lt; 0.11 &amp;&amp; system.government &gt; Math.random()*3) this.leviathan = new Timer(this, this.addCarrier, Math.random()*8+0.5);
			break;
		}
	case &quot;MIL_STAGE2&quot;:
		{
			if (Math.random() &lt; 0.33) system.addShipsToRoute(&quot;smship&quot;, 3, 0.3+Math.random()*0.5);
			if (Math.random() &lt; 0.11 &amp;&amp; system.government &gt; Math.random()*3) this.leviathan = new Timer(this, this.addCarrier, Math.random()*8+0.5);
			break;
		}
	case &quot;MIL_STAGE3&quot;:
		{
			if (Math.random() &lt; 0.21) 
			{
				var sunVector = system.sun.position.direction().multiply(30E3);
                var mom = system.addShips(&quot;leviathan-pirate&quot;, 1, sunVector, 5000)[0];
				var helpers = missionVariables.military_fiasco_helpers;
				if (helpers &lt; 1) helpers = 1;
				var smships = system.addShips(&quot;smship&quot;, helpers, mom.position, 8000);
				for (var i=0; i&lt;smships.length;i++)
					if (smships[i].isValid) //could already have been destroyed
					{
						smships[i].script.isHelper = true;
						smships[i].script.mom = mom;
					}
			}
			if (Math.random() &lt; 0.11 &amp;&amp; system.government &gt; Math.random()*3) this.leviathan = new Timer(this, this.addCarrier, Math.random()*8+0.5);
			break;
		}
	case &quot;MIL_DELAY&quot;:
		{
			if (Math.random() &lt; 0.02 &amp;&amp; missionVariables.military_fiasco_progresscount &gt; 1) 
			{
				if (missionVariables.military_fiasco_delay) missionVariables.military_fiasco = missionVariables.military_fiasco_delay
				else missionVariables.military_fiasco = &quot;MIL_START&quot;;
				missionVariables.military_fiasco_delay = null;
			}
			if (Math.random() &lt; 0.06 &amp;&amp; system.government &gt; Math.random()*3) this.leviathan = new Timer(this, this.addCarrier, Math.random()*8+0.5);
			break;
		}
	case &quot;MIL_NEVER&quot;:
		{
			if (Math.random() &lt; 0.001 &amp;&amp; missionVariables.military_fiasco_progresscount &gt; 25) missionVariables.military_fiasco = &quot;MIL_START&quot;;
			if (Math.random() &lt; 0.035 &amp;&amp; system.government &gt; Math.random()*3) this.leviathan = new Timer(this, this.addCarrier, Math.random()*8+0.5);
			break;
		}
	case &quot;MIL_COMPLETE&quot;:
		{
			if (Math.random() &lt; 0.001 &amp;&amp; missionVariables.military_fiasco_progresscount &gt; 10) missionVariables.military_fiasco = &quot;MIL_RESTART&quot;;
			if (Math.random() &lt; 0.035 &amp;&amp; system.government &gt; Math.random()*3) this.leviathan = new Timer(this, this.addCarrier, Math.random()*8+0.5);
			break;
		}
	default: 
		{
			break;
		}
	}
}

// add carrier with short delay.
this.addCarrier = function ()
{
	if (!system.isInterstellarSpace) system.addShips(&quot;leviathan&quot;, 1);
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/smCarrier.js</td>
                    <td><pre>this.name           = &quot;smCarrier&quot;;
this.author         = &quot;Eric Walch&quot;;
this.copyright      = &quot;Feb2008&quot;;
this.description    = &quot;Captured Leviathan&quot;;
this.version        = &quot;1.02&quot;;

this.shipSpawned = function ()
{
    this.spareEnergy = (missionVariables.military_fiasco_killcount &gt; 40) ? missionVariables.military_fiasco_killcount * 10 : 0;
	this.oldBounty = this.ship.bounty;
    delete this.shipSpawned;
}

this.shipDied = function ()
{
    missionVariables.military_fiasco = &quot;MIL_LEVI_DESTROYED&quot;;
	mission.setInstructionsKey(&quot;mission_military_desc4&quot;, &quot;military_fiasco&quot;);
}

this.otherShipDocked = function (ship)
{
    if (ship.isPlayer) player.consoleMessage(expandDescription(&quot;You&#39;ll be dead in minutes now.&quot;), 3);
}

this.stationLaunchedShip = function(ship)
{
    if (ship.isPlayer) ship.fuel = 0;
}

this.clearBounty = function ()
{
    // don&#39;t attract police, only player.
    if (this.ship.bounty !== 0) 
	{
		this.oldBounty = this.ship.bounty;
		this.ship.bounty = 0;
	}
}

this.setBounty = function ()
{
    if (this.ship.bounty === 0) this.ship.bounty = this.oldBounty;
    if (!this.alreadyMet &amp;&amp; !player.ship.isCloaked)
    {
        this.ship.commsMessage(&quot;Hey commander, I&#39;ll have my revenge this time&quot;);
        this.alreadyMet = true;
    }
    this.callTroops();
}

this.callTroops = function ()
{
    var smships = system.shipsWithPrimaryRole(&quot;smship&quot;);
    for (var i=0; i&lt;smships.length;i++)
        if (smships[i].isValid) //could have already been destroyed
        {
            if (!(smships[i].target &amp;&amp; smships[i].target === this.ship.target))
			{
				smships[i].target = this.ship.target;
				smships[i].reactToAIMessage(&quot;ATTACK_MAIN_TARGET&quot;);
			}
        }
    smships = system.shipsWithRole(&quot;smship-defender&quot;);
    for (var i=0; i&lt;smships.length;i++)
        if (smships[i].isValid) //could have already been destroyed
        {
            smships[i].target = this.ship.target;
            smships[i].AIState = &quot;ATTACK_SHIP&quot;;
        }
}

this.shipBeingAttacked = function ()
{
    if (this.ship.energy &lt; this.ship.maxEnergy * 0.5 &amp;&amp; this.spareEnergy &gt; 0)
    {
        this.ship.commsMessage(&quot;You fool, my energy banks are reloading.&quot;)
        if (this.spareEnergy &gt; 500)
        {
            this.spareEnergy -= 500;
            this.ship.energy += 500;
        }
        else
        {
            this.ship.energy += this.spareEnergy;
            this.spareEnergy = 0;
        }
    }
}

this.witchpoint = function ()
{
	this.direction = &quot;witchpoint&quot;;
	this.clearBounty();
}

this.planet = function ()
{
	this.direction = &quot;planet&quot;;
	this.clearBounty();
}

this.whichDirection = function ()
{
	if (this.direction === &quot;witchpoint&quot;) this.ship.reactToAIMessage(&quot;GO_TO_WITCHPOINT&quot;)
	else this.ship.reactToAIMessage(&quot;GO_TO_PLANET&quot;);
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/smShip.js</td>
                    <td><pre>this.name           = &quot;smShip&quot;;
this.author         = &quot;Eric Walch&quot;;
this.copyright      = &quot;may2008&quot;;
this.description    = &quot;Stolen Military ships&quot;;
this.version        = &quot;1.02&quot;;

this.isHelper = false; // set true by WorldScript in end mission.

this.spawnedAsEscort = function ()
{
	this.isHelper = true;
	this.mom = system.shipsWithPrimaryRole(&quot;leviathan-pirate&quot;)[0] // define mother ship on spawning
}

this.shipSpawned = function ()
{
    if (this.isHelper) this.ship.switchAI(&quot;smShipDefenceAI.plist&quot;)
    
    if (this.ship.primaryRole == &quot;defense_ship&quot;)
    {
        this.ship.AIState = &quot;CLEAR_LAUNCHING_BAY&quot; // Missed &quot;LAUNCHED OKAY&quot; message on AI switching
        this.mom = system.shipsWithPrimaryRole(&quot;leviathan-pirate&quot;)[0] // define mother ship on launch
    }
    if (missionVariables.military_fiasco_killcount &gt; 150 &amp;&amp; Math.random() &lt; 0.5) this.ship.fuel = 70
    delete this.shipSpawned;
}

this.shipDied = function (who)
{
    if (who &amp;&amp; who.isPlayer)
    {
        missionVariables.military_fiasco_killcount++
        missionVariables.military_fiasco_progresscount++
		if (this.isHelper) missionVariables.military_fiasco_helpers--
    }
}

this.shipEnergyIsLow = function ()
{
	if (this.ship.subEntities.length == 0 &amp;&amp; Math.random() &lt; 0.05 &amp;&amp; !this.mom) this.ship.reactToAIMessage(&quot;JUMP_AWAY&quot;)
}

this.checkTarget = function ()
{
    // prefent targetting his own kind when player hits the Leviathan from outside his scanner range or cloacked hit.
    if (this.ship.target 
            &amp;&amp; (this.ship.target.primaryRole == &quot;smship&quot; || this.ship.target.primaryRole == &quot;leviathan-pirate&quot;
            || this.ship.target.primaryRole == &quot;defense_ship&quot;))
    {
        if (this.mom &amp;&amp; this.mom.target) this.ship.target = this.mom.target
        else this.ship.AIState = &quot;TRAVEL_TO_LURK_AREA&quot;
    }
}

this.checkCloakedTarget = function ()
{
    if (this.ship.target &amp;&amp; !this.ship.target.isCloaked) this.ship.reactToAIMessage(&quot;TARGET_DECLOAKED&quot;)
}

// check mother to prevent it forcing in stop mode for docking.
this.checkMother = function ()
{
    if (this.mom)
    {
        if (this.mom.AIState == &quot;ATTACK_TARGET&quot;) this.ship.reactToAIMessage(&quot;MOM_BUSY&quot;)
        else this.ship.reactToAIMessage(&quot;MOM_IDLE&quot;)
    }
}

this.findMom = function ()
{
    if (this.mom)
    {
        this.ship.target = this.mom
		this.ship.reactToAIMessage(&quot;FOUND_MOM&quot;)
    }
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/smShipSubent.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;smShipSubentity&quot;;
this.author         = &quot;Eric Walch&quot;;
this.copyright      = &quot;august2008&quot;;
this.description    = &quot;Code that adds a loose subentity at the position of a killed subentity.&quot;;
this.version        = &quot;1.07&quot;;

this.shipDied = function ()
{
    if (this.ship.isSubEntity)
    {
        var mom = this.ship.owner;
        if ((this.ship.entityPersonality^15)&amp;15 &gt; 12)
        {
            var subent = this.ship.owner.spawnOne(this.ship.primaryRole);
            if (subent.isValid)
            {
                subent.orientation = mom.orientation;
                subent.position = this.localToGlobal(this.ship.position.multiply(1.1), mom);
                subent.velocity = mom.velocity.multiply(0.7);
            }
        }
        else if (this.ship.mass &gt; 1000 &amp;&amp; (this.ship.entityPersonality &amp; 15 &lt; 4))
        {
            mom.spawn(&quot;alloy&quot;, Math.ceil(Math.random()*(Math.log(this.ship.mass)-5)));
        }
        // if (mom.subEntities.length == 1) mom.reactToAIMessage(&quot;ENERGY_LOW&quot;); // last sub is shot away.
    }
    else
    {
        if (this.ship.mass &gt; 1000 &amp;&amp; Math.random()&lt; 0.2) this.ship.spawnOne(&quot;alloy&quot;);
        if (this.timer) {this.timer.stop(); delete this.timer};
    }
    delete this.shipDied;
}

this.localToGlobal = function (position, ship)
{
    var orientation = ship.orientation;
	if (0 &lt; oolite.compareVersion(&quot;1.75&quot;)) orientation.w = -orientation.w;
	return ship.position.add(position.rotateBy(orientation));
}

this.countdown = function () // called by AI
{
    if (Math.random()&gt;0.05) this.timer = new Timer(this, this.$die, Math.random()*1.3+0.2);
}

this.$die = function ()
{
    this.ship.reactToAIMessage(&quot;SUBENT_DIED&quot;);
}

this.entityDestroyed = function ()
{
    if (this.timer) {this.timer.stop(); delete this.timer};
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
