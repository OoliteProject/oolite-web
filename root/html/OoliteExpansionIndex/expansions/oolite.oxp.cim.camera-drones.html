<html>
    <head>
        <title>Expansion Camera Drones</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Camera Drones</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Drone cameras which provide a variety of alternative external views for your ship</td>
                    <td>Drone cameras which provide a variety of alternative external views for your ship</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.cim.camera-drones</td>
                    <td>oolite.oxp.cim.camera-drones</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Camera Drones</td>
                    <td>Camera Drones</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>cim</td>
                    <td>cim</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.4</td>
                    <td>1.4</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Camera_Drones">http://wiki.alioth.net/index.php/Camera_Drones</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="http://cim.sotl.org.uk/games/files/oolite/CameraDrones_1.4.oxz">http://cim.sotl.org.uk/games/files/oolite/CameraDrones_1.4.oxz</a></td>
                    <td><a target="_blank" href="http://compsoc.dur.ac.uk/~cim/oolite/Camera_Drones_1.4.oxz">http://compsoc.dur.ac.uk/~cim/oolite/Camera_Drones_1.4.oxz</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-SA 3.0</td>
                    <td>CC-BY-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>n/a</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Camera%20Drones'>http://wiki.alioth.net/index.php/Camera%20Drones</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_CAMERA_DRONES.html">Camera Drones</a></td>
                    <td>yes</td>
                    <td align="right">10000</td>
                    <td align="center">8+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. 
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/camera_drone_equip.js</td>
                    <td><pre>this.author      = &quot;cim&quot;; 
this.copyright   = &quot;� 2011-2014 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.version     = &quot;1.4&quot;; 
this.name = &quot;Camera Drones equipment script&quot;;

this.activated = function() {
		worldScripts[&quot;Camera Drones&quot;]._toggle.bind(worldScripts[&quot;Camera Drones&quot;])();
}

this.mode = function() {
		worldScripts[&quot;Camera Drones&quot;]._cycle.bind(worldScripts[&quot;Camera Drones&quot;])();
}


</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/camera_drones.js</td>
                    <td><pre>this.author      = &quot;cim&quot;; 
this.copyright   = &quot;� 2011-2014 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.version     = &quot;1.4&quot;; 
this.name = &quot;Camera Drones&quot;;

this.startUp = function() {
		this.$camActive = 0;
		this.$camFunctions = new Array;
		this.$track = null;

		this._registerCamera({name:&quot;Missile Camera&quot;,
													cameraPosition:this._missileCamPosition.bind(this),
													cameraVector:this._missileCamDirection.bind(this)});
		this._registerCamera({name:&quot;Flyby Camera (fast)&quot;,
													initialisation:this._flybyCamInit.bind(this),
													update:this._flybyCamUpdate.bind(this),
													cameraPosition:this._flybyCamPosition.bind(this),
													cameraVector:this._flybyCamDirection.bind(this)});
		this._registerCamera({name:&quot;Flyby Camera (medium)&quot;,
													initialisation:this._flybyCamInit.bind(this),
													update:this._flybyCamUpdate2.bind(this),
													cameraPosition:this._flybyCamPosition.bind(this),
													cameraVector:this._flybyCamDirection.bind(this)});
		this._registerCamera({name:&quot;Flyby Camera (slow)&quot;,
													initialisation:this._flybyCamInit.bind(this),
													update:this._flybyCamUpdate3.bind(this),
													cameraPosition:this._flybyCamPosition.bind(this),
													cameraVector:this._flybyCamDirection.bind(this)});
		this._registerCamera({name:&quot;Flyby Camera (long)&quot;,
													initialisation:this._flybyCamInit2.bind(this),
													update:this._flybyCamUpdate4.bind(this),
													cameraPosition:this._flybyCamPosition.bind(this),
													cameraVector:this._flybyCamDirection.bind(this)});
		this._registerCamera({name:&quot;Docking Camera&quot;,
													initialisation:this._dockingCamInit.bind(this),
													cameraPosition:this._dockingCamPosition.bind(this),
													cameraVector:this._dockingCamDirection.bind(this)});
		this._registerCamera({name:&quot;Target Camera&quot;,
													cameraPosition:this._targetCamPosition.bind(this),
													cameraVector:this._targetCamDirection.bind(this)});
		this._registerCamera({name:&quot;Target Follow Camera&quot;,
													cameraPosition:this._targetFollowCamPosition.bind(this),
													cameraVector:this._targetFollowCamDirection.bind(this)});
		this._registerCamera({name:&quot;Target Lead Camera&quot;,
													cameraPosition:this._targetLeadCamPosition.bind(this),
													cameraVector:this._targetLeadCamDirection.bind(this)});


}

this.equipmentDamaged = function(equip) {
		if (equip == &quot;EQ_CAMERA_DRONES&quot;) {
				this._deactivate();
		}
}

this._toggle = function() {
		if (this.$camActive) {
				this._deactivate();
		} else {
				this._activate();
		}
}

this._deactivate = function() {
		if (this.$camActive) {
				this.$camActive = 0;
				this._resetCamera();
				removeFrameCallback(this.$track);
				player.consoleMessage(&quot;Drone camera deactivated&quot;);
		}
}

this._activate = function() {
		this.$track = addFrameCallback(this._track.bind(this));
		this.$camActive = 1;
		player.consoleMessage(&quot;Drone camera activated: external view to watch&quot;);
}

this._resetCamera = function() {
		if (player.ship.viewDirection != &quot;VIEW_CUSTOM&quot;) { return; }
		player.ship.setCustomView([0,0,player.ship.collisionRadius*-5],[1,0,0,0]);
}


this._track = function(delta) {
		if (player.ship.viewDirection != &quot;VIEW_CUSTOM&quot;) { return; }

		var tracker = this.$camFunctions[0];
		
		if (tracker.update) {
				tracker.update(delta);
		}

		var pos = tracker.cameraPosition();
		if (pos == null) {
				this._deactivate();
				return;
		}
		pos = pos.subtract(player.ship.position);

		var posipcc = new Vector3D(0,0,0);
		var px = player.ship.vectorRight;
		var py = player.ship.vectorUp;
		var pz = player.ship.vectorForward;

// if you understand quaternions there is probably an easier way to do this!
		posipcc.x = pos.x * px.dot([1,0,0]) + pos.y * px.dot([0,1,0]) + pos.z * px.dot([0,0,1]);
		posipcc.y = pos.x * py.dot([1,0,0]) + pos.y * py.dot([0,1,0]) + pos.z * py.dot([0,0,1]);
		posipcc.z = pos.x * pz.dot([1,0,0]) + pos.y * pz.dot([0,1,0]) + pos.z * pz.dot([0,0,1]);

		var trackVector = tracker.cameraVector();
		if (trackVector == null) {
				trackVector = pos.multiply(-1);
				var quat = trackVector.direction().rotationTo([0,0,1]).multiply(player.ship.orientation.conjugate());
		} else {
				var camVector = trackVector.direction();
				var mvfipcc = new Vector3D(0,0,0);

				mvfipcc.x = camVector.x * px.dot([1,0,0]) + camVector.y * px.dot([0,1,0]) + camVector.z * px.dot([0,0,1]);
				mvfipcc.y = camVector.x * py.dot([1,0,0]) + camVector.y * py.dot([0,1,0]) + camVector.z * py.dot([0,0,1]);
				mvfipcc.z = camVector.x * pz.dot([1,0,0]) + camVector.y * pz.dot([0,1,0]) + camVector.z * pz.dot([0,0,1]);

				var quat = mvfipcc.rotationTo([0,0,1]);
		}

		player.ship.setCustomView(posipcc,quat);
}

this._registerCamera = function(obj) {
		this.$camFunctions.push(obj);
}

this._cycle = function() {
		this.$camFunctions.push(this.$camFunctions.shift());
		player.consoleMessage(&quot;Selected camera: &quot;+this.$camFunctions[0].name);
		if (this.$camFunctions[0].initialisation) {
				this.$camFunctions[0].initialisation();
		}
}

/*** Built in cameras ***/

/* Missile camera */

this.shipFiredMissile = function(missile,target) {
		this.$missile = missile;
}

this._missileCamPosition = function() {
		if (!this.$missile || !this.$missile.isValid) {
				return null;
		}
		return this.$missile.position.subtract(this.$missile.vectorForward.multiply(150)).add(this.$missile.vectorUp.multiply(10));
}

this._missileCamDirection = function() {
		return this.$missile.vectorForward;
}

/* Fly-by cameras */

this._flybyCamInit = function() {
		var angle = Math.random()*2*Math.PI;
		this.$startVector = new Vector3D(player.ship.collisionRadius*2*Math.sin(angle),player.ship.collisionRadius*2*Math.cos(angle),player.ship.collisionRadius*20);
}

this._flybyCamInit2 = function() {
		var angle = Math.random()*2*Math.PI;
	this.$startVector = new Vector3D(player.ship.collisionRadius*6*Math.sin(angle),
									 Math.abs(player.ship.collisionRadius*6*Math.cos(angle)),
									 player.ship.collisionRadius*40);
}


this._flybyCamUpdate = function(delta) {
		this.$startVector.z -= delta * 500;
		if (this.$startVector.z &lt; -player.ship.collisionRadius*20) {
				this._flybyCamInit();
		}
}

this._flybyCamUpdate2 = function(delta) {
		this.$startVector.z -= delta * 300;
		if (this.$startVector.z &lt; -player.ship.collisionRadius*20) {
				this._flybyCamInit();
		}
}

this._flybyCamUpdate3 = function(delta) {
		this.$startVector.z -= delta * 100;
		if (this.$startVector.z &lt; -player.ship.collisionRadius*20) {
				this._flybyCamInit();
		}
}

this._flybyCamUpdate4 = function(delta) {
		this.$startVector.z -= delta * 300;
		if (this.$startVector.z &lt; -player.ship.collisionRadius*20) {
				this._flybyCamInit2();
		}
}


this._flybyCamPosition = function() {
		return player.ship.position.add(player.ship.vectorForward.multiply(this.$startVector.z)).add(player.ship.vectorUp.multiply(this.$startVector.y)).add(player.ship.vectorRight.multiply(this.$startVector.x));
}

this._flybyCamDirection = function() {
		return player.ship.vectorForward.multiply(this.$startVector.z).add(player.ship.vectorUp.multiply(this.$startVector.y)).add(player.ship.vectorRight.multiply(this.$startVector.x)).multiply(-1);
}

/* Docking camera */

this._dockingCamInit = function() {
		var stations = system.filteredEntities(this,function(entity){return entity.isStation;},player.ship,25600);
		if (stations.length &gt; 0) {
				this.$station = stations[0];
		} else {
				this.$station = system.mainStation;
		}
}

this._dockingCamPosition = function() {
		if (!this.$station || !this.$station.isValid) {
				return null;
		}

		return this.$station.position.add(this.$station.vectorForward.multiply((this.$station.boundingBox.z/2)+250)).add(this.$station.vectorRight.multiply(350)).add(this.$station.vectorUp.multiply(175));
}

this._dockingCamDirection = function() {
		return null; // track player ship
}

/* Target camera */

this._targetCamPosition = function() {
		if (player.ship.target &amp;&amp; player.ship.target.isShip) {
				return player.ship.target.position;
		}
		return null;
}

this._targetCamDirection = function() {
		return player.ship.target.vectorForward;
}


this._targetFollowCamPosition = function() {
		if (player.ship.target &amp;&amp; player.ship.target.isShip) {
			var pst = player.ship.target;
			var r = pst.collisionRadius*3;
			return pst.position.add(pst.vectorForward.multiply(-r)).add(pst.vectorUp.multiply(r/3)).add(pst.vectorRight.multiply(r/5));
		}
		return null;
}

this._targetFollowCamDirection = function() {
	var pst = player.ship.target;
	var dir = pst.vectorForward.add(pst.vectorUp.multiply(-1/3)).add(pst.vectorRight.multiply(-1/5));
	return dir.direction();
}

this._targetLeadCamPosition = function() {
		if (player.ship.target &amp;&amp; player.ship.target.isShip) {
			var pst = player.ship.target;
			var r = pst.collisionRadius*3;
			return pst.position.add(pst.vectorForward.multiply(r)).add(pst.vectorUp.multiply(r/3)).add(pst.vectorRight.multiply(r/5));
		}
		return null;
}

this._targetLeadCamDirection = function() {
	var pst = player.ship.target;
	var dir = pst.vectorForward.multiply(-1).add(pst.vectorUp.multiply(-1/3)).add(pst.vectorRight.multiply(-1/5));
	return dir.direction();
}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
