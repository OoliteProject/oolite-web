<html>
    <head>
        <title>Expansion Military Shields Ships</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Military Shields Ships</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">4 Equipment</a></li>
          <li><a href="#ships">26 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Optional Expansions mismatch between OXP Manifest and Expansion Manager at character position 0060 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
                <li>Unresolved dependency reference to oolite.oxp.Ngalo.NPC_Energy_Units:0</li>
                <li>Unknown key &#39;upload_date&#39; at https://wiki.alioth.net/img_auth.php/d/d4/MilitaryShields_Ships.oxz!manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>This OXP set a military shields for NPC-ships with large monolithic mass.</td>
                    <td>This OXP set a military shields for NPC-ships with large monolithic mass.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Rustem.MilitaryShields_Ships</td>
                    <td>oolite.oxp.Rustem.MilitaryShields_Ships</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Military Shields Ships</td>
                    <td>Military Shields Ships</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Ships</td>
                    <td>Ships</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Rustem</td>
                    <td>Rustem</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.2.0</td>
                    <td>0.2.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                            <li>oolite.oxp.Ngalo.N-Shields:0</li>
                            <li>oolite.oxp.Ngalo.NPC_Equipment_Damage:0</li>
                            <li>oolite.oxp.Ngalo.NPC_Energy_Units:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Ngalo.N-Shields:</li>
                            <li>oolite.oxp.Ngalo.NPC_Equipment_Damage:</li>
                            <li>oolite.oxp.Ngalo.NPC_Energy_Units:</li>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://aegidian.org/bb/viewtopic.php?f=4&amp;t=18127&amp;p=261523">http://aegidian.org/bb/viewtopic.php?f=4&amp;t=18127&amp;p=261523</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/d/d4/MilitaryShields_Ships.oxz">https://wiki.alioth.net/img_auth.php/d/d4/MilitaryShields_Ships.oxz</a></td>
                    <td><a target="_blank" href="http://wiki.alioth.net/img_auth.php/d/d4/MilitaryShields_Ships.oxz">http://wiki.alioth.net/img_auth.php/d/d4/MilitaryShields_Ships.oxz</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873479</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Military%20Shields%20Ships'>http://wiki.alioth.net/index.php/Military%20Shields%20Ships</a></p>
        <h3>readme.txt</h3>
        <pre>Military Shields Ships
By Rustem

This OXP based on the N-Shields OXP. Thanks go to Ngalo for his N-Shields code.

Overview (WIP)
========

This OXP set a military shields for NPCs with large mass. This ship upgrade include in-build shield boosters and energy grids(grid technologies).

(!) This ship only for NPCs, so:
     - player has many equipment OXPs for upgrade: Energy Capacitors, Naval Grids, Shield Cycler and Ship Configuration.
     - also if will solved a compartibility with equipment OXPs, this grid technologies will available for player ship.

For NPCs has highest energy recharge rate (more 10, simulated NEU), this OXP will replaced usual shield boosters to NPC Shield Boosters and NPC Shield Enhancers in order to simulate correctly and avoid an overfitting recharge rate.

Military Multiply Shields Enhancement (MMS) = grid technologies = (?). //WAIT

The lebel &#39;MMS&#39; from ship names will deleted before public release.


Recommended OXP&#39;s (WIP)
=================

The following OXP&#39;s are listed as recommended:

- NShields (v0.7.1). //WIP: create a simple script mechanics(like used in vanila oolite)

The following OXP&#39;s are listed as recommended, in that additional ships will become available if they are installed.

- gsagostinho&#39;s Texture Packs
	Added a 3 ships: Cobra Mark IV(1 textures), Python(v1.1, 1 texture).

- Griff&#39;s Retextures : TODO
        Added a 2 ships: Cobra Mark III(v1.04, 2 textures).
	
- wildShips&#39;s Shipset (v0.9.1) : TODO
        Added a 3 ships: Chatu, Duma(2 ships).

- Laser Cannons (v1.12)
        Rebalance addition ships with laser cannons. Added a 17 ships: Anaconda(4 ships), Boa(3 ships), Boa Class Cruiser(3 ships), Cobra Mark III(2 ships), Python(5 ships).

- Sniper Gun (v1.3)
        Added a 2 ships: Python, Python BattleCruiser.

- Staer9&#39;s Shipset (v1.12)
        Added a 1 ship: Python ET Special.


Optional OXP&#39;s
==============

- NPC Equipment Damage
      Helps balance this OXP by allowing NPC equipment to be damaged when shields are down.

- NPC_Energy_Units
      Allowing NPCs to fit extra energy units is important for fairness if they have proper Military Shield Enhancers.
      TODO: Need upgrade for correct set a recharge rates for ship with simulated EEU and NEU.


License
=======
This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/

Discussion
==========
This OXP is discussed at this forum link: http://aegidian.org/bb/viewtopic.php?f=4&amp;t=18127&amp;p=261523 //TEMP

http://aegidian.org/bb/viewtopic.php?f=4&amp;t=18127 // NShields OXP

Info
====
http://wiki.alioth.net/index.php/Military_Shield_Enhancement //TODO : /Military_Multiply_Shields


Version History
===============

0.2.0
- Adds the Naval Energy Unit for NEU simulated.
- Adjustments a max shields and shield recharge rates.
- Upgrade of the main script (thanks go to Ngalo for his N-Shields code).

0.1.0
- Added the script for spawn of the military ships without N-Shields OXP.
- Added a recharge rate in the script info.

0.0.3
- Added a ships with with laser cannons : anaconda-pirate-lasercannon and anaconda-lasercannon(4 ships), boa-pirate-lasercannon2, boa-mk2-lasercannon(3 ships), python-lasercannon(3 ships).
- Reduced military shield vars : python-sg, python-battlecruiser.
- Renamed and resorted a some roles.

0.0.2
- For experimental testing added script_info vars: cargoext, recharge.
- Added a ships with with laser cannons : python-blackdog-lasercannon and python-lasercannon.
- Deleted a word &#39;MMS&#39; from ship names.
- Added a optional oxps to manifest.

0.0.1
- Initial beta release.


--------------------------------------------------------------------------------
 Help info
--------------------------------------------------------------------------------

For simulated the NEG a max shields must be more 256. A shield recharge least than ~ 95% from (recharge * 1.5) * 0.5.

Table:
--------------------------------------------------------------------------------------------------
Ship:           info:[max_cargo: max_energy/recharge  grid/max_shield/shield_recharge        max ]
--------------------------------------------------------------------------------------------------

//--- Oolite-core ships ---

Ship mass &gt; 350t        info                                                                 max cargo reduced to
----------------
anaconda                250: 500/15.0                 192/448/4.66                           -
anaconda-pirate

Ship mass &gt; 300t
----------------
-&gt; cobra_mk4            45: 320/13.5                   144/400/4.25                           -

Ship mass &gt; 250t
----------------
python                  100: 450/12.0                  128/384/3.8                            -
python-blackdog
python-trader

Ship mass &gt; 200t
----------------
boa-mk2                 175: 525/12.0                  160/416/3.8                            -
boa-mk2-pirate

cobra3-trader           20: 256/12.0                   128/384/3.8                            -
cobra3-alternate
cobra3-pirate

Ship mass &gt; 150t
----------------
boa                     125: 450/10.65                  96/352/3.34                            -
boa-pirate


//--- ships OXPs ---

Ship mass &gt; 350t
----------------
dtt_cyclops
kirin-cv
kirin-m-police
wildShips_chatu_trader
wildShips_chatu_hunter
wildShips_tribalChatu
wildShips_tembo
wildShips_dumaFleet
mw-asp

Ship mass &gt; 300t
----------------
cobra_mk4*              45: 320/13.5                   144/400/4.25                           -
python-x                145: 450/13.5                  144/400/4.25                           -

Ship mass &gt; 250t
----------------
python-cruiser          100: 350/13.5                  144/400/4.25                           -
python-hsg              100: 450/13.5                  144/400/4.25                           -
python-battlecruiser    100: 450/13.5                  144/400/4.25                           -

python_red-mms          100: 450/12.0                  128/384/3.8                            -
python-lasercannon-mms  100: 450/12.0                  128/384/3.8                            -

Ship mass &gt; 200t
----------------
cobra3-cannon           20: 256/12.0                   128/384/3.8                            -
cobra3-sg               20: 256/12.0                   128/384/3.8                            -
gsagostinho_cobra3**
griff_cobra_Mk3***
wildShips_duma****
z_groovy_cobra_Mk3*****

Ship mass &gt; 150t
----------------
cobra2x
boa-sg                 125: 450/10.65                   96/352/3.34                            -
dtt_kraken
dtt_war_lance
dtt_galaxy_liner
feudal_prince_Pirate_shipset
feudal_prince_Hunter_shipset

---

(*)
gsagostinho_cobra_mk4_pirate-NPC, x9, v1.4
gsagostinho_cobra_mk4_trader-NPC, x6, v1.4

(**)
gsagostinho_cobra3-NPC, x21, v1.5
gsagostinho_cobra3_pirate-NPC,x2,v1.5
gsagostinho-cobra3_blue_darkblue-sg
gsagostinho-cobra3_neon_pink-sg

(***)
griff_cobra_Mk3_trader-NPC, x5, v1.04
griff_cobra_Mk3_pirate-NPC, x5, v1.04
griff_cobra_Mk3_alt-sg
griff_cobra_Mk3_alt_pirate-NPC_scuffed, v1.3.4
griff_cobra_Mk3_alt_trader-NPC_clean, v1.3.4
griff_cobra_Mk3_alt_trader-NPC_scuffed, v1.3.4

(****)
wildShips_duma
wildShips_tribalDuma
wildShips_policeDuma

(*****)
noshaders_z_groovy_cobra_Mk3_alpha-NPC, x28

================================================================================
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_MMS_NPC_NAVAL_ENERGY_GRID.html">Naval Energy Grid</a></td>
                    <td>yes</td>
                    <td align="right">650000</td>
                    <td align="center">101+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_MMS_NPC_NAVAL_ENERGY_UNIT.html">Naval Energy Unit</a></td>
                    <td>yes</td>
                    <td align="right">500000</td>
                    <td align="center">101+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_MMS_NPC_SHIELD_BOOSTER.html">Shield Boosters</a></td>
                    <td>yes</td>
                    <td align="right">147500</td>
                    <td align="center">101+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_MMS_NPC_SHIELD_ENHANCER.html">Military Shield Enhancement</a></td>
                    <td>yes</td>
                    <td align="right">475500</td>
                    <td align="center">101+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/anaconda-lasercannon-mms.html">Anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/anaconda-lasercannon2-mms.html">Anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/anaconda-lasercannon3-mms.html">Anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/anaconda-lasercannon4-mms.html">Anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/anaconda-mms.html">Anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/boa-cruiser-lasercannon-mms.html">Boa Class Cruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/boa-cruiser-lasercannon2-mms.html">Boa Class Cruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/boa-cruiser-lasercannon3-mms.html">Boa Class Cruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/boa-cruiser-mms.html">Boa Class Cruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/boa-dualcannon-mms.html">Boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/boa-militcannon-mms.html">Boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/boa-militcannon2-mms.html">Boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/boa-mms.html">Boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/cobra3-blundercannon-mms.html">Cobra Mark III</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/cobra3-militcannon-mms.html">Cobra Mark III</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/cobra4-mms.html">Cobra Mark IV</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/python-battlecruiser-mms.html">Python BattleCruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/python-blackdog-lasercannon-mms.html">Python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/python-blackdog-lasercannon2-mms.html">Python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/python-clipper-mms.html">Python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/python-clipper2-mms.html">Python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/python-lasercannon-mms.html">Python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/python-mms.html">Python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/python-sg-mms.html">Python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/python-staer9-mms.html">python-staer9-mms</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/python_red-mms.html">Python</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;MilitaryShields_Ships&quot;;
this.author = &quot;Rustem&quot;;
this.copyright = &quot;2018&quot;;
this.description = &quot;Script for spawn of the military ships without N-Shields OXP&quot;;
this.licence = &quot;CC-BY-SA 4.0&quot;;
this.version = &quot;0.2&quot;;

//---- Logging ----

this.logging = false;
this.debugging = null; // used in check for special event. 

//---- Start Setting ----

this.NEU_multiplier = parseFloat(EquipmentInfo.infoForKey(&quot;EQ_MMS_NPC_NAVAL_ENERGY_UNIT&quot;).scriptInfo.oolite_energy_recharge_multiplier);
this.EEU_multiplier = parseFloat(EquipmentInfo.infoForKey(&quot;EQ_MMS_NPC_NAVAL_ENERGY_UNIT&quot;).scriptInfo.oolite_energy_recharge_multiplier);

// Shield Boosters
this.SB_shields = 2 * parseInt(EquipmentInfo.infoForKey(&quot;EQ_SHIELD_BOOSTER&quot;).scriptInfo.oolite_shield_increase);
this.SB_multiplier = parseFloat(EquipmentInfo.infoForKey(&quot;EQ_SHIELD_BOOSTER&quot;).scriptInfo.oolite_shield_recharge_multiplier);

// Military Shield Enhancement, Shield Enhancers
this.MSE_shields = 2 * parseInt(EquipmentInfo.infoForKey(&quot;EQ_MMS_NPC_SHIELD_ENHANCER&quot;).scriptInfo.oolite_shield_increase);
this.MSE_multiplier = parseFloat(EquipmentInfo.infoForKey(&quot;EQ_MMS_NPC_SHIELD_ENHANCER&quot;).scriptInfo.oolite_shield_recharge_multiplier);

this.NEG_shields = 2 * parseInt(EquipmentInfo.infoForKey(&quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;).scriptInfo.oolite_shield_increase);
this.NEG_multiplier = parseFloat(EquipmentInfo.infoForKey(&quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;).scriptInfo.oolite_shield_recharge_multiplier);
// or read from ship script_info

//---- WorldScript Event Handlers ----

this.startUp = function () {
	if (worldScripts.NShields) this.$npc_shields = true;
	if (worldScripts.NPC_Energy_Units) this.$npc_units = true;

	// if (worldScripts.ShipConfiguration_NPCShips) { // TODO: if the Naval Energy Unit will damaged
	// 	this.NPC_equipmentDamagedHandlers.push(this._shipconf_equipmentDamaged);
	// }

	if (worldScripts.NPC_Equipment_Damage) { // for NPC_Equipment_Damage v0.2.2
		worldScripts.NPC_Equipment_Damage.NPC_equipmentDamagedHandlers.push(this.NPC_energy_equipmentDamaged);
	}

	if (this.$npc_shields) {
		delete this.NPC_shield_equipmentDamaged;
	} else if (worldScripts.NPC_Equipment_Damage) { // for NPC_Equipment_Damage v0.2.2
		worldScripts.NPC_Equipment_Damage.NPC_equipmentDamagedHandlers.push(this.NPC_shield_equipmentDamaged)
	}
}

this.shipSpawned = function (ship) {
	if (!this.$shipHasShields(ship)) {
		return;
	}

	if (ship.energyRechargeRate &lt; 7) return; // ship has opportunity for enchancements: is simulated NEU? // rate for v0.1: 10 // v0.2: 7

	//if (!ship.isPiloted || ship.isStation || ship.isThargoid || ship.energyRechargeRate &gt; 5 || !ship.autoWeapons) return;
	//log(this.name, ship.name + &quot; has recharge: &quot; + ship.energyRechargeRate);

	// Setup of the Energy Units:

	this.$configureNPCUnits(ship); // if not intalled NPC Energy Units OXP

	// Setup of the Shields Equipments:

	this.$configureNPCShields(ship);
}

//---- Ship Setup ----

this.$shipHasShields = function (ship) {
	if (ship.scriptInfo &amp;&amp; ship.scriptInfo.npc_shields == &quot;no&quot;) return false;
	return (ship.isPiloted &amp;&amp; !(ship.primaryRole == &quot;escape-capsule&quot;) &amp;&amp; !ship.isStation) // isPiloted rules out buoys, rocks, weapons and debris
}

this.$configureNPCUnits = function (ship) {
	if ((this.$npc_units &amp;&amp; (ship.equipmentStatus(&quot;EQ_NPC_ENERGY_UNIT&quot;) === &quot;EQUIPMENT_OK&quot; || // EQ_ENERGY_UNIT ?
			ship.equipmentStatus(&quot;EQ_NPC_NAVAL_ENERGY_UNIT&quot;) === &quot;EQUIPMENT_OK&quot; || // EQ_NAVAL_ENERGY_UNIT ?
			worldScripts.NPC_Energy_Units._alreadyGotOne[ship.dataKey]))) return;
	//||
	//ship.equipmentStatus(&quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;) === &quot;EQUIPMENT_OK&quot; ||
	//ship.equipmentStatus(&quot;EQ_MMS_NPC_NAVAL_ENERGY_UNIT&quot;) === &quot;EQUIPMENT_OK&quot;) return;


	// Get info about initial equipment status

	var sc = ship.script;
	if (!sc.$enhrs) sc.$enhrs = 0; // TODO : may be will deleted, used in damage state
	if (!sc.$grids) sc.$grids = 0; // TODO : may be will deleted, used in damage state	

	var grids_boost = 0;
	var recharge = ship.energyRechargeRate;	
	var sci = ship.scriptInfo;	
	if (sci) {
		if (sci.recharge) recharge = parseFloat(sci.recharge);
		if (sci.max_shield_forward) grids_boost += parseInt(sci.max_shield_forward);
		if (sci.max_shield_aft) grids_boost += parseInt(sci.max_shield_aft);
		if (grids_boost &gt; 0) sc.$grids = grids_boost
	}

	// initial recharge rate without MSE
	var ench = 0;
	if (ship.equipmentStatus(&quot;EQ_SHIELD_ENHANCER&quot;) === &quot;EQUIPMENT_OK&quot;) { // MSE
		ench = 1;
		recharge = ship.energyRechargeRate / this.MSE_multiplier;
		//log(this.name, &quot;MSE will be replace: &quot; + ship.energyRechargeRate.toFixed(2) + &quot; to &quot; + recharge.toFixed(2));
	} else if (ship.equipmentStatus(&quot;EQ_NSHIELDS_NPC_NAVAL_SHIELD_BOOSTER&quot;) === &quot;EQUIPMENT_OK&quot;) {
		ench = 2;
		recharge = ship.energyRechargeRate;
		//log(this.name, &quot;NPC MSE will be upgrade: &quot; + recharge.toFixed(2));
	}
	if (ench) {
		sc.$enhrs = this.MSE_multiplier; // : may be will deleted

		// Info for upgrading of the OXP: EEU or NEU simulated?		
		if (!grids_boost &amp;&amp; recharge &gt; 6.99) { //special event
			if (!this.logging) {
				this.logging = true;
				this.debugging = true;
			}
			log(this.name, &quot;check shipdata to correctly sets a recharge rate[&quot; + ship.energyRechargeRate.toFixed(2) + &quot;] by MSE to &quot; + ship.dataKey);
		}
	}

	// ship has NEU simulated or has MSE?
	if (recharge &gt; 6.99) {
		if (ship.awardEquipment(&quot;EQ_MMS_NPC_NAVAL_ENERGY_UNIT&quot;)) {
			if (!this.$npc_shields) {
				if (grids_boost) ship.energyRechargeRate /= this.NEG_multiplier; // Adjustment for NEG
				if (recharge &gt; 9.99) ship.energyRechargeRate /= this.MSE_multiplier; // Adjustment for dummy MSE				
			}
			if (this.logging) log(this.name, &quot;Dummy NEU awarded to &quot; + ship.name + &quot;, has recharge: &quot; + ship.energyRechargeRate.toFixed(2))
		} else log(this.name, &quot;Fail NEU awarding to &quot; + ship.name);
	} else return;

	// Addition to NPC Shield Enhancers for NEU simulated, avoiding an overfitting of the recharge rate
	if (!this.$npc_shields &amp;&amp; ship.equipmentStatus(&quot;EQ_MMS_NPC_NAVAL_ENERGY_UNIT&quot;) === &quot;EQUIPMENT_OK&quot;) {
		ship.removeEquipment(&quot;EQ_SHIELD_ENHANCER&quot;);
		if (ship.awardEquipment(&quot;EQ_MMS_NPC_SHIELD_ENHANCER&quot;)) {
			this.$shieldBoosterAdjustment(ship, &quot;EQ_NAVAL_SHIELD_BOOSTER&quot;);
			if (this.logging) log(this.name, &quot;MSE[NEU] was replaced: &quot; + ship.energyRechargeRate.toFixed(2))
		}
	}
}

this.$configureNPCShields = function (ship) {
	//var recharge_rt = 0;
	var grids_boost = 0;

	var sc = ship.script;
	var sci = ship.scriptInfo;
	if (sci) { // Possible non-standard adjustments:
		//if (sci.recharge) recharge_rt = parseFloat(sci.recharge);
		if (sci.max_shield_forward) grids_boost += parseInt(sci.max_shield_forward);
		if (sci.max_shield_aft) grids_boost += parseInt(sci.max_shield_aft);

		// Replacement to NPC Shield Boosters for simulate correctly
		if (!this.$npc_shields &amp;&amp; ship.equipmentStatus(&quot;EQ_SHIELD_BOOSTER&quot;) === &quot;EQUIPMENT_OK&quot;) {
			ship.removeEquipment(&quot;EQ_SHIELD_BOOSTER&quot;);
			if (ship.awardEquipment(&quot;EQ_MMS_NPC_SHIELD_BOOSTER&quot;)) {
				this.$shieldBoosterAdjustment(ship, &quot;EQ_SHIELD_BOOSTER&quot;);
				if (this.logging) log(this.name, &quot;SB was replaced: &quot; + ship.energyRechargeRate.toFixed(2))
			}
		}

		// Replacement to NPC Shield Enhancers for simulate correctly
		if (!this.$npc_shields &amp;&amp; ship.equipmentStatus(&quot;EQ_SHIELD_ENHANCER&quot;) === &quot;EQUIPMENT_OK&quot;) {
			ship.removeEquipment(&quot;EQ_SHIELD_ENHANCER&quot;);
			if (ship.awardEquipment(&quot;EQ_MMS_NPC_SHIELD_ENHANCER&quot;)) {
				this.$shieldBoosterAdjustment(ship, &quot;EQ_NAVAL_SHIELD_BOOSTER&quot;);
				if (this.logging) log(this.name, &quot;MSE was replaced: &quot; + ship.energyRechargeRate.toFixed(2))
			}
		}

		// Addition a Naval Grids
		if (grids_boost &gt; 0) {
			//log(this.name, &quot;NEG will be awarded to &quot; + ship.name);
			if (ship.awardEquipment(&quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;)) { // ~ Naval Shield Boosters (EQ_NPC_SHIELD_BOOSTER, EQ_NPC_NAVAL_SHIELD_BOOSTER, EQ_NPC_SHIELD_ENHANCER)
				sc.$grids = grids_boost; // : may be will deleted			
				if (!this.$npc_shields) {
					this.$energyGridAdjustment(ship, &quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;);
				}
				if (this.logging) log(this.name, &quot;NEG was awarded to &quot; + ship.name + &quot;, has recharge: &quot; + ship.energyRechargeRate.toFixed(2));
				return
			} else log(this.name, &quot;failed to award NEG to &quot; + ship.name)
		}
	}

	// Info for upgrading of the OXP
	if (!sc.$enhrs) {		
		log(this.name, &quot;no shields script info to award NEG to &quot; + ship.name)
	} else if (this.debugging) {
		this.logging = false;
		this.debugging = null;
	}
}

this.$energyUnitAdjustment = function (ship, type, reverse) {
	let eq = EquipmentInfo.infoForKey(type);
	let recharge_boost = parseFloat(eq.scriptInfo.oolite_energy_recharge_multiplier);

	if (reverse) { // damaging/removing energy unit, not awarding
		if (ship.equipmentStatus(&quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;) === &quot;EQUIPMENT_OK&quot;) {
			if (this.$npc_shields &amp;&amp; ship.equipmentStatus(&quot;EQ_NSHIELDS_NPC_NAVAL_SHIELD_BOOSTER&quot;) !== &quot;EQUIPMENT_OK&quot; || ship.equipmentStatus(&quot;EQ_MMS_NPC_SHIELD_ENHANCER&quot;) !== &quot;EQUIPMENT_OK&quot;) {
				worldScripts.MilitaryShields_Ships.$energyGridAdjustment(ship, &quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;, true);
				ship.setEquipmentStatus(&quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;, &quot;EQUIPMENT_DAMAGED&quot;);
				//log(this.name, &quot;NEU fail, damaging EQ_MMS_NPC_NAVAL_ENERGY_GRID on &quot;+ship.displayName)				
			}
		}
		ship.energyRechargeRate /= recharge_boost
	} else {
		ship.energyRechargeRate *= recharge_boost
	}
}

this.$shieldBoosterAdjustment = function (ship, type, reverse) {
	//var shield_boost = this.shieldBoosters[type].shield_boost;
	//var recharge_boost = this.shieldBoosters[type].recharge_boost;
	let eq = EquipmentInfo.infoForKey(type);
	let shield_boost = parseInt(eq.scriptInfo.oolite_shield_increase);
	let recharge_boost = parseFloat(eq.scriptInfo.oolite_shield_recharge_multiplier);
	if (!recharge_boost) recharge_boost = 1; //just in case, to avoid NaN and divide-by-zero errors

	if (reverse) // damaging/removing shield booster, not awarding
	{
		if (type === &quot;EQ_NAVAL_SHIELD_BOOSTER&quot; &amp;&amp; ship.equipmentStatus(&quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;) === &quot;EQUIPMENT_OK&quot;) {
			if (this.$npc_shields &amp;&amp; ship.equipmentStatus(&quot;EQ_NSHIELDS_NPC_NAVAL_SHIELD_BOOSTER&quot;) !== &quot;EQUIPMENT_OK&quot; || ship.equipmentStatus(&quot;EQ_MMS_NPC_NAVAL_ENERGY_UNIT&quot;) !== &quot;EQUIPMENT_OK&quot;) {
				worldScripts.MilitaryShields_Ships.$energyGridAdjustment(ship, &quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;, true);
				ship.setEquipmentStatus(&quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;, &quot;EQUIPMENT_DAMAGED&quot;);
				//log(this.name, &quot;MSE fail, damaging EQ_MMS_NPC_NAVAL_ENERGY_GRID on &quot;+ship.displayName)				
			}
		}
		if (this.$npc_shields) {
			ship.maxForwardShield -= shield_boost;
			ship.maxAftShield -= shield_boost;
			ship.forwardShieldRechargeRate /= recharge_boost;
			ship.aftShieldRechargeRate /= recharge_boost;
			if (ship.forwardShield &gt; ship.maxForwardShield) ship.forwardShield = ship.maxForwardShield;
			if (ship.aftShield &gt; ship.maxAftShield) ship.aftShield = ship.maxAftShield;
		} else {
			ship.maxEnergy -= 2 * shield_boost;
			ship.energyRechargeRate /= recharge_boost;
			if (ship.energy &gt; ship.maxEnergy) ship.energy = ship.maxEnergy;
		}
	} else {
		if (this.$npc_shields) {
			ship.maxForwardShield += shield_boost;
			ship.maxAftShield += shield_boost;
			ship.forwardShieldRechargeRate *= recharge_boost;
			ship.aftShieldRechargeRate *= recharge_boost;
			ship.forwardShield = ship.maxForwardShield; // in case this was called after another script awarded equipment
			ship.aftShield = ship.maxAftShield;
		} else {
			ship.energy = ship.maxEnergy += 2 * shield_boost;
			ship.energyRechargeRate *= recharge_boost;
		}
	}
}

this.$energyGridAdjustment = function (ship, type, reverse) {
	let eq = EquipmentInfo.infoForKey(type);
	let shield_boost = parseInt(eq.scriptInfo.oolite_shield_increase); // 0.0
	let recharge_boost = parseFloat(eq.scriptInfo.oolite_shield_recharge_multiplier); // 1.5
	if (ship.script.$grids) { // setup by script info
		shield_boost = 0.5 * ship.script.$grids
	}
	if (!recharge_boost) recharge_boost = 1; //just in case, to avoid NaN and divide-by-zero errors

	if (reverse) // damaging/removing energy grid, not awarding
	{
		if (this.$npc_shields) {
			ship.energyRechargeRate /= recharge_boost;
			ship.forwardShieldRechargeRate /= recharge_boost;
			ship.aftShieldRechargeRate /= recharge_boost;
			if (ship.forwardShield &gt; ship.maxForwardShield) ship.forwardShield = ship.maxForwardShield;
			if (ship.aftShield &gt; ship.maxAftShield) ship.aftShield = ship.maxAftShield;
		} else {
			ship.maxEnergy -= 2 * shield_boost;
			ship.energyRechargeRate /= recharge_boost;
			if (ship.energy &gt; ship.maxEnergy) ship.energy = ship.maxEnergy;
		}
	} else {
		if (this.$npc_shields) {
			ship.energyRechargeRate *= recharge_boost;
			ship.forwardShieldRechargeRate *= recharge_boost;
			ship.aftShieldRechargeRate *= recharge_boost;
			ship.forwardShield = ship.maxForwardShield; // in case this was called after another script awarded equipment
			ship.aftShield = ship.maxAftShield;
		} else {
			ship.energy = ship.maxEnergy += 2 * shield_boost;
			ship.energyRechargeRate *= recharge_boost;
		}
	}
}

//---- Handler for NPC Shields Damage ----

this.NPC_energy_equipmentDamaged = function (equipment) {

	if (equipment == &quot;EQ_MMS_NPC_NAVAL_ENERGY_UNIT&quot;) { // TODO: compartibility with: equipment == &quot;EQ_NPC_NAVAL_ENERGY_UNIT&quot;
		worldScripts.MilitaryShields_Ships.$energyUnitAdjustment(this.ship, &quot;EQ_MMS_NPC_NAVAL_ENERGY_UNIT&quot;, true); // for NPC_Equipment_Damage v0.2.2
		//return;
	}
	if (equipment == &quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;) {
		worldScripts.MilitaryShields_Ships.$energyGridAdjustment(this.ship, &quot;EQ_MMS_NPC_NAVAL_ENERGY_GRID&quot;, true); // for NPC_Equipment_Damage v0.2.2
	}
}

this.NPC_shield_equipmentDamaged = function (equipment) {
	if (equipment == &quot;EQ_MMS_NPC_SHIELD_BOOSTER&quot;) {
		worldScripts.MilitaryShields_Ships.$shieldBoosterAdjustment(this.ship, &quot;EQ_SHIELD_BOOSTER&quot;, true); // for NPC_Equipment_Damage v0.2.2
	}
	if (equipment == &quot;EQ_MMS_NPC_SHIELD_ENHANCER&quot;) {
		worldScripts.MilitaryShields_Ships.$shieldBoosterAdjustment(this.ship, &quot;EQ_NAVAL_SHIELD_BOOSTER&quot;, true); // for NPC_Equipment_Damage v0.2.2
	}
}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
