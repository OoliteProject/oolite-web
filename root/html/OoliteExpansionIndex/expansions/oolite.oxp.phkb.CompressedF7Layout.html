<html>
    <head>
        <title>Expansion Compressed F7 Layout</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Compressed F7 Layout</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Moves all standard F7 data to the top of the screen, leaving no blank lines between data elements, including details from &#39;Distant Suns&#39; and &#39;Explorers Club&#39;, if installed.</td>
                    <td>Moves all standard F7 data to the top of the screen, leaving no blank lines between data elements, including details from &#39;Distant Suns&#39; and &#39;Explorers Club&#39;, if installed.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.phkb.CompressedF7Layout</td>
                    <td>oolite.oxp.phkb.CompressedF7Layout</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Compressed F7 Layout</td>
                    <td>Compressed F7 Layout</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Miscellaneous</td>
                    <td>Miscellaneous</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>phkb</td>
                    <td>phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.3</td>
                    <td>1.3</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.phkb.SystemDataConfig:0.4.0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.phkb.SystemDataConfig:0.4.0</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/System_Data_Config">http://wiki.alioth.net/index.php/System_Data_Config</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/b/b9/CompressedF7Layout.oxz">https://wiki.alioth.net/img_auth.php/b/b9/CompressedF7Layout.oxz</a></td>
                    <td><a target="_blank" href="http://wiki.alioth.net/img_auth.php/b/b9/CompressedF7Layout.oxz">http://wiki.alioth.net/img_auth.php/b/b9/CompressedF7Layout.oxz</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1623736967</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Compressed%20F7%20Layout'>http://wiki.alioth.net/index.php/Compressed%20F7%20Layout</a></p>
        <h3>readme.txt</h3>
        <pre>Compressed F7 Layout
By Nick Rogers

Overview
========
This OXP removes all the blank lines on the F7 System Data screen, and puts all the data together at the top of the screen. If the Explorers Club or Distant Suns OXP&#39;s are installed, their information will also be moved to the top part of the screen, underneath the standard system data. 

Oolite 1.85/86 and the System Data Config OXP are required.

License
=======
This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/

Version History
===============
1.3
- Code tweaks for integration with Random Station Names OXP.

1.2
- Corrections to manifest.plist file.

1.1
- Fixed JS error if Explorers Club is not installed.

1.0
- Initial release</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. 
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. 
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;CompressedF7Layout&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2017 phkb&quot;;
this.description = &quot;Moves all standard F7 data to the top of the screen, leaving no blank lines between data elements, including details from &#39;Distant Suns&#39; and &#39;Explorers Club&#39;, if installed.&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function() {

	var sd = worldScripts[&quot;oolite-system-data-config&quot;];
    sd.setSystemDataLine(1, &quot;[sysdata-eco]\t[economy_desc]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(2, &quot;[sysdata-govt]\t[government_desc]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(3, &quot;[sysdata-tl]\t[sysdata-tl-value]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(4, &quot;[sysdata-pop]\t[sysdata-pop-value]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(5, &quot;\t([inhabitants])&quot;, &quot;system&quot;);
    sd.setSystemDataLine(6, &quot;[sysdata-prod]\t\t[sysdata-prod-value]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(7, &quot;[sysdata-radius]\t\t[sysdata-radius-value]&quot;, &quot;system&quot;);
    sd.setSystemDataLine(8, &quot;[sysdata-distance]\t[distanceInfo]&quot;, &quot;system&quot;);
    sd.resetSystemDataLine(9);
    sd.resetSystemDataLine(10);
    sd.resetSystemDataLine(11);
    sd.resetSystemDataLine(12);
    sd.resetSystemDataLine(13);
    sd.resetSystemDataLine(14);
    sd.resetSystemDataLine(15);
    sd.resetSystemDataLine(16);

	if (worldScripts.Stars) {
		// we&#39;re overriding distant Sun&#39;s guiScreenChanged so it doesn&#39;t add text to the bottom part of the F7 screen
		worldScripts.Stars.$overrideGUI = worldScripts.Stars.guiScreenChanged;
		delete worldScripts.Stars.guiScreenChanged;
		// instead, we&#39;ll add a callback to do the update
		sd.addChangeCallback(this.name, &quot;$stars_updateData&quot;);
	}
	if (worldScripts[&quot;Explorers Club&quot;]) {
		// we&#39;re overriding EC&#39;s guiScreenChanged so we can capture and ignore any change to GUI_SCREEN_SYSTEM_DATA
		worldScripts[&quot;Explorers Club&quot;].$ovr_guiScreenChanged = worldScripts[&quot;Explorers Club&quot;].guiScreenChanged;
		delete worldScripts[&quot;Explorers Club&quot;].guiScreenChanged;
		// we&#39;ll also add a callback to do the update
		sd.addChangeCallback(this.name, &quot;$explorersClub_updateData&quot;);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.guiScreenChanged = function(to, from) {
	// for anything other than GUI_SCREEN_SYSTEM_DATA fire EC&#39;s original guiScreenChanged event
	if (guiScreen !== &quot;GUI_SCREEN_SYSTEM_DATA&quot; &amp;&amp; worldScripts[&quot;Explorers Club&quot;]) worldScripts[&quot;Explorers Club&quot;].$ovr_guiScreenChanged(to, from);
}

//-------------------------------------------------------------------------------------------------------------
this.$explorersClub_updateData = function(ctype, to, from) {
	var ec = worldScripts[&quot;Explorers Club&quot;];
	var sd = worldScripts[&quot;oolite-system-data-config&quot;];
	// find the first free slot (or the one we&#39;re currently using)
	for (var i = 1; i &lt;= 16; i++) {
		if (sd.systemDataLineOwner(i) === &quot;&quot; || sd.systemDataLineOwner(i) === &quot;explorers_club&quot;) {
			// found it! now work out what system we&#39;re looking at
			var sysID = -1;
			if (ctype === &quot;guiScreenWillChange&quot;) {
				// for this event, we need to check out the infoSystem or targetSystem of the player ship
				var sysID = player.ship.targetSystem;
				if (player.ship.hasOwnProperty(&quot;infoSystem&quot;)) sysID = player.ship.infoSystem;
			} else {
				// for an infoSystemWillChange, the &quot;to&quot; property has the value we need
				sysID = to;
			}
			// make sure we have a valid system ID
			if (isNaN(sysID) === false &amp;&amp; sysID &gt;=0 &amp;&amp; sysID &lt;= 255) {
				// extract the correct text from missionText
				var text = &quot;&quot;;
				if (ec.$xc_record[galaxyNumber].indexOf(sysID) === -1) {
					text = expandMissionText(&quot;explorers_club_never_visited&quot;);
				} else if (player.ship.targetSystem === system.ID) {
					text = expandMissionText(&quot;explorers_club_here_now&quot;);
				} else {
					text = expandMissionText(&quot;explorers_club_already_visited&quot;);
				}
				// and update the data line
				sd.setSystemDataLine(i, text, &quot;explorers_club&quot;);
			} else {
				// if we have an invalid system ID, reset the line
				if (sd.systemDataLineOwner(i) === &quot;explorers_club&quot;) sd.resetSystemDataLine(i);
			}
			break;
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$stars_updateData = function(ctype, to, from) {
	var sd = worldScripts[&quot;oolite-system-data-config&quot;];
	// find the first free slot (or the one we&#39;re currently using)
	for (var i = 1; i &lt;= 16; i++) {
		if (sd.systemDataLineOwner(i) === &quot;&quot; || sd.systemDataLineOwner(i) === &quot;stars&quot;) {
			// found it! now work out what system we&#39;re looking at
			var sysID = -1;
			if (ctype === &quot;guiScreenWillChange&quot;) {
				// for this event, we need to check out the infoSystem or targetSystem of the player ship
				var sysID = player.ship.targetSystem;
				if (player.ship.hasOwnProperty(&quot;infoSystem&quot;)) sysID = player.ship.infoSystem;
			} else {
				// for an infoSystemWillChange, the &quot;to&quot; property has the value we need
				sysID = to;
			}
			// make sure we have a valid system ID
			if (isNaN(sysID) === false &amp;&amp; sysID &gt;=0 &amp;&amp; sysID &lt;= 255) {
				// and update the data line
				sd.setSystemDataLine(i, this.$starInfo(sysID), &quot;stars&quot;);
			} else {
				// if we have an invalid system ID, reset the line
				if (sd.systemDataLineOwner(i) === &quot;stars&quot;) sd.resetSystemDataLine(i);
			}
			break;
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
// slightly modified from Distant Sun&#39;s original code
this.$starInfo = function(sysID) {
	var info = System.infoForSystem(galaxyNumber, sysID);
	if (info.sun_gone_nova) return &quot;&quot;;
	
	var name    = info.name;
	var sunName = info.sun_name;
	var colour  = info.sun_color;
	if (colour) var colourText = worldScripts.Stars.$spectroscope(colour);
	var text = &quot;&quot;;
	if (worldScripts.RandomStationNames &amp;&amp; missionVariables.random_station_names_stars === &quot;On&quot;) {
		var starGrid = Math.floor(player.ship.targetSystem+(256 * galaxyNumber));
		sunName = worldScripts.RandomStationNames.starpool[starGrid&amp;2047];
	}
	if (colourText &amp;&amp; sunName) text += &quot;The planet &quot; + name + &quot; orbits the &quot; + colourText + &quot; &quot; + sunName + &quot;.&quot;;
	else if (colourText) text += &quot;The planet &quot; + name + &quot; orbits a &quot; + colourText + &quot;.&quot;;
	else if (sunName) text += &quot;The planet &quot; + name + &quot; orbits the star &quot; + sunName + &quot;.&quot;;
	
	return text;
}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
