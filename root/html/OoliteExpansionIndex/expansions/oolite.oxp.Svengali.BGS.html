<html>
    <head>
        <title>Expansion BGS</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion BGS</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER A)(&#39;[]&#39; vs &#39;[ambience, adjustable, audio, backgrounds, child, dependencies, effects, images, pictures, shaders, sounds, user friendly, visuals]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>BackgroundSet - effects, ambient sounds and images.</td>
                    <td>BackgroundSet - effects, ambient sounds and images.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Svengali.BGS</td>
                    <td>oolite.oxp.Svengali.BGS</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>BGS</td>
                    <td>BGS</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Ambience</td>
                    <td>Ambience</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Svengali</td>
                    <td>Svengali</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.5.4</td>
                    <td>2.5.4</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>ambience, adjustable, audio, backgrounds, child, dependencies, effects, images, pictures, shaders, sounds, user friendly, visuals</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.Svengali.Library:1.7.1</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Svengali.Library:1.7.1</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/BGS">http://wiki.alioth.net/index.php/BGS</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/3/3a/BGS2.5.4.oxz">https://wiki.alioth.net/img_auth.php/3/3a/BGS2.5.4.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-by-nc-sa 4.0</td>
                    <td>CC-by-nc-sa 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1693293170</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/BGS'>http://wiki.alioth.net/index.php/BGS</a></p>
        <h3>Readme.txt</h3>
        <pre>BGS2.5.1 for Oolite
Copyright 2010-2018 by Pagroove, PhantorGorth, Thargoid, Tricky &amp; Svengali
Licences: see below
November 2018

REQUIREMENTS:
- Oolite 1.88
- Library1.7.1

PROBLEMS:
In case of problems, please report it:
  -&gt; http://aegidian.org/bb/viewtopic.php?f=4&amp;t=8250
Please include the Latest.log file.

Licences:
- Milinks and Aegidians customsounds.oxp - Licence: CC-by.
- bgs-m_ambi_chatter0D.ogg - License Public Domain - provided by DaddyHoggy.
- Other - License: Creative Commons Attribution-NonCommercial-ShareAlike 4.0 Unported License.

To view a copy of this license, visit
  -&gt; http://creativecommons.org/licenses/by-nc-sa/4.0/
or send a letter to Creative Commons, 444 Castro Street,
 Suite 900, Mountain View, California, 94041, USA.

Thanks to:
- Aegidian, another_commander, DaddyHoggy, Diziet Sma, Kaks, Keeper,
 Milink, Phantor Gorth and Thargoid.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/BGS.js</td>
                    <td><pre>// jshint bitwise:false
/* global Sound,SoundSource,Timer,clock,expandMissionText,missionVariables,player,system,worldScripts */
/* BGS 2.5.1, (C) Svengali 2010-2018, License CC-by-nc-sa-4.0 */
(function(){
&quot;use strict&quot;;
this.name = &quot;BGS&quot;;

this.$pub = {
	chat:[],
	engineAmbi:&quot;[bgs_ambiEngine]&quot;,
	engineDown:&quot;[bgs_fxEngineDown]&quot;,
	engineUp:&quot;[bgs_fxEngineUp]&quot;,
	witch:[],
	witchCNT:6,
	witchG:&quot;[bgs_fxCountG]&quot;,
	witchH:&quot;[bgs_fxCountH]&quot;
};
this.$BGS = {
	chat:1,
	chatEnt:0,
	chatExpand:0,
	count:1,
	def:{engineAmbi:&quot;[bgs_ambiEngine]&quot;,engineDown:&quot;[bgs_fxEngineDown]&quot;,engineUp:&quot;[bgs_fxEngineUp]&quot;},
	engine:1,
	engineAmbi:1,
	jump:1,
	hypFX:1,
	hypFXExt:1,
	dockFX:1,
	oldHypFX:0,
	curSpeed:0,
	curSnd:null,
	dockShader:&quot;bgs_docking&quot;,
	hypCtrl:0,
	hypShader:&quot;bgs_hyper&quot;,
	noShade:0,
	seconds:0,
	CNT:{wp:0,wpType:0,hyper:15},
	conf:{chatPause:26,cntAdd:-0.3,jitter:0.002,E0:0x1ff},
	inf: {
		Name:&quot;BGS&quot;,Display:&quot;Config&quot;,Alive:&quot;$BGS.inf&quot;,Notify:&quot;_notification&quot;,Reset:true,
		SInt:{
			S0:{Name:&quot;$BGS.conf.jitter&quot;,Def:0.002,Float:1,Min:0.0001,Max:0.1,Desc:&quot;Jitter&quot;},
			S1:{Name:&quot;$BGS.conf.cntAdd&quot;,Def:-0.3,Float:1,Min:-2,Max:2,Desc:&quot;Offset&quot;},
			S2:{Name:&quot;$BGS.conf.chatPause&quot;,Def:26,Min:18,Max:42,Desc:&quot;Chatter pause&quot;},
			Info:&quot;^BGS_INFS&quot;
		},
		EInt:{
			E0:{Name:&quot;$BGS.conf.E0&quot;,Def:0x1ff,Min:0,Max:0xfff,Desc:
				[&quot;Chatter&quot;,&quot;Countdown&quot;,&quot;Engine&quot;,&quot;EngineAmbi&quot;,&quot;Jump&quot;,&quot;QMine&quot;,&quot;Jump FX&quot;,&quot;Exit FX&quot;,&quot;Dock FX&quot;,&quot;FX Redux&quot;,&quot;ChatExpand&quot;,&quot;Old Hyperspace&quot;]
			},
			Info:&quot;^BGS_INFE&quot;
		}
	}
};
this.startUp = function(){
	delete this.startUp;
	this._aid = worldScripts.Lib_Main._lib;
	if(missionVariables.BGS){
		this.$BGS.conf = this._aid.objMerge(this.$BGS.conf,JSON.parse(missionVariables.BGS));
		this._aid.clrMVs([&quot;BGS&quot;]);
		this._notification();
	}
	var b = this.$BGS, check, lvl = this._aid.ooShaders(), ov = &quot;bgs_inter_ov.png&quot;, fu = &quot;bgs_fullscr.png&quot;,
		sa = &quot;bgs-m_fx_interface_none.ogg&quot;, sb = &quot;bgs-m_fx_interface_map.ogg&quot;, sc = &quot;bgs-m_fx_interface_select.ogg&quot;;
	if(!lvl){b.dockFX = 0; b.hypFX = 0; b.hypFXExt = 0; b.noShade = 1;}
	// Check countdown sounds
	check = Sound.load(&#39;[galactic-hyperspace-countdown-begun]&#39;);
	if(check &amp;&amp; check.name!==&#39;bgs-m_silence.ogg&#39;) b.count = 0;
	check = Sound.load(&#39;[hyperspace-countdown-begun]&#39;);
	if(check &amp;&amp; check.name!==&#39;bgs-m_silence.ogg&#39;) b.count = 0;
	worldScripts.Lib_GUI.$guis.BGS = {
		generic:{pic:&quot;bgs_options.png&quot;},
		GUI_SCREEN_EQUIP_SHIP:{pic:&quot;bgs_ship.png&quot;,snd:&quot;bgs-m_fx_equipment1.ogg&quot;},
		GUI_SCREEN_INTERFACES:{pic:ov,snd:&quot;[menu-navigation-not]&quot;},
		GUI_SCREEN_KEYBOARD:{pic:fu},
		GUI_SCREEN_LONG_RANGE_CHART:{pic:ov},
		GUI_SCREEN_MANIFEST:{pic:&quot;bgs_manifest.png&quot;,snd:&quot;bgs-m_fx_manifest1.ogg&quot;,sndF:&quot;bgs-m_fx_manifest1.ogg&quot;},
		GUI_SCREEN_MARKET:{pic:&quot;bgs_market.png&quot;,snd:&quot;bgs-m_fx_market1.ogg&quot;},
		GUI_SCREEN_MARKETINFO:{pic:&quot;bgs_market.png&quot;},
		GUI_SCREEN_SHIPLIBRARY:{pic:fu},
		GUI_SCREEN_SHIPYARD:{pic:&quot;bgs_ship.png&quot;,snd:&quot;bgs-m_fx_shipyard1.ogg&quot;},
		GUI_SCREEN_SHORT_RANGE_CHART:{pic:ov},
		GUI_SCREEN_STATUS:{pic:&quot;bgs_status_docked.png&quot;,picFlight:&quot;bgs_status_inflight.png&quot;,picFlightRed:&quot;bgs_status_red.png&quot;,picVoid:&quot;bgs_status.png&quot;},
		GUI_SCREEN_STICKMAPPER:{pic:fu},
		GUI_SCREEN_STICKPROFILE:{pic:fu},
		GUI_SCREEN_SYSTEM_DATA:{pic:&quot;bgs_inter.png&quot;,picNova:&quot;bgs_inter_red.png&quot;,snd:&quot;bgs-m_fx_systemdata1.ogg&quot;,sndF:&quot;bgs-m_fx_systemdata1.ogg&quot;}
	};
	worldScripts.Lib_GUI.$IDs.BGS = {
		generic: {pic:fu,mpic:ov},
		&quot;oolite-contracts-cargo-none&quot;:{pic:ov,snd:sa},
		&quot;oolite-contracts-cargo-details&quot;:{mpic:ov,snd:sb},
		&quot;oolite-contracts-cargo-summary&quot;:{pic:ov,snd:sc},
		&quot;oolite-contracts-parcels-none&quot;:{pic:ov,snd:sa},
		&quot;oolite-contracts-parcels-details&quot;:{mpic:ov,snd:sb},
		&quot;oolite-contracts-parcels-summary&quot;:{pic:ov,snd:sc},
		&quot;oolite-contracts-passengers-none&quot;:{pic:ov,snd:sa},
		&quot;oolite-contracts-passengers-details&quot;:{mpic:ov,snd:sb},
		&quot;oolite-contracts-passengers-summary&quot;:{pic:ov,snd:sc},
		&quot;oolite-register&quot;:{pic:fu}
	};
	this.$pub.chat = expandMissionText(&quot;BGS_CHATTER&quot;).split(&quot;|&quot;);
	this.$pub.witch = expandMissionText(&quot;BGS_COUNT&quot;).split(&quot;|&quot;);
	var amb = [
		{name:&quot;bgs-ambi_station1.ogg&quot;,dur:41,vol:0.5},
		{name:&quot;bgs-ambi_station2.ogg&quot;,dur:41,vol:0.5},
		{name:&quot;bgs-ambi_station3.ogg&quot;,dur:41,vol:0.5},
		{name:&quot;bgs-ambi_station4.ogg&quot;,dur:41,vol:0.5},
		{name:&quot;bgs-ambi_station5.ogg&quot;,dur:41,vol:0.5}
	];
	worldScripts.Lib_GUI.$ambi.generic = worldScripts.Lib_GUI.$ambi.generic.concat(amb);
	var red = [
		{name:&quot;bgs-ambi_station_r1.ogg&quot;,dur:30,vol:0.6},
		{name:&quot;bgs-ambi_station_r2.ogg&quot;,dur:30,vol:0.6}
	];
	worldScripts.Lib_GUI.$ambi.redux = worldScripts.Lib_GUI.$ambi.redux.concat(red);
	var none = [
		{name:&quot;bgs-ambi_station_r3.ogg&quot;,dur:30,vol:0.5}
	];
	worldScripts.Lib_GUI.$ambi.none = worldScripts.Lib_GUI.$ambi.none.concat(none);
};
this.startUpComplete = function(){
	delete this.startUpComplete;
	this.$sndA = new SoundSource(); // engineAmbi or witchAmbi
	this.$sndA.loop = true;
	this.$sndB = new SoundSource(); // engineUp or engineDown
	this.$sndC = new SoundSource(); // chatter
	this.$sndD = new SoundSource(); // fxWitch, fxHyper
	this.$sndWP = new SoundSource(); // countdown
	worldScripts.Lib_Config._registerSet(this.$BGS.inf);
};
this.guiScreenChanged = function(){
	if(this.$saved){
		this._aid.clrMVs([&quot;BGS&quot;]);
		this.$saved = null;
	}
};
this.playerCancelledJumpCountdown = this.playerStartedAutoPilot = function(){
	this._clrTimer(1);
	this.$sndA.stop();
	this.$sndWP.stop();
};
this.playerJumpFailed = function(){
	this._clrTimer(1);
};
this.playerStartedJumpCountdown = function(type,duration){
	var b = this.$BGS;
	if(b.jump){
		this.$sndD.playSound(&quot;[bgs_fxWitch]&quot;);
		this.$sndA.playSound(&quot;[bgs_ambiWitch]&quot;);
	}
	if(duration&lt;1 || !b.count) return;
	b.CNT.wp = duration;
	b.CNT.wpType = (type===&quot;galactic&quot;?1:0);
	b.CNT.hyper = duration;
	this._clrTimer(1);
	this.$WPTimer = new Timer(this,this._doWPTimer,0,1);
	if(b.conf.cntAdd){
		this.$WPTimer.stop();
		this.$WPTimer.nextTime = clock.absoluteSeconds+b.conf.cntAdd;
		this.$WPTimer.start();
	}
};
this.playerWillSaveGame = function(){
	missionVariables.BGS = JSON.stringify(this.$BGS.conf);
	this.$saved = 1;
};
this._setInf = function(k,i,w,f){
	if(i[&quot;bgs_&quot;+k]) w[k] = i[&quot;bgs_&quot;+k];
	else w[k] = f[k];
};
this.shipWillLaunchFromStation = function(station){
	var b = this.$BGS, p = this.$pub, inf = player.ship.scriptInfo;
	this._setInf(&quot;engineAmbi&quot;,inf,p,b.def);
	this._setInf(&quot;engineUp&quot;,inf,p,b.def);
	this._setInf(&quot;engineDown&quot;,inf,p,b.def);
	if(b.dockFX) this._setDockTex(station,0);
	b.curSound = null;
	this.$bgsTimer = new Timer(this,this._doBGSTimer,0,0.25);
};
this.shipWillEnterWitchspace = function(type){
	this.$sndC.stop();
	this.$BGS.hypCtrl = 0;
	if(type===&quot;galactic jump&quot;) this.$BGS.hypCtrl = 1;
};
this.shipWillExitWitchspace = function(){
	var b = this.$BGS, oo, uni;
	if(!b.hypFX || player.ship.docked) return;
	system.breakPattern = false;
	oo = this._aid.ooScreen();
	if(system.isInterstellarSpace){
		if(b.oldHypFX===1){
			uni = [0,0.9,oo.ratio];
		}
		else{
			uni = [0,3,oo.ratio];
		}
	}
	else {
		if(b.oldHypFX===1){
			uni = [0,0,oo.ratio];
		}
		else{			
			if(b.hypCtrl) uni = [3,0,oo.ratio];
			else uni = [2,-3,oo.ratio];
		}
	}
	var ent = this._aid.entFXCreate(b.hypShader,250);
	this._setSHProp(ent,[250,9,uni,[0,0,1.4],1,4,0]);
};
this.shipExitedWitchspace = function(){
	this.$sndA.stop();
	var b = this.$BGS, uni = [0.3,0.3,1], z = -25;
	if(player.ship.isInSpace &amp;&amp; b.hypFXExt){
		if(system.isInterstellarSpace) uni = [1.0,0.6,0.6];
		else if(b.hypCtrl) uni = [1.0,0.5,1.0];
		var ent = this._aid.entFXCreate(&quot;bgs_exitWormhole&quot;,z);
		this._setSHProp(ent,[z,22,[14,-4.6,0],uni,0,0.9,1]);
	}
	if(b.jump) this.$sndD.playSound(&quot;[bgs_fxWitch]&quot;);
};
this.shipWillDockWithStation = function(station){
	if(this.$BGS.dockFX) this._setDockTex(station,1);
	this.shipDied();
	this.$BGS.chatEnt = 0;
};
this.shipDied = function(){
	this._clrTimer(1,1);
	this._clrSNDs();
};
this.shipLaunchedEscapePod = function(){
	this.shipDied();
};
this.gamePaused = function(){
	this._clrSNDs();
};
this._clrTimer = function(w,g){
	if(w &amp;&amp; this.$WPTimer){
		this.$WPTimer.stop();
		delete this.$WPTimer;
	}
	if(g &amp;&amp; this.$bgsTimer){
		this.$bgsTimer.stop();
		delete this.$bgsTimer;
	}
};
this._clrSNDs = function(){
	this.$sndA.stop();
	this.$sndB.stop();
	this.$sndC.stop();
	this.$sndWP.stop();
};
this._doBGSTimer = function(){
	if(!player.ship.isInSpace) return;
	var ps = player.ship, b = this.$BGS, ox = b.conf, p = this.$pub, ch,cg,r,a;
	if(b.engine){
		if(b.engineAmbi &amp;&amp; 0&lt;ps.speed-ox.jitter){
			if(!this.$sndA.isPlaying) this.$sndA.playSound(p.engineAmbi);
		} else this.$sndA.stop();
		if(!ps.torusEngaged){
			if(ps.speed&gt;b.curSpeed+ox.jitter) ch = p.engineUp;
			else if(ps.speed&lt;b.curSpeed-ox.jitter) ch = p.engineDown;
			if(ch){
				cg = Sound.load(ch);
				if(cg &amp;&amp; (cg.name!==b.curSnd || !this.$sndB.isPlaying)){
					this.$sndB.playSound(ch);
					if(this.$sndB.sound.name!==b.curSnd) b.curSnd = this.$sndB.sound.name;
				}
			}
		}
		b.curSpeed = ps.speed;
	}
	if(b.chat){
		if(b.chatExpand &amp;&amp; !ps.withinStationAegis){
			if(b.chatEnt &amp;&amp; b.chatEnt.isValid){
				if(ps.position.distanceTo(b.chatEnt)&gt;25600) b.chatEnt = this._pseudoAegis();
			} else b.chatEnt = this._pseudoAegis();
		} else b.chatEnt = 0;
		if(ps.withinStationAegis || b.chatEnt){
			if(!this.$sndC.isPlaying &amp;&amp; clock.absoluteSeconds&gt;b.seconds){
				r = p.chat[Math.floor(Math.random()*p.chat.length)];
				this.$sndC.sound = r;
				this.$sndC.volume = 0.6;
				this.$sndC.play();
				b.seconds = clock.absoluteSeconds+this._aid.randXY(14,ox.chatPause);
			}
		} else if(this.$sndC.isPlaying) this.$sndC.stop();
	}
};
this._pseudoAegis = function(){
	var a = system.entitiesWithScanClass(&quot;CLASS_STATION&quot;,player.ship,25600), r = 0;
	for(var i=0;i&lt;a.length;i++){
		if(a[i].scriptInfo &amp;&amp; a[i].scriptInfo.bgs_chatExpand){
			r = a[i];
			break;
		}
	}
	return r;
};
this._doWPTimer = function(){
	var a = this.$BGS.CNT, s;
	a.wp--;
	if(!this.$sndWP.isPlaying){
		if(a.wp&gt;13 &amp;&amp; a.hyper&lt;a.wp+2){
			if(!a.wpType) s = this.$pub.witchH;
			else s = this.$pub.witchG;
			this.$sndWP.playSound(s);
		} else if(a.wp&lt;this.$pub.witchCNT &amp;&amp; a.wp&gt;-1){
			this.$sndWP.playSound(this.$pub.witch[a.wp]);
		} else if(a.wp&lt;-1) this._clrTimer(1);
	}
	if(this.$BGS.hypFX &amp;&amp; player.ship.isValid &amp;&amp; a.wp===-1) this.$sndD.playSound(&quot;[bgs_fxHyper]&quot;);
};
// TODO: Multiple docks?
this._setDockTex = function(st,land){
	if(land) this.$sndB.playSound(this.$pub.engineDown);
	if(st.hasRole(&quot;aquatics_HQ&quot;)) return; // possible for one, if we get more we&#39;d need an indicator.
	var shs = [0.5,1,3,5,7], sh = 2.5, as = 1.0, co = 0.4, sit = null, sis = null, tint = [0.2824,0.171,0.0507],
		oo, inf, isMain = st.isMainStation, i;
	if(st.name===&quot;Rock Hermit&quot;) isMain = true;
	if(!isMain &amp;&amp; !st.scriptInfo) return;
	if(st.scriptInfo){
		inf = st.scriptInfo;
		if(inf.bgs_tunnel_off) return;
		if(inf.bgs_tunnel_texture) sit = inf.bgs_tunnel_texture;
		if(inf.bgs_tunnel_tint){
			tint = inf.bgs_tunnel_tint.split(&quot;,&quot;);
			for(i=0;i&lt;3;i++) tint[i] = parseFloat(tint[i]);
		}
		if(inf.bgs_tunnel_shape) sis = parseFloat(inf.bgs_tunnel_shape);
		if(inf.bgs_tunnel_contrast) co = parseFloat(inf.bgs_tunnel_contrast);
	}
	if(isMain || sit || sis){
		if(!sis){
			var s = st.subEntities;
			var l = s.length;
			for(i=0;i&lt;l;i++){
				if(s[i].isDock){
					var bb = s[i].boundingBox,r;
					if(bb.x&gt;=bb.y) r = bb.x/bb.y;
					else r = bb.y/bb.x;
					sh = shs[this._aid.clamp(Math.floor(r),0.5,4)];
					break;
				}
			}
		} else sh = sis;
		oo = this._aid.ooScreen();
		as = oo.ratio;
		if(sh&gt;1.1) as *= 0.5;
		var ent = this._aid.entFXCreate(this.$BGS.dockShader,250);
		this._setSHProp(ent,[250,4,[!land,sh,as],tint,0,0,0]);
		if(sit) this._aid.entSetMainTex(ent,sit);
		ent.shaderFloat1 = co;
		st.breakPattern = false;
	}
};
this._setSHProp = function(ent,arr){
	ent.script.$repos = arr[0];
	ent.script.$ridTime = arr[1];
	ent.shaderVector1 = arr[2];
	ent.shaderVector2 = arr[3];
	ent.script.$look = arr[4];
	ent.script.$reposTil = arr[5];
	ent.script.$view = arr[6];
};
// script_info keys are not merged!
this._shipSpawned = function(ship){
	if(ship.isMine &amp;&amp; ship.AIScript &amp;&amp; ship.AIScript.name===&quot;Oolite Q-bomb AI&quot;){
		if(ship.script.shipDied) ship.script.bgsShipDied = ship.script.shipDied;
		ship.script.shipDied = function(whom,why){
			if(ship.script.bgsShipDied) ship.script.bgsShipDied(whom,why);
			if(!player.ship.isValid || ship.position.distanceTo(player.ship.position)&gt;25600) return;
			if(why &amp;&amp; why===&quot;cascade weapon&quot;){var a = new SoundSource(); a.playSound(&quot;[bgs_fxQMine]&quot;);}
		};
	}
};
this._notification = function(){
	var b = this.$BGS, a = b.conf.E0, c,
		d = [[1,&quot;chat&quot;,0],[2,&quot;count&quot;,0],[4,&quot;engine&quot;,0],[8,&quot;engineAmbi&quot;,0],[16,&quot;jump&quot;,0],
			[64,&quot;hypFX&quot;,1],[128,&quot;hypFXExt&quot;,1],[256,&quot;dockFX&quot;,1],[1024,&quot;chatExpand&quot;,0],[2048,&quot;oldHypFX&quot;,0]];
	for(var i=0;i&lt;10;i++){
		c = d[i];
		if(c[2]===1 &amp;&amp; b.noShade) continue;
		if((a&amp;c[0])) b[c[1]] = 1;
		else b[c[1]] = 0;
	}
	if((a&amp;32)) this.shipSpawned = function(ship){this._shipSpawned(ship);};
	else delete this.shipSpawned;
	if(!b.noShade){
		if((a&amp;512)){
			b.hypShader = &quot;bgs_hyper_redux&quot;;
			b.dockShader = &quot;bgs_docking_redux&quot;;
		} else {
			b.hypShader = &quot;bgs_hyper&quot;;
			b.dockShader = &quot;bgs_docking&quot;;
		}
		if(b.oldHypFX === 1){
			b.hypShader = &quot;bgs_hyper_old&quot;;
		}
	}
	return;
};
this._Help = function(what){
	var h;
	switch(what){
		case &quot;$pub&quot;: h = &quot;BGS_HELP_pub&quot;; break;
		default: h = &quot;BGS_HELP&quot;;
	}
	return expandMissionText(h);
};
}).call(this);
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
