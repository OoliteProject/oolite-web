<html>
    <head>
        <title>Expansion HD Backgrounds</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion HD Backgrounds</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER S)(&#39;[]&#39; vs &#39;[safe]&#39;)</li>
                <li>Optional Expansions mismatch between OXP Manifest and Expansion Manager at character position 0062 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
                <li>Unresolved dependency reference to oolite.oxp.Norby.HDBG-B:0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Show station specific high resolution background images on Arrival Reports. Docking Fees OXP can help to see these more times. Prepared mission screens can use these images also. System screens are unchanged (handled by BackGroundSet, Better Screens and Xenon UI).</td>
                    <td>Show station specific high resolution background images on Arrival Reports. Docking Fees OXP can help to see these more times. Prepared mission screens can use these images also. System screens are unchanged (handled by BackGroundSet, Better Screens and Xenon UI).</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Norby.HDBG</td>
                    <td>oolite.oxp.Norby.HDBG</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>HD Backgrounds</td>
                    <td>HD Backgrounds</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Ambience</td>
                    <td>Ambience</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Norby</td>
                    <td>Norby</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.0</td>
                    <td>1.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>safe</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                            <li>oolite.oxp.Layne.DockingFees:0</li>
                            <li>oolite.oxp.Norby.HDBG-A:0</li>
                            <li>oolite.oxp.Norby.HDBG-B:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Layne.DockingFees:</li>
                            <li>oolite.oxp.Norby.HDBG-A:</li>
                            <li>oolite.oxp.Norby.HDBG-B:</li>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/HDBG">http://wiki.alioth.net/index.php/HDBG</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/1/18/HDBG_1.0.oxz">https://wiki.alioth.net/img_auth.php/1/18/HDBG_1.0.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873240</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/HD%20Backgrounds'>http://wiki.alioth.net/index.php/HD%20Backgrounds</a></p>
        <h3>HDBG_readme.txt</h3>
        <pre>HD Backgrounds on Arrival Reports

Show station specific high resolution background images in arrival reports.
System screens are unchanged (handled by BackGroundSet, Better Screens and Xenon UI).

Docking fees OXP is recommended to get more arrival reports.

HD images are gathered in this topic: http://aegidian.org/bb/viewtopic.php?f=7&amp;t=17492


Mission screens can show the same image as arrival reports if screenID is set to &#39;hdbg-station&#39;.
A specific image of another station is accessible also if the role of the station is given, like &#39;hdbg-coriolis&#39;.

Custom images can be used in misson screens if a hdbg-mymission.png is placed into any Images folder, the following code is applied and the screenID of the mission screen is set to &#39;mymission&#39;.
 this.startUp = function() {
  var w = worldScripts.hdbg;
  if( w ) w.$AddRoles([{role:&#39;mymission&#39;, file:&#39;hdbg-mymission.png&#39;, x:1920, y:1080}]);
 }

You must give &#39;role&#39; and &#39;file&#39; at least, but &#39;x&#39; and &#39;y&#39; sizes of images are needed to align well in different screen ratios.

You should give data about &#39;author&#39;, &#39;title&#39;, &#39;license&#39; and &#39;source&#39; like in this example:
 {role:&quot;coriolis&quot;, file:&quot;The_USS_Terraformer_by_Brendan_Biele.png&quot;, x:3840, y:2400, zoom:1,
  author:&quot;Brendan Biele&quot;, title:&quot;The USS Terraformer&quot;, licence:&quot;CC BY-NC-SA 3.0&quot;,
  source:&quot;https://www.flickr.com/photos/brendanbiele/5374095042/&quot;}

The optional &#39;zoom&#39; parameter is usable to force the original aspect ratio of the image regardless of the current screen. If the image is narrower than the screen then will zoom in to fit the width but the screen will crop the image at top and bottom. When image is wider than the screen then zoom into until fill the height of the screen but this cause to extend over the sides horizontally.

Without zoom the image always fit to the height of the screen but will be shrinked horizontally if too wide, like a 16:9 image on an old 4:3 monitor or stretched horizontally if too narrow, for example a 16:10 image on a 16:9 screen.

When you insert a 16:9 image you must decide which case will be looking better in a narrow 4:3 screen, the zoomed without sides or the stretched which fit into the screen but distorted.

If there are not so much important things in the sides and the cut lines at 5-5% for 16:10 and 12.5-12.5% for 4:3 will not break apart anything (like a human figure) then you can use &#39;zoom:1&#39;.
When no circles or other objects on the image which looks bad if shrinked horizontally then you can left out the zoom parameter so shrink the image into the screen.

If you insert a 4:3 image then you must decide the same but the cut lines are at the top and bottom.

When you insert a 16:10 or other exotic images then you must check both cases: side cuts for the 4:3 monitor users and top-bottom for 16:9 widescreen users before choose zoom:1. Requesting to stretch to the screen with distortion by leaving out the zoom parameter is usually better in this case.

When an image is problematic both in zoomed and distorted mode then you can use &#39;zoom:-1&#39; which will zoom out until the whole image fit into the screen, but this leave black bars at the top and bottom if the image is too wide or at the sides if too narrow, so this should be the last resort.



Credits:

Thanks for all authors of included images for the hard works and given permissions.

The list of authors and sources are in the script.js files in HD image packs.


Instructions:

Do not unzip the .oxz file, just move into the AddOns folder of your Oolite installation.

License:

This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike License version 4.0.
If you are re-using any piece of this OXP, please let me know by sending an e-mail to norbylite@gmail.com.


Changelog:
 2015.06.08. v1.0  First release.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/hdbg.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name	= &quot;hdbg&quot;;
this.author	= &quot;Norby&quot;;
this.copyright	= &quot;2015 Norby&quot;;
this.description= &quot;HD Backgrounds on Arrival Reports&quot;;
this.licence	= &quot;CC BY-NC-SA 4.0&quot;;

this.$Roles = []; //fill in scripts of image packs after the 0. image of unknown stations
this.$R = [{ role:&quot;unknown&quot;, file:&quot;Dead_End_Final_by_Kheng_Teoh.png&quot;, x:1024, y:768, zoom:1,
		author:&quot;Kheng Teoh&quot;, title:&quot;Dead End&quot;,
		license:&quot;no problem as long as you use cite the source&quot;,
		source:&quot;http://kheng.deviantart.com/art/Dead-End-Final-9278839&quot;
	}];
	
//worldscript events
this.startUp = function() {
	var w = worldScripts.hdbg;
	if( w ) w.$AddRoles(this.$R);
}

this.guiScreenChanged = function(to, from) {
	var ps = player.ship;
	if( ps.docked &amp;&amp; from == &quot;GUI_SCREEN_REPORT&quot; ) ps.hudHidden = false; //restore HUD
	if( !ps.docked || to != &quot;GUI_SCREEN_REPORT&quot; &amp;&amp; to != &quot;GUI_SCREEN_MISSION&quot; ) return;

	var id = -1;
	if( mission &amp;&amp; mission.screenID &amp;&amp; mission.screenID.indexOf(&quot;hdbg-&quot;) == 0 ) {
		//mission screen requested a HD background?
		var m = mission.screenID;
		if( m == &quot;hdbg-station&quot; ) id = 0; //select image of the station below
		else for( var i = 0; i &lt; len; i++ ) {
			var r = this.$Roles[i];
			if( r &amp;&amp; r.role &amp;&amp; &quot;hdbg-&quot;+r.role == m ) { //like hdbg-coriolis
				id = i; //found station role
				i = len; //exit from for cycle
			}
		}
	}
	if( to == &quot;GUI_SCREEN_MISSION&quot; &amp;&amp; id == -1 ) return; //no supported screenID

	if( id &lt; 0 ) id = 0; //0. item in $ID is &quot;unknown&quot;
	if( id == 0 ) { //arrival report or unspecified missionscreen with HD background
		var s = ps.dockedStation;
		var len = this.$Roles.length;
		if( s &amp;&amp; s.hasRole ) for( var i = 0; i &lt; len; i++ ) {
			var r = this.$Roles[i];
			if( r &amp;&amp; r.role &amp;&amp; s.hasRole( r.role ) ) {
				id = i; //found station role
				i = len; //exit from for cycle
			}
		}
	}

	var p = this.$Roles[id];
	if( !this.$SetHDBG( p.file, p.x, p.y, p.zoom ) ) { //show in the real size in fullHD
		var q = this.$Roles[0];  //fallback to the 0. image (defined above)
		this.$SetHDBG( q.file, q.x, q.y, q.zoom );
	}
	if( to == &quot;GUI_SCREEN_REPORT&quot; ) ps.hudHidden = true; //hide HUD for HD images
}

//HDBG functions
this.$AddRoles = function(roles) { //called by image packs, roles must be an array!
	var h = worldScripts.hdbg;
	var w = worldScripts.XenonUI;
	if( roles &amp;&amp; roles.length ) for( var i = 0; i &lt; roles.length; i++ ) {
		var ri = roles[i];
		var ro = ri.role;
		if( ro &amp;&amp; ri.file ) { //at least role and filename is needed
			h.$Roles.push(ri);
			if (w) w.$addMissionScreenException(&quot;hdbg-&quot;+ro);
		}
	}
}

this.$SetHDBG = function(pic, x, y, zoom) {  //show pic in real size in fullHD
	var he = 480;
	var wi = 0;
	
	//determine screen ratio
	var o = oolite.gameSettings.gameWindow;
//	if(o.width &gt; 1.55 * o.height &amp;&amp; o.width &lt; 1.75 * o.height) {
		//todo in 16:10
//	}
	var r = o.width / o.height; //screen ratio, 1.6 mean 16:10
	if( x &gt; 0 &amp;&amp; y &gt; 0 ) { //can stretch only if image sizes are given
		if( x / y &lt; r ) { //image is narrower than the screen
			if( zoom &lt; 0 ) wi = 0; //zoom out, fit height and leave black side bars
			else {
				if( zoom &gt; 0 ) he = 0; //zoom (fit width, crop at top and bottom)
				wi = r * 480; //or stretch horizontally without zoom,
			}
			//for example a 4:3 image in 16:9 screen will be stretched
		} else if( zoom &lt; 0 ) { //image is wider than the screen
			//zoom out, fit width and leave black bars at top and bottom
			he = 0;
			wi = r * 480; 
		} else {  //zoom (fit height, crop at sides)
			if( !zoom ) wi = r * 480; //shrink horizontally if no zoom and too wide
			//for example a 16:9 image in 4:3 screen will be shrinked
		}
	} //without image sizes fit to the height, crop if too wide or leave black bars if narrow
	
//	log(this.name, &quot;setHDBG &quot;+pic+&quot; &quot;+x+&quot;x&quot;+y+&quot; wid:&quot;+wid);
	if( wi == 0 &amp;&amp; he &gt; 0 ) 
		return( setScreenBackground({ name: pic, height: he }) );
	else if( wi &gt; 0 &amp;&amp; he == 0 ) 
		return( setScreenBackground({ name: pic, width: wi }) );
	else return( setScreenBackground({ name: pic, height: he , width: wi }) );
}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
