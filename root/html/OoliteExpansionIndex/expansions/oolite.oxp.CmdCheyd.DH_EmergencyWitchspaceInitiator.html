<html>
    <head>
        <title>Expansion Deep Horizon Emergency Witchspace Initiator</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Deep Horizon Emergency Witchspace Initiator</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">6 Equipment</a></li>
          <li><a href="#ships">1 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">3 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds a prime-able piece of equipment that improves the countdown time required to initiate a hyperspace (or witchspace) jump, but at a cost.</td>
                    <td>Adds a prime-able piece of equipment that improves the countdown time required to initiate a hyperspace (or witchspace) jump, but at a cost.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.CmdCheyd.DH_EmergencyWitchspaceInitiator</td>
                    <td>oolite.oxp.CmdCheyd.DH_EmergencyWitchspaceInitiator</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Deep Horizon Emergency Witchspace Initiator</td>
                    <td>Deep Horizon Emergency Witchspace Initiator</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Cmd. Cheyd</td>
                    <td>Cmd. Cheyd</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.0.1</td>
                    <td>1.0.1</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://aegidian.org/bb/viewtopic.php?f=4&amp;t=13526">http://aegidian.org/bb/viewtopic.php?f=4&amp;t=13526</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/2/27/Deep_Horizon_Emergency_Witchspace_Initiator.oxz">https://wiki.alioth.net/img_auth.php/2/27/Deep_Horizon_Emergency_Witchspace_Initiator.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-ND 3.0</td>
                    <td>CC-BY-NC-ND 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1626941301</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Deep%20Horizon%20Emergency%20Witchspace%20Initiator'>http://wiki.alioth.net/index.php/Deep%20Horizon%20Emergency%20Witchspace%20Initiator</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DHI_ASATRU.html">Akai Stella Automated Transport Routing Unit</a></td>
                    <td>no</td>
                    <td align="right">7184</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DHI_DRUID.html">Dynamic Response Uridium Injection Dilator</a></td>
                    <td>no</td>
                    <td align="right">9190</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DHI_PAGAN.html">Proton Anti-Gaussing Anisotropy Neutraliser</a></td>
                    <td>no</td>
                    <td align="right">8346</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DHI_SHAMAN.html">Std. Heisenberg Atemporal Muon-Ambiplasma Navigation</a></td>
                    <td>no</td>
                    <td align="right">3162</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DHI_WICCA.html">Witchspace Initiator Chromo-Channel Accelerator</a></td>
                    <td>no</td>
                    <td align="right">2574</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_EMERGENCY_JUMP_INITIATOR.html">Emergency Witchspace Initiator</a></td>
                    <td>yes</td>
                    <td align="right">91360</td>
                    <td align="center">10+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/DHI_EWI_Jumper.html">DHI_EWI_Jumper</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/DHI_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;DHI_Conditions&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2017 phkb&quot;;
this.description = &quot;Condition script for the specialised equipment&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;

//-------------------------------------------------------------------------------------------------------------
this.allowAwardEquipment = function(equipment, ship, context) {
	if (context != &quot;scripted&quot;) return false;
	return true
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/Deep_Horizon_Emergency_Witchspace_Initiator_Equipment.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Deep_Horizon_Emer_Jump_Initiator_Equipment&quot;;
this.author	= &quot;Cmd. Cheyd (Blake Deakins)&quot;;
this.description = &quot;Adds a prime-able piece of equipment that drastically reduces the countdown time required to initiate a hyperspace (or witchspace) jump.&quot;;
this.version = &quot;1.0.0&quot;;
this.copyright = &quot;� Creative Commons Attribution-Noncommercial-No Derivative Works 3.0 United States license (Modified)&quot;;


//*************************************************************************************************************
//************************************           Event Functions           ************************************
//*************************************************************************************************************

this.activated = function () {
	worldScripts[&quot;Deep_Horizon_Emer_Jump_Initiator&quot;]._ewiActivated();
	}


this.equipmentDestroyed = this.equipmentDamanged = function (equipment) {
	//if the equipment damaged WAS the EWI, and a Jump Calc is running, and it was triggered by the EWI- Cancel the jump
	if (equipment == &quot;EQ_EMERGENCY_JUMP_INITIATOR&quot; &amp;&amp; worldScripts[&quot;Deep_Horizon_Emer_Jump_Initiator&quot;].$usedEWI &amp;&amp; player.ship.status == &quot;STATUS_WITCHSPACE_COUNTDOWN&quot;) {
		worldScripts[&quot;Deep_Horizon_Emer_Jump_Initiator&quot;].playerCancelledJumpCountdown();
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/Deep_Horizon_Emergency_Witchspace_Initiator_World.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Deep_Horizon_Emer_Jump_Initiator&quot;;
this.author	= &quot;Cmd. Cheyd (Blake Deakins)&quot;;
this.description = &quot;Adds a prime-able piece of equipment that drastically reduces the countdown time required to initiate a hyperspace (or witchspace) jump.&quot;;
this.version = &quot;1.0.0&quot;;
this.copyright = &quot;� Creative Commons Attribution-Noncommercial-No Derivative Works 3.0 United States license (Modified)&quot;;

//*************************************************************************************************************
//************************************         Variable Declaration        ************************************
//*************************************************************************************************************
this.$jumpDistance = 0;						// Distance to be jumped
this.$usedEWI = false;						// Flag for whether EWI was used on this jump
this.$repairMisjumpAnalyzer = false;		// Does the EWI need to repair the MisjumpAnalyzer after jump completion? 
this.$repairMisjumpInducer = false;			// Does the EWI need to repair the MisjumpInducer after jump completion?
this.$fuelLeak = false;						// Flag for determining if a fuel leak has transpired
this.$damageWitchspaceDriveUnit = false;	// Flag for determining if the engine was damaged due to shortened spin-up time
this.$notInKansasAnymore = false;			// Flag for determining if player should be sent to an alternative system.


//*************************************************************************************************************
//************************************           Event Functions           ************************************
//*************************************************************************************************************
this.shipWillLaunchFromStation = function () {
	this.gasGuzzler = false;		// Reset fuel waste flag
	this.$somethingWickedThisWayComes = false;
}

this.shipWillEnterWitchspace = function(cause) {
	if (cause == &quot;wormhole&quot; &amp;&amp; !this.$notInKansasAnymore) {
		this.playerCancelledJumpCountdown();
		return;
	} else if (cause ==&quot;standard jump&quot; &amp;&amp; this.$usedEWI) {
		// Calculate distance about to be jumped.  Use this after the jump for fuel waste calculations
		this.$jumpDistance = Number(System.infoForSystem(galaxyNumber,system.ID).distanceToSystem(System.infoForSystem(galaxyNumber,player.ship.targetSystem)).toFixed(1));
	}
}

this.shipExitedWitchspace = function() {
	// If the EWI was used:
	if (!this.$usedEWI) return;
		// Reset EWI Usage Flag
	this.$usedEWI = false;
	// If flag for fuel waste is set:
	if (this.gasGuzzler) {
		// Calculate the amount of fuel that was wasted
		var fuelWasted = Number((this.$jumpDistance*0.1).toFixed(1));
		if (fuelWasted &lt; 0.1) fuelWasted === 0.1;
		// Inform player of fuel expenditure
		if (fuelWasted &gt; player.ship.fuel) {
			player.consoleMessage(&quot;All internal fuel reserves expended during emergency jump.&quot;, 4);
		} else {
			player.consoleMessage(&quot;Additional fuel expended due to inefficient routing: &quot; + fuelWasted + &quot; LY.&quot;, 4);
		}
		// Subtract wasted fuel from player
		player.ship.fuel -= fuelWasted;
		// Reset fuel-waste flag
		this.gasGuzzler = false;
	} else if (this.$fuelLeak) {
		// Initiate a fuel leak
		player.consoleMessage(&quot;WARNING!  Stress from short spin-time jump has caused a quirium fuel leak!&quot;, 4);
		player.ship.fuelLeakRate = 0.5;
		this.$fuelLeak = false;
	} else if (this.$damageWitchspaceDriveUnit) {
		// Simulate some sort of engine damage...?
		this._selectDamagedDriveComponent();
		this.$damageWitchspaceDriveUnit = false;
	} else if (this.$notInKansasAnymore) {
		player.commsMessage (&quot;Navigation Failure - Witchspace jump initiated before navigation calculations were complete.&quot;,4);
		this.$notInKansasAnymore = false;
	}
	if (this.$repairMisjumpAnalyzer) {
		// Restore the Misjump Analyzer
		player.ship.setEquipmentStatus(EquipmentInfo.infoForKey(&quot;EQ_MISJUMP_ANALYSER&quot;),&quot;EQUIPMENT_OK&quot;);
		this.$repairMisjumpAnalyzer = false;
	}
	if (this.$repairMisjumpInducer) {
		// Restore the Misjump Inducer
		player.ship.setEquipmentStatus(EquipmentInfo.infoForKey(&quot;EQ_MISJUMPER&quot;),&quot;EQUIPMENT_OK&quot;);
		this.$repairMisjumpInducer = false;
	}
	if (this.$jumpTimer) {
		this.$jumpTimer.stop();
		delete this.$jumpTimer;
	}
	this.$somethingWickedThisWayComes = false;
}

this.playerStartedJumpCountdown = function(type, seconds) {
	if (type == &quot;galactic&quot; &amp;&amp; this.$usedEWI) {
		player.consoleMessage (&quot;Galactic drive startup detected.  Shutting down Emergency Witchspace Initiator.&quot;, 3);
		this.playerCancelledJumpCountdown();
	}
	if ((player.ship.equipmentStatus(&quot;EQ_DHI_WICCA&quot;) === &quot;EQUIPMENT_DAMAGED&quot; || player.ship.equipmentStatus(&quot;EQ_DHI_ASATRU&quot;) === &quot;EQUIPMENT_DAMAGED&quot; || player.ship.equipmentStatus(&quot;EQ_DHI_DRUID&quot;) === &quot;EQUIPMENT_DAMAGED&quot; || player.ship.equipmentStatus(&quot;EQ_DHI_SHAMAN&quot;) === &quot;EQUIPMENT_DAMAGED&quot; || player.ship.equipmentStatus(&quot;EQ_DHI_PAGAN&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) &amp;&amp; type == &quot;standard&quot;) {
		if (worldScripts[&quot;Deep_Horizon_Adv_Nav_Comp&quot;]) {
			if (worldScripts[&quot;Deep_Horizon_Adv_Nav_Comp&quot;].usedANC) {
				player.consoleMessage (&quot;The Advance Navigation Computer has detected a failed drive component.  Calculations aborted.&quot;);
				worldScripts[&quot;Deep_Horizon_Adv_Nav_Comp&quot;]._cancelANC (false);
				this.$usedEWI = false;
				return;
			}
		}
		if (this.$usedEWI) {
			player.consoleMessage (&quot;Drive component is damaged.  Emergency jump initiation aborted.&quot;);
			player.ship.cancelHyperspaceCountdown();
			this.$usedEWI = false;
			return;
		} else {
			player.consoleMessage (&quot;Witchspace drive component is damaged.  Jump initiation failed.&quot;);
			player.ship.cancelHyperspaceCountdown();
			this.$usedEWI = false;
			return;
		}
	}
	if (this.$somethingWickedThisWayComes) this._selectAccidentType();
	if (this.$notInKansasAnymore) {
		this._selectAlternateWormholeDestination();
		var spin_time = player.ship.hyperspaceSpinTime;
		if (spin_time &lt; 5 || spin_time &gt; 60) spin_time = 15; 
		var delay = (Math.floor(spin_time*0.5)-0.25);
		this.$jumpTimer = new Timer(this,this._spawnAltJumper,delay,0);
	}
}

this.playerCancelledJumpCountdown = function() {
	// Was EWI used to initiate the jump?
	if (this.$usedEWI) {
		// Reset EWI Usage Flag
		this.$usedEWI = false;
		this.gasGuzzler = false;
		this.$fuelLeak = false;
		this.$damageWitchspaceDriveUnit = false;
		this.$notInKansasAnymore = false;
		player.ship.scriptedMisjump = 0;
		if (this.$jumpTimer) {
			this.$jumpTimer.stop();
			delete this.$jumpTimer;
		}
	}
}

this.playerJumpFailed = function(reason) {
	// Reset EWI Usage Flag
	this.$usedEWI = false;
	this.gasGuzzler = false;
	this.$fuelLeak = false;
	this.$damageWitchspaceDriveUnit = false;
	this.$notInKansasAnymore = false;
	player.ship.scriptedMisjump = 0;
	if (this.$jumpTimer) {
		this.$jumpTimer.stop();
		delete this.$jumpTimer;
	}
}

this.equipmentRepaired = function(equipment) {
	if (equipment == &quot;EQ_DHI_WICCA&quot; || equipment == &quot;EQ_DHI_ASATRU&quot; || equipment == &quot;EQ_DRUID&quot; || equipment == &quot;EQ_SHAMAN&quot; || equipment == &quot;EQ_PAGAN&quot;) {
		player.ship.removeEquipment(equipment);
		EquipmentInfo.infoForKey(equipment).effectiveTechLevel = 99;
	}
}


//*************************************************************************************************************
//************************************            OXP Functions            ************************************
//*************************************************************************************************************
this._ewiActivated = function() {
	if (!player.ship.targetSystem || player.ship.targetSystem == system.ID) {
		player.consoleMessage(&quot;Local System selected.  Emergency jump intiation impossible.  Shutting down.&quot;, 4);
		return;
	}
	if (System.infoForSystem(galaxyNumber,system.ID).distanceToSystem(System.infoForSystem(galaxyNumber,player.ship.targetSystem)) &gt; player.ship.fuel ){
		player.consoleMessage(&quot;Insufficient fuel to reach destination system.  Navigation calculations unnecessary.  Shutting down.&quot;, 4);
		return;
	}
	if (player.ship.status == &quot;STATUS_WITCHSPACE_COUNTDOWN&quot;) {
		//Determine if jump was EWI-initiated, ANC-initiated, or Standard
		if (this.$usedEWI) {
			//Player had prior EWI Countdown Running
			player.consoleMessage(&quot;Emergency Witchspace Initiation aborted by pilot.&quot;, 4);
			player.ship.cancelHyperspaceCountdown();
			this.$usedEWI = false;
			return;  //Return so as not to reinitiate the EWI jump
		} else if (worldScripts[&quot;Deep_Horizon_Adv_Nav_Comp&quot;]) {
			// Does player have the ANC OXP?
			if (worldScripts[&quot;Deep_Horizon_Adv_Nav_Comp&quot;].usedANC == true) {
				//Player had ANC script running
				worldScripts[&quot;Deep_Horizon_Adv_Nav_Comp&quot;]._cancelANC (false);
				player.consoleMessage(&quot;Emergency witchspace jump initiated by pilot.&quot;, 4);
				// Do not RETURN so EWI initiates after current-jump is cancelled.
			} else {
				//Player had a standard jump or an otherwise-initiated jump downdown running
				player.ship.cancelHyperspaceCountdown();
				player.consoleMessage(&quot;Standard witchspace jump initiation procedure aborted.&quot;, 4);
				// Do not RETURN so EWI initiates after current-jump is cancelled.
			}
		} else {
			//Player had a standard jump or an otherwise-initiated jump downdown running
			player.ship.cancelHyperspaceCountdown();
			player.consoleMessage(&quot;Standard witchspace jump initiation procedure aborted.&quot;, 4);
			// Do not RETURN so EWI initiates after current-jump is cancelled.
		}
	} else if (worldScripts[&quot;Deep_Horizon_Adv_Nav_Comp&quot;]) {
			// Does player have the ANC OXP?
			if (worldScripts[&quot;Deep_Horizon_Adv_Nav_Comp&quot;].usedANC == true) {
				//Player had ANC script running
				worldScripts[&quot;Deep_Horizon_Adv_Nav_Comp&quot;]._cancelANC (false);
				player.consoleMessage(&quot;Emergency witchspace Jump initiated by pilot.&quot;, 4);
				// Do not RETURN so EWI initiates after current-jump is cancelled.
			} 
		}
	player.consoleMessage(&quot;Initiating emergency jump to &quot; + System.systemNameForID(player.ship.targetSystem) + &quot;.&quot;, 4);

	//disable misjump analyzer
	if (player.ship.equipmentStatus(&quot;EQ_MISJUMP_ANALYSER&quot;) == &quot;EQUIPMENT_OK&quot;) {
		player.ship.setEquipmentStatus(EquipmentInfo.infoForKey(&quot;EQ_MISJUMP_ANALYSER&quot;),&quot;EQUIPMENT_DAMAGED&quot;);
		this.$repairMisjumpAnalyzer = true;
	}
	
	//disable misjump inducer
	if (player.ship.equipmentStatus(&quot;EQ_MISJUMPER&quot;) == &quot;EQUIPMENT_OK&quot;) {
		player.ship.setEquipmentStatus(EquipmentInfo.infoForKey(&quot;EQ_MISJUMPER&quot;),&quot;EQUIPMENT_DAMAGED&quot;);
		this.$repairMisjumpInducer = true;
	}
	//determine if any negative effects will happen from the jump
	this.$chance = Math.round(Math.random()*100);		// this is the chance that something bad happened
	this.$chanceOccurring = Math.ceil(100-player.ship.serviceLevel+(Math.ceil(player.ship.hyperspaceSpinTime*0.75)));		//this provides a variable ceiling-based value that something COULD have happened
	if (this.$chanceOccurring &lt; this.$chance) {
		this.$somethingWickedThisWayComes = false;
	} else {
		this.$somethingWickedThisWayComes = true;
	}

	player.ship.beginHyperspaceCountdown(Math.floor(player.ship.hyperspaceSpinTime*0.5));
	this.$usedEWI = true;
}

this._selectAccidentType = function () {
	//determine WHICH negative effect will occur
	if (!this.$somethingWickedThisWayComes) return;
	this.$badThing = Math.floor(Math.random()*100);
	this.$badThing = 90;
	if ((this.$badThing &gt;= 51) &amp;&amp; (this.$badThing &lt;= 70)) {
		// Between 51 and 70 == Fuel Waste
		if ((Number(Number(System.infoForSystem(galaxyNumber,system.ID).distanceToSystem(System.infoForSystem(galaxyNumber,player.ship.targetSystem)).toFixed(1))*1.1).toFixed(1)) &gt; player.ship.fuel) {
			this._selectAccidentType();
			return;
		} else {
			this.gasGuzzler = true;
			player.ship.scriptedMisjump = 0;
		}
	} else if ((this.$badThing &gt;= 71) &amp;&amp; (this.$badThing &lt;= 84)) {
		// Between 71 and 84 == Fuel Leak
		this.$fuelLeak = true;
		player.ship.scriptedMisjump = 0;
	} else if ((this.$badThing &gt;= 85) &amp;&amp; (this.$badThing &lt;= 95)) {
		// Between 85 and 95 == Engine Damage
		this.$damageWitchspaceDriveUnit = true;
		player.ship.scriptedMisjump = 0;
	} else if ((this.$badThing &gt;= 96) &amp;&amp; (this.$badThing &lt;= 100)) {
		// Between 96 and 100 == Witchspace to the wrong destination system
		this.$notInKansasAnymore = true;
	} else {
		// Between 0 and 50 == Misjump
		player.ship.scriptedMisjump = 1;
	}
}

this._selectDamagedDriveComponent = function() {
		//Award a &#39;broken&#39; piece of engine equipment.
		var gear_damaged = Number(Math.floor(Math.random()*5).toFixed(0));
		switch (gear_damaged) {
			case 0: 				//Award EQ_DHI_WICCA
				this._awardDamagedDriveComponent(&quot;EQ_DHI_WICCA&quot;);
				break;
			case 1:					//Award EQ_DHI_ASATRU
				this._awardDamagedDriveComponent(&quot;EQ_DHI_ASATRU&quot;);
				break;
			case 2:					//Award EQ_DHI_DRUID
				this._awardDamagedDriveComponent(&quot;EQ_DHI_DRUID&quot;);
				break;
			case 3:					//Award EQ_DHI_SHAMAN
				this._awardDamagedDriveComponent(&quot;EQ_DHI_SHAMAN&quot;);
				break;
			case 4:					//Award EQ_DHI_PAGAN
				this._awardDamagedDriveComponent(&quot;EQ_DHI_PAGAN&quot;);
				break;
			default:				//Award EQ_DHI_PAGAN
				this._awardDamagedDriveComponent(&quot;EQ_DHI_PAGAN&quot;);
		}
}

this._awardDamagedDriveComponent = function (equipment) {
	if (player.ship.canAwardEquipment(equipment)) {
		player.ship.awardEquipment(equipment);
		player.ship.setEquipmentStatus(equipment,&quot;EQUIPMENT_DAMAGED&quot;);
		EquipmentInfo.infoForKey(equipment).effectiveTechLevel = 0;
		player.commsMessage (&quot;A component of the witchspace drive unit was damaged by short spin-time jump.&quot;,4);
	}
	else {
		this._selectDamagedDriveComponent();
	}
}

this._selectAlternateWormholeDestination = function () {
	if (!this.$notInKansasAnymore) return;
	// Select an alternative system within fuel-range and change player target to that system.
	this.$alternativeTargetSystems = new Array ();
	// Build array of systems within fuel range
	this.$alternativeTargetSystems = System.infoForSystem(galaxyNumber,system.ID).systemsInRange(player.ship.fuel);
	// If no other systems are available, select a new accident type
	if (this.$alternativeTargetSystems.length &lt;= 2) return;
	else {
		//Delete the current player target system from the array, select a new random destination from the remaining choices, and assign it
		// Remove the player&#39;s current target system from the list of available options.
		this.$alternativeTargetSystems.splice(this.$alternativeTargetSystems.indexOf(&quot;SystemInfo galaxy &quot;+ galaxyNumber +&quot;, system &quot;+ player.ship.targetSystem),1);
		// Generate a random number between 0 and the end of the array
		this.$alternativeSelection = Math.floor(Math.random()*this.$alternativeTargetSystems.length);
		// Set jump-creator targetSystem to the systemID for the array member in position X
		this.$alternateDestination = this.$alternativeTargetSystems[this.$alternativeSelection].systemID
	}
}

this._spawnAltJumper = function () {
	this.$playerFuel = player.ship.fuel;
	this.$playerFuel -= System.infoForSystem(galaxyNumber,system.ID).distanceToSystem(System.infoForSystem(galaxyNumber,this.$alternateDestination));
	if (this.$playerFuel &gt;= 0) {
		player.ship.cancelHyperspaceCountdown();
		var jumper = system.addShips(&quot;DHI_Alt_jumper&quot;,1,player.ship.position.add(player.ship.vectorForward.multiply(player.ship.collisionRadius+100)),0)[0];
		if (jumper.exitSystem(this.$alternateDestination)) {
			this._soundSource = new SoundSource;
			this._soundSource.sound = &quot;[witchdrive-malfunction]&quot;;
			this._soundSource.play();
			this._soundSource.loop = false;
			player.ship.fuel = this.$playerFuel;
			player.ship.position = jumper.position;
			player.ship.velocity = [0,0,0];
		}
		jumper.remove(true);
	}
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
