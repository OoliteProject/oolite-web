<html>
    <head>
        <title>Expansion Flight Log</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Flight Log</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER E)(&#39;[]&#39; vs &#39;[equipment]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds a simple log of the last 100 systems visited in the current galaxy (latest 10 viewable in-game), which can be dumped out to latest.log. Your kills and profit/loss made whilst in-system are also logged.</td>
                    <td>Adds a simple log of the last 100 systems visited in the current galaxy (latest 10 viewable in-game), which can be dumped out to latest.log. Your kills and profit/loss made whilst in-system are also logged.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.FlightLog</td>
                    <td>oolite.oxp.Thargoid.FlightLog</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Flight Log</td>
                    <td>Flight Log</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.11</td>
                    <td>1.11</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>equipment</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Flight_Log_OXP">http://wiki.alioth.net/index.php/Flight_Log_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/1/19/FlightLog.oxz">https://wiki.alioth.net/img_auth.php/1/19/FlightLog.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873240</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Flight%20Log'>http://wiki.alioth.net/index.php/Flight%20Log</a></p>
        <h3>Flight Log ReadMe &amp; License.txt</h3>
        <pre>Flight Log OXP by Thargoid.
Updates by phkb (v1.09 and following)

A little OXP by forum request of &quot;Newt_Othis&quot; and others to keep a log of the last 100 systems visited by witchspace (including interstellar space). In-game, a list of the most recent 10 of those systems visited can be accessed by going either to the ship&#39;s interface screen (F4 whilst docked) or whilst in flight via the manifest screen (F5-F5) and from there on to the short range chart screen (F6).

The list holds the last 100 systems visited plus the current one is also noted. It also records the number of kills made whilst in the system and the net credit balance change whilst there (profit and loss, with losses being negative obviously). If the list contains at least one visited system, it can also be dumped out to the latest.log file from this screen (this will dump out the full log, up to 100 entries long).

Requires v1.79 or later of Oolite. It will not run on older versions.

--------------------------------------------------------------

License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement. Basically if it&#39;s unique or would identify or overwrite anything in the original OXP, then you may not re-use it (for obvious compatibility reasons).
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* The license information (either as this file or merged into a larger one) must be included in the OXP.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)

Image from http://simpleicon.com/note_book.html.

--------------------------------------------------------------

Instructions:


For those who have downloaded the OXP version, unzip the file, and then move the folder &quot;Flight Log 1.08.oxp&quot; to the AddOns directory of your Oolite installation. Then start the game up and the ships should be added. 

The OXZ version downloaded via the Expansion manager should be installed and operational directly. For a manual download, move the .oxz folder to the addons directory and restart the game.

--------------------------------------------------------------

Version history:

31/08/2010 - Version 1.00, initial release.
03/09/2010 - Version 1.01, amended scripting to better trim the log after reports of problems on some systems.
24/01/2011 - Version 1.02, added kill count and credit level change per system to log, and also corrected minor capitalisation item.
13/02/2011 - Version 1.03, removal of upper limit, to allow running with 1.75
15/09/2012 - Version 1.04, script tweak to add the flight log to the F4 menu on Oolite 1.77 or higher
16/09/2012 - Version 1.05, add a shipped dock check that was omitted accidentally in v1.04
24/01/2013 - Version 1.06, removed the F5-F5-F6 route when docked (F4 only now), and up&#39;d the minimum Oolite to 1.77
11/02/2014 - Version 1.07, expand the storage to 100 systems, with just the last 10 being displayed in-game.
07/08/2014 - Version 1.08, script adjusted to run on startUpComplete rather than startUp, to allow for non-main station saves.
08/12/2014 - Version 1.09, exiting log now returns to system interfaces screen
			   added &quot;use strict&quot; to script file
			   added a screenID parameter to the mission.runScreen functions.
			   removed access to full log inflight (no longer recommended in 1.81), added item to manifest screen instead
27/02/2015 - Version 1.10, fixed bug where kills in system with ID 0 were not showing up on the log.
17/12/2015 - Version 1.11, small code cleanup items, added overlay background image.
                           Updated screenID&#39;s to enable BGS background sounds.
--------------------------------------------------------------

Acknowledgements:

With thanks to Newt_Othis for the original inspiration and Switeck for the bug report on the length trimming problem. Idea for adding kills and credits from UK_Eliter and others.

And thanks to Ironfist for the bug report on the 1.04 missing docked check.

Thanks to Neelix for the heads-up about the non-main station save glitch and the fix recommendation.</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name					= &quot;FlightLog&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Saves a list of systems visited, plus the kills and profit for each&quot;;
this.version				= &quot;1.11&quot;;

this.startUpComplete = function()
	{
	this.maxLogLength = 100; // the max size of the log - minimum size should be 10 (the latest 10 are displayed in-game).
	this.blankArray = &quot;&quot;;
	let setupCounter = 0; // reset the counter
	for(setupCounter = 0; setupCounter &lt; this.maxLogLength; setupCounter++)
		{ this.blankArray = this.blankArray + &quot;0:&quot;;	}
	this.blankArray = this.blankArray.substr(0, (this.blankArray.length - 1 )); // snip off the last :

	if(!missionVariables.flightLogMemory)
		{ // if this is the first run of the OXP
		missionVariables.flightLogMemory = this.blankArray;
		missionVariables.flightKillsMemory = this.blankArray;
		missionVariables.flightCreditsMemory = this.blankArray;
		missionVariables.flightKillsStore = player.score;
		missionVariables.flightCreditsStore = player.credits;
		}

	this.flightArray = missionVariables.flightLogMemory.split(&quot;:&quot;);
	this.killsArray = missionVariables.flightKillsMemory.split(&quot;:&quot;);
	this.creditsArray = missionVariables.flightCreditsMemory.split(&quot;:&quot;);

	this.baseKills = missionVariables.flightKillsStore;
	this.baseCredits = missionVariables.flightCreditsStore;

	if(this.flightArray.length !== this.maxLogLength) // just in case this.maxLogLength has been changed since last run.
		{
		let setupCounter = 0; // reset the counter
		for(setupCounter = this.flightArray.length; setupCounter &lt; this.maxLogLength; setupCounter++)
			{ // this loop will run if the array is smaller than the max log size
			this.flightArray[setupCounter] = &quot;0&quot;;
			this.killsArray[setupCounter] = &quot;0&quot;;
			this.creditsArray[setupCounter] = &quot;0&quot;;
			}
		this.$trimArrays(); // this will trim things down if the array is larger than the max log size
		}

	let setupCounter = 0; // reset the counter
	for(setupCounter = 0;setupCounter &lt; this.flightArray.length;setupCounter++)
		{
		this.flightArray[setupCounter] *= 1; // to swap values from string to number
		this.killsArray[setupCounter] *= 1;
		this.creditsArray[setupCounter] *= 1;
		}
	this.$dockedCheck();
	}

this.shipDockedWithStation = function()
	{
	this.$dockedCheck();
	this.playerWillSaveGame();
	}

this.playerWillSaveGame = function()
	{
	missionVariables.flightKillsStore = this.baseKills;
	missionVariables.flightCreditsStore = this.baseCredits;
	}

this.$dockedCheck = function()
	{
	if (player.ship.docked)
		{
		player.ship.dockedStation.setInterface(&quot;FlightLog&quot;,
			{ title: &quot;Flight log&quot;,
			category: &quot;Logs&quot;,
			summary: &quot;Displays the ships flight log.&quot;,
			callback: this.$showLog.bind(this) });
		}
	}

this.guiScreenChanged = function(to, from)
	{
	if(from == &quot;GUI_SCREEN_MARKET&quot; || from == &quot;GUI_SCREEN_EQUIP_SHIP&quot; || from == &quot;GUI_SCREEN_SHIPYARD&quot; || from == &quot;GUI_SCREEN_STATUS&quot;)
		{ //  refresh the mission variables if we come from market/equipment/shipyard or status screens
		this.playerWillSaveGame();
		}

	// showing mission screen during flight is no longer recommended
	//if(player.ship.docked || to != &quot;GUI_SCREEN_SHORT_RANGE_CHART&quot; || from != &quot;GUI_SCREEN_MANIFEST&quot;)
	//	{ // access main screen only from manifest to short range chart when in flight (via F4 when docked)
	//	return;
	//	}
	//this.$showLog();
	}

this.guiScreenWillChange = function (to, from) {
	if (to === &quot;GUI_SCREEN_MANIFEST&quot;) {
		if (!player.ship.docked) {
			if(system.ID == -1) {
				mission.setInstructions(&quot;You are currently in interstellar space (&quot; + (player.score - this.baseKills) + &quot; kills, &quot; + (Math.floor(10 * (player.credits - this.baseCredits)) / 10) + &quot;cr).&quot;, this.name);
			} else {
				mission.setInstructions(&quot;You are currently in the &quot; + system.name + &quot; system in galaxy &quot; + (galaxyNumber + 1) + &quot; (&quot; + (player.score - this.baseKills) + &quot; kills, &quot; + (Math.floor(10 * (player.credits - this.baseCredits)) / 10) + &quot;cr).&quot;, this.name);
			}
		} else {
			mission.setInstructions(null, this.name);
		}
	}
}

this.$showLog = function() {
	if(this.flightArray[this.flightArray.length - 1] == 0) {// if the last entry is 0, then assume the array is blank (all zero)
		mission.runScreen({screenID:&quot;oolite-flightlog-main-map&quot;, title:&quot;Flight Log&quot;, overlay:{name:&quot;fl-note_book.png&quot;, height:546}, exitScreen:&quot;GUI_SCREEN_INTERFACES&quot;, messageKey:&quot;flightLog_empty&quot;});
		if(system.ID == -1) {
			mission.addMessageText(&quot;\nYou are currently in interstellar space.&quot;);
		} else {
			mission.addMessageText(&quot;\nYou are currently in the &quot; + system.name + &quot; system in galaxy &quot; + (galaxyNumber + 1) + &quot;.&quot;);
		}
		return;
	}

	mission.runScreen({screenID:&quot;oolite-flightlog-main-map&quot;, title:&quot;Flight Log&quot;, messageKey:&quot;flightLog_header&quot;, overlay:{name:&quot;fl-note_book.png&quot;, height:546}, exitScreen:&quot;GUI_SCREEN_INTERFACES&quot;, choicesKey:&quot;flightLog_choices&quot;}, this.$choice);

	this.endPoint = this.flightArray.length;
	this.startPoint = this.endPoint - 10;

	let listCounter = 0; // reset the counter
	for(listCounter = this.startPoint; listCounter &lt; this.endPoint; listCounter++) {
		if(this.flightArray[listCounter] &gt;= 0) {
			mission.addMessageText((this.flightArray.length - listCounter) + &quot; - &quot; + System.systemNameForID(this.flightArray[listCounter]) + &quot;, (&quot; + this.killsArray[listCounter] + &quot; kills,  &quot; + this.creditsArray[listCounter] + &quot;  cr).&quot;);
		}
		if(this.flightArray[listCounter] == -1) {
			mission.addMessageText((this.flightArray.length - listCounter) + &quot; - Interstellar Space, (&quot; + this.killsArray[listCounter] + &quot; kills,  &quot; + this.creditsArray[listCounter] + &quot;  cr).&quot;);
		}
	}

	if(system.ID == -1) {
		mission.addMessageText(&quot;\nYou are currently in interstellar space (&quot; + (player.score - this.baseKills) + &quot; kills, &quot; + (Math.floor(10 * (player.credits - this.baseCredits)) / 10) + &quot;cr).&quot;);
	} else {
		mission.addMessageText(&quot;\nYou are currently in the &quot; + system.name + &quot; system in galaxy &quot; + (galaxyNumber + 1) + &quot; (&quot; + (player.score - this.baseKills) + &quot; kills, &quot; + (Math.floor(10 * (player.credits - this.baseCredits)) / 10) + &quot;cr).&quot;);
	}
}

this.$choice = function(choice)
	{
	switch(choice)
		{
		case &quot;FLIGHTLOG_1_DUMP&quot;:
			{
			player.consoleMessage(&quot;Flight log written to latest.log&quot;, 6);
			log(this.name, &quot;==================================&quot;);
			log(this.name, &quot; &quot;);

			let logCounter = 0 ; // reset the counter
			for(logCounter = 0;logCounter&lt;this.flightArray.length;logCounter++)
				{
				if(this.flightArray[logCounter] &gt;= 0)
					{
					log(this.name, (this.flightArray.length - logCounter) + &quot; - &quot; + System.systemNameForID(this.flightArray[logCounter]) + &quot;, (&quot; + this.killsArray[logCounter] + &quot; kills,  &quot; + this.creditsArray[logCounter] + &quot;cr).&quot;);
					}
				if(this.flightArray[logCounter] == -1)
					{
					log(this.name, (this.flightArray.length - logCounter) + &quot; - Interstellar Space, (&quot; + this.killsArray[logCounter] + &quot; kills,  &quot; + this.creditsArray[logCounter] + &quot;cr).&quot;);
					}
				}
			log(this.name, &quot; &quot;);
			if(system.ID != -1)
				{
				log(this.name, &quot;Current system - &quot; + system.name + &quot; in galaxy &quot; + (galaxyNumber + 1) + &quot;, (&quot; + (player.score - this.baseKills) + &quot; kills, &quot; + (Math.floor(10 * (player.credits - this.baseCredits)) / 10) + &quot;cr).&quot;);
				}
			else
				{
				log(this.name, &quot;Currently in interstellar space, (&quot; + (player.score - this.baseKills) + &quot; kills, &quot; + (Math.floor(10 * (player.credits - this.baseCredits)) / 10) + &quot;cr).&quot;);
				}
			log(this.name, &quot;==================================&quot;);
			break;
			}

		case &quot;FLIGHTLOG_2_RESET&quot;:
			{
			player.consoleMessage(&quot;Flight log cleared.&quot;, 6);
			this.playerEnteredNewGalaxy();
			break;
			}
		}
	}

this.shipWillExitWitchspace = function()
	{
	this.baseKills = player.score;
	this.baseCredits = player.credits;
	}

this.shipWillEnterWitchspace = function(cause)
	{
	this.kills = player.score - this.baseKills;
	this.profit = Math.floor(10 * (player.credits - this.baseCredits)) / 10;
	this.flightArray.push(system.ID);
	this.killsArray.push(this.kills);
	this.creditsArray.push(this.profit);

	this.$trimArrays();

	missionVariables.flightLogMemory = this.flightArray[0];
	missionVariables.flightKillsMemory = this.killsArray[0];
	missionVariables.flightCreditsMemory = this.creditsArray[0];

	let arrayCounter = 1 ; // set the counter
	for(arrayCounter = 1; arrayCounter &lt; this.flightArray.length; arrayCounter++)
		{
		missionVariables.flightLogMemory = missionVariables.flightLogMemory + &quot;:&quot; + this.flightArray[arrayCounter];
		missionVariables.flightKillsMemory = missionVariables.flightKillsMemory + &quot;:&quot; + this.killsArray[arrayCounter];
		missionVariables.flightCreditsMemory = missionVariables.flightCreditsMemory + &quot;:&quot; + this.creditsArray[arrayCounter];
		}
	}

this.$trimArrays = function()
	{ // trim the arrays back to their original lengths by throwing out oldest (first in the array) log entries
	while(this.flightArray.length &gt; this.maxLogLength)
		{ this.discard = this.flightArray.shift(); }

	while(this.killsArray.length &gt; this.maxLogLength)
		{ this.discard = this.killsArray.shift(); }

	while(this.creditsArray.length &gt; this.maxLogLength)
		{ this.discard = this.creditsArray.shift(); }
	}

this.playerEnteredNewGalaxy = function()
	{
	missionVariables.flightLogMemory = this.blankArray;
	missionVariables.flightKillsMemory = this.blankArray;
	missionVariables.flightCreditsMemory = this.blankArray;
	this.startUp();
	}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
