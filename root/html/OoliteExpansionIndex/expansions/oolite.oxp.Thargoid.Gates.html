<html>
    <head>
        <title>Expansion Gates</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Gates</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">5 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">3 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER A)(&#39;[]&#39; vs &#39;[activities, system]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds a pair of jump gates to suitable tech/govt systems, enabling quick and safe transfer by-passing route one. All for only 250Cr per journey.</td>
                    <td>Adds a pair of jump gates to suitable tech/govt systems, enabling quick and safe transfer by-passing route one. All for only 250Cr per journey.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.Gates</td>
                    <td>oolite.oxp.Thargoid.Gates</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Gates</td>
                    <td>Gates</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Activities</td>
                    <td>Activities</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.13</td>
                    <td>1.13</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>activities, system</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Gates_OXP">http://wiki.alioth.net/index.php/Gates_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/d/d0/Gates_1.13.oxz">https://wiki.alioth.net/img_auth.php/d/d0/Gates_1.13.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873477</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Gates'>http://wiki.alioth.net/index.php/Gates</a></p>
        <h3>Gates  v1.13 Readme &amp; License.txt</h3>
        <pre>Gates OXP by Thargoid.

A simple little OXP that will create a pair of jump-gates in higher technology (8+) and stable government (Communist or better) systems. For a small fee of 250 credits per journey, these will take you instantaneously between the area of the system station and the witchpoint.

Originally based on captured alien technology, these have been developed by GalCop initially for military and police usage but are now open to civilian traders and other travellers too. Most gates are of the standard design (known colloquially as the &quot;Spider variant&quot; due to its resemblance to a tarantula), but some older designs (&quot;rose gates&quot;, again from their resemblance to a flower) and even occasional captured and reprogrammed alien jump gates may be found.

--------------------------------------------------------------
Compatibility:

This new version requires Oolite v1.74 or higher. But thankfully due to trunk tweaks it looks like things work with sub-ent&#39;d ships again (bring on them Caddy&#39;s!).

--------------------------------------------------------------
License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement.
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)

--------------------------------------------------------------

Instructions:

Unzip the file, and then move the folder &quot;Gates 1.13.oxp&quot; to the AddOns directory of your Oolite installation. Then start the game up whilst holding down the shift key (until the spinning Cobra Mk III screen appears) and the stations will appear in appropriate systems.

--------------------------------------------------------------

Version history:

13/11/2009 - Version 1.00, Initial release (why am I releasing an OXP on Friday 13th????!!!!)
12/04/2010 - version 1.10, update for v1.74 (and higher), plus fun with scanner colouration.
13/02/2011 - Version 1.11, removal of upper limit, to allow running with 1.75
14/02/2011 - Version 1.12, stop timers if player dies in Gated system (errors in log otherwise).
23/10/2011 - Version 1.13, script adjustment to deal with situations when main station is no longer present. Also replace randomness with Ahruman&#39;s pseudo-random, to make things more repeatable.

--------------------------------------------------------------

Acknowledgements:

* With thanks to Frame for both the initial inspiration for the design (from Solar System 0.1 beta) and also for his pioneering use of ownProperties scripting in bounty scanner, which is re-used here.

* And a follow-on nod to Eric Walch for reminding me of the latter above, and to another_commander for encouragement to issue this OXP, and for help when trunk-beta started docking the player with the gates.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/gates_alienGate.html">Jump Gate (Captured Alien)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/gates_gateTrader.html">gates_gateTrader</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/gates_jumpGate.html">gates_jumpGate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/gates_roseGate.html">Jump Gate (Rose variant)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/gates_spiderGate.html">Jump Gate (Spider variant)</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/gates_gateTrader.js</td>
                    <td><pre>this.name					= &quot;gates_gateTrader&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt.&quot;;
this.description				= &quot;Script for traders using jumpgates&quot;;
this.version				= &quot;1.00&quot;;

this.shipSpawned = function()
	{ 
	if(system.isInterstellarSpace || system.sun.isGoingNova || system.sun.hasGoneNova || system.countShipsWithRole(&quot;gates_jumpGate&quot;) &lt; 2)
		{
		return;
		}
	
	
	function jumpGates(entity) {return entity.isShip &amp;&amp; entity.hasRole(&quot;gates_jumpGate&quot;)}; // all gates except this one
	var gates = system.filteredEntities(this, jumpGates, this.ship); // find the gates in the system
	
	if(this.ship.position.distanceTo(gates[0].position) &lt; 51200 &amp;&amp; (this.ship.AIState == &quot;HEAD_FOR_PLANET&quot; || this.ship.AIState == &quot;HEAD_AWAY_FROM_PLANET&quot;))
		{
		this.ship.target = gates[0];
		this.ship.setAI(&quot;gates_useGateAI.plist&quot;);
		}
	}

this.checkGateDistance = function()
	{	
	if(this.ship.position.distanceTo(this.ship.target.position) &gt; 51200)
		{
		this.ship.reactToAIMessage(&quot;NEXT_GATE&quot;)
		}
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/gates_jumpGate.js</td>
                    <td><pre>this.name					= &quot;gates_jumpGate&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Script for Thargoid jumpgates&quot;;
this.version				= &quot;1.12&quot;;


function gates_allGates(entity) {return entity.isShip &amp;&amp; entity != this.ship &amp;&amp; entity.hasRole(&quot;gates_jumpGate&quot;)}; // all gates except this one

function gates_clients(entity) {return entity.isShip &amp;&amp; entity.primaryRole != &quot;gates_gateGuard&quot; &amp;&amp; !entity.isCloaked &amp;&amp; !entity.isWeapon &amp;&amp; !entity.isRock &amp;&amp; !entity.isCargo &amp;&amp; (!entity.hasOwnProperty(&quot;gates_receivingGate&quot;)|| entity.gates_receivingGate == null)}; // ships that can use jumpgates (exclude spawned defenders, missiles, mines, asteroids and cargo pods

function gates_oldClients(entity) {return entity.isShip &amp;&amp; entity.hasOwnProperty(&quot;gates_receivingGate&quot;) &amp;&amp; entity.gates_receivingGate != null &amp;&amp; entity.position.distanceTo(this.ship.position) &gt; 500 &amp;&amp; entity.position.distanceTo(this.ship.position) &lt; 5000}; // ships which have come through this gate and are now between 500m and 5km from it

function gates_outboundNPCs(entity) {return entity.isShip &amp;&amp; entity.AI == &quot;exitingTraderAI.plist&quot; &amp;&amp; entity.AIState == &quot;HEAD_AWAY_FROM_PLANET&quot; &amp;&amp; (!entity.escorts || entity.escorts.length == 0) &amp;&amp; system.mainStation &amp;&amp; entity.position.distanceTo(system.mainStation.position) &lt; 51200};

function gates_inboundNPCs(entity) {return entity.isShip &amp;&amp; entity.AI == &quot;route1traderAI.plist&quot; &amp;&amp; entity.AIState == &quot;HEAD_FOR_PLANET&quot; &amp;&amp; (!entity.escorts || entity.escorts.length == 0) &amp;&amp; entity.position.distanceTo([0,0,0]) &lt; 51200};


this.shipSpawned = function()
	{
	this.ship.scannerDisplayColor1 = &quot;greenColor&quot;;
	this.ship.scannerDisplayColor2 = &quot;whiteColor&quot;;
	this.playerGreeted = null;
	this.allowGreeting = true;
	this.gatesOnline = true;
	this.ship.orientation = system.mainStation.orientation; // point them all in the same direction, along universal Z.
	this.defenderCount = 10; // max number of defenders that can be launched overall by the gate if attacked
	
	if(this.scanTimer)
		{
		this.scanTimer.start();
		}
	else
		{
		this.scanTimer = new Timer(this, this.shipApproach, 0, 1.0); // scan for jumping ships every 1 second - too long/short?
		}

	if(this.npcTimer)
		{
		this.npcTimer.start();
		}
	else
		{
		this.npcTimer = new Timer(this, this.npcTraders, 0, 180); // scan for NPC traders who may want to use the gates every 3 minutes
		}

	}

this.playerWillEnterWitchspace = this.shipDied = function()
	{
	if(this.scanTimer)
		{
		this.scanTimer.stop();
		}

	if(this.npcTimer)
		{
		this.npcTimer.stop();
		}
	}

this.shipApproach = function()
	{	
	if(!player.ship || !player.ship.isValid)
		{
		this.shipDied();
		return;
		}
	
	if(this.ship.position.distanceTo(player.ship.position) &gt; 25600 &amp;&amp; this.allowGreeting == null)
		{
		this.allowGreeting = true;
		}
	
	var pastClients = system.filteredEntities(this, gates_oldClients, this.ship, 5000) // if any old clients are around, strip their client status
	if(pastClients.length &gt; 0)
		{
		for(var i = 0; i &lt; pastClients.length; i++)
			{
			pastClients[i].gates_receivingGate = null;
			if(pastClients[i].isPlayer) 	
				{
				player.consoleMessage(&quot;Jump gate cleared.&quot;, 6);
				this.allowGreeting = null;
				}
			}
		}
	
	var queue = system.filteredEntities(this, gates_clients, this.ship, 250); // if there is no-one wanting to jump, end the test
	if(queue.length == 0)
		{
		return;
		}
	
	var gates = system.filteredEntities(this, gates_allGates, this.ship); // check whether there is a second gate to receive the jumper
	if(gates.length == 0) 
		{
		if(queue[0].isPlayer &amp;&amp; this.gatesOnline == true) 
			{
			player.consoleMessage(&quot;Jump gate off-line.&quot;, 6);
			this.gatesOnline = null;
			}
		return;
		}
	else
		{
		this.gatesOnline = true;
		}
	
	if(queue[0].hasOwnProperty(&quot;gates_receivingGate&quot;) &amp;&amp; queue[0].gates_receivingGate == this.ship) // if the jumper has just arrived, end the test
		{
		return;
		}

	if(queue[0].AI == &quot;gates_useGateAI.plist&quot;)
		{
		queue[0].reactToAIMessage(&quot;JUMPED&quot;);
		queue[0].gates_receivingGate = gates[0]; // note the gate that is about to receive the jumper
		queue[0].position = gates[0].position; // move the jumper to the receiving gate
		queue[0].orientation = gates[0].orientation; // re-orient the jumper to point out of the gate
		return;
		}
	
	if(queue[0].isPlayer)
		{
		if(player.credits &lt; 251)
			{
			player.consoleMessage(&quot;Insufficient credits to perform jump.&quot;, 6);
			return;
			}
		else
			{
			player.consoleMessage(&quot;Jump gate activated.&quot;, 6);
			player.credits -=250;
			this.playerGreeted = null;
			queue[0].gates_receivingGate = gates[0]; // note the gate that is about to receive the player
			queue[0].position = gates[0].position; // move the player to the receiving gate
			queue[0].orientation = gates[0].orientation; // re-orient the player to point out of the gate
			}
		}
	}

this.greetPlayer = function()
	{
	if(!player.ship.isCloaked &amp;&amp; (!player.ship.hasOwnProperty(&quot;gates_receivingGate&quot;) || player.ship.gates_receivingGate == null) &amp;&amp; this.playerGreeted != true &amp;&amp; this.allowGreeting == true)
		{
		player.consoleMessage(&quot;Welcome Commander, only 250Cr to use the jump gate system.&quot;, 6);
		this.playerGreeted = true;
		}
	}

this.findGates = function()
	{
	var gates = system.filteredEntities(this, gates_allGates, this.ship);	
	if(gates.length == 0)
		{
		this.ship.reactToAIMessage(&quot;NO_GATE&quot;);
		this.ship.scannerDisplayColor1 = &quot;greenColor&quot;;
		this.ship.scannerDisplayColor2 = &quot;orangeColor&quot;;
		}
	else
		{
		this.ship.reactToAIMessage(&quot;GATE_FOUND&quot;);
		this.ship.scannerDisplayColor1 = &quot;greenColor&quot;;
		this.ship.scannerDisplayColor2 = &quot;whiteColor&quot;;
		}
	};
	
this.underAttack = function()
	{
	if(this.defenderCount &gt; 0 &amp;&amp; worldScripts[&quot;gates_masterScript&quot;] &amp;&amp; worldScripts[&quot;gates_masterScript&quot;].defenderAllowed())
		{
		var defender = this.ship.spawnOne(&quot;police&quot;);
		defender.position = this.ship.position;
		defender.orientation = this.ship.orientation;
		this.defenderCount -= 1;
		}
	}

this.npcTraders = function()
	{
	var outTraders = system.filteredEntities(this, gates_outboundNPCs); // list of outbound traders
	var inTraders = system.filteredEntities(this, gates_inboundNPCs); // list of inbound traders
	var gates = system.shipsWithRole(&quot;gates_jumpGate&quot;);

	if(gates.length &lt; 2)
		{
		return;
		}

	if(inTraders.length &gt; 0)
		{
		for(var i = 0; i &lt; inTraders.length; i++)
			{
			if(Math.random() &lt; 0.2 &amp;&amp; gates.length &gt; 0)
				{
				inTraders[i].target = gates[0];
				inTraders[i].script.checkGateDistance = this.checkGateDistance;
				inTraders[i].setAI(&quot;gates_useGateAI.plist&quot;);
				}
			}
		}

	if(outTraders.length &gt; 0)
		{
		for(var i = 0; i &lt; outTraders.length; i++)
			{
			if(Math.random() &lt; 0.2 &amp;&amp; gates.length &gt; 0)
				{
				outTraders[i].target = gates[0];
				outTraders[i].script.checkGateDistance = this.checkGateDistance;
				outTraders[i].setAI(&quot;gates_useGateAI.plist&quot;);
				}
			}
		}
	}

// The function below is assigned to NPC ships using the jump gates

this.checkGateDistance = function()
	{	
	if(this.ship.position.distanceTo(this.ship.target.position) &gt; 51200)
		{
		this.ship.reactToAIMessage(&quot;NEXT_GATE&quot;)
		}
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/gates_masterScript.js</td>
                    <td><pre>this.name					= &quot;gates_masterScript&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;WorldScript for Gates OXP.&quot;;
this.version				= &quot;1.13&quot;;

this.startUp = function()
	{
	this.defenderTime = clock.absoluteSeconds; 
	}
	

this.shipWillExitWitchspace = function()
	{
	if(system.isInterstellarSpace || system.sun.isGoingNova || system.sun.hasGoneNova) 
		{ // stop the script if interstellar space, or system is going Nova(to allow Nova mission unhindered) or indeed if it has gone nova already.
		return;
		}

	this.setUpGates();
	}

this.shipWillLaunchFromStation = function(station)
	{
	if(station.isMainStation)
		{
		this.setUpGates();
		delete this.shipWillLaunchFromStation;
		}
	}

this.setUpGates = function()
	{
	if(system.countShipsWithRole(&quot;gates_jumpGate&quot;) &gt; 0 || system.techLevel &lt; 7 || system.government &lt; 4 || this.scrambledPseudoRandom(34.12) &lt; 0.25)
		{
		return;
		}

	log(&quot;Adding jump gates to the &quot; + system.name + &quot; system&quot;);

	system.legacy_addShipsAt(&quot;gates_jumpGate&quot;, 1, &quot;wpu&quot;, [0,0,0.02]);
      
    this.xOffset = (Math.random() * 10000); // x offset between 0 and 10km
	this.yOffset = (Math.random() * 10000); // y offset between 0 and 10km
	this.zOffset = (Math.random() * 25000) + 15000; // z offset between 15 and 40km

      if(Math.random() &gt; 0.5) // 50:50 chance of offsetting in the other direction
         {
         this.xOffset = -this.xOffset;
         }
      if(Math.random() &gt; 0.5) // 50:50 chance of offsetting in the other direction
         {
         this.yOffset = -this.yOffset;
         }
	
	if(system.mainStation)
		{ system.legacy_addShipsAtPrecisely(&quot;gates_jumpGate&quot;, 1, &quot;abs&quot;, system.mainStation.position.subtract([this.xOffset, this.yOffset, this.zOffset]));}
	}

this.scrambledPseudoRandom = function(salt) // Ahruman&#39;s random number generator.
	{
    // Convert from float in [0..1) with 24 bits of precision to integer.
    var n = Math.floor(system.pseudoRandomNumber * 16777216.0);
   
    // Add salt to enable generation of different sequences.
    n += salt;
   
    // Scramble with basic LCG psuedo-random number generator.
    n = (214013 * n + 2531011) &amp; 0xFFFFFFFF;
    n = (214013 * n + 2531011) &amp; 0xFFFFFFFF;
    n = (214013 * n + 2531011) &amp; 0xFFFFFFFF;
   
    // Convert from (effectively) 32-bit signed integer to float in [0..1).
    return n / 4294967296.0 + 0.5;
	};	
	
// the function below is referenced by the gates themselves via their own script, or are assigned to NPC ships using the gates.

this.defenderAllowed = function() 
	{ 
	if(this.defenderTime &amp;&amp; (clock.absoluteSeconds - this.defenderTime) &gt; 20) 
		{ 
		this.defenderTime = clock.absoluteSeconds; 
		return true; 
		} 
	else 
		{
		return false; 
		}
	}

</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
