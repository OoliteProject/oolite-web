<html>
    <head>
        <title>Expansion Mining Contracts</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Mining Contracts</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">3 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Excavate asteroids for reward with deadline conditions.</td>
                    <td>Excavate asteroids for reward with deadline conditions.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Diagoras.MiningContracts</td>
                    <td>oolite.oxp.Diagoras.MiningContracts</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Mining Contracts</td>
                    <td>Mining Contracts</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Activities</td>
                    <td>Activities</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Diagoras</td>
                    <td>Diagoras</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.12</td>
                    <td>1.12</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Mining_Contracts_OXP">http://wiki.alioth.net/index.php/Mining_Contracts_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/1/1e/MiningContracts_1.12.oxz">https://wiki.alioth.net/img_auth.php/1/1e/MiningContracts_1.12.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Ms-PL</td>
                    <td>Ms-PL</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873244</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Mining%20Contracts'>http://wiki.alioth.net/index.php/Mining%20Contracts</a></p>
        <h3>MiningContracts readme.txt</h3>
        <pre>Mining Contracts OXP

This extension allows you to make some fast cash working as independent contractor for big mining corporations. You can find new mission type in Interfaces (F4) screen of Rock Hermits. Have your mining laser and fuel scoop ready.

Dependencies:
Oolite v1.82 or later (haven&#39;t checked on anything older)
Icesteroids if you want to mine them for alloys
Start Choices if you want to begin game on Mining Transporter.
Asteroid Tweaks if you want asteroids respawing without saving/loading

Instructions:
Unzip the file, and then move the folder named &quot;.oxp&quot; into the AddOns directory of your Oolite installation.
Hold down the Shift key when you start the game first time until the splash screen appear.

License:
This work is licensed under the Microsoft Public License (Ms-PL).
If you are re-using any piece of this OXP, please let me know by sending an e-mail to pdunan@gmail.com.

Changelog:
 2015.11.11. v1.12  Made average contract difficulty dependent on system government type, also chaotic rock hermits are giving contracts too now
 2015.11.03. v1.11  Bugfix release - docking with rock hermits after witchjump do not invalidates descrambilng keys anymore
 2015.10.30. v1.10  Obscure race condition bug in waiting for new contract squashed, also balance adjustments
 2015.10.28. v1.9   Shrinked contract details screen for smaller resolutions and some balance adjustments
 2015.10.27. v1.8   Mining Beacon Descrambler addon to ASC is now purchasable at all Rock Hermits for clean commanders
 2015.10.26. v1.7   Signing mining contract now adds Rock Hermit to your Advanced Space Compass, also some balance adjustments
 2015.10.19. v1.6   Waiting at the station for new contracts is not free now
 2015.10.19. v1.5   Various improvements in interface, added possibility of waiting at the station for new contract, slightly adjusted balance
 2015.10.14. v1.4   Iceteroids are not required now (thanks to Diziet Sma) and contracts for alloys made less frequent
 2015.10.12. v1.3   Added compatibility with Asteroid Tweaks by spara
 2015.10.11. v1.2   Added tracking of cargo amounts required to complete signed contracts to the Missions screen (F5F5)
 2015.10.10. v1.1   Fixed saving/loading (thanks to Norby)
 2015.10.06. v1.0   First version as a result of discussion in this topic: http://aegidian.org/bb/viewtopic.php?f=4&amp;t=13382&amp;p=243101#p243094
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_MC_DESCRAMBLER.html">Mining Beacon Descrambler</a></td>
                    <td>yes</td>
                    <td align="right">500</td>
                    <td align="center">1+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. 
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/mc_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;

this.allowAwardEquipment = function(eqKey, ship, context)
{
	return context != &quot;purchase&quot; || ship.dockedStation.primaryRole == &quot;rockhermit&quot;;
};</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/mc_descrambler.js</td>
                    <td><pre>&quot;use strict&quot;;

this.activated = function()
{
	var ws = worldScripts[&quot;miningcontracts&quot;];

	if (ws.MC_subscr &lt; clock.seconds)
	{
		player.consoleMessage(&quot;You have no valid descrambling keys.&quot;);
		return;
	}

	var hermits = system.shipsWithPrimaryRole(&quot;rockhermit&quot;);
	var number = hermits.length;
	var active = 0;

	for (var i = 0; i &lt; number; i++)
	{
		// if (system.countShipsWithRole(&quot;asteroid&quot;, hermits[i], 25600) &lt; 5) continue;
		hermits[i].beaconCode = hermits[i].displayName;
		active++;
	}

	player.consoleMessage((active &gt; 0 ? active : &quot;no&quot;) + &quot; scrambled beacons detected.&quot;);
}

this.mode = function()
{
	var ws = worldScripts[&quot;miningcontracts&quot;];

	var msg = ws.MC_subscr &lt; clock.seconds ?
		&quot;You have no valid descrambling keys.&quot; :
		&quot;Your descrambling keys are valid till &quot; + MC_clockStringToMinutes(ws.MC_subscr) + &quot;.&quot;;

	player.consoleMessage(msg);
}

function MC_clockStringToMinutes(time)
{
	return clock.clockStringForTime(time).slice(4,13);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/miningcontracts.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;miningcontracts&quot;;
this.author      = &quot;Diagoras&quot;;
this.copyright   = &quot;2015 Maxim Savchenko&quot;;
this.licence     = &quot;Ms-PL&quot;;
this.description = &quot;Excavate asteroids for reward with deadline conditions.&quot;;

this.startUp = function() {
	this.MC_contracts = [];

	if (missionVariables.MC_initialized)
	{
		this.MC_system = missionVariables.MC_system;
		this.MC_clock = missionVariables.MC_clock;
		this.MC_debt = missionVariables.MC_debt;
		this.MC_subscr = missionVariables.MC_subscr;
		var s = missionVariables.MC_contracts;
		if (s &amp;&amp; s.length &gt; 0) this.MC_contracts = JSON.parse(s);
	}
	else
	{
		this.MC_system = &quot;&quot;;
		this.MC_clock = 0;
		this.MC_debt = 0;
		this.MC_subscr = 0;
	}
};

this.startUpComplete = function() {
	this.MC_countAsteroids();
	this.MC_setInstructions();
	if(player.ship.docked) this.shipDockedWithStation(player.ship.dockedStation);
};

this.shipDockedWithStation = function(station)
{
	if (!this.MC_stationPrimRoles[station.primaryRole]) return;

	if (this.MC_system != system.name)
	{
		this.MC_system = system.name;
		this.MC_clock = 0;
		this.MC_contracts = [];
		this.MC_debt = 0;
	}

	station.setInterface(&quot;MiningContracts-bm&quot;, {
		title: &quot;Mining Contracts&quot;,
		category: &quot;Contracts&quot;,
		summary: &quot;Sign up for a local mining operations.&quot;,
		callback: this.MC_interface.bind(this)
	});
};

this.playerWillSaveGame = function(message)
{
	missionVariables.MC_initialized = 1;
	missionVariables.MC_system = this.MC_system;
	missionVariables.MC_clock = this.MC_clock;
	missionVariables.MC_debt = this.MC_debt;
	missionVariables.MC_subscr = this.MC_subscr;
	missionVariables.MC_contracts = JSON.stringify(this.MC_contracts);
};

this.shipExitedWitchspace = function()
{
	// this.MC_markHermits();
	this.MC_countAsteroids();

	var number = this.MC_contracts.length;
	var total = this.MC_debt;

	for (var i = 0; i &lt; number; i++)
	{
		var contract = this.MC_contracts[i];
		if (contract.signed) total += contract.amount * contract.penalty - contract.reward;
	}

	this.MC_contracts = [];
	this.MC_debt = 0;
	this.MC_clock = 0;

	if (total &gt; 0)
	{
		player.bounty += 50;
		player.commsMessage(
			&quot;Mining Association of &quot; +
			this.MC_system +
			&quot; have offered bounty of &quot; +
			formatCredits(50, true, true) +
			&quot; for your head&quot;);
	}

	this.MC_setInstructions();
};

this.MC_stationPrimRoles = {
	&quot;rockhermit&quot;: true,
	&quot;rockhermit-chaotic&quot;: true,
	&quot;rockhermit-pirate&quot;: false
};

this.MC_countAsteroids = function()
{
	this.MC_icequota = system.countShipsWithRole(&quot;staer9_asteroid&quot;) / system.countShipsWithRole(&quot;asteroid&quot;);
};

this.MC_setInstructions = function()
{
	var instructions = [];
	var number = this.MC_contracts.length;

	for (var i = 0; i &lt; number; i++)
	{
		var contract = this.MC_contracts[i];

		if (contract.signed == 1)
		{
			var msg =
				contract.amount +
				&quot;t of &quot; +
				contract.cargo +
				&quot; before &quot; +
				MC_clockStringToMinutes(contract.deadline);

			instructions.push(msg);
		}
	}

	this.MC_active = instructions.length &gt; 0;

	if (this.MC_active) instructions.unshift(&quot;Mining Contracts:&quot;);
	else instructions = null;

	mission.setInstructions(instructions);
};

function MC_clockStringToMinutes(time)
{
	return clock.clockStringForTime(time).slice(4,13);
}

this.MC_waitPrice = 5;

this.MC_interfaceNoGen = function()
{
	var debtMsg =
		this.MC_debt &gt; 0 ? &quot;\n\nYou are in debt to Mining Association of &quot; + this.MC_system +
		&quot; (&quot; + formatCredits(this.MC_debt, true, true) + &quot;)&quot; : &quot;&quot;;

	var number = this.MC_contracts.length;

	var parameters = {
		title: &quot;Mining Contracts&quot;,
		message:
			&quot;Rock Hermit main lounge is as dusty as everything in this place. &quot; +
			&quot;Couple grumpy miners are playing cards at the only table in the corner. &quot; +
			&quot;Balding clerk is sleeping at the front desk of local Mining Association. &quot; +
			&quot;Large blackboard with listing of current contracts is hanging over him. &quot; +
			&quot;Suddenly ancient fax machine standing on the desk squeals. &quot; +
			&quot;Dragged out of the hay clerk swears, wipes one line from a blackboard and falls back to sleep. &quot; +
			&quot;On the opposite wall you notice numerous square hatches layered in two rows under flaked advert:\n\n&quot; +
			&quot;RESTING PODS! NO TIME LIMIT! ONLY &quot; + formatCredits(this.MC_waitPrice, true, true) + &quot; PER USE!&quot; +
			debtMsg,
		choices: {
			&quot;WAIT&quot;: &quot;Wait for new contract (&quot; + formatCredits(this.MC_waitPrice, true, true) + &quot;)&quot;,
			&quot;XXIT&quot;: &quot;Exit Mining Contracts&quot;
		},
		allowInterrupt: true
	};

	for (var i = 0; i &lt; number; i++)
	{
		var contract = this.MC_contracts[i];
		var status = [&quot;OFFER&quot;, &quot;TAKEN&quot;, &quot;BLOWN&quot;][contract.signed];
		parameters.choices[&quot;C&quot; + i]
			= status + &quot;: &quot;
			+ contract.amount + &quot;t of &quot;
			+ contract.cargo + &quot; before &quot;
			+ MC_clockStringToMinutes(contract.deadline) + &quot; for &quot;
			+ formatCredits(contract.reward, true, true);
	}

	if (this.MC_debt &gt; 0) parameters.choices[&quot;DEBT&quot;] = &quot;Repay debt&quot;;

	mission.runScreen(parameters, this.MC_contractDetails.bind(this));
};

this.MC_interface = function()
{
	this.MC_generateContracts();
	this.MC_interfaceNoGen();
};

this.MC_contractDetails = function(choice)
{
	if (choice == null) return;

	if (choice == &quot;DEBT&quot;)
	{
		if (this.MC_debt &gt; player.credits) player.consoleMessage(&quot;NOT ENOUGH CREDITS&quot;);
		else
		{
			player.commsMessage(formatCredits(this.MC_debt, true, true) + &quot; deducted&quot;);
			player.credits -= this.MC_debt;
			this.MC_debt = 0;
		}

		this.MC_interface();
		return;
	}

	if (choice == &quot;WAIT&quot;)
	{
		if (player.credits &lt; this.MC_waitPrice)
		{
			player.consoleMessage(&quot;NOT ENOUGH CREDITS&quot;);
			this.MC_interface();
			return;
		}

		player.commsMessage(formatCredits(this.MC_waitPrice, true, true) + &quot; deducted&quot;);
		player.credits -= this.MC_waitPrice;
		this.MC_waitForContract();
		this.MC_interfaceNoGen();
		return;
	}

	if (choice == &quot;XXIT&quot;) return;

	var cid = choice.replace(&quot;C&quot;, &quot;&quot;).split(&quot;:&quot;);
	var contract = this.MC_contracts[cid[0]];
	var debt = this.MC_debt;
	var header, descr, deliv, ps, id, option;
	var mediator = &quot;Mining Association of &quot; + this.MC_system;
	var warning = &quot;\n\nn.b. &quot; + mediator + &quot; reserves the right to set a bounty on heads of defaulting contractors.&quot;;

	var terms =
		&quot;Terms and conditions:\n&quot; +
		&quot;Payment is calculated and carried out after one of three events - &quot; +
		&quot;full delivery of required cargo before due time, &quot; +
		&quot;premature contract termination initiated by contractor or &quot; +
		&quot;coming of due time. &quot; +
		&quot;If forefeit penalty exceeds fee, the difference becomes contractor&#39;s debt liability to &quot; + mediator + &quot;. &quot; +
		&quot;Contract fee meant for indebted contractor will be detained for repayment first. &quot; +
		&quot;Contractor leaving system before completion of obligations or debt retirement will be recognised as defaulter.&quot; +
		warning;

	function debtMsg(reward)
	{
		return debt &gt; 0 ?
			&quot;\n\nDue to unpaid debt to &quot; + mediator + &quot; we are withholding &quot; +
			formatCredits(Math.min(reward, debt), true, true) +
			&quot; from your reward.&quot; : &quot;&quot;;
	}

	switch (contract.signed)
	{
		case 0:
			header = &quot;Contractual Offer&quot;;
			descr = &quot;Subject of delivery&quot;;
			deliv = contract.amount;
			ps = terms;
			id = &quot;SIGN&quot;;
			option = &quot;Sign contract&quot;;
			break;

		case 1:
			descr = &quot;Delivered&quot;;
			deliv = (contract.gross - contract.amount) + &quot;/&quot; + contract.gross + &quot; &quot;;

			if (contract.amount &gt; 0)
			{
				header = &quot;Operating Contract&quot;;
				ps = terms;
				id = &quot;CARGO&quot;;
				option = &quot;Dispatch cargo (&quot; + Math.min(contract.amount, manifest[contract.cargo]) + &quot;t)&quot;;
			}
			else
			{
				header = &quot;Contract Completion&quot;;
				ps =
					&quot;You have successfully performed a contract. &quot; +
					&quot;According to the terms your reward is &quot; + formatCredits(contract.reward, true, true) + &quot;. &quot; +
					&quot;We are looking forward to working with you in the future.&quot; + debtMsg(contract.reward);
				id = &quot;REWARD&quot;;
				option = &quot;Collect reward&quot;;
			}

			break;

		case 2:
			header = &quot;Terminated Contract&quot;;
			descr = &quot;Delivered&quot;;
			deliv = (contract.gross - contract.amount) + &quot;/&quot; + contract.gross + &quot; &quot;;
			var balance = contract.reward - contract.amount * contract.penalty;

			if (balance &lt; 0)
			{
				ps =
					&quot;You have failed to perform a contract and forefeit penalty exceeds your fee. &quot; +
					&quot;According to the terms your debt to &quot; + mediator + &quot; is increased by &quot; + formatCredits(-balance, true, true) + &quot;. &quot; +
					&quot;This debt may be liquidated with cash deposit. &quot; +
					&quot;Until full debt liquidation all your future contract fees will be detained for repayment first. &quot; +
					&quot;If you leave system before full debt liquidation, you will be recognised as defaulter. &quot; +
					&quot;Please, do not delay your payments.&quot; +
					warning;
				id = &quot;DEBT&quot;;
				option = &quot;Take debt notification&quot;;
			}
			else
			{
				ps =
					&quot;You have failed to perform a contract fully and forefeit penalty have been deducted from your fee. &quot; +
					&quot;According to the terms your reward is &quot; + formatCredits(balance, true, true) + &quot;. &quot; +
					&quot;Please, be more diligent next time.&quot; + debtMsg(balance);
				id = &quot;REWARD&quot;;
				option = &quot;Collect reward&quot;;
			}

			break;
	}

	var parameters = {
		title: header,
		message:
			&quot;Ordering party: &quot; + contract.company + &quot;\n&quot; +
			&quot;Mediator: Mining Association of &quot; + this.MC_system + &quot;\n&quot; +
			descr + &quot;: &quot; + deliv + &quot;t of &quot; + contract.cargo + &quot;\n&quot; +
			&quot;Due time: &quot; + clock.clockStringForTime(contract.deadline) + &quot;\n&quot; +
			&quot;Fee: &quot; + formatCredits(contract.reward, true, true) + &quot;\n&quot; +
			&quot;Forfeit penalty: &quot; + formatCredits(contract.penalty, true, true) + &quot; per ton of shortage\n&quot; +
			&quot;\n&quot; +
			ps,
		choices: {},
		allowInterrupt: id != &quot;REWARD&quot; &amp;&amp; id != &quot;DEBT&quot;
	};

	parameters.choices[&quot;0_&quot; + id + &quot;:&quot; + cid[0]] = option;
	var next = &quot;2_NEXT:&quot; + cid[0];
	var prev = &quot;3_PREV:&quot; + cid[0];

	if (parameters.allowInterrupt)
	{
		if (id == &quot;CARGO&quot;) parameters.choices[&quot;1_TERMINATE:&quot; + cid[0]] = &quot;Terminate contract&quot;;

		if (contract.signed == 0)
		{
			parameters.choices[next] = &quot;Next unsigned contract&quot;;
			parameters.choices[prev] = &quot;Previous unsigned contract&quot;;
		}
		else if (contract.signed == 1)
		{
			parameters.choices[next] = &quot;Next unfinished contract&quot;;
			parameters.choices[prev] = &quot;Previous unfinished contract&quot;;
		}

		parameters.choices[&quot;4_BACK&quot;] = &quot;Back to the list&quot;;
		if (id == &quot;SIGN&quot;) parameters.initialChoicesKey = &quot;4_BACK&quot;;
	}

	switch (cid[1])
	{
		case &quot;N&quot;:
			parameters.initialChoicesKey = next;
			break;

		case &quot;P&quot;:
			parameters.initialChoicesKey = prev;
			break;
	}

	mission.runScreen(parameters, this.MC_contractAction.bind(this));
};

this.MC_contractAction = function(choice)
{
	if (choice == null) return;
	var ch = choice.split(&quot;:&quot;);

	switch (ch[0])
	{
		case &quot;0_SIGN&quot;:
			var idx = ch[1];
			this.MC_contracts[idx].signed = 1;
			this.MC_contracts[idx].gross = this.MC_contracts[idx].amount;
			player.consoleMessage(&quot;CONTRACT SIGNED&quot;);
			this.MC_setInstructions();
			this.MC_contractDetails(&quot;C&quot; + idx);
			break;

		case &quot;0_DEBT&quot;:
			var idx = ch[1];
			var contract = this.MC_contracts[idx];
			var debt = contract.amount * contract.penalty - contract.reward;
			this.MC_debt += debt;
			this.MC_contracts.splice(idx, 1);
			this.MC_interface();
			break;

		case &quot;0_REWARD&quot;:
			var idx = ch[1];
			var contract = this.MC_contracts[idx];
			var reward = contract.reward - contract.amount * contract.penalty;
			var repayment = Math.min(reward, this.MC_debt);
			reward -= repayment;
			this.MC_debt -= repayment;
			player.commsMessage(formatCredits(reward, true, true) + &quot; received&quot;);
			player.credits += reward;
			this.MC_contracts.splice(idx, 1);
			this.MC_setInstructions();
			this.MC_interface();
			break;

		case &quot;0_CARGO&quot;:
			var idx = ch[1];
			var contract = this.MC_contracts[idx];
			var amount = Math.min(contract.amount, manifest[contract.cargo]);

			if (amount &gt; 0)
			{
				player.commsMessage(amount + &quot;t of &quot; + contract.cargo + &quot; dispatched&quot;);
				this.MC_contracts[idx].amount -= amount;
				manifest[contract.cargo] -= amount;
				this.MC_subscr = Math.max(this.MC_subscr, MC_floorScale(clock.seconds, 900)) + amount * 900;
				this.MC_setInstructions();
			}
			else player.consoleMessage(&quot;no &quot; + contract.cargo + &quot; on board&quot;);

			this.MC_contractDetails(&quot;C&quot; + idx);
			break;

		case &quot;1_TERMINATE&quot;:
			var idx = ch[1];
			var contract = this.MC_contracts[idx];

			var parameters = {
				title: &quot;Mining Contracts&quot;,
				message: &quot;Are you sure you want to prematurely terminate contract with &quot; + contract.company + &quot;?&quot;,
				choices: {},
				allowInterrupt: true
			};

			parameters.choices[&quot;0_TERMYES:&quot; + idx] = &quot;Yes&quot;;
			parameters.choices[&quot;1_TERMNO:&quot; + idx] = &quot;No&quot;;
			parameters.initialChoicesKey = &quot;1_TERMNO:&quot; + idx;
			mission.runScreen(parameters, this.MC_contractAction.bind(this));
			break;

		case &quot;0_TERMYES&quot;:
			var idx = ch[1];
			this.MC_contracts[idx].signed = 2;
			player.consoleMessage(&quot;CONTRACT TERMINATED&quot;);
			this.MC_setInstructions();
			this.MC_contractDetails(&quot;C&quot; + idx);
			break;

		case &quot;1_TERMNO&quot;:
			var idx = ch[1];
			this.MC_contractDetails(&quot;C&quot; + idx);
			break;

		case &quot;2_NEXT&quot;:
			var idx = ch[1];
			var signed = this.MC_contracts[idx].signed;

			while (true)
			{
				idx++;
				if (idx &gt;= this.MC_contracts.length) idx = 0;
				if (this.MC_contracts[idx].signed == signed) break;
			}

			this.MC_contractDetails(&quot;C&quot; + idx + &quot;:N&quot;);
			break;

		case &quot;3_PREV&quot;:
			var idx = ch[1];
			var signed = this.MC_contracts[idx].signed;

			while (true)
			{
				if (idx &lt;= 0) idx = this.MC_contracts.length;
				idx--;
				if (this.MC_contracts[idx].signed == signed) break;
			}

			this.MC_contractDetails(&quot;C&quot; + idx + &quot;:P&quot;);
			break;

		case &quot;4_BACK&quot;:
			this.MC_interface();
			break;
	}
};

function MC_randomElement(array)
{
	return array[Math.floor(Math.random() * array.length)];
}

function MC_randomExponential()
{
	return -Math.log(1 - Math.random());
};

function MC_randomNormals()
{
	var u = Math.sqrt(MC_randomExponential());
	var v = 2 * Math.PI * Math.random();

	return {
		x: u * Math.cos(v),
		y: u * Math.sin(v)
	};
};

function MC_ceilScale(value, scale)
{
	return scale * Math.ceil(value / scale);
};

function MC_floorScale(value, scale)
{
	return scale * Math.floor(value / scale);
};

this.MC_companyPatterns = [
	&quot;? Company Limited&quot;,
	&quot;? plc&quot;,
	&quot;? S.A.&quot;,
	&quot;? Group&quot;,
	&quot;? Gold Corporation&quot;,
	&quot;? Inc.&quot;,
	&quot;Potash Corporation of ? Inc.&quot;,
	&quot;? Copper Corporation&quot;,
	&quot;MMC ? Nickel&quot;,
	&quot;? Platinum Limited&quot;,
	&quot;? Mining Corporation&quot;,
	&quot;Aluminum Corporation of ? Limited&quot;,
	&quot;? Platinum Holdings Limited&quot;,
	&quot;? Mining Limited&quot;,
	&quot;?Gold&quot;,
	&quot;? Goldfields Corporation&quot;,
	&quot;National Copper Corporation of ?&quot;,
	&quot;? Industries Ltd.&quot;
];

this.MC_companyName = function()
{
	return MC_randomElement(this.MC_companyPatterns).replace(&quot;?&quot;, randomName());
};

this.MC_randomCargo = function()
{
	return Math.random() &lt; this.MC_icequota ? &quot;alloys&quot; : &quot;minerals&quot;;
};

function MC_logistic(x)
{
	return 1 / (1 + Math.exp(x));
};

function MC_uniform(x, y)
{
	return x + (y - x) * Math.random();
};

this.MC_amountMu = 3;
this.MC_timeMu = 6;
this.MC_rateLambda = 4;
this.MC_generationRate = ((Math.exp(this.MC_amountMu) + 0.5) * Math.exp(this.MC_timeMu) + 450) / this.MC_rateLambda;

this.MC_createContract = function(time)
{
	var rn = MC_randomNormals();
	rn.y += (system.government - 3.5) / 8;
	var amount = Math.ceil(Math.exp(rn.x + this.MC_amountMu));
	var deadline = MC_ceilScale(time + amount * Math.exp(rn.y / 2 + this.MC_timeMu), 900);
	var expires = MC_uniform(time, deadline);
	var cargo = this.MC_randomCargo();
	var price = player.ship.dockedStation.market[cargo].price / 10;
	var reward = MC_ceilScale(MC_floorScale(amount * price, 10) * MC_logistic(rn.y), 10);

	var contract = {
		company: this.MC_companyName(),
		expires: expires,
		deadline: deadline,
		cargo: cargo,
		amount: amount,
		reward: reward,
		penalty: price,
		signed: 0
	};

	this.MC_contracts.push(contract);
};

this.MC_generateContracts = function()
{
	var prevClock = this.MC_clock;
	var nextClock = clock.seconds;
	var pregen = 96 * 3600;
	if (nextClock - prevClock &gt; pregen) prevClock = nextClock - pregen;

	while (true)
	{
		prevClock += MC_randomExponential() * this.MC_generationRate;
		if (prevClock &gt; nextClock) break;
		this.MC_createContract(prevClock);
	};

	this.MC_clock = nextClock;
	this.MC_expireContracts();
};

this.MC_waitForContract = function()
{
	this.MC_clock += MC_randomExponential() * this.MC_generationRate;
	this.MC_createContract(this.MC_clock);
	var time = this.MC_clock - clock.seconds;
	if (time &gt; 0) clock.addSeconds(time);
	this.MC_expireContracts();
};

this.MC_expireContracts = function()
{
	var number = this.MC_contracts.length;
	var updated = [];

	for (var i = 0; i &lt; number; i++)
	{
		var contract = this.MC_contracts[i];
		if (contract.signed == 1 &amp;&amp; contract.deadline &lt; clock.seconds) contract.signed = 2;
		if (contract.signed || contract.expires &gt; this.MC_clock) updated.push(contract);
	}

	this.MC_contracts = updated;
	this.MC_setInstructions();
};
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
