<html>
    <head>
        <title>Expansion Stellar Serpents</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Stellar Serpents</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">5 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">3 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER S)(&#39;[]&#39; vs &#39;[ships, missions]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>A little ongoing mission/flavour OXP on the theme of space monsters.</td>
                    <td>A little ongoing mission/flavour OXP on the theme of space monsters.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.StellarSerpents</td>
                    <td>oolite.oxp.Thargoid.StellarSerpents</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Stellar Serpents</td>
                    <td>Stellar Serpents</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Missions</td>
                    <td>Missions</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.21</td>
                    <td>1.21</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>ships, missions</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Stellar_Serpents_OXP">http://wiki.alioth.net/index.php/Stellar_Serpents_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/c/c0/Stellar_Serpents_1.21.oxz">https://wiki.alioth.net/img_auth.php/c/c0/Stellar_Serpents_1.21.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873458</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Stellar%20Serpents'>http://wiki.alioth.net/index.php/Stellar%20Serpents</a></p>
        <h3>Stellar Serpents 1.21 Readme &amp; License.txt</h3>
        <pre>Stellar Serpents OXP by Thargoid.

A little OXP as I was bored and saw an old thread musing about space monsters in the game.

So this OXP was born. It randomly adds a large stellar serpent to the game (it affects all 8 galaxies), which threatens ships and needs to be destroyed. The creatures wanders from system to system using wormholes from other ships transit to witchspace, causing a navigational hazard and generally making a nuisance of themselves. Hence each one carries a 500 credit bounty on its head.

Official notification is given on docking with the main station when a serpent is sighted within the current galaxy, and when it is killed by someone else (you&#39;re not the only snake-hunter in the Ooniverse!). You can also keep track of where any serpent currently in the galaxy is via the manifest (F5-F5) screen.

--------------------------------------------------------------

Requirements -

This OXP is scripted for Oolite v1.75 or later, and will not run on any earlier versions of the game. 

--------------------------------------------------------------

License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement. Basically if it&#39;s unique or would identify or overwrite anything in the original OXP, then you may not re-use it (for obvious compatibility reasons).
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* The license information (either as this file or merged into a larger one) must be included in the OXP.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)

--------------------------------------------------------------

Instructions:

Unzip the file, and then move the folder &quot;Stellar Serpents 1.21.oxp&quot; to the AddOns directory of your Oolite installation. Then start the game up and the ships should be added. 

Version history:

25/06/2010 - Version 1.00, Initial release - snakes in the game!
27/06/2010 - Version 1.01, minor tweak as tail segment wasn&#39;t stopping if body segment destroyed. Also randomised snake length
14/07/2010 - Version 1.02, minor bug fix to add weapon_energy line to turret eyes in shipdata, so they do damage...
13/02/2011 - Version 1.10, update for 1.75 including system. &gt; System. where appropriate
19/02/2011 - Version 1.11, small script tweak to make the serpents spawn after save/reload if in-system (thanks Screet!).
27/02/2011 - Version 1.20, updated to use the frame callback for animation rather than timers (making it 1.75+ only). Also used some new shipdata keys to give a kill only for the head of the serpent, not the segments.
20/02/2012 - Version 1.21, script fix to correct the randomness of the spawning locations.

--------------------------------------------------------------

Acknowledgements:

Thanks to SandJ, cim and Eric Walch for the identification of the randomness bug in v1.20
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/stellarSerpents_bodySegment.html">Stellar Serpent</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/stellarSerpents_head.html">Stellar Serpent</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/stellarSerpents_subEntLaser.html">Laser Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/stellarSerpents_subEntTurret.html">Turret Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/stellarSerpents_tail.html">stellarSerpents_tail</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/stellarSerpents_bodySegment.js</td>
                    <td><pre>this.name					= &quot;stellarSerpents_bodySegment.js&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.description			= &quot;Script to control Serpent body segment&quot;;
this.version				= &quot;1.00&quot;;
&quot;use strict&quot;;

this.shipSpawned = function()
	{
	/*this.amplitudeX, this.amplitudeY, this.phase,
	this.offset and this.mother are all defined by the mother script which spawns this segment. */

	this.segCounter = 0;
	switch(this.phase) // so segments near the head don&#39;t oscillate as much
		{
		case(0):
			{
			this.amplitudeX *= 0.2;
			this.amplitudeY *= 0.2;
			break;
			}
		case(1):
			{
			this.amplitudeX *= 0.4;
			this.amplitudeY *= 0.4;
			break;
			}
		case(2):
			{
			this.amplitudeX *= 0.6;
			this.amplitudeY *= 0.6;
			break;
			}
		}
	this.callbackID = addFrameCallback(this.moveSegment.bind(this));
	}
	
this.moveSegment = function(delta)
	{
	if(this.mother &amp;&amp; this.mother.isValid)
		{
		this.ship.scannerDisplayColor1 = [0,0,0,0];
		this.ship.position = this.mother.position.subtract(this.mother.vectorForward.multiply(275+(this.phase*140)));
		this.ship.orientation = this.mother.orientation;
		this.angleX = (Math.sin((clock.absoluteSeconds * Math.PI) + ((this.phase / 4) * Math.PI))); 
		this.angleY = (Math.sin((clock.absoluteSeconds * Math.PI) + (((this.phase + this.offset) / 4) * Math.PI))); 
		this.swingX = this.angleX * this.amplitudeX;
		this.swingY = this.angleY * this.amplitudeY;
		this.ship.position = this.ship.position.add(this.ship.vectorRight.multiply(this.swingX));
		this.ship.position = this.ship.position.add(this.ship.vectorUp.multiply(this.swingY));
		}
	else
		{
		this.freelance();
		}
	}
	
this.freelance = function()
	{
	this.ship.scannerDisplayColor1 = null;
	if(this.callbackID &amp;&amp; isValidFrameCallback(this.callbackID))
		{ removeFrameCallback(this.callbackID); }
	this.ship.displayName = &quot;Stellar Serpent Corpse Segment&quot;;
	}
	
this.shipBeingAttacked = function(whom)
	{
	if(this.mother &amp;&amp; whom)
		{
		this.mother.target = whom;
		this.mother.reactToAIMessage(&quot;ATTACKED&quot;);
		}
	}
	
this.shipAttackedWithMissile = function(missile, whom)
	{
	if(this.mother &amp;&amp; whom)
		{
		this.mother.target = whom;
		this.mother.reactToAIMessage(&quot;ATTACKED&quot;);
		}
	}
	

this.shipDied = this.shipRemoved = this.playerWillEnterWitchspace = function()
	{
	this.freelance();
	function siblings(entity) {return entity.isShip &amp;&amp; entity.hasRole(&quot;stellarSerpents_body&quot;) &amp;&amp; entity.script.mother &amp;&amp; entity.script.mother == this.mother &amp;&amp; entity.script.phase &gt; this.phase}; 
	var segments = system.filteredEntities(this, siblings, this.ship, 5000); 
	
	if(segments.length &gt; 0)
		{
		for(var looseCounter = 0;looseCounter&lt;segments.length;looseCounter++)
			{ segments[looseCounter].script.freelance(); }
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/stellarSerpents_head.js</td>
                    <td><pre>this.name					= &quot;stellarSerpents_head.js&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.description			= &quot;Stellar Serpent set-up&quot;;
this.version				= &quot;1.00&quot;;
&quot;use strict&quot;;

this.shipSpawned = function()
	{
	this.phase = -1; // ensure the oscillation-stoppings of following segments when higher one is destroyed doesn&#39;t affect head.
	
	this.serpentType = Math.ceil(Math.random() * 4);
	switch(this.serpentType)
		{
		case 0:
		case 1: // horizontal oscillation only
			{
			this.amplitudeX = 50 + Math.ceil(Math.random() * 100);
			this.amplitudeY = 0;
			this.spawnBody();
			break;
			}
			
		case 2: // vertical oscillation only
			{
			this.amplitudeX = 0;
			this.amplitudeY = 50 + Math.ceil(Math.random() * 100);
			this.spawnBody();
			break;
			}
			
		case 3: // anti-clockwise rotation
			{
			this.amplitudeX = -50 - Math.ceil(Math.random() * 100);
			this.amplitudeY = 50 + Math.ceil(Math.random() * 100);
			this.spawnBody();
			break;
			}	
			
		case 4: //  clockwise rotation
			{
			this.amplitudeX = 50 + Math.ceil(Math.random() * 100);
			this.amplitudeY = 50 + Math.ceil(Math.random() * 100);
			this.spawnBody();
			break;
			}			
		}	
	}	

this.spawnBody = function()
	{
	this.offset = Math.ceil(2 * Math.random() * 16) - 8;	
	this.segmentCount = 8 + Math.ceil(Math.random() * 16); // between 9 and 24 segments to the serpent

	for(var spawnCounter = 0;spawnCounter&lt;this.segmentCount;spawnCounter++)
		{
		if(spawnCounter == this.segmentCount - 1)
			{
			var section = this.ship.spawnOne(&quot;stellarSerpents_tail&quot;);
			}
		else
			{
			var section = this.ship.spawnOne(&quot;stellarSerpents_bodySegment&quot;);
			}
		section.script.phase = spawnCounter;	
		section.script.mother = this.ship;
		section.script.amplitudeX = this.amplitudeX;
		section.script.amplitudeY = this.amplitudeY;
		section.script.offset = this.offset;
		}
	}

this.shipDied = function(whom, why)
	{
	if(why &amp;&amp; why == &quot;removed&quot;) //  if the serpent was removed rather than killed
		{
		return;
		}
	
	missionVariables.stellarSerpents_status = &quot;NO_SERPENT&quot;;
	mission.setInstructionsKey(&quot;stellarSerpents_shortNoSerpent&quot;, &quot;stellarSerpents_masterScript.js&quot;);
	
	if(whom &amp;&amp; (whom.isPlayer || (whom.owner &amp;&amp; whom.owner.isPlayer) || whom.hasRole(&quot;hiredGuns_escort&quot;) || whom.hasRole(&quot;aquatics_guardianPlayer&quot;))) // killed by player or their henchthings
		{
		missionVariables.stellarSerpents_notification = &quot;PLAYER_DESTROYED&quot;;
		player.consoleMessage(&quot;500₢ awarded for Serpent termination.&quot;, 6)
		player.credits += 500;
		player.score += 1;
		}
	else
		{
		missionVariables.stellarSerpents_notification = &quot;NPC_DESTROYED&quot;;
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/stellarSerpents_masterScript.js</td>
                    <td><pre>this.name					= &quot;stellarSerpents_masterScript.js&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.description			= &quot;Wandering and spawning of Stellar Serpent &quot;;
this.version				= &quot;1.21&quot;;
&quot;use strict&quot;;

this.startUp = function()
	{
	if(!missionVariables.stellarSerpents_status)
		{ missionVariables.stellarSerpents_status = &quot;NO_SERPENT&quot;; } //  Whether the serpent is in the galaxy or not
	if(!missionVariables.stellarSerpents_serpentLife)
		{ missionVariables.stellarSerpents_serpentLife = 0; } //  how long the serpent has been in the galaxy
	if(!missionVariables.stellarSerpents_notification)
		{ missionVariables.stellarSerpents_notification = &quot;INITIAL_BROADCAST&quot;; } // OXP&#39;s opening mission screen broadcast
	}
	
this.shipWillEnterWitchspace = function()
	{
	this.actionChance = Math.random();		
	if(missionVariables.stellarSerpents_status == &quot;SERPENT&quot; &amp;&amp; this.actionChance &gt; 0.45)
		{
		if(this.actionChance &lt; 0.9) // serpent moves system 45% of time
			{
			missionVariables.stellarSerpents_serpentLife += 1;
			var currentSystem = System.infoForSystem(galaxyNumber, missionVariables.stellarSerpents_currentLocation);
			var systemArray = currentSystem.systemsInRange(7);
			var destinationSystem = systemArray[Math.floor((Math.random()) * systemArray.length)];
			missionVariables.stellarSerpents_currentLocation = destinationSystem.systemID;
			missionVariables.stellarSerpents_locationName = destinationSystem.name;
			mission.setInstructionsKey(&quot;stellarSerpents_shortMoved&quot;, &quot;stellarSerpents_masterScript.js&quot;);
			}
		else // serpent is destroyed by NPC 10% of time, if it has lived at least 3 jumps 
			{
			if(missionVariables.stellarSerpents_serpentLife &gt; 3)
				{ // killed by NPC
				missionVariables.stellarSerpents_status = &quot;NO_SERPENT&quot;;
				missionVariables.stellarSerpents_notification = &quot;NPC_DESTROYED&quot;;
				mission.setInstructionsKey(&quot;stellarSerpents_shortNoSerpent&quot;, &quot;stellarSerpents_masterScript.js&quot;);
				missionVariables.stellarSerpents_serpentLife = 0;
				}
			else
				{ // short-lived serpent, so keep alive and stay put
				missionVariables.stellarSerpents_serpentLife += 1;
				mission.setInstructionsKey(&quot;stellarSerpents_shortStayed&quot;, &quot;stellarSerpents_masterScript.js&quot;);
				}			
			}
		}	
	else
		{
		if(missionVariables.stellarSerpents_status == &quot;SERPENT&quot;)
			{ // serpent exists and stays where it was
			missionVariables.stellarSerpents_serpentLife += 1;
			mission.setInstructionsKey(&quot;stellarSerpents_shortStayed&quot;, &quot;stellarSerpents_masterScript.js&quot;);
			}
		else
			{ // no serpents in the galaxy
			mission.setInstructionsKey(&quot;stellarSerpents_shortNoSerpent&quot;, &quot;stellarSerpents_masterScript.js&quot;);
			}
		}
	}	

this.playerEnteredNewGalaxy = function(galaxyNumber) // reset things if we galaxy hop
	{
	missionVariables.stellarSerpents_status = &quot;NO_SERPENT&quot;;
	mission.setInstructionsKey(&quot;stellarSerpents_shortNoSerpent&quot;, &quot;stellarSerpents_masterScript.js&quot;);
	}
	
this.shipLaunchedFromStation = function()
	{
	this.shipExitedWitchspace();
	delete this.shipLaunchedFromStation;
	}
	
this.shipExitedWitchspace = function()
	{
	if(system.isInterstellarSpace) 
		{ // don&#39;t place serpent if we&#39;re in interstellar space
		return;
		}
	
	if(missionVariables.stellarSerpents_status == &quot;SERPENT&quot; &amp;&amp; system.ID == missionVariables.stellarSerpents_currentLocation &amp;&amp; system.countShipsWithRole(&quot;stellarSerpents_head&quot;) == 0)
		{
		system.addShipsToRoute(&quot;stellarSerpents_head&quot;, 1);
		}
		
	if(system.countShipsWithRole(&quot;stellarSerpents_head&quot;) &gt; 0)
		{
		this.delayedMessage(&quot;Stellar Serpent&#39;s presence is confirmed in-system!&quot;,6,5);
		}
	
	this.appearanceChance = Math.random();
	if(missionVariables.stellarSerpents_status == &quot;NO_SERPENT&quot; &amp;&amp; this.appearanceChance &lt; 0.1) // add a serpent 10% of time if none present in galaxy
		{
		missionVariables.stellarSerpents_status = &quot;SERPENT&quot;;
		missionVariables.stellarSerpents_serpentLife = 0;
		missionVariables.stellarSerpents_currentLocation = Math.floor(Math.random() * 256);
		if(galaxyNumber == 2 &amp;&amp; (missionVariables.stellarSerpents_currentLocation == 133 || missionVariables.stellarSerpents_currentLocation == 206))
			{ // if the spawning location is one of the two unreachable systems, change it to somewhere else.
			missionVariables.stellarSerpents_currentLocation += Math.ceil(Math.random() * 40);
			}
		missionVariables.stellarSerpents_locationName = System.infoForSystem(galaxyNumber, missionVariables.stellarSerpents_currentLocation).name;
		mission.setInstructionsKey(&quot;stellarSerpents_shortAppeared&quot;, &quot;stellarSerpents_masterScript.js&quot;);
		missionVariables.stellarSerpents_notification = &quot;SERPENT_APPEARED&quot;;
		}
	}
	
this.delayedMessage = function(messageString, duration, delay)
	{
	this.messageTimer = new Timer(this, function() {this.displayMessage(messageString, duration);}, delay);
	}
	
this.displayMessage = function(messageString, duration)
	{
	if(messageString)
		{
		if(!duration || duration &lt; 1)
			{
			duration = 6;
			}
		player.commsMessage(messageString, duration);
		}
	}

this.missionScreenOpportunity = function()
	{
	if(!player.ship.docked || !player.ship.dockedStation.isMainStation) 
		{
		return;
		}
	switch(missionVariables.stellarSerpents_notification)
		{
		case &quot;INITIAL_BROADCAST&quot;:
			{
			mission.runScreen({title: &quot;Notice to All Commanders&quot;, messageKey:&quot;stellarSerpents_initial&quot;, background:&quot;stellarSerpent_snakeBackground.png&quot;});
			mission.setInstructionsKey(&quot;stellarSerpents_shortNoSerpent&quot;, &quot;stellarSerpents_masterScript.js&quot;);
			missionVariables.stellarSerpents_notification = &quot;NO_NOTIFICATION&quot;;
			break;
			}
		
		case &quot;NPC_DESTROYED&quot;:
			{
			mission.runScreen({title: &quot;Serpent Terminated&quot;, messageKey:&quot;stellarSerpents_NPCTerminated&quot;, background:&quot;stellarSerpent_starBackground.png&quot;});
			missionVariables.stellarSerpents_notification = &quot;NO_NOTIFICATION&quot;;
			break;
			}	

		case &quot;PLAYER_DESTROYED&quot;:
			{
			mission.runScreen({title: &quot;Serpent Terminated&quot;, messageKey:&quot;stellarSerpents_playerTerminated&quot;, background:&quot;stellarSerpent_starBackground.png&quot;});
			missionVariables.stellarSerpents_notification = &quot;NO_NOTIFICATION&quot;;
			break;
			}	
			
		case &quot;SERPENT_APPEARED&quot;:
			{
			mission.runScreen({title: &quot;Serpent Sighted&quot;, messageKey:&quot;stellarSerpents_appeared&quot;, background:&quot;stellarSerpent_snakeBackground.png&quot;});
			missionVariables.stellarSerpents_notification = &quot;NO_NOTIFICATION&quot;;
			break;
			}				
		}
	
	}
	
this.shipDied = function()
	{
	if(this.messageTimer &amp;&amp; this.messageTimer.isRunning)
		{
		this.messageTimer.stop();
		}
	}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
