<html>
    <head>
        <title>Expansion Sun Gear</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Sun Gear</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">4 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER S)(&#39;[]&#39; vs &#39;[sun, star, system]&#39;)</li>
                <li>Conflict Expansions mismatch between OXP Manifest and Expansion Manager at character position 0068 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>This OXP simulates more realistic sun population based on real astronomical data. Vast solar systems with main planets in habitable zones and with simulated solar wind. Requires Habitable Main Planets OXP.</td>
                    <td>This OXP simulates more realistic sun population based on real astronomical data. Vast solar systems with main planets in habitable zones and with simulated solar wind. Requires Habitable Main Planets OXP.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.stranger.SunGear</td>
                    <td>oolite.oxp.stranger.SunGear</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Sun Gear</td>
                    <td>Sun Gear</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Ambience</td>
                    <td>Ambience</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>stranger</td>
                    <td>stranger</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>4.5.2</td>
                    <td>4.5.2</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>sun, star, system</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.stranger.HabitableMainPlanets:1.4.0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.stranger.HabitableMainPlanets:1.4.0</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                            <li>oolite.oxp.Wildeblood.distant_suns:0</li>
                            <li>oolite.oxp.Rustem.DistantStar:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Wildeblood.distant_suns:</li>
                            <li>oolite.oxp.Rustem.DistantStar:</li>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://aegidian.org/bb/viewtopic.php?f=4&amp;t=19973">http://aegidian.org/bb/viewtopic.php?f=4&amp;t=19973</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/2/28/SunGear.oxz">https://wiki.alioth.net/img_auth.php/2/28/SunGear.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1670023752</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Sun%20Gear'>http://wiki.alioth.net/index.php/Sun%20Gear</a></p>
        <h3>Sun Gear READ ME.txt</h3>
        <pre>----------------------------
Sun Gear OXP
----------------------------

Author: Stranger
This OXP is inspired by Distant Suns OXP (author of original work Wildblood).
This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license.
You are free to use and distribute this OXP on non-commercial basis. 
Rebundling of this OXP within another distribution is permitted as long as it is unchanged.
Any mods/derivatives of this OXP must be distributed under another names.
The license information (either as this file or merged into a larger one) must be included in the OXP.

Features:

Distribution of sun colors rebalanced in accordance with real astronomical data. Despite red dwarves being most common class in Galaxy stellar population most part of known exoplanets belongs to yellow Sun-like G-stars and orange K-stars (https://en.wikipedia.org/wiki/List_of_exoplanetary_host_stars). It may reflect observation bias of course but planets of yellow Sun-like stars seems to be more hospitable for colonization.
More detailed system of spectral classes - 28 spectral subclasses from M3.5V to F6V (Wildblood&#39;s spectra covers only 6 base classes) and 56 unique spectral signatures (two steps for subclass).
Spectral classes B and A completely removed from Ooniverse. Hottest bound of main sequence is limited to F6 spectral subclass. Bluish-white hot stars are too short-lived to maintain advanced ecosystems in real worlds and bit ugly in Ooniverse :-(
Spectral class M restricted to M3 stars to adopt more realistic star models. Red dwarves in real world has too low luminosities to model habitable zones in Oolite.
Sun radius is a function of spectral class. Sun radius and luminosity function vs spectral class based on real astronomical data.
Large suns and solar systems implemented - sun radii are in range 360000�1120000 km (smoothed distribution), main planet orbit radii are approx. 20�40 times of default value.
Spectral class of sun and main planet radius are correlated values - large main planets in white and yellow hot star systems, small main planets in systems of red and orange dwarves.
Distance from sun to main planet is a function of sun luminosity.
Habitable zones simulated. Main planets are located near Standard Insolation Level with random distance bias � 5%. Large main planets in systems of white and yellow stars has more warm climate as compared with small main planets in systems of orange and red dwarves not due to more hot sun per se but due to more dense atmospheres providing more evident greenhouse effect.
Corona flare is controlled dynamically via script. Most of time sun of system is in quiet state (corona_flare random value in range 0.1�0.2), but sometimes solar flares occurs and corona_flare rises randomly up to 0.5 (yes, I know, in reality it is NOT linear correlation between solar corona size and solar flares!). As a rule flare frequency increases from yellow to red stars. Peculiar suns with &quot;solar activity&quot; in system description has more frequent flares with higher magnitudes (corona_flare rises up to 1.0 in case of &quot;deadly solar activity&quot;).
Wildblood&#39;s spectroscope script was rewritten to adopt RGB color model. Sun radius is used to determine sun spectral class instead named color.
Solar wind model is implemented. Solar wind flux is a function of solar radius and corona flare, distance to sun and ship speed.
Solar wind allows to refuel ship without sunskimming (in some cases refuelling is possible en route from witchpoint to main planet).
Magnetospheres of celestial bodies are simulated. Solar wind density is drop to zero level near planets and moons. Upper boundary of magnetosphere is equal to upper boundary of gravity well (green/yellow horizon).

AstroLibrary

AstroLibrary is a library, providing astronomic (oostronomic may be?) functions to calculate sun spectrum, main planet temperature (used in Planetary Systems OXP to set planet texture), main planet orbital period &amp;  planet and moon parameters (used in Planetary Systems OXP to display on special info screen), solar wind density (used in Hard Way OXP to collect fuel) etc.


Advanced System Data MFD

Advanced System Data MFD provides custom system info on two pages.

Sun Data info page displays:

Sun catalog number (galaxy sector and system ID)
Sun spectral class
Sun radius
Sun mass
Sun luminosity
Solar activity
Main planet period in days
Sun distance
Solar wind flux

Planetary System Data info page provides list of additional planets in solar system. It displays only planet orbit radii in OU and planet class:

Dwarf terra � planet like Pluto or Ceres
Miniterra � planet like Mercury
Subterra � planet like Mars
Terra � planet like Earth or Venus
Superterra � planet like� hmm, we have no such example in our Solar System. Gliese 667 Cc maybe?
Ice giant � planet like Uranus or Neptune
Gas giant � planet like Jupiter or Saturn

System Data Sheet

Advanced system info also available in docked state using F4 screen. Select System Data Sheet option to view info:

Sun spectral class
Sun radius
Sun mass
Sun luminosity
Main planet period in days
List of system planets

System Data Sheet is available even if your ship has no ASC, but this service is provided only on GalCop main stations.

Dependencies

Sun Gear OXP requires Habitable Main Planets OXP installed because sun population is generated using recalibrated main planet radii, not vanilla ones.

Compatibility notes

Vast solar systems can cause problems in intra-system missions such as search and rescue operations or in-system taxi service. So you need additional OXPs to overcome these difficulties. Some OXPs uses absolute coordinates to populate systems with custom objects, so you may find such objects placed too close to large suns for example.
Refueling by sun-skimming is really challenging task in case of large suns (you have no enough time to leave more wide overheat zone). This is not the case if you are using fuel collection from solar wind, but this option is realized for player ship only, so pre-scripted AI sun-skimming activity will be suicidal behavior pattern.

Disclaimer:

Sun Gear is NOT simulation of real solar systems. It uses some relative values from real astronomy, scaled to fit into Oolite game world.
Don&#39;t try to use this software for real interstellar navigation!

Credits:

Wildblood - Distant Suns OXP/OXZ: initial concept of custom sun population &amp; spectroscope script.
Tch - Tch_Russian_Systems OXP: idea of using RGB model for sun color.
Rustem - Distant Stars OXP/OXZ: idea of dynamic coronae.
Damocles Edge, phkb and another_commander - for detecting OXP incompatibility with DH ANC OXP, formulation of issue with HSB colors and invaluable help to solve this issue.
Dybal, Milo and Cholmondely - valuable feedback for improving this OXP.

---------------------
Installation and use:
---------------------

To use, simply place the Sun Gear OXP into your &quot;AddOns&quot; folder or download OXZ from OXZ manager.
To call �Sun Data� MFD page lock Advanced Space Compass onto sun and list MFD modes.
To call �Planetary System Data� MFD page &quot;Stellar Data&quot; lock Advanced Space Compass onto any planet or moon and list MFD modes.
Advanced System Data MFD is not purchasable upgrade. It is expanded functionality of ASC, so upgrade your basic astrocompass to ASC is the only necessary condition to have access to Advanced System Data.
To use solar wind feature for fuel collection you need Hard Way OXP to be installed.

This package minimum requirement is Oolite 1.82. Integer-valued distance format in early versions of Oolite before 1.80 and graphical glitch with distant objects in Oolite 1.80 prevents using of this package in pre-1.82 Oolite versions.

-----------
Change Log:
-----------

03.12.2022 - Version 4.5.2	System Data Sheet on F4 screen now declared as Informational instead Ambience 
01.12.2022 - Version 4.5.1	Code improved to activate System Data Sheet on F4 screen after start-up.
01.12.2022 - Version 4.5.0	Added System Data Sheet on F4 screen.
07.07.2020 - Version 4.4.0	Fixed error in log file generated by SolarSystemData script in case of misjump.
03.07.2020 - Version 4.3.2	Fixed missed parenthesis in manifest.plist preventing download OZX via OXZ manager.
03.07.2020 - Version 4.3.1	Uploaded repeatedly to override problem with downloading version 4.3.0.
02.07.2020 - Version 4.3.0	Redefined sun database based on redefined Habitable Main planets radii.
				Spectral class range now includes suns from F6V to M3.5V.
				AstroLibrary improved again to display added spectral classes.
				Improved script to display info on Planetary System Data MFD page based on redefined planet classification.
23.04.2019 - Version 4.2.0	Tweaked runaway greenhouse trigger in PlanetEngine.
17.04.2019 - Version 4.1.0	Improved function for simple calculation of main planet temperature.
				(still has some discrepancy with result of more complex calculation of planet temperature in PlanetEngine)
06.02.2019 - Version 4.0.0	Sun colors redefined in RGB model.
				Distant Suns and Distant Stares declared as conflicting OXPs in manifest.plist.
04.02.2019 - Version 3.9.0	Fixed error in variable name, preventing display of sun spectral class on F7 System Info page.
02.02.2019 - Version 3.8.0	PlanetEngine improved again - less one empirical quotient, less one IF-THEN-ELSE construction, almost the same result.
02.02.2019 - Version 3.7.0	Improved AstroLibrary functions for calculation of planet atmospheres in PlanetEngine.
31.01.2019 - Version 3.6.1	Converted onto OXZ
04.12.2018 - Version 3.6	More detailed spectral class info displayed (such as G2V or G2.5V instead just G2V)
				Some tweaks in names of variables.
14.09.2018 - Version 3.5	Tweaked sun parameters to synchronize with updated Habitable Main Planets.
				manifest.plist added.
25.08.2018 - Version 3.4	Fixed critical error in calculation of main planet temperature in remote systems.
18.08.2018 - Version 3.3	Tweaked sun parameters for agricultural planets with TL &lt; 4.
17.08.2018 - Version 3.2	Suns of F8V, F9V and M2V spectral class added.
				AstroLibrary improved to display added spectral classes.
				Function main planet size vs sun size recalibrated.
				All main planets centered to Standard Insolation Level with random distance bias � 5%.
				Greenhouse effect is added to calculation of main planet temperature.
12.08.2018 - Version 3.1	Main planet temperature data removed from Sun Data MFD page.
12.06.2018 - Version 3.0	Calculation of additional planet parameters added to AstroLibrary.
				Info pages �Sun Data� and �Planetary System Data� displayed on MFD.
				Info screen is removed as obsolete and unrecommended method. 
19.05.2018 - Version 2.9	Minor tweak in planet classification displayed on planet info page.
13.05.2018 - Version 2.8	AstroLibrary code refactored to satisfy JavaScript strict mode.
28.04.2017 - Version 2.7	AstroLibrary functions improved.
				Sun temperature and mass are calculated functions of sun radius, not fixed predefined values.
27.04.2017 - Version 2.6	Sun parameters upgraded to fit more resent astronomical data.
				Less yellow G-stars, more orange K-stars in star population.
				Sun radii distribution smoothed, every sun on chart has unique radius and luminosity.
				Smoothed function of main planet orbit radius vs sun luminosity with pseudo-random shift provides more accurate matching to habitable zone.
				All 99 Famous Planets (extended set) orbital parameters verified and tuned to match planet texture vs calculated temperature.
				All 8 planetinfo.plist merged onto one planetinfo.plist. Package reassembled onto more simple structure.
				Distance from main planet to sun is redefined in absolute value sun_distance.
				Distance in planet radii (sun_distance_modifier) is abandoned as obsolete method.
				AstroLibrary functions rewritten to adopt new smoothed sun radii feature.
22.10.2016 - Version 2.5	Dynamic solar coronae implemented.
				Solar wind density recalibrated to new model.
				Sun Coronae dictionaries deleted.
				Fixed error in calculation of sun luminosity, reduced to standard Sun candle (used to display Sun Data).
				corona_flare is displayed in Sun Data as human-friendly Sun Activity index in range from 1.00 to 10.00.
20.07.2016 - Version 2.4	Public release of Sun Gear with updated code.
09.07.2016 - Version 2.3	Planetary System Data page code rewritten to adopt expanded planet set from Planetary Systems OXP
				(some info for internal testing added).
25.12.2015 - Version 2.2	Hull temperature info removed from F7 screen.
18.11.2015 - Version 2.1	Sun scale boosted up to 10x.
				M1V star spectral class added.
				Calculation of main planet temperature and ship hull temperature added to AstroLibrary functions.
				AstroLibrary functions generates solar radius, mass and luminosity values with some pseudorandom component.
				Sun info screen divided onto 2 pages - Stellar Data (sun info) and Planetary System Data (planet info).
11.06.2015 - Version 2.0	New sun scale implemented. Sun radii and main planet distances scaled up to 4x.
				Fine tuning of arctic Famous Planets systems - more cold suns for Qutiri, Beusrior, Edorte etc (8 systems readjsted)
27.11.2014 - Version 1.9	Sun database is completely rewritten again :-)
				Local sun_distance_modifier values are restored to fix radii of habit zones.
21.10.2014 - Version 1.8	16 Famous Planets sun radii readjusted to fix conflict with descriptions and texture appearance.
				Solar wind flow check condition switched to Green status.	
22.09.2014 - Version 1.7	Sun database is completely rewritten again. Correlation sun radius vs planet radius refined.
				sun_distance_modifier is fixed to 60 main planet radii for all systems. 
15.09.2014 - Version 1.6	Sun database is completely rewritten to adopt new correlation sun radius vs planet radius.
				Sun coronae also recalculated and rewritten.
28.06.2014 - Version 1.5	Main planet period calculation refined.
				A bit randomness to main planet period added.
				Main planet period info added to Stellar Data screen.
27.06.2014 - Version 1.4	AstroLibrary improved with database of main planet orbital periods.
24.06.2014 - Version 1.3	Spectral class F stars completely removed from database.
				Distribution of other suns readjusted.
				Parameter sun_distance_modifier is readjusted.
				Sun color curve readjusted to Oolite 1.80.
19.05.2014 - Version 1.2	AstroLibrary improved to scan planets, created by Planetary Systems OXP.
14.05.2014 - Version 1.1	Code rewritten to use AstroLibrary global functions.
12.03.2014 - Version 1.0	Fixed bug in solar_wind.js (incorrect test for interstellar space replaced).
20.01.2014 - Version 0.9	Fixed bug in solar_wind.js (overflow of fuel collect counter in close proximity of sun).
07.12.2013 - Version 0.8	Some code refining (not reflected in game functionality).
30.11.2013 - Version 0.7	Corona parameters are completely rewritten.
				Unified version index is implemented (old Sun Coronae Chart 1 version 0.3.oxp, for example, replaced to simple Sun Coronae Chart 1.oxp).
19.11.2013 - Version 0.6	Magnetospheres of celestial bodies are simulated.
				Garbage piece of code removed from sun_info.js (unused variables in startUp function).
				Calculation of solar wind critical density is refined.
16.11.2013 - Version 0.5	Minor bug in sun_info.js fixed (corona_flare value output fixed to 2 digits).
				Old Wildblood licence text removed. 
15.11.2013 - Version 0.4	Nested sun spectra scripts replaced to single script for all 8 charts.
				Solar wind model and new scheme of refuelling implemented. Sun info screen is added.
18.07.2013 - Version 0.3	Wildblood Sun Debugger is removed.
				Brief info for Russian gamers is included.
02.03.2013 - Version 0.2	All 8 Sun Spectra planetinfo.plist are completely rewritten to adopt improved sun model.
				Spectral class M is restricted to M0 stars, M1�M5 stars removed from database.
				Some improvement in color model.
				All 8 Sun Coronae planetinfo.plists are edited - a bit tweak of Wildblood&#39;s coronae.
23.02.2013 - Version 0.1	Initial release.</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ADVANCED_SYSTEM_DATA_MFD.html">Advanced System Data MFD</a></td>
                    <td>no</td>
                    <td align="right">1</td>
                    <td align="center">101+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/astro_library.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;AstroLibrary&quot;;
this.author         = &quot;Stranger&quot;;
this.copyright      = &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description    = &quot;Library of oostronomical functions&quot;;
this.version        = &quot;4.3&quot;;

// SunEngine functions

this.$astroLib_sunSpectrum = function(sunRadius)    // sun spectrum class as function of sun radius
    {
    if (system.isInterstellarSpace) return;
    var spectrum;
    var spectrumSelector;
    if (sunRadius &lt;= 600000)
        {
        spectrumSelector = Math.floor(sunRadius / 30000);
        }
    else
        {
        if(sunRadius &gt; 1000000)
            {
            spectrumSelector = Math.floor((sunRadius + 500000) / 15000);
            }
        else
            {
            spectrumSelector = Math.floor(sunRadius / 10000);
            }
        }
    switch (spectrumSelector)
        {
        // M class red dwarf
        case 12: spectrum = &quot;M3.5V&quot;; break;
        case 13: spectrum = &quot;M3V&quot;; break;
        case 14: spectrum = &quot;M2.5V&quot;; break;
        case 15: spectrum = &quot;M2V&quot;; break;
        case 16: spectrum = &quot;M1.5V&quot;; break;
        case 17: spectrum = &quot;M1V&quot;; break;
        case 18: spectrum = &quot;M0.5V&quot;; break;
        case 19: spectrum = &quot;M0V&quot;; break;
        // K class orange dwarf
        case 60: spectrum = &quot;K9.5V&quot;; break;
        case 61: spectrum = &quot;K9V&quot;; break;
        case 62: spectrum = &quot;K8.5V&quot;; break;
        case 63: spectrum = &quot;K8V&quot;; break;
        case 64: spectrum = &quot;K7.5V&quot;; break;
        case 65: spectrum = &quot;K7V&quot;; break;
        case 66: spectrum = &quot;K6.5V&quot;; break;
        case 67: spectrum = &quot;K6V&quot;; break;
        case 68: spectrum = &quot;K5.5V&quot;; break;
        case 69: spectrum = &quot;K5V&quot;; break;
        case 70: spectrum = &quot;K4.5V&quot;; break;
        case 71: spectrum = &quot;K4V&quot;; break;
        case 72: spectrum = &quot;K3.5V&quot;; break;
        case 73: spectrum = &quot;K3V&quot;; break;
        case 74: spectrum = &quot;K2.5V&quot;; break;
        case 75: spectrum = &quot;K2V&quot;; break;
        case 76: spectrum = &quot;K1.5V&quot;; break;
        case 77: spectrum = &quot;K1V&quot;; break;
        case 78: spectrum = &quot;K0.5V&quot;; break;
        case 79: spectrum = &quot;K0V&quot;; break;
        // G class yellow dwarf
        case 80: spectrum = &quot;G9.5V&quot;; break;
        case 81: spectrum = &quot;G9V&quot;; break;
        case 82: spectrum = &quot;G8.5V&quot;; break;
        case 83: spectrum = &quot;G8V&quot;; break;
        case 84: spectrum = &quot;G7.5V&quot;; break;
        case 85: spectrum = &quot;G7V&quot;; break;
        case 86: spectrum = &quot;G6.5V&quot;; break;
        case 87: spectrum = &quot;G6V&quot;; break;        
        case 88: spectrum = &quot;G5.5V&quot;; break;
        case 89: spectrum = &quot;G5V&quot;; break;
        case 90: spectrum = &quot;G4.5V&quot;; break;
        case 91: spectrum = &quot;G4V&quot;; break;
        case 92: spectrum = &quot;G3.5V&quot;; break;
        case 93: spectrum = &quot;G3V&quot;; break;
        case 94: spectrum = &quot;G2.5V&quot;; break;
        case 95: spectrum = &quot;G2V&quot;; break;
        case 96: spectrum = &quot;G1.5V&quot;; break;
        case 97: spectrum = &quot;G1V&quot;; break;
        case 98: spectrum = &quot;G0.5V&quot;; break;
        case 99: spectrum = &quot;G0V&quot;; break;
        // F class white hot star
        case 100: spectrum = &quot;F9.5V&quot;; break;
        case 101: spectrum = &quot;F9V&quot;; break;
        case 102: spectrum = &quot;F8.5V&quot;; break;
        case 103: spectrum = &quot;F8V&quot;; break;
        case 104: spectrum = &quot;F7.5V&quot;; break;
        case 105: spectrum = &quot;F7V&quot;; break;
        case 106: spectrum = &quot;F6.5V&quot;; break;
        case 107: spectrum = &quot;F6V&quot;; break;
        default: spectrum = null;
        };    
    return spectrum;
    }

this.$astroLib_sunTemperature = function(sunRadius)    // sun temperature as function of sun radius
    {
    if (system.isInterstellarSpace) return;
    var solarTemperature;
    if (sunRadius &lt;= 600000)
        {
        solarTemperature = 4000 - (600000 - sunRadius) / 300;
        }
    else
        {
        if (sunRadius &gt; 1000000)
            {
            solarTemperature = 6000 + (sunRadius - 1000000) / 300;
            }
        else
            {
            solarTemperature = 6000 - (1000000 - sunRadius) / 200;
            }
        }  
    var solarTemperatureTweaked = solarTemperature - 25 + 50 * system.scrambledPseudoRandomNumber(119);
    return solarTemperatureTweaked;
    }

this.$astroLib_sunLuminosity = function(sunTemperature, sunRadius)    // sun luminosity as function of sun radius
    {
    if (system.isInterstellarSpace) return;   
    var sunLuminosity = Math.pow((sunTemperature / 6000),4) * Math.pow((sunRadius / 1000000),2); // Stefan-Boltzmann law
    return sunLuminosity;
    }

this.$astroLib_sunMass = function(sunRadius)    // sun mass as function of sun radius
    {
    if (system.isInterstellarSpace) return;
    var solarMass;
    if (sunRadius &lt;= 300000)
        {
    solarMass = 0.175;
        }
    else
        {
        solarMass = 1.0 - (960000 - sunRadius) / 1000000 * 1.25;
        }    
    var sunMassTweaked = solarMass * (0.975 + 0.05 * system.scrambledPseudoRandomNumber(120));
    return sunMassTweaked;
    }

this.$astroLib_solPeriod = function(sunMass)    // main planet period as function of sun mass
    {
    if (system.isInterstellarSpace) return;   
    var standardOU = 63750 * 675;   // Sol-Terra system twin AU
    var standardYear = 365.25;   // standard year for Sol-Terra system twin
    var mainOrbitVector = new Vector3D(system.sun.position.subtract(system.mainPlanet.position));
    var ouScale = mainOrbitVector.magnitude();  // OU in custom system
    var mainPeriod = standardYear * Math.pow((ouScale / standardOU),1.5) / Math.pow(sunMass,0.5); // 3rd Kepler low
    return mainPeriod;
    }

this.$astroLib_orbitRadius = function()         // planet orbits in OU
    {
    if (system.isInterstellarSpace) return;
    var mainOrbitVector = new Vector3D(system.sun.position.subtract(system.mainPlanet.position));
    var ouScale = mainOrbitVector.magnitude();
    var planetsOrbitsOU = new Array();
    var planetOrbitVector;
    for (let i=0; i&lt;system.planets.length; i++)
        {
        planetOrbitVector = new Vector3D(system.sun.position.subtract(system.planets[i].position));
        planetsOrbitsOU[i] = planetOrbitVector.magnitude() / ouScale;
        }
    return planetsOrbitsOU;    
    }

this.$astroLib_mainPlanetTemperature = function(sunLuminosity,sunDistance,mainPlanetRadius)  // main planet temperature - simplified function of radius
    {
    if (system.isInterstellarSpace) return;    
    var mainInsolation = sunLuminosity * Math.pow((50000000 / sunDistance),2);
    var equilibriumTemperature = 255 * Math.pow(mainInsolation,0.25);
    var mainTemperature;
    mainTemperature = equilibriumTemperature + (mainPlanetRadius - 4800) * 3 / 400 + 20;    
    return mainTemperature;
    }

this.$astroLib_SolarWind = function(sunDistance)    // solar wind. Used to collect fuel
	{
    if (system.isInterstellarSpace) return;
    var solarWindDensity = (system.sun.radius * system.sun.radius) / (sunDistance * sunDistance) * system.info.corona_flare;
    if (player.alertCondition != 1)
        {
        solarWindDensity = 0;
        }
    var solarWindFlux;
    if(player.ship.speed &gt; player.ship.maxSpeed)
        {
        solarWindFlux = solarWindDensity * player.ship.maxSpeed;
        }
    else
        {
        solarWindFlux = solarWindDensity * player.ship.speed;      //rate of fuel collection, LY/min          
        }
    return solarWindFlux;
	}

// PlanetEngine functions

this.$astroLib_insolation = function(sunLuminosity, sunDistance)    // insolation level
    {
    if (system.isInterstellarSpace) return;   
    var insolation = sunLuminosity * Math.pow((50000000 / sunDistance),2);
    return insolation;    
    }

this.$astroLib_equilibriumTemperature = function(insolation)    // equilibrium temperature without greenhouse effect. Albedo same as Earth
    {
    if (system.isInterstellarSpace) return;   
    var equilibriumTemperature = 255 * Math.pow(insolation,0.25);
    return equilibriumTemperature;
    }

this.$astroLib_planetDensity = function(planetRadius, equilibriumTemperature)   // planet density as function of planet radius and equilibrium temperature
    {
    if (system.isInterstellarSpace) return; 
    var planetDensity = 0.925 + Math.sqrt(planetRadius / 302.5) * Math.sqrt(equilibriumTemperature / 255);
    return planetDensity;
    }

this.$astroLib_escapeVelocity = function(planetRadius, planetDensity)   // escape velocity as function of planet radius and density
    {
    if (system.isInterstellarSpace) return;
    var escapeVelocity = 11180 * planetRadius / 6400 * Math.sqrt(planetDensity / 5.5);
    return escapeVelocity;
    }

this.$astroLib_surfaceGravity = function(planetRadius, escapeVelocity)  // planet surface gravity as function of planet radius and escape velocity
    {
    if (system.isInterstellarSpace) return;
    var surfaceGravity = escapeVelocity * escapeVelocity / (planetRadius * 1000) / (9.81 * 2);
    return surfaceGravity;
    }

this.$astroLib_atmosphereMass = function(planetRadius, escapeVelocity, equilibriumTemperature) // mass of atmosphere per unit of surface square as function of planet radius, escape velocity and equilibrium temperature
    {
    if (system.isInterstellarSpace) return;
    var termosphereTemperature = equilibriumTemperature * 4;
    var termosphereVelocity = 320 * Math.sqrt(termosphereTemperature / 273.15);
    var dissipation_ratio = termosphereVelocity / escapeVelocity;
    var dissipation_adjust = dissipation_ratio * 25;
    var volatile_pool = planetRadius / 1600 * Math.pow(255 / equilibriumTemperature,2);
    var atmosphereMass;
    var insolation = Math.pow(equilibriumTemperature / 255,4);
    var volatile_adjust = (planetRadius - 6250) / 100;
    if (insolation &gt; 1.75 &amp;&amp; planetRadius &gt; 6250 &amp;&amp; planetRadius &lt; 7500)    // runaway greenhouse trigger
        {
        atmosphereMass = volatile_pool * Math.exp(-dissipation_adjust) * (1 + volatile_adjust * volatile_adjust);
        }
    else
        {
        atmosphereMass = volatile_pool * Math.exp(-dissipation_adjust);
        }
    return atmosphereMass;
    }

this.$astroLib_atmospherePressure = function(atmosphereMass, surfaceGravity)    // atmosphere pressure as function of atmosphere mass and surface gravity
    {
    if (system.isInterstellarSpace) return;
    var atmospherePressure = atmosphereMass * surfaceGravity;
    return atmospherePressure;
    }

this.$astroLib_atmosphereTemperature = function(equilibriumTemperature, atmosphereMass) // planet surface temperature as function of equilibrium temperature and atmosphere mass (greenhouse effect)
    {
    if (system.isInterstellarSpace) return;
    var atmosphereTemperature = equilibriumTemperature + 0.125 * equilibriumTemperature * Math.sqrt(atmosphereMass);
    return atmosphereTemperature;
    }
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/solar_activity.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name				= &quot;SolarActivity&quot;;
this.author				= &quot;Stranger&quot;;
this.copyright			= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description		= &quot;Dynamic solar flares&quot;;
this.version			= &quot;2.5&quot;;

this.shipWillLaunchFromStation = this.shipWillExitWitchspace = function()
    {
    if (system.isInterstellarSpace) return;
    var info = system.info;
    // regular case
    var flareBasic = 0.10 + Math.random() * 0.10; 
    var flareRate = 0.10 * 1000000 / system.sun.radius;     // red dwarves has more frequent flares than yellow stars
    var flareFlux = 0.30;
    // peculiar solar activity mentioned in system description
    if (system.info.description.indexOf(&quot;occasional solar activity&quot;) &gt; -1)
        {
        flareRate = 0.30;
        flareFlux = 0.40;
        }
    if (system.info.description.indexOf(&quot;unpredictable solar activity&quot;) &gt; -1)
        {
        flareRate = 0.35;
        flareFlux = 0.50;
        }
    if (system.info.description.indexOf(&quot;frequent solar activity&quot;) &gt; -1)
        {
        flareRate = 0.40;
        flareFlux = 0.60;
        }
    if (system.info.description.indexOf(&quot;dreadful solar activity&quot;) &gt; -1)
        {
        flareRate = 0.45;
        flareFlux = 0.70;
        }
    if (system.info.description.indexOf(&quot;deadly solar activity&quot;) &gt; -1)
        {
        flareRate = 0.50;
        flareFlux = 0.80;
        }
    var flareTrigger = Math.random();
    // active sun
    if (flareTrigger &lt; flareRate)
        {
        info.corona_flare = flareBasic + Math.random() * flareFlux;
        }
    // quiet sun
    else
        {
        info.corona_flare = flareBasic;
        }
    }
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/solar_system_data.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name    = &quot;SolarSystemData&quot;;
this.author = &quot;Stranger&quot;;
this.copyright = &quot;This work is hereby placed in the public domain.&quot;;
this.description = &quot;Displays system sun and planet data on MFD and F4 info page.&quot;;
this.version = &quot;4.5.2&quot;;

this.startUpComplete = function()
    {
    this.self = player.ship;
    this.$setupDelay = new Timer(this, this.$setupSystemInfo, 1);    //delay to set planet orbits!
    }

this.shipWillLaunchFromStation = this.shipWillExitWitchspace = function()
    {
    if (system.isInterstellarSpace) return;
    if(this.self.equipmentStatus(&quot;EQ_ADVANCED_COMPASS&quot;) == &quot;EQUIPMENT_OK&quot;)
        {
        this.self.awardEquipment(&quot;EQ_ADVANCED_SYSTEM_DATA_MFD&quot;);
        this.$scriptDelay = new Timer(this, this.$setupSystemInfo, 1);
        this.$startUpdateMFDTimer();
        }
    else
        {
        this.self.removeEquipment(&quot;EQ_ADVANCED_SYSTEM_DATA_MFD&quot;);
        }
    }

this.$startUpdateMFDTimer = function()
	{
	if(this.$updateMFDTimer)
		{ this.$updateMFDTimer.start(); }
	else
		{ this.$updateMFDTimer = new Timer(this, this.$updateMFD,0,1); }
	}

this.shipWillDockWithStation = this.shipDied = this.$stop$updateMFDTimer = function()
	{   
	if(this.$updateMFDTimer &amp;&amp; this.$updateMFDTimer.isRunning) { this.$updateMFDTimer.stop(); } 
	}

this.$updateMFD = function()
    {
    if(this.self.equipmentStatus(&quot;EQ_ADVANCED_COMPASS&quot;) != &quot;EQUIPMENT_OK&quot;) return;
    if(this.self.compassMode === &quot;COMPASS_MODE_SUN&quot;)
        {
        this.$starPage();
        }
    else
        {
        this.$planetPage();
        }
    }

this.$starPage = function()
	{
    var w = worldScripts.AstroLibrary;
	var info = system.info;
	var catNum = &quot; &quot; + galaxyNumber + &quot; &quot; + system.ID;
    if (system.info.sun_radius)
		{
        var sunRadius = system.sun.radius;
		}
    var sunDistance = player.ship.position.distanceTo(system.sun).toFixed(0);
    var sunRelDistance = (sunDistance/system.sun.radius);
    var solarWind = w.$astroLib_SolarWind(sunDistance);
    var solarActivity = 10 * info.corona_flare;

    var output = &quot;Catalog number: &quot; + catNum + &quot;\n&quot;
	                + &quot;Spectral class: &quot; + this.$spectrumText + &quot;\n&quot;
	                + &quot;Radius: &quot; + this.$solRadius.toFixed(2) + &quot;\n&quot;
	                + &quot;Mass: &quot; + this.$sunMass.toFixed(2) + &quot;\n&quot;
                    + &quot;Luminosity: &quot; + this.$solLuminosity.toFixed(2) + &quot;\n&quot;
	                + &quot;Solar activity: &quot; + solarActivity.toFixed(2) + &quot;\n&quot;                    
                    + &quot;Main planet period: &quot; + this.$localYear.toFixed(2) + &quot; days&quot; + &quot;\n&quot;
	                + &quot;Sun distance: &quot; + sunRelDistance.toFixed(2) + &quot; R&quot; + &quot;\n&quot;
	                + &quot;Solar wind flux: &quot; + solarWind.toFixed(2) + &quot; LY/min&quot; + &quot;\n\n&quot;;
    
    this.self.setMultiFunctionText(&quot;EQ_ADVANCED_SYSTEM_DATA_MFD&quot;, output, false);
	}

this.$planetPage = function()
    {
    var output = this.$planetOrbitInfo;
    this.self.setMultiFunctionText(&quot;EQ_ADVANCED_SYSTEM_DATA_MFD&quot;, output, false);
    }

this.$setupSystemInfo = function()
    {
    var w = worldScripts.AstroLibrary;
    // sun info
	var info = system.info;
	var catNum = &quot; &quot; + galaxyNumber + &quot; &quot; + system.ID;
    if (system.info.sun_radius)
		{
        var sunRadius = system.sun.radius;
		}
    var spectrumText = w.$astroLib_sunSpectrum(sunRadius);
    var solRadius = system.sun.radius/950000 * (0.99 + 0.02 * system.scrambledPseudoRandomNumber(119));
    var sunMass = w.$astroLib_sunMass(sunRadius);
    var sunTemperature = w.$astroLib_sunTemperature(sunRadius);
    var sunLuminosity = w.$astroLib_sunLuminosity(sunTemperature,sunRadius);
    var solLuminosity = 1.31 * sunLuminosity; // use for display only, not in real calculations!
    var localYear = w.$astroLib_solPeriod(sunMass);
    this.$spectrumText = spectrumText;
    this.$solRadius = solRadius;
    this.$sunMass = sunMass;
    this.$solLuminosity = solLuminosity;
    this.$localYear = localYear;
    // planet info
    var infoFlag = 1;
    var planetMaxNumber = 8;
    var planetOrbitInfoRow = new Array();
    planetOrbitInfoRow[0] = &quot;1.00 OU * Main Planet\n&quot;;
    for (let i=1; i&lt;planetMaxNumber; i++)
        {
        planetOrbitInfoRow[i] = &quot;&quot;;
        } 
    var planetOrbitRadius;
    var planetRadius;
    var planetDataTag;
    var planetOrbitScan = w.$astroLib_orbitRadius();
    var planetOrbitInfo = &quot;PLANETS&quot; + &quot;\n&quot;;
    for (let i=0; i&lt;system.planets.length; i++)
        {
        planetOrbitRadius = planetOrbitScan[i];
        planetRadius = system.planets[i].radius;

        if(system.planets[i].radius &lt; 25000)     
            {
            planetDataTag = 0;
            }
        if(system.planets[i].radius &gt;= 27500 &amp;&amp; system.planets[i].radius &lt; 30000 &amp;&amp; system.planets[i] != system.mainPlanet)
            {
            planetDataTag = 1;
            } 
        if(system.planets[i].radius &gt;= 50000 &amp;&amp; system.planets[i].radius &lt; 75000 &amp;&amp; system.planets[i] != system.mainPlanet)
            {
            planetDataTag = 2;
            }
        if(system.planets[i].radius &gt;= 30000 &amp;&amp; system.planets[i].radius &lt; 50000 &amp;&amp; system.planets[i] != system.mainPlanet)
            {
            planetDataTag = 3;
            }
        if(system.planets[i].radius &gt;= 75000 &amp;&amp; system.planets[i].radius &lt; 100000 &amp;&amp; system.planets[i] != system.mainPlanet)
            {
            planetDataTag = 4;
            }
        if(system.planets[i].radius &gt;= 150000 &amp;&amp; system.planets[i].radius &lt; 175000 &amp;&amp; system.planets[i] != system.mainPlanet)
            {
            planetDataTag = 5;
            } 
        if(system.planets[i].radius &gt;= 125000 &amp;&amp; system.planets[i].radius &lt; 150000 &amp;&amp; system.planets[i] != system.mainPlanet)
            {
            planetDataTag = 6;
            } 
        if(system.planets[i].radius &gt;= 100000 &amp;&amp; system.planets[i].radius &lt; 125000 &amp;&amp; system.planets[i] != system.mainPlanet)
            {
            planetDataTag = 7;
            } 
        if(system.planets[i].radius &gt;= 25000 &amp;&amp; system.planets[i].radius &lt; 27500 &amp;&amp; system.planets[i] != system.mainPlanet)       
            {
            planetDataTag = 8;
            }
        
        switch (planetDataTag)
            {
            case 0: infoFlag = 0; break;
            case 1: planetOrbitInfoRow[1] = planetOrbitRadius.toFixed(2) + &quot; OU * Miniterra\n&quot;; break;
            case 2: planetOrbitInfoRow[2] = planetOrbitRadius.toFixed(2) + &quot; OU * Terra\n&quot;; break;
            case 3: planetOrbitInfoRow[3] = planetOrbitRadius.toFixed(2) + &quot; OU * Subterra\n&quot;; break;
            case 4: planetOrbitInfoRow[4] = planetOrbitRadius.toFixed(2) + &quot; OU * Superterra\n&quot;; break;
            case 5: planetOrbitInfoRow[5] = planetOrbitRadius.toFixed(2) + &quot; OU * Gas Giant\n&quot;; break;
            case 6: planetOrbitInfoRow[6] = planetOrbitRadius.toFixed(2) + &quot; OU * Gas Giant\n&quot;; break;
            case 7: planetOrbitInfoRow[7] = planetOrbitRadius.toFixed(2) + &quot; OU * Ice Giant\n&quot;; break;
            case 8: planetOrbitInfoRow[8] = planetOrbitRadius.toFixed(2) + &quot; OU * Dwarf Terra\n&quot;; break;
            }
        }

    for (let i=0; i&lt;planetOrbitInfoRow.length; i++)
        {
        planetOrbitInfo += planetOrbitInfoRow[i];
        }
        this.$planetOrbitInfo = planetOrbitInfo;
    
    if(this.self.docked) this.$initInterface(this.self.dockedStation);
    }

this.shipWillDockWithStation = this.shipWillEnterWitchspace = function()
	{
    this.shipDied();
    }

this.shipDied = function()
	{
	if(this.$scriptDelay) 
		{
		this.$scriptDelay.stop();
		delete this.$scriptDelay;
		}
    }

this.shipDockedWithStation = function(station)
    {
    this.$setupSystemInfo();    
    if (this.self.dockedStation.isMainStation == true)
        {
        this.$initInterface(station);    
        }
    }

this.$initInterface = function(station)
    {
	station.setInterface(this.name,{
		title:&quot;System Data Sheet&quot;,
		category:&quot;Informational&quot;,
		summary:&quot;Provide advanced system data&quot;,
		callback:this.$setupSystemInfoPage.bind(this)
        });
    }

this.$setupSystemInfoPage = function()
    {
    var systemAdvancedInfo = &quot;SUN&quot; + &quot;\n&quot;
	                + &quot;Spectral class: &quot; + this.$spectrumText + &quot;\n&quot;
	                + &quot;Radius: &quot; + this.$solRadius.toFixed(2) + &quot;\n&quot;
	                + &quot;Mass: &quot; + this.$sunMass.toFixed(2) + &quot;\n&quot;
                    + &quot;Luminosity: &quot; + this.$solLuminosity.toFixed(2) + &quot;\n&quot;                   
                    + &quot;Main planet period: &quot; + this.$localYear.toFixed(2) + &quot; days&quot; + &quot;\n&quot;
                    + &quot;\n&quot;
                    + this.$planetOrbitInfo;

    mission.runScreen({
        title: &quot;System Data Sheet&quot;,
//        background: {name: &quot;specialCargoLoad.png&quot;, height: 480 },
        message: systemAdvancedInfo,}
        );     
    }</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/spectral_class.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name    = &quot;SunSpectralAnalyzer&quot;;
this.author = &quot;Stranger&quot;;
this.copyright = &quot;This work is hereby placed in the public domain.&quot;;
this.description = &quot;Conversion sun color to spectral index&quot;;
this.version = &quot;3.9&quot;;

//This script inspired and partly based on Wildblood&#39;s Spectroscope script

this.guiScreenChanged = function()
	{
	if (guiScreen === &quot;GUI_SCREEN_SYSTEM_DATA&quot;)
		{
		var info = System.infoForSystem(galaxyNumber, player.ship.targetSystem);
		if (info.sun_gone_nova) return;
		var w = worldScripts.AstroLibrary;
		var name = info.name;
		var sunName = info.sun_name;
        var sunRadius = info.sun_radius; 
		var spectrumText = w.$astroLib_sunSpectrum(sunRadius);
		if (spectrumText &amp;&amp; sunName) mission.addMessageText(&quot;The planet &quot; + name + &quot; orbits the &quot; + spectrumText + &quot; &quot; + sunName + &quot;.&quot;);
		else if (spectrumText) mission.addMessageText(&quot;The planet &quot; + name + &quot; orbits a &quot; + spectrumText + &quot; &quot; + &quot;star.&quot;);
		else if (sunName) mission.addMessageText(&quot;The planet &quot; + name + &quot; orbits the star &quot; + sunName + &quot;.&quot;);
		}
	}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
