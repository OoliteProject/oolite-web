<html>
    <head>
        <title>Expansion VimanaHUD</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion VimanaHUD</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">6 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">4 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Required Expansions mismatch between OXP Manifest and Expansion Manager at character position 0060 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
                <li>Optional Expansions mismatch between OXP Manifest and Expansion Manager at character position 0073 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
                <li>Conflict Expansions mismatch between OXP Manifest and Expansion Manager at character position 0067 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>The Vimana HUD is the newest in spaceship cockpits, with all functions and features gathered in a slick futuristic design. It changes IFF scanner color based on conditions (Deepspace/Mass-Locked/Alert). New crosshairs compatible with AutoCrosHair. WARNING: The ship overrides that increased cargo space were moved to VimanaShipOverrides OXP (listed in Ships category) - install that OXP before loading a savefile of a core game ship or cargo may be lost!</td>
                    <td>The Vimana HUD is the newest in spaceship cockpits, with all functions and features gathered in a slick futuristic design. It changes IFF scanner color based on conditions (Deepspace/Mass-Locked/Alert). New crosshairs compatible with AutoCrosHair. WARNING: The ship overrides that increased cargo space were moved to VimanaShipOverrides OXP (listed in Ships category) - install that OXP before loading a savefile of a core game ship or cargo may be lost!</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Gnievmir.VimanaHUD</td>
                    <td>oolite.oxp.Gnievmir.VimanaHUD</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>VimanaHUD</td>
                    <td>VimanaHUD</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>HUD</td>
                    <td>HUD</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Gnievmir</td>
                    <td>Gnievmir</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.07</td>
                    <td>2.07</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.Norby.CombatMFD:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Norby.CombatMFD:</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                            <li>oolite.oxp.Gnievmir.VimanaShipOverrides:0</li>
                            <li>oolite.oxp.Norby.HUDSelector:1.18</li>
                            <li>oolite.oxp.Thargoid.RepairBots:2.14</li>
                            <li>oolite.oxp.CommonSenseOTB.ShieldEqualizer+Capacitors:1.3</li>
                            <li>oolite.oxp.Lone_Wolf.ShieldCyclerNext:2.1</li>
                            <li>oolite.oxp.CommonSenseOTB.SniperLock:1.0</li>
                            <li>oolite.oxp.EricWalch.MissileAnalyser:1.2</li>
                            <li>oolite.oxp.hoqllnq.missile-beep:1.3</li>
                            <li>oolite.oxp.phkb.LMSS:2.1</li>
                            <li>oolite.oxp.Thargoid.IronHide:2.00</li>
                            <li>oolite.oxp.Wildeblood.AutoCrosshairs:1.1.1</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Gnievmir.VimanaShipOverrides:</li>
                            <li>oolite.oxp.Norby.HUDSelector:1.18</li>
                            <li>oolite.oxp.Thargoid.RepairBots:2.14</li>
                            <li>oolite.oxp.CommonSenseOTB.ShieldEqualizer+Capacitors:1.3</li>
                            <li>oolite.oxp.Lone_Wolf.ShieldCyclerNext:2.1</li>
                            <li>oolite.oxp.CommonSenseOTB.SniperLock:1.0</li>
                            <li>oolite.oxp.EricWalch.MissileAnalyser:1.2</li>
                            <li>oolite.oxp.hoqllnq.missile-beep:1.3</li>
                            <li>oolite.oxp.phkb.LMSS:2.1</li>
                            <li>oolite.oxp.Thargoid.IronHide:2.00</li>
                            <li>oolite.oxp.Wildeblood.AutoCrosshairs:1.1.1</li>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                            <li>oolite.oxp.Lone_Wolf.ShieldCycler:0</li>
                            <li>oolite.oxp.Lone_Wolf.ShieldCyclerNext:0</li>
                            <li>oolite.oxp.Wildeblood.alerting_crosshairs:0</li>
                            <li>oolite.oxp.Wildeblood.LaserificCrosshairs:0</li>
                            <li>oolite.oxp.Wildeblood.ShieldtasticCrosshairs:0</li>
                            <li>oolite.oxp.AndreyBelov.Targeter:0</li>
                            <li>oolite.oxp.Wildeblood.ActiveCrosshairs:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Lone_Wolf.ShieldCycler:</li>
                            <li>oolite.oxp.Lone_Wolf.ShieldCyclerNext:</li>
                            <li>oolite.oxp.Wildeblood.alerting_crosshairs:</li>
                            <li>oolite.oxp.Wildeblood.LaserificCrosshairs:</li>
                            <li>oolite.oxp.Wildeblood.ShieldtasticCrosshairs:</li>
                            <li>oolite.oxp.AndreyBelov.Targeter:</li>
                            <li>oolite.oxp.Wildeblood.ActiveCrosshairs:</li>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/0/0e/VimanaHUD-2.07.oxz">https://wiki.alioth.net/img_auth.php/0/0e/VimanaHUD-2.07.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-SA 4.0</td>
                    <td>CC BY-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873230</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/VimanaHUD'>http://wiki.alioth.net/index.php/VimanaHUD</a></p>
        <h3>Readme.txt</h3>
        <pre>VimanaHUD OXP
-------------
v2.07, by Gnievmir

Vimana HUD is a full featured Heads Up Display, overlaying a complex dashboard over the external optical feed shown in your viewscreen.

It has analogic/digital gauges for Speed, Fuel, Altitude, Cargo, Cabin Temperature, Forward and Aft Shield Strength, Energy, Armour and Laser Temperature; icons describing existence and readiness of Fuel Injectors, Fuel Scoops, Energy Unit (EEU or NEU), ECM, LMSS, Repair System, Shield Capacitors and Shield Equalizer or Shield Cycler. 

It describes the primed equipment and the next primeable equipment in the cycle, the weapon mounted in the current view direction, and the available capacity for Anti-Missile System darts and Repair System charges.

There are custom crosshairs for each alert condition, and visual alerts, warnign and critical levels, for energy, cabin temperature, shield strength, and altitude.

There are two versions of the in-flight HUD, one with 6 MFDs and other with 12 MFDs, though the lower 2 MFD slots in the 12-slots version should only be used on widescreen monitors. There is a docked HUD that shows information on the screen borders, leaving the centre free for the station interfaces.

The expansion modules, available on Ship Outfitting (F3) screen, show information that usually would be shown on MFDs.

Equipments
----------

- Travel Module, available at TL 6 for 1,000 ₢

Shows multiple witchspace destinations, with distance/fuel consumption, travel time and number of jumps.


- Ship Module, available at TL 6 for 1,500 ₢

Shows damage status of ship&#39;s equipment.


- Target Module, available at TL 6 for 2,500 ₢

Displays information on current target.


- TFSystem, available at TL 7 for 3,100 ₢

Target Filtering System, allows selection of targets by class: hostile/outlaw, police, thargoid, neutral, cargo, asteroids, etc.


- Vimana Beam Laserm available at TL 9 for 15,000 ₢

A low heat beam laser with low energy footprint, range of 25km. Alternative to Military Laser.


License
-------

Creative Commons Attribution Non-Comercial Share-Alike 4.0 (https://creativecommons.org/licenses/by-nc-sa/4.0/)

Version History
---------------
v2.07 (by Dybal)

* Fixes display of Repair System status.

v2.06 (by Dybal)

* Moves overriding of ship characteristics to VimanaShipOverrides OXP.
* Fixes Repair System worldScript name.
* Makes HUD compatible with HUD Selector.
* Updates compatibility with Repair Bots 2.14, Shield Equalizer and Capacitors v1.6+, SniperLock Plus.
* Changes Repair Bots, Shield Equalizer and Capacitos, SniperLock, Missile Analyser, Missile Beep, LMSS, Iron Hide and Auto Crosshairs from required to optional.
* Makes it compatible with Shield Cycler Next v2.0+.
* Adds a 12-MFDs version.
* Makes it incompatible with Active Crosshairs OXP (it overrides the HUD&#39;s crosshairs).
* Adds central dot to crosshairs.
* Sets crosshairs before launch.
* Adds docked version of the HUD, displaying info on the screen borders and leaving the screen centre free for Station Interfaces.
* Keeps the Compass target when an ident or missile target is acquired.
* Uses beacon label, if defined, for Compass target display
* Doesn&#39;t display shield low warning in Torus Drive (for HardWay OXP users).

v2.05

* Initial version published by Gnievmir on http://aegidian.org/bb/viewtopic.php?p=268089

</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TARGET_FILTERING_SYSTEM.html">TFSys</a></td>
                    <td>yes</td>
                    <td align="right">31000</td>
                    <td align="center">7+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TARGET_FILTERING_SYSTEM_REMOVAL.html">Sell TFSys</a></td>
                    <td>yes</td>
                    <td align="right">420</td>
                    <td align="center">11+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_VIMANA_SHIP_MODULE.html">Ship Mod</a></td>
                    <td>yes</td>
                    <td align="right">15000</td>
                    <td align="center">6+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_VIMANA_TARGET_MODULE.html">Target Mod</a></td>
                    <td>yes</td>
                    <td align="right">25000</td>
                    <td align="center">6+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_VIMANA_TRAVEL_MODULE.html">Travel Mod</a></td>
                    <td>yes</td>
                    <td align="right">10000</td>
                    <td align="center">6+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_WEAPON_VIMANA_BEAM.html">Vimana Beam</a></td>
                    <td>yes</td>
                    <td align="right">150000</td>
                    <td align="center">9+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/TFS-equip.js</td>
                    <td><pre>&#39;use strict&#39;;

this.author  = &#39;Andrey Belov&#39;;
this.licence = &#39;CC-BY-NC-SA 3.0&#39;;

this.TFS = worldScripts[&#39;Target Filtering System&#39;];

// Handle event &quot;mode&quot; for prime equipment
this.mode = function() {
    if ( player.ship.equipmentStatus(&#39;EQ_TARGET_FILTERING_SYSTEM&#39;) !== &#39;EQUIPMENT_OK&#39; ) return;
    if ( ++this.TFS._mode &gt; 5 ) this.TFS._mode = 0;
    this._showMsg( &#39;timer.tfs@mode&#39;, &#39;TFS mode: &#39; + [&#39;hostile/outlaw&#39;,&#39;thargon&#39;,&#39;police&#39;,&#39;neutral&#39;,&#39;cargo&#39;,&#39;asteroids&#39;][this.TFS._mode] );
};

this._showMsg = function(key, msg) {
    player.consoleMessage(msg, 1);
};

//Handle event &quot;activated&quot; for prime equipment
this.activated = function() {
    if ( player.ship.equipmentStatus(&#39;EQ_TARGET_FILTERING_SYSTEM&#39;) === &#39;EQUIPMENT_OK&#39; ) {
        this._setNextTarget();
    }
};

this._setNextTarget = function() {
    var targets = [];

    if ( 0 === this.TFS._mode ) {
        targets = this._getHostileShips();

        if ( targets.length &lt; 1 ) {
            targets = this._getOutlawShips();
        }
    }
    else if ( 1 === this.TFS._mode ) {
        targets = this._getThargoids();
    }
    else if ( 2 === this.TFS._mode ) {
        targets = this._getPolice();
    }
    else if ( 3 === this.TFS._mode ) {
        targets = this._getNeutralShips();
    }
    else if ( 4 === this.TFS._mode ) {
        targets = this._getCargoPods();
    }
    else if ( 5 === this.TFS._mode ) {
        targets = this._getAsteroids();
    }

    var len = targets.length - 1;

    if ( len &lt; 0 ) {
        return;
    }

    this._sortByDistance(targets);

    var ptn = 0;
    if ( player.ship.target ) {
        ptn = TFS._getPreviousTargetNum();
        ptn = ptn &gt;= len ? 0 : ptn + 1;
        TFS._setPreviousTargetNum(ptn);
    }
    var nextTarget = targets[ptn];

    if ( player.ship.target &amp;&amp; player.ship.target === nextTarget ) {
        return;
    }

    player.ship.target = nextTarget;
};

this._getHostileShips = function() {
    if ( ! player.alertHostiles ) {
        return [];
    }
    return this._filterEntities(
        function(e) { return ( e.isShip &amp;&amp; e.hasHostileTarget &amp;&amp; e.target === player.ship ); }
    );
};

this._getOutlawShips = function() {
    if ( 1 &gt; player.alertCondition ) {
        return [];
    }
    return this._filterEntities(
        function(e) { return ( e.scanClass === &#39;CLASS_NEUTRAL&#39; &amp;&amp; e.bounty !== 0 ); }
    );
};

this._getNeutralShips = function() {
    if ( 1 &gt; player.alertCondition ) {
        return [];
    }
    return this._filterEntities(
        function(e) { return ( e.scanClass === &#39;CLASS_NEUTRAL&#39; &amp;&amp; e.bounty === 0 ); }
    );
};

this._getCargoPods = function() {
    return this._filterEntities(
        function(e) { return ( e.scanClass === &#39;CLASS_CARGO&#39; ); }
    );
};

this._getThargoids = function() {
    return this._filterEntities(
        function(e) { return ( e.scanClass === &#39;CLASS_THARGOID&#39; ); }
    );
};

this._getPolice = function() {
    return this._filterEntities(
        function(e) { return ( e.scanClass === &#39;CLASS_POLICE&#39; ); }
    );
};

this._getAsteroids = function() {
    return this._filterEntities(
        function(e) { return ( e.scanClass === &#39;CLASS_ROCK&#39; ); }
    );
};

this._filterEntities = function(filterFunc) {
    return system.filteredEntities(
        this,
        filterFunc,
        player.ship,
        player.ship.scannerRange
    );
};

this._sortByDistance = function(targets) {
    var cache = {};
    // sort
    targets.sort( function sortByDist(a,b) {
        // cache distance
        //var ai=a.ID,bi=b.ID; // work only with my patch with universalID getter :(
        var
        ai = a.entityPersonality,
        bi = b.entityPersonality; // use some &quot;uniq&quot; ident
        cache[ai] = cache[ai] || a.position.distanceTo(player.ship.position);
        cache[bi] = cache[bi] || b.position.distanceTo(player.ship.position);
        return ((cache[ai]&lt;cache[bi])?-1:((cache[ai]&gt;cache[bi])?1:0));
    } );
};
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TFS.js</td>
                    <td><pre>&#39;use strict&#39;;

this.author  = &#39;Andrey Belov&#39;;
this.licence = &#39;CC-BY-NC-SA 3.0&#39;;

this.name    = &#39;Target Filtering System&#39;;
//oryginal name &quot;Target System Upgrade&quot;
this._mode = 0;

this.startUp = function() {
    this._setPreviousTargetNum(0);
};

this._setPreviousTargetNum = function(num) {
    this._previousTargetNum = num;
};

this._getPreviousTargetNum = function() {
	return this._previousTargetNum;
};

// sell &#39;Target System Upgrade&#39;
this.playerBoughtEquipment = function(equipmentKey) {
	if ( equipmentKey === &#39;EQ_TARGET_FILTERING_SYSTEM_REMOVAL&#39;) {
		player.ship.removeEquipment(&#39;EQ_TARGET_FILTERING_SYSTEM&#39;);
		player.ship.removeEquipment(&#39;EQ_TARGET_FILTERING_SYSTEM_REMOVAL&#39;);
		player.credits += ( EquipmentInfo.infoForKey(&#39;EQ_TARGET_FILTERING_SYSTEM&#39;).price * 0.09 );
	}
};

this.equipmentDamaged = function(equipment) {
	if ( equipment === &#39;EQ_TARGET_FILTERING_SYSTEM&#39; ) {
		player.consoleMessage(&#39;TFSys is damaged!&#39;);
	}
};
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/VimanaAlerts.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name    = &quot;VimanaAlerts&quot;;
this.version = &quot;1.00&quot;;
this.author  = &quot;Gnievmir&quot;;
this.license = &quot;CC-BY-NC-SA 3.0&quot;;

this.$AlertTimer = null;		//store pointer to graphical info timer
this.$LastAlert = [];
this.$IncomingMiss = false;		//incoming missiles flag

this.$Alerts = [
	  &quot;clean.png&quot;,			 //0 -no alert
	  &quot;d_missile.png&quot;,		 //1 
	  &quot;d_altitude.png&quot;,		 //2
	  &quot;d_temp.png&quot;,	         //3
	  &quot;d_energy.png&quot;,	     //4 
	  &quot;d_shield.png&quot;,	     //5 
	  &quot;w_energy.png&quot;,		 //6
	  &quot;w_shield.png&quot;,		 //7
	  &quot;w_temp.png&quot;		     //8 
];

this.startUp = function() {
 //log(this.name, player.ship.dials); 
}

this.shipAttackedWithMissile = function(missile,whom){
  this.$IncomingMiss = true;
  if(this.$LastAlert[0] != 1)this.$LastAlert[0] = -1;
  this._display(1);
}

this.shipWillLaunchFromStation = function() {
    if(!this.$AlertTimer) this.$AlertTimer = new Timer(this, this._alerts.bind(this), 0, 0.5);
    this._resetAlerts();
}

this.shipWillDockWithStation = function() {
  var p = player.ship;
  if(this.$AlertTimer) {
    this.$AlertTimer.stop();
    delete this.$AlertTimer;
  }
  p.setCustomHUDDial(&quot;VimanaAlert&quot;,this.$Alerts[0]); 
}

this.shipDied = function(whom, why)
{
    this.shipWillDockWithStation();
}

this._resetAlerts = function(){
    for (let i = 1;i &lt; 5;i++){
        this.$LastAlert[i] = 100000;
    }
    this.$LastAlert[5] = 0;
}

this._alerts = function(){
  var p = player.ship;
  var ano = 0;
  //check incoming missile
  if(this.$IncomingMiss){
    if (player &amp;&amp; p){	
      var miss = system.entitiesWithScanClass(&quot;CLASS_MISSILE&quot;,p,25600);
      for (let i = 0;i &lt; miss.length;i++){
	if(miss[i].target == p){
	  this._display(1);
	  this.$IncomingMiss = true;
	  return;
	}else{ 	// No incoming missiles
	  this.$IncomingMiss = false;
	}
      }
    }
  }
    //calculate altitude
  var ss = system.sun; 
  var alt = 0; 
  var sp = system.planets;
  var len = sp.length;
  var ctmp = Math.round(100*p.temperature);
  
  if(!system.isInterstellarSpace){
    if(ss)var d = p.position.distanceTo( ss.position ); 
    else var d = 100000000000000000000.0; 

    for(let i=0;i&lt; len;i++){
        var s = p.position.distanceTo( sp[i].position )-sp[i].radius;
        if(d &gt; s) {
        d = s;
        ss = sp[i];
        }
    }
    if(ss) alt = p.position.distanceTo(ss) - ss.radius - p.collisionRadius;
  }else{
      alt = 999999;
  }
  
  if(p.energy &lt; p.maxEnergy/3 &amp;&amp; p.energy &lt; this.$LastAlert[1]){
      ano = 4;
      this.$LastAlert[1] = p.energy;
  }else if(p.forwardShield &lt; p.maxForwardShield * 0.2 &amp;&amp; p.forwardShield &lt; this.$LastAlert[2]){
      ano = 5; 
      this.$LastAlert[2] = p.forwardShield;
  }else if(p.aftShield &lt; p.maxAftShield * 0.2 &amp;&amp; p.aftShield &lt; this.$LastAlert[3]){
      ano = 5;
      this.$LastAlert[3] = p.aftShield;
  }else if(alt &lt; 10000 &amp;&amp; alt &lt; this.$LastAlert[4]){
      ano = 2;
      this.$LastAlert[4] = alt;
  }else if(ctmp &gt; 70 &amp;&amp; ctmp &gt; this.$LastAlert[5]){
      ano = 3;
      this.$LastAlert[5] = ctmp;
  }else if(p.energy &lt; p.maxEnergy/2 &amp;&amp; p.energy &lt; this.$LastAlert[1]){
      ano = 6;
      this.$LastAlert[1] = p.energy;
  }else if(!p.torusEngaged &amp;&amp; p.forwardShield &lt; p.maxForwardShield/2 &amp;&amp; p.forwardShield &lt; this.$LastAlert[2]){
      ano = 7;
      this.$LastAlert[2] = p.forwardShield;
  }else if(!p.torusEngaged &amp;&amp; p.aftShield &lt; p.maxAftShield/2 &amp;&amp; p.aftShield &lt; this.$LastAlert[3]){
      ano = 7;
      this.$LastAlert[3] = p.aftShield;
  }else if(ctmp&gt;50 &amp;&amp; ctmp &gt; this.$LastAlert[5]){
      ano = 8;
      this.$LastAlert[5] = ctmp;
  }
  this._display(ano);
}

this._display = function(a){
  if(a == 0 &amp;&amp; a == this.$LastAlert[0]){
      this._resetAlerts();
      return;
  }

  var p = player.ship;
  if(a &gt; 0){ //alerts
    var seq = Math.floor((this.$AlertTimer.nextTime)%5);
    if(seq &lt; 4 ) p.setCustomHUDDial(&quot;VimanaAlert&quot;,this.$Alerts[a]);
    else p.setCustomHUDDial(&quot;VimanaAlert&quot;,this.$Alerts[0]);
  }else{
    p.setCustomHUDDial(&quot;VimanaAlert&quot;,this.$Alerts[0]);
  }
  this.$LastAlert[0] = a;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/VimanaHUD.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name    = &quot;VimanaHUD&quot;
this.version = &quot;2.07&quot;
this.author  = &quot;Gnievmir&quot;;
this.license = &quot;CC-BY-NC-SA 3.0&quot;;

this.$AMS = null; // antymissile system
this.$SRS = null; // self repair system
this.$TLS = null; // telescope
this.$TFS = null; // target filtering system
this.$SLS = null; // sniper lock        
this.$SLP = null; // sniper lock plus       
this.$ACH = null; // autocrosshair
this.$SEC = null; // shield equalizer-capacitors
this.$SC = null;  // Shield Cycler
this.$LMSS = null; // LMSS
this.$ReqFuel = 0;
this.$LastUsed = []; 
this.$HullAnim = [];
this.$InfoTimer = null;                 //store pointer to text info timer
this.$IconTimer = null;                //store pointer to graphical info timer
this.$Maitenance = false;
this.$CBF = null;
this.$govs = [];
this.$ecos = [];
this.$EqDmg = [];
this.$inflightHud;
                    
this.$GameShips = [                // storage; ships and other model picture
//player ships
            {ship: &quot;Python&quot;, file: &quot;python&quot;},
            {ship: &quot;Boa&quot;, file: &quot;boa&quot;},
            {ship: &quot;Anaconda&quot;, file: &quot;anaconda&quot;},
            {ship: &quot;Asp Mark II&quot;, file: &quot;asp&quot;},
            {ship: &quot;Adder&quot;, file: &quot;adder&quot;},
            {ship: &quot;Boa Class Cruiser&quot;, file: &quot;boa_cruiser&quot;},
            {ship: &quot;Cobra Mark III&quot;, file: &quot;cobra3&quot;},
            {ship: &quot;Cobra Mark I&quot;, file: &quot;cobra1&quot;},
            {ship: &quot;Fer-de-Lance&quot;, file: &quot;ferdelance&quot;},
            {ship: &quot;Moray Star Boat&quot;, file: &quot;moray&quot;},
            {ship: &quot;Moray Medical Boat&quot;, file: &quot;moray&quot;},
            {ship: &quot;Griff Boa Prototype&quot;, file: &quot;griff_boa&quot;},
            {ship: &quot;Wolf Mark II&quot;, file: &quot;wolf2&quot;},
//other ships
            {ship: &quot;Griff Krait&quot;, file: &quot;griff_krait&quot;},
            {ship: &quot;Gecko&quot;, file: &quot;gecko&quot;},
            {ship: &quot;Krait&quot;, file: &quot;krait&quot;},
            {ship: &quot;Training Fighter&quot;, file: &quot;krait&quot;},
            {ship: &quot;Sidewinder Scout Ship&quot;, file: &quot;sidewinder&quot;},
            {ship: &quot;Mamba&quot;, file: &quot;mamba&quot;},
            {ship: &quot;Mamba Escort&quot;, file: &quot;mamba&quot;},
            {ship: &quot;GalCop Viper&quot;, file: &quot;viper&quot;},
            {ship: &quot;GalCop Viper Interceptor&quot;, file: &quot;interceptor&quot;},
            {ship: &quot;Transporter&quot;, file: &quot;transporter&quot;},
            {ship: &quot;Mining Transporter&quot;, file: &quot;transporter&quot;},
            {ship: &quot;Worm&quot;, file: &quot;worm&quot;},
            {ship: &quot;Orbital Shuttle&quot;, file: &quot;orbital_shuttle&quot;},
            {ship: &quot;Thargoid Robot Fighter&quot;, file: &quot;thargon_robot&quot;},
            {ship: &quot;Thargoid Warship&quot;, file: &quot;thargon&quot;},
            {ship: &quot;Light Fighter&quot;, file: &quot;light_fighter&quot;},
            {ship: &quot;GalTech Interceptor&quot;, file: &quot;gt_interceptor&quot;},
            {ship: &quot;Raider&quot;, file: &quot;raider&quot;},
//other targets
            {ship: &quot;Cargo container&quot;, file: &quot;cargo&quot;},
            {ship: &quot;Escape capsule&quot;, file: &quot;escape&quot;},
            {ship: &quot;Ejected Pilot&quot;, file: &quot;pilot&quot;},
            {ship: &quot;Thargoid Spy Satellite&quot;, file: &quot;thargon_sat&quot;},
            {ship: &quot;Asteroid&quot;, file: &quot;asteroid&quot;},
//navi
            {ship: &quot;Navigation Buoy&quot;, file: &quot;buoy&quot;},
            {ship: &quot;Training Buoy&quot;, file: &quot;buoy&quot;},
            {ship: &quot;Witchpoint Beacon&quot;, file: &quot;buoy&quot;},
//dockable
            {ship: &quot;Coriolis Station&quot;, file: &quot;corolis&quot;},
            {ship: &quot;Dodecahedron Station&quot;, file: &quot;dodo&quot;},
            {ship: &quot;Leesti High&quot;, file: &quot;dodo&quot;},
            {ship: &quot;Icosahedron Station&quot;, file: &quot;ico&quot;},
            {ship: &quot;Rock Hermit&quot;, file: &quot;rockhermit&quot;}
];

this.$operationalFunctionNames= [ // list of funcitions to enable/disable at HUDSelector callback
            &quot;shipWillDockWithStation&quot;,
            &quot;shipWillLaunchFromStation&quot;,
            &quot;guiScreenChanged&quot;,
            &quot;alertConditionChanged&quot;,
];

//----------------------------------------------------------------------------------------
this.startUp = function _vimanaHUD_startUp() {
    var p = player.ship;
    p.crosshairs = &quot;crosshair_off.plist&quot;;
    this._txtDial(&quot;VimanaRh&quot;,&quot;&quot;);
    if (!missionVariables.ironHide_percentage) missionVariables.ironHide_percentage = 0;
    for (let i = 0; i &lt; 8 ; i++) {
        this.$govs.push(String.fromCharCode(i));
        this.$ecos.push(String.fromCharCode(23 - i));
        }
        
    if (worldScripts[&quot;telescope&quot;]) {
        this.$TLS = worldScripts[&quot;telescope&quot;];
//this.$TLS.$TelescopeVPosHUD = [-14.0, -22.5, -15.0]
//    this.$TLS.$TelescopeRing = false
        this.$TLS.$TelescopeVSize = 4 ;
        this.$TLS.$TelescopeVZoomSize = 4 ; 
    } 
    
    var w;
    if (worldScripts.hudselector) this.$HSEL = worldScripts.hudselector;
    if (worldScripts.shieldequalizercapacitors) this.$SEC = worldScripts.shieldequalizercapacitors;
    if (worldScripts.sniperlock) this.$SLS = worldScripts.sniperlock;
    if (worldScripts.sniperlock_plus) this.$SLP = worldScripts.sniperlock_plus;
    if (worldScripts[&quot;Auto Crosshairs&quot;]) this.$ACH = worldScripts[&quot;Auto Crosshairs&quot;];
    if (worldScripts.ams_system) this.$AMS = worldScripts.ams_system;
    if (worldScripts[&quot;Target Filtering System&quot;]) this.$TFS = worldScripts[&quot;Target Filtering System&quot;];
    w = worldScripts[&quot;Repair System&quot;];
    if (w &amp;&amp; w.version &amp;&amp; w.version &gt;= &quot;2.14&quot;) this.$SRS = w;
    w = worldScripts[&quot;Shield Cycler&quot;];
    if (w &amp;&amp; w.version &amp;&amp; w.version &gt;= &quot;2.1&quot;) this.$SC = w;
    if (worldScripts.LMSS_Core) this.$LMSS = worldScripts.LMSS_Core;
    
    if (this.$HSEL) {
        this.$HSEL.$HUDSelectorAddHUD(&quot;VimanaHUD 6 MFDs&quot;, this.name);
        this.$HSEL.$HUDSelectorAddHUD(&quot;VimanaHUD 12 MFDs&quot;, this.name+&quot;-mfds&quot;);
    }
    for (let i = 0;i&lt;p.equipment.length;i++){
        if (p.equipmentStatus(p.equipment[i].equipmentKey) === &quot;EQUIPMENT_DAMAGED&quot;) this.$EqDmg.push(p.equipment[i].name);
    }
} 

//----------------------------------------------------------------------------------------
this.$HUDSelectorCallBack = function _vimanaHUD_HUDSelectorCallBack(off) {
    var ws = worldScripts.VimanaHUD;
    var pship = player.ship;
    var funcNames = this.$operationalFunctionNames;
    var i = funcNames.length;
log(this.name, &quot;HUDSelectorCallBack, off:&quot;+off+&quot;, pship.hud:&quot;+pship.hud);
    if (off) {
        // disable
        ws.$stopTimers();
        while (i--)
            if (ws[funcNames[i]]) {
                ws[&quot;$save_&quot;+funcNames[i]] = ws[funcNames[i]];
                delete ws[funcNames[i]];
            }
    } else {
        // enable
        while (i--)
            if (!ws[funcNames[i]]) {
                ws[funcNames[i]] = ws[&quot;$save_&quot;+funcNames[i]];
            }
        this.$inflightHud = pship.hud;
        if (!pship.docked) {
            ws.shipWillLaunchFromStation();
        } else {
            pship.hud = &quot;VimanaHUD_docked.plist&quot;;
        }
    }
}

//----------------------------------------------------------------------------------------
this.shipWillDockWithStation = function _vimanaHUD_shipWillDockWithStation() {
    var p = player.ship;
    
    this.$stopTimers();
    this.$LastUsed[13] = &quot;&quot;;
    this.$inflightHud = p.hud;
    p.hud = &quot;VimanaHUD_docked.plist&quot;;
}

//----------------------------------------------------------------------------------------
this.shipWillLaunchFromStation = function _vimanaHUD_shipWillLaunchFromStation() {
    var p = player.ship;
    var m = null;
    for(let i=0;i&lt;19;i++){
        this.$LastUsed[i] = null;
    }
    if (this.$inflightHud) p.hud = this.$inflightHud;
 
    if(!isValidFrameCallback(this.$CBF))
        this.$CBF = addFrameCallback(this._showIndicators.bind(this));
    
    this._checkMaint();
    
    //set player ship image
    this.$HullAnim[0] = &quot;&quot;;
    for(var i=0;i&lt;this.$GameShips.length;i++){
        if(this.$GameShips[i].ship == p.name){
            this.$HullAnim[0] = this.$GameShips[i].file;
            break;
        }
    } 

    this.$AlertNo = 0;
    
    for(let i = 0;i&lt;p.equipment.length;i++){
        if(p.equipment[i].damageProbability &gt; 0) this.$LastUsed[16]++; 
    }
    
    if(!this.$InfoTimer) this.$InfoTimer = new Timer(this, this._showInfo.bind(this), 0, 0.25);
    if(!this.$IconTimer) this.$IconTimer = new Timer(this, this._showIcon.bind(this), 0, 0.5);
    if(!this.$AnimTimer) this.$AnimTimer = new Timer(this, this._animHull.bind(this), 0, 1);

    this.alertConditionChanged(player.ship.alertCondition);
    this._eqipmentStatus();
    this.$LastUsed[12] = 1;
    this.$HullAnim[1] = 3;
    this._setLPanel();
}

//----------------------------------------------------------------------------------------
this.guiScreenChanged = function _vimanaHUD_guiScreenChanged(to, from) {
    if (from === &quot;GUI_SCREEN_SHORT_RANGE_CHART&quot; || from === &quot;GUI_SCREEN_LONG_RANGE_CHART&quot;) {
        this.$LastUsed[12] = 1;
        this._setLPanel();
    }
}

//----------------------------------------------------------------------------------------
this.equipmentRepaired = function _vimanaHUD_equipmentRepaired(equipment) { //repaired
    var p = player.ship;
    for(let i = 0;i&lt;p.equipment.length;i++){
        if(this.$EqDmg[i] == EquipmentInfo.infoForKey(equipment).name)this.$EqDmg.splice(i,1);
    }
    this._eqipmentStatus() ;
}

//----------------------------------------------------------------------------------------
this.equipmentDamaged = function _vimanaHUD_equipmentDamaged(equipment) {    //damaged
    this.$EqDmg.push(EquipmentInfo.infoForKey(equipment).name);
    this._eqipmentStatus();
}

//----------------------------------------------------------------------------------------
this.shipTargetAcquired = function _vimanaHUD_shipTargetAcquired(target) {
    if(target.isWormhole) return;
    var p = player.ship;
    this._txtDial(&quot;VimanaLPTitle&quot;,&quot;.: TARGET INFO :.&quot;);
    this._txtDial(&quot;VimanaSClock&quot;,&quot;&quot;);
    this._txtDial(&quot;VimanaCEnergy&quot;,&quot;&quot;);
    this._txtDial(&quot;VimanaCSpeed&quot;,&quot;&quot;);
    this._txtDial(&quot;VimanaCMissile&quot;,&quot;&quot;);
    
    if(p.equipmentStatus(&quot;EQ_VIMANA_TARGET_MODULE&quot;) === &quot;EQUIPMENT_OK&quot;){
        var m = null;
    //set ship model and name
    
        for(var i=0;i&lt;this.$GameShips.length;i++){
                if(this.$GameShips[i].ship == target.name){
                        m = this.$GameShips[i].file + &quot;.png&quot;;
                break;
                }
        }
        if(m) var model = m; else var model = &quot;blank.png&quot;;
        p.setCustomHUDDial(&quot;VimanaPTarget&quot;,model);
    } 
}

//----------------------------------------------------------------------------------------
this.shipExitedWitchspace = function _vimanaHUD_shipExitedWitchspace() {
    this._checkMaint();
    this.$LastUsed[12] = 1;
    this.$LastUsed[13] = &quot;&quot;;
    this._setLPanel();
}

//----------------------------------------------------------------------------------------
this.alertConditionChanged = function _vimanaHUD_alertConditionChanged(newState, oldState) {
    var cond = &quot;&quot;;
    switch (newState) {
        case 1: // &quot;Green Alert&quot;
            cond = &quot;green_&quot;;
            break;
        case 2: // &quot;Yellow Alert&quot;
            cond = &quot;&quot;;
            break;
        case 3: // &quot;Red Alert&quot;
            cond = &quot;red_&quot;;
    }
    log(this.name, &quot;Setting player&#39;s crosshairs to &quot;+cond+&quot;crosshair_off.plist&quot;);
    player.ship.crosshairs = cond + &quot;crosshair_off.plist&quot;;
    if (this.$ACH) {
        this.$ACH.$crosshairs.default.off = this.$ACH.$offTargetCrosshairs = cond + &quot;crosshair_off.plist&quot;;
        this.$ACH.$onTargetCrosshairs = this.$ACH.$crosshairs.default.on = cond + &quot;crosshair_on.plist&quot;;
    }
}

//----------------------------------------------------------------------------------------
this.compassTargetChanged = function _vimanaHUD_compassTargetChanged(whom, mode) {
    if (!whom) return;
    var target = &quot;&quot;;
    if(mode === &quot;COMPASS_MODE_BASIC&quot;){
        if(whom.isPlanet) target = &quot;Planet&quot;;
        else target = &quot;Main Station&quot;;
    }else if(mode === &quot;COMPASS_MODE_PLANET&quot;){
        var s = System.infoForSystem(system.info.galaxyID, system.info.systemID);
        var ex = &quot; (&quot; + (s.techlevel + 1) + &quot;) &quot; + this.$ecos[s.economy] + this.$govs[s.government];
        target = whom.name + ex; 
    }else if(mode === &quot;COMPASS_MODE_TARGET&quot;){
        target = &quot;Target&quot;;
    }else{
        if (whom.beaconLabel) target = whom.beaconLabel;
        else if (whom.displayName) target = whom.displayName;
        else if(whom.name) target = whom.name;
        else if(whom.beaconCode) target = whom.beaconCode;
        else target = &quot;Unidentified&quot;;
        }
    this._txtDial(&quot;VimanaASCName&quot;,target.substr(0,26));
}

/*******************************************************************
*             display hud icons (pictograms)
* ******************************************************************/

//----------------------------------------------------------------------------------------
this.$stopTimers = function _vimanaHUD_stopTimers() {
    if(this.$InfoTimer) {
        this.$InfoTimer.stop();
        delete this.$InfoTimer;
    }
    if(this.$IconTimer) {
        this.$IconTimer.stop();
        delete this.$IconTimer;
    }
    if(this.$AnimTimer) {
        this.$AnimTimer.stop();
        delete this.$AnimTimer;
    }
}

//----------------------------------------------------------------------------------------
this._showIcon = function _vimanaHUD_showIcon() {
    var that = _vimanaHUD_showIcon
    var _player = (that._player = that._player || player);
    var p = _player.ship;
    var h = this._getHostileShips();

    if (h.length &amp;&amp; p.alertCondition === 3) {
        if (Math.floor((this.$IconTimer.nextTime * 10)%2)) 
            p.setCustomHUDDial(&quot;VimanaHCG&quot;, &quot;combat.png&quot;); //sabre icon
        else 
            p.setCustomHUDDial(&quot;VimanaHCG&quot;, &quot;blank.png&quot;);
    } else { 
        p.setCustomHUDDial(&quot;VimanaHCG&quot;,&quot;blank.png&quot;);
    }

    if (this.$LMSS) { //lmss icon
        var ws = this.$LMSS;
        switch (p.viewDirection) {
            case &quot;VIEW_FORWARD&quot;: 
                if (p.equipmentStatus(&quot;EQ_LMSS_FRONT&quot;) === &quot;EQUIPMENT_OK&quot;) 
                    this._LMSSIcons(ws._forwardTimer);
                else if (p.equipmentStatus(&quot;EQ_LMSS_FRONT&quot;) === &quot;EQUIPMENT_DAMAGED&quot;)
                    this._blinkingIcons(&quot;VimanaLmss&quot;,&quot;lmss_d.png&quot;);
                else 
                    p.setCustomHUDDial(&quot;VimanaLmss&quot;,&quot;blank.png&quot;);
                break;
            case &quot;VIEW_AFT&quot;: 
                if (p.equipmentStatus(&quot;EQ_LMSS_AFT&quot;) === &quot;EQUIPMENT_OK&quot;) 
                    this._LMSSIcons(ws._aftTimer);
                else if (p.equipmentStatus(&quot;EQ_LMSS_AFT&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) 
                    this._blinkingIcons(&quot;VimanaLmss&quot;,&quot;lmss_d.png&quot;);
                else 
                    p.setCustomHUDDial(&quot;VimanaLmss&quot;,&quot;blank.png&quot;);
                break;
            case &quot;VIEW_PORT&quot;: 
                if (p.equipmentStatus(&quot;EQ_LMSS_PORT&quot;) === &quot;EQUIPMENT_OK&quot;) 
                    this._LMSSIcons(ws._portTimer);
                else if (p.equipmentStatus(&quot;EQ_LMSS_PORT&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) 
                    this._blinkingIcons(&quot;VimanaLmss&quot;,&quot;lmss_d.png&quot;);
                else 
                    p.setCustomHUDDial(&quot;VimanaLmss&quot;,&quot;blank.png&quot;);
                break;
            case &quot;VIEW_STARBOARD&quot;: 
                if (p.equipmentStatus(&quot;EQ_LMSS_STARBOARD&quot;) === &quot;EQUIPMENT_OK&quot;) 
                    this._LMSSIcons(ws._starboardTimer);
                else if (p.equipmentStatus(&quot;EQ_LMSS_STARBOARD&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) 
                    this._blinkingIcons(&quot;VimanaLmss&quot;,&quot;lmss_d.png&quot;);
                else 
                    p.setCustomHUDDial(&quot;VimanaLmss&quot;,&quot;blank.png&quot;);
        } 
    
        if (p.equipmentStatus(&quot;EQ_LMSS_ACTUATOR&quot;) === &quot;EQUIPMENT_OK&quot;)
            p.setCustomHUDDial(&quot;VimanaLmsA&quot;,&quot;lmsa.png&quot;);
        else if (p.equipmentStatus(&quot;EQ_LMSS_ACTUATOR&quot;) === &quot;EQUIPMENT_DAMAGED&quot;)
            this._blinkingIcons(&quot;VimanaLmsA&quot;,&quot;lmsa_d.png&quot;);
        else 
            p.setCustomHUDDial(&quot;VimanaLmsA&quot;,&quot;blank.png&quot;);
    }

    if(p.equipmentStatus(&quot;EQ_CLOAKING_DEVICE&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) this._blinkingIcons(&quot;VimanaCloaking&quot;,&quot;invisible_d.png&quot;);
    else if(p.isCloaked) this._blinkingIcons(&quot;VimanaCloaking&quot;,&quot;invisible.png&quot;);
    else p.setCustomHUDDial(&quot;VimanaCloaking&quot;,&quot;blank.png&quot;);
    
    if (this.$SEC) {
        //forward capacitor
        if (p.equipmentStatus(&quot;EQ_FORWARD_SHIELD_CAPACITOR&quot;) === &quot;EQUIPMENT_DAMAGED&quot;)
            this._blinkingIcons(&quot;VimanaCapacitorF&quot;,&quot;cap_f_d.png&quot;);
        else if (p.equipmentStatus(&quot;EQ_FORWARD_SHIELD_CAPACITOR&quot;) === &quot;EQUIPMENT_OK&quot;) {
            if (this.$SEC.secforwardshieldcapacitor == 0) 
                p.setCustomHUDDial(&quot;VimanaCapacitorF&quot;,&quot;blank.png&quot;);
            else if (this.$SEC.secforwardshieldcapacitor &lt; this.$SEC.$maxCapacitorCharge - p.forwardShieldRecharge) 
                this._blinkingIcons(&quot;VimanaCapacitorF&quot;,&quot;cap_f.png&quot;);
            else 
                p.setCustomHUDDial(&quot;VimanaCapacitorF&quot;,&quot;cap_f.png&quot;);
        } else
            p.setCustomHUDDial(&quot;VimanaCapacitorF&quot;,&quot;blank.png&quot;);
    
        //center dot
        if (p.equipmentStatus(&quot;EQ_AFT_SHIELD_CAPACITOR&quot;) === &quot;EQUIPMENT_DAMAGED&quot; &amp;&amp; p.equipmentStatus(&quot;EQ_FORWARD_SHIELD_CAPACITOR&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) 
            p.setCustomHUDDial(&quot;VimanaCapacitorC&quot;,&quot;cap_c_d.png&quot;);
        else if (p.equipmentStatus(&quot;EQ_AFT_SHIELD_CAPACITOR&quot;) === &quot;EQUIPMENT_OK&quot; &amp;&amp; p.equipmentStatus(&quot;EQ_FORWARD_SHIELD_CAPACITOR&quot;) === &quot;EQUIPMENT_OK&quot;) 
            p.setCustomHUDDial(&quot;VimanaCapacitorC&quot;,&quot;cap_c.png&quot;);
        else if (p.equipmentStatus(&quot;EQ_AFT_SHIELD_CAPACITOR&quot;) === &quot;EQUIPMENT_OK&quot; || p.equipmentStatus(&quot;EQ_FORWARD_SHIELD_CAPACITOR&quot;) === &quot;EQUIPMENT_OK&quot;) 
            this._blinkingIcons(&quot;VimanaCapacitorC&quot;,&quot;cap_b.png&quot;,&quot;cap_c.png&quot;);
        else 
            p.setCustomHUDDial(&quot;VimanaCapacitorC&quot;,&quot;blank.png&quot;);

        //aft capacitor    
        if (p.equipmentStatus(&quot;EQ_AFT_SHIELD_CAPACITOR&quot;) === &quot;EQUIPMENT_DAMAGED&quot;)
            this._blinkingIcons(&quot;VimanaCapacitorA&quot;,&quot;cap_a_d.png&quot;);
        else if (p.equipmentStatus(&quot;EQ_AFT_SHIELD_CAPACITOR&quot;) === &quot;EQUIPMENT_OK&quot;) {
            if (this.$SEC.secaftshieldcapacitor == 0) 
                p.setCustomHUDDial(&quot;VimanaCapacitorA&quot;,&quot;blank.png&quot;);
            else if (this.$SEC.secaftshieldcapacitor &lt; this.$SEC.$maxCapacitorCharge - p.aftShieldRecharge) 
                this._blinkingIcons(&quot;VimanaCapacitorA&quot;,&quot;cap_a.png&quot;);
            else 
                p.setCustomHUDDial(&quot;VimanaCapacitorA&quot;,&quot;cap_a.png&quot;);
        } else
            p.setCustomHUDDial(&quot;VimanaCapacitorA&quot;,&quot;blank.png&quot;);
    } else {
        p.setCustomHUDDial(&quot;VimanaCapacitorF&quot;,&quot;blank.png&quot;);
        p.setCustomHUDDial(&quot;VimanaCapacitorC&quot;,&quot;blank.png&quot;);
        p.setCustomHUDDial(&quot;VimanaCapacitorA&quot;,&quot;blank.png&quot;);
    }

    if (p.equipmentStatus(&quot;EQ_SHIELD_EQUALIZER&quot;) === &quot;EQUIPMENT_OK&quot;)
        p.setCustomHUDDial(&quot;VimanaSCycler&quot;,&quot;sc.png&quot;);
    else if (p.equipmentStatus(&quot;EQ_SHIELD_EQUALIZER&quot;) === &quot;EQUIPMENT_DAMAGED&quot;)
        this._blinkingIcons(&quot;VimanaSCycler&quot;,&quot;sc_d.png&quot;);
    else if (this.$SC &amp;&amp; this.$SC.$sc_settings &amp;&amp; this.$SC.$sc_settings.version) {
        if (this.$SC.$sc_settings.functional == 100)
            p.setCustomHUDDial(&quot;VimanaSCycler&quot;,&quot;sc.png&quot;);
        else
            this._blinkingIcons(&quot;VimanaSCycler&quot;,&quot;sc_d.png&quot;);
    } else
        p.setCustomHUDDial(&quot;VimanaSCycler&quot;,&quot;blank.png&quot;);

    //EQ_NAVAL_ENERGY_UNIT
    if (p.equipmentStatus(&quot;EQ_ENERGY_UNIT&quot;) === &quot;EQUIPMENT_UNAVAILABLE&quot; &amp;&amp; p.equipmentStatus(&quot;EQ_NAVAL_ENERGY_UNIT&quot;) === &quot;EQUIPMENT_UNAVAILABLE&quot;)
        p.setCustomHUDDial(&quot;VimanaEEnergy&quot;,&quot;blank.png&quot;);
    else {
        if (p.equipmentStatus(&quot;EQ_ENERGY_UNIT&quot;) === &quot;EQUIPMENT_OK&quot;)
            p.setCustomHUDDial(&quot;VimanaEEnergy&quot;,&quot;eeu.png&quot;);
        else if (p.equipmentStatus(&quot;EQ_ENERGY_UNIT&quot;) === &quot;EQUIPMENT_DAMAGED&quot;)
            this._blinkingIcons(&quot;VimanaEEnergy&quot;,&quot;eeu_d.png&quot;);
        else if (p.equipmentStatus(&quot;EQ_NAVAL_ENERGY_UNIT&quot;) === &quot;EQUIPMENT_OK&quot;)
            p.setCustomHUDDial(&quot;VimanaEEnergy&quot;,&quot;eeu.png&quot;);
        else if (p.equipmentStatus(&quot;EQ_NAVAL_ENERGY_UNIT&quot;) === &quot;EQUIPMENT_DAMAGED&quot;)
        this._blinkingIcons(&quot;VimanaEEnergy&quot;,&quot;eeu_d.png&quot;);
    }
    
    if(p.equipmentStatus(&quot;EQ_ECM&quot;) === &quot;EQUIPMENT_OK&quot;)p.setCustomHUDDial(&quot;VimanaECM&quot;,&quot;ecm_o.png&quot;);
    else if(p.equipmentStatus(&quot;EQ_ECM&quot;) === &quot;EQUIPMENT_DAMAGED&quot;)this._blinkingIcons(&quot;VimanaECM&quot;,&quot;ecm_d.png&quot;);
    
    if(this.$Maitenance == true)this._blinkingIcons(&quot;VimanaService&quot;,&quot;maintenance.png&quot;);
    else p.setCustomHUDDial(&quot;VimanaService&quot;,&quot;blank.png&quot;); 
    
    if(p.equipmentStatus(&quot;EQ_FUEL_INJECTION&quot;) === &quot;EQUIPMENT_DAMAGED&quot;||p.fuel&lt;0.1) this._blinkingIcons(&quot;VimanaFInjector&quot;,&quot;injector_d.png&quot;);
    else if(p.equipmentStatus(&quot;EQ_FUEL_INJECTION&quot;) === &quot;EQUIPMENT_OK&quot;) p.setCustomHUDDial(&quot;VimanaFInjector&quot;,&quot;injector.png&quot;);
    else p.setCustomHUDDial(&quot;VimanaFInjector&quot;,&quot;blank.png&quot;);
    
    if(((p.fuel).toFixed(1) &lt; this.$ReqFuel &amp;&amp; system.ID != p.targetSystem)||p.fuel&lt;0.1) this._blinkingIcons(&quot;VimanaLowFuel&quot;,&quot;low_fuel.png&quot;);
    else p.setCustomHUDDial(&quot;VimanaLowFuel&quot;,&quot;blank.png&quot;) ;
    
 //self repair system icons 
    var eqKey = (this.$SRS &amp;&amp; this.$SRS.$controllerVersion ? this.$SRS.$controllerVersion : null);
    if (eqKey) {
        if (this.$SRS.$selfRepairsSystemStatus === &quot;Active&quot;)
            this._blinkingIcons(&quot;VimanaRepIcon&quot;, &quot;srs_0.png&quot;, &quot;srs_1.png&quot;);
        else if (this.$SRS.$selfRepairsSystemStatus === &quot;Self-repair&quot;) 
            this._blinkingIcons(&quot;VimanaRepIcon&quot;, &quot;srs_d.png&quot;, &quot;blank.png&quot;);
        else if (this.$SRS.$selfRepairsSystemStatus === &quot;Standby&quot;) 
            p.setCustomHUDDial(&quot;VimanaRepIcon&quot;, &quot;srs.png&quot;);
        else if (this.$SRS.$selfRepairsSystemStatus === &quot;Shutdown&quot;) 
            p.setCustomHUDDial(&quot;VimanaRepIcon&quot;, &quot;srs_d.png&quot;);
        else
            p.setCustomHUDDial(&quot;VimanaRepIcon&quot;, &quot;blank.png&quot;);
    } else
        p.setCustomHUDDial(&quot;VimanaRepIcon&quot;, &quot;blank.png&quot;);
}

//----------------------------------------------------------------------------------------
this._LMSSIcons = function _vimanaHUD_LMSSIcons(tmr) {
        var p = player.ship;
        if(tmr &amp;&amp; tmr.isRunning){ 
                 if(Math.floor(this.$IconTimer.nextTime * 10)&amp;1)p.setCustomHUDDial(&quot;VimanaLmss&quot;,&quot;lmss1.png&quot;);
                 else p.setCustomHUDDial(&quot;VimanaLmss&quot;,&quot;lmss0.png&quot;);
        }else{ 
                 p.setCustomHUDDial(&quot;VimanaLmss&quot;,&quot;lmss0.png&quot;);
        }
}

//----------------------------------------------------------------------------------------
this._blinkingIcons = function _vimanaHUD_blinkingIcons(key,ico,blank) {
        if(blank == null) blank = &quot;blank.png&quot;;
        if(Math.floor(this.$IconTimer.nextTime * 10)&amp;1){ 
            player.ship.setCustomHUDDial(key,ico);
        }else{ 
            player.ship.setCustomHUDDial(key,blank);
        }     
}

//----------------------------------------------------------------------------------------
this._getHostileShips = function _vimanaHUD_getHostileShips() {
        return this._filterEntities(
                function(e) { return ( e.isShip &amp;&amp; e.hasHostileTarget &amp;&amp; e.target === player.ship ); }
        );
};

//----------------------------------------------------------------------------------------
this._filterEntities = function _vimanaHUD_filterEntities(filterFunc) {
        return system.filteredEntities(
                this,
                filterFunc,
                player.ship,
                player.ship.scannerRange
        );
}

//----------------------------------------------------------------------------------------
this._showInfo = function _vimanaHUD_showInfo() { //txt information on the hud
    var p = player.ship;
    /**************************************
     * display a list of damaged equipment
     **************************************/
    //right panel
    if(p.equipmentStatus(&quot;EQ_VIMANA_SHIP_MODULE&quot;) === &quot;EQUIPMENT_OK&quot;){
        if(this.$EqDmg.length &amp;&amp; !(Math.floor($InfoTimer.nextTime*100)%4)){ 
                if(this.$EqDmg.length&lt;9){
                        var poz = this.$LastUsed[14] = 0;
                }else{
                        if(this.$LastUsed[14]&gt;this.$EqDmg.length - 1) this.$LastUsed[14] = 0;
                        var poz = this.$LastUsed[14];
                        this.$LastUsed[14]++;
                }
                for(let i=0;i&lt;9;i++){
                    if(i&gt;this.$EqDmg.length-1) break; 
                    let y = poz + i;
                    if(y &gt; this.$EqDmg.length - 1) y-= this.$EqDmg.length;
                    let spc = &quot;&quot;;
                    if(y&lt;9)spc = &quot;    &quot;;
                    let dsp = spc + (1 + y) + &quot;. &quot; + this.$EqDmg[y];
                    let ln = i + 1;
                    this._txtDial(&quot;VimanaR&quot; + ln, dsp.substr(0,36)); 
                } 
        }
    }

    if (p.alertCondition === 3 ) {
        if ((this.$SLS &amp;&amp; this.$SLS.sniperlockchangeflag &amp;&amp; this.$SLS.sniperlockchangeflag === &quot;ON&quot;) ||
            (this.$SLP &amp;&amp; this.$SLP.$slpState === &quot;ON&quot;))
            this._txtDial(&quot;VimanaTLock&quot;,&quot;LOCKED&quot;);
        else
            this._txtDial(&quot;VimanaTLock&quot;,&quot;&quot;);
        //hostile counter
        var hc = []; 
        hc = this._getHostileShips();
        if (hc.length &gt; 0) {
            if (hc.length &gt; 9)
                this._txtDial(&quot;VimanaHC&quot;,hc.length);
            else 
                this._txtDial(&quot;VimanaHC&quot;,&quot; &quot; + hc.length);
        }
    } else
        this._txtDial(&quot;VimanaTLock&quot;,&quot;&quot;);
        
    this._setLPanel();
    
    //repairbots status
    if (this.$SRS &amp;&amp; this.$SRS.$controllerVersion) 
        this._txtDial(&quot;VimanaRepBots&quot;, this.$SRS.$selfRepairsSystemStatus+&quot;, Charges: &quot; + missionVariables.repairCounter);

    //ams system
    if(p.equipmentStatus(&quot;EQ_AMS&quot;) === &quot;EQUIPMENT_OK&quot; &amp;&amp; missionVariables.amActive === &quot;ACTIVE&quot; &amp;&amp; this.$AMS.amCount) this._txtDial(&quot;VimanaAMS&quot;,&quot;Darts: &quot; + this.$AMS.amCount);
    else if(p.equipmentStatus(&quot;EQ_AMS&quot;) === &quot;EQUIPMENT_OK&quot;) this._txtDial(&quot;VimanaAMS&quot;,&quot;OFFLINE&quot;);
    else if(p.equipmentStatus(&quot;EQ_AMS&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) this._txtDial(&quot;VimanaAMS&quot;,&quot;DAMAGED&quot;);
    else this._txtDial(&quot;VimanaAMS&quot;,&quot;&quot;);
    
    /*
     *     equip mode
     */
    
    var eq_mode = &quot;&quot;;
    switch(p.primedEquipment){
        case &quot;EQ_TARGET_FILTERING_SYSTEM&quot;:
            if(p.equipmentStatus(&quot;EQ_TARGET_FILTERING_SYSTEM&quot;) === &quot;EQUIPMENT_OK&quot;){
        switch(this.$TFS._mode){
            case 0: eq_mode = &quot;hostile/outlaw&quot;;
                break;
            case 1: eq_mode = &quot;thargon&quot;;
                break;
            case 2: eq_mode = &quot;police&quot;;
                break;
            case 3: eq_mode = &quot;neutral&quot;;
                break;
            case 4: eq_mode = &quot;cargo&quot;;
                break;
            case 5: eq_mode = &quot;asteroids&quot;;
                break;
         }        
            }
            break;
            case &quot;EQ_WARRANT_SCANNER&quot;:
                    var ws = worldScripts[&quot;BountySystem_WarrantScanner&quot;];
                    switch(ws._outputMode){
                            case 0: eq_mode = &quot;MFD&quot;;
                            break;
                            case 1: eq_mode = &quot;console&quot;;
                    }
                break;
            case &quot;EQ_HYPER_RADIO&quot;:
                eq_mode = &quot;reconnect&quot;;
                break;
            case &quot;EQ_ORE_PROCESSOR&quot;:
                eq_mode = &quot;scan minerals&quot;;
                break;
            case &quot;EQ_WPH_ASC_UPGRADE&quot;:
                eq_mode = &quot;delete selected&quot;;
             break;
/*        case &quot;EQ_TELESCOPE&quot;:    //.$Telescopeeq_MenuItem
                var ws = worldScripts[&quot;telescope&quot;];
                var tm = [&quot;Nearest target&quot;,
                                    &quot;Rescan&quot;,
                                    &quot;Step forward&quot;,
                                    &quot;Step back&quot;,
                                    &quot;Lightballs&quot;,
                                    &quot;Sniper ring&quot;,
                                    &quot;Steering&quot;,
                                    &quot;Targets&quot;,
                                    &quot;Visual target&quot;,
                                    &quot;Visual target size&quot;];
                eq_mode = tm[ws.???];
                break; */
        case &quot;EQ_TOWBAR&quot;:
            if(p.equipmentStatus(&quot;EQ_TOWBAR&quot;) === &quot;EQUIPMENT_OK&quot;){
                var ws = worldScripts[&quot;towbar&quot;];
                switch( ws.$TowbarMiner ) {
                        case 0: eq_mode = &quot;offline&quot;;
                        break;
                        case 1: eq_mode = &quot;cargo only&quot;;
                        break;
                        case 2: eq_mode = &quot;up to full&quot;;
                        break;
                        case 3: eq_mode = &quot;salvager&quot;;
                        break;
                default: eq_mode = &quot;miner N/A&quot;;
                }
            }
            break;
        default: eq_mode = &quot;N/A&quot;;
    }
    this._txtDial(&quot;VimanaEQMode&quot;,eq_mode);
}

//----------------------------------------------------------------------------------------
this._txtDial = function _vimanaHUD_txtDial(key,val,center) {
    if(center) val = this._shiftTxt(val,22);
    player.ship.setCustomHUDDial(key, val);
}

//----------------------------------------------------------------------------------------
this._shiftTxt = function _vimanaHUD_shiftTxt(text,length) {
        var s = &quot;&quot;;
        var l = length - Math.round(text.length/2);
        if(l&lt;0)return text;
        while(s.length &lt; l){
                s += &quot; &quot;    ;
        }
        return s + text;
}
/**************************************
 *                            right panel
 * ************************************/
//Player ship shields and hull test animation
//----------------------------------------------------------------------------------------
this._animHull = function _vimanaHUD_animHull() { 
        var p = player.ship;
        
        if(p.equipmentStatus(&quot;EQ_VIMANA_SHIP_MODULE&quot;) === &quot;EQUIPMENT_OK&quot;){
                if(this.$HullAnim[0]){
                        if(this.$HullAnim[1] &gt; 5) this.$HullAnim[1] = 0;
                        else this.$HullAnim[1]++; 
                        if(this.$HullAnim[1] &lt; 4) p.setCustomHUDDial(&quot;VimanaHullAnim&quot;,this.$HullAnim[0] + &quot;_&quot; + this.$HullAnim[1] + &quot;.png&quot;);
                        else p.setCustomHUDDial(&quot;VimanaHullAnim&quot;,&quot;blank.png&quot;);
                }
                var wtp = Math.round(p.aftShield / p.maxAftShield*100);
                var wtt = Math.round(p.forwardShield / p.maxForwardShield*100);
                if(wtp &gt; 75) p.setCustomHUDDial(&quot;VimanaTT&quot;,&quot;tt100.png&quot;);
                else if(wtp&gt;50 &amp;&amp; wtp&lt;76) p.setCustomHUDDial(&quot;VimanaTT&quot;,&quot;tt75.png&quot;);
                else if(wtp&gt;25 &amp;&amp; wtp&lt;51) p.setCustomHUDDial(&quot;VimanaTT&quot;,&quot;tt50.png&quot;);
                else if(wtp&gt;1 &amp;&amp; wtp&lt;26) p.setCustomHUDDial(&quot;VimanaTT&quot;,&quot;tt25.png&quot;);
                else p.setCustomHUDDial(&quot;VimanaTT&quot;,&quot;blank.png&quot;);     
        
                if(wtt &gt; 75) p.setCustomHUDDial(&quot;VimanaTP&quot;,&quot;tp100.png&quot;);
                else if(wtt&gt;50 &amp;&amp; wtt&lt;76) p.setCustomHUDDial(&quot;VimanaTP&quot;,&quot;tp75.png&quot;);
                else if(wtt&gt;25 &amp;&amp; wtt&lt;51) p.setCustomHUDDial(&quot;VimanaTP&quot;,&quot;tp50.png&quot;);
                else if(wtt&gt;1 &amp;&amp; wtt&lt;26) p.setCustomHUDDial(&quot;VimanaTP&quot;,&quot;tp25.png&quot;);
                else p.setCustomHUDDial(&quot;VimanaTP&quot;,&quot;blank.png&quot;);
        }else{
                p.setCustomHUDDial(&quot;VimanaTT&quot;,&quot;blank.png&quot;);
                p.setCustomHUDDial(&quot;VimanaTP&quot;,&quot;blank.png&quot;);
                p.setCustomHUDDial(&quot;VimanaHullAnim&quot;,&quot;blank.png&quot;);
                if(p.equipmentStatus(&quot;EQ_VIMANA_SHIP_MODULE&quot;) === &quot;EQUIPMENT_UNAVAILABLE&quot;){
                        this.$AnimTimer.stop();
                        delete this.$AnimTimer;
                }
        }
}

//----------------------------------------------------------------------------------------
this._eqipmentStatus = function _vimanaHUD_eqipmentStatus() {  //check equip             
        this._txtDial(&quot;VimanaRh1&quot;,&quot;&quot;);
        this._txtDial(&quot;VimanaRh2&quot;,&quot;&quot;);
        var p = player.ship;
        for(let i=0;i&lt;10;i++){
                this._txtDial(&quot;VimanaR&quot; + i,&quot;&quot;);
        }
        if(p.equipmentStatus(&quot;EQ_VIMANA_SHIP_MODULE&quot;) === &quot;EQUIPMENT_OK&quot;){
                p.setCustomHUDDial(&quot;VimanaPSName&quot;,p.displayName);
                if(this.$HullAnim[0]) var m = this.$HullAnim[0] + &quot;.png&quot;;
                else var m = &quot;blank.png&quot;;
                p.setCustomHUDDial(&quot;VimanaPShip&quot;,m);
                                
                if(this.$EqDmg.length){
    /***********************
     *         equip damaged
     * *********************/
                        var pd = Math.round((this.$EqDmg.length/p.equipment.length)*1000)/10;
                        this._txtDial(&quot;VimanaRh1&quot;,&quot;SHIP DAMAGED!&quot;);
                        this._txtDial(&quot;VimanaRh2&quot;,this.$EqDmg.length + &quot; (&quot; + pd + &quot;%) system(s) broken&quot;),true;
                        this._txtDial(&quot;VimanaR0&quot;,&quot;..:: CheckList ::..&quot;,true);

                        if (this.$SRS &amp;&amp; this.$SRS.$controllerVersion &amp;&amp; missionVariables.repairCounter &gt; 0) {
                            if (this.$SRS.$selfRepairsSystemStatus === &quot;Stand-by&quot;)
                                this.$SRS.checkEquipment();
                        }
                }else{    
    /***********************
     *         no damage
     * *********************/
                        this._txtDial(&quot;VimanaRh1&quot;,&quot;&quot;);
                        this._txtDial(&quot;VimanaRh2&quot;,&quot;&quot;);

                        if(this.$LastUsed[16] &gt; 0){
                                this._txtDial(&quot;VimanaR8&quot;,this.$LastUsed[16] + &quot; equipments &amp; systems&quot;);
                                this._txtDial(&quot;VimanaR9&quot;,&quot;operational and efficient&quot;);
                        }else{
                                this._txtDial(&quot;VimanaR9&quot;,&quot; No additional equipment!&quot;);
                        }
                }
        }else{ 
                var tx = this._shiftTxt(&quot;UNAVAILABLE&quot;,18);
                this._txtDial(&quot;VimanaR1&quot;,tx);
                if(p.equipmentStatus(&quot;EQ_VIMANA_SHIP_MODULE&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) tx = this._shiftTxt(&quot;Module damaged&quot;,18);
                else tx = this._shiftTxt(&quot;Module not installed&quot;,18)
                this._txtDial(&quot;VimanaR2&quot;,tx);
                p.setCustomHUDDial(&quot;VimanaPShip&quot;,&quot;blank.png&quot;);
        }
}
/**************************************
 *                            left panel
 * ************************************/
//----------------------------------------------------------------------------------------
this._setLPanel = function _vimanaHUD_setLPanel() {
    var p = player.ship;
    for(let i=0;i&lt;10;i++){
            this._txtDial(&quot;VimanaL&quot; + i,&quot;&quot;) ;
    } 
    if(p.target &amp;&amp; p.target.isValid &amp;&amp; !p.target.isWormhole) {
            if(p.equipmentStatus(&quot;EQ_VIMANA_TARGET_MODULE&quot;) === &quot;EQUIPMENT_OK&quot;){
                this._targetInfo();
            }else{
                p.setCustomHUDDial(&quot;VimanaPTarget&quot;,&quot;blank.png&quot;);
                p.setCustomHUDDial(&quot;VimanaLh&quot;,&quot;&quot;);
                var tx = &quot;&quot;;
                this._txtDial(&quot;VimanaL3&quot;,&quot;UNAVAILABLE&quot;,1);
                if(p.equipmentStatus(&quot;EQ_VIMANA_TARGET_MODULE&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) tx = &quot;Module damaged&quot;;
                else tx = &quot;Module not installed&quot;;
                this._txtDial(&quot;VimanaL4&quot;,tx,1);                    
            }
    }else{                                 //travel info
        if(this.$LastUsed[12] == 1){
            this.$LastUsed[12] == 0;
            this.$LastUsed[13] = &quot;&quot;;
            this._txtDial(&quot;VimanaLPTitle&quot;,&quot;.: TRAVEL INFO :.&quot;) ;
            p.setCustomHUDDial(&quot;VimanaPTarget&quot;,&quot;globe.png&quot;);
            this._txtDial(&quot;VimanaCEnergy&quot;,&quot;&quot;);
            this._txtDial(&quot;VimanaCSpeed&quot;,&quot;&quot;);
            this._txtDial(&quot;VimanaCMissile&quot;,&quot;&quot;);
            
            if(p.equipmentStatus(&quot;EQ_VIMANA_TRAVEL_MODULE&quot;) === &quot;EQUIPMENT_OK&quot;){
                this._travelInfo();
            }else{
                p.setCustomHUDDial(&quot;VimanaPTarget&quot;,&quot;blank.png&quot;);
                p.setCustomHUDDial(&quot;VimanaLh&quot;,&quot;&quot;);
                var tx = &quot;&quot;;
                this._txtDial(&quot;VimanaL3&quot;,&quot;UNAVAILABLE&quot;,1);
                if(p.equipmentStatus(&quot;EQ_VIMANA_TRAVEL_MODULE&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) tx = &quot;Module damaged&quot;;
                else tx = &quot;Module not installed&quot;;
                this._txtDial(&quot;VimanaL4&quot;,tx,1);                    
            }
        }
    }    
}

//----------------------------------------------------------------------------------------
this._targetInfo = function _vimanaHUD_targetInfo() {
        var p = player.ship;
        var tdata = [];
        var sep = &quot;    :    &quot;;
        for(let i=0;i&lt;10;i++){
            tdata[i] = &quot;&quot;;
        }
        this.$LastUsed[12] = 1;
        tdata[0] = p.target.displayName;
        
        if(p.target.dataKey == &quot;telescopemarker&quot;){
            tdata[1] = &quot;Additional info not available&quot;;
            tdata[2] = this._shiftTxt(&quot;(Out of range)&quot;,16);
            var itn = tdata[0].indexOf(&quot;km &quot;);
            if(itn &gt; -1 &amp;&amp; itn &lt; 10) tdata[0] = tdata[0].substr(itn + 3);
            if(this.$LastUsed[13] != tdata[0]){             //load target model only for telescope 
                this.$LastUsed[13] = tdata[0];
                var m = null;
                for(var i=0;i&lt;this.$GameShips.length;i++){     //ship model
                        if(this.$GameShips[i].ship == tdata[0]){
                        m = this.$GameShips[i].file + &quot;.png&quot;;
                        break;
                        }
                }
            if(m) var model = m; else var model = &quot;blank.png&quot;;
            p.setCustomHUDDial(&quot;VimanaPTarget&quot;,model);
            } 
        }else if(p.target.isBoulder || p.target.isRock &amp;&amp; !p.target.isPiloted){
            tdata[1] = this._shiftTxt(&quot;SPEED&quot;,9) + sep + Math.round(p.target.velocity.magnitude()/10)*10 + &quot;m/s&quot;;
            tdata[2] = this._shiftTxt(&quot;BOUNTY&quot;,6) + sep + p.target.bounty + &quot;€&quot;;
        }else if(p.target.isMissile){
            tdata[1] = this._shiftTxt(&quot;SPEED&quot;,9) + sep + Math.round(p.target.velocity.magnitude()/10)*10;
            tdata[2] = this._shiftTxt(&quot;ENERGY&quot;,7) + sep + Math.round(p.target.energy);
            tdata[4] = this._shiftTxt(&quot;TRAVELED&quot;,4) + sep + Math.round(p.target.distanceTravelled) + &quot; m&quot;;
        }else if(p.target.isStation){    
                tdata[3] = this._shiftTxt(&quot;RADIUS&quot;,9) + sep + Math.round(p.target.collisionRadius) + &quot; m&quot;;
                tdata[4] = this._shiftTxt(&quot;ENERGY&quot;,8) + sep + Math.round(p.target.energy);
                tdata[6] = this._shiftTxt(&quot;DEFENDERS&quot;,1) + sep + p.target.dockedPolice;
                if (p.target.requiresDockingClearance){
                        tdata[1] = this._shiftTxt(&quot;DOCK&quot;,11) + sep + &quot;REQUEST&quot;;
                        switch (player.dockingClearanceStatus) {
                                case &quot;DOCKING_CLEARANCE_STATUS_REQUESTED&quot;:
                                        tdata[1] = this._shiftTxt(&quot;DOCK&quot;,11) + sep + &quot;HOLD&quot;;
                                        break;
                                case &quot;DOCKING_CLEARANCE_STATUS_GRANTED&quot;:
                                        tdata[1] = this._shiftTxt(&quot;DOCK&quot;,11) + sep + &quot;GRANTED&quot;;
                                        break;
                                case &quot;DOCKING_CLEARANCE_STATUS_TIMING_OUT&quot;:
                                        tdata[1] = this._shiftTxt(&quot;DOCK&quot;,11) + sep + &quot;EXPIRING&quot;;
                        }        
                }else{
                        tdata[1] = this._shiftTxt(&quot;DOCK&quot;,11) + sep + &quot;FREE&quot;;
                }
        }else if(p.target.isDerelict){
                tdata[2] = this._shiftTxt(&quot;ENERGY&quot;,7) + sep + Math.round(p.target.energy);
                tdata[4] = this._shiftTxt(&quot;CARGO&quot;,8) + sep + p.target.cargoSpaceUsed + &quot;/&quot; + p.target.cargoSpaceCapacity + &quot;t&quot;;
        }else if(p.target.isShip &amp;&amp; p.target.isPiloted || p.target.isThargoid){
            tdata[1] = this._shiftTxt(&quot;SPEED&quot;,9) + sep + Math.round(p.target.velocity.magnitude()/10)*10 + &quot;m/s&quot;;
            tdata[2] = this._shiftTxt(&quot;ENERGY&quot;,7) + sep + Math.round(p.target.energy);
            if(!p.target.currentWeapon){
        tdata[5] = this._shiftTxt(&quot;WEAPON&quot;,5) + sep + &quot;none&quot;;
            }else if(p.target.currentWeapon.name == &quot;Remove Laser&quot;){
        tdata[5] = this._shiftTxt(&quot;WEAPON&quot;,5) + sep + &quot;unknown&quot;;
            }else{
        tdata[5] = this._shiftTxt(&quot;WEAPON&quot;,5) + sep + p.target.currentWeapon.name;
            }
            tdata[6] = this._shiftTxt(&quot;RANGE&quot;,8) + sep + Math.round(p.target.weaponRange/100)/10    + &quot;km&quot;;
            var mc = 0;
            var hmc = 0;
            var msc = &quot;&quot;;
            for(let i = 0; i &lt; p.target.missiles.length; i++ ) {
                    let mst = p.target.missiles[i].equipmentKey;
                if( mst == &quot;EQ_MISSILE&quot; || mst == &quot;EQ_ARMOURY_STANDARD_MISSILE&quot;) mc++ ;
                else hmc++;                
            }
            
            if(hmc &gt; 0 &amp;&amp; mc &gt; 0)msc = hmc + &quot;h/&quot; + mc + &quot;s&quot;;
            else if(hmc &gt; 0)msc = hmc + &quot;h&quot;;
            else if(mc &gt; 0)msc = mc + &quot;s&quot;;
            else msc = &quot;0&quot;;
            tdata[4] = this._shiftTxt(&quot;MISSILE&quot;,8) + sep + msc;
            tdata[7] = this._shiftTxt(&quot;CARGO&quot;,8) + sep + p.target.cargoSpaceUsed + &quot;/&quot; + p.target.cargoSpaceCapacity + &quot;t&quot;;
            tdata[9] = this._shiftTxt(&quot;BOUNTY&quot;,6) + sep + p.target.bounty + &quot;€&quot;;
            if(player.alertCondition == 3){
                this._txtDial(&quot;VimanaCEnergy&quot;,&quot;E: &quot; + Math.round(p.target.energy));
                this._txtDial(&quot;VimanaCSpeed&quot;,&quot;V: &quot; + Math.round(p.target.velocity.magnitude()/10)*10);
                this._txtDial(&quot;VimanaCMissile&quot;,&quot;M: &quot; + msc);
            }
        }else if(p.target.isCargo){
            tdata[0] = p.target.name;
            tdata[1] = p.target.shipUniqueName;
            if(tdata[1].indexOf(&quot;Gold&quot;) &gt; -1 || tdata[1].indexOf(&quot;Platinum&quot;) &gt; -1) var unit = &quot;kg&quot;;
            else if(tdata[1].indexOf(&quot;Gem-Stones&quot;) &gt; -1) var unit = &quot;g&quot;;
            else var unit = &quot;t&quot;;
            tdata[2] = this._shiftTxt(&quot;AMOUNT&quot;,5) + sep + p.target.commodityAmount + unit; 
            tdata[3] = this._shiftTxt(&quot;SPEED&quot;,9) + sep + Math.round(p.target.velocity.magnitude()/10)*10 + &quot;m/s&quot;;
        }else if(p.target.isBeacon){
            if(p.target.name) tdata[0] = p.target.name;
            else if(p.target.beaconLabel) tdata[0] = p.target.beaconLabel;
            else if(p.target.beaconCode) tdata[0] = p.target.beaconCode;
            else tdata[0] = &quot;Unidentified&quot;;
            tdata[2] =    this._shiftTxt(&quot;ENERGY&quot;,7) + sep + Math.round(p.target.energy);
            tdata[3] = this._shiftTxt(&quot;RADIUS&quot;,7) + sep + Math.round(p.target.collisionRadius) + &quot; m&quot;;
        }
        //--------------
        this._txtDial(&quot;VimanaLh&quot;,tdata[0],true) ;
        this._txtDial(&quot;VimanaL0&quot;,&quot;&quot;) ;
        for(let i=1;i&lt;10;i++){
            this._txtDial(&quot;VimanaL&quot; + i,&quot;         &quot; + tdata[i]) ;
        } 
}

//----------------------------------------------------------------------------------------
this._travelInfo = function _vimanaHUD_travelInfo() {
    var p = player.ship;
    var dest = &quot;Destination not set        &quot; ;
    this.$ReqFuel = 0;
    var ddist = &quot;&quot;;
    var nlabel = &quot;&quot;;
    
    for(let i=3;i&lt;10;i++){
        this._txtDial(&quot;VimanaL&quot; + i,&quot;&quot;);
    }         
    function spacer(l,txt){
        l -= txt.length;
        for(let i=0;i&lt;l;i++){
            txt = &quot;    &quot; + txt;
        }
        return txt;
    }
    function addzero(v){
     if(v.indexOf(&quot;.&quot;) == -1) v += &quot;.0&quot;; 
        return v;
    }
    if(system.isInterstellarSpace){
        dest = &quot;Interstellar Space!        &quot; ;
        ddist = &quot;Route calculation not possible&quot;;
        nlabel = &quot;&quot;; 
    }else if(system.ID != p.targetSystem){
        var fullRoute = system.info.routeToSystem(System.infoForSystem(system.info.galaxyID, p.targetSystem),p.routeMode);
        var tsys = System.infoForSystem(system.info.galaxyID, p.targetSystem);
        dest = tsys.name + &quot;        &quot; + &quot;(&quot; + (tsys.techlevel + 1) + &quot;) &quot; + this.$ecos[tsys.economy] + this.$govs[tsys.government];
        let dday = Math.floor(fullRoute.time/24);
        let dhour = Math.floor(fullRoute.time % 24);
        let dmin = Math.floor(fullRoute.time % 60);
        let tx = Math.floor(fullRoute.distance*10)/10;
        let hp = fullRoute.route.length - 1;
        ddist = &quot;(&quot; + addzero(tx.toString()) + &quot;ly, &quot; + dday + &quot;d:&quot; + dhour + &quot;h:&quot; + dmin + &quot;m, &quot; + &quot;jmp: &quot; + hp + &quot;)&quot;;
        if(fullRoute.route.length &gt; 0){
            if(fullRoute.route.length &gt; 8)var nxr = 8;
            else var nxr = fullRoute.route.length;
            if(p.routeMode === &quot;OPTIMIZED_BY_NONE&quot; &amp;&amp; fullRoute.route.length &gt; 2){
        this._txtDial(&quot;VimanaL4&quot;,&quot;Unknown route!            &quot;);
            }else{
        for(let i=1;i &lt; nxr;i++){
            let a = i + 2;
            let b = System.infoForSystem(system.info.galaxyID, fullRoute.route[i]);
            let c = system.info.routeToSystem(System.infoForSystem(system.info.galaxyID, fullRoute.route[i]),p.routeMode);
            let tx = Math.floor(c.distance*10)/10;
            if(i == 1) this.$ReqFuel = tx;
            let d = spacer(5,addzero(tx.toString())) + &quot;ly     &quot; + b.name + &quot;    (&quot; + (b.techlevel + 1) + &quot;)    &quot; + this.$ecos[b.economy] + this.$govs[b.government];
            this._txtDial(&quot;VimanaL&quot; + a, d);
        }
            }
            nlabel = this._shiftTxt(&quot;...: NEXT HOPS :...&quot;,22);
        }
    }
    this._txtDial(&quot;VimanaLh&quot;,dest);
    this._txtDial(&quot;VimanaL0&quot;, ddist);
    this._txtDial(&quot;VimanaL1&quot;, &quot;&quot;);
    this._txtDial(&quot;VimanaL2&quot;,nlabel);
}

//----------------------------------------------------------------------------------------
this._checkMaint = function _vimanaHUD_checkMaint() {
    var p = player.ship;
    if(p.serviceLevel&lt; 85){
        this.$Maitenance = true;
    }else{ 
        this.$Maitenance = false;
        p.setCustomHUDDial(&quot;VimanaService&quot;,&quot;blank.png&quot;);
    }
}

/***********************************
 *                    indicators
 ***********************************/
//----------------------------------------------------------------------------------------
this._showIndicators = function _vimanaHUD_showIndicators() { 
    var p = player.ship;
    var efl = 0 //extra fuel
    var speed = Math.round(p.velocity.magnitude()/10)*10;
    var ctemp = Math.round(p.temperature * 100);
    var fuel = (p.fuel).toFixed(1);
    var tds = &quot; * * *&quot;;
    
    if(p.target &amp;&amp; p.target.isValid &amp;&amp; !p.target.isWormhole) { //calculate &amp; display distance to player target
        var trg = p.target;
        if(p.target.dataKey == &quot;telescopemarker&quot;)
            if(this.$TLS.$TelescopeList[this.$TLS.$TelescopeListi-1]) trg = this.$TLS.$TelescopeList[this.$TLS.$TelescopeListi-1];
        if(trg.position){
                var td = trg.position.distanceTo(p.position) - Math.round(trg.collisionRadius);
                if(td &gt;100000) td = Math.round(td/1000);
                else td = Math.round(td/10)/100;
                tds = td.toString();
                var z = &quot;&quot;;
                if(td &lt;100){
                        if(tds.indexOf(&quot;.&quot;) == -1) z = &quot;.00&quot;;
                        else if(tds.length - tds.indexOf(&quot;.&quot;) &lt; 3) z = &quot;0&quot;;
            }
            tds += z;
        }
    }else{
            var sec = &quot;&quot; + Math.floor(clock.seconds%60); //display clock
            if(sec.length&lt;2)sec = &quot;0&quot; + sec;
            var min = &quot;&quot; + Math.floor(clock.minutes%60);
            if(min.length&lt;2)min = &quot;0&quot; + min;
            this._txtDial(&quot;VimanaSClock&quot;,Math.floor(clock.hours % 24) + &quot;:&quot; + min + &quot;:&quot; + sec + &quot; - &quot; + clock.days);
    }
    this._txtDial(&quot;VimanaTDist&quot;,tds, true);
    //DuplexFuelTank.oxz
    if( p.equipmentStatus(&quot;EQ_DUPLEX_FUEL_TANK_STATE_1&quot;) == &quot;EQUIPMENT_OK&quot; ) efl += 1;
    else if( p.equipmentStatus(&quot;EQ_DUPLEX_FUEL_TANK_STATE_2&quot;) == &quot;EQUIPMENT_OK&quot; ) efl += 2;
    else if( p.equipmentStatus(&quot;EQ_DUPLEX_FUEL_TANK_STATE_3&quot;) == &quot;EQUIPMENT_OK&quot; ) efl += 3;
//ExtraFuelTanks
    if( p.equipmentStatus(&quot;EQ_RESERVE_TANK&quot;) == &quot;EQUIPMENT_OK&quot; ) efl += 1;
    else if( p.equipmentStatus(&quot;EQ_AUX_TANK&quot;) == &quot;EQUIPMENT_OK&quot; ) efl += 3;
//Fuel_Tank
    if( p.equipmentStatus(&quot;EQ_FUELTANK_MINE&quot;) == &quot;EQUIPMENT_OK&quot; ) { 
        for( var i = 0; i &lt; p.missiles.length; i++ ) {
            if( p.missiles[i].equipmentKey == &quot;EQ_FUELTANK_MINE&quot; ) efl += 3;
        }
    }
// altitude calculation
    if(system.isInterstellarSpace){
            var alt = 99999;
    }else{
        var ss = system.sun; 
        var alt = 0; 
        var sp = system.planets;
        var len = sp.length;
        
        if(ss) var d = p.position.distanceTo( ss.position );
        else var d = 100000000000000000000.0;

        for( var i = 0; i &lt; len; i++ ) { //find the smallest distance
                var s = p.position.distanceTo(sp[i].position )-sp[i].radius
                if(d &gt; s) {
                d = s;
                ss = sp[i];
                }
        }
        var u = &quot;&quot;;
        alt = p.position.distanceTo(ss) - ss.radius - p.collisionRadius;
        if(this.$LastUsed[11] != alt){
                if(alt&lt;1000){
                        u = &quot;0.&quot;;
                        var a = alt;
                }else{ 
                        var a = Math.round(alt/1000);
                }
                this._setGauge(&quot;VimanaAltG&quot;,alt,50000,11,&quot;lp&quot;);
                this._txtDial(&quot;VimanaAlt&quot;,u + Math.round(a)) ;
        }
    }
            
    if(this.$LastUsed[0] != ctemp){     //cabin temperature
                this._txtDial(&quot;VimanaCTemp&quot;,ctemp + &quot;°&quot;);
                this._setGauge(&quot;VimanaCTempG&quot;,ctemp,100,0,&quot;ln&quot;);
    }
    if(this.$LastUsed[1] != speed){     //speed
                this._txtDial(&quot;VimanaSpeed&quot;,speed);
                if(speed&gt;p.maxSpeed)this._setGauge(&quot;VimanaSpeedG&quot;,speed,p.maxSpeed,1,&quot;ln&quot;);
                else this._setGauge(&quot;VimanaSpeedG&quot;,speed,p.maxSpeed,1,&quot;lp&quot;);
    }
            if(this.$LastUsed[2] != fuel || this.$LastUsed[3] != efl){ //fuel
                var ef = &quot;&quot;;
                if(efl)ef = &quot;+&quot; +    Math.round(efl);
                this._txtDial(&quot;VimanaFuel&quot;,fuel + ef);
                this._setGauge(&quot;VimanaFuelG&quot;,fuel,7,2,&quot;lp&quot;);
                this.$LastUsed[3] = efl;
                this.$LastUsed[2] = fuel;
            }
            if(this.$LastUsed[15] != this.$ReqFuel){     //required fuel 
                var a = Math.round(this.$ReqFuel/(7/15));
                player.ship.setCustomHUDDial(&quot;VimanaFuelR&quot;,&quot;fr&quot; + a + &quot;.png&quot;);
                this.$LastUsed[15] = this.$ReqFuel;
            }
            if(this.$LastUsed[4] != p.cargoSpaceUsed || this.$LastUsed[5] != p.cargoSpaceCapacity){     //cargo
                this._txtDial(&quot;VimanaCargo&quot;,p.cargoSpaceUsed + &quot;/&quot; + p.cargoSpaceCapacity);
                this.$LastUsed[5] = p.cargoSpaceCapacity;
                if(p.cargoSpaceCapacity == 0) this._setGauge(&quot;VimanaCargoG&quot;,1,1,4,&quot;ln&quot;);
                else this._setGauge(&quot;VimanaCargoG&quot;,p.cargoSpaceUsed,p.cargoSpaceCapacity,4,&quot;ln&quot;);
            }
            if(this.$LastUsed[6] != p.energy){        //energy
                this._txtDial(&quot;VimanaEnergy&quot;,Math.round(p.energy));
                this._setGauge(&quot;VimanaEnergyG&quot;,p.energy,p.maxEnergy,6,&quot;pp&quot;);
            }
            if(this.$LastUsed[7] != p.aftShield){ 
                var wtp = Math.round(p.aftShield / p.maxAftShield*100);    
                this._txtDial(&quot;VimanaAsh&quot;,wtp + &quot;%&quot;);
                this._setGauge(&quot;VimanaAshG&quot;,p.aftShield,p.maxAftShield,7,&quot;pp&quot;);
            }
            if(this.$LastUsed[8] != p.forwardShield){
                var wtt = Math.round(p.forwardShield / p.maxForwardShield*100);
                this._txtDial(&quot;VimanaFsh&quot;,wtt + &quot;%&quot;);
                this._setGauge(&quot;VimanaFshG&quot;,p.forwardShield,p.maxForwardShield,8,&quot;pp&quot;);
            }
            this._txtDial(&quot;VimanaLaserName&quot;,p.currentWeapon.name) ;
            
            if(this.$LastUsed[9] != p.laserHeatLevel){
                this._txtDial(&quot;VimanaLaserTemp&quot;,Math.round(p.laserHeatLevel * 1190) + &quot;°&quot;);
                this._setGauge(&quot;VimanaLaserTempG&quot;,p.laserHeatLevel,0.85,9,&quot;pn&quot;);
            }
            if(this.$LastUsed[10] != missionVariables.ironHide_percentage){
                this._txtDial(&quot;VimanaArmour&quot;,missionVariables.ironHide_percentage + &quot;%&quot;);
                this._setGauge(&quot;VimanaArmourG&quot;,missionVariables.ironHide_percentage,100,10,&quot;pp&quot;);
            }
}

//----------------------------------------------------------------------------------------
this._setGauge = function _vimanaHUD_setGauge(key,cur,max,i,pos) {
//set gauge speed, ctemp, alt, shield, etc
    var a = max/15;
    this.$LastUsed[i] = cur;
    if(cur &gt; max) cur = max;
    a = Math.round(cur/a);
    player.ship.setCustomHUDDial(key,a + &quot;_&quot; + pos + &quot;.png&quot;);
}

</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
