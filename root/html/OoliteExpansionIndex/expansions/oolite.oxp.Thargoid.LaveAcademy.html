<html>
    <head>
        <title>Expansion Lave Academy</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Lave Academy</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">42 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">8 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER D)(&#39;[]&#39; vs &#39;[dockables, missions, new commanders, OXPConfig, activities]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Introduces the Lave Academy Orbital Station to the Lave and optionally other systems. Also features three mini-games that test basic flight skills.</td>
                    <td>Introduces the Lave Academy Orbital Station to the Lave and optionally other systems. Also features three mini-games that test basic flight skills.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.LaveAcademy</td>
                    <td>oolite.oxp.Thargoid.LaveAcademy</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Lave Academy</td>
                    <td>Lave Academy</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Dockables</td>
                    <td>Dockables</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.34</td>
                    <td>1.34</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>dockables, missions, new commanders, OXPConfig, activities</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Lave_Academy_OXP">http://wiki.alioth.net/index.php/Lave_Academy_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/0/0c/Lave_Academy_1.33.oxz">https://wiki.alioth.net/img_auth.php/0/0c/Lave_Academy_1.33.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873229</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Lave%20Academy'>http://wiki.alioth.net/index.php/Lave%20Academy</a></p>
        <h3>Lave Academy v1.34 ReadMe &amp; License.txt</h3>
        <pre>Lave Academy OXP by Thargoid
----------------------------

With the rise of interest in becoming a space pilot following the recent galactic financial troubles, Lave Academy has never been busier. To help in both the training of new recruits, plus the skills maintenance and re-certification of more experienced commanders, they have invested in a new orbital station equipped to offer training in three key areas - piloting, gunnery and docking.

It is designed for both new commanders who need a bit of practice before venturing out into the wild black galaxy. The courses are however also open to more seasoned veterans who would like to return to their alma mata and show off their skills to the student populus.

As the popularity has grown further, new stations have been planned for other locations, both in Galaxy 1 and beyond.

This updated version is for Oolite 1.77 and higher. It will not work with older versions of the game.

------------------------------------------------------------------------------------------------------------------------------------------------------------
Brief Instructions
------------------

* Station located at the edge of the security zone of Lave station (G1). A new buoy is also spawned part-way between the main station Nav-buoy and the Academy. Simply fly to the Nav-buoy and face towards the new buoy on your scanner to line up with the Academy (it should be visible anyway). Alternatively you can follow &quot;A&quot; on your ASC where fitted.
* Dock with station by flying into the blue glow in the centre.
* Three training missions available, via special screen accessible by F8 when docked at the station.
* Instructions given in-game, plus detailed instructions below.
* Once test is selected, launch and the fly to the relevant course buoy. It will communicate to your ship to indicate which one to approach.
* For the docking and gunnery tests, keep the main course buoy on-screen at all times during the test.
* All tests are against the clock, with the best time for each recorded.

------------------------------------------------------------------------------------------------------------------------------------------------------------
Known Issues and Incompatibilities
----------------------------------

* Take care with the docking test, as the drones are very solid and can make just as much a mess of your ship as a real station can.

* To prevent distracting information appearing from the course buoys, the OXP disables the Planetary Information System (Welcome Mat) at the beginning of the tests. It is re-enabled once they are completed or aborted.

------------------------------------------------------------------------------------------------------------------------------------------------------------
OXPConfig settings
------------------

This OXP is designed to work with OXPconfig, to allow tweaks to the number of academies that appear:

ExtraA = false, (ExtraB ignored) - only the academy at Lave will appear.
ExtraA = true, ExtraB = false - One academy will appear per galaxy.
ExtraA = true, ExtraB = true - Five academies will appear per galaxy.

The locations are as follows:

Galaxy 1 - Lave, Esteonbi, Enonla, Esanbe, Xequerin.
Galaxy 2 - Maesaron, Erenanri, Reveabe, Legeara, Tigebere.
Galaxy 3 - Radiqu, Edxeri, Ceedleon, Atius,Rerebi.
Galaxy 4 - Mavelege, Bemate, Cebitiza,  Mausra, Ensoor.
Galaxy 5 - Zaaner, Vebi, Inenares, Azaenbi, Dioris.
Galaxy 6 - Teesso, Oresmaa, Celaan, Ariqu, Inesbe.
Galaxy 7 - Isdilaon, Aenbi, Ataer, Orreedon, Qutegequ.
Galaxy 8 - Ceenza, Aarzari, Biatzate, Inbein, Oredrier.

For one academy per galaxy, the first planet in each list will be its host.

------------------------------------------------------------------------------------------------------------------------------------------------------------
Full Details and Instructions
-----------------------------

Lave Academy Orbital Station
----------------------------

This large structure can be found in orbit around the planet Lave in Galaxy 1, just at the edge of the security zone of the main planetary station. It can easily be found by launching from there and locating the way marker buoy on your scanner. This is roughly half way between the station and the Academy, which should be easily visible behind it. Alternatively for ships equipped with such equipment, it can be found by selecting &quot;A&quot; on your advanced space compass. 

As this is an official Galcop location, trading of any commodity is banned, and due to its academic nature the only general equipment available is the witchspace fuel that may be needed for or consumed in undertaking the training tests. Therefore the normal marketplace information screen (F8) is now replaced by an access screen where you can review and sign up for the three offered training courses.

The station itself has been especially designed for its purpose, with thought towards its users and their general lack of experience in maneuvering and docking. At great expense a special system has been employed of tractor-beam assisted docking. To engage this, all the commander needs to do is to fly into the blue glowing area in the stations centre and the system will automatically take over and bring the ship into the station. For commanders whose ships are equipped with docking computers, these may also be used. It should also be noted that after some recent unfortunate incidents with ships equipped with semi-AI defense turrets, such ships are presently banned from docking at the Lave Academy orbital station.

Once docking is completed, one of the three available tests can be selected from the F8 screen. Each of these has built-in instructions, but more details are given below. All three are based around specially equipped course buoys which can be found in the vicinity of the station (all are within standard scanner range at launch). When a course is accepted and the commander launches from the station, the relevant buoy will automatically detect the ship and initiate communications with it to guide it to the correct place. Each course will begin within a few seconds of the ship approaching the buoy.

One final note, for those wishing to cause trouble, the academy is defended by a small squadron of very well equipped Vipers and Viper Interceptors who are experienced at dealing with unruly students.


Piloting Course
---------------

This course is offered to improve and test the commanders skills in astro-navigation and in ship handling. Once the test has begun, the commander needs to fly in sequence to a number of buoys which make up the course. Each buoy will identify itself by communicating with the ship, and must be approached to proceed to the next one. To make things more interesting a number of asteroids also populate the course area, which must be avoided. They can also be destroyed, but this is considered minor cheating and incurs a small time penalty. The course is run against the clock, with the best time being noted.

Also randomly placed within the course are a number of standard-issue ring drones. When flown through, these give a bonus time reduction to the commanders overall score. It is up to their skill and judgement to decide whether the time taken to detour through them is worth the bonus that they give (flying through them is optional, the course can be successfully completed without utilising them).


Gunnery Course
--------------

This is the most popular course in the academy, colloquially known as the &quot;Shooting Gallery&quot;. When the buoy is approached and the test begun, it generates in sequence three sets of 5 target drones, each of which must be destroyed. These drones have a maximum lifetime of 30 to 60 seconds (depending on the commanders rank and ships equipment), after which they automatically self-destruct. The drone lifetime is announced at the beginning of the test by the buoy. The drones at level one are static, whilst those of the other two levels move faster and are increasingly more agile and a challenge to hit.

The test ends once all fifteen drones have been destroyed or have self-destructed, and the best time achieved is recorded. One other key consideration is that throughout the test the commander must keep the main buoy within scanner range, or else the test will be aborted. 


Docking Course
--------------

The last of the three tests, and arguably the most challenging, is the docking practice course. This simulates the requirements to dock with a standard station &quot;letterbox&quot; docking bay, one of the most difficult routine tasks a commander faces (and no, in this one you can&#39;t use a docking computer!). Once buoy approach is completed and the test begun, three sets of three drones will appear in sequence. The first set is simply for familiarisation, and has a large ring which must be flown through. The second set is similar, but an insert appears within the ring, gradually restricting its size down to that of a standard docking bay. The third set are the same as the second, except this time both the ring and insert begin to rotate, to fully simulate the conditions when docking with a real station for the final buoy.

It should be noted that approaches to the drones should be made slowly, as there have been cases of students who got over-confident with the accelerator smashing their ships against the drones with fatal consequences. To aid in successful traversal a line of glowing mini-buoys (nicknamed the &quot;trail of breadcrumbs&quot; by students) indicate the ideal path to take through the drone. The drones are also programmed to orient themselves perpendicularly to the main course buoy, so this can also be used to orientate the ship in lieu of the normal station nav-buoy.

Finally each drone must be successfully traversed within a three minute window of its appearance, or else it will self-destruct. And at all times the commander must keep the main buoy on his scanner, or else the test will automatically be aborted. 

------------------------------------------------------------------------------------------------------------------------------------------------------------

License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement. Basically if it&#39;s unique or would identify or overwrite anything in the original OXP, then you may not re-use it (for obvious compatibility reasons).
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* The license information (either as this file or merged into a larger one) must be included in the OXP.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)


------------------------------------------------------------------------------------------------------------------------------------------------------------
Instructions
------------

Unzip the file, and then move the folder &quot;Lave Academy 1.33.oxp&quot; to the AddOns directory of your Oolite installation. Then start the game up and the ships should be added. 

------------------------------------------------------------------------------------------------------------------------------------------------------------
Version History
---------------

04/03/2009 - Version 1.00, Initial release.
09/03/2009 - Version 1.01, modifications based on feedback:
		Added a buoy part-way between the main station Nav-buoy and the academy, to point people in the right direction.
		Modified the target drones lifetime to 30s + 10s each for commanders with &lt;16 kills, without fuel injectors and with only pulse lasers.
		Tweaked the script a bit to prevent incorrect messages for new Jamesons, due to lack of save game &amp; use of mission variables.
		Reworked the pilot buoy/drone scripts to prevent the crash to desktop if the 15 minute timer elapses.
10/03/2009 - Version 1.02, scripting adjustment to spawn the Academy and buoys (and the pilot course) relative to the main station, rather than absolute.
25/08/2009 - Version 1.1, script update for v1.73 compatibility (setPosition and setOrientation depreciation), plus optional addition of extra academies.
15/09/2009 - Version 1.11, minor change to shipdata.plist to remove a potential issue.
17/04/2010 - Version 1.20, scripting for v1.74 - now no longer compatible with older versions of the game.
13/02/2011 - Version 1.21, removal of upper limit, to allow running with 1.75
20/02/2011 - Version 1.30, update to try and make docking rings less deadly.
31/12/2011 - Version 1.31, small script update to stop log errors in 1.76.
08/01/2013 - Version 1.32, update for v1.77 (now minimum version) with new logs and interface access.
05/02/2013 - Version 1.33, update to restore compatibility with OXPConfig.
07/10/2014 - Version 1.34, tweak to shipdata.plist for iMac compatibility.

------------------------------------------------------------------------------------------------------------------------------------------------------------
Acknowledgements
----------------

With thanks to:
* Griff for the superb shaders and overall appearance of the station.
* Lestradae and PAGroove for the discussions and beta-testing.
* Eric Walch and Kaks for deep playtesting and bug reporting on the positioning issue (which was a bug in the 1.72.2 trunk).
* _ds_ for the core patch to enable icons in the ASC, and for the fuel pump icon in this OXP.
* Dr Beeb for the idea of multiple galaxies.
* Wildeblood for the heads-up on the 1.76 log errors.
* Captain Beatnik for the iMac heads-up for v1.34.</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_academy.html">Academy Orbital Station</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dock.html">Academy Dock Ring (Hidden)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingBuoy.html">Docking Course Buoy</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingDroneL1.html">Docking Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingDroneL2.html">Docking Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingDroneL2a.html">laveAcademy_dockingDroneL2a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingDroneL2b.html">laveAcademy_dockingDroneL2b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingDroneL2c.html">laveAcademy_dockingDroneL2c</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingDroneL3.html">Docking Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingDroneL3a.html">laveAcademy_dockingDroneL3a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingDroneL3b.html">laveAcademy_dockingDroneL3b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingDroneL3c.html">laveAcademy_dockingDroneL3c</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingInsertRa.html">Docking Drone Insert (Rotating)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingInsertRb.html">Docking Drone Insert (Rotating)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingInsertRc.html">Docking Drone Insert (Rotating)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingInserta.html">Docking Drone Insert a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingInsertb.html">Docking Drone Insert b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingInsertc.html">Docking Drone Insert c</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingRing.html">Docking Drone Ring</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingRingRa.html">Docking Drone Ring (Rotating)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingRingRb.html">Docking Drone Ring (Rotating)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_dockingRingRc.html">Docking Drone Ring (Rotating)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_genericBuoy.html">Generic Academy Buoy</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_interior.html">Academy</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_pilotAsteroid.html">Asteroid</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_pilotBuoy.html">Pilot Course Buoy</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_pilotCircuitBuoy1.html">Pilot Circuit Buoy 1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_pilotCircuitBuoy2.html">Pilot Circuit Buoy 2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_pilotCircuitBuoy3.html">Pilot Circuit Buoy 3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_pilotCircuitBuoy4.html">Pilot Circuit Buoy 4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_pilotCircuitBuoy5.html">Pilot Circuit Buoy 5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_pilotCircuitBuoy6.html">Pilot Circuit Buoy 6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_pilotCircuitBuoy7.html">Pilot Circuit Buoy 7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_pilotRing.html">Time Bonus Ring</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_securityViper.html">Academy Security Patrol</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_securityViperInterceptor.html">Academy Security Interceptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_targetBuoy.html">Target Practice Course Buoy</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_targetDroneGeneric.html">Target Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_targetDroneL1.html">Target Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_targetDroneL2.html">Target Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_targetDroneL3.html">Target Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/laveAcademy_wayBuoy.html">Academy Waymarker Buoy</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/laveAcademy_dockingBuoy.js</td>
                    <td><pre>this.name					= &quot;LaveAcademy_dockingBuoy&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme.txt.&quot;;
this.description			= &quot;Control of academy docking practice buoys in the Lave system&quot;;
this.version				= &quot;1.2&quot;;

this.examStart = function()
	{
	this.examStartTime = clock.absoluteSeconds;
	this.buoyPosition = this.ship.position;
	missionVariables.laveAcademy_droneCount = 0;
	missionVariables.laveAcademy_droneAbort = null;
	player.consoleMessage(&quot;Docking Practice Course Started!&quot;,6);
	if(this.launchCheckTimer)
		{
		this.launchCheckTimer.start();
		}
	else
		{
		this.launchCheckTimer = new Timer(this, this.droneCheck, 0, 1);
		}
	}

this.droneCheck = function()
	{
	if(player.ship.docked) // if the player is docked (at the Academy) then stop the test quietly
		{
		this.launchCheckTimer.stop();
		missionVariables.laveAcademy_droneAbort = true;
		this.ship.AIState = &quot;LIGHTS_OFF&quot;;
		missionVariables.laveAcademyExam = null;
		return;
		}

 	function isPlayer(entity) {return entity.isShip &amp;&amp; entity.isPlayer}; 
	this.playerInRange = system.filteredEntities(this, isPlayer, this.ship, 25600).length;
	if(this.playerInRange == 0)
		{
		this.launchCheckTimer.stop();
		missionVariables.laveAcademy_droneCount -= 1;
		this.cancelExam();
		}

	if(missionVariables.laveAcademy_droneAbort)
		{
		this.launchCheckTimer.stop();
		return;
		}

	function isDockingDrone(entity) {return entity.isShip &amp;&amp; entity.hasRole(&quot;laveAcademy_dockingDrone&quot;)};
	if(system.filteredEntities(this, isDockingDrone, this.ship, 25600).length == 0)
		{
		if(missionVariables.laveAcademy_droneCount == 10)
			{
			this.endExam();
			}
		else
			{
			missionVariables.laveAcademy_droneCount += 1;
			switch(true)
				{
				case (missionVariables.laveAcademy_droneCount == 1):
					{
					player.commsMessage(&quot;Level One.&quot;, 6);
					system.legacy_addShipsWithinRadius(&quot;laveAcademy_dockingDroneL1&quot;, 1, &quot;abs&quot;, this.buoyPosition, 14000);
					break;
					}
				case (missionVariables.laveAcademy_droneCount == 2 || missionVariables.laveAcademy_droneCount == 3):
					{
					system.legacy_addShipsWithinRadius(&quot;laveAcademy_dockingDroneL1&quot;, 1, &quot;abs&quot;, this.buoyPosition, 14000);
					break;
					}

				case (missionVariables.laveAcademy_droneCount == 4):
					{
					player.commsMessage(&quot;Level Two.&quot;, 6);
					system.legacy_addShipsWithinRadius(&quot;laveAcademy_dockingDroneL2a&quot;, 1, &quot;abs&quot;, this.buoyPosition, 14000);
					break;
					}
				case (missionVariables.laveAcademy_droneCount == 5):
					{
					system.legacy_addShipsWithinRadius(&quot;laveAcademy_dockingDroneL2b&quot;, 1, &quot;abs&quot;, this.buoyPosition, 14000);
					break;
					}
				case (missionVariables.laveAcademy_droneCount == 6):
					{
					system.legacy_addShipsWithinRadius(&quot;laveAcademy_dockingDroneL2c&quot;, 1, &quot;abs&quot;, this.buoyPosition, 14000);
					break;
					}

				case (missionVariables.laveAcademy_droneCount == 7):
					{
					player.commsMessage(&quot;Level Three.&quot;, 6);
					system.legacy_addShipsWithinRadius(&quot;laveAcademy_dockingDroneL3a&quot;, 1, &quot;abs&quot;, this.buoyPosition, 14000);
					break;
					}
				case (missionVariables.laveAcademy_droneCount == 8):
					{
					system.legacy_addShipsWithinRadius(&quot;laveAcademy_dockingDroneL3b&quot;, 1, &quot;abs&quot;, this.buoyPosition, 14000);
					break;
					}
				case (missionVariables.laveAcademy_droneCount == 9):
					{
					system.legacy_addShipsWithinRadius(&quot;laveAcademy_dockingDroneL3c&quot;, 1, &quot;abs&quot;, this.buoyPosition, 14000);
					break;
					}
				}
			}
		}
	}

this.endExam = function()
	{
	this.launchCheckTimer.stop();
	if(worldScripts[&quot;Welcome Information Script&quot;]) // if Welcome Mat has been disabled earlier, restart it
		{
		if(!worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.isRunning)
			{
			worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.start();
			if(player.ship.equipmentStatus(&quot;EQ_WELCOME_MAT&quot;) == &quot;EQUIPMENT_OK&quot;)
				{
				player.consoleMessage(&quot;Planetary Information System restarted.&quot;,6);
				}
			}
		}
	this.examStopTime = clock.absoluteSeconds;
	this.examElapsedTime = Math.floor(this.examStopTime - this.examStartTime);
	this.examTimeMinutes = Math.floor(this.examElapsedTime / 60);
	this.examTimeSeconds = this.examElapsedTime - (60 * this.examTimeMinutes);
	missionVariables.laveAcademy_droneAbort = true;
	player.commsMessage(&quot;You completed the test in &quot; + this.examTimeMinutes + &quot;m &quot; + this.examTimeSeconds + &quot;s.&quot;, 10);
	this.ship.AIState = &quot;LIGHTS_OFF&quot;;
	missionVariables.laveAcademyExam = null;
	this.bestTime = (missionVariables.laveAcademy_bestDockingTimeM * 60) + missionVariables.laveAcademy_bestDockingTimeS;

	if(this.bestTime == 0 &amp;&amp; this.examElapsedTime &gt; 0)
		{
		player.commsMessage(&quot;We have registered your new best time.&quot;, 10);
		missionVariables.laveAcademy_bestDockingTimeM = Math.floor(this.examElapsedTime / 60);
		missionVariables.laveAcademy_bestDockingTimeS = this.examElapsedTime - (60 * (Math.floor(this.examElapsedTime / 60)));		
		return;
		}

	if(this.bestTime &gt; this.examElapsedTime)
		{
		player.commsMessage(&quot;Congratulations, you&#39;ve improved your best time!&quot;, 10);
		missionVariables.laveAcademy_bestDockingTimeM = Math.floor(this.examElapsedTime / 60);
		missionVariables.laveAcademy_bestDockingTimeS = this.examElapsedTime - (60 * (Math.floor(this.examElapsedTime / 60)));		
		return;
		}
	}

this.cancelExam = function()
	{
	this.examStopTime = clock.absoluteSeconds;
	this.examElapsedTime = Math.floor(this.examStopTime - this.examStartTime);
	this.examTimeMinutes = Math.floor(this.examElapsedTime / 60);
	this.examTimeSeconds = this.examElapsedTime - (60 * this.examTimeMinutes);
	missionVariables.laveAcademy_droneAbort = true;
	this.droneArray = system.shipsWithRole(&quot;laveAcademy_dockingDrone&quot;)
	if(this.droneArray.length &gt; 0)
		{
		this.droneArray.forEach(
			function(drone)
				{
				drone.remove()
				}
			)
		}
	player.commsMessage(&quot;Docking test aborted after &quot; + this.examTimeMinutes + &quot;m &quot; + this.examTimeSeconds + &quot;s.&quot;, 10);
	this.ship.AIState = &quot;LIGHTS_OFF&quot;;
	missionVariables.laveAcademyExam = null;
	if(worldScripts[&quot;Welcome Information Script&quot;]) // if Welcome Mat has been disabled earlier, restart it
		{
		if(!worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.isRunning)
			{
			worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.start();
			if(player.ship.equipmentStatus(&quot;EQ_WELCOME_MAT&quot;) == &quot;EQUIPMENT_OK&quot;)
				{
				player.consoleMessage(&quot;Planetary Information System restarted.&quot;,6);
				}
			}
		}
	}

this.playerWillEnterWitchspace = function()
	{
	if(worldScripts[&quot;Welcome Information Script&quot;] &amp;&amp; !worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.isRunning)
		{
		worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.start();
		}

	if(this.launchCheckTimer)
		{
		this.launchCheckTimer.stop();
		}
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/laveAcademy_dockingDrone.js</td>
                    <td><pre>this.name					= &quot;LaveAcademy_dockingDrone&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme.txt.&quot;;
this.description			= &quot;Script for the docking drones in the docking test of Lave Academy&quot;;
this.version				= &quot;1.3&quot;;

this.shipSpawned = function()
	{ 
	this.ship.scannerDisplayColor1 = &quot;yellowColor&quot;;
	this.ship.scannerDisplayColor2 = &quot;whiteColor&quot;;
	this.rotateQ = function(q, axis, angle) { return q.rotate(axis, angle); }
	
	this.buoyArray = system.shipsWithPrimaryRole(&quot;laveAcademy_dockingBuoy&quot;); // find the buoy for the docking course

	if(this.buoyArray.length == 1)
		{ // set the drone at right angles to the vector away from the buoy
		this.dockingBuoy = this.buoyArray[0];
		let droneVector = this.ship.position.subtract(this.dockingBuoy.position).direction(); // unit vector pointing away from the buoy
		let dronePosition = this.ship.position.add(droneVector.multiply(1000)); // add an offset 1km away from the planet
		let angle = this.ship.heading.angleTo(droneVector); // angle between current heading and target heading
		let cross = this.ship.heading.cross(droneVector).direction(); // set the plane where we should rotate in
		this.ship.orientation = this.rotateQ(this.ship.orientation, cross, -angle); // re-orient the drone at right angle to the buoy vector
		this.ship.position = dronePosition; // move the drone 1km away from the buoy, to ensure there&#39;s room for traverse
		}
	else
		{ // randomise the ring&#39;s orientation instead
		this.newW = (Math.random()*2)-1; // a value between -1 and 1 for each component
		this.newX = (Math.random()*2)-1;
		this.newY = (Math.random()*2)-1;
		this.newZ = (Math.random()*2)-1;
		this.newOrientation = new Quaternion(this.newW, this.newX, this.newY, this.newZ);
		this.ship.orientation = this.newOrientation;
		}

	this.destructTimer = new Timer(this, this.selfDestruct, 180);  // give the drone a 3 minute lifetime.
	}

this.flyThru = function()
	{
	this.destructTimer.stop();
	player.consoleMessage(&quot;Traverse successful.&quot;, 6);
	this.ship.remove();
	}

this.selfDestruct = function()
	{
	if(!missionVariables.laveAcademy_droneAbort &amp;&amp; !player.ship.docked) // if the exam is still going but the player didn&#39;t &quot;dock&quot; in time
		{
		player.commsMessage(&quot;Traverse failed.&quot;, 5);	
		}
	this.ship.remove();
	}

this.shipTakingDamage = function(amount, fromEntity, damageType)	
	{
	if(fromEntity &amp;&amp; fromEntity.isPlayer &amp;&amp; amount &amp;&amp; amount &gt; 0 &amp;&amp; damageType &amp;&amp; damageType === &quot;scrape damage&quot;)
		{
		player.commsMessage(&quot;You scraped the ring - take care!&quot;, 6);
		player.ship.energy += amount;
		this.ship.energy += amount;
		}
	}	
	
this.playerWillEnterWitchspace = function()
	{
	if(this.destructTimer)
		{
		this.destructTimer.stop;
		}
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/laveAcademy_pilotAsteroid.js</td>
                    <td><pre>this.name					= &quot;LaveAcademy_pilotAsteroid&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme.txt.&quot;;
this.description			= &quot;Script for the asteroids in pilot course of Lave Academy&quot;;
this.version				= &quot;1.2&quot;;

this.shipDied = function(whom, why)
	{
	if(whom &amp;&amp; whom.isPlayer &amp;&amp; missionVariables.laveAcademyExam == &quot;PILOT&quot;) // player kill during pilot course
		{
		missionVariables.laveAcademy_pilotScore -= 2; // player penalised 2 seconds for killing the asteroid.
		player.score -= 1; // as this is an exam, the asteroids shouldn&#39;t count as kills for rank etc.
		}
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/laveAcademy_pilotBuoy.js</td>
                    <td><pre>this.name					= &quot;LaveAcademy_pilotBuoy&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme.txt.&quot;;
this.description			= &quot;Control of academy pilot practice course in the Lave system&quot;;
this.version				= &quot;1.2&quot;;

this.examStart = function()
	{ // first set up the asteroids and rings
	
	this.removeCourse(); // just in case we&#39;re repeating the exam and we&#39;ve still got debris around.
	
	this.buoy1Position = this.ship.position.add([-20000,0,0]);
	this.buoy2Position = this.buoy1Position.add([0,20000,0]);
	this.buoy3Position = this.buoy2Position.add([0,0,-20000]);
	this.buoy4Position = this.buoy3Position.add([-20000,0,0]);
	this.buoy5Position = this.buoy4Position.add([0,-20000,0]);
	this.buoy6Position = this.buoy5Position.add([20000,0,0]);
	this.buoy7Position = this.buoy6Position.add([20000,0,0]);
	
	this.ring1Position = this.buoy1Position.add([0,10000,0]);
	this.ring2Position = this.buoy3Position.add([-10000,0,0]);
	this.ring3Position = this.buoy5Position.add([10000,0,0]);

	system.legacy_addShipsWithinRadius(&quot;laveAcademy_pilotAsteroid&quot;, 5, &quot;abs&quot;, this.buoy2Position, 7000); // 5 rocks around buoy 2.
	system.legacy_addShipsWithinRadius(&quot;laveAcademy_pilotRing&quot;, 1, &quot;abs&quot;, this.ring1Position, 7000); // 1 bonus ring between buoys 1 &amp; 2.
	system.legacy_addShipsWithinRadius(&quot;laveAcademy_pilotAsteroid&quot;, 7, &quot;abs&quot;, this.buoy3Position, 7000); // 7 rocks around buoy 3.
	system.legacy_addShipsWithinRadius(&quot;laveAcademy_pilotAsteroid&quot;, 12, &quot;abs&quot;, this.buoy4Position, 7000); // 12 rocks around buoy 4.
	system.legacy_addShipsWithinRadius(&quot;laveAcademy_pilotRing&quot;, 2, &quot;abs&quot;, this.ring2Position, 7000); // 2 bonus rings between buoys 3 &amp; 4.
	system.legacy_addShipsWithinRadius(&quot;laveAcademy_pilotAsteroid&quot;, 7, &quot;abs&quot;, this.buoy5Position, 7000); // 7 rocks around buoy 5.
	system.legacy_addShipsWithinRadius(&quot;laveAcademy_pilotAsteroid&quot;, 5, &quot;abs&quot;, this.buoy6Position, 7000); // 5 rocks around buoy 6.
	system.legacy_addShipsWithinRadius(&quot;laveAcademy_pilotRing&quot;, 1, &quot;abs&quot;, this.ring3Position, 7000); // 1 bonus rings between buoys 5 &amp; 6.


	// Reset the mission variables, start the clock and tell the player we&#39;re underway
	this.examStartTime = clock.absoluteSeconds;
	missionVariables.laveAcademy_pilotScore = 0; // bonus and penalty counter
	missionVariables.laveAcademy_pilotCurrentBuoy = 0; // the number of the buoy we are currently at
	missionVariables.laveAcademy_pilotNextBuoy = 1; //  the number of the next buoy to be reached
	missionVariables.laveAcademy_pilotNextBuoyName = &quot;pilotBuoy1&quot;;
	player.consoleMessage(&quot;Pilot Course Started!&quot;,6);

	if(this.pilotCourseTimer)
		{
		this.pilotCourseTimer.start();
		}
	else
		{
		this.pilotCourseTimer = new Timer(this, this.runCourse, 0, 1);
		}
	}

this.runCourse = function()
	{
	if(player.ship.docked) // if the player is docked then stop the test quietly
		{
		this.quietEnd();
		return;		
		}

	this.examElapsedTime = Math.floor(clock.absoluteSeconds - this.examStartTime); // absolute time since test began, without penalties or bonuses 
	if(this.examElapsedTime &gt; 900) // if we&#39;ve been at the test for over 15 minutes
		{
		player.commsMessage(&quot;Pilot test expired, please return to the Academy.&quot;,6);
		this.quietEnd();
		return;
		}
		
	if(missionVariables.laveAcademy_pilotNextBuoy == 8 || missionVariables.laveAcademy_pilotNextBuoyName == &quot;FinishLine&quot;) // if we reached the 7th buoy
		{
		this.pilotCourseTimer.stop();
		this.finishLine();
		return;
		}

	if(missionVariables.laveAcademy_pilotCurrentBuoy &lt; missionVariables.laveAcademy_pilotNextBuoy) // if we reached a buoy successfully spawn &amp; set next
		{
		missionVariables.laveAcademy_pilotCurrentBuoy += 1;
		switch(missionVariables.laveAcademy_pilotNextBuoyName)
			{
			case &quot;pilotBuoy1&quot;:
				{
				let pilotBuoy1 = this.ship.spawnOne(&#39;laveAcademy_pilotCircuitBuoy1&#39;);
				pilotBuoy1.position = this.buoy1Position;
				pilotBuoy1.AIState = &quot;LIGHTS_ON&quot;;
				pilotBuoy1.scannerDisplayColor1 = &quot;redColor&quot;;
				pilotBuoy1.scannerDisplayColor2 = &quot;whiteColor&quot;;
				break;
				}

			case &quot;pilotBuoy2&quot;:
				{
				let pilotBuoy2 = this.ship.spawnOne(&#39;laveAcademy_pilotCircuitBuoy2&#39;);
				pilotBuoy2.position = this.buoy2Position;
				pilotBuoy2.AIState = &quot;LIGHTS_ON&quot;;
				pilotBuoy2.scannerDisplayColor1 = &quot;redColor&quot;;
				pilotBuoy2.scannerDisplayColor2 = &quot;whiteColor&quot;;
				break;
				}

			case &quot;pilotBuoy3&quot;:
				{
				let pilotBuoy3 = this.ship.spawnOne(&#39;laveAcademy_pilotCircuitBuoy3&#39;);
				pilotBuoy3.position = this.buoy3Position;
				pilotBuoy3.AIState = &quot;LIGHTS_ON&quot;;
				pilotBuoy3.scannerDisplayColor1 = &quot;redColor&quot;;
				pilotBuoy3.scannerDisplayColor2 = &quot;whiteColor&quot;;
				break;
				}

			case &quot;pilotBuoy4&quot;:
				{
				let pilotBuoy4 = this.ship.spawnOne(&#39;laveAcademy_pilotCircuitBuoy4&#39;);
				pilotBuoy4.position = this.buoy4Position;
				pilotBuoy4.AIState = &quot;LIGHTS_ON&quot;;
				pilotBuoy4.scannerDisplayColor1 = &quot;redColor&quot;;
				pilotBuoy4.scannerDisplayColor2 = &quot;whiteColor&quot;;
				break;

				}
			case &quot;pilotBuoy5&quot;:
				{
				let pilotBuoy5 = this.ship.spawnOne(&#39;laveAcademy_pilotCircuitBuoy5&#39;);
				pilotBuoy5.position = this.buoy5Position;
				pilotBuoy5.AIState = &quot;LIGHTS_ON&quot;;
				pilotBuoy5.scannerDisplayColor1 = &quot;redColor&quot;;
				pilotBuoy5.scannerDisplayColor2 = &quot;whiteColor&quot;;
				break;
				}

			case &quot;pilotBuoy6&quot;:
				{
				let pilotBuoy6 = this.ship.spawnOne(&#39;laveAcademy_pilotCircuitBuoy6&#39;);
				pilotBuoy6.position = this.buoy6Position;
				pilotBuoy6.AIState = &quot;LIGHTS_ON&quot;;
				pilotBuoy6.scannerDisplayColor1 = &quot;redColor&quot;;
				pilotBuoy6.scannerDisplayColor2 = &quot;whiteColor&quot;;
				break;
				}

			case &quot;pilotBuoy7&quot;:
				{
				let pilotBuoy7 = this.ship.spawnOne(&#39;laveAcademy_pilotCircuitBuoy7&#39;);
				pilotBuoy7.position = this.buoy7Position;
				pilotBuoy7.AIState = &quot;LIGHTS_ON&quot;;
				pilotBuoy7.scannerDisplayColor1 = &quot;redColor&quot;;
				pilotBuoy7.scannerDisplayColor2 = &quot;whiteColor&quot;;
				break;
				}
			}
		}
	}

this.finishLine = function()
	{
	this.ship.AIState = &quot;FINISH_LINE&quot;; // comms message the player to return to the main buoy to finish the course
	if(this.pilotFinishTimer)
		{
		this.pilotFinishTimer.start();
		}
	else
		{
		this.pilotFinishTimer = new Timer(this, this.scanPlayer, 0, 1);
		}
	}

this.scanPlayer = function()
	{
	if(player.ship.docked) // if the player is docked then stop the test quietly
		{
		this.quietEnd();
		}

	this.buoyDistance = player.ship.position.distanceTo(this.ship.position); // how far the player ship is from the main buoy
	if(this.buoyDistance &lt; 1000) // if we&#39;re within 1000m, we can end the test
		{
		this.pilotFinishTimer.stop();
		this.ship.AIState = &quot;LIGHTS_OFF&quot;;
		this.examEnd();
		}
	}

this.examEnd = function()
	{
	if(worldScripts[&quot;Welcome Information Script&quot;]) // if Welcome Mat has been disabled earlier, restart it
		{
		if(!worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.isRunning)
			{
			worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.start();
			if(player.ship.equipmentStatus(&quot;EQ_WELCOME_MAT&quot;) == &quot;EQUIPMENT_OK&quot;)
				{
				player.consoleMessage(&quot;Planetary Information System restarted.&quot;,6);
				}
			}
		}
	this.examStopTime = clock.absoluteSeconds;
	this.examElapsedTime = Math.floor(this.examStopTime - this.examStartTime - missionVariables.laveAcademy_pilotScore); 
	this.examTimeMinutes = Math.floor(this.examElapsedTime / 60);
	this.examTimeSeconds = this.examElapsedTime - (60 * this.examTimeMinutes);
	this.removeCourse();
	this.ship.AIState = &quot;LIGHTS_OFF&quot;;
	missionVariables.laveAcademyExam = null;
	player.commsMessage(&quot;Your overall time for the course was &quot; + this.examTimeMinutes + &quot;m &quot; + this.examTimeSeconds + &quot;s.&quot;, 10);
	
	this.bestTime = (missionVariables.laveAcademy_bestPilotTimeM * 60) + missionVariables.laveAcademy_bestPilotTimeS;

	if(this.bestTime == 0 &amp;&amp; this.examElapsedTime &gt; 0)
		{
		player.commsMessage(&quot;We have registered your new best time.&quot;, 10);
		missionVariables.laveAcademy_bestPilotTimeM = Math.floor(this.examElapsedTime / 60);
		missionVariables.laveAcademy_bestPilotTimeS = this.examElapsedTime - (60 * (Math.floor(this.examElapsedTime / 60)));		
		return;
		}

	if(this.bestTime &gt; this.examElapsedTime)
		{
		player.commsMessage(&quot;Congratulations, you&#39;ve improved your best time!&quot;, 10);
		missionVariables.laveAcademy_bestPilotTimeM = Math.floor(this.examElapsedTime / 60);
		missionVariables.laveAcademy_bestPilotTimeS = this.examElapsedTime - (60 * (Math.floor(this.examElapsedTime / 60)));		
		return;
		}
	}

this.playerWillEnterWitchspace = this.shipDied = this.quietEnd = function()
	{
	if(this.pilotCourseTimer)
		{
		this.pilotCourseTimer.stop();
		}
	if(this.pilotFinishTimer)
		{
		this.pilotFinishTimer.stop();
		}
	this.removeCourse();
	missionVariables.laveAcademyExam = null;
	missionVariables.laveAcademy_pilotScore = 0;
	missionVariables.laveAcademy_pilotCurrentBuoy = 0;
	missionVariables.laveAcademy_pilotNextBuoy = 1;
	missionVariables.laveAcademy_pilotNextBuoyName = &quot;pilotBuoy1&quot;;
	if(worldScripts[&quot;Welcome Information Script&quot;]) // if Welcome Mat has been disabled earlier, restart it
		{
		if(!worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.isRunning)
			{
			worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.start();
			}
		}
	return;
	}

this.removeCourse = function()
	{
	this.courseList = system.shipsWithRole(&quot;laveAcademy_pilotCourse&quot;); // find all course entities so we can remove them
	if(this.courseList.length &gt; 0) // if there are parts of the course still present, loop through them and remove
		{
		let loopCounter = 0; // reset the counter
		for(loopCounter = 0; loopCounter &lt; this.courseList.length; loopCounter++)
			{
			if(this.courseList[loopCounter].scanClass == &quot;CLASS_BUOY&quot;)
				{
				this.courseList[loopCounter].AIState = &quot;REMOVE_BUOY&quot;;
				}
			else
				{
				this.courseList[loopCounter].remove();
				}
			}
		}
	}			
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/laveAcademy_pilotCircuitBuoy.js</td>
                    <td><pre>this.name					= &quot;LaveAcademy_pilotCircuitBuoy&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme.txt.&quot;;
this.description			= &quot;Control of pilot course circuit buoys&quot;;
this.version				= &quot;1.2&quot;;

this.buoyActive = function()
	{	
	if(this.playerScanTimer)
		{
		this.playerScanTimer.start();
		}
	else
		{
		this.playerScanTimer = new Timer(this, this.rangeCheck, 0, 1);
		}
	}

this.rangeCheck = function()
	{
	if(!this.ship)
		{
		this.playerScanTimer.stop();
		return;
		}

	if(player.ship.docked) // if the player is docked (at the Academy) then stop the test quietly
		{
		this.playerScanTimer.stop();
		this.ship.AIState = &quot;LIGHTS_OFF&quot;;
		this.ship.scannerDisplayColor1 = &quot;yellowColor&quot;;
		this.ship.scannerDisplayColor2 = &quot;whiteColor&quot;;
		missionVariables.laveAcademyExam = null;
		return;
		}
		
	this.buoyDistance = player.ship.position.distanceTo(this.ship.position); // how far the player ship is from the buoy
	if(this.buoyDistance &lt; 1000) // if we&#39;re within 1000m.
		{
		this.playerScanTimer.stop();
		this.ship.AIState = &quot;LIGHTS_OFF&quot;;
		player.consoleMessage(&quot;Buoy &quot; + missionVariables.laveAcademy_pilotNextBuoy + &quot; reached.&quot;,6);
		this.ship.scannerDisplayColor1 = &quot;yellowColor&quot;;
		this.ship.scannerDisplayColor2 = &quot;whiteColor&quot;;
		missionVariables.laveAcademy_pilotNextBuoy += 1;
		missionVariables.laveAcademy_pilotNextBuoyName = this.ship.scriptInfo.nextBuoy;
		}
	}

this.removeBuoy = function()
	{
	if(this.playerScanTimer &amp;&amp; this.playerScanTimer.isRunning)
		{
		this.playerScanTimer.stop();
		}
	this.ship.remove();
	}

this.playerWillEnterWitchspace = function()
	{
	if(this.playerScanTimer)
		{
		this.playerScanTimer.stop();
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/laveAcademy_systemScript.js</td>
                    <td><pre>this.name					= &quot;LaveAcademy&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme.txt.&quot;;
this.description			= &quot;Control of new additions to the Lave (and other) systems&quot;;
this.version				= &quot;1.33&quot;;

this.extraA = true;   //   Academies in all galaxies? If false only appear at Lave, nowhere else - ignore extraB
this.extraB = false;   //   Single or multiple academies if extraA set. False gives 1 per galaxy, true gives 5

this.oxpcSettings = {
	Info: {Name:this.name,Display:this.name,InfoB:&quot;1 - If false only appear at Lave, nowhere else - ignore extraB.\n2 - Single or multiple academies if extraA set. False gives 1 per galaxy, true gives 5.&quot;},
	Bool0: {Name:&quot;extraA&quot;,Def:true,Desc:&quot;Academies in all galaxies?&quot;},
	Bool1: {Name:&quot;extraB&quot;,Def:false,Desc:&quot;Multiple academies per galaxy.&quot;}
};

this.startUp = function()
	{ 
	if(missionVariables.laveAcademy_bestTargetTimeM == null)
		{ missionVariables.laveAcademy_bestTargetTimeM = 0; }
	if(missionVariables.laveAcademy_bestTargetTimeS == null)
		{ missionVariables.laveAcademy_bestTargetTimeS = 0; }
	if(missionVariables.laveAcademy_bestPilotScore == null)
		{ missionVariables.laveAcademy_bestPilotScore = 0; }
	if(missionVariables.laveAcademy_bestPilotTimeM == null)
		{ missionVariables.laveAcademy_bestPilotTimeM = 0; }
	if(missionVariables.laveAcademy_bestPilotTimeS == null)
		{ missionVariables.laveAcademy_bestPilotTimeS = 0; }
	if(missionVariables.laveAcademy_bestDockingScore == null)
		{ missionVariables.laveAcademy_bestDockingScore = 0; }
	if(missionVariables.laveAcademy_bestDockingTimeM == null)
		{ missionVariables.laveAcademy_bestDockingTimeM = 0; }
	if(missionVariables.laveAcademy_bestDockingTimeS == null)
		{ missionVariables.laveAcademy_bestDockingTimeS = 0; }
	this.deactivateWIS = false;
	this.setUpArrays();
	}

this.setUpArrays = function()
	{
	this.academyList = [0, 1, 2, 3, 4, 5, 6, 7]; // galaxies 0-7
	this.academyList[0] = [7, 173, 168, 133, 4]; // Lave, Esteonbi, Enonla, Esanbe, Xequerin
	this.academyList[1] = [24, 92, 210, 55, 194]; // Maesaron, Erenanri, Reveabe, Legeara, Tigebere
	this.academyList[2] = [58, 165, 106, 198, 164]; // Radiqu, Edxeri, Ceedleon, Atius,Rerebi
	this.academyList[3] = [13, 47, 130, 18, 122]; // Mavelege, Bemate, Cebitiza,  Mausra, Ensoor
	this.academyList[4] = [16, 193, 231, 92, 9]; // Zaaner, Vebi, Inenares, Azaenbi, Dioris
	this.academyList[5] = [151, 6, 85, 146, 240]; // Teesso, Oresmaa, Celaan, Ariqu, Inesbe
	this.academyList[6] = [189, 146, 130, 118, 37]; // Isdilaon, Aenbi, Ataer, Orreedon, Qutegequ
	this.academyList[7] = [177, 31, 211, 157, 20]; // Ceenza, Aarzari, Biatzate, Inbein, Oredrier
	this.singleList = [7, 24, 58, 13, 16, 151, 189, 177]; // array for when 1 academy per galaxy selected
	}

this.systemCheck = function(planetNum,galNum)	
	{
	if(!this.extraA) // academy at Lave only?
		{
		if(planetNum == 7 &amp;&amp; galNum == 0)
			{ return true; }	
		else
			{ return false; }
		}
        else 
		{
		if(!this.extraB)	// 1 academy per galaxy
			{
			if(planetNum == this.singleList[galNum])
				{ return true; }	
			else
				{ return false; }
			}
		else	// 5 academies per galaxy
			{
			if(this.academyList[galNum].indexOf(planetNum) != -1)
				{ return true; }	
			else
				{ return false; }
			}
		}
	}

this.setUpSystem = function()
	{
	if(this.systemCheck(system.ID, galaxyNumber))
		{
		this.academyArray = system.shipsWithPrimaryRole(&quot;laveAcademy_academy&quot;); 
			// find the academy
		this.wayBuoyArray = system.shipsWithPrimaryRole(&quot;laveAcademy_wayBuoy&quot;); 
			// find the directional way buoy between main station &amp; academy
		this.targetBuoyArray = system.shipsWithPrimaryRole(&quot;laveAcademy_targetBuoy&quot;); 
			// find the buoy for the target practice course
		this.dockingBuoyArray = system.shipsWithPrimaryRole(&quot;laveAcademy_dockingBuoy&quot;); 
			// find the buoy for the docking course
		this.pilotBuoyArray = system.shipsWithPrimaryRole(&quot;laveAcademy_pilotBuoy&quot;); 
			// find the buoy for the piloting course			

		if(this.academyArray.length === 0)
			{ this.academyArray = system.addShips(&quot;laveAcademy_academy&quot;,1,[100000,100000,100000], 1000); }
		if(this.wayBuoyArray.length === 0)
			{ this.wayBuoyArray = system.addShips(&quot;laveAcademy_wayBuoy&quot;,1,[101000,101000,101000], 1000); }
		if(this.targetBuoyArray.length === 0)
			{ this.targetBuoyArray = system.addShips(&quot;laveAcademy_targetBuoy&quot;,1,[102000,102000,102000], 1000); }
		if(this.dockingBuoyArray.length === 0)
			{ this.dockingBuoyArray = system.addShips(&quot;laveAcademy_dockingBuoy&quot;,1,[103000,103000,103000], 1000); }
		if(this.pilotBuoyArray.length === 0)
			{ this.pilotBuoyArray = system.addShips(&quot;laveAcademy_pilotBuoy&quot;,1,[104000,104000,104000], 1000); }	

		this.academy = this.academyArray[0];
		this.academy.scannerDisplayColor1 = &quot;greenColor&quot;;
		this.academy.scannerDisplayColor2 = &quot;brownColor&quot;;
		this.academy.position = system.mainStation.position.add([0,50000,0]);	
		
		this.academy.setInterface(&quot;LaveAcademy&quot;,
			{ title: &quot;Show syllabus&quot;,
			category: &quot;Station&quot;,
			summary: &quot;Display the courses available to undertake at the Academy.&quot;,
			callback: this.showCourses.bind(this) });		
		this.academy.setInterface(&quot;oolite-contracts-cargo&quot;,null);
		this.academy.setInterface(&quot;oolite-contracts-parcels&quot;,null);
		this.academy.setInterface(&quot;oolite-contracts-passengers&quot;,null);
//	Set the academy syllabus on the F4 screen, and remove the trunk ones for this station.
	
		this.wayBuoy = this.wayBuoyArray[0];		
		this.wayBuoy.position = system.mainStation.position.add([0,20000,0]);

		this.targetBuoy = this.targetBuoyArray[0];
		this.targetBuoy.position = this.academy.position.add([0,0,20000]);
		this.targetBuoy.AIState = &quot;LIGHTS_OFF&quot;;
		
		this.dockingBuoy = this.dockingBuoyArray[0];
		this.dockingBuoy.position = this.academy.position.add([20000,0,0]);
		this.dockingBuoy.AIState = &quot;LIGHTS_OFF&quot;;

		this.pilotBuoy = this.pilotBuoyArray[0];
		this.pilotBuoy.position = this.academy.position.add([-20000,0,0]);
		this.pilotBuoy.AIState = &quot;LIGHTS_OFF&quot;;
		}
	}

this.showCourses = function()
	{ 
	mission.runScreen({title: &quot;Academy Syllabus&quot;, messageKey: &quot;laveAcademy_examOffer&quot;, choicesKey:&quot;laveAcademy_offerChoice&quot;}, this.choseExam); 
	}	
	
this.shipLaunchedFromStation = function()
	{
	if(this.systemCheck(system.ID, galaxyNumber) &amp;&amp; this.deactivateWIS)
		{
		if(worldScripts[&quot;Welcome Information Script&quot;]) 
		// if Welcome Mat is loaded &amp; running, disable it to stop data messages with the course buoys
			{
			if(worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.isRunning)
				{
				worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.stop();
				if(player.ship.equipmentStatus(&quot;EQ_WELCOME_MAT&quot;) == &quot;EQUIPMENT_OK&quot;)
					{ player.consoleMessage(&quot;Planetary Information System deactivated for exam.&quot;,6); }
				}
			}
		this.deactivateWIS = false;
		}
	}

this.shipWillLaunchFromStation = function(station)
	{
	this.setUpSystem()
	if(station.hasRole(&quot;laveAcademy_academy&quot;))
		{
		missionVariables.trumbles = missionVariables.laveAcademy_storeTrumble; 
		// reactivate the trumble mission if it was available before docking.

		switch(missionVariables.laveAcademyExam) // Get the course started by setting the buoys AI states
			{
			case &quot;TARGET&quot;:
				{
				this.targetBuoy.AIState = &quot;LIGHTS_ON&quot;;
				this.dockingBuoy.AIState = &quot;LIGHTS_OFF&quot;;
				this.pilotBuoy.AIState = &quot;LIGHTS_OFF&quot;;
				this.buoyID = this.targetBuoy;
				this.deactivateWIS = true;
				if(this.buoyTimer)
					{ this.buoyTimer.start(); }
				else
					{ this.buoyTimer = new Timer(this, this.checkBuoyDistance, 0, 10); }
				break;
				}
			case &quot;DOCKING&quot;:
				{
				this.targetBuoy.AIState = &quot;LIGHTS_OFF&quot;;
				this.dockingBuoy.AIState = &quot;LIGHTS_ON&quot;;
				this.pilotBuoy.AIState = &quot;LIGHTS_OFF&quot;;
				this.buoyID = this.dockingBuoy;
				this.deactivateWIS = true;
				if(this.buoyTimer)
					{ this.buoyTimer.start(); }
				else
					{ this.buoyTimer = new Timer(this, this.checkBuoyDistance, 0, 10); }
				break;
				}
			case &quot;PILOT&quot;:
				{
				this.targetBuoy.AIState = &quot;LIGHTS_OFF&quot;;
				this.dockingBuoy.AIState = &quot;LIGHTS_OFF&quot;;
				this.pilotBuoy.AIState = &quot;LIGHTS_ON&quot;;
				this.buoyID = this.pilotBuoy;
				this.deactivateWIS = true;
				if(this.buoyTimer)
					{ this.buoyTimer.start(); }
				else
					{ this.buoyTimer = new Timer(this, this.checkBuoyDistance, 0, 2); }
				break;
				}
			default:
				{
				this.targetBuoy.AIState = &quot;LIGHTS_OFF&quot;;
				this.dockingBuoy.AIState = &quot;LIGHTS_OFF&quot;;
				this.pilotBuoy.AIState = &quot;LIGHTS_OFF&quot;;
				this.deactivateWIS = false;
				break;
				}	
			} 
		}
	}

this.shipExitedWitchspace = function()
	{
	if(this.systemCheck(system.ID, galaxyNumber))
		{ this.setUpSystem(); }
	}

this.stopTimers = function()
	{
	if(this.buoyTimer)
		{ this.buoyTimer.stop(); }
	if(this.targetTimer)
		{ this.targetTimer.stop(); }
	if(this.pilotTimer)
		{ this.pilotTimer.stop(); }
	if(this.dockingTimer)
		{ this.dockingTimer.stop(); }
	if(worldScripts[&quot;LaveAcademy_targetBuoy&quot;] &amp;&amp; worldScripts[&quot;LaveAcademy_targetBuoy&quot;].launchCheckTimer)
		{ worldScripts[&quot;LaveAcademy_targetBuoy&quot;].launchCheckTimer.stop(); }
	if(worldScripts[&quot;LaveAcademy_dockingBuoy&quot;] &amp;&amp; worldScripts[&quot;LaveAcademy_dockingBuoy&quot;].launchCheckTimer)
		{ worldScripts[&quot;LaveAcademy_dockingBuoy&quot;].launchCheckTimer.stop(); }
	if(worldScripts[&quot;LaveAcademy_pilotBuoy&quot;] &amp;&amp; worldScripts[&quot;LaveAcademy_pilotBuoy&quot;].pilotCourseTimer)
		{ worldScripts[&quot;LaveAcademy_pilotBuoy&quot;].pilotCourseTimer.stop(); }
	if(worldScripts[&quot;LaveAcademy_pilotBuoy&quot;] &amp;&amp; worldScripts[&quot;LaveAcademy_pilotBuoy&quot;].pilotFinishTimer)
		{ worldScripts[&quot;LaveAcademy_pilotBuoy&quot;].pilotFinishTimer.stop(); }
	}

this.shipWillEnterWitchspace = this.shipDied = function()
	{
	if(this.systemCheck(system.ID, galaxyNumber))
		{
		this.stopTimers();
		this.deactivateWIS = false;
		this.targetBuoy.explode();
		this.dockingBuoy.explode();
		this.pilotBuoy.explode();
		missionVariables.laveAcademyExam = null;
		if(worldScripts[&quot;Welcome Information Script&quot;]) // if Welcome Mat has been disabled earlier, restart it
			{
			if(!worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.isRunning)
				{
				worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.start();
				if(player.ship.equipmentStatus(&quot;EQ_WELCOME_MAT&quot;) == &quot;EQUIPMENT_OK&quot;)
					{ player.consoleMessage(&quot;Planetary Information System restarted.&quot;,6); }
				}
			}
		}
	}

this.shipWillDockWithStation = function(station)
	{
	if(this.systemCheck(system.ID, galaxyNumber))
		{
		this.deactivateWIS = false;
		missionVariables.laveAcademyExam = null;
		this.stopTimers();
		}

	if(station.hasRole(&quot;laveAcademy_academy&quot;)) // stop the trumble mission offering whilst docked at the academy
		{
		missionVariables.laveAcademy_storeTrumble = missionVariables.trumbles;
		missionVariables.trumbles = &quot;&quot;;
		} 
	}

this.checkBuoyDistance = function()
	{
	this.buoyDistance = player.ship.position.distanceTo(this.buoyID.position); // how far the player ship is from the buoy
	if(this.buoyDistance &lt; 1000) // if we&#39;re within 1000m.
		{
		this.buoyTimer.stop();
		this.buoyID.AIState = &quot;START_EXAM&quot;;
		}
	}

this.guiScreenChanged = function()
	{
	if(!player.ship.docked) // for GUI screen changes whilst in flight, which we can ignore
		{ return; }

	if(!player.ship.dockedStation.hasRole(&quot;laveAcademy_academy&quot;)) // if we&#39;re not at Lave Academy
		{ return; }

	// replace marketplace screen with exam offering mission screen
	if(guiScreen == &quot;GUI_SCREEN_MARKET&quot;)
		{ this.showCourses(); }
	}	


this.choseExam = function (examChoice)
	{
	switch(examChoice)
		{
		case &quot;ACADEMY_1_TARGET&quot;:
			{
			mission.runScreen({title:&quot;Gunnery Exam&quot;, messageKey:&quot;laveAcademy_targetInfo&quot;, choicesKey:&quot;laveAcademy_targetYesNo&quot;}, this.examYesNo);
			break;
			}
		case &quot;ACADEMY_2_PILOT&quot;:
			{
			mission.runScreen({title:&quot;Piloting Exam&quot;, messageKey:&quot;laveAcademy_pilotInfo&quot;, choicesKey:&quot;laveAcademy_pilotYesNo&quot;}, this.examYesNo);
			break;
			}
		case &quot;ACADEMY_3_DOCKING&quot;:
			{
			mission.runScreen({title: &quot;Docking Exam&quot;, messageKey:&quot;laveAcademy_dockingInfo&quot;, choicesKey:&quot;laveAcademy_dockingYesNo&quot;}, this.examYesNo);
			break;
			}
		case &quot;ACADEMY_4_RESET&quot;:
			{
			missionVariables.laveAcademyExam = null;
			missionVariables.laveAcademy_bestTargetTimeM = 0;
			missionVariables.laveAcademy_bestTargetTimeS = 0;
			missionVariables.laveAcademy_bestPilotTimeM = 0;
			missionVariables.laveAcademy_bestPilotTimeS = 0;
			missionVariables.laveAcademy_bestDockingScore = 0;
			missionVariables.laveAcademy_bestDockingTimeM = 0;
			missionVariables.laveAcademy_bestDockingTimeS = 0;
			mission.runScreen({title: &quot;Academy Syllabus&quot;, messageKey: &quot;laveAcademy_examOffer&quot;, choicesKey:&quot;laveAcademy_offerChoice&quot;}, this.choseExam);
			break;
			}
		case &quot;ACADEMY_5_DECLINE&quot;:
			{
			missionVariables.laveAcademyExam = null;
			break;
			}
		}
	}
	
this.examYesNo = function(selection)
	{
	switch(selection)
		{
		case &quot;ACADEMY_1_TARGETYES&quot;:
				{
				missionVariables.laveAcademyExam = &quot;TARGET&quot;;
				break;
				}
		case &quot;ACADEMY_2_TARGETNO&quot;:
				{
				mission.runScreen({title: &quot;Academy Syllabus&quot;, messageKey: &quot;laveAcademy_examOffer&quot;, choicesKey:&quot;laveAcademy_offerChoice&quot;}, this.choseExam);
				break;
				}
		case &quot;ACADEMY_1_PILOTYES&quot;:
				{
				missionVariables.laveAcademyExam = &quot;PILOT&quot;;
				break;
				}
		case &quot;ACADEMY_2_PILOTNO&quot;:
				{
				mission.runScreen({title: &quot;Academy Syllabus&quot;, messageKey: &quot;laveAcademy_examOffer&quot;, choicesKey:&quot;laveAcademy_offerChoice&quot;}, this.choseExam);
				break;
				}
		case &quot;ACADEMY_1_DOCKINGYES&quot;:
				{
				missionVariables.laveAcademyExam = &quot;DOCKING&quot;;
				break;
				}
		case &quot;ACADEMY_2_DOCKINGNO&quot;:
				{
				mission.runScreen({title: &quot;Academy Syllabus&quot;, messageKey: &quot;laveAcademy_examOffer&quot;, choicesKey:&quot;laveAcademy_offerChoice&quot;}, this.choseExam);
				break;
				}
			default:
				{
				missionVariables.laveAcademyExam = null;
				break;
				}	
		} 
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/laveAcademy_targetBuoy.js</td>
                    <td><pre>this.name					= &quot;LaveAcademy_targetBuoy&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme.txt.&quot;;
this.description			= &quot;Control of academy target practice buoys in the Lave system&quot;;
this.version				= &quot;1.2&quot;;

this.examStart = function()
	{
	missionVariables.laveAcademy_droneLifetime = 45;

	if(player.score &lt; 16) // if player is ranked harmless or mostly harmless, give another 10 seconds to the drone
		{
		missionVariables.laveAcademy_droneLifetime += 10;
		}

	if(player.ship.equipmentStatus(&quot;EQ_FUEL_INJECTION&quot;) != &quot;EQUIPMENT_OK&quot;) // if player doesn&#39;t have fuel injectors, add 15 more seconds
		{
		missionVariables.laveAcademy_droneLifetime += 15;
		}

	if(player.ship.weaponRange == 12500) // if player has only a short range laser, add 10 more seconds
		{
		missionVariables.laveAcademy_droneLifetime += 10;
		}

	this.examStartTime = clock.absoluteSeconds;
	this.buoyPosition = this.ship.position;
	missionVariables.laveAcademy_droneCount = 0;
	missionVariables.laveAcademy_droneAbort = null;
	player.consoleMessage(&quot;Target Practice Course Started!&quot;, 6);
	player.consoleMessage(&quot;Drone liftime set to &quot; + missionVariables.laveAcademy_droneLifetime + &quot;s.&quot;, 6);
	if(this.launchCheckTimer)
		{
		this.launchCheckTimer.start();
		}
	else
		{
		this.launchCheckTimer = new Timer(this, this.droneCheck, 0, 1);
		}
	}

this.droneCheck = function()
	{
	if(player.ship.docked) // if the player is docked (at the Academy) then stop the test quietly
		{
		this.launchCheckTimer.stop();
		missionVariables.laveAcademy_droneAbort = true;
		this.ship.AIState = &quot;LIGHTS_OFF&quot;;
		missionVariables.laveAcademyExam = null;
		return;
		}

 	function isPlayer(entity) {return entity.isShip &amp;&amp; entity.isPlayer}; 
	this.playerInRange = system.filteredEntities(this, isPlayer, this.ship, 25600).length;
	if(this.playerInRange == 0)
		{
		missionVariables.laveAcademy_droneAbort = true;
		missionVariables.laveAcademy_droneCount -= 1;
		this.cancelExam();
		}

	if(missionVariables.laveAcademy_droneAbort)
		{
		this.launchCheckTimer.stop();
		return;
		}

	function isTargetDrone(entity) {return entity.isShip &amp;&amp; entity.hasRole(&quot;laveAcademy_targetDrone&quot;)};
	if(system.filteredEntities(this, isTargetDrone, this.ship, 25600).length == 0)
		{
		if(missionVariables.laveAcademy_droneCount == 15)
			{
			this.endExam();
			}
		else
			{
			missionVariables.laveAcademy_droneCount += 1;
			switch(true)
				{
				case (missionVariables.laveAcademy_droneCount == 1):
					{
					player.commsMessage(&quot;Level One.&quot;, 6);
					break;
					}
				case (missionVariables.laveAcademy_droneCount == 6):
					{
					player.commsMessage(&quot;Level Two.&quot;, 6);
					break;
					}
				case (missionVariables.laveAcademy_droneCount == 11):
					{
					player.commsMessage(&quot;Level Three.&quot;, 6);
					break;
					}
				}
			this.examLevel = (Math.ceil(missionVariables.laveAcademy_droneCount * 0.2));
			this.droneRole = &quot;laveAcademy_targetDroneL&quot; + this.examLevel;
			system.legacy_addShipsWithinRadius(this.droneRole, 1, &quot;abs&quot;, this.buoyPosition, 12000);
			}
		}
	}

this.endExam = function()
	{
	this.launchCheckTimer.stop();
	if(worldScripts[&quot;Welcome Information Script&quot;]) // if Welcome Mat has been disabled earlier, restart it
		{
		if(!worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.isRunning)
			{
			worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.start();
			if(player.ship.equipmentStatus(&quot;EQ_WELCOME_MAT&quot;) == &quot;EQUIPMENT_OK&quot;)
				{
				player.consoleMessage(&quot;Planetary Information System restarted.&quot;,6);
				}
			}
		}
	this.examStopTime = clock.absoluteSeconds;
	this.examElapsedTime = Math.floor(this.examStopTime - this.examStartTime);
	this.examTimeMinutes = Math.floor(this.examElapsedTime / 60);
	this.examTimeSeconds = this.examElapsedTime - (60 * this.examTimeMinutes);
	missionVariables.laveAcademy_droneAbort = true;
	player.commsMessage(&quot;You completed the test in &quot; + this.examTimeMinutes + &quot;m &quot; + this.examTimeSeconds + &quot;s.&quot;, 10);
	this.ship.AIState = &quot;LIGHTS_OFF&quot;;
	missionVariables.laveAcademyExam = null;
	this.bestTime = (missionVariables.laveAcademy_bestTargetTimeM * 60) + missionVariables.laveAcademy_bestTargetTimeS;

	if(this.bestTime == 0 &amp;&amp; this.examElapsedTime &gt; 0)
		{
		player.commsMessage(&quot;We have registered your new best time.&quot;, 10);
		missionVariables.laveAcademy_bestTargetTimeM = Math.floor(this.examElapsedTime / 60);
		missionVariables.laveAcademy_bestTargetTimeS = this.examElapsedTime - (60 * (Math.floor(this.examElapsedTime / 60)));		
		return;
		}

	if(this.bestTime &gt; this.examElapsedTime)
		{
		player.commsMessage(&quot;Congratulations, you&#39;ve improved your best time!&quot;, 10);
		missionVariables.laveAcademy_bestTargetTimeM = Math.floor(this.examElapsedTime / 60);
		missionVariables.laveAcademy_bestTargetTimeS = this.examElapsedTime - (60 * (Math.floor(this.examElapsedTime / 60)));		
		return;
		}
	}

this.cancelExam = function()
	{
	this.launchCheckTimer.stop();
	this.examStopTime = clock.absoluteSeconds;
	this.examElapsedTime = Math.floor(this.examStopTime - this.examStartTime);
	this.examTimeMinutes = Math.floor(this.examElapsedTime / 60);
	this.examTimeSeconds = this.examElapsedTime - (60 * this.examTimeMinutes);
	missionVariables.laveAcademy_droneAbort = true;
	this.droneArray = system.shipsWithRole(&quot;laveAcademy_targetDrone&quot;)
	if(this.droneArray.length &gt; 0)
		{
		this.droneArray.forEach(
			function(drone)
				{
				drone.remove()
				}
			)
		}
	player.commsMessage(&quot;Gunnery test aborted after &quot; + this.examTimeMinutes + &quot;m &quot; + this.examTimeSeconds + &quot;s.&quot;, 10);
	this.ship.AIState = &quot;LIGHTS_OFF&quot;;
	missionVariables.laveAcademyExam = null;
	if(worldScripts[&quot;Welcome Information Script&quot;]) // if Welcome Mat has been disabled earlier, restart it
		{
		if(!worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.isRunning)
			{
			worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.start();
			if(player.ship.equipmentStatus(&quot;EQ_WELCOME_MAT&quot;) == &quot;EQUIPMENT_OK&quot;)
				{
				player.consoleMessage(&quot;Planetary Information System restarted.&quot;,6);
				}
			}
		}
	}

this.playerWillEnterWitchspace = function()
	{
	if(worldScripts[&quot;Welcome Information Script&quot;] &amp;&amp; !worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.isRunning)
		{
		worldScripts[&quot;Welcome Information Script&quot;].welcomeTimer.start();
		}

	if(this.launchCheckTimer)
		{
		this.launchCheckTimer.stop();
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/laveAcademy_targetDrone.js</td>
                    <td><pre>this.name					= &quot;LaveAcademy_targetDrone&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme.txt.&quot;;
this.description			= &quot;Script for the target drones in the shooting gallery of Lave Academy&quot;;
this.version				= &quot;1.2&quot;;

this.shipSpawned = function()
	{ 
	this.ship.scannerDisplayColor1 = &quot;yellowColor&quot;;
	this.ship.scannerDisplayColor2 = &quot;whiteColor&quot;;
	if(!missionVariables.laveAcademy_droneLifetime)
		{
		log(&quot;Lave Academy&quot;, &quot;***** ALERT - Target drone lifetime mission variable not set! *****&quot;)
		missionVariables.laveAcademy_droneLifetime = 45;
		}
	this.destructTimer = new Timer(this, this.selfDestruct, missionVariables.laveAcademy_droneLifetime);  // set the drone&#39;s lifetime.
	this.targetBuoyArray = system.shipsWithPrimaryRole(&quot;laveAcademy_targetBuoy&quot;);
	this.targetBuoy = this.targetBuoyArray[0];
	}

this.shipDied = function(whom, why)
	{
	if(this.destructTimer &amp;&amp; this.destructTimer.isRunning &amp;&amp; whom &amp;&amp; whom.isPlayer) 
		{
		this.destructTimer.stop();
		player.score -= 1; // as this is an exam, the drones shouldn&#39;t count as kills for rank etc.
		player.commsMessage(&quot;Drone destroyed.&quot;, 5);
		}
	}

this.selfDestruct = function()
	{
	if(!this.ship)
		{
		return;
		}

	if(!missionVariables.laveAcademy_droneAbort &amp;&amp; !player.ship.docked) // if the exam is still going but the player didn&#39;t kill the drone
		{
		player.commsMessage(&quot;Drone missed.&quot;, 5);	
		}
	this.ship.explode();
	}

this.findBuoy = function()
	{
	if(!this.ship)
		{
		return;
		}

	this.buoyDistance = this.ship.position.distanceTo(this.targetBuoy.position); // how far the drone is from the buoy
	if(this.buoyDistance &gt; 24000) // if the drone is going out of scanner range
		{
		this.ship.AIState = &quot;BACK_TO_BUOY&quot;;
		}
	}

this.playerWillEnterWitchspace = function()
	{
	if(this.destructTimer)
		{
		this.destructTimer.stop();
		}
	}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
