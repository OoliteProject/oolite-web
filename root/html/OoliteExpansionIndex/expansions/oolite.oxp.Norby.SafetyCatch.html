<html>
    <head>
        <title>Expansion SafetyCatch</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion SafetyCatch</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">2 Equipment</a></li>
          <li><a href="#ships">1 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">3 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Prevent accidental Q-Bomb and other mine launches when using missiles. In addition when a fast activation key is set to this equipment then surely launch a missile and not a Q-Bomb.</td>
                    <td>Prevent accidental Q-Bomb and other mine launches when using missiles. In addition when a fast activation key is set to this equipment then surely launch a missile and not a Q-Bomb.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Norby.SafetyCatch</td>
                    <td>oolite.oxp.Norby.SafetyCatch</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>SafetyCatch</td>
                    <td>SafetyCatch</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Norby</td>
                    <td>Norby</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.3</td>
                    <td>1.3</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/SafetyCatch">http://wiki.alioth.net/index.php/SafetyCatch</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/2/24/SafetyCatch_1.3.oxz">https://wiki.alioth.net/img_auth.php/2/24/SafetyCatch_1.3.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 3</td>
                    <td>CC BY-NC-SA 3</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873250</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/SafetyCatch'>http://wiki.alioth.net/index.php/SafetyCatch</a></p>
        <h3>SafetyCatch_readme.txt</h3>
        <pre>Safety Catch OXP


If you ever dropped a Q-Bomb accidentally when wanted to launch a missile then this equipment is for you.

All mine will be replaced by a &quot;mine in safety&quot; rectangle on your HUD if this catch is in safe state.

Prime &quot;Mine Safety Catch&quot; equipment by Shift+N then press mode (b) key to arm your mines. Press again for safety.

The activate (n) key launch the first available missile and surely not a bomb. This allow to set a fast activation key (named to Item shoprtcut 1 and 2 in keyboard settings screen) to this equipment and fire a missile to your target without risking a bomb drop regardless of the catch is not in safe position.

Safety Catch defend Q-Bombs only by default. If you use custom mines from OXPs then you can enable the handling of these in safetycatch.js by setting the SafetyCatchQMineOnly variable to false, but this part of the code is caused problems to a player (awarded more mine than bought before) what I can not fix due to I can not reproduce, so be wise with it and report if you get it also.

 Cost: 20.0 Cr
 Techlevel: 1


Dependencies:
Oolite v1.77 or later.

Instructions:
Unzip the file, and then move the folder named &quot;.oxp&quot; into the AddOns directory of your Oolite installation.

License:
This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike License version 4.0.
If you are re-using any piece of this OXP, please let me know by sending an e-mail to norbylite@gmail.com.

Changelog:
 2015.05.15. v1.3  Activate key launch a missile.
                   The arm-disarm mines feature transferred to the mode key.
 2014.01.04. v1.2  Fixed problems reported by ffutures.
 2013.12.27. v1.1  Cost raised to 20cr.
 2013.12.26. v1.0  Initial release.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SAFETYCATCH.html">Mine Safety Catch</a></td>
                    <td>yes</td>
                    <td align="right">200</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SAFETY_MINE.html">Safety Mine</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">100+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/safetymine.html">Safety Mine</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/safetycatch.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;safetycatch&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;
this.description = &quot;Use to prevent unwanted launch of your mines.&quot;;

//customizable properties
this.$SafetyCatchQMineOnly = true; //turn off if you use custom mines also, but test it carefully
//due to ffutures reported the following bug using the custom-mines code:
//&quot;it gave me two mines although there was only one loaded - the next time TWO appeared after I fired.&quot;

//internal properties, should not touch
this.$SafetyCatchIsSafe = true; //true if catch currently prevent launching mines
this.$SafetyCatchMines = []; //array of guarded mines to award these back when catch turned off

//world script events
this.startUp = function() {
	this.$SafetyCatchIsSafe = false; //true if catch currently prevent launching mines
	var m = player.ship.missiles;
	var i=-1;
	while(m[++i]) {
		if( m[i].equipmentKey == &quot;EQ_SAFETY_MINE&quot; ) {
			this.$SafetyCatchIsSafe = true; //true if catch currently prevent launching mines
		}
	}

	var mv = missionVariables.$SafetyCatchMines;
	if( !mv ) this.$SafetyCatchMines = []; //array of guarded mines to award these back when catch turned off
	else if( (mv+&quot;&quot;).indexOf(&quot;,&quot;) ) this.$SafetyCatchMines = (mv+&quot;&quot;).split(&quot;,&quot;); //need +&quot;&quot; for bugfix
	else this.$SafetyCatchMines = [mv];
}

this.equipmentDamaged = this.equipmentDestroyed = function(equipment) {
	if( equipment == &quot;EQ_SAFETYCATCH&quot; ) this.$SafetyCatchOff();
}

this.equipmentRepaired = function(equipment) {
	if( equipment == &quot;EQ_SAFETYCATCH&quot; ) this.$SafetyCatchOn();
}

this.playerBoughtEquipment = function(equipmentKey) {
	if( equipmentKey == &quot;EQ_SAFETYCATCH&quot; ) {
		this.$SafetyCatchOn();
//		player.ship.setEquipmentStatus(&quot;EQ_SAFETYCATCH&quot;, &quot;EQUIPMENT_DAMAGED&quot;);//test of repair cost
	}
 	if( ( equipmentKey == &quot;EQ_QC_MINE&quot; &amp;&amp; this.$SafetyCatchQMineOnly || !this.$SafetyCatchQMineOnly &amp;&amp;
		equipmentKey != &quot;EQ_SAFETY_MINE&quot; &amp;&amp; equipmentKey.substr(-5,5) == &quot;_MINE&quot; )
		&amp;&amp; player.ship.equipmentStatus(&quot;EQ_SAFETYCATCH&quot;) == &quot;EQUIPMENT_OK&quot; ) {
		this.$SafetyCatchMines.push( equipmentKey );
		player.ship.removeEquipment( equipmentKey );
		player.ship.awardEquipment( &quot;EQ_SAFETY_MINE&quot; );
		player.consoleMessage(&quot;Your new mine is in safe state.&quot;);
	}
}

this.playerWillSaveGame = function(message) {
	missionVariables.$SafetyCatchMines = this.$SafetyCatchMines;
}

//SafetyCatch methods
this.$SafetyCatchOn = function() { //replace mines with safety mines
	if( player.ship.equipmentStatus(&quot;EQ_SAFETYCATCH&quot;) != &quot;EQUIPMENT_OK&quot; ) return; //damaged or not installed
	
	var w = worldScripts[&quot;safetycatch&quot;];
	var k = &quot;&quot;;
	var m = player.ship.missiles;
	var oldlength = w.$SafetyCatchMines.length;
	var i=-1;
	while(m[++i]) {
		k = m[i].equipmentKey;
		if( w.$SafetyCatchQMineOnly &amp;&amp; k == &quot;EQ_QC_MINE&quot; || !w.$SafetyCatchQMineOnly &amp;&amp;
			k != &quot;EQ_SAFETY_MINE&quot; &amp;&amp; k.substr(-5,5) == &quot;_MINE&quot; ) {
			w.$SafetyCatchMines.push( k );
			player.ship.removeEquipment( k );
			if( w.$SafetyCatchQMineOnly )
				player.ship.awardEquipment( &quot;EQ_SAFETY_MINE&quot; );
		}
//		log(&quot;safetycatch&quot;, k+&quot; &quot;+k.substr(-5,5)+&quot; &quot;+w.$SafetyCatchMines);
	}
	var newlength = w.$SafetyCatchMines.length;
	if( !w.$SafetyCatchQMineOnly )
		for( var i = oldlength; i &lt; newlength; i++ )
			player.ship.awardEquipment( &quot;EQ_SAFETY_MINE&quot; );
	w.$SafetyCatchIsSafe = true;
	player.consoleMessage(&quot;Mines in safe state.&quot;);
}

this.$SafetyCatchOff = function() {  //replace safety mines with saved mines
	var w = worldScripts[&quot;safetycatch&quot;];
	if( w.$SafetyCatchQMineOnly ) {
		var m = player.ship.missiles;
		var s = 0;
		for( var i = 0; i &lt; m.length; i++ )
			if( m[i].equipmentKey == &quot;EQ_SAFETY_MINE&quot; ) s++;
		for( var i = 0; i &lt; s; i++ ) {
			player.ship.removeEquipment( &quot;EQ_SAFETY_MINE&quot; );
			player.ship.awardEquipment( &quot;EQ_QC_MINE&quot; );
		}
	} else {
		var m = w.$SafetyCatchMines;
		for( var i = 0; i &lt; m.length; i++ ) {
			player.ship.removeEquipment( &quot;EQ_SAFETY_MINE&quot; );
			player.ship.awardEquipment( m[i] );
		}
	}
	delete w.$SafetyCatchMines;
	w.$SafetyCatchMines = [];
	w.$SafetyCatchIsSafe = false;
	player.consoleMessage(&quot;Mines ARMED!&quot;);
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/safetycatcheq.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;safetycatcheq&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;
this.description = &quot;Use to prevent unwanted launch of your mines.&quot;;

//equipment events
this.activated = function() {
	if( !player.ship.missilesOnline ) {
		player.consoleMessage(&quot;Arm your missiles first.&quot;);
		return;
	}
	var w = worldScripts[&quot;safetycatch&quot;];
	var back = false;
	if( !w.$SafetyCatchIsSafe ) {
		w.$SafetyCatchOn();
		back = true;
	}
	player.ship.fireMissile();
	if(back) w.$SafetyCatchOff();
}

this.mode = function() {
	var w = worldScripts[&quot;safetycatch&quot;];
	if( w.$SafetyCatchIsSafe ) w.$SafetyCatchOff();
	else w.$SafetyCatchOn();
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/safetymine.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;safetymine&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2013 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Use to prevent unwanted launch of your mines.&quot;;
this.version     = &quot;1.2&quot;;


this.shipSpawned = function() {
	player.ship.awardEquipment(&quot;EQ_SAFETY_MINE&quot;);
	player.consoleMessage(&quot;Arm your mine with Mine Safety Catch.&quot;, 5);
	this.ship.remove(true);
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
