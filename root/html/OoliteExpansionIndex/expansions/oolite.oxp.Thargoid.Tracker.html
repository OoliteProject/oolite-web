<html>
    <head>
        <title>Expansion Tracker</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Tracker</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">1 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">4 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER E)(&#39;[]&#39; vs &#39;[equipment]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>An advanced space compass add-on which allows the system-wide tracking of up to five entities.</td>
                    <td>An advanced space compass add-on which allows the system-wide tracking of up to five entities.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.Tracker</td>
                    <td>oolite.oxp.Thargoid.Tracker</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Tracker</td>
                    <td>Tracker</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.05</td>
                    <td>1.05</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>equipment</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Tracker_OXP">http://wiki.alioth.net/index.php/Tracker_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/8/8c/Tracker-1.05.oxz">https://wiki.alioth.net/img_auth.php/8/8c/Tracker-1.05.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 3.0</td>
                    <td>CC BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873357</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Tracker'>http://wiki.alioth.net/index.php/Tracker</a></p>
        <h3>Readme.txt</h3>
        <pre>Tracker OXP
-----------
v1.05, by Thargoid.

The Ships Systems Department of the Aquarian Shipbuilding Corporation would like to present to you their latest product, the Tracker. An invaluable add-on to the advanced space compass (ASC - which must also be fitted to the ship), it allows the simultaneous tracking of up to five distinct targets anywhere within the current system (or area of interstellar space).

Once purchased, it is selected by using the &quot;shift-n&quot; key, and then activated with the &quot;n&quot; key (under standard keyboard configuration). This will transfer the current target lock (be it an ident-lock or a missile-lock) to the system. It can then be viewed on the ASC by cycling through to the &quot;T&quot; indicator. Note that a target lock is required before the system can track the entity, so cloaked ships and certain other entities cannot be tracked.

The system has capacity to store five lock-ons. To remove an existing lock-on, just repeat the above procedure. If the target docks, lands on a planet/moon, enters witchspace or is destroyed then the lock is also lost.

Available from tech level 9 systems for 2500 credits to Commanders who already have an ASC fitted to their ship.

Requires v1.75 or later of Oolite. It will not run on older versions.


License
-------

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 (https://creativecommons.org/licenses/by-nc-sa/3.0/)


Version history
---------------

15/03/2012 - Version 1.00
* Initial release.

16/03/2012 - Version 1.01
* Improved model (no dimensions or textures at all) thanks to Ramirez.

16/09/2012 - Version 1.02
* Revised model to with actual but minimal poly-count to stop issues.

01/08/2020 - Version 1.03
* Added collision exception to the tracker and tracked; set tracker&#39;s beacon label with tracked name; 
* Don&#39;t track telescope markers.

10/08/2020 - Version 1.04
* Disabed tracker beacons while player&#39;s ship is docked (so the tracked ships don&#39;t show on Station Interfaces (F4) In-system Distances; 
* Logging of tracker&#39;s destruction or invalidation; 
* Console messages when trying to track/untrack a target out of range, or without a target.

03/11/2020 - Version 1.05
* Changed messages from console to comms.
* Updated license to remove the &quot;Thargoid clauses&quot; after Thargoid allowed modification when retired from maintaining his OXps (http://aegidian.org/bb/viewtopic.php?f=4&amp;t=17085).
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TRACKER.html">Tracker</a></td>
                    <td>yes</td>
                    <td align="right">25000</td>
                    <td align="center">9+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/tracker_beacon.html">Tracker</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>this.name           = &quot;tracker_worldScript.js&quot;;
this.author         = &quot;Thargoid&quot;;
this.copyright      = &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description    = &quot;World script for the tracker OXP&quot;;
this.version        = &quot;1.00&quot;;
&quot;use strict&quot;;


this.compassTargetChanged = function(whom, mode) {
    if (player.ship.equipmentStatus(&quot;EQ_TRACKER&quot;) !== &quot;EQUIPMENT_OK&quot; || 
        player.ship.equipmentStatus(&quot;EQ_ADVANCED_COMPASS&quot;) !== &quot;EQUIPMENT_OK&quot;) 
        return; 
    
    if (mode &amp;&amp; mode === &quot;COMPASS_MODE_BEACONS&quot; &amp;&amp; whom &amp;&amp; whom.name === &quot;Tracker&quot;)
        if(whom.target) { 
            player.consoleMessage(&quot;Tracked entity - &quot; + whom.target.displayName, 5); 
        }
}
    
this.equipmentDamaged = function(equipment) {
    var _taggedShips, i;
    if (equipment === &quot;EQ_TRACKER&quot; || 
       (equipment === &quot;EQ_ADVANCED_COMPASS&quot; &amp;&amp; player.ship.equipmentStatus(&quot;EQ_TRACKER&quot;) === &quot;EQUIPMENT_OK&quot;)) {
        _taggedShips = system.shipsWithRole(&quot;tracker_beacon&quot;);
        i = _taggedShips.length;
        while (i--)
            _taggedShips[i].remove();
    }
}    
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/tracker.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;Tracker&quot;;
this.author      = &quot;Dybal&quot;;
this.copyright   = &quot;2020 Dybal&quot;;
this.license     = &quot;CC BY-NC-SA 4.0&quot;;
this.description = &quot;Tracker worldscripts&quot;;
this.version     = &quot;1.05&quot;;

//-----------------------------------------------------------------------------//
this.shipWillDockWithStation = function _shipWillDockWithStation() {
    var tracker_list = system.shipsWithPrimaryRole(&quot;tracker_beacon&quot;);
    var t;
    var i = tracker_list.length;
    
    while (i--) {
        t = tracker_list[i];
        if (t &amp;&amp; t.isValid &amp;&amp; t.script &amp;&amp; t.script.$tracked) {
            t.beaconCode = null;
        }
    }
}

//-----------------------------------------------------------------------------//
this.shipLaunchedFromStation = function _shipLaunchedFromStation() {
    var tracker_list = system.shipsWithPrimaryRole(&quot;tracker_beacon&quot;);
    var t;
    var i = tracker_list.length;
    
    while (i--) {
        t = tracker_list[i];
        if (t &amp;&amp; t.isValid &amp;&amp; t.script &amp;&amp; t.script.$tracked) {
            t.beaconCode = &quot;Tracker:&quot;+t.script.$trackedName;
        }
    }
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/tracker_beacon.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;tracker_beacon.js&quot;;
this.author      = &quot;Thargoid&quot;;
this.copyright   = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Beacon script.&quot;;
this.version     = &quot;1.04&quot;;

this.$tracked;
this.$trackedName;


//
// Event Handlers
//

//--------------------------------------------------------------------------------------------//
this.shipSpawned = function _shipSpawned() { 
    if (!this.ship || !this.ship.isValid || !this.ship.target) {
        log(this.name, &quot;Incomplete tracker beacon:&quot;+this.ship+(this.ship ? &quot;, &quot;+this.ship.isValid+&quot;, &quot;+this.ship.target : &quot;&quot;));
        return;
    }
    log(this.name, &quot;Tracker for &quot;+this.ship.target.displayName+&quot; spawned, adding collision exception and setting up beacon label&quot;);
    this.ship.addCollisionException(this.ship.target);
    this.$tracked = this.ship.target;
    this.$trackedName= this.ship.target.displayName;
    this.ship.beaconCode = &quot;Tracker: &quot;+this.$trackedName;
    this.ship.beaconLabel = &quot;Tracker: &quot;+this.$trackedName;
    this.callbackID = addFrameCallback(this.repositionTracker.bind(this)); 
}

//--------------------------------------------------------------------------------------------//
this.shipWillEnterWitchspace = function _shipWillEnterWitchspace() {
    log(this.name, &quot;Tracker for &quot; + this.$trackedName + &quot; entering wormhole&quot;);
}

//--------------------------------------------------------------------------------------------//
this.shipDied = function _shipDied(whom, why) { 
    if (why &amp;&amp; why === &quot;scrape damage&quot; &amp;&amp; whom &amp;&amp; this.ship &amp;&amp; this.$tracked &amp;&amp; whom === this.$tracked) {
        // in cases where the tag does manage to collide with the tracked entity, respawn the tag.
        var Tag = this.ship.spawnOne(&quot;tracker_beacon&quot;);
        Tag.target = this.$tracked;
        log(this.name, &quot;Tracker for &quot;+this.$trackedName+&quot; collided with ship and was destroyed, creating a new one&quot;);
    } else {
        log(this.name, &quot;Tracker for &quot;+this.$trackedName+&quot; was destroyed by &#39;&quot;+whom+&quot;&#39; with &#39;&quot;+why+&quot;&#39;&quot;);
    }
}


//
// Internal Functions
//

//--------------------------------------------------------------------------------------------//
this.repositionTracker = function _repositionTracker() {
    if (!this.ship || !this.ship.isValid || !this.$tracked || !this.$tracked.isValid) {
        // something has gone wrong
        if (this.ship &amp;&amp; this.ship.isValid)
            // tracker is OK, but the tracked ship is not
            log(this.name, this.$trackedName+&quot; is no more, removing tracker (tracker target:&quot;+this.ship.target+&quot;)&quot;);
        else if (this.ship)
            // tracker exists but is not valid anymore
            log(this.name, &quot;Tracker for &quot;+this.$trackedName+&quot; is not valid anymore, removing&quot;);
        else
            // tracker does not exist anymore but this FCB is still being called
            log(this.name, &quot;Tracker undefined:&quot;+this.ship+&quot;, tracked:&quot;+this.$trackedName);
        if (this.callbackID) {
            removeFrameCallback(this.callbackID);
            delete this.callbackID;
        }
        this.ship.remove();
        return;
    }
        
    this.ship.position = this.$tracked.position
}

    
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/tracker_trigger.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;tracker_trigger.js&quot;;
this.author      = &quot;Thargoid&quot;;
this.copyright   = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Script for setting up the tracker&quot;;
this.version     = &quot;1.05&quot;;

//-----------------------------------------------------------------------------//
this.activated = function() {
    var _ship = player.ship;

    if (!_ship) return
    if  (!_ship.target) {
        player.commsMessage(&quot;No target to track.&quot;, 8)
        return;
    }   
    if (_ship.target.dataKey === &quot;telescopemarker&quot;) {
        player.commsMessage(&quot;Target beyond range to attach/recall tracker.&quot;, 8)
        return;
    }
    var _target = _ship.target;
    var _tagArray = system.shipsWithPrimaryRole(&quot;tracker_beacon&quot;, _target, _target.collisionRadius) 
    // check if the target is already tagged - if so then activation is to remove it
    if (_tagArray.length &gt; 0) {
        log(this.name,&quot;Removing tracker from &quot;+_tagArray[0].target);
        _tagArray[0].remove();
        player.commsMessage(&quot;Tracker called back from &quot;+_target.displayName+&quot;.&quot;, 8);
        return;
    }
    
    if (system.countShipsWithPrimaryRole(&quot;tracker_beacon&quot;) &gt; 4) {// if there are already 5 active tags in the system
        player.commsMessage(&quot;No trackers available.&quot;, 8);
        log(this.name, &quot;Already tracking 5 ships:&quot;+system.shipsWithPrimaryRole(&quot;tracker_beacon&quot;));
        return;
    }
    
    // if we get this far, we&#39;re setting up tracking on the target
    var Tag = _target.spawnOne(&quot;tracker_beacon&quot;);
    if (!Tag)
        log(this.name, &quot;Couldn&#39;t spawn tracker beacon for &quot;+_target.displayName);
    else {
        Tag.target = _target;
        log(this.name, &quot;Created tracker for &quot;+_target.displayName+&quot;:&quot;+Tag);
        player.commsMessage(&quot;Tracker attached to &quot;+_target.displayName+&quot;.&quot;, 8);
    }
}

</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
