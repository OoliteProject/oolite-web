<html>
    <head>
        <title>Expansion Galactic Registry</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Galactic Registry</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>http://wiki.alioth.net/index.php/Galactic%20Registry -&gt; 404 Not Found</li>
                <li>Low hanging fuit: Information URL exists...</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Shows system information for the current galactic sector.</td>
                    <td>Shows system information for the current galactic sector.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.phkb.GalacticRegistry</td>
                    <td>oolite.oxp.phkb.GalacticRegistry</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Galactic Registry</td>
                    <td>Galactic Registry</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Ambience</td>
                    <td>Ambience</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>phkb</td>
                    <td>phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>5.3</td>
                    <td>5.3</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/GalCop_Galactic_Registry">http://wiki.alioth.net/index.php/GalCop_Galactic_Registry</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/d/d3/GalCopGalacticRegistry.oxz">https://wiki.alioth.net/img_auth.php/d/d3/GalCopGalacticRegistry.oxz</a></td>
                    <td><a target="_blank" href="http://wiki.alioth.net/img_auth.php/d/d3/GalCopGalacticRegistry.oxz">http://wiki.alioth.net/img_auth.php/d/d3/GalCopGalacticRegistry.oxz</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1691383493</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        
        <h3>readme.txt</h3>
        <pre>GalCop Galactic Registry
By Nick Rogers

With thanks to Okti for his code for the Gal Navy locations.

Overview
========
This OXP aims to provide pilots with data relating to their current sector, and provide tools pilots can use to better understand the galaxy they work in. This expansion adds a new interface screen, the &quot;GalCop galactic registry&quot;, which had the following sub-options:

1. Regions: Each sector has a number of galactic regions, and this menu allows pilots to see all named regions and display their location.
2. Spacelanes: There are a number of spacelanes in each section, largely related to trade routes. This menu will list each of the different spacelanes defined in the current galactic sector, and allow you to display each route on the galactic chart.
3. TechLevel: This menu allows pilots to highlight all systems of a particular techlevel, and (if the Advanced Navigational Array is installed) to automatically plot a course to the closest one.
4. Government Types: This menu allows pilots to highlight all systems of government type, and (if the Advanced Navigational Array is installed) to automatically plot a course to the closest one.
5. Economy: This menu allows pilots to highlight all systems of a particular economy, and (if the Advanced Navigational Array is installed) to automatically plot a course to the closest one.
6. Galactic Navy Sector Commands: If you have the GalNavy OXP installed, this option will become available. This will highlight each system that is home to a GalNavy sector command, and (if the Advanced Navigational Array is installed) allow you to automatically plot a course to the closest one.
7. GalCop Sector HQ: This menu allows pilots to highlight the GalCop Sector HQ system in the sector.
8. Full system list: This function will list all systems in the sector. The list can be sorted by name, tech level, government type or economy type. Additionally, two systems can be selected from the list, and then the details of these two systems can be displayed along with a galactic map showing the route between them. 
9. Search registry: This function will take any text input and search all planetary descriptions for that criteria.

For any of the defined sections you have the option of keeping the information displayed on all system maps. When the section is selected, choose the &quot;Set as permanent display&quot; option to turn this on, and &quot;Unset permanent display&quot; to turn it off.

Notes about the &#39;Search Registry&#39; function
------------------------------------------
The Search registry function will take all entered criteria and find any system where all the criteria are matched to at least one property.

The following properties will be searched:
- Planetary description
- Inhabitants description
- Government description
- Economy description
- Techlevel

Some examples of search criteria:
&quot;feline anarchy&quot;
    Will find any Anarchy system with feline inhabitants. In Galaxy 1, there are two systems that will be found for this search: Erbiti and Orrira.
&quot;tl6 tedious&quot;
    Will find any TL6 system with &#39;tedious&#39; in the planetary description. In Galaxy 1, there is only one system that will be found for this search: Aleusqu.
&quot;frog agri tl7&quot;
    Will find any agricultural-type (poor, mainly, average or rich) TL7 system, inhabited by frogs. In Galaxy 1, there are three systems that will be found for this search: Isinor, Rebia, and Teanrebi.
&quot;human poet|wolf tl8+|industrial&quot;
    Will find any system inhabited by humans or humanoids, AND where either &quot;poet&quot; OR &quot;wolf&quot; is mentioned in the description, AND has either a TL greater than or equal to 8 OR is an industrial-type economy.
    
Installation
============
After installing the OXP no additional set up is required. The &quot;GalCop galactic registry&quot; will be available whenever you dock.

3rd Party interface
===================
It&#39;s possible for other OXP&#39;s to add their own planet lists to the registry. The following is an example of the interface code:

	var data = {
		name: &quot;My systems&quot;,
		markerColor:&quot;whiteColor&quot;, 
		markerShape:&quot;MARKER_DIAMOND&quot;,
		listType: &quot;unconnected&quot;,
		systems:[
            {name:&quot;System list 1&quot;, markerColor:&quot;redColor&quot;, markerShape:&quot;MARKER_X&quot;, systemIDList:[1,2,3,4,5]},
            {name:&quot;System list 2&quot;, systemIDList:[6,7,8,9,10]},
            {name:&quot;System list 3&quot;, systemIDList:[11,12,13,14,15]}
        ]
	};
    worldScripts.GalacticRegistry.$addCustomSystemList(data);

In new main menu item will be displayed, called &quot;My systems&quot;. When you select that item, there will be 3 subsections inside, &quot;System list 1&quot;, &quot;System list 2&quot;, and &quot;System list 3&quot;. &quot;System list 1&quot; has overriden the default markerColor and markerShape settings.

Full data definition:
    name:               The text to appear on the main menu.
    markerColor:        The color specifier to use when marking planets on the map. 
                        If not specified, will default to &quot;whiteColor&quot;.
    markerShape:        The shape to use for the planet markers. Must be one of MARKER_X, MARKER_PLUS, MARKER_SQUARE, MARKER_DIAMOND.
                        If not specified, will default to &quot;MARKER_DIAMOND&quot;.
    startMarkerShape:   The marker shape to use at the start of the path (path list type only) (defaults to &quot;MARKER_SQUARE&quot;)
    endMarkerShape:     The marker shape to use at the end of the path (path list type only) (defaults to &quot;MARKER_DIAMOND&quot;)
    listType:           Can be one of the following:
                        unconnected: all systems in the list are unconnected, and will be marked individually on the map. 
                            This is the default setting when &quot;listType&quot; is not specified.
                        region: all systems in the list are connected, and all possible connections between them will be highlighted on the map.
                            The systems themselves will not have markers.
                        path: each system in the list represents one point on a defined path, and only the links between consecutive items will be highlighted on the map.
                            The first and last system in the list will have map markers.
    linkColor:          The color specifier to use when highlighting links on the map. 
                        If not specified, this will default to &quot;greenColor&quot;.
    systems:            An array of dictionary items to be shown. The ID&#39;s must be in the current galaxy.
                        The dictionary format is:
						name:				The name of this list of systems that will appear on the menu and on the title when selected
						markerColor: 		The color to use for any markers in this list (unconnected list type only) (overrides the parent markerColor)
						markerShape: 		The shape to use for any markers in this list (unconnected list type only) (overrides the parent markerShape)
	  					startMarkerShape: 	The shape to use at the start of a path (for path list types only) (overrides the parent startMarkerShape)
	  					endMarkerShape: 	The shape to use at the end of a path (for path list types only) (overrides the parent endMarkerShape)
						linkColor:			The color specified to be used for all links on the map (path and region list types only) (overrides the parent linkColor)
						systemIDList: 		an array of system ID&#39;s that define this list

Note: The list of custom items will be reset whenever the player enters a new galaxy. OXP&#39;s will need to re-add their data after a galactic jump. The best time to do this is during the &quot;shipDockedWithStation&quot; world event.

Adding an entry with the same name as an existing item will overwrite existing data with the new data.

License
=======
This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/3.0/

Galaxy image from http://simpleicon.com/solar_system.html

Discussion
==========
This OXP is discussed at this forum link: http://aegidian.org/bb/viewtopic.php?f=4&amp;t=17893

Version History
===============
5.3
- Made compatible with &quot;SW Economy&quot;.

5.2
- Fixed some potential referencing errors on mission screens.

5.1
- Spacelane system lists are no longer sorted, so the planet list will be in path order.

5.0
- Re-engineered the internal structures so that all base criteria are now using the same data structures as the custom lists. Custom lists can now have multiple subsets defined within them.
- Custom lists now have the ability to be made a permanent display on the chart.
- Unconnected lists (that is, a series of unconnected planets) can now be made a permanent display on the chart.
- The &#39;Search registry&#39; function can now do +/- searches on techlevel.
- The &#39;Search registry&#39; function can now do an &quot;OR&quot; search, using the &quot;|&quot; bar separator. This allows for more complex search queries like &quot;human poet|wolf tl8+|industrial&quot;, which translates to &quot;find any system inhabited by humans or humanoids, AND where &quot;poet&quot; OR &quot;wolf&quot; is mentioned in the description, AND has either a TL greater than or equal to 8 OR an industrial-type economy&quot;

4.4
- The &#39;Search registry&#39; function will now also search government description, economy description, inhabitants description and techlevel. 
- Added a &quot;New search&quot; menu to the Search registry results screen.

4.3
- Bug fixes.

4.2
- Added ability for spacelanes and regions to be shown permanently on any chart.
- Fixed issue where showing the system list of a region would keep the system map visible.
- Moved some menu item text into descriptions.plist.
- Code refactoring and cleanup.

4.1
- Player&#39;s current route was always showing the shortest route on the map, even if the quickest route had been selected on the F6 screen.

4.0
- Made compatible with OXP&#39;s that change the system.concealment property.
- Added interface to allow 3rd party OXP&#39;s to add their own planet lists, regions and paths.

3.3
- When setting a course to a target system, F7 screen will now display the new destination.

3.2
- Added GalCop HQ system to the menu (used by Bounty System OXP, and Email System OXP).
- Added a &quot;search&quot; facility where planetary descriptions can be searched for entered criteria.
- Code refactoring.

3.1
- Removed debug log entries.

3.0
- Added a &quot;Full system list&quot;, which lists all system names, and allows sorting by name, tech level, government or economy type. Also has ability to select two systems and show route between the two, as well as other system details.
- Removed redundant header from all system lists.

2.0
- Added ability to view a list of planet names for any given sub-section of the chart.
- Added markers to the start and end of spacelanes.

1.6
- Fixed issue with HUD not becoming visible again after use.

1.5
- Changed &quot;==&quot; comparisons to &quot;===&quot; for performance improvements.
- Fixed issue with the paging for TechLevels.

1.4 
- Updated check for &quot;Allow Big GUI&quot;.
- Fixed issue where the interface screen wasn&#39;t being added when docking at a new station.

1.3
- Improved menu unsability by auto selecting the next item in the menu.
- Updated screenID&#39;s to enable BGS background sounds.
- Renamed background overlay image to prevent possibility of future duplication.
- Toned down overlay image.
- Code refactoring.

1.2
- Removed unnecessary link to &quot;Display Current Course&quot;.
- Fixed issue where current course was always showing with the shortest plot.

1.1
- Small tweaks to menu text.
- Smugglers chart markers now removed from various Galactic Registry screens to make the image clearer.

1.0
- Initial release</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ANA_TOOL.html">Advanced Navigational Array Tool</a></td>
                    <td>no</td>
                    <td align="right">100</td>
                    <td align="center">1+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/galactic_registry.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;GalacticRegistry&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2017 phkb&quot;;
this.description = &quot;Shows various details about the current galactic sector.&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;

this._disabled = false;
this._regionColor = &quot;greenColor&quot;;
this._techLevelColor = &quot;greenColor&quot;;
this._governmentColor = [&quot;0.5 0.0 0.7&quot;,	&quot;0.7 0.5 0.3&quot;, &quot;0.0 1.0 0.3&quot;, &quot;1.0 0.8 0.1&quot;, &quot;1.0 0.0 0.0&quot;, &quot;0.1 0.5 1.0&quot;, &quot;0.7 0.7 0.7&quot;, &quot;0.7 1.0 1.0&quot;];
this._economyColor = [&quot;1.0 1.0 0.0&quot;, &quot;0.875 1.0 0.0&quot;, &quot;0.75 1.0 0.0&quot;, &quot;0.625 1.0 0.0&quot;, &quot;0.5 1.0 0.0&quot;, &quot;0.375 1.0 0.0&quot;, &quot;0.25 1.0 0.0&quot;, &quot;0.125 1.0 0.0&quot;];
this._markedRegions = [];
this._markedPlanets = [];
this._permanentRegions = [];
this._permanentLanes = [];
this._explorersClub = false;
this._smugglers = false;
this._menuColor = &quot;orangeColor&quot;;
this._itemColor = &quot;yellowColor&quot;;
this._disabledColor = &quot;darkGrayColor&quot;;
this._altColor = &quot;greenColor&quot;;
this._menu = 0;
this._item = 0;
this._page = 0;
this._removeANATool = false;
this._holdDestination = -1;
this._lastChoice = [];
this._spaceLaneStart = -1;
this._spaceLaneEnd = -1;
this._select1 = -1;
this._select2 = -1;
this._selectLast = 2;
this._sortType = 0;
this._search = &quot;&quot;;
this._searchMax = false;
this._pageLength = 16;
this._custom = [];
this._permanentChartData = {regions:[], paths:[], systems:[]};
this._setItem;

//-------------------------------------------------------------------------------------------------------------
// Interface to add a custom planet list to the registry
// data is dictionary with the following properties:
//    name: 			The text to appear on the menu.
//    markerColor: 		The default color specifier to use when marking planets on the map. Default is &quot;whiteColor&quot;.
//    markerShape: 		The default shape to use for the planet markers. Must be one of MARKER_X, MARKER_PLUS, MARKER_SQUARE, MARKER_DIAMOND.
//	  startMarkerShape: The shape to use at the start of a path (for path list types only)
//	  endMarkerShape: 	The shape to use at the end of a path (for path list types only)
//	  linkColor:		The default color specifier to use for any links defined on the map (path and region list types only)
//    listType:			Can be one of the following: unconnected, path, region
//						unconnected		each system is marked individually, with no connections between them
//						path			each system in the list marks one point of a path, with connections between each
//										only the start and end systems will be marked with this type
//						region			each system is connected to each other system (within 7ly) in the list
//										systems will not be individually marked with this type
//						Note: for &quot;path&quot; and &quot;region&quot;, only connections 7ly or less in length will be marked
//    systems: 			An array of dictionary objects that detail the systems to be shown
//						name:				The name of this list of systems that will appear on the menu and on the title when selected
//						markerColor: 		The color to use for any markers in this list (overrides the parent markerColor)
//						markerShape: 		The shape to use for any markers in this list (overrides the parent markerShape)
//	  					startMarkerShape: 	The shape to use at the start of a path (for path list types only) (overrides the parent startMarkerShape)
//	  					endMarkerShape: 	The shape to use at the end of a path (for path list types only) (overrides the parent endMarkerShape)
//						linkColor:			The color specified to be used for all links on the map (path and region list types only) (overrides the parent linkColor)
//						systemIDList: 		an array of system ID&#39;s that define this list
//
this.$addCustomSystemList = function $addCustomSystemList(data) {
	this.$addSystemList(data);
}

//-------------------------------------------------------------------------------------------------------------
this.$addSystemList = function $addSystemList(data, coreID) {
	var markers = [&quot;MARKER_X&quot;, &quot;MARKER_PLUS&quot;, &quot;MARKER_SQUARE&quot;, &quot;MARKER_DIAMOND&quot;];
	var listTypes = [&quot;unconnected&quot;, &quot;region&quot;, &quot;path&quot;];

	if (data.hasOwnProperty(&quot;name&quot;) === false || data.name === &quot;&quot;) {
		throw &quot;Invalid settings: name must be supplied.&quot;;
	}

	// if the name already exists in the data, remove it so we can re-add it.
	for (var i = this._custom.length - 1; i &gt;= 0; i--) {
		if (this._custom[i].name === data.name) {
			this._custom.splice(i, 1);
			break;
		}
	}

	if (data.hasOwnProperty(&quot;listType&quot;) === false) data.listType = &quot;unconnected&quot;;
	if (listTypes.indexOf(data.listType) === -1) {
		throw &quot;Invalid settings: invalid listType specified. Must be unconnected, region, or path&quot;;
	}

	if (data.hasOwnProperty(&quot;markerColor&quot;) === false) data.markerColor = &quot;whiteColor&quot;;

	if (data.hasOwnProperty(&quot;markerShape&quot;) === false) data.markerShape = &quot;MARKER_DIAMOND&quot;;
	if (markers.indexOf(data.markerShape) === -1) {
		throw &quot;Invalid settings: invalid markerShape specified (&quot; + data.markerShape + &quot;).&quot;;
	}
	if (data.hasOwnProperty(&quot;startMarkerShape&quot;) === true) {
		if (markers.indexOf(data.startMarkerShape) === -1) {
			throw &quot;Invalid settings: invalid startMarkerShape specified (&quot; + data.startMarkerShape + &quot;).&quot;;
		}
	} else {
		if (data.listType === &quot;path&quot;) {
			data.startMarkerShape = &quot;MARKER_SQUARE&quot;;
		}
	}
	if (data.hasOwnProperty(&quot;endMarkerShape&quot;) === true) {
		if (markers.indexOf(data.endMarkerShape) === -1) {
			throw &quot;Invalid settings: invalid endMarkerShape specified (&quot; + data.endMarkerShape + &quot;).&quot;;
		}
	} else {
		if (data.listType === &quot;path&quot;) {
			data.endMarkerShape = &quot;MARKER_DIAMOND&quot;;
		}
	}

	if (data.hasOwnProperty(&quot;systems&quot;) === true) {
		var valid = false;
		if (Array.isArray(data.systems)) valid = true; // we&#39;re ok
		if (typeof data.systems[0] === &quot;object&quot;) {
			if (data.systems[0].hasOwnProperty(&quot;name&quot;) &amp;&amp; data.systems[0].hasOwnProperty(&quot;systemIDList&quot;)) valid = true
			// give each system data element a (mostly) unique id
			for (var i = 0; i &lt; data.systems.length; i++) {
				data.systems[i].id = data.name + &quot;|&quot; + data.systems[i].name
				if (data.systems[i].hasOwnProperty(&quot;linkColor&quot;) === false &amp;&amp; data.hasOwnProperty(&quot;linkColor&quot;)) {
					data.systems[i].linkColor = data.linkColor;
				}
				if (data.systems[i].hasOwnProperty(&quot;markerShape&quot;) === false &amp;&amp; data.hasOwnProperty(&quot;markerShape&quot;)) {
					data.systems[i].markerShape = data.markerShape;
				}
				if (data.systems[i].hasOwnProperty(&quot;markerColor&quot;) === false &amp;&amp; data.hasOwnProperty(&quot;markerColor&quot;)) {
					data.systems[i].markerColor = data.markerColor;
				}
				if (data.listType == &quot;path&quot;) {
					if (data.systems[i].hasOwnProperty(&quot;endMarkerShape&quot;) === false &amp;&amp; data.hasOwnProperty(&quot;endMarkerShape&quot;)) {
						data.systems[i].endMarkerShape = data.endMarkerShape;
					}
					if (data.systems[i].hasOwnProperty(&quot;startMarkerShape&quot;) === false &amp;&amp; data.hasOwnProperty(&quot;startMarkerShape&quot;)) {
						data.systems[i].startMarkerShape = data.startMarkerShape;
					}
				}
			}
		}
		if (valid == false) throw &quot;Invalid settings: systems must be supplied, and must be an array or dictionaries.&quot;;
	} else {
		throw &quot;Invalid settings: systems array not set.&quot;;
	}
	if (data.systems.length === 0) {
		throw &quot;Invalid settings: no system ID&#39;s found in the systems array.&quot;;
	}
	
	if (coreID &amp;&amp; coreID &gt; 0) {
		this._custom.splice(coreID - 1, 0, data);
	} else {
		this._custom.push(data);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$addCoreData = function $addCoreData() {

	// regions
	var data = {
		name: &quot;[gr_regions_menu]&quot;,
		linkColor:this._regionColor, 
		listType: &quot;region&quot;,
		systems:[]
	};
	var regions = this.$getRegionData();
	for (var i = 0; i &lt; regions.length; i++) {
		data.systems.push({name:regions[i].name, systemIDList:regions[i].data})
	}
	this.$addSystemList(data, 1);

	// spacelanes
	var data = {
		name: &quot;[gr_spacelanes_menu]&quot;,
		listType: &quot;path&quot;,
		startMarkerShape:&quot;MARKER_SQUARE&quot;,
		endMarkerShape:&quot;MARKER_DIAMOND&quot;,
		systems:[]
	};
	var lanes = this.$getSpacelanes();
	for (var i = 0; i &lt; lanes.length; i++) {
		data.systems.push({name:lanes[i].name, markerColor:lanes[i].color, linkColor:lanes[i].color, systemIDList:lanes[i].data})
	}
	this.$addSystemList(data, 2);

	// techlevel
	var data = {
		name: &quot;[gr_techlevel_menu]&quot;,
		markerColor:this._techLevelColor, 
		markerShape:&quot;MARKER_DIAMOND&quot;,
		listType: &quot;unconnected&quot;,
		systems:[]
	};
	var maxlevel = this.$getMaxTechLevel();
	for (var i = 0; i &lt;= maxlevel; i++) {
		data.systems.push({name:&quot;TechLevel &quot; + (i+1), systemIDList:this.$getSystemsByTechLevel(i)});
	}
	this.$addSystemList(data, 3);

	// government
	var data = {
		name: &quot;[gr_govtype_menu]&quot;,
		listType: &quot;unconnected&quot;,
		systems:[]
	};
	for (var i = 0; i &lt;= 7; i++) {
		data.systems.push({name:this.$governmentDescriptionPlural(i), markerColor:this._governmentColor[i], systemIDList:this.$getSystemsByGovernment(i)})
	}
	this.$addSystemList(data, 4);

	// economy
	var data = {
		name: &quot;[gr_ecotype_menu]&quot;,
		listType: &quot;unconnected&quot;,
		systems:[]
	};
	for (var i = 0; i &lt;= 7; i++) {
		data.systems.push({name:this.$economyDescription(i), markerColor:this._economyColor[i], systemIDList:this.$getSystemsByEconomy(i)})
	}
	this.$addSystemList(data, 5);

	// galcop hq
	var data = {
		name: &quot;[gr_galcophq_menu]&quot;,
		listType: &quot;unconnected&quot;,
		systems:[{name:&quot;[gr_galcophq_menu]&quot;, markerColor:&quot;whiteColor&quot;, systemIDList:this.$galCopHQSystem()}]
	};
	this.$addSystemList(data, 6);

	// add the galactic navy sector commands for this sector
	if (worldScripts[&quot;GalNavy&quot;]) {
		this.$addCustomSystemList({name:expandDescription(&quot;[gr_galnavy_menu]&quot;), systems:[{name:&quot;Galactic Navy&quot;, systemIDList:this.$galNavySectorCommands()}]});
	}
}

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function() {

	for (var i = 0; i &lt; 60; i++) this._lastChoice.push(&quot;&quot;);

	if (worldScripts[&quot;Explorers Club&quot;]) this._explorersClub = true;
	if (worldScripts[&quot;Smugglers_Illegal&quot;]) this._smugglers = true;

	// add a mission screen exception to Xenon UI
	if (worldScripts.XenonUI) {
		var wx = worldScripts.XenonUI;
		wx.$addMissionScreenException(&quot;oolite-galacticregistry-regions-map&quot;);
		wx.$addMissionScreenException(&quot;oolite-galacticregistry-lanes-map&quot;);
		wx.$addMissionScreenException(&quot;oolite-galacticregistry-techlevel-map&quot;);
		wx.$addMissionScreenException(&quot;oolite-galacticregistry-government-map&quot;);
		wx.$addMissionScreenException(&quot;oolite-galacticregistry-economy-map&quot;);
		wx.$addMissionScreenException(&quot;oolite-galacticregistry-custom-map&quot;);
		wx.$addMissionScreenException(&quot;oolite-galacticregistry-selected-map&quot;);
		wx.$addMissionScreenException(&quot;oolite-galacticregistry-galcophq-map&quot;);
		wx.$addMissionScreenException(&quot;oolite-galacticregistry-searchresults-map&quot;);
	}
	// add a mission screen exception to Xenon Redux UI
	if (worldScripts.XenonReduxUI) {
		var wxr = worldScripts.XenonReduxUI;
		wxr.$addMissionScreenException(&quot;oolite-galacticregistry-regions-map&quot;);
		wxr.$addMissionScreenException(&quot;oolite-galacticregistry-lanes-map&quot;);
		wxr.$addMissionScreenException(&quot;oolite-galacticregistry-techlevel-map&quot;);
		wxr.$addMissionScreenException(&quot;oolite-galacticregistry-government-map&quot;);
		wxr.$addMissionScreenException(&quot;oolite-galacticregistry-economy-map&quot;);
		wxr.$addMissionScreenException(&quot;oolite-galacticregistry-custom-map&quot;);
		wxr.$addMissionScreenException(&quot;oolite-galacticregistry-selected-map&quot;);
		wxr.$addMissionScreenException(&quot;oolite-galacticregistry-galcophq-map&quot;);
		wxr.$addMissionScreenException(&quot;oolite-galacticregistry-searchresults-map&quot;);
	}

	if (missionVariables.GalacticRegistry_PermanentRegions) {
		this._permanentRegions = JSON.parse(missionVariables.GalacticRegistry_PermanentRegions);
		delete missionVariables.GalacticRegistry_PermanentRegions;
	}
	if (missionVariables.GalacticRegistry_PermanentLanes) {
		this._permanentLanes = JSON.parse(missionVariables.GalacticRegistry_PermanentLanes);
		delete missionVariables.GalacticRegistry_PermanentLanes;
	}
	this.$removeHistoricPermanentMarkers();

	if (missionVariables.GalacticRegistry_PermenantChartData) {
		this._permanentChartData = JSON.parse(missionVariables.GalacticRegistry_PermenantChartData);
		delete missionVariables.GalacticRegistry_PermenantChartData;
	}

	this.$initInterface(player.ship.dockedStation);

	this.$addCoreData();
}

//-------------------------------------------------------------------------------------------------------------
this.playerWillSaveGame = function() {
	if (this._permanentChartData) {
		missionVariables.GalacticRegistry_PermenantChartData = JSON.stringify(this._permanentChartData);
	} else {
		if (missionVariables.GalacticRegistry_PermenantChartData) delete missionVariables.GalacticRegistry_PermenantChartData;
	}
}

//-------------------------------------------------------------------------------------------------------------
this.shipDockedWithStation = function(station) {
	this.$initInterface(station);
}

//-------------------------------------------------------------------------------------------------------------
this.guiScreenChanged = function(to, from) {
	if (from === &quot;GUI_SCREEN_MISSION&quot; &amp;&amp; this._screenActive) {
		this._screenActive = false;
		player.ship.hudHidden = false;
		if (this._removeANATool === true) {
			// remove the ANA tool if it was installed
			player.ship.removeEquipment(&quot;EQ_ANA_TOOL&quot;);
			this._removeANATool = false;
		}
		if (this._holdDestination &gt;= 0) {
			player.ship.targetSystem = this._holdDestination;
			this._holdDestination = -1;
		}
		if (this._smugglers) worldScripts.Smugglers_Illegal.$markSystems();
	}
	// clean up all the marks on the chart
	if (guiScreen != &quot;GUI_SCREEN_MISSION&quot; &amp;&amp; guiScreen != &quot;GUI_SCREEN_INTERFACES&quot;) {
		this.$removeChartData();
	}
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillEnterWitchspace = function(cause) {
	if (cause === &quot;galactic jump&quot;) {
		// clean up any permanent chart markers
		var regions = this._permanentChartData.regions;
		if (regions &amp;&amp; regions.length &gt; 0) {
			for (var i = regions.length - 1; i &gt;= 0; i--) {
				this.$removePermanentRegion(regions[i].id);
			}
		}
		var paths = this._permanentChartData.paths;
		if (paths &amp;&amp; paths.length &gt; 0) {
			for (var i = paths.length - 1; i &gt;= 0; i--) {
				this.$removePermanentPath(paths[i].id);
			}
		}
		var sys = this._permanentChartData.systems;
		if (sys &amp;&amp; sys.length &gt; 0) {
			for (var i = sys.length - 1; i &gt;= 0; i--) {
				this.$removePermanentSystems(sys[i].id);
			}
		}
		this._permanentChartData = {regions:[], paths:[], systems:[]};
	}
}

//-------------------------------------------------------------------------------------------------------------
this.playerEnteredNewGalaxy = function(galaxyNumber) {
	// reset the custom array, so that there is no chance of displaying misleading info
	this._custom.length = 0;
	this.$addCoreData();
}

//-------------------------------------------------------------------------------------------------------------
this.$initInterface = function $initInterface(station) {
	station.setInterface(this.name,{
		title:&quot;GalCop galactic registry&quot;,
		category:&quot;Informational&quot;,
		summary:&quot;Accesses system data for the current galactic sector.&quot;,
		callback:this.$setupMissionPage.bind(this)
	});
}

//-------------------------------------------------------------------------------------------------------------
this.$setupMissionPage = function $setupMissionPage() {
	if (this._explorersClub) this.$hideExplorersClub();
	this._lastChoice = []; // reset all last choices
	this._menu = 0;
	this._page = 0;
	this.$showMissionPage();
}

//-------------------------------------------------------------------------------------------------------------
this.$showMissionPage = function $showMissionPage() {
	function compareName(a, b) {
		if (a.name &lt; b.name) return -1;
		if (a.name &gt; b.name) return 1;
		return 0;
	}
	function compareTL(a, b) {
		if (a.techlevel &lt; b.techlevel) return -1;
		if (a.techlevel &gt; b.techlevel) return 1;
		if (a.name &lt; b.name) return -1;
		if (a.name &gt; b.name) return 1;
		return 0;
	}
	function compareEco(a, b) {
		if (a.economy &lt; b.economy) return -1;
		if (a.economy &gt; b.economy) return 1;
		if (a.name &lt; b.name) return -1;
		if (a.name &gt; b.name) return 1;
		return 0;
	}
	function compareGov(a, b) {
		if (a.government &lt; b.government) return -1;
		if (a.government &gt; b.government) return 1;
		if (a.name &lt; b.name) return -1;
		if (a.name &gt; b.name) return 1;
		return 0;
	}
	
	if (this._smugglers) this.$hideSmugglers();

	var curChoices = {};
	var p = player.ship;
	var def = &quot;&quot;;
	var text = &quot;&quot;;
	var pagesize = 8;
	this._pageLength = 16;
	var zeroMap = (worldScripts.ZeroMap ? true : false);

	if (zeroMap &amp;&amp; worldScripts.BountySystem_MostWanted &amp;&amp; worldScripts.BountySystem_MostWanted._unconcealmentActive === true) {
		if (this._retry) this._retry.stop();
		log(this.name, &quot;starting retry of missionpage&quot;);
		this._retry = new Timer(this, this.$showMissionPage, 0.25, 0);
		return;
	}

	if (zeroMap) worldScripts.ZeroMap._hideGUIScreen();

	var bg = &quot;LONG_RANGE_CHART_SHORTEST&quot;;
	
	// in order to show connecting lines on the map, we need to make sure the player either has the ANA, or if not that, then a piece of equipment that can provide the same service
	if (player.ship.hasEquipmentProviding(&quot;EQ_ADVANCED_NAVIGATIONAL_ARRAY&quot;) === false) {
		player.ship.awardEquipment(&quot;EQ_ANA_TOOL&quot;);
		this._removeANATool = true;
		// if we&#39;ve had to award the ANA tool to display lines between systems, then we don&#39;t want to give the player a free route planner
		// turn off the player&#39;s destination while we display these screens
		this._holdDestination = p.targetSystem;
		p.targetSystem = system.ID;
	} else {
		// otherwise, we have the array, so we can add the current course to any display, if it&#39;s not already there
		if (p.routeMode === &quot;OPTIMIZED_BY_TIME&quot;) bg = &quot;LONG_RANGE_CHART_QUICKEST&quot;;
	}

	if (this._removeANATool === false) pagesize = 6;

	if (this.$isBigGuiActive() === false) p.hudHidden = true;
	this._screenActive = true;

	this.$removeChartData();

	switch (this._menu) {
		case 0: // main menu
			{
				text = &quot;Welcome to the GalCop galactic registry. Select the area you want to browse:&quot;;

				curChoices[&quot;11_FULLLIST&quot;] = {text:&quot;[gr_fulllist_menu]&quot;, color:this._menuColor};
				curChoices[&quot;12_SEARCH&quot;] = {text:&quot;[gr_search_menu]&quot;, color:this._menuColor};
				if (this._custom.length &gt; 0) {
					for (var i = 0; i &lt; this._custom.length; i++) {
						var item = this._custom[i];
						curChoices[&quot;10_CUSTOM~&quot; + (i &lt; 10 ? &quot;0&quot; : &quot;&quot;) + i] = {text:expandDescription(item.name), color:this._menuColor};
					}
				}
				curChoices[&quot;99_EXIT&quot;] = {text:&quot;[gr_exit_menu]&quot;, color:this._itemColor};

				def = &quot;99_EXIT&quot;;

				var opts = {
					screenID: &quot;oolite-galacticregistry-intro-map&quot;,
					title: &quot;Galactic Registry - Main Menu&quot;,
					allowInterrupt: true,
					overlay:{name:&quot;galreg-solar_system.png&quot;, height:546},
					exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
					choices: curChoices,
					initialChoicesKey: (this._lastChoice[this._menu] != &quot;&quot; ? this._lastChoice[this._menu] : def),
					message: text
				};
				break;
			}
		case 8: // full list
			{
				var syslist = SystemInfo.filteredSystems(this, function(other) {return (!other.concealment || other.concealment &lt;= 100);});
				var rows = 16;
				
				switch (this._sortType) {
					case 0:
						syslist.sort(compareName);
						break;
					case 1: 
						syslist.sort(compareTL);
						break;
					case 2:
						syslist.sort(compareGov);
						break;
					case 3:
						syslist.sort(compareEco);
						break;
				}

				text = this.$padTextRight(&quot;&quot;, 2.1) + 
					this.$padTextRight(&quot;Name&quot;, 7) + 
					this.$padTextRight(&quot;TL&quot;, 3) + 
					this.$padTextRight(&quot;Government&quot;, 10) +
					&quot;Economy\n&quot;;

				var maxpage = Math.ceil(syslist.length / rows);
				var end = ((this._page * rows) + rows);
				var itemcount = 0;
				if (end &gt; syslist.length) end = syslist.length;
				for (var i = (this._page * rows); i &lt; end; i++) {
					curChoices[&quot;40_SYSLIST_&quot; + (i &lt; 10 ? &quot;00&quot; : (i &lt; 100 ? &quot;0&quot; : &quot;&quot;)) + i + &quot;~&quot; + syslist[i].systemID] =
						{text:this.$padTextRight((this._select1 === syslist[i].systemID || this._select2 === syslist[i].systemID ? &quot;•&quot; : &quot;&quot;), 2) + 
							this.$padTextRight(syslist[i].name, 7) + 
							this.$padTextRight(((!syslist[i].concealment || syslist[i].concealment === 0) ? syslist[i].techlevel + 1 : &quot;??&quot;), 3) + 
							this.$padTextRight(((!syslist[i].concealment || syslist[i].concealment === 0) ? this.$governmentDescription(syslist[i].government) : &quot;??&quot;), 10) + 
							((!syslist[i].concealment || syslist[i].concealment === 0) ? this.$economyDescription(syslist[i].economy) : &quot;??&quot;), 
						alignment:&quot;LEFT&quot;, color:this._itemColor};
					itemcount += 1;
				}

				curChoices[&quot;94_SPACER&quot;] = &quot;&quot;;
				for (var i = 0; i &lt; (rows - itemcount); i++) {
					curChoices[&quot;94_SPACER_&quot; + i] = &quot;&quot;;
				}

				if (maxpage &gt; 1 &amp;&amp; this._page &lt; (maxpage - 1)) {
					curChoices[&quot;95_NEXT&quot;] = {text:&quot;[gr_nextpage]&quot;, color:this._menuColor};
				} else {
					curChoices[&quot;95_NEXT&quot;] = {text:&quot;[gr_nextpage]&quot;, color:this._disabledColor, unselectable:true};
				}
				if (this._page &gt; 0) {
					curChoices[&quot;96_PREV&quot;] = {text:&quot;[gr_prevpage]&quot;, color:this._menuColor};
				} else {
					curChoices[&quot;96_PREV&quot;] = {text:&quot;[gr_prevpage]&quot;, color:this._disabledColor, unselectable:true};
				}

				curChoices[&quot;97_1_SORT_NAME&quot;] = {text:&quot;[gr_sort_name]&quot;, color:(this._sortType === 0 ? this._disabledColor : this._menuColor), unselectable:(this._sortType === 0 ? true : false)};
				curChoices[&quot;97_2_SORT_TL&quot;] = {text:&quot;[gr_sort_tl]&quot;, color:(this._sortType === 1 ? this._disabledColor : this._menuColor), unselectable:(this._sortType === 1 ? true : false)};
				curChoices[&quot;97_3_SORT_GOV&quot;] = {text:&quot;[gr_sort_gov]&quot;, color:(this._sortType === 2 ? this._disabledColor : this._menuColor), unselectable:(this._sortType === 2 ? true : false)};
				curChoices[&quot;97_4_SORT_ECO&quot;] = {text:&quot;[gr_sort_eco]&quot;, color:(this._sortType === 3 ? this._disabledColor : this._menuColor), unselectable:(this._sortType === 3 ? true : false)};

				var sys1 = &quot;(none)&quot;;
				var sys2 = &quot;(none)&quot;;
				if (this._select1 &gt;= 0) sys1 = System.systemNameForID(this._select1);
				if (this._selectLast === 2) sys1 = &quot;• &quot; + sys1;
				if (this._select2 &gt;= 0) sys2 = System.systemNameForID(this._select2);
				if (this._selectLast === 1) sys2 = &quot; •&quot; + sys2;

				curChoices[&quot;97_9_SELECTED&quot;]	 = {text:expandDescription(&quot;[gr_view_selected]&quot;, {select1:sys1, select2:sys2}), color:(this._select1 === -1 || this._select2 === -1 ? this._disabledColor : this._menuColor), unselectable:(this._select1 === -1 || this._select2 === -1 ? true : false)};

				def = &quot;98_EXIT&quot;;
				curChoices[&quot;98_EXIT&quot;] = {text:&quot;[gr_exit_menu]&quot;, color:this._exitColor};

				var opts = {
					screenID: &quot;oolite-galacticregistry-fulllist-map&quot;,
					title: &quot;System List&quot; + (maxpage &gt; 1 ? &quot;: Page &quot; + (this._page + 1) + &quot; of &quot; + maxpage : &quot;&quot;),
					overlay:{name:&quot;galreg-solar_system.png&quot;, height:546},
					allowInterrupt: true,
					exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
					choices: curChoices,
					initialChoicesKey: (this._lastChoice[this._menu] != &quot;&quot; ? this._lastChoice[this._menu] : def),
					message: text
				};
				break;
			}

		case 9: // selected systems
			{
				mission.markSystem({system:this._select1, markerColor:&quot;greenColor&quot;, markerShape:&quot;MARKER_SQUARE&quot;, name:&quot;galreg_marked&quot;});
				this._markedPlanets.push(this._select1);
				mission.markSystem({system:this._select2, markerColor:&quot;cyanColor&quot;, markerShape:&quot;MARKER_SQUARE&quot;, name:&quot;galreg_marked&quot;});
				this._markedPlanets.push(this._select2);

				var data1 = this.$getSystemData(this._select1);
				var data2 = this.$getSystemData(this._select2);
				var conceal1 = System.infoForSystem(galaxyNumber, this._select1).concealment;
				var conceal2 = System.infoForSystem(galaxyNumber, this._select2).concealment;

				if (p.hasEquipmentProviding(&quot;EQ_ADVANCED_NAVIGATIONAL_ARRAY&quot;) === true) {
					var rt = System.infoForSystem(galaxyNumber, this._select1).routeToSystem(System.infoForSystem(galaxyNumber, this._select2), p.routeMode);
					if (rt &amp;&amp; rt.route.length &gt; 1) {
						for (var i = 0; i &lt; rt.route.length - 1; i++) {
							if (rt.route[i] &lt; rt.route[i + 1]) {
								SystemInfo.setInterstellarProperty(galaxyNumber, rt.route[i], rt.route[i + 1], 2, &quot;link_color&quot;, &quot;whiteColor&quot;, &quot;galreg_region&quot;);
								this._markedRegions.push({id1:rt.route[i], id2:rt.route[i + 1]});
							} else {
								SystemInfo.setInterstellarProperty(galaxyNumber, rt.route[i + 1], rt.route[i], 2, &quot;link_color&quot;, &quot;whiteColor&quot;, &quot;galreg_region&quot;);
								this._markedRegions.push({id1:rt.route[i + 1], id2:rt.route[i]});
							}
						}
					}
				}

				var govs = new Array();
				for (var i = 0; i &lt; 8 ; i++)
					govs.push(String.fromCharCode(i));
				this.ecos = new Array();
				for (i = 0; i &lt; 8 ; i++) {
					this.ecos.push(String.fromCharCode(23 - i));
				}
				var spc = String.fromCharCode(31);

				text = &quot;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&quot;; 

				text += this.$padTextRight(data1.name + ((!conceal1 || conceal1 === 0) ? &quot; (&quot; + spc + govs[data1.government] + spc + ecos[data1.economy] + spc + &quot;TL&quot; + spc + data1.techLevel + &quot;)&quot; : &quot;&quot;), 15.5) + 
					data2.name + ((conceal2 || conceal2 === 0) ? &quot; (&quot; + spc + govs[data2.government] + spc + ecos[data2.economy] + spc + &quot;TL&quot; + spc + data2.techLevel + &quot;)&quot; : &quot;&quot;) + &quot;\n&quot;;
				text += this.$padTextRight(((!conceal1 || conceal1 === 0) ? data1.population + &quot; &quot; + data1.inhabitants : &quot;&quot;), 15.5) + 
					((!conceal2 || conceal2 === 0) ? data2.population + &quot; &quot; + data2.inhabitants : &quot;&quot;) + &quot;\n&quot;;
				text += this.$padTextRight(((!conceal1 || conceal1 === 0) ? &quot;Prod: &quot; + data1.productivity + &quot; M₢, Radius: &quot; + data1.radius + &quot; km&quot; : &quot;&quot;), 15.5) + 
					((!conceal2 || conceal2 === 0) ? &quot;Prod: &quot; + data2.productivity + &quot; M₢, Radius: &quot; + data2.radius + &quot; km&quot; : &quot;&quot;) + &quot;\n\n&quot;;

				if (rt) {
					text += &quot;Distance between systems: &quot; + rt.distance.toFixed(1) + &quot; ly / &quot; + 
						rt.time.toFixed(1) + &quot; &quot; + (rt.time &gt; 0.95 &amp;&amp; rt.time &lt; 1.05 ? expandDescription(&quot;[sysdata-route-hours%0]&quot;) : expandDescription(&quot;[sysdata-route-hours%1]&quot;))  + &quot; / &quot; + 
						(rt.route.length - 1) + &quot; &quot; + (rt.route.length === 2 ? expandDescription(&quot;[sysdata-route-jumps%0]&quot;) : expandDescription(&quot;[sysdata-route-jumps%1]&quot;));
				} else {
					text += &quot;Distance between systems: &quot; + System.infoForSystem(galaxyNumber, this._select1).distanceToSystem(System.infoForSystem(galaxyNumber, this._select2)) + &quot; ly&quot;;
				}

				if (p.hasEquipmentProviding(&quot;EQ_ADVANCED_NAVIGATIONAL_ARRAY&quot;) === true) {
					var rt1 = system.info.routeToSystem(System.infoForSystem(galaxyNumber, this._select1), p.routeMode);
					if (rt1 &amp;&amp; rt1.route.length &gt; 1) {
						var rtText = rt1.distance.toFixed(1) + &quot; ly / &quot; + 
						rt1.time.toFixed(1) + &quot; &quot; + (rt1.time &gt; 0.95 &amp;&amp; rt1.time &lt; 1.05 ? expandDescription(&quot;[sysdata-route-hours%0]&quot;) : expandDescription(&quot;[sysdata-route-hours%1]&quot;))  + &quot; / &quot; + 
						(rt1.route.length - 1) + &quot; &quot; + (rt1.route.length === 2 ? expandDescription(&quot;[sysdata-route-jumps%0]&quot;) : expandDescription(&quot;[sysdata-route-jumps%1]&quot;));
						curChoices[&quot;50_SETCOURSE~&quot; + this._select1] = {text:expandDescription(&quot;[gr_setcourse3]&quot;, {select:System.systemNameForID(this._select1), details:rtText}), color:&quot;greenColor&quot;};
					} else {
						var rtText = system.info.distanceToSystem(System.infoForSystem(galaxyNumber, this._select1)).toFixed(1) + &quot; ly&quot;;
						curChoices[&quot;50_SETCOURSE~&quot; + this._select1] = {text:expandDescription(&quot;[gr_nocourse]&quot;, {select:System.systemNameForID(this._select1), details:rtText}), color:&quot;greenColor&quot;, unselectable:true};
					}
					var rt2 = system.info.routeToSystem(System.infoForSystem(galaxyNumber, this._select2), p.routeMode);
					if (rt2 &amp;&amp; rt2.route.length &gt; 1) {
						var rtText = rt2.distance.toFixed(1) + &quot; ly / &quot; + 
						rt2.time.toFixed(1) + &quot; &quot; + (rt2.time &gt; 0.95 &amp;&amp; rt2.time &lt; 1.05 ? expandDescription(&quot;[sysdata-route-hours%0]&quot;) : expandDescription(&quot;[sysdata-route-hours%1]&quot;))  + &quot; / &quot; + 
						(rt2.route.length - 1) + &quot; &quot; + (rt2.route.length === 2 ? expandDescription(&quot;[sysdata-route-jumps%0]&quot;) : expandDescription(&quot;[sysdata-route-jumps%1]&quot;));	
						curChoices[&quot;50_SETCOURSE~&quot; + this._select2] = {text:expandDescription(&quot;[gr_setcourse3]&quot;, {select:System.systemNameForID(this._select2), details:rtText}), color:&quot;cyanColor&quot;};
					} else {
						var rtText = system.info.distanceToSystem(System.infoForSystem(galaxyNumber, this._select2)).toFixed(1) + &quot; ly&quot;;
						curChoices[&quot;50_SETCOURSE~&quot; + this._select2] = {text:expandDescription(&quot;[gr_nocourse]&quot;, {select:System.systemNameForID(this._select2), details:rtText}), color:&quot;cyanColor&quot;, unselectable:true};
					}
				}

				curChoices[&quot;97_EXIT&quot;] = {text:&quot;[gr_exit_menu]&quot;, color:this._itemColor};
				def = &quot;97_EXIT&quot;;

				var opts = {
					screenID: &quot;oolite-galacticregistry-selected-map&quot;,
					title: &quot;Galactic Registry - Selected Systems&quot;,
					backgroundSpecial: bg,
					overlay:{name:&quot;galreg-solar_system.png&quot;, height:546},
					allowInterrupt: true,
					exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
					choices: curChoices,
					initialChoicesKey: (this._lastChoice[this._menu] != &quot;&quot; ? this._lastChoice[this._menu] : def),
					message: text
				};
				break;
			}

		case 10: // search results map
			{
				this._pageLength = 255;
				var planets = this.$searchSystems();
				var closest = this.$getClosestSystemFromList(planets);

				for (var i = 0; i &lt; planets.length; i++) {
					mission.markSystem({system:planets[i].systemID, markerColor:&quot;cyanColor&quot;, markerShape:&quot;MARKER_DIAMOND&quot;, name:&quot;galreg_marked&quot;});
					this._markedPlanets.push(planets[i].systemID);
				}

				curChoices[&quot;17_SEARCHRESULTS-X&quot;] = {text:&quot;[gr_showsystems0]&quot;, unselectable:false, color:this._altColor};

				if (this._removeANATool === false) {
					if (closest != -1) curChoices[&quot;50_SETCOURSE~&quot; + closest] = {text:expandDescription(&quot;[gr_setcourse1]&quot;, {select:System.systemNameForID(closest)}), color:this._menuColor};
				}

				text = &quot;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFound &quot; + planets.length + &quot; system&quot; + (planets.length &gt; 1 ? &quot;s&quot; : &quot;&quot;) + &quot;.  Search criteria: &quot; + this._search.join(&quot; &quot;);

				curChoices[&quot;97_SEARCH_AGAIN&quot;] = {text:&quot;[gr_search_again]&quot;, color:this._itemColor};
				curChoices[&quot;98_EXIT&quot;] = {text:&quot;[gr_exit_menu]&quot;, color:this._itemColor};
				def = &quot;98_EXIT&quot;;

				var opts = {
					screenID: &quot;oolite-galacticregistry-searchresults-map&quot;,
					title: &quot;Galactic Registry - Search Results&quot;,
					backgroundSpecial: bg,
					overlay:{name:&quot;galreg-solar_system.png&quot;, height:546},
					allowInterrupt: true,
					exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
					choices: curChoices,
					initialChoicesKey: (this._lastChoice[this._menu] != &quot;&quot; ? this._lastChoice[this._menu] : def),
					message: text
				};
				break;
			}
		case 17: // search results sys list
			{
				this._pageLength = 22;
				var planets = this.$searchSystems();
				planets.sort(compareName);
				var closest = this.$getClosestSystemFromList(planets);

				text = (this._searchMax === false ? &quot;Found &quot; + planets.length + &quot; system&quot; + (planets.length &gt; 1 ? &quot;s&quot; : &quot;&quot;) + &quot;.  &quot; : &quot;&quot;) + &quot;Search criteria: &quot; + this._search.join(&quot; &quot;) + &quot;\n&quot; + (this._searchMax === true ? &quot;Note: More than 66 systems found - Only 66 systems shown&quot; : &quot;&quot;) + &quot;\n&quot;;
				
				text += this.$formatSystemList(planets);

				curChoices[&quot;17_SEARCHRESULTS&quot;] = {text:&quot;[gr_showmap0]&quot;, color:this._altColor};

				if (this._removeANATool === false) {
					if (closest != -1) curChoices[&quot;50_SETCOURSE~&quot; + closest] = {text:expandDescription(&quot;[gr_setcourse1]&quot;, {select:System.systemNameForID(closest)}), color:this._menuColor};
				}

				curChoices[&quot;97_SEARCH_AGAIN&quot;] = {text:&quot;[gr_search_again]&quot;, color:this._itemColor};
				curChoices[&quot;98_EXIT&quot;] = {text:&quot;[gr_exit_menu]&quot;, color:this._itemColor};
				def = &quot;98_EXIT&quot;;

				var opts = {
					screenID: &quot;oolite-galacticregistry-searchsystemslist-map&quot;,
					title: &quot;Galactic Registry - Search Results&quot;,
					allowInterrupt: true,
					exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
					choices: curChoices,
					initialChoicesKey: (this._lastChoice[this._menu] != &quot;&quot; ? this._lastChoice[this._menu] : def),
					message: text
				};
				break;
			}
	}

	if (this._menu &gt;= 20) {
		var cust = this._menu - 20;
		var sub = false;
		if (cust &gt;= 20) {
			cust -= 20;
			sub = true;
		}
		var custItem = this._custom[cust];
		this._setItem = custItem.systems[this._item];
		var planets = custItem.systems[this._item].systemIDList;
		def = &quot;98_EXIT&quot;;

		if (sub === false) {
			var closest = this.$getClosestSystemFromList(planets);

			switch (custItem.listType) {
				case &quot;unconnected&quot;: // (default)
					var colr = custItem.systems[this._item].markerColor;
					var shape = custItem.systems[this._item].markerShape;

					for (var i = 0; i &lt; planets.length; i++) {
						var s = System.infoForSystem(galaxyNumber, planets[i]);
						if (!s.concealment || s.concealment &lt;= 100) {
							mission.markSystem({system:planets[i], markerColor:colr, markerShape:shape, name:&quot;galreg_marked&quot;, markerScale:1.0});
							this._markedPlanets.push(planets[i]);
						}
					}
					break;
				case &quot;region&quot;: 
					var colr = custItem.systems[this._item].linkColor
					for (var j = 0; j &lt; planets.length; j++) {
						for (var k = 0; k &lt; planets.length; k++) {
							if (j != k &amp;&amp; planets[j] &lt; planets[k]) {
								this._markedRegions.push({id1:planets[j], id2:planets[k]});
								SystemInfo.setInterstellarProperty(galaxyNumber, planets[j], planets[k], 2, &quot;link_color&quot;, colr, &quot;galreg_region&quot;);
							}
						}
					}
					break;
				case &quot;path&quot;:
					var colr = custItem.systems[this._item].linkColor

					for (var j = 0; j &lt; planets.length - 1; j++) {
						var s1 = System.infoForSystem(galaxyNumber, planets[j]);
						var c1 = s1.concealment;
						if (!c1) c1 = 0;
						var s2 = System.infoForSystem(galaxyNumber, planets[j + 1]);
						var c2 = s2.concealment;
						if (!c2) c2 = 0;
						if (c1 &lt;= 100 &amp;&amp; c2 &lt;= 100 &amp;&amp; s1.distanceToSystem(s2) &lt;= 7) {
							if (planets[j] &lt; planets[j + 1]) {
								SystemInfo.setInterstellarProperty(galaxyNumber, planets[j], planets[j + 1], 2, &quot;link_color&quot;, colr, &quot;galreg_region&quot;);
								this._markedRegions.push({id1:planets[j], id2:planets[j + 1]});
							} else {
								SystemInfo.setInterstellarProperty(galaxyNumber, planets[j + 1], planets[j], 2, &quot;link_color&quot;, colr, &quot;galreg_region&quot;);
								this._markedRegions.push({id1:planets[j + 1], id2:planets[j]});
							}
						}
					}
					// mark the end points on the route
					colr = custItem.systems[this._item].markerColor

					var c1 = System.infoForSystem(galaxyNumber, planets[0]).concealment;
					if (!c1 || c1 &lt;= 100) {
						mission.markSystem({system:planets[0], name:&quot;galreg_marked&quot;, markerShape:custItem.systems[this._item].startMarkerShape, markerColor:colr, markerScale:1.5});
						this._spaceLaneStart = planets[0];
					}
					var c2 = System.infoForSystem(galaxyNumber, planets[planets.length - 1]).concealment;
					if (!c2 || c2 &lt;= 100) {
						mission.markSystem({system:planets[planets.length - 1], name:&quot;galreg_marked&quot;, markerShape:custItem.systems[this._item].endMarkerShape, markerColor:colr, markerScale:1.5});
						this._spaceLaneEnd = planets[planets.length - 1];
					}
					break;
			}

			var opts = {
				screenID: &quot;oolite-galacticregistry-custom-map&quot;,
				title: &quot;Galactic Registry - &quot; + expandDescription(custItem.systems[this._item].name),
				backgroundSpecial: bg,
				overlay:{name:&quot;galreg-solar_system.png&quot;, height:546},
				allowInterrupt: true,
				exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
				initialChoicesKey: (this._lastChoice[this._menu] != &quot;&quot; ? this._lastChoice[this._menu] : def),
				message: text
			};

		} else {
			var syslist = [];
			for (var i = 0; i &lt; planets.length; i++) {
				var s = System.infoForSystem(galaxyNumber, planets[i]);
				syslist.push(s);
			}
			// only sort the non-path lists
			if (custItem.listType != &quot;path&quot;) {
				syslist.sort(compareName);
				planets.sort(compareName);
			}
			var closest = this.$getClosestSystemFromList(planets);

			text = this.$formatSystemList(syslist);

			var opts = {
				screenID: &quot;oolite-galacticregistry-customsystemslist-map&quot;,
				title: &quot;Galactic Registry - &quot; + expandDescription(custItem.systems[this._item].name),
				overlay:{name:&quot;galreg-solar_system.png&quot;, height:546},
				allowInterrupt: true,
				exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
				initialChoicesKey: (this._lastChoice[this._menu] != &quot;&quot; ? this._lastChoice[this._menu] : def),
				message: text
			};
		}

		var holdpagesize = pagesize;

		var maxpage = Math.ceil(custItem.systems.length / pagesize);
		// if we have three pages to display, we need to reduce the page size because the middle page will need a &quot;Next&quot; plus a &quot;Back&quot; item
		// which will reduce the actual space for techelevel items
		if (maxpage &gt; 1) { //  &amp;&amp; pagesize === 7
			pagesize -= 1;
			maxpage = Math.ceil(custItem.systems.length / pagesize);
		}
		
		var end = ((this._page * pagesize) + pagesize);
		if (end &gt; custItem.systems.length) end = custItem.systems.length;

		for (var i = (this._page * pagesize); i &lt; end; i++) {
			if (this._item === i) {
				if (sub === false) {
					curChoices[&quot;20_CUSTOM!&quot; + (cust &lt; 10 ? &quot;0&quot; : &quot;&quot;) + cust + &quot;~&quot; + (i &lt; 10 ? &quot;0&quot; : &quot;&quot;) + i + &quot;-X&quot;] = {text:expandDescription(&quot;[gr_showsystems1]&quot;, {name:custItem.systems[i].name}), unselectable:false, color:this._altColor};
				} else {
					curChoices[&quot;20_CUSTOM!&quot; + (cust &lt; 10 ? &quot;0&quot; : &quot;&quot;) + cust + &quot;~&quot; + (i &lt; 10 ? &quot;0&quot; : &quot;&quot;) + i] = {text:expandDescription(&quot;[gr_showmap1]&quot;, {name:custItem.systems[i].name}), unselectable:false, color:this._altColor};
				}
			} else {
				curChoices[&quot;20_CUSTOM!&quot; + (cust &lt; 10 ? &quot;0&quot; : &quot;&quot;) + cust + &quot;~&quot; + (i &lt; 10 ? &quot;0&quot; : &quot;&quot;) + i] = {text:custItem.systems[i].name, color:this._menuColor};
			}
		}

		if (this._removeANATool === false) {
			if (closest != -1) curChoices[&quot;50_SETCOURSE~&quot; + closest] = {text:expandDescription(&quot;[gr_setcourse1]&quot;, {select:System.systemNameForID(closest)}), color:this._itemColor};
			switch (custItem.listType) {
				case &quot;unconnected&quot;:
					curChoices[&quot;94U_PERMANENT&quot;] = {text:(this.$checkPermanentSystems(this._setItem.id) ? &quot;[gr_unset_permanent]&quot; : &quot;[gr_set_permanent]&quot;), color:this._itemColor};
					break;
				case &quot;region&quot;:
					curChoices[&quot;94R_PERMANENT&quot;] = {text:(this.$checkPermanentRegions(this._setItem.id) ? &quot;[gr_unset_permanent]&quot; : &quot;[gr_set_permanent]&quot;), color:this._itemColor};
					break;
				case &quot;path&quot;:
					curChoices[&quot;94P_PERMANENT&quot;] = {text:(this.$checkPermanentPaths(this._setItem.id) ? &quot;[gr_unset_permanent]&quot; : &quot;[gr_set_permanent]&quot;), color:this._itemColor};
					break;
			}
		}

		if (maxpage &gt; 1) {
			if (this._page &lt; (maxpage - 1)) {
				curChoices[&quot;95_NEXT&quot;] = {text:&quot;[gr_nextpage]&quot;, color:this._itemColor};
			} else {
				curChoices[&quot;95_NEXT&quot;] = {text:&quot;[gr_nextpage]&quot;, color:this._disabledColor, unselectable:true};
			}
			if (this._page &gt; 0) {
				curChoices[&quot;96_PREV&quot;] = {text:&quot;[gr_prevpage]&quot;, color:this._itemColor};
			} else {
				curChoices[&quot;96_NEXT&quot;] = {text:&quot;[gr_prevpage]&quot;, color:this._disabledColor, unselectable:true};
			}
		}

		curChoices[&quot;98_EXIT&quot;] = {text:&quot;[gr_exit_menu]&quot;, color:this._itemColor};

		pagesize = holdpagesize;
		opts.choices = curChoices;
	}

	if (zeroMap) worldScripts.ZeroMap._showAll(galaxyNumber);

	mission.runScreen(opts, this.$screenHandler, this);
}

//-------------------------------------------------------------------------------------------------------------
this.$screenHandler = function $screenHandler(choice) {
	if (this._holdDestination &gt;= 0) {
		player.ship.targetSystem = this._holdDestination;
		this._holdDestination = -1;
	}

	if (!choice) return;

	this._lastChoice[this._menu] = choice;
	
	switch (choice) {
		case &quot;11_FULLLIST&quot;:
			this._menu = 8;
			this._item = 0;
			this._page = 0;
			break;
		case &quot;12_SEARCH&quot;:
			this.$getSearchPhrase();
			return;
		case &quot;94U_PERMANENT&quot;: // systems
			if (this.$checkPermanentSystems(this._setItem.id)) {
				this.$removePermanentSystems(this._setItem.id);
			} else {
				this._permanentChartData.systems.push({
					id:this._setItem.id, 
					markerShape:this._setItem.markerShape, 
					markerColor:this._setItem.markerColor, 
					markerScale:1.0,
					systemIDList:this._setItem.systemIDList
				});
			}
			break;
		case &quot;94P_PERMANENT&quot;:
			if (this.$checkPermanentPaths(this._setItem.id)) {
				this.$removePermanentPath(this._setItem.id);
				this.$removePermanentSystems(this._setItem.id);
			} else {
				this._permanentChartData.paths.push({
					id:this._setItem.id,
					linkColor: this._setItem.linkColor,
					systemIDList: this._setItem.systemIDList
				});
				this._permanentChartData.systems.push({
					id:this._setItem.id,
					markerShape:this._setItem.startMarkerShape,
					markerColor:this._setItem.markerColor,
					markerScale:1.5,
					systemIDList:[this._setItem.systemIDList[0]]
				});
				this._permanentChartData.systems.push({
					id:this._setItem.id,
					markerShape:this._setItem.endMarkerShape,
					markerColor:this._setItem.markerColor,
					markerScale:1.5,
					systemIDList:[this._setItem.systemIDList[this._setItem.systemIDList.length - 1]]
				});
			}
			break;
		case &quot;94R_PERMANENT&quot;:
			if (this.$checkPermanentRegions(this._setItem.id)) {
				this.$removePermanentRegion(this._setItem.id);
			} else {
				this._permanentChartData.regions.push({
					id:this._setItem.id,
					linkColor: this._setItem.linkColor,
					systemIDList: this._setItem.systemIDList
				});
			}
			break;
		case &quot;95_NEXT&quot;:
			this._page += 1;
			break;
		case &quot;96_PREV&quot;:
			this._page -= 1;
			break;
		case &quot;97_1_SORT_NAME&quot;:
			this._sortType = 0;
			break;
		case &quot;97_2_SORT_TL&quot;:
			this._sortType = 1;
			break;
		case &quot;97_3_SORT_GOV&quot;:
			this._sortType = 2;
			break;
		case &quot;97_4_SORT_ECO&quot;:
			this._sortType = 3;
			break;
		case &quot;97_9_SELECTED&quot;:
			this._menu = 9;
			break;
		case &quot;97_EXIT&quot;:
			this._menu = 8;
			break;
		case &quot;98_EXIT&quot;:
			this._menu = 0;
			break;
		case &quot;97_SEARCH_AGAIN&quot;:
			this._menu = this.$getSearchPhrase();
			return;
		case &quot;17_SEARCHRESULTS&quot;:
			this._menu = 10;
			this._lastChoice[this._menu] = &quot;17_SEARCHRESULTS-X&quot;;
			break;
		case &quot;17_SEARCHRESULTS-X&quot;:
			this._menu = 17;
			this._lastChoice[this._menu] = &quot;17_SEARCHRESULTS&quot;;
			break;
	}

	if (choice.indexOf(&quot;10_CUSTOM~&quot;) &gt;= 0) {
		var custIndex = parseInt(choice.substring(choice.indexOf(&quot;~&quot;) + 1), 10);
		this._menu = custIndex + 20;
		this._item = 0;
		this._page = 0;
	}
	if (choice.indexOf(&quot;20_CUSTOM&quot;) &gt;= 0) {
		var menuIndex = parseInt(choice.substring(choice.indexOf(&quot;!&quot;) + 1), 10);
		this._menu = menuIndex + 20;
		var itemIndex = parseInt(choice.substring(choice.indexOf(&quot;~&quot;) + 1), 10);
		this._item = itemIndex;
		if (choice.indexOf(&quot;-X&quot;) === -1) {
			this._lastChoice[this._menu] = choice + &quot;-X&quot;;
		} else {
			this._menu = menuIndex + 40;
			this._lastChoice[this._menu] = choice.replace(&quot;-X&quot;, &quot;&quot;);
		}
	}

	if (choice.indexOf(&quot;40_SYSLIST&quot;) &gt;= 0) {
		var sys = parseInt(choice.substring(choice.indexOf(&quot;~&quot;) + 1), 10);
		if (this._selectLast === 2) {
			this._select1 = sys;
			this._selectLast = 1;
		} else {
			this._select2 = sys;
			this._selectLast = 2;
		}
	}
	if (choice.indexOf(&quot;50_SETCOURSE&quot;) &gt;= 0) {
		player.ship.targetSystem = parseInt(choice.substring(choice.indexOf(&quot;~&quot;) + 1), 10);
		player.ship.infoSystem = player.ship.targetSystem;
		player.consoleMessage(&quot;Course set for &quot; + System.systemNameForID(player.ship.targetSystem));
		this._lastChoice[this._menu] = &quot;&quot;;
	}

	if (choice != &quot;99_EXIT&quot;) this.$showMissionPage();
}

//-------------------------------------------------------------------------------------------------------------
// prompts the user for search criteria
this.$getSearchPhrase = function $getSearchPhrase() {
	
	var text = &quot;Enter the words you&#39;d like to search for, with each word separated by a space. The words will be looked for in the planet&#39;s &quot; +
		&quot;description, government type, economy type, inhabitants description and techelevel. &quot; + 
		&quot;All words will need to find a match in one of the descriptions in order to include that system in the search results.\n\n&quot; +
		&quot;For example, entering &#39;feline anarchy&#39; would find any Anarchy systems populated by felines.\n&quot; +
		&quot;Entering &#39;tl7 tedious&#39; would find any TechLevel 7 systems that have &#39;tedious&#39; in the planetary description.\n&quot; + 
		&quot;Entering &#39;human tl8+|industrial&#39; would final any system populated by either humans or humanoids and with either a TechLevel of 8 or more, or any of the industrial economies.\n\n&quot; +
		&quot;Entering a blank value will abort the search and return to the main menu. Entered words must be a minimum of three characters in length.&quot;;

	var opts = {
		screenID: &quot;oolite-galacticregistry-searchphrase-map&quot;,
		title: &quot;Enter search criteria&quot;,
		allowInterrupt: false,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
		overlay: {name:&quot;galreg-solar_system.png&quot;, height:546},
		message: text,
		textEntry: true
	};
	mission.runScreen(opts,this.$extractSearchWords, this);
}

//-------------------------------------------------------------------------------------------------------------
// parses the input from the setLogSize screen
this.$extractSearchWords = function $extractSearchWords(param) {
	this._menu = 10;
	if (param === &quot;&quot;) {
		this._menu = 0; 
	} else {
		this._search = param.toLowerCase().split(&quot; &quot;);
		for (var i = this._search.length - 1; i &gt;= 0; i--) {
			if (this._search[i].trim() === &quot;&quot; || this._search[i].length &lt;= 2) this._search.splice(i, 1);
		}
		if (this._search.length === 0) this._menu = 0;
	}
	this.$showMissionPage();
}

//-------------------------------------------------------------------------------------------------------------
// returns a 3-column list of planets, formatted for display
this.$formatSystemList = function $formatSystemList(list) {
	var govs = new Array();
	for (var i = 0; i &lt; 8 ; i++)
		govs.push(String.fromCharCode(i));
	this.ecos = new Array();
	for (i = 0; i &lt; 8 ; i++) {
		this.ecos.push(String.fromCharCode(23 - i));
	}
	var spc = String.fromCharCode(31);
	
	var lines = [];
	for (var i = 0; i &lt; this._pageLength; i++) lines.push(&quot;&quot;);
	var point = 0;
	var p = player.ship;
	
	var colwidth = 31;
	if (list.length &gt; this._pageLength) colwidth = 15;
	if (list.length &gt; (this._pageLength * 2)) colwidth = 10.2;

	for (var i = 0; i &lt; list.length; i++) {
		if (isNaN(list[i])) {
			var sys = list[i];
		} else {
			var sys = System.infoForSystem(galaxyNumber, list[i]);
		}
		var item = sys.name + ((!sys.concealment || sys.concealment === 0) ? &quot; (&quot; + govs[sys.government] + spc + ecos[sys.economy] + spc + &quot;TL&quot; + (sys.techlevel + 1) + &quot;)&quot; : &quot;&quot;);

		lines[point] += this.$padTextRight(item, colwidth);
		point += 1;
		if (point === lines.length) point = 0;
	}
	var result = &quot;&quot;;
	for (var i = 0; i &lt; lines.length; i++) {
		result += lines[i] + &quot;\n&quot;;
	}
	return result;
}

//-------------------------------------------------------------------------------------------------------------
this.$getClosestSystemFromList = function $getClosestSystemFromList(planets) {
	var dist = 0;
	var min_dist = 200;
	var closest = -1;
	var maxlevel = this.$getMaxTechLevel();
	var chk = -1;
	for (var i = 0; i &lt; planets.length; i++) {
		if (isNaN(planets[i])) {
			chk = planets[i].systemID;
		} else {
			chk = planets[i];
		}
		var s = System.infoForSystem(galaxyNumber, chk);
		if (!s.concealment || s.concealment &lt;= 100) {
			var dist = this.$getDistanceToPlanet(chk);
			if (dist &lt; min_dist) {closest = chk; min_dist = dist;}
		}
	}
	return closest;
}

//-------------------------------------------------------------------------------------------------------------
this.$getRegionData = function $getRegionData() {
	var info = [];
	switch (galaxyNumber) {
		case 0:
			info = [{name:&quot;Xexedi Cluster&quot;, data:[43,101,141,250,197,140,48,37,58,64,188,111]},
					{name:&quot;Galcenter G1&quot;, data:[167,249,131,42,93,100,139,21,230,62]},
					{name:&quot;Teraed Region&quot;, data:[221,185,99,241,84,120,191,121,60]},
					{name:&quot;The Pulsar Worlds&quot;, data:[102,18,51,246,218,8,114,215,158,49]},
					{name:&quot;The Tortuga Expanse&quot;, data:[213,59,142,174,223,238]},
					{name:&quot;The Devil&#39;s Triangle&quot;, data:[20,148,181]},
					{name:&quot;The Iron Stars&quot;, data:[3,128,94,153,132,26,196,146,234]},
					{name:&quot;The Old Worlds&quot;, data:[129,255,55,46,147,7,39]}];
			break;
		case 1:
			info = [{name:&quot;The Qucedi Bottleneck&quot;, data:[159,111,157,16,139,34,248,205,59]},
					{name:&quot;The Equilibrium&quot;, data:[156,92,61]},
					{name:&quot;Redline Stars&quot;, data:[231,215,147,108,140,249,189,65,204]},
					{name:&quot;Kob&#39;s Ladder&quot;, data:[29,13,97,102,149,124,81,20,123]},
					{name:&quot;The Teonan Web&quot;, data:[32,42,26,114,202,55,142,50,69,18,36,146,251]},
					{name:&quot;Fiddler&#39;s Green&quot;, data:[10,2,224,172,70,120,181,76,104,7,194]},
					{name:&quot;The Zaedvera Pocket&quot;, data:[87,134,38,185,155,62,227,175,235,44,220,192]},
					{name:&quot;Galcenter G2&quot;, data:[242,91,167,115,178,113,226,57,94,19,33]},
					{name:&quot;The Citadel of Chaos&quot;, data:[100,229,37,5]},
					{name:&quot;The Fertile Cresent&quot;, data:[47,0,217,213,190,135,30,137,254,64,110,225]}];
			break;
		case 2:
			info = [{name:&quot;The Outer Reach&quot;, data:[100,18,149,62,201,223,52,145]},
					{name:&quot;The Prodigal Suns&quot;, data:[206,133]},
					{name:&quot;The Inner Reach&quot;, data:[54,161,185,118,121,186,232,165,129]},
					{name:&quot;The Sidewinder Expanse&quot;, data:[40,184,36,99,210,35,61,90,51]},
					{name:&quot;Galcenter G3&quot;, data:[234,49,239,22,228,175,110,140,5,56,177,150,26,58]},
					{name:&quot;The Starbridge Cluster&quot;, data:[192,207,134,244,60,107,173,215,64,119,168,114,227,19,205,94,88,101,241,82,236,32,46,248]},
					{name:&quot;The Yeon Pass&quot;, data:[170,231,127,45,27,108,247,199]}];
			break;
		case 3:
			info = [{name:&quot;Foundry&#39;s Reach&quot;, data:[184,86,163,116,230,167,94,36,159,12,57,65,35,55,228]},
					{name:&quot;The Unified Democratic Star League&quot;, data:[234,125,245,181,73,82,117,37,237,53,74,38]},
					{name:&quot;The Parallel Accord&quot;, data:[99,63,51,102,31,20,44,215,158,92,224,231,220,110,68,151,248,79,71,115]},
					{name:&quot;Galcenter G4&quot;, data:[222,65,137,144,101,45,105,148,95,49,34,10,54,30,119,103,241]}];
			break;
		case 4:
			info = [{name:&quot;The Gates of Damocles&quot;, data:[84,66,58,49,71,125,78,242]},
					{name:&quot;The Seige Worlds&quot;, data:[31,127,134,44,198,37,63,95,219]},
					{name:&quot;Galcenter G5&quot;, data:[3,47,111,181,231,35,122,180,102,24,19,69,156,60,1,230,112,28]},
					{name:&quot;Galcon Bombard&quot;, data:[151,86,133,123,36,98,223]},
					{name:&quot;The Steel Halo&quot;, data:[55,128,72,185,126,100,109]},
					{name:&quot;The Tetiri Conclave&quot;, data:[205,7,161,70,173,137,191,140]}];
			break;
		case 5:
			info = [{name:&quot;The Anener Commonwealth&quot;, data:[32,56,47,160,242,167,129,12]},
					{name:&quot;The Rabian Spur&quot;, data:[88,184,196,8,3,84,236,111,214]},
					{name:&quot;The Iron Alliance&quot;, data:[177,185,106,44,245,171,156,113,14,146,249,230,134,205,216,82]},
					{name:&quot;The Rimward Industrial Sector&quot;, data:[116,178,154,45,204,163,120,7,251,72,132,137,255,90,149,241,153,141,95,218,212,198]},
					{name:&quot;The Jaws of Cerberus&quot;, data:[121,203,31,30,74,126,234]},
					{name:&quot;The Isaanus Syndicate&quot;, data:[240,140,159,77,66,10,118,186,46]},
					{name:&quot;The Lost Worlds&quot;, data:[41,202,55,33]},
					{name:&quot;The Anenbian Confederacy&quot;, data:[172,208,201,87,168,2,39,246,83,42,35,65,114,224,23]},
					{name:&quot;The Raonbe Cluster&quot;, data:[22,98,53,229,248,139,16,102,130]},
					{name:&quot;The Centreward Industrial Sector&quot;, data:[37,75,127,6,189,89,17,1,161,250,147,67,60,138,252,155,233,225,86,254,71,0,58,210,69,4,223,144,19,206,150,194,182,5,200]},
					{name:&quot;Galcenter G6&quot;, data:[176,99,174,85,237,133,213,107,187,40,164,215,117,79,9,232,50,110,81,195,183]}];
			break;
		case 6:
			info = [{name:&quot;GALCOP Central Intelligence Sector&quot;, data:[18,234,117,49,1]},
					{name:&quot;The Isare Pact&quot;, data:[124,51,172,81,102,204]},
					{name:&quot;Galcenter G7&quot;, data:[215,111,181,41,39,65,44,236,150,193,247,202,72,37,179,133]},
					{name:&quot;The Kleptocratic Swathe&quot;, data:[187,77,53,100,240,107,174]},
					{name:&quot;The Rubicon Crossroad&quot;, data:[186,110,97,248,15,134]},
					{name:&quot;The Five Point Trade Barrier&quot;, data:[137,153,27,228,139]}];
			break;
		case 7:
			info = [{name:&quot;Beggars&#39; Loop&quot;, data:[242,170,87,115,150,62,240,186,34,196,185,11,253,166,132,90,134,160]},
					{name:&quot;The Ladle&quot;, data:[52,223,247,144,67]},
					{name:&quot;The Far Arm Star Cluster&quot;, data:[203,255,161,98,16,20,84,107]},
					{name:&quot;The Riven Hitachi Senate&quot;, data:[6,81,250,65,169,232,105,80,75,40,59,252,153,72,10,219,231,200,208,86]},
					{name:&quot;Galcenter G8&quot;, data:[135,73,193,120,127,7,102,184,172,177,210,70,130,123,38,175,23,233,39,168,64,104,41,125,45,110,201,241,154]},
					{name:&quot;The Unified Tech-Core&quot;, data:[216,13,147,137,9,211,88,171,2,215]}];
			break;
	}
	return info;
}

//-------------------------------------------------------------------------------------------------------------
// loads the spacelane array with data for the current galaxy
this.$getSpacelanes = function $getSpacelanes() {
	var data = [];
	switch (galaxyNumber) {
		case 0:
			data = [{name:&quot;Spaceway L1&quot;, color:&quot;0.0 1.0 1.0 0.5&quot;, data:[141,250,111,186,50,73,35,188,250]},
					{name:&quot;Spaceway L2&quot;, color:&quot;1.0 1.0 0.0 0.5&quot;, data:[7,129,227,73,89,222,29,93,42,131]},
					{name:&quot;Spaceway L3&quot;, color:&quot;whiteColor&quot;, data:[131,62,150,198,36,28,16,221,99]},
					{name:&quot;Spaceway L4&quot;, color:&quot;0.824 0.412 0.118 1.0&quot;, data:[99,241,86,126,18,246]}];
			break;
		case 1:
			data = [{name:&quot;Spaceway L1&quot;, color:&quot;0.0 1.0 1.0 0.5&quot;, data:[82,23,188,23,54,74,122,57,115,178,45]},
					{name:&quot;Spaceway L2&quot;, color:&quot;redColor&quot;, data:[45,144,189,140,65,48,204,193,221,236,66,58,88,127]},
					{name:&quot;Spaceway L3&quot;, color:&quot;1.0 1.0 0.0 0.5&quot;, data:[127,109,42,114,202]},
					{name:&quot;The Tomoka Run&quot;, color:&quot;greenColor&quot;, data:[127,207,136,6,24,53,78,48]},
					{name:&quot;The Maorin Pass&quot;, color:&quot;whiteColor&quot;, data:[205,59,100,9,156,92,61,41,179,189]},
					{name:&quot;Erlage Corridor &#39;Butchers Row&#39;&quot;, color:&quot;0.824 0.412 0.118 1.0&quot;, data:[113,115,57,94,29]}];
			break;
		case 2:
			data = [{name:&quot;Spaceway L1&quot;, color:&quot;0.0 1.0 1.0 0.5&quot;, data:[38,182,246,91,22,140,5,56,177,150,26,75,144,209,17,218]},
					{name:&quot;Spaceway L2&quot;, color:&quot;redColor&quot;, data:[50,65,79,154,38,139,189,135,42]},
					{name:&quot;Triskelion Conduit&quot;, color:&quot;whiteColor&quot;, data:[205,241,101,132,6,180,164,70,10,85,81,225,81,85,10,70,202,53]},
					{name:&quot;Chancers Alley&quot;, color:&quot;0.824 0.412 0.118 1.0&quot;, data:[140,58,152,76,77,97,168]},
					{name:&quot;Glasnost Corridor&quot;, color:&quot;greenColor&quot;, data:[106,250,245,160,245,22]},
					{name:&quot;Broken Circle&quot;, color:&quot;1.0 1.0 0.0 0.5&quot;, data:[118,161,54,165,129,186]}];
			break;
		case 3:
			data = [{name:&quot;Sunspan Pass&quot;, color:&quot;greenColor&quot;, data:[116,230,167,48,210,36,150,84,240,193,223,118,197,135,85,154,213,162,166,213]},
					{name:&quot;Sanctuary&#39;s Way&quot;, color:&quot;0.0 1.0 1.0 0.5&quot;, data:[16,42,172,40,80,65,144,105,119,208,189,1,174,146,100,233]},
					{name:&quot;Spaceway L1&quot;, color:&quot;0.824 0.412 0.118 1.0&quot;, data:[50,239,103,108,103,177,17,177,103,45,105,137,95,54,77,76,21,2,249,113,141,113,97]},
					{name:&quot;Supply Line 1 &#39;Freedom&#39;&quot;, color:&quot;whiteColor&quot;, data:[209,33,62,25,134,58,138,191,78,57,242,234,245,181,82,117,53,74,38]},
					{name:&quot;Supply Line 2 &#39;Unity&#39;&quot;, color:&quot;1.0 1.0 0.0 0.5&quot;, data:[71,79,68,110,220,158,215,63,44,66,146,174,1,4,121,145,142,6,142,11,7,161,140]},
					{name:&quot;The Esonlear Cakewalk&quot;, color:&quot;redColor&quot;, data:[7,32,232,216,60]}];
			break;
		case 4:
			data = [{name:&quot;Spaceway L1&quot;, color:&quot;0.824 0.412 0.118 1.0&quot;, data:[41,216,112,230,28,102,181,35,180,24,19,156,1,45,79,172,169]},
					{name:&quot;Spaceway L2&quot;, color:&quot;whiteColor&quot;, data:[140,137,173,70,7,253,243,135,193,225,184,150,115,201,189,227,226,221,57,202,135,202,57,221,226,227,189,115,11,54,158,175,85,178,204,12,215,212,158]},
					{name:&quot;Spaceway L3 &#39;The Great Wheel&#39;&quot;, color:&quot;greenColor&quot;, data:[194,8,210,41,222,183,254,149,130,108,82,92,29,121,34,183]},
					{name:&quot;The Lesser Wheel&quot;, color:&quot;redColor&quot;, data:[114,118,2,116,244,248,65,146,153,10,99,91,200,244]},
					{name:&quot;The Extrinsic Reach&quot;, color:&quot;blueColor&quot;, data:[120,9,233,104,136,129,139,163,61]},
					{name:&quot;The Serenic Arc&quot;, color:&quot;1.0 1.0 0.0 0.5&quot;, data:[249,16,20,39,93,207,131,74,182,252,188,40,146,153,146,40,188,252,182,166,53,221,220,225]},
					{name:&quot;The Zalexe Loop&quot;, color:&quot;0.0 1.0 1.0 0.5&quot;, data:[30,89,87,89,152,170,88,194,77,246,106,190,208,167]}];
			break;
		case 5:
			data = [{name:&quot;Spaceway L1&quot;, color:&quot;0.824 0.412 0.118 1.0&quot;, data:[84,3,8,88,206,136,144,13,92,99,85,133,40,215,115,83,246,39,35,114]},
					{name:&quot;Spaceway L2&quot;, color:&quot;1.0 1.0 0.0 0.5&quot;, data:[169,51,80,103,243,98,102,16,109,101,67,142,60,209,233,112,225,131,210,12,150,91]},
					{name:&quot;The Centreward Span&quot;, color:&quot;whiteColor&quot;, data:[104,54,162,148,211,6,181,17,108,28]},
					{name:&quot;The Rimward Arc&quot;, color:&quot;0.0 1.0 1.0 0.5&quot;, data:[156,113,14,216,82,177,116,154,120,50,232,124,215]},
					{name:&quot;Remlock Road&quot;, color:&quot;redColor&quot;, data:[10,77,159,226,31,203,30,234,240,234,140,159]}];
			break;
		case 6:
			data = [{name:&quot;Spaceway L1&quot;, color:&quot;0.0 1.0 1.0 0.5&quot;, data:[103,58,253,65,39,44,236,150,247,193,179,133,215,95,109]},
					{name:&quot;The Road&quot;, color:&quot;whiteColor&quot;, data:[194,73,146,239,86,74,199,23,138,18,234,244,166,152,162,242,184]},
					{name:&quot;Far Rift Reach&quot;, color:&quot;0.824 0.412 0.118 1.0&quot;, data:[218,130,125,205,79,191,17,178]},
					{name:&quot;The Isisian Detour&quot;, color:&quot;1.0 1.0 0.0 0.5&quot;, data:[211,7,163,67,209,250,19,239]},
					{name:&quot;The Quandixe Connection&quot;, color:&quot;redColor&quot;, data:[46,36,212,187,53,107,174]}];
			break;
		case 7:
			data = [{name:&quot;Spaceway L1 &#39;The Nemorican Arc&#39;&quot;, color:&quot;whiteColor&quot;, data:[114,12,241,39,23,38,123,130,167,63,136,8,44,91,56,62,186,93,32,61,244,243,116,46,157,230,151,213,198,148,49,76,203,255,161,98,53,1,145,33]},
					{name:&quot;Spaceway L2&quot;, color:&quot;0.0 1.0 1.0 0.5&quot;, data:[215,2,211,9,13,147,216,225,21,218,71,206,236,190,18,26,152,51,209,24,174,82,179,173,30,251,233,125,45,41,104,110,73,135,117,55]},
					{name:&quot;Centreward Flight&quot;, color:&quot;1.0 1.0 0.0 0.5&quot;, data:[126,6,81,65,169,232,252]},
					{name:&quot;The Hitachi Trade Annex&quot;, color:&quot;0.824 0.412 0.118 1.0&quot;, data:[75,219,248,117]},
					{name:&quot;Rimward Decamp&quot;, color:&quot;redColor&quot;, data:[10,72,219,248,117]}];
			break;
	}
	return data;
}

//-------------------------------------------------------------------------------------------------------------
// returns true if a HUD with allowBigGUI is enabled, otherwise false
this.$isBigGuiActive = function $isBigGuiActive() {
	if (oolite.compareVersion(&quot;1.83&quot;) &lt;= 0) {
		return player.ship.hudAllowsBigGui;
	} else {
		var bigGuiHUD = [&quot;XenonHUD.plist&quot;, &quot;coluber_hud_ch01-dock.plist&quot;]; 	// until there is a property we can check, I&#39;ll be listing HUD&#39;s that have the allow_big_gui property set here
		if (bigGuiHUD.indexOf(player.ship.hud) &gt;= 0) {
			return true;
		} else {
			return false;
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
// turns off any explorer club markers
this.$hideExplorersClub = function $hideExplorersClub() {
	for (var i = 0; i &lt; 256; i++) {
		mission.unmarkSystem({system:i, name:&quot;exclubmap&quot;});
	}
}

//-------------------------------------------------------------------------------------------------------------
// turns off any smugglers markers
this.$hideSmugglers = function $hideSmugglers() {
	var w = worldScripts.Smugglers_Illegal;
	// clear out existing marks
	for (var i = 0; i &lt; w._markedSystems.length; i++) {
		mission.unmarkSystem({system:w._markedSystems[i], name:&quot;illegalgoods&quot;});
	}

	// reset the array
	w._markedSystems = [];
}

//-------------------------------------------------------------------------------------------------------------
// removes any region, lane or planetary markers from the chart
this.$removeChartData = function $removeChartData() {
	for (var i = 0; i &lt; this._markedRegions.length; i++) {
		SystemInfo.setInterstellarProperty(galaxyNumber, this._markedRegions[i].id1, this._markedRegions[i].id2, 2, &quot;link_color&quot;, &quot;galreg_region&quot;);
	}
	this._markedRegions = [];
	for (var i = 0; i &lt; this._markedPlanets.length; i++) {
		mission.unmarkSystem({system:this._markedPlanets[i], name:&quot;galreg_marked&quot;});
	}
	if (this._spaceLaneStart &gt;= 0) mission.unmarkSystem({system:this._spaceLaneStart, name:&quot;galreg_marked&quot;});
	if (this._spaceLaneEnd &gt;= 0) mission.unmarkSystem({system:this._spaceLaneEnd, name:&quot;galreg_marked&quot;});
	this._spaceLaneStart = -1;
	this._spaceLaneEnd = -1;
	this._markedPlanets = [];
	this.$reapplyPermanentInfo();
}

//-------------------------------------------------------------------------------------------------------------
this.$reapplyPermanentInfo = function $reapplyPermanentInfo() {
	var i = 0;
	var j = 0;
	var k = 0;
	if (this._permanentChartData) {
		if (this._permanentChartData.regions &amp;&amp; this._permanentChartData.regions.length &gt; 0) {
			var regions = this._permanentChartData.regions;
			for (i = 0; i &lt; regions.length; i++) {
				if (regions[i].systemIDList &amp;&amp; regions[i].systemIDList.length &gt; 0) {
					var dta = regions[i].systemIDList;
					for (j = 0; j &lt; dta.length; j++) {
						for (k = 0; k &lt; dta.length; k++) {
							if (j != k &amp;&amp; dta[j] &lt; dta[k]) {
								SystemInfo.setInterstellarProperty(galaxyNumber, dta[j], dta[k], 2, &quot;link_color&quot;, regions[i].linkColor, &quot;galreg_region&quot;);
							}
						}
					}
				}
			}
		}
		if (this._permanentChartData.paths &amp;&amp; this._permanentChartData.paths.length &gt; 0) {
			var paths = this._permanentChartData.paths;
			for (i = 0; i &lt; paths.length; i++) {
				var colr = paths[i].linkColor;
				var planets = paths[i].systemIDList;
				for (var j = 0; j &lt; planets.length - 1; j++) {
					var s1 = System.infoForSystem(galaxyNumber, planets[j]);
					var c1 = s1.concealment;
					if (!c1) c1 = 0;
					var s2 = System.infoForSystem(galaxyNumber, planets[j + 1]);
					var c2 = s2.concealment;
					if (!c2) c2 = 0;
					if (c1 &lt;= 100 &amp;&amp; c2 &lt;= 100 &amp;&amp; s1.distanceToSystem(s2) &lt;= 7) {
						if (planets[j] &lt; planets[j + 1]) {
							SystemInfo.setInterstellarProperty(galaxyNumber, planets[j], planets[j + 1], 2, &quot;link_color&quot;, colr, &quot;galreg_region&quot;);
							this._markedRegions.push({id1:planets[j], id2:planets[j + 1]});
						} else {
							SystemInfo.setInterstellarProperty(galaxyNumber, planets[j + 1], planets[j], 2, &quot;link_color&quot;, colr, &quot;galreg_region&quot;);
							this._markedRegions.push({id1:planets[j + 1], id2:planets[j]});
						}
					}
				}
			}
		}
		if (this._permanentChartData.systems &amp;&amp; this._permanentChartData.systems.length &gt; 0) {
			var syslist = this._permanentChartData.systems;
			for (i = 0; i &lt; syslist.length; i++) {
				if (syslist[i].systemIDList &amp;&amp; syslist[i].systemIDList.length &gt; 0) {
					var dta = syslist[i].systemIDList;
					for (j = 0; j &lt; dta.length; j++) {
						mission.markSystem({system:dta[j], name:&quot;galreg_marked&quot;, markerShape:syslist[i].markerShape, markerColor:syslist[i].markerColor, markerScale:syslist[i].markerScale});
					}
				}
			}
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
// gets the maximum techlevel for the sector
this.$getMaxTechLevel = function $getMaxTechLevel() {
	var tl = 0;
	for (var i = 0; i &lt;= 255; i++) {
		var info = System.infoForSystem(galaxyNumber, i);
		if (info.techlevel &gt; tl) tl = info.techlevel;
	}
	return tl;
}

//-------------------------------------------------------------------------------------------------------------
// returns a list of planets of a particular government type (0-7)
this.$getSystemsByGovernment = function $getSystemsByGovernment(govType) {
	var govs = SystemInfo.filteredSystems(this, function(other) {
		return (other.government === govType &amp;&amp; (!other.concealment || other.concealment === 0));
	});
	var list = [];
	for (var i = 0; i &lt; govs.length; i++) {
		list.push(govs[i].systemID);
	}
	return list;	
}

//-------------------------------------------------------------------------------------------------------------
// returns a list of planets of a particular techlevel
this.$getSystemsByTechLevel = function $getSystemsByTechLevel(techLevel) {
	var tl = SystemInfo.filteredSystems(this, function(other) {
		return (other.techlevel === techLevel &amp;&amp; (!other.concealment || other.concealment === 0));
	});
	var list = [];
	for (var i = 0; i &lt; tl.length; i++) {
		list.push(tl[i].systemID);
	}
	return list;	
}

//-------------------------------------------------------------------------------------------------------------
// returns a list of planets of a particular economy
this.$getSystemsByEconomy = function $getSystemsByEconomy(economy) {
	var ecos = SystemInfo.filteredSystems(this, function(other) {
		return (other.economy === economy &amp;&amp; (!other.concealment || other.concealment === 0));
	});
	var list = [];
	for (var i = 0; i &lt; ecos.length; i++) {
		list.push(ecos[i].systemID);
	}
	return list;	
}

//-------------------------------------------------------------------------------------------------------------
this.$governmentDescription = function $governmentDescription(gov) {
	switch (gov) {
		case 0: return &quot;Anarchy&quot;;
		case 1: return &quot;Feudal&quot;;
		case 2: return &quot;Multi-Government&quot;;
		case 3: return &quot;Dictatorship&quot;;
		case 4: return &quot;Communist&quot;;
		case 5: return &quot;Confederacy&quot;;
		case 6: return &quot;Democracy&quot;;
		case 7: return &quot;Corporate State&quot;;
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$governmentDescriptionPlural = function $governmentDescriptionPlural(gov) {
	if (gov === &quot;??&quot;) return &quot;??&quot;;
	switch (gov) {
		case 0: return &quot;Anarchies&quot;;
		case 1: return &quot;Feudals&quot;;
		case 2: return &quot;Multi-Governments&quot;;
		case 3: return &quot;Dictatorships&quot;;
		case 4: return &quot;Communists&quot;;
		case 5: return &quot;Confederacies&quot;;
		case 6: return &quot;Democracies&quot;;
		case 7: return &quot;Corporate States&quot;;
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$economyDescription = function $economyDescription(eco) {
	if (eco === &quot;??&quot;) return &quot;??&quot;;
	if (worldScripts[&quot;market_tweak.js&quot;]) {
		switch (eco) {
			case 0: return &quot;Extreme Industrial&quot;;
			case 1: return &quot;Strong Industrial&quot;;
			case 2: return &quot;Common Industrial&quot;;
			case 3: return &quot;Mainly Industrial&quot;;
			case 4: return &quot;Mainly Agricultural&quot;;
			case 5: return &quot;Common Agricultural&quot;;
			case 6: return &quot;Strong Agricultural&quot;;
			case 7: return &quot;Extreme Agricultural&quot;;
		}
	} else {
		switch (eco) {
			case 0: return &quot;Rich Industrial&quot;;
			case 1: return &quot;Average Industrial&quot;;
			case 2: return &quot;Poor Industrial&quot;;
			case 3: return &quot;Mainly Industrial&quot;;
			case 4: return &quot;Mainly Agricultural&quot;;
			case 5: return &quot;Rich Agricultural&quot;;
			case 6: return &quot;Average Agricultural&quot;;
			case 7: return &quot;Poor Agricultural&quot;;
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
// returns planet ID for galcop HQ (returned as an array)
this.$galCopHQSystem = function $galCopHQSystem() {
	var galCopHQ = [7, 33, 26, 49, 102, 85, 202, 184];			// galcop hq locations in each sector
	return [galCopHQ[galaxyNumber]];
}

//-------------------------------------------------------------------------------------------------------------
// returns list of planet ID&#39;s where gal navy sector commands reside
this.$galNavySectorCommands = function $galNavySectorCommands() {
	var data = new Array
	switch(galaxyNumber){
		case 0:
			data = new Array(24, 193, 154, 188, 125, 109, 249, 150, 80, 175, 120, 220, 158, 15);
			break;
		case 1:
			data = new Array(248, 135, 106, 82, 150, 182, 33, 48, 227, 96, 127, 202, 243, 170);
			break;
		case 2:
			data = new Array(31, 165, 245, 84, 36, 21, 26, 139, 251, 205, 223, 204, 17, 247);
			break;
		case 3:
			data = new Array(39, 221, 188, 86, 9, 57, 186, 237, 49, 103, 254, 66, 140, 110);
			break;
		case 4:
			data = new Array(249, 71, 57, 144, 198, 153, 204, 73, 102, 222, 29, 233, 152, 190);
			break;
		case 5:
			data = new Array(151, 227, 6, 51, 60, 129, 8, 53, 85, 120, 208, 220, 146, 66);
			break;
		case 6:
			data = new Array(214, 161, 250, 127, 23, 154, 234, 24, 55, 64, 231, 140, 202, 35);
			break;
		case 7:
			data = new Array(26, 218, 9, 174, 156, 251, 75, 136, 184, 87, 212, 116, 98, 55);
			break;
	}
	return data;
}

//-------------------------------------------------------------------------------------------------------------
// returns the distance to a particular planet
this.$getDistanceToPlanet = function $getDistanceToPlanet(sysID) {
	if (sysID &lt; 0 || sysID &gt; 255) return 0;
	var dist = 200;
	var route = System.infoForSystem(galaxyNumber, system.ID).routeToSystem(System.infoForSystem(galaxyNumber, sysID), &quot;OPTIMIZED_BY_JUMPS&quot;);
	if (route) dist = route.distance;
	return dist;
}

//-------------------------------------------------------------------------------------------------------------
// appends space to currentText to the specified length in &#39;em&#39;
this.$padTextRight = function $padTextRight(currentText, desiredLength, leftSwitch) {
	if (currentText == null) currentText = &quot;&quot;;
	var hairSpace = String.fromCharCode(31);
	var ellip = &quot;…&quot;;
	var currentLength = defaultFont.measureString(currentText);
	var hairSpaceLength = defaultFont.measureString(hairSpace);
	// calculate number needed to fill remaining length
	var padsNeeded = Math.floor((desiredLength - currentLength) / hairSpaceLength);
	if (padsNeeded &lt; 1)	{
		// text is too long for column, so start pulling characters off
		var tmp = currentText;
		do {
			tmp = tmp.substring(0, tmp.length - 2) + ellip;
			if (tmp === ellip) break;
		} while (defaultFont.measureString(tmp) &gt; desiredLength);
		currentLength = defaultFont.measureString(tmp);
		padsNeeded = Math.floor((desiredLength - currentLength) / hairSpaceLength);
		currentText = tmp;
	}
	// quick way of generating a repeated string of that number
	if (!leftSwitch || leftSwitch === false) {
		return currentText + new Array(padsNeeded).join(hairSpace);
	} else {
		return new Array(padsNeeded).join(hairSpace) + currentText;
	}
}

//-------------------------------------------------------------------------------------------------------------
// appends space to currentText to the specified length in &#39;em&#39;
this.$padTextLeft = function $padTextLeft(currentText, desiredLength) {
	return this.$padTextRight(currentText, desiredLength, true);
}

//-------------------------------------------------------------------------------------------------------------
this.$getSystemData = function $getSystemData(sysID) {
	var sys = System.infoForSystem(galaxyNumber, sysID);
    var data = {};
	if (!sys.concealment || sys.concealment === 0) { 
		data[&quot;name&quot;] = sys.name;
		data[&quot;economy&quot;] = sys.economy;
		data[&quot;government&quot;] = sys.government;
		data[&quot;techLevel&quot;] = sys.techlevel;
		data[&quot;population&quot;] = expandDescription(&quot;[sysdata-pop-value]&quot;, {population:sys.population});
		data[&quot;inhabitants&quot;] = sys.inhabitants;
		data[&quot;productivity&quot;] = sys.productivity;
		data[&quot;radius&quot;] = sys.radius;
	} else {
		data[&quot;name&quot;] = sys.name;
		data[&quot;economy&quot;] = &quot;??&quot;;
		data[&quot;government&quot;] = &quot;??&quot;;
		data[&quot;techLevel&quot;] = &quot;??&quot;;
		data[&quot;population&quot;] = &quot;??&quot;;
		data[&quot;inhabitants&quot;] = &quot;??&quot;;
		data[&quot;productivity&quot;] = &quot;??&quot;;
		data[&quot;radius&quot;] = &quot;??&quot;;
	}
    return data;
}

//-------------------------------------------------------------------------------------------------------------
// returns a list of sysInfos which match search criteria
this.$searchSystems = function $searchSystems() {
	this._searchMax = false;

	var list = SystemInfo.filteredSystems(this, function(other) { 
		var result = false; // set initial value to false, so if we fail the concealment check, the result will be false
		if (!other.concealment || other.concealment === 0) {
			result = true; // but now we&#39;re going to assume a true result, and look for reasons to fail it.
			var w = worldScripts.GalacticRegistry._search
			var desc = other.description.toLowerCase();
			var govd = this.$governmentDescription(other.government).toLowerCase();
			var ecod = this.$economyDescription(other.economy).toLowerCase();
			var inhd = other.inhabitants.toLowerCase();
			for (var i = 0; i &lt; w.length; i++) {
				var or_w = null;
				var word = w[i];
				var or_loop = 0;
				var or_check = true;
				var check = false;
				// check for the or &quot;|&quot; switch
				if (word.indexOf(&quot;|&quot;) &gt;= 0) {
					or_w = word.toLowerCase().split(&quot;|&quot;);
					word = or_w[or_loop];
				}
				do {
					if (desc.indexOf(word) &gt;= 0) check = true;
					if (govd.indexOf(word) &gt;= 0) check = true;
					if (ecod.indexOf(word) &gt;= 0) check = true;
					if (inhd.indexOf(word) &gt;= 0) check = true;
					if (word.indexOf(&quot;tl&quot;) == 0) {
						// first check for a straight 1-1 test (eg tl8)
						if (word + &quot; &quot; == &quot;tl&quot; + (other.techlevel + 1).toString() + &quot; &quot;) check = true;
						// if that fails, lets do the +/- checks
						if (check == false) {
							var checkTL = 0;
							var dir = 0;
							// parse the input to get an integer version of the request TL and the direction we&#39;ll be testing
							if (word.indexOf(&quot;+&quot;) &gt; 0) {checkTL = parseInt(word.substring(2, word.indexOf(&quot;+&quot;)), 10); dir = 1;}
							if (word.indexOf(&quot;-&quot;) &gt; 0) {checkTL = parseInt(word.substring(2, word.indexOf(&quot;-&quot;)), 10); dir = -1;}
							if (checkTL &gt; 0) {
								if (dir == 1 &amp;&amp; (other.techlevel + 1) &gt;= checkTL) check = true;
								if (dir == -1 &amp;&amp; (other.techlevel + 1) &lt;= checkTL) check = true;
							}
						}
					} 
					if (or_w) {
						or_loop ++;
						if (or_loop &gt; or_w.length - 1) {
							or_check = false;
						} else {
							word = or_w[or_loop];
						}
					} else {
						or_check = false;
					}
				} while (or_check == true);
				if (check == false) result = check;
			}
		}
		return result;
	});
	if (list.length &gt; (this._pageLength * 3)) {
		this._searchMax = true;
		for (var i = list.length - 1; i &gt;= (this._pageLength * 3); i--) {
			list.splice(i, 1);
		}
	}
	return list;
}

//-------------------------------------------------------------------------------------------------------------
// returns true if &quot;id&quot; is one of the current permanent regions, otherwise false
this.$checkPermanentRegions = function $checkPermanentRegions(id) {
	if (!this._permanentChartData || !this._permanentChartData.regions) return false;
	var regions = this._permanentChartData.regions;
	for (var i = 0; i &lt; regions.length; i++) {
		if (regions[i].id === id) return true;
	}
	return false;
}

//-------------------------------------------------------------------------------------------------------------
// removes a region from the permanent list
this.$removePermanentRegion = function $removePermanentRegion(id) {
	if (!this._permanentChartData || !this._permanentChartData.regions) return;
	var regions = this._permanentChartData.regions;
	for (var i = 0; i &lt; regions.length; i++) {
		if (regions[i].id === id) {
			var dta = regions[i].systemIDList;
			for (var j = 0; j &lt; dta.length; j++) {
				for (var k = 0; k &lt; dta.length; k++) {
					if (j != k &amp;&amp; dta[j] &lt; dta[k]) {
						SystemInfo.setInterstellarProperty(galaxyNumber, dta[j], dta[k], 2, &quot;link_color&quot;, &quot;galreg_region&quot;);
					}
				}
			}
			regions.splice(i, 1);
			return;
		};
	}
}

//-------------------------------------------------------------------------------------------------------------
// returns true if &quot;id&quot; is one of the current permanent paths, otherwise false
this.$checkPermanentPaths = function $checkPermanentPaths(id) {
	if (!this._permanentChartData || !this._permanentChartData.paths) return false;
	var paths = this._permanentChartData.paths;
	for (var i = 0; i &lt; paths.length; i++) {
		if (paths[i].id === id) return true;
	}
	return false;
}

//-------------------------------------------------------------------------------------------------------------
// removes a region from the permanent list
this.$removePermanentPath = function $removePermanentPath(id) {
	if (!this._permanentChartData || !this._permanentChartData.paths) return;
	var paths = this._permanentChartData.paths;
	for (var i = 0; i &lt; paths.length; i++) {
		if (paths[i].id === id) {
			var dta = paths[i].systemIDList;
			for (var j = 0; j &lt; dta.length; j++) {
				for (var k = 0; k &lt; dta.length; k++) {
					if (j != k &amp;&amp; dta[j] &lt; dta[k]) {
						SystemInfo.setInterstellarProperty(galaxyNumber, dta[j], dta[k], 2, &quot;link_color&quot;, &quot;galreg_region&quot;);
					}
				}
			}
			paths.splice(i, 1);
			return;
		};
	}
}

//-------------------------------------------------------------------------------------------------------------
// returns true if &quot;id&quot; is one of the current permanent systems, otherwise false
this.$checkPermanentSystems = function $checkPermanentSystems(id) {
	if (!this._permanentChartData || !this._permanentChartData.systems) return false;
	var syslist = this._permanentChartData.systems;
	for (var i = 0; i &lt; syslist.length; i++) {
		if (syslist[i].id === id) return true;
	}
	return false;
}

//-------------------------------------------------------------------------------------------------------------
// removes a list of systems from the permanent list
this.$removePermanentSystems = function $removePermanentSystems(id) {
	if (!this._permanentChartData || !this._permanentChartData.systems) return;
	var syslist = this._permanentChartData.systems;
	for (var i = syslist.length - 1; i &gt;= 0; i--) {
		if (syslist[i].id === id) {
			var dta = syslist[i].systemIDList;
			for (var j = 0; j &lt; dta.length; j++) {
				mission.unmarkSystem({system:dta[j], name:&quot;galreg_marked&quot;});
			}
			syslist.splice(i, 1);
		};
	}
}

//-------------------------------------------------------------------------------------------------------------
// removes any stored historic permanent markers/properties
this.$removeHistoricPermanentMarkers = function $removeHistoricPermanentMarkers() {
	// remove an permanent markings
	var i = 0;
	var j = 0;
	var k = 0;
	if (this._permanentRegions.length &gt; 0) {
		var regions = this.$getRegionData();
		for (i = 0; i &lt; this._permanentRegions.length; i++) {
			var dta = regions[this._permanentRegions[i]].data;
			for (j = 0; j &lt; dta.length; j++) {
				for (k = 0; k &lt; dta.length; k++) {
					if (j != k &amp;&amp; dta[j] &lt; dta[k]) {
						SystemInfo.setInterstellarProperty(galaxyNumber, dta[j], dta[k], 2, &quot;link_color&quot;, &quot;galreg_region&quot;);
					}
				}
			}
		}
	}
	if (this._permanentLanes.length &gt; 0) {
		var lanes = this.$getSpacelanes();
		for (i = 0; i &lt; this._permanentLanes.length; i++) {
			var lane = lanes[this._permanentLanes[i]];
			var dta = lane.data;
			for (j = 0; j &lt; dta.length - 1; j++) {
				var c1 = System.infoForSystem(galaxyNumber, dta[j]).concealment;
				if (!c1) c1 = 0;
				var c2 = System.infoForSystem(galaxyNumber, dta[j + 1]).concealment;
				if (!c2) c2 = 0;
				if (c1 &lt;= 100 &amp;&amp; c2 &lt;= 100) {
					if (dta[j] &lt; dta[j + 1]) {
						SystemInfo.setInterstellarProperty(galaxyNumber, dta[j], dta[j + 1], 2, &quot;link_color&quot;, &quot;galreg_region&quot;);
					} else {
						SystemInfo.setInterstellarProperty(galaxyNumber, dta[j + 1], dta[j], 2, &quot;link_color&quot;, &quot;galreg_region&quot;);
					}
				}
			}
		}
		for (var i = mission.markedSystems.length - 1; i &gt;= 0; i--) {
			if (mission.markedSystems[i].name.indexOf(this.name) &gt;= 0 || mission.markedSystems[i].name.indexOf(&quot;galreg_marked&quot;) &gt;= 0) 
				mission.unmarkSystem({system:mission.markedSystems[i].system, name:mission.markedSystems[i].name});
		}
	}
	this._permanentRegions.length = 0;
	this._permanentLanes.length = 0;
	delete this._permanentRegions;
	delete this._permanentLanes;
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/galactic_registry_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;GalacticRegistry_Conditions&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2015 phkb&quot;;
this.description = &quot;Condition script for Galactic Registry equipment&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;

//-------------------------------------------------------------------------------------------------------------
this.allowAwardEquipment = function(equipment, ship, context) {
	if (context == &quot;scripted&quot;) return true;
	return false;
}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
