<html>
    <head>
        <title>Expansion SniperLock Fix</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion SniperLock Fix</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Required Expansions mismatch between OXP Manifest and Expansion Manager at character position 0070 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Fixes a compatibility problem between SniperLock and Telescope.</td>
                    <td>Fixes a compatibility problem between SniperLock and Telescope.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.dybal.SniperLock_Fix</td>
                    <td>oolite.oxp.dybal.SniperLock_Fix</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>SniperLock Fix</td>
                    <td>SniperLock Fix</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Dybal</td>
                    <td>Dybal</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.0</td>
                    <td>1.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.CommonSenseOTB.SniperLock:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.CommonSenseOTB.SniperLock:</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/7/7c/SniperLock_Fix-1.0.oxz">https://wiki.alioth.net/img_auth.php/7/7c/SniperLock_Fix-1.0.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873343</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/SniperLock%20Fix'>http://wiki.alioth.net/index.php/SniperLock%20Fix</a></p>
        <h3>Readme.txt</h3>
        <pre>SniperLock Fix
--------------
v1.0, by Dybal

SniperLock Fix, as the name suggests, fixes a icompatibility problem in SniperLock.

The problem caused travel direction reversal while using Torus Drive if SniperLock was locked on a farway target through Telescope.

Since SniperLock&#39;s license includes the &quot;Thargoid clauses&quot;, which restrict CC BY-NC-SA 3.0 so the code can be re-used (if id collisions were avoided) but the original OXP can&#39;t be modified, it was necessary to create this OXP to wrap the SniperLock function and only call it when it&#39;s safe.

License
-------

CC-BY-NC-SA 4.0 - Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International
(https://creativecommons.org/licenses/by-nc-sa/4.0/)

</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;sniperlock_fix&quot;;
this.author         = &quot;Dybal&quot;;
this.copyright      = &quot;2020 Dybal&quot;;
this.license        = &quot;CC-BY-NC-SA 4.0&quot;;
this.description    = &quot;Fixes a bug in SniperLock&quot;;
this.version        = &quot;1.0&quot;;


//
// Event Handlers
//

//------------------------------------------------------------------------------------------//
this.startUp = function _sniperlockFix_startUp() {
    var ws = worldScripts.sniperlock;
    if (ws &amp;&amp; ws.sniperLock) {
        log(this.name, &quot;Wrapping SniperLock&#39;s sniperLock function&quot;);
        ws.$sniperlockFix_saved_sniperLock = ws.sniperLock;
        ws.sniperLock = this.$FCB_Wrap;
        ws.$lastOK = true;
    }
}


//
// Internal Functions
//

//------------------------------------------------------------------------------------------//
this.$FCB_Wrap = function _sniperlockFix_FCB_Wrap(delta) {
    var that = _sniperlockFix_FCB_Wrap;
    var ws = (that.ws = that.ws || worldScripts.sniperlock);
    var sniperLock = (that.sniperLock || ws.$sniperlockFix_saved_sniperLock);
    var reset = (that.reset = that.reset || ws.shipTargetAcquired);
    var pship = player.ship;

    if (!sniperLock || !pship.target) return;
    if (pship.speed &gt; pship.maxSpeed &amp;&amp; pship.target.dataKey === &quot;telescopemarker&quot;) {
        if (ws.$lastOK) {
            // resets to clean the stored target positions
            // avoids using old target positions when sniperlock resumes
            log(this.name, &quot;resetting SniperLock&quot;);
            reset.call(ws);
        }
        ws.$lastOK = false;
    } else {
        sniperLock.call(ws, delta);
        ws.$lastOK = true;
    }
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
