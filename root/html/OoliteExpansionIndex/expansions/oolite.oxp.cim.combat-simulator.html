<html>
    <head>
        <title>Expansion Combat Simulator</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Combat Simulator</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">10 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds a combat simulator to the interfaces screen of some high-tech stations where you can set up controlled battles against particular opponents. Requires Ship Storage Helper.</td>
                    <td>Adds a combat simulator to the interfaces screen of some high-tech stations where you can set up controlled battles against particular opponents. Requires Ship Storage Helper.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.cim.combat-simulator</td>
                    <td>oolite.oxp.cim.combat-simulator</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Combat Simulator</td>
                    <td>Combat Simulator</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Activities</td>
                    <td>Activities</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>cim</td>
                    <td>cim</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.1</td>
                    <td>1.1</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.CaptMurphy.ShipStorageHelper:0.21</li>
                    </td>
                    <td>
                            <li>oolite.oxp.CaptMurphy.ShipStorageHelper:0.21</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Combat_Simulator_OXP">http://wiki.alioth.net/index.php/Combat_Simulator_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://cim.sotl.org.uk/games/files/oolite/Combat_Simulator_1.1.oxz">https://cim.sotl.org.uk/games/files/oolite/Combat_Simulator_1.1.oxz</a></td>
                    <td><a target="_blank" href="http://compsoc.dur.ac.uk/~cim/oolite/Combat_Simulator_1.1.oxz">http://compsoc.dur.ac.uk/~cim/oolite/Combat_Simulator_1.1.oxz</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-SA 3.0</td>
                    <td>CC-BY-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1398458244</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Combat%20Simulator'>http://wiki.alioth.net/index.php/Combat%20Simulator</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. 
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/combatsimulator-buoy.html">combatsimulator-buoy</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/combatsimulator-cobra1.html">Simulator Fighter: Cobra Mk I</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/combatsimulator-cobra3.html">Simulator Fighter: Cobra Mk III</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/combatsimulator-gecko.html">Simulator Fighter: Gecko</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/combatsimulator-krait.html">Simulator Fighter: Krait</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/combatsimulator-mamba.html">Simulator Fighter: Mamba</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/combatsimulator-python.html">Simulator Fighter: Python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/combatsimulator-sidewinder1.html">Simulator Fighter: Sidewinder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/combatsimulator-sidewinder2.html">Simulator Fighter: Sidewinder Escort</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/combatsimulator-sidewinder3.html">Simulator Fighter: Iron Sidewinder</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/combatsimulator.js</td>
                    <td><pre>this.author      = &quot;cim&quot;; 
this.copyright   = &quot;ï¿½ 2011-2014 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.version     = &quot;1.1&quot;; 
this.name = &quot;Combat Simulator&quot;;
this.description = &quot;Combat Simulator&quot;;


this.startUp = this.shipWillExitWitchspace = function() {
		if (!worldScripts[&quot;Ship_Storage_Helper.js&quot;]) {
				log(this.name,&quot;Combat Simulator requires Ship Storage Helper, which has not been installed.&quot;);
				player.commsMessage(&quot;OXP Startup error - check your logs!&quot;,10);
				delete this.startUp;
				delete this.shipWillExitWitchspace;
				return;
		}

		if (!system.isInterstellarSpace &amp;&amp; system.mainStation &amp;&amp; (system.ID == 7 || system.info.techlevel &gt;= 9)) {
				system.mainStation.setInterface(this.name,{
						title: &quot;Combat Simulator&quot;,
						category: &quot;Training&quot;,
						summary: &quot;Combat simulation system to allow pilots to practice fights against a range of opponents&quot;,
						callback: this._setUpFight.bind(this)
				});
		}
}

this.startUpComplete = function()
{

	worldScripts[&quot;oolite-libPriorityAI&quot;]._setCommunication(&quot;_combatSimulator&quot;,&quot;generic&quot;,&quot;oolite_beginningAttack&quot;,&quot;[combatSimulator_beginningAttack]&quot;);
	worldScripts[&quot;oolite-libPriorityAI&quot;]._setCommunication(&quot;_combatSimulator&quot;,&quot;generic&quot;,&quot;oolite_hitTarget&quot;,&quot;[combatSimulator_hitTarget]&quot;);
	worldScripts[&quot;oolite-libPriorityAI&quot;]._setCommunication(&quot;_combatSimulator&quot;,&quot;generic&quot;,&quot;oolite_attackLowEnergy&quot;,&quot;[combatSimulator_attackLowEnergy]&quot;);
	worldScripts[&quot;oolite-libPriorityAI&quot;]._setCommunication(&quot;_combatSimulator&quot;,&quot;generic&quot;,&quot;oolite_incomingMissile&quot;,&quot;[combatSimulator_incomingMissile]&quot;);
}


this._setUpFight = function() {
		this.$fight = new Object;
		
		mission.runScreen({&quot;titleKey&quot;:&quot;CombatSimulator_Stage1_Header&quot;,
											 &quot;messageKey&quot;:&quot;CombatSimulator_Text&quot;,
											 &quot;choicesKey&quot;:&quot;CombatSimulator_Stage1_Choice&quot;},
											function(choice) {
													this.$fight.role = choice;
		mission.runScreen({&quot;titleKey&quot;:&quot;CombatSimulator_Stage2_Header&quot;,
											 &quot;messageKey&quot;:&quot;CombatSimulator_Text&quot;,
											 &quot;choicesKey&quot;:&quot;CombatSimulator_Stage2_Choice&quot;},
											function(choice) {
													this.$fight.skill = parseInt(choice.slice(4));
		mission.runScreen({&quot;titleKey&quot;:&quot;CombatSimulator_Stage3_Header&quot;,
											 &quot;messageKey&quot;:&quot;CombatSimulator_Text&quot;,
											 &quot;choicesKey&quot;:&quot;CombatSimulator_Stage3_Choice&quot;},
											function(choice) {
													this.$fight.number = parseInt(choice);
													this._startFight();
											},this)},this)},this);
}

this._startFight = function() {
		worldScripts[&quot;Ship_Storage_Helper.js&quot;].disableTCATPBNSFunc();
		this.$shipState = worldScripts[&quot;Ship_Storage_Helper.js&quot;].storeCurrentShip();
		this._setUpHandlers();
		this._setUpEnvironment();
		player.ship.removeEquipment(&quot;EQ_ESCAPE_POD&quot;);
		player.ship.launch();
}

this._endFight = function() {
		system.mainStation.dockPlayer();
		this._removeHandlers();
		this._removeEnvironment();
}


this._setUpHandlers = function() {
		this.shipTakingDamage = function(amount,whom,type) {
				if (amount &gt;= player.ship.energy - 2) {
						player.ship.energy = player.ship.maxEnergy;
						this._endFight();
				}
		};
		this.shipWillLaunchFromStation = function(station) {
				player.ship.position = this.$simpos.add([3E3,0,0]);
		};
		this.shipLaunchedFromStation = function(station) {
				for (var i=0;i&lt;this.$simulator.ships.length;i++) {
						var s = this.$simulator.ships[i];
						s.target = player.ship;
						s.accuracy = this.$fight.skill;
						for (var j=0;j&lt;s.subEntities.length;j++) {
								s.subEntities[j].forwardWeapon = &quot;EQ_WEAPON_NONE&quot;;
						}
				}
				player.ship.forwardShield = player.ship.maxForwardShield;
				player.ship.aftShield = player.ship.maxAftShield;
				player.ship.energy = player.ship.maxEnergy;
		};
		// should never get to this step
		this.shipWillEnterWitchspace = function() {
				this._removeHandlers();
		}
		this.shipDockedWithStation = function() {
				worldScripts[&quot;Ship_Storage_Helper.js&quot;].restoreStoredShip(this.$shipState);
				worldScripts[&quot;Ship_Storage_Helper.js&quot;].enableTCATPBNSFunc();
				delete this.shipDockedWithStation;
		}
		this.playerStartedJumpCountdown = function() {
				this.$cancel = new Timer(this,function() { player.ship.cancelHyperspaceCountdown(); },2);
		}
		this.$checkFight = new Timer(this, function() {
				if (!this.$simulator || this.$simulator.count == 0 || !this.$buoy.isValid || player.ship.position.distanceTo(this.$buoy.position) &gt; 26E3) {
						this._endFight();
				}
		}, 5, 5);
}

this._setUpEnvironment = function() {
		this.$simpos = system.sun.position.cross(system.mainPlanet.position).direction().multiply(4E9).subtract(system.mainPlanet.position);
		
		this.$buoy = system.addShips(&quot;combatsimulator-buoy&quot;,1,this.$simpos,0)[0];
		this.$simulator = system.addGroup(this.$fight.role,this.$fight.number,this.$simpos,12E3);
}

this._removeEnvironment = function() {
		if (this.$buoy.isValid) {
				this.$buoy.remove(true);
		}
		for (var i=this.$simulator.count-1;i&gt;=0;i--) {
				this.$simulator.ships[i].remove(true);
		}
}

this._removeHandlers = function() {
		if (this.$checkFight) {
				this.$checkFight.stop();
				delete this.$checkFight;
		}
		delete this.shipTakingDamage;
		delete this.shipWillLaunchFromStation;
		delete this.shipLaunchedFromStation;
		delete this.shipWillEnterWitchspace;
		delete this.playerStartedJumpCountdown;
}



</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
