<html>
    <head>
        <title>Expansion Rescue Stations</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Rescue Stations</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">22 Equipment</a></li>
          <li><a href="#ships">157 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">60 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER M)(&#39;[]&#39; vs &#39;[missions, stations]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>The RRS Group is the leading specialist for official retrieval and rescue work. This OXP adds their stations and ships to some safe systems, where Commanders with a suitable reputation may find a variety of employment offers.</td>
                    <td>The RRS Group is the leading specialist for official retrieval and rescue work. This OXP adds their stations and ships to some safe systems, where Commanders with a suitable reputation may find a variety of employment offers.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.spara.rescue_stations</td>
                    <td>oolite.oxp.spara.rescue_stations</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Rescue Stations</td>
                    <td>Rescue Stations</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Systems</td>
                    <td>Systems</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>cim, spara</td>
                    <td>cim, spara</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.5.4</td>
                    <td>1.5.4</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>missions, stations</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/RRS_Group">http://wiki.alioth.net/index.php/RRS_Group</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/0/05/Rescue_stations_1.5.4.oxz">https://wiki.alioth.net/img_auth.php/0/05/Rescue_stations_1.5.4.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873215</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Rescue%20Stations'>http://wiki.alioth.net/index.php/Rescue%20Stations</a></p>
        <h3>rescue_stations_readme_and_licence.txt</h3>
        <pre>Rescue Stations OXP ver 1.5.4 (20.6.2017)

Author: original by cim, update by spara

_Description_

This oxp is an updated version of Rescue Stations OXP by cim. 

* New model and texture for RRS Arafura
* New Sidewinder model, texture and scripting
* Hires texture &amp;&amp; BGS tunnel texture for RRS station
* Hires texture &amp;&amp; BGS tunnel texture for RRS HQ station
* References Griff&#39;s Wolf 2 and ships from Staer9 shipset and sb-faves shipset.
* New solar probe texture
* Integration for Skilled NPCs oxp
* Added backgrounds to all mission screens without models
* Added station interface (f4)
* Station validator support
* Custom rrs buoy for hq and waystation
* Ship naming retouched, random shipnames integration
	* Civilian arafuras named with random ship names oxp
	* Rrs arafuras &amp; escorts named with wing names
	* Rrs defenders named with random ship names
	* Mission ships named with random shipnames oxp when appropriate
* Mining Posts with vast asteroid fiels added to selected systems
* Many, many tweaks and fixes

_Install_

Install the OXP by copying rescue_stations.oxp to AddOns-folder

_Credits_

* Bug fixes by phkb
* Arafura re-textured from Puma Clipper by Dertien. Model tweaked by Keeper. Shader magic by Keeper.
* RRS Waystation shader magic by Keeper
* Eva probe model tweaked by Keeper.
* Sidewinder re-textured from Sidewinder by Dertien.
* Rock texure for RrS HQ Station by Griff
* Mining Outpost is made from ADCK&#39;s rock hermit.

------

This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/3.0/
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RESCUE_MISSILE.html">Rescue EVA craft</a></td>
                    <td>yes</td>
                    <td align="right">100</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_ANA.html">Advanced Navigation Array (RRS discount)</a></td>
                    <td>yes</td>
                    <td align="right">10125</td>
                    <td align="center">7+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_ASC.html">Advanced Space Compass (RRS discount)</a></td>
                    <td>yes</td>
                    <td align="right">2925</td>
                    <td align="center">8+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_CARGO_HOLDER1.html">Special cargo holder</a></td>
                    <td>no</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_CARGO_HOLDER2.html">Special cargo holder</a></td>
                    <td>no</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_CARGO_HOLDER3.html">Special cargo holder</a></td>
                    <td>no</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_CARGO_HOLDER4.html">Special cargo holder</a></td>
                    <td>no</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_CARGO_HOLDER5.html">Special cargo holder</a></td>
                    <td>no</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_DOCK_COMP.html">Docking Computer (RRS discount)</a></td>
                    <td>yes</td>
                    <td align="right">6750</td>
                    <td align="center">6+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_ESCORT_TARGETING_SYSTEM.html">Escort Targeting System</a></td>
                    <td>yes</td>
                    <td align="right">15000</td>
                    <td align="center">13+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_ESCORT_TARGETING_SYSTEM_DISCOUNT.html">Escort Targeting System (RRS discount)</a></td>
                    <td>yes</td>
                    <td align="right">6000</td>
                    <td align="center">6+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_ESCORT_TARGETING_SYSTEM_WAYSTATION.html">Escort Targeting System</a></td>
                    <td>yes</td>
                    <td align="right">15000</td>
                    <td align="center">6+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_FLIGHTFORM.html">Flight Formation Autopilot</a></td>
                    <td>yes</td>
                    <td align="right">5000</td>
                    <td align="center">7+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_FLIGHTFORM_DISCOUNT.html">Flight Formation Autopilot (RRS discount)</a></td>
                    <td>yes</td>
                    <td align="right">2000</td>
                    <td align="center">7+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_FUEL.html">Complimentary refuelling</a></td>
                    <td>yes</td>
                    <td align="right">25</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_FULLEQUIP.html">RRS Equipment Package</a></td>
                    <td>yes</td>
                    <td align="right">5000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_HEAT_SHIELD.html">Heat shielding (RRS discount)</a></td>
                    <td>yes</td>
                    <td align="right">6750</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_SCANNER_SHOW_MISSILE_TARGET.html">Scanner Targeting Enhancement</a></td>
                    <td>yes</td>
                    <td align="right">4500</td>
                    <td align="center">6+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_SCANNER_SHOW_MISSILE_TARGET_DISCOUNT.html">Scanner Targeting Enhancement (RRS discount)</a></td>
                    <td>yes</td>
                    <td align="right">2025</td>
                    <td align="center">6+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_SCOOPS.html">Fuel Scoops (RRS discount)</a></td>
                    <td>yes</td>
                    <td align="right">2360</td>
                    <td align="center">6+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_SERVICE.html">RRS Service</a></td>
                    <td>yes</td>
                    <td align="right">2500</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_RRS_SOLAR_MINE.html">RRS Solar laboratory</a></td>
                    <td>yes</td>
                    <td align="right">400</td>
                    <td align="center">4+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/arafura.html">Arafura</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/arafura_ind.html">arafura_ind</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/arafura_player.html">arafura_player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/arafura_s1.html">arafura_s1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/arafura_s1b.html">arafura_s1b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/arafura_s5a.html">arafura_s5a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_blackbox.html">rescue_blackbox</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_blackbox_generic.html">rescue_blackbox_generic</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_blackbox_template.html">Black Box</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_PAG_monitor.html">rescue_freighter_PAG_monitor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_PAG_monitor2.html">rescue_freighter_PAG_monitor2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_Z_Porcupine.html">rescue_freighter_Z_Porcupine</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_Z_Python_Courier.html">rescue_freighter_Z_Python_Courier</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_anaconda.html">rescue_freighter_anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_aquatics_conger.html">rescue_freighter_aquatics_conger</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_aquatics_manOWar.html">rescue_freighter_aquatics_manOWar</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_blueracer.html">rescue_freighter_blueracer</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_boa.html">rescue_freighter_boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_boa-mk2.html">rescue_freighter_boa-mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_boaclipper.html">rescue_freighter_boaclipper</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_grs_guanako.html">rescue_freighter_grs_guanako</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_oohauler-player.html">rescue_freighter_oohauler-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_pelamis.html">rescue_freighter_pelamis</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_python.html">rescue_freighter_python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_python-clipper.html">rescue_freighter_python-clipper</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_freighter_python-cruiser.html">rescue_freighter_python-cruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_missile.html">Rescue EVA Pod</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_station.html">RRS Waystation</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_PAG_monitor.html">rescue_target_PAG_monitor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_PAG_monitor2.html">rescue_target_PAG_monitor2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_Z_Porcupine.html">rescue_target_Z_Porcupine</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_Z_Python_Courier.html">rescue_target_Z_Python_Courier</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_anaconda.html">rescue_target_anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_aquatics_conger.html">rescue_target_aquatics_conger</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_aquatics_manOWar.html">rescue_target_aquatics_manOWar</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_blueracer.html">rescue_target_blueracer</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_boa.html">rescue_target_boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_boa-mk2.html">rescue_target_boa-mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_boaclipper.html">rescue_target_boaclipper</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_grs_guanako.html">rescue_target_grs_guanako</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_oohauler-player.html">rescue_target_oohauler-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_pelamis.html">rescue_target_pelamis</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_python.html">rescue_target_python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_python-clipper.html">rescue_target_python-clipper</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rescue_target_python-cruiser.html">rescue_target_python-cruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_aphid.html">rrs_aphid</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_asp.html">rrs_asp</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_asp1.html">rrs_asp1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_asteroid_sidewinder_inactive.html">rrs_asteroid_sidewinder_inactive</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_astroguard_commies.html">rrs_astroguard_commies</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_astroguard_rockhermit.html">rrs_astroguard_rockhermit</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_astromine_commies.html">rrs_astromine_commies</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_astromine_rockhermit.html">Astromine Penal Colony</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_astrominer_commies.html">rrs_astrominer_commies</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_astrominer_rockhermit.html">rrs_astrominer_rockhermit</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_autopilot_screen.html">rrs_autopilot_screen</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_box.html">rrs_box</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_chuckwalla.html">rrs_chuckwalla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_cobra3.html">rrs_cobra3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_cobracourier.html">rrs_cobracourier</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_cobrarapier.html">rrs_cobrarapier</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_delta.html">rrs_delta</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_dock_oct.html">RRS Dock</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_dock_oct_launch.html">RRS Dock</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_dragon-an.html">rrs_dragon-an</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_dragon-m.html">rrs_dragon-m</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_dragon-se.html">rrs_dragon-se</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_drake.html">rrs_drake</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_drakemk2.html">rrs_drakemk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_excalibur.html">rrs_excalibur</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_gecko.html">rrs_gecko</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_gemini.html">rrs_gemini</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_headquarters.html">RRS Headquarters</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_headquarters_bay.html">rrs_headquarters_bay</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_headquarters_bay_dock.html">rrs_headquarters_bay_dock</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_headquarters_bay_ff.html">rrs_headquarters_bay_ff</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_headquarters_construct.html">rrs_headquarters_construct</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_hq_buoy.html">rrs_hq_buoy</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_iguana.html">rrs_iguana</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_koneko.html">rrs_koneko</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_llama.html">rrs_llama</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_mamba.html">rrs_mamba</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_manta.html">rrs_manta</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_moccasin.html">rrs_moccasin</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_outrider.html">rrs_outrider</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_paladin.html">rrs_paladin</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_plague_mine.html">rrs_plague_mine</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_redracer.html">rrs_redracer</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_salamander.html">rrs_salamander</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_shark.html">rrs_shark</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_sidewinder.html">rrs_sidewinder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_slaver_base_core.html">Slaver Base</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_slaver_pod.html">rrs_slaver_pod</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_solar_probe.html">RRS Solar Laboratory</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_taipan.html">rrs_taipan</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrs_waystation_pointer.html">rrs_waystation_pointer</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_adck_hermit.html">Mining Outpost</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_adck_hermitdock.html">Hermit Dock</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_asteroid_sidewinder_lights.html">Sidewinder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_asteroid_sidewinder_shaders.html">Sidewinder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rescue_freighter_monitor.html">rrsfl_rescue_freighter_monitor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rescue_freighter_monitor2.html">rrsfl_rescue_freighter_monitor2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rescue_freighter_python-cruiser.html">rrsfl_rescue_freighter_python-cruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rescue_target_monitor.html">rrsfl_rescue_target_monitor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rescue_target_monitor2.html">rrsfl_rescue_target_monitor2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rescue_target_python-cruiser.html">rrsfl_rescue_target_python-cruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rrs_aphid.html">rrsfl_rrs_aphid</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rrs_cobrarapier.html">rrsfl_rrs_cobrarapier</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rrs_iguana.html">rrsfl_rrs_iguana</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rrs_salamander.html">rrsfl_rrs_salamander</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rrsl_monitor.html">rrsfl_rrsl_monitor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rrsl_monitor2.html">rrsfl_rrsl_monitor2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rrsl_pcc.html">rrsfl_rrsl_pcc</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rsvh_c3r.html">rrsfl_rsvh_c3r</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rsvh_iguana.html">rrsfl_rsvh_iguana</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rsvh_salamander.html">rrsfl_rsvh_salamander</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsfl_rsvh_wolf2.html">rrsfl_rsvh_wolf2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsl_monitor.html">rrsl_monitor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsl_monitor2.html">rrsl_monitor2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsl_pcc.html">rrsl_pcc</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsl_porcupine.html">rrsl_porcupine</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rrsl_python.html">rrsl_python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_adder.html">rsvh_adder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_adder2.html">rsvh_adder2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_asp.html">rsvh_asp</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_asp1.html">rsvh_asp1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_aspexp.html">rsvh_aspexp</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_barracuda.html">rsvh_barracuda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_c3c.html">rsvh_c3c</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_c3com.html">rsvh_c3com</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_c3r.html">rsvh_c3r</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_chuckwalla.html">rsvh_chuckwalla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_cobra1.html">rsvh_cobra1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_cobra3.html">rsvh_cobra3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_dragon-an.html">rsvh_dragon-an</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_dragon-m.html">rsvh_dragon-m</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_drake2.html">rsvh_drake2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_eel.html">rsvh_eel</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_excalibur.html">rsvh_excalibur</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_fdl.html">rsvh_fdl</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_icarus.html">rsvh_icarus</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_iguana.html">rsvh_iguana</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_koneko.html">rsvh_koneko</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_krait.html">rsvh_krait</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_manta.html">rsvh_manta</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_mosquito.html">rsvh_mosquito</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_mossport.html">rsvh_mossport</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_outrider.html">rsvh_outrider</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_paladin.html">rsvh_paladin</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_redracer.html">rsvh_redracer</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_salamander.html">rsvh_salamander</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_shark.html">rsvh_shark</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_sidewinder.html">rsvh_sidewinder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_taipan.html">rsvh_taipan</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_urutu3.html">rsvh_urutu3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_urutu4.html">rsvh_urutu4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/rsvh_wolf2.html">rsvh_wolf2</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue-station.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;; 
this.name      = &quot;RRS Rescue Station&quot;;
this.description = &quot;Rescue Station script&quot;;

//removed launch port workaround -spara-

this.lighttime = 0;
this.lighttimer = undefined;

this.missionLaunch = function() {
		var arafura = this.ship.launchShipWithRole(&quot;rrs-arafura&quot;);
		if (Math.random() &lt; 0.5) {
// go for planet or hyperspace out at random
				arafura.switchAI(&quot;exitingTraderAI.plist&quot;);
		}
}

this.otherShipDocked = function(whom) {
		this.lighttime = clock.seconds;
}

this.checkLights = function checkLights() {
		if (this.lighttime + 10 &gt; clock.seconds) {
				if (this.lighttimer &amp;&amp; this.lighttimer.isRunning) this.lighttimer.stop();
				this.lighttimer = new Timer(this,this.checkLights,10);
				return;
		}
		if (player.dockingClearanceStatus != &quot;DOCKING_CLEARANCE_STATUS_NONE&quot;) {
				if (this.lighttimer &amp;&amp; this.lighttimer.isRunning) this.lighttimer.stop();
				this.lighttimer = new Timer(this,this.checkLights,10);
				return;
		}
		// then no-one has launched or docked recently, and the player
		// isn&#39;t waiting, and we only get this far if there&#39;s nothing in
		// the queue
		this.ship.reactToAIMessage(&quot;DOCKING_LIGHTS_OFF&quot;);
}

this.shipDied = function(whom, why) {
	if (this.lighttimer &amp;&amp; this.lighttimer.isRunning) this.lighttimer.stop()
}

this.shipRemoved = function(suppress) {
	if (this.lighttimer &amp;&amp; this.lighttimer.isRunning) this.lighttimer.stop()
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_ambience.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Ambience&quot;;
this.description = &quot;Adds occasional RRS-group flavour to this Ooniverse outside of (and around) missions&quot;;

//Add 6a mining bases to suitable systems -spara-
//handle generic blackboxes -spara-

this.timer1 = undefined; // plague 
this.timer2 = undefined; // no entry

/* One-off actions */

this.startUp = function() {
		this.updatePlanetInfo();

// Compatibility with other scripts that change system details.
// Specifically, leave Lezaer to us.
// System Redux
		if (worldScripts[&quot;System Redux&quot;]) {
				if (worldScripts[&quot;System Redux&quot;].startUp) {
						// make sure this has started first
						worldScripts[&quot;System Redux&quot;].startUp();
				}
				worldScripts[&quot;System Redux&quot;].changeSystems([[],[],[5],[],[],[],[],[]]);
		}
// System Demux
		if (worldScripts[&quot;System Demux&quot;]) {
				if (!worldScripts[&quot;System Demux&quot;].firstLaunch) {
						worldScripts[&quot;System Demux&quot;].startUp();
				}
				worldScripts[&quot;System Demux&quot;].system_info[517] = 0x0000; // 256*2 + 5
		}
// Deep Horizons Systems
		if (worldScripts[&quot;SystemRedux2API&quot;]) {
				worldScripts[&quot;SystemRedux2API&quot;].excludeSystem(2,5,{TextureMP:&quot;true&quot;, AddPlanets:&quot;true&quot;, AddMoons:&quot;true&quot;, TxtPlanets:&quot;true&quot;, TxtMoons:&quot;true&quot;, ReduSun:&quot;false&quot;});
		}
		if (worldScripts[&quot;Deep Horizon - Systems API&quot;]) {
			worldScripts[&quot;Deep Horizon - Systems API&quot;].excludeSystem(2,5,{TextureMP:&quot;true&quot;, AddPlanets:&quot;true&quot;, AddMoons:&quot;true&quot;, TxtPlanets:&quot;true&quot;, TxtMoons:&quot;true&quot;, ReduSun:&quot;true&quot;});	
		}

}

this.playerEnteredNewGalaxy = function(gal) {
		this.updatePlanetInfo();
}

this.updatePlanetInfo = function() {
		var hqsysid = worldScripts[&quot;Rescue Stations&quot;].systemWithRescueHQStation();
		
		var cdesc = System.infoForSystem(galaxyNumber,hqsysid).description;
		if (cdesc.indexOf(&quot;RRS&quot;) == -1) {
				System.infoForSystem(galaxyNumber,hqsysid).description = cdesc+&quot; RRS Galactic Headquarters are in this system.&quot;;
		}
}


/* Each-system actions */


this.addAmbience = function() {
		if (system.isInterstellarSpace) {
				return;
		}
		// Plague Systems from 6a
		if (this.plagueActive()) {
				this.plagueSystem();
		}

		// System barring from diplomatic incidents
		if (missionVariables.rescuestation_noentry) {
				this.barredFromSystem();
		}
		// //// To avoid confusion the following should only appear outside missions
		if (!worldScripts[&quot;Rescue Stations&quot;].missionActive()) {
				// potentially add a few generic black boxes to the space lanes
				this.blackBox();

				// asteroid fields from 1a and 3
				// because they should be there even if there isn&#39;t anything in them ;)				
				this.asteroidField();
		}
}

this.plagueActive = function() {
		if (system.info.description.indexOf(&quot;disease&quot;) == -1) {
				return false; // not a plague system
		}
		var pstart = system.ID;
		var plength = 128-(system.info.techlevel*8);
		var day = clock.days % 384;
		return (day &gt;= pstart &amp;&amp; day &lt;= pstart+plength);
}

this.plagueSystem = function() {
// slight delay to stop message being lost
		this.timer1 = new Timer(this,this.plagueSystemAux,6);
}

this.plagueSystemAux = function() {
		var beacon = system.shipsWithRole(&quot;buoy-witchpoint&quot;);
		if (beacon.length &gt; 0) {
				beacon[0].commsMessage(&quot;[rescue_plague_system]&quot;);
		}
}

this.asteroidField = function() {
		if (Math.random() &lt; 0.05) {
				this.asteroidField1(); // scenario 3/3a style
		} else if (Math.random() &lt; 0.05) {
				this.asteroidField2(); // scenario 1a style
		}
}

this.asteroidField1 = function() {
		var fieldcentre = Vector3D(0,0,0.2+(Math.random()*0.3)).fromCoordinateSystem(&quot;wsu&quot;);
		fieldcentre.add(Vector3D.random(20E3));
		
		var asteroids = 25+Math.floor(Math.random()*100);
		var fieldradius = 1E3*(20+Math.random()*50);
		for (var i=0;i&lt;asteroids;i++) {
				var apos = fieldcentre.add(Vector3D.randomDirectionAndLength(fieldradius));
				system.addShips(&quot;asteroid&quot;,1,apos,1E3);
		}
}

this.asteroidField2 = function() {
		var dpos = Vector3D.randomDirection().multiply(60E3);
		var cpos = dpos.add(Vector3D.random(5E3));
		var asteroids = 50;
		var fieldradius = 30E3;
		for (var i=0;i&lt;asteroids;i++) {
				var apos = cpos.add(Vector3D.randomDirectionAndLength(fieldradius));
				var aster = system.addShips(&quot;asteroid&quot;,1,apos,1E3);

				if (aster[0].position.distanceTo(dpos) &gt; 20E3 &amp;&amp; Math.random() &lt; 0.5) {
						var vel = dpos.subtract(aster[0].position);
						
						aster[0].velocity = vel.multiply((2+(Math.random()*9))/(5E3));
				}
		}

}

this.blackBox = function() {
		if (Math.random() &lt; 0.5) {
				var bb = system.addShipsToRoute(&quot;rescue_blackbox_generic&quot;,1,0.1+Math.random()*0.8,&quot;wp&quot;);
				bb[0].velocity = Vector3D.randomDirection();
		}
// less on the quieter routes; too easy
		if (Math.random() &lt; 0.1) {
				var bb = system.addShipsToRoute(&quot;rescue_blackbox_generic&quot;,1,0.1+Math.random()*0.7,&quot;ws&quot;);
				bb[0].velocity = Vector3D.randomDirection();
		}
		if (Math.random() &lt; 0.1) {
				var bb = system.addShipsToRoute(&quot;rescue_blackbox_generic&quot;,1,0.1+Math.random()*0.7,&quot;ps&quot;);
				bb[0].velocity = Vector3D.randomDirection();
		}

}

this.barredFromSystem = function() {
		if (missionVariables.rescuestation_noentry == system.ID) {
				if (missionVariables.rescuestation_noentrytime &gt; clock.days) {
						// nothing; something odd has happened
						delete missionVariables.rescuestation_noentry;
						delete missionVariables.rescuestation_noentrytime;
				} else {
						var chance = clock.days-missionVariables.rescuestation_noentrytime;
						if (chance &lt; Math.random()*100) {
								this.timer2 = new Timer(this,this.barredFromSystemAux,6);
						} else {
								delete missionVariables.rescuestation_noentry;
								delete missionVariables.rescuestation_noentrytime;
								// got away with it.
						}
				}
		} else if (missionVariables.rescuestation_noentrytime + 100 &lt; clock.days) {
				delete missionVariables.rescuestation_noentry;
				delete missionVariables.rescuestation_noentrytime;
				// lapsed, stop checking
		}
}

this.barredFromSystemAux = function() {
		var beacon = system.shipsWithRole(&quot;buoy-witchpoint&quot;);
		if (beacon.length &gt; 0) {
				beacon[0].commsMessage(&quot;[rescue_barred_system]&quot;);
		}
		this.timer2 = new Timer(this,this.barredFromSystemBaux,40);
}

this.barredFromSystemBaux = function() {
		if (missionVariables.rescuestation_noentry == system.ID) {
				// if not, they jumped out in time
				var beacon = system.shipsWithRole(&quot;buoy-witchpoint&quot;);
				if (beacon.length &gt; 0) {
						beacon[0].commsMessage(&quot;[rescue_barred_system2]&quot;);
				}
				player.bounty += 20;
		}
}

//generic blackboxes handling

this.$blackboxes = new Array();

//notify player that a black box has been scooped
//add scooped black box to an array
this.shipScoopedOther = function(whom) {
	if (whom.primaryRole === &quot;rescue_blackbox_generic&quot;) {
		player.consoleMessage(&quot;Return the black box to any station for a reward.&quot;, 5);
		this.$blackboxes.push(whom);
	}
}

//cash the loot
this.shipWillDockWithStation = function(station) {
	for (var i = 0; i &lt; this.$blackboxes.length; i++) {
		if (this.$blackboxes[i].status === &quot;STATUS_IN_HOLD&quot;) {
			var payment = 25+Math.floor(50*Math.random());
			var message = &quot;For recovering the black box of the [rescue_random_shipname], insurance pays &quot;+payment+&quot; Cr.&quot;;
			missionVariables.rescuestation_reputation++;
			player.credits += payment;
			player.addMessageToArrivalReport(expandDescription(message));
			if (manifest.machinery &gt; 0) manifest.machinery--;
		}
	}
	this.$blackboxes = new Array();
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_autopilot.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Autopilot&quot;;
this.description = &quot;The world script for the RRS escort autopilot&quot;;

this.hopsize = 5E3;
this.callback = undefined;
this.screen = undefined;

this.findAnything = function(entity) {
		return !entity.hasRole(&quot;alloy&quot;); // anything but the reference object
}

this.findDangerous = function(entity) {
// we&#39;re being quite conservative, so dangerous *to who* isn&#39;t being considered.
		return (entity.isShip &amp;&amp; (entity.hasHostileTarget || entity.isWeapon || entity.isPirate || entity.isThargoid)) || entity.isStation;
}

this.findDangerous2 = function(entity) {
// things that are only dangerous to offenders
		return (entity.isShip &amp;&amp; (entity.isPolice || entity.scanClass == &quot;CLASS_MILITARY&quot; || entity.primaryRole == &quot;hunter&quot;));
}


this.autopilotStep = function(ship) {
		if (!ship.isValid) {
				return;
		}
		if (!ship.script.autopilotwilling) {
				return;
		}
		
		// Firstly, check if we&#39;re there yet.
		if (ship.savedCoordinates.distanceTo(ship.position) &lt; 20E3) {
				
				ship.reactToAIMessage(&quot;DESTINATION_NEAR&quot;);
				return;
		}

    // then check if we can safely make the next hop.
		var nextjump = ship.vectorForward.multiply(5E3);
		var nexthoppos = ship.position.add(nextjump);
		var alloy = system.addShips(&quot;alloy&quot;,1,nexthoppos,1)[0];
		if (system.filteredEntities(this,findAnything,alloy,hopsize/2).length &gt; 0) {
				ship.reactToAIMessage(&quot;OBSTACLES_NEAR&quot;);
				alloy.remove(true);
				return;
		}
		alloy.remove(true);

		// then check if we can safely do so
		if (system.filteredEntities(this,findDangerous,ship,25600).length &gt; 0) {
				ship.reactToAIMessage(&quot;HOSTILES_NEAR&quot;);
				return;
		}

		if (ship.bounty &gt; 0 || player.bounty &gt; 0) {
				if (system.filteredEntities(this,findDangerous2,ship,25600).length &gt; 0) {
						ship.reactToAIMessage(&quot;HOSTILES_NEAR&quot;);
						return;
				}
		}

		// okay, make the next hop

		ship.position = ship.position.add(nextjump);
		player.ship.position = player.ship.position.add(nextjump);
		player.ship.orientation = ship.orientation;
		player.ship.velocity = ship.velocity;
		if (ship.escorts) {
				for (var i=0;i&lt;ship.escorts.length;i++) {
						ship.escorts[i].position = ship.escorts[i].position.add(nextjump);
				}
		}
		var extras = system.shipsWithRole(&quot;rrs-flightcomp-aux&quot;,ship,15E3);
		for (var i=0;i&lt;extras.length;i++) {
				extras[i].position = extras[i].position.add(nextjump);
		}

		var adjustment = hopsize/ship.speed;

		clock.addSeconds(adjustment);
		
}


</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_blackbox.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Generic Black Box&quot;;
this.description = &quot;(generic) Black Box script&quot;;

this.shipSpawned = function() {
		if (worldScripts[&quot;Rescue Stations&quot;].missionActive()) {
				this.ship.setScript(&quot;rescue_scenario_&quot;+missionVariables.rescuestation_scenario+&quot;_blackbox.js&quot;);
				this.ship.switchAI(&quot;rescue_scenario_&quot;+missionVariables.rescuestation_scenario+&quot;_blackboxAI.plist&quot;);

		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_derelict.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Generic Derelict&quot;;
this.description = &quot;(generic) Derelict script&quot;;

this.shipSpawned = function() {
		if (worldScripts[&quot;Rescue Stations&quot;].missionActive()) {
				this.ship.setScript(&quot;rescue_scenario_&quot;+missionVariables.rescuestation_scenario+&quot;_derelict.js&quot;);
				this.ship.switchAI(&quot;rescue_scenario_&quot;+missionVariables.rescuestation_scenario+&quot;_derelictAI.plist&quot;);
		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_evaprobe.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Moray EVA&quot;;
this.description = &quot;(generic) AI for the Moray EVA &#39;missile&#39;&quot;;

this.abandonDock = function() {
		this.commsMessage(&quot;Unable to dock with derelict - abort mission!&quot;);
		missionVariables.rescuestation_stage = 0;
		this.owner.sendAIMessage(&quot;ABORT_MISSION_EVA&quot;);
		this.ship.remove(true);
}

this.derelictDock = function() {
		this.ship.target.sendAIMessage(&quot;EVA_DOCKED&quot;);
		this.ship.remove(true);
}

this.shipCollided = function(other) {
		this.ship.target.sendAIMessage(&quot;EVA_DOCKED&quot;);
		this.ship.remove(true);
}

this.shipDied = function(other) {
		this.ship.target.sendAIMessage(&quot;EVA_DOCKED&quot;);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_leader.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Generic Rescue Leader&quot;;
this.description = &quot;(generic) Rescue Leader script&quot;;

this.shipSpawned = function() {
		if (worldScripts[&quot;Rescue Stations&quot;].missionActive()) {
				this.ship.setScript(&quot;rescue_scenario_&quot;+missionVariables.rescuestation_scenario+&quot;_leader.js&quot;);
				this.ship.switchAI(&quot;rescue_scenario_&quot;+missionVariables.rescuestation_scenario+&quot;_leaderAI.plist&quot;);
		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_missions.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Stations&quot;; 
this.description = &quot;This script adds rescue stations and rescue missions. (main script for OXP)&quot;; 

this.lastmissiongen = 0;
this.scenarios = new Array();
this.variantscenarios = new Array();
this.availablescenarios = new Array();
this.missionpointer = 0;
this.runonce = 0;
this.missionlog = new Object();

this.testmode = &quot;&quot;;

this.startUp = function() {
		if (!missionVariables.rescuestation_stage) {
				// first run
				missionVariables.rescuestation_stage = 0;
		}
		if (!missionVariables.rescuestation_reputation) {
				// first run
				missionVariables.rescuestation_reputation = 0;
		}
		if (!missionVariables.rescuestation_prevreputation) {
				missionVariables.rescuestation_prevreputation = 0;
		}
		if (!missionVariables.rescuestation_firstconv) {
				// first run
				missionVariables.rescuestation_firstconv = 0;
		}
		if (!missionVariables.rescuestation_missionlog) {
				// first run
				missionVariables.rescuestation_missionlog = &quot;&quot;;
		} else {
				var missionlogs = missionVariables.rescuestation_missionlog.split(&quot;;&quot;);
				for (var i=0;i&lt;missionlogs.length;i++) {
						var missiondata = missionlogs[i].split(&quot;=&quot;);
						this.missionlog[missiondata[0]] = missiondata[1];
				}
				this.syncMissionLog();
		}

		this.lastmissiongen = clock.hours-1;
		
		this.tryAddingRescueStation(true);

		delete this.startUp;
}

this.startUpComplete = function() {
	
	if (player.ship.dockedStation.hasRole(&quot;rescue_station&quot;) &amp;&amp; missionVariables.rrs_available_scenarios) {
		this.availablescenarios_save = JSON.parse(missionVariables.rrs_available_scenarios);
		this.lastmissiongen = clock.hours;
		this.fillMissionBoard();
	}
}

this.registerScenario = function(sckey) { // register basic scenarios
		this.scenarios.push(sckey);

// transfer old-style variables
		if (missionVariables[&quot;rescuestation_scenario_&quot;+sckey+&quot;_complete&quot;]) {
				this.missionlog[sckey+&quot;_complete&quot;] = missionVariables[&quot;rescuestation_scenario_&quot;+sckey+&quot;_complete&quot;];
 		}
		delete missionVariables[&quot;rescuestation_scenario_&quot;+sckey+&quot;_complete&quot;];

}

this.registerVariant = function(origkey,sckey) { // register variant scenarios
		var vdesc = new Array();
		vdesc.push(origkey);
		vdesc.push(sckey);

		this.variantscenarios.push(vdesc);

// transfer old-style variables
		if (missionVariables[&quot;rescuestation_scenario_&quot;+sckey+&quot;_complete&quot;]) {
				this.missionlog[sckey+&quot;_complete&quot;] = missionVariables[&quot;rescuestation_scenario_&quot;+sckey+&quot;_complete&quot;];
		}
		delete missionVariables[&quot;rescuestation_scenario_&quot;+sckey+&quot;_complete&quot;];

}

this.syncMissionLog = function() {
		var mlogs = new Array();
		for (key in this.missionlog) {
				mlogs.push(key+&quot;=&quot;+this.missionlog[key]); 
		}
		missionVariables.rescuestation_missionlog = mlogs.join(&quot;;&quot;);
}

this.scenariosWon = function(sckey) {
		if (this.missionlog[sckey+&quot;_complete&quot;]) {
				return this.missionlog[sckey+&quot;_complete&quot;];
		} else {
				return 0;
		}
}

this.scenariosLost = function(sckey) {
		if (this.missionlog[sckey+&quot;_failed&quot;]) {
				return this.missionlog[sckey+&quot;_failed&quot;];
		} else {
				return 0;
		}
}

this.scenariosTried = function(sckey) {
		return this.scenariosWon(sckey)+this.scenariosLost(sckey);
}

/* Event handlers */
this.playerWillSaveGame = function() {
	this.syncMissionLog();
	if (player.ship.dockedStation.hasRole(&quot;rescue_station&quot;) &amp;&amp; this.availablescenarios_save) {
		missionVariables.rrs_available_scenarios = JSON.stringify(this.availablescenarios_save);
	}
}

this.shipWillExitWitchspace = function() {
	
		this.tryAddingRescueStation(false);

		if (this.missionActive() &amp;&amp; worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_shipWillExitWitchspace) {
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_shipWillExitWitchspace();
		}
// reputation won&#39;t appear until at least one mission at least considered
		if (missionVariables.rescuestation_reputation &gt; 400) { // cap at 400
				missionVariables.rescuestation_reputation = 400;
				if (!this.missionActive()) {
						this.setMissionDetails(this.reputationString());
				}
		} else if (missionVariables.rescuestation_reputation &gt; 0) {
				for (var i=0;i&lt;missionVariables.rescuestation_reputation;i+=20) {
						// lose one rank point for every 20 owned while not on a mission
						// need to do more difficult missions at higher ranks to get a promotion
						if (!this.missionActive()) {
								if (missionVariables.rescuestation_reputation == 10 ||
										missionVariables.rescuestation_reputation == 20 ||
										missionVariables.rescuestation_reputation == 40 ||
										missionVariables.rescuestation_reputation == 80 ||
										missionVariables.rescuestation_reputation == 160 ||
										missionVariables.rescuestation_reputation == 320) {
										// nothing: general decay won&#39;t reduce rank
								} else {
										missionVariables.rescuestation_reputation--;
								}
						} // no general decay if on a mission
						if (player.bounty &gt; 0) {
								missionVariables.rescuestation_reputation--;
								if (player.bounty &gt; 50) {
										missionVariables.rescuestation_reputation--;
								}
						}
				}
				if (!this.missionActive()) {
						this.setMissionDetails(this.reputationString());
				}
		} else if (missionVariables.rescuestation_reputation &lt; 0 &amp;&amp; player.bounty == 0) {
				missionVariables.rescuestation_reputation++;
				if (!this.missionActive()) {
						this.setMissionDetails(this.reputationString());
				}
		} else if (missionVariables.rescuestation_reputation &gt; -30 &amp;&amp; player.bounty &gt;= 50) {
				missionVariables.rescuestation_reputation--; // fugitives can take a while to be trusted again
		}
}

this.shipExitedWitchspace = function () { 
		if (this.missionActive() &amp;&amp; worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_shipExitedWitchspace) {
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_shipExitedWitchspace();
		}

}

this.shipWillLaunchFromStation = function (rstation) { 
		if (this.saveAnywhere()) {
				return; // ignore on Save-Anywhere usage
		}

		if (this.missionActive() &amp;&amp; worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_shipWillLaunchFromStation) {
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_shipWillLaunchFromStation(rstation);
		}
		//remove interface when launching
		player.ship.dockedStation.setInterface(&quot;rescue_station&quot;,null);
}

this.shipDockedWithStation = function(rstation) {
		if (this.saveAnywhere()) {
				return; // ignore on Save-Anywhere usage
		}
		this.missionpointer = 0; //reset bulletin pointer
		if (this.missionActive() &amp;&amp; worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_shipDockedWithStation) {
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_shipDockedWithStation(rstation);
		}
		if (!this.missionActive() &amp;&amp; rstation.hasRole(&quot;rescue_station&quot;))
			this.fillMissionBoard();
}

this.guiScreenChanged = function(to, from) {
		if (this.missionActive() &amp;&amp; worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_guiScreenChanged) {
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_guiScreenChanged(to, from);
		}
/*
		if (player.ship.docked &amp;&amp; player.ship.dockedStation.hasRole(&quot;rescue_station&quot;) &amp;&amp; guiScreen === &quot;GUI_SCREEN_STATUS&quot;) {
				//add interface when there are missions.
		}
*/
}

this.solarLabReactionComplete = function () { 
		if (this.missionActive() &amp;&amp; worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_solarLabReactionComplete) {
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_solarLabReactionComplete();
		}

}

this.solarLabCollected = function (scooper) { 
		if (this.missionActive() &amp;&amp; worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_solarLabCollected) {
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_solarLabCollected(scooper);
		}

}

this.solarLabDeployed = function () { 
		if (this.missionActive() &amp;&amp; worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_solarLabDeployed) {
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_solarLabDeployed();
		}

}


this.solarLabDestroyed = function () { 
		if (this.missionActive() &amp;&amp; worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_solarLabDestroyed) {
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_solarLabDestroyed();
		}

}


this.missionScreenOpportunity = function() {
		if (this.saveAnywhere()) {
				return;
		}
/*		// TESTING
		systemlist = new Array();
		for (i=0;i&lt;=255;i++) {
				si = System.infoForSystem(galaxyNumber,i);
				sr = this.rrsRandom(galaxyNumber,i);
				if ((si.government == 7 &amp;&amp; sr &lt; 0.75) || 
						(si.government == 6 &amp;&amp; sr &lt; 0.5) || 
						(si.government == 5 &amp;&amp; sr &lt; 0.25)) {
						systemlist.push(si.name);
				}
		}
		systemlist.sort();
		systemliststr = &quot; &quot;+systemlist.length+&quot; : &quot;+systemlist.join(&quot;, &quot;);
		mission.runScreen ({title: &quot;Local stations&quot;,
														message: systemliststr});
		log(this.name,&quot;Gal&quot;+galaxyNumber+&quot;:&quot;+systemliststr);
		return; */
		
		if (player.ship.dockedStation.hasRole(&quot;rescue_station&quot;) &amp;&amp; missionVariables.rescuestation_firstconv == 0) {
				missionVariables.rescuestation_firstconv = 1;
				mission.runScreen ({title: &quot;Welcome to RRS&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_welcome_screen&quot;,
														model: &quot;rescue_station&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;
														});

				
		} 
		else if (player.ship.dockedStation.hasRole(&quot;rescue_station&quot;) &amp;&amp; this.hasRankIncreased()) {
				mission.runScreen ({title: &quot;Congratulations, Commander&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_promotion_screen_&quot;+this.hasRankIncreased(),
														model: &quot;rescue_station&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;
														});
				missionVariables.rescuestation_prevreputation = missionVariables.rescuestation_reputation;
		} else {

				if (missionVariables.rescuestation_stage &gt; 0) {
						if (worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_missionScreenOpportunity) {
								worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_missionScreenOpportunity();
						}
				}
				
				 else if (this.availablescenarios.length &gt; 0 &amp;&amp; player.ship.dockedStation.hasRole(&quot;rescue_station&quot;)) {
						if (this.availablescenarios.length == 1) {
								var ckey = &quot;rescue_mission_intro_choice_last&quot;;
						} else {
								var ckey = &quot;rescue_mission_intro_choice&quot;;
						}

						if (this.missionpointer &gt;= this.availablescenarios.length) {
								this.missionpointer = 0;
						}

						mission.runScreen ({title: &quot;RRS Contracts (&quot;+(this.missionpointer+1)+&quot;/&quot;+this.availablescenarios.length+&quot;)&quot; ,
																messageKey: &quot;rescue_scenario_&quot;+this.availablescenarios[this.missionpointer]+&quot;_synopsis&quot;,
																screenID: &quot;rrs_mission&quot;,
																choicesKey: ckey,
																model: &quot;rescue_station&quot;,
																background: &quot;rrsfl_blank_bg.png&quot;,
																//exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;
																},
															 this.examineMission);
						

				}
				
		}
}

this.playerEnteredNewGalaxy = function() {
		if (this.missionActive()) {
				this.failMission();
				player.consoleMessage(&quot;You have abandoned your RRS Group assignment&quot;,10);
		}
		delete missionVariables.rescuestation_noentry;
		delete missionVariables.rescuestation_noentrytime;
}

this.playerBoughtEquipment = function(equipment) {
		if (equipment == &quot;EQ_RRS_FUEL&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_FUEL&quot;);
				player.ship.fuel = 7;
		} else if (equipment == &quot;EQ_RRS_SCOOPS&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_SCOOPS&quot;);
				if (player.ship.canAwardEquipment(&quot;EQ_FUEL_SCOOPS&quot;)) {
						player.ship.awardEquipment(&quot;EQ_FUEL_SCOOPS&quot;);
				} else {
						player.consoleMessage(&quot;Sorry: your ship doesn&#39;t have anywhere we can fit fuel scoops.&quot;);
						player.credits += 472.5;
				}
		} else if (equipment == &quot;EQ_RRS_SCANNER_SHOW_MISSILE_TARGET&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_SCANNER_SHOW_MISSILE_TARGET&quot;);
				if (player.ship.canAwardEquipment(&quot;EQ_SCANNER_SHOW_MISSILE_TARGET&quot;)) {
						player.ship.awardEquipment(&quot;EQ_SCANNER_SHOW_MISSILE_TARGET&quot;);
				} else {
						player.consoleMessage(&quot;Sorry: your ship doesn&#39;t have anywhere we can fit a Scanner Targeting Enhancement.&quot;);
						player.credits += 900;
				}
		} else if (equipment == &quot;EQ_RRS_SCANNER_SHOW_MISSILE_TARGET_DISCOUNT&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_SCANNER_SHOW_MISSILE_TARGET_DISCOUNT&quot;);
				if (player.ship.canAwardEquipment(&quot;EQ_SCANNER_SHOW_MISSILE_TARGET&quot;)) {
						player.ship.awardEquipment(&quot;EQ_SCANNER_SHOW_MISSILE_TARGET&quot;);
				} else {
						player.consoleMessage(&quot;Sorry: your ship doesn&#39;t have anywhere we can fit a Scanner Targeting Enhancement.&quot;);
						player.credits += 405;
				}

		} else if (equipment == &quot;EQ_RRS_DOCK_COMP&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_DOCK_COMP&quot;);
				if (player.ship.canAwardEquipment(&quot;EQ_DOCK_COMP&quot;)) {
						player.ship.awardEquipment(&quot;EQ_DOCK_COMP&quot;);
				} else {
						player.consoleMessage(&quot;Sorry: your ship&#39;s systems are incompatible with the docking computer software.&quot;);
						player.credits += 1350;
				}
		} else if (equipment == &quot;EQ_RRS_ASC&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_ASC&quot;);
				player.ship.awardEquipment(&quot;EQ_ADVANCED_COMPASS&quot;);
		} else if (equipment == &quot;EQ_RRS_ANA&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_ANA&quot;);
				player.ship.awardEquipment(&quot;EQ_ADVANCED_NAVIGATIONAL_ARRAY&quot;);
		} else if (equipment == &quot;EQ_RRS_HEAT_SHIELD&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_HEAT_SHIELD&quot;);
				player.ship.awardEquipment(&quot;EQ_HEAT_SHIELD&quot;);
		} else if (equipment == &quot;EQ_RRS_DOCK_COMP&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_DOCK_COMP&quot;);
				player.ship.awardEquipment(&quot;EQ_DOCK_COMP&quot;);
		} else if (equipment == &quot;EQ_RRS_FLIGHTFORM_DISCOUNT&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_FLIGHTFORM_DISCOUNT&quot;);
				player.ship.awardEquipment(&quot;EQ_RRS_FLIGHTFORM&quot;);
		} else if (equipment == &quot;EQ_RRS_ESCORT_TARGETING_SYSTEM_DISCOUNT&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_ESCORT_TARGETING_SYSTEM_DISCOUNT&quot;);
				player.ship.awardEquipment(&quot;EQ_RRS_ESCORT_TARGETING_SYSTEM&quot;);
		} else if (equipment == &quot;EQ_RRS_ESCORT_TARGETING_SYSTEM_WAYSTATION&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_ESCORT_TARGETING_SYSTEM_WAYSTATION&quot;);
				player.ship.awardEquipment(&quot;EQ_RRS_ESCORT_TARGETING_SYSTEM&quot;);


		} else if (equipment == &quot;EQ_RRS_SERVICE&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_SERVICE&quot;);
				var repairable = [&quot;EQ_FUEL_SCOOPS&quot;,
											&quot;EQ_ECM&quot;,
											&quot;EQ_ESCAPE_POD&quot;,									
											&quot;EQ_ENERGY_UNIT&quot;,
											&quot;EQ_DOCK_COMP&quot;,
											&quot;EQ_GAL_DRIVE&quot;,
											&quot;EQ_FUEL_INJECTION&quot;,
											&quot;EQ_SCANNER_SHOW_MISSILE_TARGET&quot;,
											&quot;EQ_MULTI_TARGET&quot;,
											&quot;EQ_ADVANCED_COMPASS&quot;,
											&quot;EQ_ADVANCED_NAVIGATIONAL_ARRAY&quot;,
											&quot;EQ_TARGET_MEMORY&quot;,
											&quot;EQ_HEAT_SHIELD&quot;,
											&quot;EQ_WORMHOLE_SCANNER&quot;,
											&quot;EQ_FRAME_BOUNTY_SCANNER&quot;,
											&quot;EQ_ESCAPE_CAPSULE_LOCATOR&quot;,
											&quot;EQ_PLANETFALL&quot;,
											&quot;EQ_ROCKHERMIT_SCANNER&quot;,
											&quot;EQ_AUTO_EJECT&quot;,
											&quot;EQ_BREAKABLE_HUD_IFF_SCANNER&quot;,
											&quot;EQ_BREAKABLE_SHIELD_FORE&quot;,
											&quot;EQ_BREAKABLE_SHIELD_AFT&quot;,
											&quot;EQ_BREAKABLE_TORUSDRIVE&quot;,
											&quot;EQ_BREAKABLE_WITCHDRIVE&quot;,
											&quot;EQ_FRAME_FUEL_COLLECTOR&quot;,
											&quot;EQ_ELECTRONIC_THUMB&quot;,
											&quot;EQ_RRS_FLIGHTFORM&quot;,
											&quot;EQ_RRS_ESCORT_TARGETING_SYSTEM&quot;
										 ];
				var repaired = 0;
				for (var i=0;i&lt;repairable.length;i++) {
						var repair = repairable[i];
						if (player.ship.equipmentStatus(repair) == &quot;EQUIPMENT_DAMAGED&quot;) {
								repaired++;
								player.ship.setEquipmentStatus(repair,&quot;EQUIPMENT_OK&quot;);
						}
				}
				if (repaired &gt; 0) {
						clock.addSeconds(86400);
				} else {
						player.consoleMessage(&quot;Your ship doesn&#39;t appear to have any damaged equipment that we can repair.&quot;);
						player.credits += 500;
				}
		} else if (equipment == &quot;EQ_RRS_FULLEQUIP&quot;) {
				player.ship.removeEquipment(&quot;EQ_RRS_FULLEQUIP&quot;);
				var rrsequips = [&quot;EQ_SCANNER_SHOW_MISSILE_TARGET&quot;,&quot;EQ_FUEL_SCOOPS&quot;,&quot;EQ_ADVANCED_COMPASS&quot;,&quot;EQ_ADVANCED_NAVIGATIONAL_ARRAY&quot;,&quot;EQ_HEAT_SHIELD&quot;,&quot;EQ_DOCK_COMP&quot;,&quot;EQ_RRS_FLIGHTFORM&quot;,&quot;EQ_RRS_ESCORT_TARGETING_SYSTEM&quot;];
				var added = 0;
				for (var i=0;i&lt;rrsequips.length;i++) {
						var equip = rrsequips[i];
						if (player.ship.canAwardEquipment(equip)) {
								player.ship.awardEquipment(equip);
								added++;
						}
				}
				if (added == 0) {
						player.consoleMessage(&quot;Your ship is already equipped to RRS standards.&quot;);
						player.credits += 1000;
				} else {
						clock.addSeconds(86400);
				}
		}

}

/* Mission selection functions */

this.fillMissionBoard = function () {
		if (this.lastmissiongen &lt; clock.hours) { // stop people just launching and re-entering to reset missions
				this.missionpointer = 0;
				this.availablescenarios = new Array();
				this.availablescenarios_save = new Array();
				this.usedreplacements = new Array();
				this.variantscenarios.sort(function(a,b) { return Math.random()-0.5; }); // shuffle order so it isn&#39;t always the same variant being checked first

				if (this.testmode == &quot;&quot;) {
						for (var i=0;i&lt;this.scenarios.length;i++) {
								if (worldScripts[&quot;Rescue Scenario &quot;+this.scenarios[i]].missionAvailable()) {
										for (var j=1;j&lt;=worldScripts[&quot;Rescue Scenario &quot;+this.scenarios[i]].missionAvailableCount();j++) {
												var scode = this.scenarios[i];
												var replaced = false;
												for(var k=0;k&lt;this.variantscenarios.length &amp;&amp; !replaced;k++) {
														var vcode = this.variantscenarios[k][1];
														if (usedreplacements.indexOf(vcode) == -1) { // not used this replacement already
																if (this.variantscenarios[k][0] == scode) {
																		if (worldScripts[&quot;Rescue Scenario &quot;+vcode].missionAvailable()) {				
																				scode = vcode; // replace the scenario
																				replaced = true;
																				usedreplacements.push(vcode);
																		}
																}
														}
												}
												this.availablescenarios.push(scode);
										}
								}
						}
				} else {
						this.availablescenarios.push(this.testmode);
				}
				if (this.availablescenarios.length &gt; 1) {
						this.availablescenarios.sort(function(a,b) { return Math.random()-0.5; }); // shuffle order
				}
				this.lastmissiongen = clock.hours;
		}
		else {
			//restore previous list of contracts
			this.availablescenarios = this.availablescenarios_save.concat();
		}
		//add station interface
		if (this.availablescenarios.length &gt; 0)
			this.$addInterface();
		else player.ship.dockedStation.setInterface(&quot;rescue_station&quot;,null);
		
		this.availablescenarios_save = this.availablescenarios.concat();
		this.availablescenarios = new Array();
}
		
this.examineMission = function(choice) {
		if (choice == &quot;2YES&quot;) {
			this.initMissionVariables(this.availablescenarios[this.missionpointer]);
		} else if (choice == &quot;1NO&quot;) {
				this.missionpointer++;
		} else if (choice == &quot;3LEAVE&quot;) {
			//create secondary board to restore board when needed
			this.availablescenarios_save = this.availablescenarios.concat();
			//clear the primary board
			this.availablescenarios = new Array();
		}
}

// f4 interface 
this.$addInterface = function() {
	if (player.ship.dockedStation.hasRole(&quot;rescue_station&quot;)) {
		player.ship.dockedStation.setInterface(&quot;rescue_station&quot;,{
			title: &quot;RRS contract board&quot;,
			category: &quot;Contracts&quot;,
			summary: &quot;Enter Rescue, Recovery and Salvage Station contract board.&quot;,
			callback: this.$showInterface.bind(this)
		});
	};
};

this.$showInterface = function() {
	//restore secondary board to primary board
	this.availablescenarios = this.availablescenarios_save.concat();
	this.missionpointer = 0; //reset bulletin pointer
	this.missionScreenOpportunity(); //show board
};

/* Utility functions */

this.saveAnywhere = function() {

		if ((missionVariables.framesave == &quot;MoveToOxpStation&quot;) || (missionVariables.framesave == &quot;MoveToMainStation&quot;)) {
				return true; // ignore on Save-Anywhere usage
		}
		return false;

}

this.setMissionDetails = function(details) {
		mission.setInstructionsKey(details);
}

this.missionActive = function () {
		return (missionVariables.rescuestation_scenario &amp;&amp; (missionVariables.rescuestation_stage &gt; 0));
}

this.systemHasRescueStation = function(sysid) {
		var gov = System.infoForSystem(galaxyNumber,sysid).government;
		
		if (this.testmode != &quot;&quot;) {
				return (gov &gt;= 5);
		}
		

		var chance = this.rrsRandom(galaxyNumber,sysid);

		return ((gov == 7 &amp;&amp; chance &lt; 0.75) || // 75% corporate
						(gov == 6 &amp;&amp; chance &lt; 0.5) || // 50% democracy
						(gov == 5 &amp;&amp; chance &lt; 0.25)); // 25% confederacy
}

this.systemWithRescueHQStation = function() {
		var hqsysid;
		switch (galaxyNumber) {
		case 0:
				hqsysid = 237; // Aruszati
				break;
		case 1:
				hqsysid = 98; // Laribebi
				break;
		case 2:
				hqsysid = 5; // Lezaer
				break;
		case 3:
				hqsysid = 149; // Teance
				break;
		case 4:
				hqsysid = 35; // Enuserin
				break;
		case 5:
				hqsysid = 213; // Larivear
				break;
		case 6:
				hqsysid = 66; // Maraus
				break;
		case 7:
				hqsysid = 7; // Vegedius
				break;
		}
		return hqsysid;
}

this.systemHasRescueHQStation = function(sysid) {
		if (this.testmode == &quot;HQ&quot;) {
				return true;
		}
		var hqsysid = this.systemWithRescueHQStation();
		return (sysid == hqsysid);
}

this.systemWillPopulate = function (){
	
	//waystations
	if (this.systemHasRescueStation(system.ID)) {
		//allow spawning of a destroyed station if on a mission.
		if (this.missionActive() || !(worldScripts.station_validator &amp;&amp; (worldScripts.station_validator.$deaths(&quot;rescue_station&quot;).length !== 0))) {
			var sposc1 = system.mainPlanet.position.multiply(0.5);
			var sposc2 = system.sun.position.direction().multiply(sposc1.magnitude());
			var rspos = Vector3D.interpolate(sposc1,sposc2,0.3);
			system.setPopulator(&quot;rrs_waystation&quot;, {
				callback: function(pos) {			
					var rescuestation = system.addShips(&quot;rescue_station&quot;,1,pos,0)[0];
					rescuestation.orientation = [1,0,0,0]; // align with primary axis

					var rbuoy = system.addShipsToRoute(&quot;rrs_pointer&quot;,1,0.5,&quot;wp&quot;)[0];
					rbuoy.orientation = rescuestation.position.subtract(rbuoy.position).direction().rotationTo([0,0,1]);

					var rbuoy2 = system.addShipsToRoute(&quot;rrs_pointer&quot;,1,0.5,&quot;ws&quot;)[0];
					rbuoy2.orientation = rescuestation.position.subtract(rbuoy2.position).direction().rotationTo([0,0,1]);
					
				}.bind(this),
				location: &quot;COORDINATES&quot;,
				coordinates: rspos,
				deterministic: true
			})
		}
	}
	
	//HQ
	if (this.systemHasRescueHQStation(system.ID)) {
		var spawnSpot = system.sun.position.cross(system.mainPlanet.position).direction().multiply(500E3);
		//allow spawning of a destroyed hq if on a mission.
		if (this.missionActive() || !(worldScripts.station_validator &amp;&amp; (worldScripts.station_validator.$deaths(&quot;rrs_galactic_hq&quot;).length !== 0))) {
			system.setPopulator(&quot;rrs_hq&quot;, {
				callback: function(pos) {
					system.addShips(&quot;rrs_galactic_hq&quot;, 1, pos, 0);					
				}.bind(this),
				location: &quot;COORDINATES&quot;,
				coordinates: spawnSpot,
				deterministic: true
			})
		}
		//add asteroid field even if the station has been destroyed.
		system.setPopulator(&quot;rrs_hq_asteroids&quot;, {
			callback: function(pos) {
				for (var i=0; i&lt;4; i++) {
					var asteroids = system.addShips(&quot;asteroid&quot;,64,spawnSpot,75E3);
					for (var j=0; j&lt;asteroids.length; j++) {
						if (asteroids[j].position.distanceTo(spawnSpot) &lt; 15E3) {
							asteroids[j].remove(true);
						}
					}
				}
			}.bind(this),
			location: &quot;COORDINATES&quot;,
			coordinates: spawnSpot
		})
	}
	
	//Mining bases
	
	//follow mission 6a guidelines when populating with mining base
	
	//potential system has to have disease in description. What is cause and what is effect? Who knows.
	if (!(!system.sun.hasGoneNova &amp;&amp; (system.info.description.indexOf(&quot;disease&quot;) != -1))) {
		return;
	}
	
	//check that there is no 6a mission running to the current system
	if (missionVariables.rescuestation_scenario &amp;&amp; (missionVariables.rescuestation_stage &gt; 0) &amp;&amp; (missionVariables.rescuestation_scenario === &quot;6a&quot;) &amp;&amp; (missionVariables.rescuestation_destsystem2 === system.ID)) {
		return;
	}
	
	//there has to be a suitable system nearby to provide meds in case of outbreak.
	//don&#39;t know if this will ever trigger though
	var medsSystems = SystemInfo.filteredSystems(this, function (other) {
				if (!((other.description.indexOf(&quot;disease&quot;) == -1) &amp;&amp;
							(!other.sun_gone_nova) &amp;&amp;
							(other.techlevel &gt;= 11) &amp;&amp;
							(system.info.distanceToSystem(other) &lt;= 45) &amp;&amp; 
							(other.economy &lt;= 1))) { // Rich/Avg industrials
								return false;
				} else {
						var route = system.info.routeToSystem(other);
						return (route &amp;&amp; route.distance &lt;= 45);
				}
	});
	if (medsSystems.length === 0) {
		return;
	}

	//Let&#39;s populate
	var i = 1;
	//find a suitable location
	do {
		var mineloc = Vector3D(system.scrambledPseudoRandomNumber(i), system.scrambledPseudoRandomNumber(i + 1), system.scrambledPseudoRandomNumber(i + 2)).multiply(400E3);
		i++;
	} while (mineloc.magnitude() &lt; 100E3);
	//station validator support
	if (!(worldScripts.station_validator &amp;&amp; (worldScripts.station_validator.$deaths(&quot;rrsfl-mining-outpost&quot;).length !== 0))) {
		system.setPopulator(&quot;rrs_mining_outpost&quot;, {
			callback: function(pos) {
					system.addShips(&quot;rrsfl-mining-outpost&quot;,1,pos,0);
			}.bind(this),
			location: &quot;COORDINATES&quot;,
			coordinates: mineloc,
			deterministic: true
		});
	}
	//create the asteroid field
	system.setPopulator(&quot;rrs_mining_outpost_asteroids&quot;, {
		callback: function(pos) {
			system.addShips(&quot;asteroid&quot;, 30+Math.floor(Math.random()*30), pos, 40E3);
		}.bind(this),
		location: &quot;COORDINATES&quot;,
		coordinates: mineloc
	});
	//add some miners
	system.setPopulator(&quot;rrs_mining_outpost_miners&quot;, {
		callback: function(pos) {
			system.addShips(&quot;miner&quot;,3,pos,20E3);
		}.bind(this),
		location: &quot;COORDINATES&quot;,
		coordinates: mineloc
	});
	//there might be pirates lurking in the the mine
	var pirates = Math.round(Math.random()*(8 - Math.random() * system.government));
	if (pirates &gt; 0) {
		//divide the pirates roughly into two groups
		var group1 = Math.ceil(pirates / 2);
		//add pirates around the mining outpost
		system.setPopulator(&quot;rrs_mining_outpost_pirates1&quot;, {
			callback: function(pos) {
				system.addGroup(&quot;pirate&quot;, group1, pos, 20E3);
			}.bind(this),
			location: &quot;COORDINATES&quot;,
			coordinates: mineloc
		});
		if (pirates &gt; group1) {
			var group2 = pirates - group1;
			system.setPopulator(&quot;rrs_mining_outpost_pirates2&quot;, {
				callback: function(pos) {
					system.addGroup(&quot;pirate&quot;, group2, pos, 20E3);
				}.bind(this),
				location: &quot;COORDINATES&quot;,
				coordinates: mineloc
			});
		}
	}
}

this.tryAddingRescueStation = function(once) {
		if (once &amp;&amp; this.runonce == 1) {
				return;
		}
		this.runonce = 1;
		
		if (this.missionActive() &amp;&amp; worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_populatingSystem) {
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_populatingSystem();
		}
		worldScripts[&quot;Rescue Ambience&quot;].addAmbience();
}

/* Generic Mission setup */

this.initMissionVariables = function(scenario) {
//		scenario = &quot;1&quot;;
		missionVariables.rescuestation_prevreputation = missionVariables.rescuestation_reputation;
		missionVariables.rescuestation_scenario = scenario;
		missionVariables.rescuestation_stage = 1;
		worldScripts[&quot;Rescue Scenario &quot;+scenario].initMissionVariables();

}

this.refuseCurrentMission = function () {
		this.availablescenarios.splice(this.missionpointer,1);
		//alter secondary board accordingly
		this.availablescenarios_save = this.availablescenarios.concat();
		//remove interface, if null missions
		if (this.availablescenarios.length === 0)
			player.ship.dockedStation.setInterface(&quot;rescue_station&quot;,null);
//		this.availablescenarios.shift(); // remove first mission from array
}

this.acceptMission = function () {
	//clear both boards
	this.availablescenarios = this.availablescenarios_save = new Array();
	//remove station interface
	player.ship.dockedStation.setInterface(&quot;rescue_station&quot;,null);
}

this.missionSuccess = function() {
		var sckey = missionVariables.rescuestation_scenario;
		if (!this.missionlog[sckey+&quot;_complete&quot;]) {
				this.missionlog[sckey+&quot;_complete&quot;] = 1;
		} else {
				this.missionlog[sckey+&quot;_complete&quot;]++;
		}
		this.syncMissionLog();
		worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].missionSuccess();
		this.cleanupMission();
		this.fillMissionBoard();
}

this.failMission = function () {
		var sckey = missionVariables.rescuestation_scenario;
		if (!this.missionlog[sckey+&quot;_failed&quot;]) {
				this.missionlog[sckey+&quot;_failed&quot;] = 1;
		} else {
				this.missionlog[sckey+&quot;_failed&quot;]++;
		}
		this.syncMissionLog();
		worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].failMission();
		this.cleanupMission(); // all for now
}

this.hasRankIncreased = function() {
		var rold = missionVariables.rescuestation_prevreputation;
		var rnew = missionVariables.rescuestation_reputation;
		if (rold &lt; 320 &amp;&amp; rnew &gt;= 320) {
				return 6;
		} else if (rold &lt; 160 &amp;&amp; rnew &gt;= 160) {
				return 5;
		} else if (rold &lt; 80 &amp;&amp; rnew &gt;= 80) {
				return 4;
		} else if (rold &lt; 40 &amp;&amp; rnew &gt;= 40) {
				return 3;
		} else if (rold &lt; 20 &amp;&amp; rnew &gt;= 20) {
				return 2;
		} else if (rold &lt; 10 &amp;&amp; rnew &gt;= 10) {
				return 1;
		}
		return 0;
}


this.reputationString = function() {
		var rep = missionVariables.rescuestation_reputation;
		if (rep &lt; -10) {
				return &quot;rescue_rank_0&quot;;
		} else if (rep &lt; 0) {
				return &quot;rescue_rank_1&quot;;
		} else if (rep &lt; 10) {
				return &quot;rescue_rank_2&quot;;
		} else {
				var grade = 2;
				while (rep &gt;= 10) { // 10 20 40 80 160 320
						grade++;
						rep = rep/2;
				}
				return &quot;rescue_rank_&quot;+grade;
		}

}

this.cleanupMission = function() {

		if (missionVariables.rescuestation_startsystem) {
				mission.unmarkSystem({system: missionVariables.rescuestation_startsystem, name: &quot;RRS&quot;});
		}
		if (missionVariables.rescuestation_destsystem) {
				mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
		}
		if (missionVariables.rescuestation_system) {
				mission.unmarkSystem({system: missionVariables.rescuestation_system, name: &quot;RRS&quot;});
		}

		worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].cleanupMission();

		delete missionVariables.rescuestation_scenario;

		this.setMissionDetails(this.reputationString());

		missionVariables.rescuestation_stage = 0;
}

this.getDirection = function(here,destination) {
		var d = -1;
		var xdiff = destination.coordinates.x - here.coordinates.x;
		var ydiff = here.coordinates.y - destination.coordinates.y;
		var dir = Vector3D(xdiff,ydiff,0);
		var res = &quot;away&quot;;
		var s = 1/Math.sqrt(2);
		if (dir.dot([0,1,0]) &gt; d) { res = &quot;north&quot;; d = dir.dot([0,1,0]); }
		if (dir.dot([s,s,0]) &gt; d) { res = &quot;northeast&quot;; d = dir.dot([s,s,0]); }
		if (dir.dot([1,0,0]) &gt; d) { res = &quot;east&quot;; d = dir.dot([1,0,0]); }
		if (dir.dot([s,-s,0]) &gt; d) { res = &quot;southeast&quot;; d = dir.dot([s,-s,0]); }
		if (dir.dot([0,-1,0]) &gt; d) { res = &quot;south&quot;; d = dir.dot([0,-1,0]); }
		if (dir.dot([-s,-s,0]) &gt; d) { res = &quot;southwest&quot;; d = dir.dot([-s,-s,0]); }
		if (dir.dot([-1,0,0]) &gt; d) { res = &quot;west&quot;; d = dir.dot([-1,0,0]); }
		if (dir.dot([-s,s,0]) &gt; d) { res = &quot;northwest&quot;; d = dir.dot([-s,s,0]); }

		return res;
}

this.rrsRandom = function(galid,sysid) {
// because we can&#39;t use scrambledPseudoRandomNumber for systems we aren&#39;t in
		var n = (sysid+(galid*256))*23;
		n = (214013 * n + 2531011) &amp; 0xFFFFFFFF;
    n = (214013 * n + 2531011) &amp; 0xFFFFFFFF;
    n = (214013 * n + 2531011) &amp; 0xFFFFFFFF;
		return n / 4294967296.0 + 0.5;
}

this.dangerScale = function(base) {
		if (!base) {
				base = 128;
		}
		var danger = Math.floor(Math.random()*Math.floor(1+Math.sqrt(player.score/base)));
		return danger;
}


if (this.testmode != &quot;&quot;) {
		this.shipTargetAcquired = function(target) {
				player.consoleMessage(target.name+&quot; &quot;+target.AI+&quot; &quot;+target.AIState+&quot; &quot;+target.script+&quot; &quot;+target.primaryRole);
		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_news.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue News&quot;; 
this.description = &quot;This script does integration with Snoopers.&quot;; 

this.startUp = function() {
		


}



this.sendNews = function(message,agency,chance) {
		if (!worldScripts.snoopers) {
				return; //optional
		}
		var priority = 3;
		if (worldScripts[&quot;Rescue Stations&quot;].testmode != &quot;&quot;) {
				var chance = 1.1;
				priority = 1;
		}

		if (Math.random() &gt; chance) {
				return;
		}
		var news = new Object;
		news.ID = this.name;
		news.Message = expandMissionText(message);
		news.Agency = agency;
		news.Priority = priority;

		worldScripts.snoopers.insertNews(news);


}

this.newsDisplayed = function(message) {
// nothing right now
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_rrs_pilot.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;RRS Pilot&quot;; 
this.description = &quot;This script is for RRS escape capsules&quot;; 

this.unloadCharacter = function() {
		var payment = 200+Math.floor(Math.random()*100);
		var addpayment = 50+Math.floor(Math.random()*50);
		var message = &quot;For rescuing RRS [rescue_random_rrsrole] &quot;+randomName()+&quot; &quot;+randomName()+&quot;, a &quot;+randomInhabitantsDescription(false)+&quot; from [rescue_random_system], insurance pays &quot;+payment+&quot; Cr. (including a &quot;+addpayment+&quot; Cr. bonus from RRS)&quot;;
		
		missionVariables.rescuestation_reputation++;
		player.credits += payment;
		player.addMessageToArrivalReport(expandDescription(message));

}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_1.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 1&quot;; 
this.description = &quot;This script adds scenario 1 rescue mission.&quot;; 

//new method for selecting the mission ship -spara-
//added background images to mission screens -spara-
//random shipnames integration -spara-

this.scenarioID = &quot;1&quot;;

this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerScenario(this.scenarioID);
}

this.missionAvailableCount = function() {
		return 1;
}

this.targetSystems = function() {
		return SystemInfo.filteredSystems(this, function (other) {
				return (other.systemID !== system.info.systemID) &amp;&amp; 
						(!other.sun_gone_nova) &amp;&amp;
						(system.info.distanceToSystem(other) &lt;= 7) &amp;&amp;
						(other.government &lt; 5) // communist or less stable
		});
}

this.missionAvailable = function() {
		var nearby = this.targetSystems();
		if (nearby.length == 0) {
				return false; // no suitable nearby systems
		}
		if (missionVariables.rescuestation_reputation &lt; 10) {
				return false; // insufficient reputation
		}
		if (player.bounty &gt; 50) {
				return false; // no fugitives
		}
		if (Math.random() &lt; 0.2) {
				return true; // not usually available
		}
		return false;
}

this.initMissionVariables = function() {
		var nearby = this.targetSystems();
// we don&#39;t get here unless nearby.length &gt; 0
		var destination = nearby[Math.floor(nearby.length*Math.random())];

		missionVariables.rescuestation_danger1 = 1+worldScripts[&quot;Rescue Stations&quot;].dangerScale(512);
		missionVariables.rescuestation_danger2 = 3+worldScripts[&quot;Rescue Stations&quot;].dangerScale(256);
		missionVariables.rescuestation_leader_home = 0;
		missionVariables.rescuestation_derelict_home = 0;
		missionVariables.rescuestation_startsystem = system.ID;
		missionVariables.rescuestation_destsystem = destination.systemID;
		missionVariables.rescuestation_destsystem_name = destination.name;
		missionVariables.rescuestation_destsystem_type = &quot;[rescue_govtype_&quot;+destination.government+&quot;]&quot;;

		var choosetype = this.$selectShip();
		missionVariables.rescuestation_shiprole = choosetype[0];
		
		if (worldScripts.randomshipnames)
			missionVariables.rescuestation_shiprole2 = choosetype[1] + &quot;: &quot; +  worldScripts.randomshipnames.$randomTraderName(player.ship);
		else 
			missionVariables.rescuestation_shiprole2 = choosetype[1];
				
		missionVariables.rescuestation_missionwingsize = 1;
		missionVariables.rescuestation_wingname = expandDescription(&quot;[rescue_wingnames]&quot;);

		var reward = 500;

		missionVariables.rescuestation_reward = reward;
		missionVariables.rescuestation_livefire = 0;

}

//Randomly choose a ship for the mission
this.$selectShip = function() {
	var dataKeys = Ship.keysForRole(&quot;rescue_target&quot;);
	var index = Math.floor(Math.random() * dataKeys.length);
	var shipKey = dataKeys[index];
	var roles = Ship.shipDataForKey(shipKey)[&quot;roles&quot;].split(&quot; &quot;);
	for (var i = 0; i &lt; roles.length; i++) {
		if (roles[i] != &quot;rescue_target&quot; &amp;&amp; roles[i].indexOf(&quot;rescue_target&quot;) != -1) {
			return [roles[i], Ship.shipDataForKey(shipKey)[&quot;name&quot;]];
		}
	}	
}

this.rescue_shipDockedWithStation = function (rstation) {
		if (missionVariables.rescuestation_stage &gt; 0) {
				if (missionVariables.rescuestation_stage &gt; 1) {
						if (missionVariables.rescuestation_stage &lt; 1000) {
								player.commsMessage(&quot;You have docked before the rescue mission was complete. You will not be paid for this breach of contract!&quot;,7);
								worldScripts[&quot;Rescue Stations&quot;].failMission();
						}
				}
		} 
}

this.rescue_missionScreenOpportunity = function() {
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;URGENT: Rescue Mission Escorts Needed&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_1_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_urgent_mission_choices&quot;,
														model: missionVariables.rescuestation_shiprole,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 this.missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				if (missionVariables.rescuestation_livefire == 1) {
						reward = Math.round(reward*1.33);
						missionVariables.rescuestation_reward = reward;
				}
				player.credits += reward;

				mission.runScreen({title: &quot;Rescue mission completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_1_mission_complete&quot;,
													 /*model: &quot;EQ_RESCUE_MISSILE&quot;,*/
													 background: &quot;rrsfl_bg.png&quot;,});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();

		}
}


this.rescue_shipWillLaunchFromStation = function (rstation) {
		if (missionVariables.rescuestation_stage == 2 &amp;&amp; rstation.hasRole(&quot;rescue_station&quot;)) {
				var addpos = rstation.position.add([0,0,10E6-5E3]);
				
				var leader = system.addShips(&quot;rescue_team_lead&quot;,1,addpos,10);
				leader[0].orientation = leader[0].orientation.rotateY(Math.PI);
				leader[0].position = rstation.position.add([0,0,-5E3]);
				for(var i=0;i&lt;leader[0].escorts.length;i++) {
						var escort = leader[0].escorts[i];
						escort.orientation = escort.orientation.rotateY(Math.PI);
						escort.position = leader[0].position.add([1500-(Math.random()*3000),500-(Math.random()*1000),0.6E3*(1+i)]);
						//escort.speed = escort.maxSpeed/3;
				}
				
				missionVariables.rescuestation_stage = 3;
		}

}

this.rescue_populatingSystem = function() {
		if (missionVariables.rescuestation_stage == 10 &amp;&amp; system.ID == missionVariables.rescuestation_destsystem) {
				missionVariables.rescuestation_stage = 11;

//				addpos = this.randomOffset(60E3);
				var addpos = this.randomOffset(150E3*(1+(2*Math.random())));

				var addedShip = system.addShips(missionVariables.rescuestation_shiprole,1,addpos,1);

				if (worldScripts.randomshipnames)
					addedShip[0].displayName = missionVariables.rescuestation_shiprole2;
				else
					addedShip[0].displayName = addedShip[0].name + &quot; (derelict)&quot;;

				var addpos2 = addpos.direction().multiply(80E3*Math.random());
				
				if (Math.random()+(system.government/20) &lt; 0.85) {
						var pirates = system.addShips(&quot;pirate&quot;,missionVariables.rescuestation_danger1+Math.floor(Math.random()*missionVariables.rescuestation_danger2),addpos2,3E3);
						this.forceAssault(pirates);
				}

				if (addpos.magnitude() &gt; 200E3) {
						addpos2 = addpos.direction().multiply(100E3+(80E3*Math.random()));

						if (Math.random()+(system.government/20) &lt; 0.85) {
								system.addGroup(&quot;pirate&quot;,missionVariables.rescuestation_danger1+Math.floor(Math.random()*missionVariables.rescuestation_danger2),addpos2,3E3);
						}
						
				}

		}

}

this.rescue_shipWillExitWitchspace = function() {
		
}

/* Mission setup */

this.missionSuccess = function() {
		missionVariables.rescuestation_reputation += 5;
		if (missionVariables.rescuestation_livefire == 1) {
				missionVariables.rescuestation_reputation += 5;
		}
		
		worldScripts[&quot;Rescue News&quot;].sendNews(&quot;rescue_scenario_1_news&quot;,0,0.03);
}

this.failMission = function () {
		missionVariables.rescuestation_reputation -= 5;
		// nothing special
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_callsign;
		delete missionVariables.rescuestation_missionwingsize;
		delete missionVariables.rescuestation_wingname;
		delete missionVariables.rescuestation_startsystem;
		delete missionVariables.rescuestation_destsystem;
		delete missionVariables.rescuestation_destsystem_name;
		delete missionVariables.rescuestation_destsystem_type;
		delete missionVariables.rescuestation_shiprole;
		delete missionVariables.rescuestation_shiprole2;
		delete missionVariables.rescuestation_leader_home;
		delete missionVariables.rescuestation_derelict_home;
		delete missionVariables.rescuestation_livefire;
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_danger1;
		delete missionVariables.rescuestation_danger2;

}

this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		} else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Downloading mission data&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_1_mission_accepted&quot;,
													 choicesKey: &quot;rescue_scenario_urgent_mission_launch&quot;,
													 model: &quot;rescue_team_lead&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;,},
													worldScripts[&quot;Rescue Scenario 1&quot;].missionOfferAccepted
												 );
		}
}

this.missionOfferAccepted = function (choice) {
		worldScripts[&quot;Rescue Stations&quot;].acceptMission();
		worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_1_description&quot;);
		player.ship.fuel = 7;
		player.ship.launch();
}

/* Mission functions */

this.followToDest = function(mass) {
		var expirytime = 50 + (mass/4000);
		this.followtimer = new Timer (this, this.checkFollowed, expirytime);
}

this.checkFollowed = function() {
		if (missionVariables.rescuestation_stage &gt; 0) {
				if (system.countShipsWithRole(&quot;arafura-mission&quot;) == 0) {
						player.consoleMessage(&quot;You have failed to follow your leader through witch-space. Mission failed&quot;,7);
						this.failMission();
				}
		}
}

this.forceAssault = function(attackers) {
		for(var i=0;i&lt;attackers.length;i++) {
				var targets = system.filteredEntities(this,function(entity) {
						return (entity == player.ship) || (entity.hasRole == &quot;arafura-mission&quot;);
				},attackers[i],25600);
				if (targets.length &gt; 0) {
						var target = targets[Math.floor(Math.random()*targets.length)];
						attackers[i].target = target;
						attackers[i].setAI(&quot;interceptAI.plist&quot;);
				}
		}
}

this.randomOffset = function(basedist) {
		return Vector3D.randomDirection(basedist);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_1_derelict.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Rescue Scenario 1a Derelict&quot;;
this.description = &quot;Scripts for the Derelicts&quot;;

//typo fix -spara-
//random shipnames tweak -spara-

this.repairWait = function() {
		this.repairTimer = new Timer (this, this.repairDone, 15+(10*Math.random()));
}

this.whatamessMessage = function() {
		this.ship.commsMessage(&quot;[rescue_whatamess_&quot;+missionVariables.rescuestation_scenario+&quot;].&quot;);
}

this.repairDone = function() {
		this.ship.reactToAIMessage(&quot;REPAIR_NEXT&quot;);
		if (missionVariables.rescuestation_stage &gt; 0) {
				missionVariables.rescuestation_stage++;
				if (missionVariables.rescuestation_stage == 14) {
						var rocks = system.entitiesWithScanClass(&quot;CLASS_ROCK&quot;,this.ship,25E3);
						var found = false;
						for (var i=0;i&lt;rocks.length;i++) {
								var rock = rocks[i];
								if (rock.velocity.magnitude() &gt; 0) {
										rock.scannerDisplayColor1 = &quot;whiteColor&quot;;
										rock.scannerDisplayColor2 = &quot;redColor&quot;;
										found = true;
								}
						}

						if (found) {
								this.ship.commsMessage(&quot;I&#39;m detecting a few asteroids on a potential collision course. Sending co-ordinates to your scanners now.&quot;);
						}

				}
		}
}

this.repairsBegin = function() {
		if (Math.random()+(system.government/20) &lt; 0.85) {
				this.attackTimer = new Timer (this, this.attackBegin, 3+(15*Math.random()));
		}
}

this.repairsEnd = function() {
	if (!worldScripts.randomshipnames)
		this.ship.displayName = this.ship.name+&quot; (Rescued)&quot;;
}

this.attackBegin = function() {
		var addpos = this.ship.position.add([0,0,23E3]); // from planetwards
		var pirates = system.addShips(&quot;pirate&quot;,missionVariables.rescuestation_danger1+Math.floor(Math.random()*missionVariables.rescuestation_danger2),addpos,2E3);
		worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].forceAssault(pirates);
}

this.shipDied = function(whom,why) {
		if (whom == player.ship) {
				missionVariables.rescuestation_reputation -= 10;
		}

		player.consoleMessage(&quot;Rescue Mission: &quot;+this.ship.displayName+&quot; has been destroyed. Mission failed.&quot;);
		missionVariables.rescuestation_stage = 0;
		worldScripts[&quot;Rescue Stations&quot;].failMission();
/*		if (whom) {
				player.consoleMessage(this.ship.displayName+&quot; killed by &quot;+whom.displayName+&quot; using &quot;+why);
		} else {
				player.consoleMessage(this.ship.displayName+&quot; killed by anonymous using &quot;+why);
		}*/
}

this.failedToFollow = function() {
		player.consoleMessage(&quot;Rescue Mission: &quot;+this.ship.displayName+&quot; has failed to enter witch-space. Mission failed.&quot;);
		missionVariables.rescuestation_stage = 0;
		worldScripts[&quot;Rescue Stations&quot;].failMission();

}

this.energyFail = function() {
		if (this.ship.energy &gt; 40) {
				this.ship.energy = 40;
		}
}

this.addToRescueGroup = function() {

		var leader = system.shipsWithRole(&quot;arafura-mission&quot;,this.ship,25E3);
//		player.consoleMessage(&quot;Multiple leaders? (&quot;+leader.length+&quot;)&quot;);
		if (leader.length &gt;= 1) {
				this.target = leader[0];
//				this.ship.commsMessage(&quot;Ready to go&quot;);
				leader[0].reactToAIMessage(&quot;READY_TO_GO&quot;);
				if (missionVariables.rescuestation_stage &gt; 0 &amp;&amp; missionVariables.rescuestation_stage &lt; 90) {
						missionVariables.rescuestation_stage = 90;
				}
				this.ship.reactToAIMessage(&quot;LEADER_FOUND&quot;);
				this.ship.savedCoordinates = leader[0].position;
		} else {
				this.ship.reactToAIMessage(&quot;NO_LEADER_FOUND&quot;);
		}

}

this.checkSystem = function() {
		if (missionVariables.rescuestation_stage &lt; 100) {
				this.ship.reactToAIMessage(&quot;REMOTE_SYSTEM&quot;);
		} else {
				this.ship.reactToAIMessage(&quot;HOME_SYSTEM&quot;);
		}
}

this.inboundJump = function() {
		this.ship.fuel = 7;
		if (!this.ship.exitSystem(missionVariables.rescuestation_startsystem)) {
				this.ship.reactToAIMessage(&quot;JUMP_FAILED&quot;);
		}
}


this.locateArafura = function() {
		var arafura = system.shipsWithRole(&quot;arafura-mission&quot;);
		if (arafura.length == 0) {
				this.ship.reactToAIMessage(&quot;NO_ARAFURA_FOUND&quot;);
		} else {
				var station = system.shipsWithRole(&quot;rescue_station&quot;,this.ship,20000);
				if (station.length &gt; 0) {
						this.ship.reactToAIMessage(&quot;STATION_NEARBY&quot;);
				}

				this.ship.savedCoordinates = arafura[0].position;
				this.ship.reactToAIMessage(&quot;ARAFURA_FOUND&quot;);
		}
}

this.locateHomeStation = function() {
		var station = system.shipsWithRole(&quot;rescue_station&quot;);
		if (station.length == 0) {
				this.ship.reactToAIMessage(&quot;NO_HOME_STATION&quot;);
		} else {
				if (this.ship.position.distanceTo(station[0].position) &lt; 20000) {
						this.ship.target = station[0];
				}
				this.ship.savedCoordinates = station[0].position;
				this.ship.reactToAIMessage(&quot;HOME_STATION&quot;);
		}
}

this.shipDockedWithStation = function(station) {
		if (missionVariables.rescuestation_stage &gt;= 100) {
				missionVariables.rescuestation_derelict_home = 1;
				if (missionVariables.rescuestation_leader_home == 1) {
						missionVariables.rescuestation_stage = 1000;
						station.commsMessage(&quot;Thank you for your services, Commander [commander_name]. Please dock to receive payment.&quot;);
				}
		} else if (missionVariables.rescuestation_stage &gt; 0) {
				player.consoleMessage(&quot;Rescue Mission: &quot;+this.ship.displayName+&quot; has not reached the rescue station. Mission aborted.&quot;);
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		}
}


this.fakeHyperJump = function() {
		// if the player jumps out first it seems a bit random whether this one manages to follow
		this.ship.exitSystem(missionVariables.rescuestation_startsystem);
}

this.shipTakingDamage = function(amount,whom,type) {
		if (type == &quot;scrape damage&quot; &amp;&amp; (whom.hasRole(&quot;arafura-mission&quot;))) {
				this.ship.energy += amount; // cancel damage from collision with leader
		}
}

this.shipExitedWormhole = function() {
// try to reduce collisions from following
//		this.ship.position = this.ship.position.add([-3E3,-3E3,-3E3]);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_1_escort.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Rescue Scenario 1 Escort&quot;;
this.description = &quot;Scripts for the Escorts&quot;;


this.shipDied = function(whom,why) {
		this.ship.commsMessage(&quot;[rescue_argh]&quot;);
		if (whom == player.ship) {
				missionVariables.rescuestation_reputation -= 10;
		}
/*		if (whom) {
				player.consoleMessage(this.ship.displayName+&quot; killed by &quot;+whom.displayName+&quot; using &quot;+why);
		} else {
				player.consoleMessage(this.ship.displayName+&quot; killed by anonymous using &quot;+why);
		}*/

}

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_1_leader.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Rescue Scenario 1 Leader&quot;;
this.description = &quot;AI for the Moray Rescue Leader&quot;;

//changed shipname to random shipnames style -spara-

this.escortnum = 2;
this.playercallsign = &quot;&quot;;
this.damagelevel = 0;

this.entryCheckMissionState = function() {
		if (this.ship.displayName.indexOf(&quot;:&quot;) === -1) {
			this.ship.displayName = this.ship.displayName + &quot;: &quot; + missionVariables.rescuestation_wingname + &quot; Leader&quot;;
		}
		if (this.ship.escorts) {
				for (var i=0;i&lt;this.ship.escorts.length;i++) {
						if (this.escortnum == 4) {
								this.escortnum++; // 4 is player
						}
						var escortship = this.ship.escorts[i]
						if (escortship.displayName.indexOf(&quot;:&quot;) === -1) {
								escortship.displayName = escortship.displayName + &quot;: &quot; + missionVariables.rescuestation_wingname+&quot; &quot;+(this.escortnum++);
						}
				}
		}

		if (missionVariables.rescuestation_stage == 0) {
				this.ship.reactToAIMessage(&quot;RETURN_TO_BASE&quot;);
		} else if (missionVariables.rescuestation_stage &lt; 10) {
				this.ship.reactToAIMessage(&quot;READY_TO_LEAVE&quot;);
		} else if (missionVariables.rescuestation_stage &lt; 100) {
				this.ship.reactToAIMessage(&quot;IN_SYSTEM&quot;);
		} else {
				this.ship.reactToAIMessage(&quot;RETURN_TO_BASE&quot;);
		}
}

this.beginMission = function() {
		missionVariables.rescuestation_callsign = missionVariables.rescuestation_wingname+&quot; 4&quot;;
		
		this.ship.commsMessage(&quot;Welcome, Commander &quot;+player.name+&quot;. You will be taking the &quot;+missionVariables.rescuestation_callsign+&quot; flight position for this trip. Form up in preparation for witch-space jump.&quot;,player.ship);
		missionVariables.rescuestation_stage = 4;
}

this.checkEscortsNear = function () {
		var maxdistance = this.ship.position.distanceTo(player.ship.position);
		if (this.ship.escorts) {
				for (var i=0;i&lt;this.ship.escorts.length;i++) {
						var escortship = this.ship.escorts[i]
						var distance = this.ship.position.distanceTo(escortship.position);
						if (distance &lt; 25E3) { // ignore those outside scanner range
								if (distance &gt; maxdistance) {
										maxdistance = distance;
								}
						}
				}
		}
		if (maxdistance &gt; 5000) {
				this.ship.reactToAIMessage(&quot;ESCORTS_FAR&quot;);
		} else {
				this.ship.reactToAIMessage(&quot;ESCORTS_NEAR&quot;);
		}
}
		
this.recallEscortsForJump = function() {
		this.ship.commsMessage(&quot;Preparing for witch-space jump. All &quot;+missionVariables.rescuestation_wingname+&quot;s, approach to within 5km.&quot;,player.ship);
		this.recallEscorts();

		this.setOutboundJumpCoordinates();
}

this.setOutboundJumpCoordinates = function() {
		var station = system.shipsWithPrimaryRole(&quot;rescue_station&quot;,this.ship,25600);
		if (station.length &gt; 0) {
				this.ship.savedCoordinates = station[0].position.add([0,0,-8E3]);

		} else {
				this.ship.savedCoordinates = player.ship.position;
		}
}

this.setDestinationToPlayer = function() {
		this.ship.savedCoordinates=player.ship.position;
}

this.keepEscortsClose = function() {
		// if any escort is more than 20km away, send it a recall message
		if (this.ship.escorts) {
				for (var i=0;i&lt;this.ship.escorts.length;i++) {
						var escortship = this.ship.escorts[i];
						if (
								(escortship.target &amp;&amp; 
								 (
										 (this.ship.position.distanceTo(escortship.position) &gt; 20E3 &amp;&amp;
											this.ship.position.distanceTo(escortship.target.position) &gt; 20E3
										 ) ||
												 this.ship.position.distanceTo(escortship.target.position) &gt; 26E3
								 )
								) || 
										(!escortship.target &amp;&amp; this.ship.position.distanceTo(escortship.position) &gt; 10E3)
						) {
								this.recallEscort(escortship);
						}
				}		
		}
}

this.recallEscort = function(escortship) {
		if (escortship.AI == &quot;interceptAI.plist&quot;) {
				this.ship.commsMessage(escortship.displayName+&quot;, return to escort formation.&quot;);
				escortship.exitAI(); // return to escorting
		}
}

this.recallEscorts = function() {
				if (this.ship.escorts) {
		for (var i=0;i&lt;this.ship.escorts.length;i++) {
				var escortship = this.ship.escorts[i];
				this.recallEscort(escortship);
		}		
				}
}

this.prepareOutboundJump = function() {
		this.ship.commsMessage(&quot;Initialising witch-space jump to &quot;+missionVariables.rescuestation_destsystem_name+&quot;. All &quot;+missionVariables.rescuestation_wingname+&quot;s, follow me.&quot;,player.ship);
		this.ship.reactToAIMessage(&quot;JUMP_READY&quot;);
}

this.outboundJump = function() {
		this.ship.fuel = 7;
		if (!this.ship.exitSystem(missionVariables.rescuestation_destsystem)) {
				this.ship.reactToAIMessage(&quot;JUMP_FAILED&quot;);
		} else {
				missionVariables.rescuestation_stage = 10; // second stage of mission
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].followToDest(this.ship.mass);
		}
}

this.inboundJump = function() {
		this.ship.fuel = 7;
		var derelict = system.shipsWithRole(missionVariables.rescuestation_shiprole);
		if (derelict.length == 0) {
				this.ship.reactToAIMessage(&quot;NO_DERELICT&quot;);
		} else {
				this.ship.group = new ShipGroup(&quot;rescuegroup&quot;,this.ship);
				this.ship.group.addShip(this.ship);
				this.ship.group.addShip(derelict[0]);
		}

		if (!this.ship.exitSystem(missionVariables.rescuestation_startsystem)) {
				this.ship.reactToAIMessage(&quot;JUMP_FAILED&quot;);
		} else {
				missionVariables.rescuestation_stage = 100; // second stage of mission
				worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].followToDest(this.ship.mass);
		}
}


this.jumpFailed = function() {
		if (Math.random() &lt; 0.2) {
				this.ship.commsMessage(&quot;Witch-space jump failed. Reinitialising...&quot;,player.ship);
		}
}

this.shipExitedWormhole = function() {
// try to reduce collisions from followers
//		this.ship.velocity = this.ship.velocity.add(this.ship.vectorForward.multiply(this.ship.maxSpeed));
//		this.ship.position = this.ship.position.add(this.ship.vectorForward.multiply(3E3));
}

this.stationLost = function() {
		player.consoleMessage(&quot;Rescue Mission: the rescue station has been destroyed. Don&#39;t expect any pay now.&quot;);
		missionVariables.rescuestation_stage = 0;
		worldScripts[&quot;Rescue Stations&quot;].failMission();
}

this.shipDied = function(whom,why) {
		if (whom == player.ship) {
				missionVariables.rescuestation_reputation -= 20;
		}
		player.consoleMessage(&quot;Rescue Mission: &quot;+this.ship.displayName+&quot; has been destroyed. Mission failed.&quot;);
		missionVariables.rescuestation_stage = 0;
		worldScripts[&quot;Rescue Stations&quot;].failMission();
		if (this.ship.escorts) {
				for (var i=0;i&lt;this.ship.escorts.length;i++) {
						var escortship = this.ship.escorts[i]
						escortship.displayName = escortship.name; // remove designations
				}
		}
/*		if (whom) {
				player.consoleMessage(this.ship.displayName+&quot; killed by &quot;+whom.displayName+&quot; using &quot;+why);
		} else {
				player.consoleMessage(this.ship.displayName+&quot; killed by anonymous using &quot;+why);
		} */
}

this.clearRocks = function () {
		this.ship.commsMessage(missionVariables.rescuestation_callsign+&quot;, could you clear out some of these asteroids? Other escorts stay close to me for defence.&quot;,player.ship);
}

this.returnToMission = function () {
		this.ship.commsMessage(&quot;That&#39;s all of them. Return to flight formation.&quot;,player.ship);
		this.recallEscorts();
}

this.requireEscort = function () {
		missionVariables.rescuestation_livefire = 1;
		if (!this.ship.target) {
				return;
		}
		if (this.ship.target.isWeapon) {
				return; // gives some odd messages
		}
		if (this.ship.target.hasRole(&quot;thargon&quot;)) {
				var mothership = system.shipsWithRole(&quot;thargoid-mothership&quot;,this.ship,25600);
				if (mothership.length &gt; 0) {
						// escorts don&#39;t have great aim, so better if they go for the motherships
						this.ship.target = mothership[0];
				}
		}
		if (this.ship.isThargoid) {
				this.requireAllEscorts();
				return;
		}
		var closest = 27E3;
		if (this.ship.escorts) {
				for (var i=0;i&lt;this.ship.escorts.length;i++) {
						var escortship = this.ship.escorts[i]
						var distance = this.ship.position.distanceTo(escortship.position);
						if (closest &gt; distance) {
								var requestship = escortship;
								closest = distance;
						}
				}
		}
		if (player.ship.position) {
				var distance = this.ship.position.distanceTo(player.ship.position);
		} else {
				var distance = 50E3;
		}
		if (closest &gt; distance) {
				var requestship = player.ship;
				var requestname = escortship.displayName;
				closest = distance;
				if (missionVariables.rescuestation_stage &gt; 0) {
						this.requirePlayerHelp();
				}
		} else if (closest &lt; 27E3) {
				this.requireEscortHelp(requestship,false);
		} else {
				player.commsMessage(this.ship.displayname+&quot;: I&#39;m under attack! All &quot;+missionVariables.rescuestation_wingname+&quot; return to scanner range immediately!&quot;);
		}
}

this.requireAllEscorts = function() {
		if (this.ship.escorts) {
				this.ship.commsMessage(&quot;All &quot;+missionVariables.rescuestation_wingname+&quot;, target the &quot;+this.ship.target.displayName+&quot;.&quot;);
				for (var i=0;i&lt;this.ship.escorts.length;i++) {
						var escortship = this.ship.escorts[i]
						this.requireEscortHelp(escortship,true);
				}
		}
}

this.requirePlayerHelp = function() {
		if (this.ship.target &amp;&amp; this.ship.target != player.ship.target) {
				this.ship.commsMessage(missionVariables.rescuestation_callsign+&quot;, target the &quot;+this.ship.target.displayName+&quot;.&quot;);
		} else {
//				this.ship.commsMessage(&quot;We&#39;re under attack! &quot;+missionVariables.rescuestation_callsign+&quot;, fire at will!&quot;);
		}
}

this.requireEscortHelp = function(escort,quiet) {
		if (escort.target != this.ship.target) {
				if (!quiet) {
						this.ship.commsMessage(escort.displayName+&quot;, target the &quot;+this.ship.target.displayName+&quot;.&quot;);
				}
				escort.target = this.ship.target;
				escort.setAI(&quot;interceptAI.plist&quot;);
		}
}

this.takingDamage = function() {
		if (this.damagelevel == 0) {
				this.damagelevel = 1;
				this.ship.commsMessage(&quot;I&#39;m taking substantial damage! &quot;+missionVariables.rescuestation_callsign+&quot;, target the &quot;+this.ship.target.displayName+&quot; immediately!&quot;);
		}
}

this.takingHeavyDamage = function() {
		if (this.damagelevel &lt; 2) {
				this.damagelevel = 2;
				this.ship.commsMessage(&quot;Energy banks are failing! Get these hostiles away from me!&quot;);
		}
}

this.resetDamageCounter = function() {
		this.damagelevel = 0;
}

this.checkEscortAlert = function() {
		if (player.alertCondition == 3 || player.alertHostiles) {
				var attackers = system.filteredEntities(this,function(entity) {
						return (entity.target == player.ship) &amp;&amp; entity.isShip &amp;&amp; entity.hasHostileTarget;
				},this.ship,25600);
				if (attackers.length &gt; 0) {
						this.ship.target = attackers[0];
				}
				this.ship.reactToAIMessage(&quot;PLAYER_RED&quot;);
		} else {
				if (this.ship.escorts) {
						for (var i=0;i&lt;this.ship.escorts.length;i++) {
								var escortship = this.ship.escorts[i]
								var attackers = system.filteredEntities(this,function(entity) {
										return (entity.target == escortship) &amp;&amp; entity.isShip &amp;&amp; entity.hasHostileTarget;
								},this.ship,25600);
								if (attackers.length &gt; 0) {
										this.ship.target = attackers[0];
										this.ship.reactToAIMessage(&quot;ESCORT_RED&quot;);
										return;
								}
						}
				}
				this.ship.reactToAIMessage(&quot;PLAYER_OK&quot;);
		}
}

this.locateDerelict = function() {
		var derelict = system.shipsWithRole(missionVariables.rescuestation_shiprole);
		if (derelict.length == 0) {
				this.ship.reactToAIMessage(&quot;NO_DERELICT&quot;);
		} else {
				this.ship.savedCoordinates = derelict[0].position;
				this.ship.reactToAIMessage(&quot;DERELICT_FOUND&quot;);
		}
}

this.generalChatter = function() {
		if (this.ship.escorts &amp;&amp; Math.random() &lt; 0.3) {
				var speakerno = Math.floor(Math.random()*this.ship.escorts.length);
				var speaker = this.ship.escorts[speakerno];
		} else {
				var speaker = this.ship;
		}
		speaker.commsMessage(&quot;[rescue_radiochatter]&quot;);
}

this.launchEVA = function() {
		var derelict = system.shipsWithRole(missionVariables.rescuestation_shiprole);
		if (derelict.length == 0) {
				this.ship.reactToAIMessage(&quot;NO_DERELICT&quot;);
		} else {
				this.ship.target = derelict[0];
				this.ship.awardEquipment(&quot;EQ_RESCUE_MISSILE&quot;);
				this.ship.fireMissile(&quot;EQ_RESCUE_MISSILE&quot;);
				this.ship.target = null; /* prevent really silly mission failure */
		}
}

this.locateHomeStation = function() {
		var station = system.shipsWithRole(&quot;rescue_station&quot;);
		if (station.length == 0) {
				this.ship.reactToAIMessage(&quot;NO_HOME_STATION&quot;);
		} else {
				if (this.ship.position.distanceTo(station[0].position) &lt; 20000) {
						this.ship.target = station[0];
				}
				this.ship.savedCoordinates = station[0].position;
				this.ship.reactToAIMessage(&quot;HOME_STATION&quot;);
		}
}

this.shipDockedWithStation = function(station) {
		if (missionVariables.rescuestation_stage &gt;= 100) {
				missionVariables.rescuestation_leader_home = 1;
				if (missionVariables.rescuestation_derelict_home == 1) {
						missionVariables.rescuestation_stage = 1000;
						station.commsMessage(&quot;Thank you for your services, Commander [commander_name]. Please dock to receive payment.&quot;);
				}
		} else if (missionVariables.rescuestation_stage &gt; 0) {
				player.consoleMessage(&quot;Rescue Mission: &quot;+this.ship.displayName+&quot; has docked before the mission is complete. Mission aborted.&quot;);
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		}
}

this.shipTakingDamage = function(amount,whom,type) {
		if (type == &quot;scrape damage&quot; &amp;&amp; (whom.hasRole(&quot;rrs-escort&quot;) || whom.hasRole(&quot;rescue_target&quot;))) {
				this.ship.energy += amount; // cancel damage from collision with follower
		}
}




/* Autopilot functions block */

this.autopilotModeReady = function() {
		this.autopilotwilling = 1;
}

this.autopilotModeOffline = function() {
		this.autopilotwilling = 0;
}

this.autopilotContinue = function() {
		worldScripts[&quot;Rescue Autopilot&quot;].autopilotStep(this.ship);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_1a.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 1a&quot;; 
this.description = &quot;This script adds scenario 1 variant A rescue mission.&quot;; 

//added background images to mission screens -spara-
//random shipnames integration -spara-

this.scenarioID = &quot;1a&quot;;

this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerVariant(&quot;1&quot;,this.scenarioID);
}

this.missionAvailableCount = function() {
		return 1;
}

this.missionAvailable = function() {
		if (worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;1&quot;) == 0) {
				return false; // it&#39;s a little trickier, so not the first time
		}
		if (2*worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;1a&quot;) &gt; worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;1&quot;)) {
				return false; // no more than 1 in 3
		}
		if (Math.random() &lt; 0.4) {
				return true; // occasional replacement
		}
		return false;
}

this.initMissionVariables = function() {
		worldScripts[&quot;Rescue Scenario 1&quot;].initMissionVariables();
}

this.rescue_shipDockedWithStation = function (rstation) {
		worldScripts[&quot;Rescue Scenario 1&quot;].rescue_shipDockedWithStation(rstation);
}

this.rescue_missionScreenOpportunity = function() {
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;URGENT: Rescue Mission Escorts Needed&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_1_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_urgent_mission_choices&quot;,
														model: missionVariables.rescuestation_shiprole,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 this.missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				if (missionVariables.rescuestation_livefire == 1) {
						reward = Math.round(reward*1.33);
						missionVariables.rescuestation_reward = reward;
				}
				player.credits += reward;

				mission.runScreen({title: &quot;Rescue mission completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_1_mission_complete&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();

		}
}


this.rescue_shipWillLaunchFromStation = function (rstation) {
		worldScripts[&quot;Rescue Scenario 1&quot;].rescue_shipWillLaunchFromStation(rstation);
}


this.rescue_populatingSystem = function() {
		if (missionVariables.rescuestation_stage == 10 &amp;&amp; missionVariables.rescuestation_destsystem == system.ID) {
				missionVariables.rescuestation_stage = 11;

				var addpos = this.randomOffset(60E3);
				
				var addedShip = system.addShips(missionVariables.rescuestation_shiprole,1,addpos,1);

				if (worldScripts.randomshipnames)
					addedShip[0].displayName = missionVariables.rescuestation_shiprole2;
				else
					addedShip[0].displayName = addedShip[0].name + &quot; (derelict)&quot;;
				
				this.addAsteroids(addpos);

				var addpos2 = this.randomOffset(15E3);
				
				if (Math.random() &lt; 0.75) {
						var pirates = system.addShips(&quot;pirate&quot;,missionVariables.rescuestation_danger1+Math.floor(Math.random()*missionVariables.rescuestation_danger2),addpos2,3E3);
						this.forceAssault(pirates);
				}

		}
}

/* Mission setup */

this.missionSuccess = function() {
		missionVariables.rescuestation_reputation += 5;
		if (missionVariables.rescuestation_livefire == 1) {
				missionVariables.rescuestation_reputation += 5;
		}
		// nothing special		
}

this.failMission = function () {
		missionVariables.rescuestation_reputation -= 5;
		// nothing special
}

this.cleanupMission = function() {
		worldScripts[&quot;Rescue Scenario 1&quot;].cleanupMission();
}

this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		} else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Downloading mission data&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_1_mission_accepted&quot;,
													 choicesKey: &quot;rescue_scenario_urgent_mission_launch&quot;,
													 model: &quot;rescue_team_lead&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													worldScripts[&quot;Rescue Scenario 1&quot;].missionOfferAccepted
												 );
		}
}

this.missionOfferAccepted = function (choice) {
		worldScripts[&quot;Rescue Stations&quot;].acceptMission();
		worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_1_description&quot;);
		player.ship.fuel = 7;
		player.ship.launch();
}

/* Mission functions */

this.followToDest = function(mass) {
		var expirytime = 50 + (mass/4000);
		this.followtimer = new Timer (this, this.checkFollowed, expirytime);
}

this.checkFollowed = function() {
		worldScripts[&quot;Rescue Scenario 1&quot;].checkFollowed();
}

this.forceAssault = function(attackers) {
		worldScripts[&quot;Rescue Scenario 1&quot;].forceAssault(attackers);
}

this.randomOffset = function(basedist) {
		return worldScripts[&quot;Rescue Scenario 1&quot;].randomOffset(basedist);
}

this.addAsteroids = function(dpos) {
		var cpos = dpos.add(Vector3D.random(5E3));
		var asteroids = 100;
		var fieldradius = 30E3;
		for (var i=0;i&lt;asteroids;i++) {
				var apos = cpos.add(Vector3D.randomDirectionAndLength(fieldradius));
				var aster = system.addShips(&quot;asteroid&quot;,1,apos,1E3);

				if (aster[0].position.distanceTo(dpos) &gt; 20E3 &amp;&amp; Math.random() &lt; 0.5) {
						var vel = dpos.subtract(aster[0].position);
						
						aster[0].velocity = vel.multiply((2+(Math.random()*9))/(5E3));
				}
		}

		

}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_1a_derelict.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Rescue Scenario 1a Derelict&quot;;
this.description = &quot;Scripts for the Derelicts&quot;;

this.revert = function() {
		this.ship.setScript(&quot;rescue_scenario_1_derelict.js&quot;);
		this.ship.switchAI(&quot;rescue_scenario_1_derelictAI.plist&quot;);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_1a_escort.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Rescue Scenario 1a Escort&quot;;
this.description = &quot;Scripts for the Escorts&quot;;


this.shipDied = function(whom,why) {
		this.ship.commsMessage(&quot;[rescue_argh]&quot;);

/*		if (whom) {
				player.consoleMessage(this.ship.displayName+&quot; killed by &quot;+whom.displayName+&quot; using &quot;+why);
		} else {
				player.consoleMessage(this.ship.displayName+&quot; killed by anonymous using &quot;+why);
		} */

}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_1a_leader.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Rescue Scenario 1a Leader&quot;;
this.description = &quot;AI for the Moray Rescue Leader&quot;;

this.revert = function() {
		this.ship.setScript(&quot;rescue_scenario_1_leader.js&quot;);
		this.ship.switchAI(&quot;rescue_scenario_1_leaderAI.plist&quot;);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_1b.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 1b&quot;; 
this.description = &quot;This script adds scenario 1 variant B rescue mission.&quot;; 

//added background images to mission screens -spara-
//random shipnames integration -spara-
//anomalies added as visual effects -spara-


this.scenarioID = &quot;1b&quot;;

this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerVariant(&quot;1&quot;,this.scenarioID);
}

this.missionAvailableCount = function() {
		return 1;
}

this.missionAvailable = function() {
		if (missionVariables.rescuestation_reputation &lt; 40) {
				return false; // Tier 3 contractor needed
		}
		if (worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;1&quot;) &lt; 5) {
				return false; // somewhat rare variation
		}
		if (10*worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;1&quot;) &gt; worldScripts[&quot;Rescue Stations&quot;].scenariosTried(&quot;1b&quot;)) {
				return false; // no more than 1 in 10
		}
		if (Math.random() &lt; 0.3) {
				return true; // occasional replacement
		}
		return false;
}

this.initMissionVariables = function() {
		worldScripts[&quot;Rescue Scenario 1&quot;].initMissionVariables();
}

this.rescue_shipDockedWithStation = function (rstation) {
		worldScripts[&quot;Rescue Scenario 1&quot;].rescue_shipDockedWithStation(rstation);
}

this.rescue_missionScreenOpportunity = function() {
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;URGENT: Rescue Mission Escorts Needed&quot;,
													screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_1b_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_urgent_mission_choices&quot;,
														model: missionVariables.rescuestation_shiprole,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 this.missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				if (missionVariables.rescuestation_livefire == 1) {
						reward = Math.round(reward*1.5);
						missionVariables.rescuestation_reward = reward;
				}
				player.credits += reward;

				mission.runScreen({title: &quot;Rescue mission completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_1b_mission_complete&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();

		}
}


this.rescue_shipWillLaunchFromStation = function (rstation) {
		if (missionVariables.rescuestation_stage == 2 &amp;&amp; rstation.hasRole(&quot;rescue_station&quot;)) {
				var addpos = rstation.position.add([0,0,10E6-5E3]);
				
				var leader = system.addShips(&quot;rescue_team_lead_2&quot;,1,addpos,10);
				leader[0].orientation = leader[0].orientation.rotateY(Math.PI);
				leader[0].position = rstation.position.add([0,0,-5E3]);
				for(var i=0;i&lt;leader[0].escorts.length;i++) {
						var escort = leader[0].escorts[i];
						escort.orientation = escort.orientation.rotateY(Math.PI);
						escort.position = leader[0].position.add([1500-(Math.random()*3000),500-(Math.random()*1000),0.6E3*(1+i)]);
						//escort.speed = escort.maxSpeed/3;
				}
				
				missionVariables.rescuestation_stage = 3;
		}
}


this.rescue_populatingSystem = function() {
		if (missionVariables.rescuestation_stage == 10 &amp;&amp; missionVariables.rescuestation_destsystem == system.ID) {
				missionVariables.rescuestation_stage = 11;

				var addpos = this.randomOffset(100E3*(1+(2*Math.random())));

				var addedShip = system.addShips(missionVariables.rescuestation_shiprole,1,addpos,1);

				if (worldScripts.randomshipnames)
					addedShip[0].displayName = missionVariables.rescuestation_shiprole2;
				else
					addedShip[0].displayName = addedShip[0].name + &quot; (derelict)&quot;;
				

		} else if (missionVariables.rescuestation_stage == 100 &amp;&amp; missionVariables.rescuestation_startsystem == system.ID) {
				var danger1 = Math.floor(Math.random()*(missionVariables.rescuestation_danger1-1));
				if (danger1 &gt; 0) {
					for (var i = 0; i &lt; danger1; i++)
						system.addVisualEffect(&quot;rrs_witchspace_anomaly&quot;,Vector3D.randomDirectionAndLength(20E3));
				}
				if (worldScripts[&quot;GalNavy&quot;] &amp;&amp; Math.random() &lt; 0.8) { // Galactic Navy OXP available
						system.addShips(&quot;patrol-frigate&quot;,1,[0,0,0],10E3);
						var danger2 = Math.floor(0.5*Math.random()*missionVariables.rescuestation_danger2);
						if (danger2 &gt; 0) {
							for (var i = 0; i &lt; danger2; i++)
								system.addVisualEffect(&quot;rrs_witchspace_anomaly&quot;,Vector3D.randomDirectionAndLength(20E3));
						}
				}
				
		}
}

/* Mission setup */

this.missionSuccess = function() {
		missionVariables.rescuestation_reputation += 5;
		if (missionVariables.rescuestation_livefire == 1) {
				// basically always
				missionVariables.rescuestation_reputation += 10;
		}
		// nothing special		
}

this.failMission = function () {
		missionVariables.rescuestation_reputation -= 5;
		// nothing special
}

this.cleanupMission = function() {
		worldScripts[&quot;Rescue Scenario 1&quot;].cleanupMission();
}

this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		} else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Downloading mission data&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_1_mission_accepted&quot;,
													 choicesKey: &quot;rescue_scenario_urgent_mission_launch&quot;,
													 model: &quot;rescue_team_lead&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													worldScripts[&quot;Rescue Scenario 1b&quot;].missionOfferAccepted
												 );
		}
}

this.missionOfferAccepted = function (choice) {
		worldScripts[&quot;Rescue Stations&quot;].acceptMission();
		worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_1_description&quot;);
		player.ship.fuel = 7;
		player.ship.launch();
}

/* Mission functions */

this.followToDest = function(mass) {
		var expirytime = 50 + (mass/4000);
		this.followtimer = new Timer (this, this.checkFollowed, expirytime);
}

this.checkFollowed = function() {
		worldScripts[&quot;Rescue Scenario 1&quot;].checkFollowed();
}

this.forceAssault = function(attackers) {
		worldScripts[&quot;Rescue Scenario 1&quot;].forceAssault(attackers);
}

this.randomOffset = function(basedist) {
		return worldScripts[&quot;Rescue Scenario 1&quot;].randomOffset(basedist);
}

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_1b_derelict.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Rescue Scenario 1b Derelict&quot;;
this.description = &quot;Scripts for the Derelicts&quot;;

//anomalies added as visual effects -spara-

this.revert = function() {
		this.ship.setScript(&quot;rescue_scenario_1_derelict.js&quot;);
		this.ship.switchAI(&quot;rescue_scenario_1_derelictAI.plist&quot;);
		// function overrides

		this.ship.script.repairsBegin = function() {
				this.attackTimer = new Timer (this, this.thargoidAttackBegin, 33+(15*Math.random()));
		}
		this.ship.script.repairWait = function() {
				if (missionVariables.rescuestation_stage &lt;= 12) {
						this.repairTimer = new Timer (this, this.repairDone, 15+(10*Math.random()));		
				} else {
						this.repairTimer = new Timer (this, this.repairDone, 25+(25*Math.random()));
				}
		}

		this.ship.script.thargoidAttackBegin = function() {
				var danger = 1+Math.floor(Math.random()*missionVariables.rescuestation_danger1)+Math.floor(Math.random()*missionVariables.rescuestation_danger2);
				if (danger &lt; 2) {
						danger = 2;
				}
				var enemy = new Array();
				for (var i = 0; i &lt; danger; i++)
					enemy.push(system.addVisualEffect(&quot;rrs_witchspace_anomaly&quot;,this.ship.position.add(Vector3D.randomDirectionAndLength(15E3))));
				for (i=0;i&lt;enemy.length;i++) {
						if (enemy[i].position.distanceTo(this.ship.position) &lt; 10E3) {
								enemy[i].position = enemy[i].position.add(enemy[i].position.subtract(this.ship.position).direction().multiply(10E3));
						}
				}
				
				var leader = system.shipsWithRole(&quot;arafura-mission&quot;,this.ship,25E3);
				leader[0].commsMessage(&quot;Detecting witchspace anomalies. All [mission_rescuestation_wingname], red alert!&quot;);

		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_1b_leader.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Rescue Scenario 1b Leader&quot;;
this.description = &quot;AI for the Moray Rescue Leader&quot;;

this.revert = function() {
		this.ship.setScript(&quot;rescue_scenario_1_leader.js&quot;);
		this.ship.switchAI(&quot;rescue_scenario_1_leaderAI.plist&quot;);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_2.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 2&quot;; 
this.description = &quot;This script adds scenario 2 rescue mission.&quot;; 

//added background images to mission screens -spara-

this.scenarioID = &quot;2&quot;;

this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerScenario(this.scenarioID);
}

this.missionAvailableCount = function() {
		return 1;
}

this.missionAvailable = function() {
		if (missionVariables.rescuestation_reputation &lt; -10) {
				return false; // bad reputation
		}
		if (player.bounty &gt; 50) {
				return false; // no fugitives
		}
		if (Math.random() &lt; 0.5) {
				return true; // often available
		}
		return false;
}

this.initMissionVariables = function() {
		missionVariables.rescuestation_reward = 30;
		missionVariables.rescuestation_system = system.ID;
}

this.rescue_shipDockedWithStation = function (rstation) {
		
		if (rstation.isMainStation &amp;&amp; system.ID == missionVariables.rescuestation_system &amp;&amp; missionVariables.rescuestation_stage == 2) {
				missionVariables.rescuestation_stage = 1000;
		}
}

this.rescue_missionScreenOpportunity = function() {
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;Package delivery needed&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_2_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_nonurgent_mission_choices&quot;,
														model: &quot;rescue_station&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 this.missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				player.credits += reward;

				mission.runScreen({title: &quot;Delivery completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_2_mission_complete&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();

		}
}


this.rescue_shipWillLaunchFromStation = function (rstation) {

}


this.rescue_shipWillExitWitchspace = function() {
		player.consoleMessage(&quot;You were supposed to deliver a package before leaving the system!&quot;);
		worldScripts[&quot;Rescue Stations&quot;].failMission();
}

/* Mission setup */

this.missionSuccess = function() {
		missionVariables.rescuestation_reputation += 2; // only really useful for complete beginners and restoring a damaged reputation
		// nothing special		
}

this.failMission = function () {
		missionVariables.rescuestation_reputation -= 10; // how can you get this one wrong!
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_system;
}


this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		} else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Transferring package&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_2_mission_accepted&quot;,
													 model: &quot;alloy&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													function (choice) {
															worldScripts[&quot;Rescue Stations&quot;].acceptMission();
															worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_2_description&quot;);
													}
												 );
		}
}

/* Mission functions */

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_2a.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 2a&quot;; 
this.description = &quot;This script adds scenario 2 variant A delivery mission.&quot;; 

//added background images to mission screens -spara-

this.scenarioID = &quot;2a&quot;;


this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerVariant(&quot;2&quot;,this.scenarioID);
}

this.missionAvailable = function() {
		if (missionVariables.rescuestation_reputation &lt; 10) {
				return false; // not enough reputation
		}
		if (player.bounty &gt; 50) {
				return false; // no fugitives
		}
		if (Math.random() &lt; 0.8) {
				return true; // generally replace if the player&#39;s rep is high enough
		}
		return false;
}

this.initMissionVariables = function() {
		missionVariables.rescuestation_reward = 150;
		missionVariables.rescuestation_system = system.ID;
		missionVariables.rescuestation_deadline = clock.seconds+7200; // 2 hours
}

this.rescue_shipDockedWithStation = function (rstation) {

		if (rstation.isMainStation &amp;&amp; system.ID == missionVariables.rescuestation_system &amp;&amp; missionVariables.rescuestation_stage == 3) {
				if (clock.seconds &lt; missionVariables.rescuestation_deadline) {
						missionVariables.rescuestation_stage = 1000;
				} else {
						missionVariables.rescuestation_stage = 1001;
				}
		}
}

this.rescue_missionScreenOpportunity = function() {
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;Package delivery needed&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_2a_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_nonurgent_mission_choices&quot;,
														model: &quot;rescue_station&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 this.missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				player.credits += reward;

				mission.runScreen({title: &quot;Delivery completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_2a_mission_complete&quot;,
													 model: &quot;rescue_blackbox&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();

		} else if (missionVariables.rescuestation_stage == 1001) {
				mission.runScreen({title: &quot;You have arrived too late&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_2a_mission_toolate&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].failMission();

		}

}

this.rescue_shipWillExitWitchspace = function () {
		worldScripts[&quot;Rescue Scenario 2&quot;].rescue_shipWillExitWitchspace();
}

this.missionSuccess = function() {
		missionVariables.rescuestation_reputation += 10;
		// nothing special		

		worldScripts[&quot;Rescue News&quot;].sendNews(&quot;rescue_scenario_2a_news&quot;,1,0.02);

}

this.failMission = function () {
		missionVariables.rescuestation_reputation -= 10; 
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_deadline;
		delete missionVariables.rescuestation_system;
}

this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		} else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Transferring package&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_2a_mission_accepted&quot;,
													 model: &quot;rescue_blackbox&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													function (choice) {
															worldScripts[&quot;Rescue Stations&quot;].acceptMission();
															worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_2a_description&quot;);
													}
												 );
		}
}

this.rescue_shipWillLaunchFromStation = function (rstation) {
		if (missionVariables.rescuestation_stage == 2 &amp;&amp; rstation.hasRole(&quot;rescue_station&quot;)) {
				missionVariables.rescuestation_stage = 3;

				var nhunters = 2+worldScripts[&quot;Rescue Stations&quot;].dangerScale(128); 

				var hunters = system.addShipsToRoute(&quot;rrs-vicious-hunter&quot;,nhunters,0.85,&quot;wp&quot;);
				for(var i=0;i&lt;hunters.length;i++) {
						hunters[i].switchAI(&quot;rescue_player_hunterAI.plist&quot;);
						hunters[i].setScript(&quot;rrs_player_hunter.js&quot;);
						hunters[i].awardEquipment(&quot;EQ_FUEL_INJECTION&quot;);
						hunters[i].fuel = 7;
//						hunters[i].displayName = hunters[i].name+&quot; (hunter)&quot;;
				}

		}

}


/* Mission functions */

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_2b.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 2b&quot;; 
this.description = &quot;This script adds scenario 2, variant B solar lab mission.&quot;; 

//updated pylon equipment removal -spara-
//added background images to mission screens -spara-

this.scenarioID = &quot;2b&quot;;


this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerVariant(&quot;2&quot;,this.scenarioID);
}

this.missionAvailable = function() {
		if (missionVariables.rescuestation_reputation &lt; 0) {
				return false; // not enough reputation
		}
		if (player.ship.missileCapacity == 0) {
				return false; // no point if no missiles can be carried
		}
		if (player.bounty &gt; 50) {
				return false; // no fugitives
		}
		if (player.credits &lt; 80) {
				return false; // must be able to pay the deposit.
		}
		if (Math.random() &lt; 0.3) {
				return true; // sometimes available
		}
		return false;
}

this.initMissionVariables = function() {
		missionVariables.rescuestation_reward = 75;
		missionVariables.rescuestation_system = system.ID;
		missionVariables.rescuestation_deadline = clock.seconds+14400; // 4 hours
}

this.rescue_shipDockedWithStation = function (rstation) {

		if (rstation.hasRole(&quot;rescue_station&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_system &amp;&amp; missionVariables.rescuestation_stage == 100) {
				if (player.ship.equipmentStatus(&quot;EQ_RRS_SOLAR_MINE&quot;) == &quot;EQUIPMENT_OK&quot;) {
						if (clock.seconds &lt; missionVariables.rescuestation_deadline) {
								missionVariables.rescuestation_stage = 1000;
						} else {
								missionVariables.rescuestation_stage = 1001;
						}
						this.removeSolarMine();
				} else {
						player.consoleMessage(&quot;You seem to have lost the laboratory somewhere.&quot;);
						worldScripts[&quot;Rescue Stations&quot;].failMission();
				}
		} else if (rstation.hasRole(&quot;rescue_station&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_system &amp;&amp; missionVariables.rescuestation_stage &lt; 100 &amp;&amp; clock.seconds &gt;= missionVariables.rescuestation_deadline) {
				missionVariables.rescuestation_stage = 1001;
				this.removeSolarMine();
		}
}

this.rescue_missionScreenOpportunity = function() {
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;Portable solar laboratory deployment&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_2b_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_nonurgent_mission_choices&quot;,
														model: &quot;EQ_RRS_SOLAR_MINE&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 this.missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				player.credits += reward + 80; // repay equipment deposit too

				mission.runScreen({title: &quot;Laboratory returned&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_2b_mission_complete&quot;,
													 model: &quot;EQ_RRS_SOLAR_MINE&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();

		} else if (missionVariables.rescuestation_stage == 1001) {
				player.credits += 80; // return deposit

				mission.runScreen({title: &quot;Laboratory deadline missed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_2b_mission_toolate&quot;,
													 background: &quot;rrsfl_bg.png&quot;});
				worldScripts[&quot;Rescue Stations&quot;].failMission();

		}

}

this.missionSuccess = function() {
		missionVariables.rescuestation_reputation += 4;
		// nothing special		
}

this.failMission = function () {
		missionVariables.rescuestation_reputation -= 10;
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_deadline;
		delete missionVariables.rescuestation_system;
}

this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		} else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Mission accepted&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_2b_mission_accepted&quot;,
													 model: &quot;EQ_RRS_SOLAR_MINE&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													function (choice) {
															worldScripts[&quot;Rescue Stations&quot;].acceptMission();
															worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_2b_description&quot;);
															missionVariables.rescuestation_solarlabavailable = 1;
													}
												 );
		}
}

this.rescue_shipWillLaunchFromStation = function (rstation) {
		if (missionVariables.rescuestation_stage == 2 &amp;&amp; rstation.hasRole(&quot;rescue_station&quot;)) {
				missionVariables.rescuestation_stage = 3;
				

		}

}

this.rescue_solarLabReactionComplete = function() {
		if (missionVariables.rescuestation_stage &lt; 50) {
				missionVariables.rescuestation_stage = 50;
				player.commsMessage(&quot;RRS: Solar lab reaction complete. Please collect immediately.&quot;);
		}
}

this.rescue_solarLabCollected = function() {
		if (missionVariables.rescuestation_stage == 50) {
				missionVariables.rescuestation_stage = 100;
				player.consoleMessage(&quot;RRS Laboratory collected. Return it to the Waystation&quot;);
		}
}

this.rescue_solarLabDestroyed = function() {
		player.consoleMessage(&quot;RRS Laboratory destroyed. Mission failed.&quot;);
		worldScripts[&quot;Rescue Stations&quot;].failMission();
}

this.rescue_solarLabDeployed = function() {
		if (missionVariables.rescuestation_stage &lt; 50) {
				missionVariables.rescuestation_stage = 20;
				delete missionVariables.rescuestation_solarlabavailable;
		}
}

this.rescue_populatingSystem = function() {
		if (system.ID == missionVariables.rescuestation_system &amp;&amp;
				missionVariables.rescuestation_stage == 20 &amp;&amp; 
				clock.seconds &lt; missionVariables.rescuestation_deadline) {
// then there was a lab left behind. Don&#39;t know exactly where, but never mind
				var rpos = system.sun.position.add(system.mainPlanet.position.subtract(system.sun.position).direction().multiply(system.sun.radius*2));
				var lab = system.addShips(&quot;rrs_portable_solar_lab&quot;,1,rpos,1);
				lab[0].temperature = 0.65;
		}
}

/* Mission functions */

this.removeSolarMine = function() {
	player.ship.removeEquipment(&quot;EQ_RRS_SOLAR_MINE&quot;);
}

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_3.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 3&quot;; 
this.description = &quot;This script adds scenario 3 rescue mission.&quot;; 

//added long range map to the mission screens -spara-
//fixed description expand bug -spara-

this.scenarioID = &quot;3&quot;;


this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerScenario(this.scenarioID);
}

this.missionAvailableCount = function() {
		if (Math.random() &lt; 0.2) {
				return 1+this.missionAvailableCount();
		} else {
				return 1;
		}
}

this.missionAvailable = function() {

		if (Math.random() &gt; 0.6) {
				return false; // usually available
		}
		if (missionVariables.rescuestation_reputation &lt; 0) {
				return false; // need reasonable reputation
		}
		if (player.bounty &gt; 50) {
				return false; // no fugitives
		}
/*		if (player.ship.equipmentStatus(&quot;EQ_FUEL_SCOOPS&quot;) != &quot;EQUIPMENT_OK&quot;) {
				return false; // need a fuel scoop
		}
		if (player.ship.cargoSpaceCapacity &lt; 1) {
				return false; // and somewhere to scoop to
		} */
		var nearby = this.targetSystems();
		if (nearby.length &lt; 1) {
				return false; // no suitable nearby systems
		}
		return true;
}

this.targetSystems = function() {
		return SystemInfo.filteredSystems(this, function (other) {
				if (!((other.systemID !== system.info.systemID) &amp;&amp; 
						(!other.sun_gone_nova) &amp;&amp;
						(system.info.distanceToSystem(other) &gt; 7) &amp;&amp;
							(system.info.distanceToSystem(other) &lt; 15))) {
						return false;
				} else {
						var route = system.info.routeToSystem(other);
						return (route &amp;&amp; route.distance &lt;= 25);
				}
		});
}

this.initMissionVariables = function() {
		missionVariables.rescuestation_startsystem = system.ID;
		missionVariables.rescuestation_startsystem_name = system.name;

		var nearby = this.targetSystems();
		var destination = nearby[Math.floor(nearby.length*Math.random())];

		missionVariables.rescuestation_destsystem = destination.systemID;
		missionVariables.rescuestation_destsystem_name = destination.name;

		var direction = worldScripts[&quot;Rescue Stations&quot;].getDirection(system.info,destination);

		missionVariables.rescuestation_destsystem_desc = destination.name+&quot; (&quot;+expandDescription(&quot;[rescue_govname_&quot;+destination.government+&quot;]&quot;)+&quot;, &quot;+Math.round(system.info.distanceToSystem(destination))+&quot; LY &quot;+direction+&quot;)&quot;;

		var timer = (2.3+Math.random())*(system.info.routeToSystem(destination).time);
		var deadline = clock.seconds+(timer*3600); // routeToSystem is in hours
// picked smallest number of jumps for timer, not quickest, to give a
// little flexibility

		missionVariables.rescuestation_deadline = deadline;
		missionVariables.rescuestation_deadline_text = clock.clockStringForTime(deadline);

		var reward = Math.floor(system.info.routeToSystem(destination).distance * 30);
		missionVariables.rescuestation_reward = reward;


		var danger1 = 0; 
		var danger2 = 0; // no ambush
		if (worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;3&quot;) &gt; 0) { // not the first time
				var ambush = (Math.floor(Math.random()*10))-destination.government;
				if (ambush &gt; 0) { // almost always in Anarchy, down to 20% in Corporate
						danger1 = 2 + worldScripts[&quot;Rescue Stations&quot;].dangerScale(512); 
						danger2 = 3 + worldScripts[&quot;Rescue Stations&quot;].dangerScale(256); 
						if (destination.government &lt;= 1) {
								danger2++;
								if (destination.government == 0) {
										danger1++;
								}
						}
				}
		}
		missionVariables.rescuestation_danger1 = danger1;
		missionVariables.rescuestation_danger2 = danger2;

}

this.rescue_shipDockedWithStation = function (rstation) {
		
		if (rstation.hasRole(&quot;rescue_station&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_startsystem &amp;&amp; missionVariables.rescuestation_stage == 100) {
				if (clock.seconds &lt; missionVariables.rescuestation_deadline) {
						missionVariables.rescuestation_stage = 1000;
				} else {
						missionVariables.rescuestation_stage = 1001;
				}
		}
}

this.rescue_missionScreenOpportunity = function() {
		if (worldScripts[&quot;Rescue Stations&quot;].restoreDestination) {
			player.ship.targetSystem = worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
			delete worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
		}
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;Recover black box&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_3_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_nonurgent_mission_choices_map&quot;,
														model: &quot;asteroid&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				var debriefing = &quot;rescue_scenario_3_mission_complete&quot;
/*				if (missionVariables.rescuestation_danger1 &gt; 0) {
						reward += 150;
						missionVariables.rescuestation_reward += 150;
						debriefing = &quot;rescue_scenario_3_mission_complete_danger&quot;
				} */
				player.credits += reward;

				mission.runScreen({title: &quot;Black box recovered&quot;,
													screenID: &quot;rrs_mission&quot;,
													 model: &quot;rescue_blackbox&quot;,
													 messageKey: debriefing,
													 background: &quot;rrsfl_blank_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();
		} else if (missionVariables.rescuestation_stage == 1001) {
				mission.runScreen({title: &quot;Black box recovered&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_3_mission_toolate&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].failMission();
				
		}
}


this.rescue_shipWillLaunchFromStation = function (rstation) {
		if (missionVariables.rescuestation_stage == 2 &amp;&amp; system.ID == missionVariables.rescuestation_destsystem &amp;&amp; missionVariables.rescuestation_deadline &gt; clock.seconds) {
				this.makeAsteroidField();
				player.consoleMessage(&quot;That black box must be somewhere around here.&quot;,10);
		}
}


this.rescue_populatingSystem = function() {
		if (missionVariables.rescuestation_stage == 2 &amp;&amp; system.ID == missionVariables.rescuestation_destsystem &amp;&amp; missionVariables.rescuestation_deadline &gt; clock.seconds) {
				this.makeAsteroidField();
				player.consoleMessage(&quot;That black box must be somewhere around here.&quot;,10);
		} else if (missionVariables.rescuestation_stage == 2 &amp;&amp; missionVariables.rescuestation_deadline &lt;= clock.seconds) {
				player.consoleMessage(&quot;You have taken too long to find the black box.&quot;,10);			
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		}
}

/* Mission setup */

this.missionSuccess = function() {
		mission.unmarkSystem({system: missionVariables.rescuestation_startsystem, name: &quot;RRS&quot;});
		missionVariables.rescuestation_reputation += 10;
		if (missionVariables.rescuestation_danger1 &gt; 0) {
				missionVariables.rescuestation_reputation += 3;
		}

		// nothing special		
}

this.failMission = function () {
		if (missionVariables.rescuestation_stage &gt; 100) {
				mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
		} else {
				mission.unmarkSystem({system: missionVariables.rescuestation_startsystem, name: &quot;RRS&quot;});
		}
		missionVariables.rescuestation_reputation -= 5; 
		if (missionVariables.rescuestation_stage != 1001) {
				missionVariables.rescuestation_reputation -= 5; // bringing it back at all does reduce the penalty
		}
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_deadline;
		delete missionVariables.rescuestation_deadline_text;
		delete missionVariables.rescuestation_startsystem;
		delete missionVariables.rescuestation_startsystem_name;
		delete missionVariables.rescuestation_destsystem;
		delete missionVariables.rescuestation_destsystem_name;
		delete missionVariables.rescuestation_danger1;
		delete missionVariables.rescuestation_danger2;
		player.ship.removeEquipment(&quot;EQ_RRS_CARGO_HOLDER1&quot;);
		mission.setInstructions(null, &quot;Rescue Scenario 3&quot;);
}


this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		} 
		
		else if (choice === &quot;MAP&quot;) {
			worldScripts[&quot;Rescue Stations&quot;].restoreDestination = player.ship.targetSystem;
			player.ship.targetSystem = missionVariables.rescuestation_destsystem;
				mission.runScreen ({title: &quot;Recover black box&quot;,
														screenID: &quot;rrs_mission_map&quot;,
														backgroundSpecial: &quot;LONG_RANGE_CHART_QUICKEST&quot;
														},
														worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_missionScreenOpportunity
													);
		}
		
		else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Mission accepted&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_3_mission_accepted&quot;,
													 model: &quot;rescue_blackbox&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													function (choice) {
															mission.markSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
															worldScripts[&quot;Rescue Stations&quot;].acceptMission();
															worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_3_description&quot;);
													}
												 );
		}
}

/* Mission functions */

this.makeAsteroidField = function() {
		if (system.shipsWithPrimaryRole(&quot;rescue_blackbox&quot;).length &gt; 0) {
				return; // already done
		}
		

		var fieldcentre = Vector3D(0,0,0.2+(Math.random()*0.3)).fromCoordinateSystem(&quot;wsu&quot;);
		fieldcentre.add(Vector3D.random(20E3));
		
		var asteroids = 150;
		var fieldradius = 20E3;
		for (var i=0;i&lt;asteroids;i++) {
				var apos = fieldcentre.add(Vector3D.randomDirectionAndLength(fieldradius));
				system.addShips(&quot;asteroid&quot;,1,apos,1E3);
		}
		
		var bb = system.addShips(&quot;rescue_blackbox&quot;,1,fieldcentre,5E3);

		if (missionVariables.rescuestation_danger1 &gt; 0) {
				system.addGroup(&quot;rrs_asteroid_ambusher&quot;,missionVariables.rescuestation_danger1+Math.floor(Math.random()*missionVariables.rescuestation_danger2),fieldcentre,15E3);
		} else {
				var bbpos = bb[0].position;
				// if there aren&#39;t pirates, then there might be a few cargo pods left
				if (Math.random() &lt; 0.75) {
						system.addShips(&quot;alloy&quot;,1+Math.floor(Math.random()*3),bbpos,300);
				}
				if (Math.random() &lt; 0.5) {
						system.addShips(&quot;barrel&quot;,1+Math.floor(Math.random()*2),bbpos,300);
				}
		}

}

this.collectBox = function() {
		missionVariables.rescuestation_stage = 100;
		mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
		mission.markSystem({system: missionVariables.rescuestation_startsystem, name: &quot;RRS&quot;});
		player.ship.awardEquipment(&quot;EQ_RRS_CARGO_HOLDER1&quot;);
		mission.setInstructions(&quot;Special Cargo: 1 TC Black box.&quot;, &quot;Rescue Scenario 3&quot;);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_3_blackbox.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Scenario 3 Black Box&quot;;
this.description = &quot;Scenario 3 Black Box script&quot;;

this.shipWasScooped = function (scooper) {
		if (scooper.isPlayer) {
				
				player.consoleMessage(&quot;Black box retrieved!&quot;,10);

				worldScripts[&quot;Rescue Scenario 3&quot;].collectBox();
				
		} else {
				player.consoleMessage(&quot;Someone else has reached the black box first.&quot;,5);
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		}
}

this.shipDied = function() {
		if (missionVariables.rescuestation_stage &lt; 100) {
				player.consoleMessage(&quot;The black box has been destroyed.&quot;,5);
				worldScripts[&quot;Rescue Stations&quot;].failMission();
			
		}
}

this.findPlayer = function() {
		if (player.ship.position.distanceTo(this.ship.position) &lt; 7E3) {
				this.ship.commsMessage(&quot;Ping!&quot;);
				// pretty much necessary to locate the black box, but it&#39;s not just the player&#39;s attention it attracts
				var ambushers = system.shipsWithPrimaryRole(&quot;rrs_asteroid_ambusher&quot;,this.ship,25600);
				for(var i=0;i&lt;ambushers.length;i++) {
						ambushers[i].reactToAIMessage(&quot;AMBUSH_IS_GO&quot;);
				}
		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_3a.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 3a&quot;; 
this.description = &quot;This script adds scenario 3 variant A rescue mission.&quot;; 

//added long range map to the mission screens -spara-
//added background image to mission screens -spara-

this.scenarioID = &quot;3a&quot;;


this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerVariant(&quot;3&quot;,this.scenarioID);
}

this.missionAvailableCount = function() {
		return 1;
}

// variant, only needs conditions extra to original
this.missionAvailable = function() {
	
		if (Math.random() &lt; 0.4) {
				return true; // even if it can replace as variant, doesn&#39;t always
		}
		if (missionVariables.rescuestation_reputation &lt; 20) {
				return false; // need reasonable reputation
		}
		if (worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;3&quot;) == 0) {
				return false; // can&#39;t replace the first mission
		}
		var replacer = Math.floor(worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;3&quot;)/5);
		if (replacer &lt; worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;3a&quot;)) {
				return false; // at most 1 in 5 completed missions
		}
		return false;
}

this.initMissionVariables = function() {
		worldScripts[&quot;Rescue Scenario 3&quot;].initMissionVariables();
		missionVariables.rescuestation_danger1 = 0; // never a sidewinder ambush in this variant
}

this.rescue_shipDockedWithStation = function (rstation) {
		worldScripts[&quot;Rescue Scenario 3&quot;].rescue_shipDockedWithStation(rstation);
}

this.rescue_missionScreenOpportunity = function() {
		if (worldScripts[&quot;Rescue Stations&quot;].restoreDestination) {
			player.ship.targetSystem = worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
			delete worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
		}
		
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen({title: &quot;Recover black box&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_3_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_nonurgent_mission_choices_map&quot;,
														model: &quot;asteroid&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 worldScripts[&quot;Rescue Scenario 3&quot;].missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward * 1.5;
				var debriefing = &quot;rescue_scenario_3a_mission_complete&quot;
				player.credits += reward;

				mission.runScreen({title: &quot;Black box recovered&quot;,
													screenID: &quot;rrs_mission&quot;,
													 model: &quot;rescue_blackbox&quot;,
													 messageKey: debriefing,
													 background: &quot;rrsfl_blank_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();
		} else if (missionVariables.rescuestation_stage == 1001) {
				mission.runScreen({title: &quot;Black box recovered&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_3_mission_toolate&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].failMission();
				
		}
}


this.rescue_shipWillLaunchFromStation = function (rstation) {
		worldScripts[&quot;Rescue Scenario 3&quot;].rescue_shipWillLaunchFromStation();
}


this.rescue_populatingSystem = function() {
		if (missionVariables.rescuestation_stage == 2 &amp;&amp; system.ID == missionVariables.rescuestation_destsystem &amp;&amp; missionVariables.rescuestation_deadline &gt; clock.seconds) {
				this.makeAsteroidField();
				player.consoleMessage(&quot;That black box must be somewhere around here.&quot;,10);
		} else if (missionVariables.rescuestation_stage == 2 &amp;&amp; missionVariables.rescuestation_deadline &lt;= clock.seconds) {
				player.consoleMessage(&quot;You have taken too long to find the black box.&quot;,10);			
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		} else if (missionVariables.rescuestation_stage &gt;= 100 &amp;&amp; system.ID != missionVariables.rescuestation_startsystem) {
				this.spawnAssassin();
		}
}

this.rescue_shipExitedWitchspace = function() {
		var assassins = system.shipsWithPrimaryRole(&quot;rrs-vicious-hunter&quot;,player.ship,25600);
		if (assassins.length &gt; 0) {
				assassins[0].commsMessage(&quot;[rescue_scenario_3a_conspirator_target]&quot;);
		}
		
}

/* Mission setup */

this.missionSuccess = function() {
		mission.unmarkSystem({system: missionVariables.rescuestation_startsystem, name: &quot;RRS&quot;});
		missionVariables.rescuestation_reputation += 15;

		worldScripts[&quot;Rescue News&quot;].sendNews(&quot;rescue_scenario_3a_news&quot;,2,0.2);

		// nothing special		
}

this.failMission = function () {
		if (missionVariables.rescuestation_stage &gt; 100) {
				mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
		} else {
				mission.unmarkSystem({system: missionVariables.rescuestation_startsystem, name: &quot;RRS&quot;});
		}
		missionVariables.rescuestation_reputation -= 5;
		if (missionVariables.rescuestation_stage != 1001) {
				missionVariables.rescuestation_reputation -= 5; // bringing it back at all does reduce the penalty
		}
}

this.cleanupMission = function() {
		worldScripts[&quot;Rescue Scenario 3&quot;].cleanupMission();
}

this.missionOfferDecision = function (choice) {
		worldScripts[&quot;Rescue Scenario 3&quot;].missionOfferDecision(choice);
}

/* Mission functions */

this.makeAsteroidField = function() {
		worldScripts[&quot;Rescue Scenario 3&quot;].makeAsteroidField();
}

this.collectBox = function() {
		worldScripts[&quot;Rescue Scenario 3&quot;].collectBox();
}

this.spawnAssassin = function() {
		var numass = 2+worldScripts[&quot;Rescue Stations&quot;].dangerScale(128);

		var assassins = system.addShips(&quot;rrs-vicious-hunter&quot;,numass,player.ship.position.add(Vector3D.random(14E3),1E3));
		for (var i=0;i&lt;assassins.length;i++) {
				var assassin = assassins[i];
				assassin.target = player.ship;
				assassin.setAI(&quot;interceptAI.plist&quot;);
		}

}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_3a_blackbox.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Scenario 3a Black Box&quot;;
this.description = &quot;Scenario 3 Black Box script&quot;;

this.shipWasScooped = function (scooper) {
		if (scooper.isPlayer) {
				
				player.consoleMessage(&quot;Black box retrieved!&quot;,10);

				worldScripts[&quot;Rescue Scenario 3&quot;].collectBox();
				
		} else {
				player.consoleMessage(&quot;Someone else has reached the black box first.&quot;,5);
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		}
}

this.shipDied = function() {
		if (missionVariables.rescuestation_stage &lt; 100) {
				player.consoleMessage(&quot;The black box has been destroyed.&quot;,5);
				worldScripts[&quot;Rescue Stations&quot;].failMission();
			
		}
}

this.findPlayer = function() {
		if (player.ship.position.distanceTo(this.ship.position) &lt; 7E3) {
				this.ship.commsMessage(&quot;Ping!&quot;);
				// pretty much necessary to locate the black box, but it&#39;s not just the player&#39;s attention it attracts
				var ambushers = system.shipsWithPrimaryRole(&quot;rrs_asteroid_ambusher&quot;,this.ship,25600);
				for(var i=0;i&lt;ambushers.length;i++) {
						ambushers[i].reactToAIMessage(&quot;AMBUSH_IS_GO&quot;);
				}
		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_4.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 4&quot;; 
this.description = &quot;This script adds scenario 4 rescue mission.&quot;; 

//added long range map to the mission screens -spara-
//fixed description expand bug -spara-

this.scenarioID = &quot;4&quot;;

this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerScenario(this.scenarioID);

}

this.missionAvailableCount = function() {
		var mac = Math.floor(Math.sqrt(1+(Math.random()*9))); // probably 1 or 2, rarely 3
		if (mac&lt;1) { return 1; }
		return mac;
}

this.missionAvailable = function() {
		if (missionVariables.rescuestation_reputation &lt; 10) {
				return false; // need some rep to start doing these
		}
		if (player.bounty &gt; 50) {
				return false; // no fugitives
		}
		if (Math.random() &gt; 0.7) {
				return false; // often available
		}
		var nearby = this.targetSystems();
		if (nearby.length == 0) {
				return false; // nowhere suitable (unlikely!)
		}
		return true;
}

this.targetSystems = function() {
		return SystemInfo.filteredSystems(this, function (other) {
				if (!( (other.systemID !== system.info.systemID) &amp;&amp; 
						(!other.sun_gone_nova) &amp;&amp;
						(other.government &lt;= 4) &amp;&amp; // communist or less
						(system.info.distanceToSystem(other) &gt; 7) &amp;&amp;
							 (system.info.distanceToSystem(other) &lt; 15))) {
						return false;
				} else {
						var route = system.info.routeToSystem(other);
						return (route &amp;&amp; route.distance &lt;= 25);
				}
		});
}


this.initMissionVariables = function() {

		missionVariables.rescuestation_system = system.ID;
		missionVariables.rescuestation_system_name = system.name; 
		var systems = this.targetSystems();
		
		var destsystem = systems[Math.floor(Math.random()*systems.length)];
		
		missionVariables.rescuestation_destsystem = destsystem.systemID;
		missionVariables.rescuestation_destsystem_name = destsystem.name;

		var direction = worldScripts[&quot;Rescue Stations&quot;].getDirection(system.info,destsystem);
		missionVariables.rescuestation_destsystem_desc = destsystem.name+&quot; (&quot;+expandDescription(&quot;[rescue_govname_&quot;+destsystem.government+&quot;]&quot;)+&quot;, &quot;+Math.round(system.info.distanceToSystem(destsystem))+&quot; LY &quot;+direction+&quot;)&quot;;

		var deadline = clock.seconds+(3600*system.info.routeToSystem(destsystem).time*(2.2+Math.random()));
		missionVariables.rescuestation_deadline = deadline;
		missionVariables.rescuestation_deadline_text = clock.clockStringForTime(deadline);

		missionVariables.rescuestation_pilot = randomName()+&quot; &quot;+randomName();
		missionVariables.rescuestation_pilotdesc = randomInhabitantsDescription(false);

		var reward = Math.floor((3*system.info.routeToSystem(destsystem).distance-destsystem.government) * 15);

		missionVariables.rescuestation_reward = reward;
}

this.rescue_shipDockedWithStation = function (rstation) {
		
		if (rstation.hasRole(&quot;rescue_station&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_system &amp;&amp; missionVariables.rescuestation_stage &gt;= 100) {
				if (clock.seconds &lt; missionVariables.rescuestation_deadline) {
						missionVariables.rescuestation_stage = 1000;
				} else {
						missionVariables.rescuestation_stage = 1001;
				}
		} else if (rstation.isMainStation &amp;&amp; system.ID == missionVariables.rescuestation_destsystem &amp;&amp; missionVariables.rescuestation_stage &lt; 100) {
				missionVariables.rescuestation_stage = 100;
		}

}

this.rescue_missionScreenOpportunity = function() {
		if (worldScripts[&quot;Rescue Stations&quot;].restoreDestination) {
			player.ship.targetSystem = worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
			delete worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
		}
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;Personnel recovery needed&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_4_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_nonurgent_mission_choices_map&quot;,
														model: &quot;rescue_station&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				player.credits += reward;

				mission.runScreen({title: &quot;Recovery completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4_mission_complete&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();
		} else if (missionVariables.rescuestation_stage == 1001) {
				var reward = missionVariables.rescuestation_reward;
				player.credits += reward;

				mission.runScreen({title: &quot;Recovery completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4_mission_toolate&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].failMission();

		} else if (missionVariables.rescuestation_stage == 100) {
				mission.runScreen({title: &quot;Pilot rescued&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4_mission_rescue&quot;,
													 model: player.ship.dockedStation.primaryRole,
													 background: &quot;rrsfl_blank_bg.png&quot;});

				mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
				mission.markSystem({system: missionVariables.rescuestation_system, name: &quot;RRS&quot;});

				missionVariables.rescuestation_stage = 101;
		}
}


this.rescue_shipWillLaunchFromStation = function (rstation) {

}


this.rescue_shipExitedWitchspace = function() {
		if (missionVariables.rescuestation_stage &lt; 100 &amp;&amp; clock.seconds &gt; missionVariables.rescuestation_deadline) {
				player.commsMessage(missionVariables.rescuestation_system_name+&quot; RRS: We&#39;ve managed to get commercial transport for &quot;+missionVariables.rescuestation_pilot+&quot;. Try to be a bit more prompt in future or there&#39;s no point hiring you!&quot;);
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		}

}

/* Mission setup */

this.missionSuccess = function() {
		missionVariables.rescuestation_reputation += 10;
		// nothing special		
}

this.failMission = function () {
		if (missionVariables.rescuestation_stage &gt; 100) {
				mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
		} else {
				mission.unmarkSystem({system: missionVariables.rescuestation_startsystem, name: &quot;RRS&quot;});
		}
		if (missionVariables.rescuestation_stage != 1001) {
				missionVariables.rescuestation_reputation -= 10; // no rep penalty if they were retrieved
		}
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_system;
		delete missionVariables.rescuestation_system_name;
		delete missionVariables.rescuestation_destsystem;
		delete missionVariables.rescuestation_destsystem_name;
		delete missionVariables.rescuestation_destsystem_desc;
		delete missionVariables.rescuestation_deadline;
		delete missionVariables.rescuestation_deadline_text;
		delete missionVariables.rescuestation_pilot;
		delete missionVariables.rescuestation_pilotdesc;
}


this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		} 
		else if (choice === &quot;MAP&quot;) {
			worldScripts[&quot;Rescue Stations&quot;].restoreDestination = player.ship.targetSystem;
			player.ship.targetSystem = missionVariables.rescuestation_destsystem;
				mission.runScreen ({title: &quot;Personnel recovery needed&quot;,
														screenID: &quot;rrs_mission_map&quot;,
														backgroundSpecial: &quot;LONG_RANGE_CHART_QUICKEST&quot;
														},
														worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_missionScreenOpportunity
													);
		}
		else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Good luck&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4_mission_accepted&quot;,
													 model: &quot;rescue_station&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													function (choice) {
															worldScripts[&quot;Rescue Stations&quot;].acceptMission();
															worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_4_description&quot;);
													}
												 );
				mission.markSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
				
		}
}

/* Mission functions */

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_4a.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 4a&quot;; 
this.description = &quot;This script adds scenario 4a rescue mission.&quot;; 

//added long range map to the mission screens -spara-
//removed beacon buoy and added beacon to the base instead -spara-
//fixed description expand bug -spara-
//added background images to mission screens -spara-

this.scenarioID = &quot;4a&quot;;

/* Stages:
 * 2: mission accepted
 * 10: base location given
 * 30: base has launched slaver
 * 40: slaver launching pods
 * 41-45: slaver pods collected
 * 100: rescue complete
 * 1000: mission complete
 * 1001: mission completed too late
 */

this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerVariant(&quot;4&quot;,this.scenarioID);
}

this.missionAvailable = function() {

		if (Math.random() &gt; 0.6) {
				return false; // often available
		}
		if (worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;4&quot;) == 0) {
				return false; // must complete one base one before any variants start appearing
		}
		if (missionVariables.rescuestation_reputation &lt; 20) {
				return false; // need some rep to start doing these
		}
		if (player.bounty &gt; 50) {
				return false; // no fugitives
		}
		if (player.ship.equipmentStatus(&quot;EQ_FUEL_SCOOPS&quot;) != &quot;EQUIPMENT_OK&quot;) {
				return false; // needs fuel scoops, secretly
		}
		if (player.ship.equipmentStatus(&quot;EQ_ADVANCED_COMPASS&quot;) != &quot;EQUIPMENT_OK&quot;) {
				return false; // needs advanced compass, secretly
		}
		var nearby = this.targetSystems();
		if (nearby.length == 0) {
				return false; // nowhere suitable (rare!)
		}
		return true;
}

this.targetSystems = function() {
		return SystemInfo.filteredSystems(this, function (other) {
				if (!((other.systemID !== system.info.systemID) &amp;&amp; 
						(!other.sun_gone_nova) &amp;&amp;
						(other.government &lt;= 1) &amp;&amp; // feudal or less
							(system.info.distanceToSystem(other) &lt; 15))) {
						return false;
				} else {
						var route = system.info.routeToSystem(other);
						return (route &amp;&amp; route.distance &lt;= 25);
				}
		});
}


this.initMissionVariables = function() {

		missionVariables.rescuestation_system = system.ID;
		missionVariables.rescuestation_system_name = system.name; 
		var systems = this.targetSystems();
		
		var destsystem = systems[Math.floor(Math.random()*systems.length)];
		
		missionVariables.rescuestation_destsystem = destsystem.systemID;
		missionVariables.rescuestation_destsystem_name = destsystem.name;

		var direction = worldScripts[&quot;Rescue Stations&quot;].getDirection(system.info,destsystem);
		missionVariables.rescuestation_destsystem_desc = destsystem.name+&quot; (&quot;+expandDescription(&quot;[rescue_govname_&quot;+destsystem.government+&quot;]&quot;)+&quot;, &quot;+Math.round(system.info.distanceToSystem(destsystem))+&quot; LY &quot;+direction+&quot;)&quot;;

		var deadline = clock.seconds+(3600*system.info.routeToSystem(destsystem).time*(2.2+Math.random()));
		missionVariables.rescuestation_deadline = deadline;
		missionVariables.rescuestation_deadline_text = clock.clockStringForTime(deadline);

		missionVariables.rescuestation_pilot = randomName()+&quot; &quot;+randomName();
		missionVariables.rescuestation_pilotdesc = randomInhabitantsDescription(false);

		var reward = Math.floor((3*system.info.routeToSystem(destsystem).distance-destsystem.government) * 15);

		missionVariables.rescuestation_reward = reward;


		var danger1 = 2+worldScripts[&quot;Rescue Stations&quot;].dangerScale(256); 
		var danger2 = 3+worldScripts[&quot;Rescue Stations&quot;].dangerScale(128);

		missionVariables.rescuestation_danger1 = danger1;
		missionVariables.rescuestation_danger2 = danger2;

}

this.rescue_shipDockedWithStation = function (rstation) {

		if (rstation.hasRole(&quot;rescue_station&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_system &amp;&amp; missionVariables.rescuestation_stage &gt;= 100) {
				if (clock.seconds &lt; missionVariables.rescuestation_deadline) {
						missionVariables.rescuestation_stage = 1000;
				} else {
						missionVariables.rescuestation_stage = 1001;
				}
		} else if (rstation.isMainStation &amp;&amp; system.ID == missionVariables.rescuestation_destsystem &amp;&amp; missionVariables.rescuestation_stage &lt; 10) {
				missionVariables.rescuestation_stage = 10;
		} else if (missionVariables.rescuestation_stage &gt;= 40 &amp;&amp; missionVariables.rescuestation_stage &lt; 50) {
				if (rstation.isMainStation || rstation.hasRole(&quot;rescue_station&quot;)) {
						var rescued = missionVariables.rescuestation_stage-40;
						if (rescued == 0) {
								player.consoleMessage(&quot;You&#39;re out of leads. &quot;+missionVariables.rescuestation_pilot+&quot; is either dead or MIA.&quot;);
								worldScripts[&quot;Rescue Stations&quot;].failMission();
						} else if (Math.random()*5 &lt; rescued) {
								missionVariables.rescuestation_stage = 90; // rescued!
								player.credits += rescued*50;
								missionVariables.rescuestation_reputation += rescued;
						} else {
								missionVariables.rescuestation_stage = 80; // missed their pod
								player.credits += rescued*50;
								missionVariables.rescuestation_reputation += rescued*5;
								// going to get hit for -30 for failing, so give some mitigation for doing roughly the right thing
						}
						worldScripts[&quot;Rescue News&quot;].sendNews(&quot;rescue_scenario_4a_news&quot;,0,0.02*rescued); // maybe someone famous was rescued?


						missionVariables.rescuestation_reward2 = rescued*50;

				}
		}

}

this.rescue_missionScreenOpportunity = function() {
		if (worldScripts[&quot;Rescue Stations&quot;].restoreDestination) {
			player.ship.targetSystem = worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
			delete worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
		}
		var rstation = player.ship.dockedStation;
		if (rstation.hasRole(&quot;rrs_slaverbase&quot;)) {
				mission.runScreen ({title: &quot;That was a bad idea&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_slaverbase_eject&quot;,
														model: &quot;rrs_slaverbase&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 this.slaverEjectPlayer
													);
		} else if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;Personnel recovery needed&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_4a_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_nonurgent_mission_choices_map&quot;,
														model: &quot;rescue_station&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				player.credits += reward;

				mission.runScreen({title: &quot;Recovery completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4a_mission_complete&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();
		} else if (missionVariables.rescuestation_stage == 1001) {
				var reward = missionVariables.rescuestation_reward;
				player.credits += reward;

				mission.runScreen({title: &quot;Recovery completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4a_mission_toolate&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].failMission();

		} else if (missionVariables.rescuestation_stage == 10) {
				mission.runScreen({title: &quot;Bad news&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4a_mission_contacts&quot;,
													 model: &quot;police&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;});

				this.markSlavers();
				worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_4a_description&quot;);
				
				missionVariables.rescuestation_stage = 11;
		} else if (missionVariables.rescuestation_stage == 80) {
				if (rstation.hasRole(&quot;rescue_station&quot;)) {
						var mmodel = &quot;rescue_station&quot;;
				} else {
						var mmodel = &quot;police&quot;;
				}
				mission.runScreen({title: &quot;Mission failed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4a_mission_partfail&quot;,
													 model: mmodel,
													 background: &quot;rrsfl_blank_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].failMission();
		} else if (missionVariables.rescuestation_stage == 90) {
				if (rstation.hasRole(&quot;rescue_station&quot;)) {
						var mmodel = &quot;rescue_station&quot;;
				} else {
						var mmodel = &quot;police&quot;;
				}
				mission.runScreen({title: &quot;Pilot rescued!&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4a_mission_rescued1&quot;,
													 model: mmodel,
													 background: &quot;rrsfl_blank_bg.png&quot;});
				if (rstation.hasRole(&quot;rescue_station&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_system) {
						if (clock.seconds &lt; missionVariables.rescuestation_deadline) {
								missionVariables.rescuestation_stage = 1000;
						} else {
								missionVariables.rescuestation_stage = 1001;
						}
				} else {
						missionVariables.rescuestation_stage = 91;
				}
				mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
		} else if (missionVariables.rescuestation_stage == 91) {
				mission.runScreen({title: &quot;Pilot rescued!&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4a_mission_rescued2&quot;,
													 model: player.ship.dockedStation.primaryRole,
													 background: &quot;rrsfl_blank_bg.png&quot;});

// in case the home station is the first one visited
				if (rstation.hasRole(&quot;rescue_station&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_system) {
						if (clock.seconds &lt; missionVariables.rescuestation_deadline) {
								missionVariables.rescuestation_stage = 1000;
						} else {
								missionVariables.rescuestation_stage = 1001;
						}
				} else {
						missionVariables.rescuestation_stage = 100;
						mission.markSystem({system: missionVariables.rescuestation_system, name: &quot;RRS&quot;});
				}
				mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});

		}

}


this.rescue_populatingSystem = function (rstation) {
		if (system.ID == missionVariables.rescuestation_destsystem) {
				this.addSlaverBase();
		}
}


this.rescue_shipExitedWitchspace = function() {
		if (missionVariables.rescuestation_stage &lt; 10 &amp;&amp; clock.seconds &gt; missionVariables.rescuestation_deadline) {
				player.commsMessage(missionVariables.rescuestation_system_name+&quot; RRS: We&#39;ve just received news that &quot;+missionVariables.rescuestation_pilot+&quot; has been captured by slavers and taken out of the system. Return to base: we&#39;ll get someone more reliable to track them down.&quot;);
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		}

}

/* Mission setup */

this.missionSuccess = function() {
		mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
		mission.unmarkSystem({system: missionVariables.rescuestation_system, name: &quot;RRS&quot;});
		missionVariables.rescuestation_reputation += 10;
		// nothing special		
}

this.failMission = function () {
		if (missionVariables.rescuestation_stage &lt; 100) {
				mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
		} else {
				mission.unmarkSystem({system: missionVariables.rescuestation_system, name: &quot;RRS&quot;});
		}
		if (missionVariables.rescuestation_stage != 1001) {
				missionVariables.rescuestation_reputation -= 30; // really bad
		}
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_reward2;
		delete missionVariables.rescuestation_system;
		delete missionVariables.rescuestation_system_name;
		delete missionVariables.rescuestation_destsystem;
		delete missionVariables.rescuestation_destsystem_name;
		delete missionVariables.rescuestation_destsystem_desc;
		delete missionVariables.rescuestation_deadline;
		delete missionVariables.rescuestation_deadline_text;
		delete missionVariables.rescuestation_pilot;
		delete missionVariables.rescuestation_pilotdesc;
		delete missionVariables.rescuestation_danger1;
		delete missionVariables.rescuestation_danger2;
		for (var i = 1; i &lt;= 5; i++)
			player.ship.removeEquipment(&quot;EQ_RRS_CARGO_HOLDER&quot; + i);
		mission.setInstructions(null, &quot;Rescue Scenario 4a&quot;);
}


this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		}
		else if (choice === &quot;MAP&quot;) {
			worldScripts[&quot;Rescue Stations&quot;].restoreDestination = player.ship.targetSystem;
			player.ship.targetSystem = missionVariables.rescuestation_destsystem;
				mission.runScreen ({title: &quot;Personnel recovery needed&quot;,
														screenID: &quot;rrs_mission_map&quot;,
														backgroundSpecial: &quot;LONG_RANGE_CHART_QUICKEST&quot;
														},
														worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_missionScreenOpportunity
													);
		}		
		 else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Good luck&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4_mission_accepted&quot;,
													 model: &quot;rescue_station&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													function (choice) {
															worldScripts[&quot;Rescue Stations&quot;].acceptMission();
															worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_4_description&quot;);
													}
												 );
				mission.markSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
				
		}
}

/* Mission functions */


this.addSlaverBase = function() {
		
				var pos = Vector3D(0, 0, 0.5).fromCoordinateSystem(&quot;wpu&quot;);
				var xrange = Math.random();
				var yrange = Math.sqrt(1-(xrange*xrange));
				if (Math.random() &lt; 0.5) { xrange = -xrange; }
				if (Math.random() &lt; 0.5) { yrange = -yrange; }
				var distance = 100E3+(Math.random()*100E3);
				var sbpos = pos.add([xrange*distance,yrange*distance,0]);
				
				var slaverbase = system.addShips(&quot;rrs_slaverbase&quot;,1,sbpos,20E3);
				slaverbase[0].orientation = Quaternion.random();

				var pirates = system.addGroup(&quot;pirate&quot;,missionVariables.rescuestation_danger1+Math.floor(Math.random()*missionVariables.rescuestation_danger2),slaverbase[0].position,10E3);

				for (var i=0;i&lt;pirates.ships.length;i++) {
						pirates.ships[i].setScript(&quot;rescue_scenario_4a_sbdef.js&quot;);
						pirates.ships[i].switchAI(&quot;rescue_scenario_4a_sbdefAI.plist&quot;);
						pirates.ships[i].primaryRole = &quot;sbdefender&quot;;
						pirates.ships[i].bounty += Math.floor(Math.random()*50);
				}
				if (missionVariables.rescuestation_stage &gt; 10) {
						this.markSlavers();
				}

}

this.markSlavers = function() {
		var getsb = system.shipsWithRole(&quot;rrs_slaverbase&quot;);
		getsb[0].beaconCode = &quot;Slaver Base&quot;;
}

this.slaverEjectPlayer = function(choice) {
		player.ship.energy = 10;
		player.ship.forwardShield = 0;
		player.ship.aftShield = 0;
		player.ship.launch();
		rstation.commsMessage(&quot;And stay out!&quot;);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_4a_sbdef.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Scenario 4a Slaver Defence&quot;;
this.description = &quot;Rescue Scenario 4a: defense ship script&quot;;

this.baseCoords = function() {
		var getsb = system.shipsWithRole(&quot;rrs_slaverbase&quot;);
		if (getsb.length &gt; 0) {
				var buoypos = getsb[0].position.add(getsb[0].vectorForward.multiply(5E3));
				this.ship.savedCoordinates = buoypos;
				this.ship.reactToAIMessage(&quot;FOUND_BASE&quot;);
		} else {
				this.ship.reactToAIMessage(&quot;NO_BASE&quot;);
		}
}

this.shipTargetLost = function() {
		if (this.ship.AI == &quot;interceptAI.plist&quot;) {
				this.ship.exitAI();
		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_4a_slaver.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Scenario 4a Slave Trader&quot;;
this.description = &quot;Rescue Scenario 4a: slave trader script&quot;;

this.storedslaves = 5;
this.ejectiontimer = null;
this.$plotHint = true;

this.checkEnergy = function() {
		if (this.ship.energy &lt; this.ship.maxEnergy/3) {
				this.ejectSlaves();
		}
}

this.ejectSlaves = function() {
		if (this.ejectiontimer == null) {
				this.ejectiontimer = new Timer(this,this.ejectSlave,1,2);
				this.ship.commsMessage(&quot;Take my cargo, but let me go!&quot;);
		} else if (this.storedslaves == 0) {
				this.ship.reactToAIMessage(&quot;JUMP_AWAY&quot;);
		}
}		

this.shipDied = function() {
		if (missionVariables.rescuestation_stage == 30) {
				// destroyed before could eject cargo
				this.ship.spawn(&quot;rrs_slaver_pod&quot;,2); // might get lucky
		} else if (missionVariables.rescuestation_stage &lt; 35) {
				this.ship.spawn(&quot;rrs_slaver_pod&quot;,1); // might get lucky
		} else if (missionVariables.rescuestation_stage &lt; 40) {
				missionVariables.rescuestation_stage = 40;
		}
}

this.ejectSlave = function() {
	if (this.storedslaves &gt; 0) {
		if (this.$plotHint) {
			player.consoleMessage(missionVariables.rescuestation_pilot + &quot; must be in one of those pods! Collect them and return to &quot; + missionVariables.rescuestation_system_name + &quot; RRS.&quot;);
			this.$plotHint = false;
		}
		//this.ship.speed = 0;
		this.ship.ejectSpecificItem(&quot;rrs_slaver_pod&quot;);
		//this.ship.speed = this.ship.maxSpeed;
		if (missionVariables.rescuestation_stage &lt; 40) //don&#39;t add, if collecting is already in process.
			missionVariables.rescuestation_stage++;
		this.storedslaves--;
	} else {
			this.ejectiontimer.stop();
			if (missionVariables.rescuestation_stage &lt; 40) {
					missionVariables.rescuestation_stage = 40;
			}
			this.ship.reactToAIMessage(&quot;JUMP_AWAY&quot;);
	}
}

this.leaveSystem = function() {
		this.ship.exitSystem();
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_4a_slaverbase.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Scenario 4a Slaver Base&quot;;
this.description = &quot;Rescue Scenario 4a: base AI and ship launching&quot;;

this.underAttack = function() {
		var defenders = system.countShipsWithRole(&quot;sbdefender&quot;,this.ship,25600);
		if (defenders == 0 || this.ship.energy &lt; this.ship.maxEnergy/3) {
				if (worldScripts[&quot;Rescue Stations&quot;].missionActive()) {
						if (missionVariables.rescuestation_stage &lt; 30) {
								this.ship.launchShipWithRole(&quot;rrs-slavetrader&quot;,true);
								this.ship.commsMessage(&quot;Abandon ship!&quot;);
								// emergency launch before the station is destroyed!
								missionVariables.rescuestation_stage = 30;

						}
				}
		}
}

this.stationLaunchedShip = function(whom) {
		if (whom != player.ship) {
				whom.bounty += 5+Math.floor(5*Math.random());
				whom.bounty = whom.bounty * 2;
		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_4a_slaverpod.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Scenario 4a Slave Pod&quot;;
this.description = &quot;Rescue Scenario 4a: slave pod script&quot;;

this.shipWasScooped = function(scooper) {
	if (scooper == player.ship) {
		if (missionVariables.rescuestation_stage &lt; 41) {
				missionVariables.rescuestation_stage = 41;
		} else if (missionVariables.rescuestation_stage &lt; 45) {
				missionVariables.rescuestation_stage++;
		}
		var podNumber = missionVariables.rescuestation_stage - 40;
		player.ship.awardEquipment(&quot;EQ_RRS_CARGO_HOLDER&quot; + podNumber);
		mission.setInstructions(&quot;Special Cargo: &quot; + podNumber + &quot; TC Rescued slaves.&quot;, &quot;Rescue Scenario 4a&quot;);
		player.consoleMessage(&quot;1 TC Rescued slaves&quot;);
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_4b.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 4b&quot;; 
this.description = &quot;This script adds scenario 4b rescue mission.&quot;; 

//added background image to mission screens -spara-

this.scenarioID = &quot;4b&quot;;

this.agenttimer = undefined;
this.agenttimer2 = undefined;

/* Stages:
 * 2: mission accepted
 * 10: meet with agent
 * 20: met with agent
 * 30: reached astromine (deadline applies)
 * 40: waiting for hacking
 * 50: roster hacked
 * 70: player launches
 * 80: miner launches
 * 90: system ships go hostile (will need a non-following AI)
 * 100: reached home system
 * 900: miner docks with RRS
 * 1000: mission complete
 * 1001: redock with astromine after launching (fails, badly)
 * 1002: arrive at astromine too late (already dead)
 */

this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerVariant(&quot;4&quot;,this.scenarioID);
}

this.missionAvailable = function() {

		if (worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;4a&quot;) == 0) {
				return false; // must complete one normal slave rescue first
		}
		if (missionVariables.rescuestation_reputation &lt; 80) {
				return false; // Tier 4 Contractor
		}
		if (worldScripts[&quot;Rescue Stations&quot;].scenariosTried(&quot;4b&quot;) &gt; worldScripts[&quot;Rescue Stations&quot;].scenariosTried(&quot;4a&quot;)*10) {
				return false; // relatively rare
		}
		if (player.ship.equipmentStatus(&quot;EQ_RRS_FLIGHTFORM&quot;) != &quot;EQUIPMENT_OK&quot;) {
				return false; // needs formation flight computer, secretly
		}
		var nearby = this.targetSystems();
		if (nearby.length == 0) {
				return false; // nowhere suitable (often the case)
		}
		if (Math.random() &lt; 0.3) {
				return true; // sometimes available in that case
		}
		return false;
}

this.targetSystems = function() {
		return SystemInfo.filteredSystems(this, function (other) {
				return (other.systemID !== system.info.systemID) &amp;&amp; 
						(!other.sun_gone_nova) &amp;&amp;
						(other.government == 4) &amp;&amp; // communist
						(system.info.distanceToSystem(other) &lt; 7);
		});
}

this.initMissionVariables = function() {

		missionVariables.rescuestation_system = system.ID;
		missionVariables.rescuestation_system_name = system.name; 
		var systems = this.targetSystems();
		
		var destsystem = systems[Math.floor(Math.random()*systems.length)];
		
		missionVariables.rescuestation_destsystem = destsystem.systemID;
		missionVariables.rescuestation_destsystem_name = destsystem.name;
		
		var deadline = clock.seconds+(3600*system.info.routeToSystem(destsystem).time*(1.5+Math.random()));
		missionVariables.rescuestation_deadline = deadline;

		missionVariables.rescuestation_pilot = randomName()+&quot; &quot;+randomName();
		missionVariables.rescuestation_pilotdesc = randomInhabitantsDescription(false);

		missionVariables.rescuestation_agent = randomName()+&quot; &quot;+randomName();
		missionVariables.rescuestation_agentdesc = randomInhabitantsDescription(false);

		missionVariables.rescuestation_reward = 1250;
}

this.rescue_shipDockedWithStation = function (rstation) {
		var stage = missionVariables.rescuestation_stage;
		if (rstation.hasRole(&quot;rescue_station&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_system &amp;&amp; stage &gt;= 900) {
				missionVariables.rescuestation_stage = 1000;
		} else if (rstation.isMainStation &amp;&amp; system.ID == missionVariables.rescuestation_destsystem &amp;&amp; stage &lt; 10) {
				missionVariables.rescuestation_stage = 10;
		} else if (rstation.hasRole(&quot;rrs_astromine&quot;) &amp;&amp; stage &gt;= 20 &amp;&amp; stage &lt; 30) {
				if (clock.seconds &lt; missionVariables.rescuestation_deadline) {
						missionVariables.rescuestation_stage = 30;
				} else {
						missionVariables.rescuestation_stage = 1002;
				}
		} else if (rstation.hasRole(&quot;rrs_astromine&quot;) &amp;&amp; stage &gt; 70) {
				missionVariables.rescuestation_stage = 1001;
		}
}

this.rescue_missionScreenOpportunity = function() {
		var stage = missionVariables.rescuestation_stage;

		if (stage == 1) {
				mission.runScreen ({title: &quot;Urgent assistance needed&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_4b_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_nonurgent_mission_choices&quot;,
														model: &quot;rescue_station&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 this.missionOfferDecision
													);
		} else if (stage == 10) {
				mission.runScreen ({title: &quot;The situation is bad&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_4b_meetagent&quot;,
														model: &quot;rrs_astromine&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;});
				missionVariables.rescuestation_stage = 20;
		} else if (stage == 30) {
				mission.runScreen ({title: &quot;Be ready to leave fast&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_4b_splitup&quot;,
														model: &quot;rrs_astromine&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;});
				missionVariables.rescuestation_stage = 40;
				this.agenttimer = clock.seconds
				// start timer to set stage to 50
		} else if (stage == 50) {
				mission.runScreen ({title: &quot;Here&#39;s the plan&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_4b_timetogo&quot;,
														model: &quot;rrs_astromine&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;});
				missionVariables.rescuestation_stage = 60;
		} else if (stage == 1000) {
				player.credits += missionVariables.rescuestation_reward;
				mission.runScreen({title: &quot;Recovery completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4b_mission_complete&quot;,
													 background: &quot;rrsfl_bg.png&quot;});
				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();
		} else if (stage == 1001) {
				mission.runScreen({title: &quot;What are we doing back here?&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4b_mission_gowrong&quot;,
													 background: &quot;rrsfl_bg.png&quot;});
				missionVariables.rescuestation_reputation -= 5; // seriously bad
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		} else if (stage == 1002) {
				mission.runScreen({title: &quot;We&#39;re too late&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4b_mission_toolate&quot;,
													 background: &quot;rrsfl_bg.png&quot;});
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		}

}

this.rescue_guiScreenChanged = function(to, from) {
		if (player.ship.dockedStation &amp;&amp; player.ship.dockedStation.hasRole(&quot;rrs_astromine&quot;)) {
				if (missionVariables.rescuestation_stage == 40) {
						if (this.agenttimer + 60 &lt; clock.seconds) {
								missionVariables.rescuestation_stage = 50;
						}
				}
				if (missionVariables.rescuestation_stage == 50) {
						if (guiScreen == to &amp;&amp; (from == &quot;GUI_SCREEN_STATUS&quot; || to == &quot;GUI_SCREEN_STATUS&quot;)) {
								this.rescue_missionScreenOpportunity();
						}
				}
		}
}

this.rescue_shipWillLaunchFromStation = function(rstation) {
		if (missionVariables.rescuestation_stage == 60) {
				missionVariables.rescuestation_stage = 70;
				system.addShips(&quot;rrs_astroguard&quot;,3,rstation.position,20E3);
				this.agenttimer = new Timer(this,rstation.script.launchRRS,30);
				this.agenttimer2 = new Timer(this,rstation.script.launchDefence,65);
		}
}

this.rescue_populatingSystem = function (rstation) {
		if (system.ID == missionVariables.rescuestation_destsystem) {
				this.addAstroMine();
		}
}

/* Mission setup */

this.missionSuccess = function() {
		missionVariables.rescuestation_reputation += 20;
		missionVariables.rescuestation_noentry = missionVariables.rescuestation_destsystem;
		missionVariables.rescuestation_noentrytime = clock.days;
		// special mission
}

this.failMission = function() {
		missionVariables.rescuestation_reputation -= 10;
		// special mission
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_system;
		delete missionVariables.rescuestation_system_name;
		delete missionVariables.rescuestation_destsystem;
		delete missionVariables.rescuestation_destsystem_name;
		delete missionVariables.rescuestation_deadline;
		delete missionVariables.rescuestation_pilot;
		delete missionVariables.rescuestation_pilotdesc;
		delete missionVariables.rescuestation_agent;
		delete missionVariables.rescuestation_agentdesc;
}

this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		} else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Good luck&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_4b_mission_accepted&quot;,
													 model: &quot;rescue_station&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													function (choice) {
															worldScripts[&quot;Rescue Stations&quot;].acceptMission();
															worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_4b_description&quot;);
													}
												 );
				mission.markSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
				
		}
}


/* Mission functions */

this.agentHacker = function() {
		if (missionVariables.rescuestation_stage &lt; 50) {
				missionVariables.rescuestation_stage = 50;
		}
}

this.addAstroMine = function() {
		
		var ampos = system.mainPlanet.position.add(system.mainPlanet.position.subtract(system.sun.position));
		system.addShips(&quot;rrs_astromine&quot;,1,ampos,5E3);
		system.addShips(&quot;asteroid&quot;,30,ampos,40E3);

}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_4b_astromine.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Scenario 4b Astromine&quot;;

// because of the way we call these two functions, this.ship doesn&#39;t work

this.launchRRS = function() {
		var ship = system.shipsWithRole(&quot;rrs_astromine&quot;)[0];
		if (missionVariables.rescuestation_stage == 70) {
				ship.launchShipWithRole(&quot;rrs_astrominer&quot;);
				missionVariables.rescuestation_stage = 80;
		}
}

this.launchDefence = function() {
		var ship = system.shipsWithRole(&quot;rrs_astromine&quot;)[0];
		ship.commsMessage(&quot;Miner, you are off course. Return to your assigned task or be destroyed!&quot;);
		if (missionVariables.rescuestation_stage &gt;= 80) {
				var a = system.shipsWithRole(&quot;rrs_astrominer&quot;,ship,25600);
				if (a.length &gt; 0) {
						ship.target = a[0];
						var police = system.shipsWithRole(&quot;rrs_astroguard&quot;,ship,25600);
						for (var i=0;i&lt;police.length;i++) {
								police[i].target = a[0];
								police[i].setAI(&quot;interceptAI.plist&quot;);
						}
				}
		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_4b_astrominer.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Scenario 4b Astrominer&quot;;

//changed naming to match random shipnames style. -spara-

this.shipLaunchedFromStation = function() {
		player.consoleMessage(&quot;Tight-beam: Follow us&quot;);
		this.ship.commsMessage(&quot;Acknowledged.&quot;);
}

this.shipExitedWormhole = function() {
		this.ship.bounty = 0;
}
this.shipWillEnterWormhole = function() {
		this.ship.bounty = 0;
}

this.shipDied = function(whom,why) {
		if (whom == player.ship) {
				missionVariables.rescuestation_reputation -= 100;
				player.commsMessage(missionVariables.rescuestation_agent+&quot;: You did what?! Well, I hope it was worth the credits.&quot;);
		} else if (why == &quot;removed&quot;) {
				player.commsMessage(missionVariables.rescuestation_agent+&quot;: Looks like they weren&#39;t able to follow us&quot;);
		}
		player.consoleMessage(&quot;Their escape craft has been destroyed&quot;);
		worldScripts[&quot;Rescue Stations&quot;].failMission();
}

this.shipTakingDamage = function(amount,whom,type) {
		if (this.ship.energy &gt; 0) {
				this.ship.commsMessage(&quot;Help!&quot;);
		}
}

this.shipDockedWithStation = function(station) {
		missionVariables.rescuestation_stage = 900;
		
		player.commsMessage(&quot;RRS: They&#39;re safe. Dock when ready.&quot;);
}

this.findPlayer = function() {
		if (this.ship.position.distanceTo(player.ship.position) &lt; 25000) {
				this.ship.savedCoordinates = player.ship.position;
				this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
		} else {
				this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;);
		}
}

this.decideSystem = function() {
		this.ship.displayName = this.ship.displayName + &quot;: &quot; + missionVariables.rescuestation_pilot;
		if (system.government == 4) {
				this.ship.reactToAIMessage(&quot;FIRST_SYSTEM&quot;);
				//this.ship.displayName = missionVariables.rescuestation_pilot+&quot; (escaping)&quot;;
		} else {
				this.ship.reactToAIMessage(&quot;SECOND_SYSTEM&quot;);
				//this.ship.displayName = missionVariables.rescuestation_pilot+&quot; (escaped)&quot;;
		}
}

this.getRRSLocation = function() {
		var rrs = system.shipsWithRole(&quot;rescue_station&quot;,this.ship);
		if (rrs.length == 0) {
				var location = system.mainStation.position;
		} else {
				var location = rrs[0].position;
		}
		this.ship.savedCoordinates = location;
}



this.autopilotModeReady = function() {
		this.autopilotwilling = 1;
}

this.autopilotModeOffline = function() {
		this.autopilotwilling = 0;
}

this.autopilotContinue = function() {
		worldScripts[&quot;Rescue Autopilot&quot;].autopilotStep(this.ship);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_5.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 5&quot;; 
this.description = &quot;This script adds scenario 5 rescue mission.&quot;; 

//added background images to mission screens -spara-
//changed naming scheme -spara-

this.scenarioID = &quot;5&quot;;



this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerScenario(this.scenarioID);
}

this.missionAvailableCount = function() {
		return 1;
}

this.missionAvailable = function() {
		if (missionVariables.rescuestation_reputation &lt; 10) {
				return false; // insufficient reputation
		}
		if (player.bounty &gt; 50) {
				return false; // no fugitives
		}
		if (Math.random() &lt; 0.2) {
				return true; // rarely available
		}
		return false;
}

this.initMissionVariables = function() {
		missionVariables.rescuestation_reward = 250;
		missionVariables.rescuestation_system = system.ID;
		missionVariables.rescuestation_shipname = expandDescription(&quot;[rescue_random_shipname]&quot;);
}

this.rescue_shipDockedWithStation = function (rstation) {
		
		if (rstation.hasRole(&quot;rescue_station&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_system &amp;&amp; missionVariables.rescuestation_stage == 100) {
				missionVariables.rescuestation_stage = 1000;
		} else {
				if (missionVariables.rescuestation_stage &gt; 1) {
						if (missionVariables.rescuestation_stage &lt; 1000) {
								player.commsMessage(&quot;You have docked before the rescue mission was complete. You will not be paid for this breach of contract!&quot;,7);
								worldScripts[&quot;Rescue Stations&quot;].failMission();
						}
				}
		}
}

this.rescue_missionScreenOpportunity = function() {
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;Emergency escort needed&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_5_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_urgent_mission_choices&quot;,
														model: &quot;rescue_station&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 this.missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				player.credits += reward;

				mission.runScreen({title: &quot;Escort mission completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_5_mission_complete&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();

		}
}

this.rescue_shipWillLaunchFromStation = function (rstation) {
		if (missionVariables.rescuestation_stage == 2 &amp;&amp; rstation.hasRole(&quot;rescue_station&quot;)) {

				var adddir = Vector3D.randomDirection();
				while (adddir.dot(rstation.vectorForward) &lt; -0.5) {
						adddir = Vector3D.randomDirection();
				}
				
				var tpos = rstation.position.add(adddir.multiply(15E3));
				var rpos = rstation.position.add(adddir.multiply(4E3));
				var ppos = rstation.position.add(adddir.multiply(25E3));

				var freighter = system.addShips(&quot;rescue_freighter&quot;,1,tpos,1E3);
				freighter[0].target = rstation;
				freighter[0].setAI(&quot;rescue_scenario_5_dockingAI.plist&quot;);
				freighter[0].setScript(&quot;rescue_scenario_5_freighter.js&quot;);
				freighter[0].displayName = freighter[0].name + &quot;: &quot; + missionVariables.rescuestation_shipname;

			
				var danger = 4+worldScripts[&quot;Rescue Stations&quot;].dangerScale(128);

				var pirates = system.addGroup(&quot;pirate&quot;,danger,ppos,5E3);
				for(var i=0;i&lt;pirates.ships.length;i++) {
						pirates.ships[i].setScript(&quot;rescue_scenario_5_pirate.js&quot;);
						if (pirates.ships[i].escorts) {
								for (var j=0;j&lt;pirates.ships[i].escorts.length;j++) {
										pirates.ships[i].escorts[j].setScript(&quot;rescue_scenario_5_pirate.js&quot;);
								}
						}
				}
				
				var escorts = freighter[0].escorts;
				for (var i=0;i&lt;escorts.length;i++) {
						escorts[i].switchAI(&quot;route1patrolAI.plist&quot;);
						escorts[i].target = pirates[Math.floor(Math.random()*pirates.length)];
						escorts[i].setAI(&quot;interceptAI.plist&quot;);
				}
				
				var defense = system.addShips(&quot;rrs-escort&quot;,2+Math.floor(Math.random()*2),rpos,2E3);
				for (var i=0;i&lt;defense.length;i++) {
						defense[i].switchAI(&quot;route1patrolAI.plist&quot;);
						defense[i].target = pirates[Math.floor(Math.random()*pirates.length)];
						defense[i].setAI(&quot;interceptAI.plist&quot;);
				}


				missionVariables.rescuestation_stage = 3;
		}

}

this.rescue_shipWillExitWitchspace = function() {
		if (missionVariables.rescuestation_stage &lt; 100) {
				player.consoleMessage(&quot;You have abandoned the rescue mission&quot;);
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		}
}



/* Mission functions */

this.missionSuccess = function() {
		missionVariables.rescuestation_reputation += 10;

		worldScripts[&quot;Rescue News&quot;].sendNews(&quot;rescue_scenario_5_news&quot;,3,0.05);
}

this.failMission = function () {
		missionVariables.rescuestation_reputation -= 5; // easy to fail through no fault of own
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_system;
		delete missionVariables.rescuestation_shipname;
}

this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		} else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Downloading mission data&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_5_mission_accepted&quot;,
													 choicesKey: &quot;rescue_scenario_urgent_mission_launch&quot;,
													 model: &quot;rrs-escort&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													worldScripts[&quot;Rescue Scenario 5&quot;].missionOfferAccepted
												 );
		}
}

this.missionOfferAccepted = function (choice) {
		worldScripts[&quot;Rescue Stations&quot;].acceptMission();
		worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_5_description&quot;);
		player.ship.fuel = 7;
		player.ship.launch();
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_5_freighter.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Scenario 5 Freighter&quot;;

this.lastdamagecomplaint = 0;

this.shipDied = function(whom,why) {
		this.ship.commsMessage(&quot;[rescue_argh]&quot;);
		var rstation = system.shipsWithPrimaryRole(&quot;rescue_station&quot;,player.ship,25600);
		if (rstation.length &gt; 0) {
				rstation[0].commsMessage(&quot;The [mission_rescuestation_shipname] has been destroyed. Clear the pirates then return to base.&quot;);
//				rstation[0].reactToAIMessage(&quot;DOCKING_ABORTED&quot;);
		}
		worldScripts[&quot;Rescue Stations&quot;].failMission();

		if (whom == player.ship) {
				missionVariables.rescuestation_reputation -= 20;
		}

}

this.shipWillDockWithStation = function(station) {
		station.commsMessage(&quot;The [mission_rescuestation_shipname] has docked safely. Contractors may dock when ready to be paid.&quot;);
		missionVariables.rescuestation_stage = 100;
}

this.shipTakingDamage = function(amount,whom,type) {
		if (this.ship.energy &gt; 0) {
				if (this.lastdamagecomplaint+10 &lt; clock.seconds) {
						this.lastdamagecomplaint = clock.seconds;
						if (this.ship.energy &gt; this.ship.maxEnergy/4) {
								this.ship.commsMessage(&quot;[rescue_underfire]&quot;);
						} else {
								this.ship.commsMessage(&quot;[rescue_underheavyfire]&quot;);
						}
				}				
		}
}


this.getDC = function() {
		var dc = this.ship.target.position.add(this.ship.target.vectorForward.multiply(3E3));
		this.ship.savedCoordinates = dc;
		this.ship.reactToAIMessage(&quot;CORRIDOR_POSITION&quot;);
}

this.getDB = function() {
		var db = this.ship.target.position;
		this.ship.savedCoordinates = db;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_5_pirate.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Scenario 5 Raider&quot;;

this.shipDied = function(whom,why) {
// because we replace the standard Thargoid shipscript
		if (this.ship.isThargoid) {
				this.ship.commsMessage(expandDescription(&quot;[thargoid_curses]&quot;));
		}

		if (whom == player.ship &amp;&amp; missionVariables.rescuestation_stage &lt; 100 &amp;&amp; missionVariables.rescuestation_stage &gt; 0) {
				missionVariables.rescuestation_reward += 50;
				if (Math.random() &lt; 0.3) {
						var rstation = system.shipsWithPrimaryRole(&quot;rescue_station&quot;,player.ship,25600);
						if (rstation.length &gt; 0) {
								rstation[0].commsMessage(&quot;[rescue_goodshot]&quot;);
						}
				}
		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_5a.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 5a&quot;; 
this.description = &quot;This script adds variant 5A rescue mission .&quot;; 

//added background images to mission screens -spara-
//naming tweaks -spara-

this.scenarioID = &quot;5a&quot;;
this.stagetimer = null;
this.notifytimer = null;

this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerVariant(&quot;5&quot;,this.scenarioID);
}


this.missionAvailable = function() {
		if (missionVariables.rescuestation_reputation &lt; 20) {
				return false; // insufficient reputation
		}
		if (worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;5a&quot;) &gt; worldScripts[&quot;Rescue Stations&quot;].scenariosWon(&quot;5&quot;)) {
				return false; // not too many
		}
		if (Math.random() &lt; 0.4) {
				return true; // often replaces
		}
		return false;
}

this.initMissionVariables = function() {
		missionVariables.rescuestation_reward = 350;
		missionVariables.rescuestation_system = system.ID;
		missionVariables.rescuestation_shipname = expandDescription(&quot;[rescue_wingnames]&quot;);
}

this.rescue_shipDockedWithStation = function (rstation) {
		
		if (rstation.hasRole(&quot;rescue_station&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_system &amp;&amp; missionVariables.rescuestation_stage == 100) {
				missionVariables.rescuestation_stage = 1000;
		} else {
				if (missionVariables.rescuestation_stage &gt; 1) {
						if (missionVariables.rescuestation_stage &lt; 1000) {
								player.commsMessage(&quot;You have docked before the rescue mission was complete. You will not be paid for this breach of contract!&quot;,7);
								worldScripts[&quot;Rescue Stations&quot;].failMission();
						}
				}
		}
}

this.rescue_missionScreenOpportunity = function() {
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;Emergency escort needed&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_5a_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_urgent_mission_choices&quot;,
														model: &quot;rescue_station&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 this.missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				player.credits += reward;

				mission.runScreen({title: &quot;Escort mission completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_5a_mission_complete&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();

		}
}

this.rescue_shipWillLaunchFromStation = function (rstation) {
		if (missionVariables.rescuestation_stage == 2 &amp;&amp; rstation.hasRole(&quot;rescue_station&quot;)) {

				this.stagetimer = new Timer(this,this.insertArafura,150);
				this.notifytimer = new Timer(this,this.notifyDeadline,30);

				missionVariables.rescuestation_stage = 3;
		}

}

this.rescue_shipWillExitWitchspace = function() {
		if (missionVariables.rescuestation_stage &lt; 100) {
				player.consoleMessage(&quot;You have abandoned the rescue mission&quot;);
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		}
}



/* Mission functions */

this.missionSuccess = function() {
		missionVariables.rescuestation_reputation += 10;
		// nothing special		
}

this.failMission = function () {
		missionVariables.rescuestation_reputation -= 5; // easy to fail through no fault of own
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_system;
		delete missionVariables.rescuestation_shipname;
}

this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		} else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Downloading mission data&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_5a_mission_accepted&quot;,
													 choicesKey: &quot;rescue_scenario_urgent_mission_launch&quot;,
													 model: &quot;rrs-escort&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													worldScripts[&quot;Rescue Scenario 5a&quot;].missionOfferAccepted
												 );
		}
}

this.missionOfferAccepted = function (choice) {
		worldScripts[&quot;Rescue Stations&quot;].acceptMission();
		worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_5a_description&quot;);
		player.ship.fuel = 7;
		player.ship.launch();
}

this.notifyDeadline = function() {
		var deadline = 5*Math.ceil(0.2*(this.stagetimer.nextTime - clock.absoluteSeconds));
		player.commsMessage(&quot;RRS: &quot;+missionVariables.rescuestation_shipname+&quot; wing ETA is &quot;+deadline+&quot; seconds&quot;);
		if (deadline &gt; 30) {
				this.notifytimer = new Timer(this,this.notifyDeadline,30);				
		} else {
				this.notifytimer = new Timer(this,this.notifyDeadline,5);
		}
}

this.insertArafura = function() {
		var arafura = system.addShips(&quot;arafura-returning&quot;,1,[0,0,0],5E3);
		
		this.notifytimer.stop();
		this.stagetimer = new Timer(this,this.insertOpposition,5+(10*Math.random()));

		arafura[0].displayName = arafura[0].displayName + &quot;: &quot; + missionVariables.rescuestation_shipname+&quot; Leader&quot;;
		arafura[0].commsMessage(&quot;[rescue_introuble]&quot;);
		arafura[0].escorts[0].displayName = arafura[0].escorts[0].displayName + &quot;: &quot; + missionVariables.rescuestation_shipname+&quot; &quot;+(2+Math.floor(Math.random()*5));

}

this.insertOpposition = function() {
		var opplevel = 2+worldScripts[&quot;Rescue Stations&quot;].dangerScale(256);
		var opptype = Math.random();
		if (opptype &lt; 0.6) {
				var opprole = &quot;pirate&quot;;
				opplevel = opplevel*2;
		} else if (opptype &lt; 0.9) {
				var opprole = &quot;rrs-vicious-hunter&quot;;
		} else if (opptype &lt; 0.98) {
				var opprole = &quot;thargoid&quot;; // just some basic ones
		} else {
				var opprole = &quot;thargoid-mothership&quot;; // allow tougher thargoids from OXPs
				opplevel = Math.floor(opplevel*0.75);
		}
		if (opplevel &lt; 1) {
				opplevel = 1;
		}

		
		var pirates = system.addShips(opprole,opplevel,[0,0,0],5E3);
		if (!pirates) {
				log(this.name,&quot;Couldn&#39;t add &quot;+opprole);
		}

		var arafura = system.shipsWithRole(&quot;arafura-returning&quot;);

		for(var i=0;i&lt;pirates.length;i++) {
				pirates[i].setScript(&quot;rescue_scenario_5_pirate.js&quot;);
				if (pirates[i].bounty == 0) {
						pirates[i].bounty = 1+Math.floor(Math.random()*5);
						pirates[i].switchAI(&quot;pirateAI.plist&quot;);
				}
				if (pirates[i].escorts) {
						for (var j=0;j&lt;pirates[i].escorts.length;j++) {
								pirates[i].escorts[j].setScript(&quot;rescue_scenario_5_pirate.js&quot;);
						}
				}
				if (Math.random() &lt; 0.5) {
						pirates[i].target = arafura[0];
				} else if (Math.random() &lt; 0.5) {
						pirates[i].target = arafura[0].escorts[0];
				} else {
						pirates[i].target = player.ship;
				}
				if (!pirates[i].isThargoid) {
						pirates[i].setAI(&quot;interceptAI.plist&quot;);
				}
		}
		
		var reinforce = Math.floor(opplevel/3);
		if (reinforce &lt; 1) {
				reinforce = 1;
		} else if (reinforce &gt; 4) {
				reinforce = 4;
		}
		var rpos = player.ship.position.add(system.mainPlanet.position.direction().multiply(24E3));
				
		var reinforcements = system.addShips(&quot;rrs-defender&quot;,reinforce,rpos,1E3);
		for (var i=0;i&lt;reinforcements.length;i++) {
				reinforcements[i].orientation = reinforcements[i].orientation.rotateY(Math.PI);
				reinforcements[i].target = pirates[Math.floor(Math.random()*pirates.length)];
				reinforcements[i].switchAI(&quot;policeInterceptAI.plist&quot;);
		}
		reinforcements[0].commsMessage(&quot;Reinforcements are coming! Keep them off the Arafura until we arrive, then we&#39;ll cover your escape.&quot;);
		
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_5a_arafura.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Scenario 5a Arafura&quot;;

this.lastdamagecomplaint = 0;

this.stationPosition = function() {
		var rstation = system.shipsWithPrimaryRole(&quot;rescue_station&quot;);
		if (rstation.length &gt; 0) {
				this.ship.savedCoordinates = rstation[0].position;
				this.ship.reactToAIMessage(&quot;RSTATION&quot;);
		}	else {
				this.ship.reactToAIMessage(&quot;NO_RSTATION&quot;);
		}
}

this.shipDied = function(whom,why) {
		this.ship.commsMessage(&quot;[rescue_argh]&quot;);
		var rstation = system.shipsWithPrimaryRole(&quot;rescue_station&quot;,player.ship,25600);
		if (rstation.length &gt; 0) {
				rstation[0].commsMessage(&quot;[mission_rescuestation_shipname] Leader has been destroyed. Clear the opposition then return to base.&quot;);
//				rstation[0].reactToAIMessage(&quot;DOCKING_ABORTED&quot;);
		}
		worldScripts[&quot;Rescue Stations&quot;].failMission();

		if (whom == player.ship) {
				missionVariables.rescuestation_reputation -= 20;
		}
}

this.shipWillDockWithStation = function(station) {
		station.commsMessage(&quot;[mission_rescuestation_shipname] Leader has docked safely. Contractors may dock when ready to be paid.&quot;);
		missionVariables.rescuestation_stage = 100;
}

this.shipTakingDamage = function(amount,whom,type) {
		if (this.ship.energy &gt; 0) {
				if (this.lastdamagecomplaint+10 &lt; clock.seconds) {
						this.lastdamagecomplaint = clock.seconds;
						if (this.ship.energy &gt; this.ship.maxEnergy/4) {
								this.ship.commsMessage(&quot;[rescue_underfire]&quot;);
						} else {
								this.ship.commsMessage(&quot;[rescue_underheavyfire]&quot;);
						}

						var ships = system.shipsWithPrimaryRole(&quot;rrs-defender&quot;);
						for (var i=0;i&lt;ships.length;i++) {
								if (!ships[i].target) {
										if (ships[i].AI != &quot;policeInterceptAI.plist&quot;) {
												ships[i].target = whom;
												ships[i].setAI(&quot;policeInterceptAI.plist&quot;);
										} else {
												ships[i].reactToAIMessage(&quot;GROUP_ATTACK_TARGET&quot;);
												ships[i].target = whom;
										}
								}
						}
				}				
		}
}

this.getDC = function() {
		var dc = this.ship.target.position.add(this.ship.target.vectorForward.multiply(3E3));
		this.ship.savedCoordinates = dc;
		this.ship.reactToAIMessage(&quot;CORRIDOR_POSITION&quot;);
}

this.getDB = function() {
		var db = this.ship.target.position;
		this.ship.savedCoordinates = db;
}


/* Autopilot functions block */

this.autopilotModeReady = function() {
		this.autopilotwilling = 1;
}

this.autopilotModeOffline = function() {
		this.autopilotwilling = 0;
}

this.autopilotContinue = function() {
		worldScripts[&quot;Rescue Autopilot&quot;].autopilotStep(this.ship);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_6.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 6&quot;; 
this.description = &quot;This script adds scenario 6 rescue mission.&quot;; 

//added long range map to the mission screens -spara-
//added background images to mission screens without model -spara-
//fixed description expand bug -spara-

this.scenarioID = &quot;6&quot;;

this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerScenario(this.scenarioID);
}

this.missionAvailableCount = function(iteration) {
		// ~75% 1, ~15% 2, ~5% 3, ~5% 4
		var x = Math.sqrt(Math.random()/Math.random());
		if (x &gt; 4) {
				return 4;
		} else if (x &lt; 1) {
				return 1;
		} else {
				return Math.floor(x);
		}
}

this.targetSystems = function() {
		return SystemInfo.filteredSystems(this, function (other) {
				if (!((other.systemID !== system.info.systemID) &amp;&amp; 
						(!other.sun_gone_nova) &amp;&amp;
						(worldScripts[&quot;Rescue Stations&quot;].systemHasRescueStation(other.systemID)) &amp;&amp;
						(system.info.distanceToSystem(other) &gt; 7) &amp;&amp;
							(system.info.distanceToSystem(other) &lt;= 25))) {
						return false;
				} else {
						var route = system.info.routeToSystem(other);
						return (route &amp;&amp; route.distance &lt;= 25);
				}
		});
}


this.missionAvailable = function() {
		if (Math.random() &gt; 0.75) {
				return false; // often available
		}
		if (missionVariables.rescuestation_reputation &lt; 0) {
				return false; // bad reputation
		}
		if (player.bounty &gt; 50) {
				return false; // no fugitives
		}
		if (this.targetSystems().length &lt; 1) {
				return false; // no suitable systems
		}
		return true;
}

this.initMissionVariables = function() {
		missionVariables.rescuestation_system = system.ID;
		
		var nearby = this.targetSystems();
		var destination = nearby[Math.floor(nearby.length*Math.random())];

		missionVariables.rescuestation_destsystem = destination.systemID;
		missionVariables.rescuestation_destsystem_name = destination.name;

		var direction = worldScripts[&quot;Rescue Stations&quot;].getDirection(system.info,destination);

		missionVariables.rescuestation_destsystem_desc = destination.name+&quot; (&quot;+expandDescription(&quot;[rescue_govname_&quot;+destination.government+&quot;]&quot;)+&quot;, &quot;+Math.round(system.info.distanceToSystem(destination))+&quot; LY &quot;+direction+&quot;)&quot;;

		var timer = (2+Math.random())*(system.info.routeToSystem(destination).time);
		var deadline = (3600*timer)+clock.seconds;

		missionVariables.rescuestation_deadline = deadline;
		missionVariables.rescuestation_deadline_text = clock.clockStringForTime(deadline);

		var reward = Math.floor(system.info.routeToSystem(destination).distance * 20);
		missionVariables.rescuestation_reward = reward;

		if (Math.random() &lt; 0.25) {
				missionVariables.rescuestation_danger = 3 + worldScripts[&quot;Rescue Stations&quot;].dangerScale(128); 
		} else {
				missionVariables.rescuestation_danger = 0;
		}

		

}

this.rescue_shipDockedWithStation = function (rstation) {
		
		if (rstation.hasRole(&quot;rescue_station&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_destsystem &amp;&amp; missionVariables.rescuestation_stage == 2) {
				if (clock.seconds &lt; missionVariables.rescuestation_deadline) {
						missionVariables.rescuestation_stage = 1000;
				} else {
						missionVariables.rescuestation_stage = 1001;
				}
		}

}

this.rescue_missionScreenOpportunity = function() {
		if (worldScripts[&quot;Rescue Stations&quot;].restoreDestination) {
			player.ship.targetSystem = worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
			delete worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
		}
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;Package transportation needed&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_6_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_nonurgent_mission_choices_map&quot;,
														model: &quot;rescue_station&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				player.credits += reward;

				mission.runScreen({title: &quot;Delivery completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_6_mission_complete&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();
		} else if (missionVariables.rescuestation_stage == 1001) {
				var lateness = clock.seconds - missionVariables.rescuestation_deadline;
				if (lateness &gt; 864000) {
						lateness = 864000; // more than 10 days late and it doesn&#39;t matter
				}
				missionVariables.rescuestation_reputation += 5; // partial mitigation
				missionVariables.rescuestation_reputation -= Math.floor(lateness/86400); // each extra day late makes it worse
				
				mission.runScreen({title: &quot;Delivery completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_6_mission_toolate&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].failMission();

		}
}


this.rescue_shipWillExitWitchspace = function() {
		if (missionVariables.rescuestation_danger &gt; 0) {
				if (system.ID == missionVariables.rescuestation_destsystem) {
						var appear = missionVariables.rescuestation_danger; // use all the rest
				} else {
						var appear = Math.floor(Math.random()*missionVariables.rescuestation_danger);
				}
				if (appear &gt; 1) { 
						var assassins = system.addShips(&quot;rrs-vicious-hunter&quot;,appear,player.ship.position.add(Vector3D.random(14E3),1E3));
						for (var i=0;i&lt;assassins.length;i++) {
								var assassin = assassins[i];
								assassin.target = player.ship;
								assassin.setAI(&quot;interceptAI.plist&quot;);
						}
						missionVariables.rescuestation_danger -= appear;					
				}
		}
}

this.rescue_shipExitedWitchspace = function() {
		var assassins = system.shipsWithPrimaryRole(&quot;rrs-vicious-hunter&quot;,player.ship,25600);
		if (assassins.length &gt; 0) {
			assassins[0].commsMessage(&quot;[rescue_scenario_6_conspirator_target]&quot;);
		}
		
}


/* Mission setup */

this.missionSuccess = function() {
		missionVariables.rescuestation_reputation += 5; // only really useful for complete beginners and restoring a damaged reputation, though it does also stop rep decay if you were going that way anyway
		// nothing special		
}

this.failMission = function () {
		missionVariables.rescuestation_reputation -= 5; // hard to get wrong
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_system;
		delete missionVariables.rescuestation_danger;
		delete missionVariables.rescuestation_destsystem;
		delete missionVariables.rescuestation_destsystem_name;
		delete missionVariables.rescuestation_destsystem_desc;
		delete missionVariables.rescuestation_deadline;
		delete missionVariables.rescuestation_deadline_text;
}


this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		}
		else if (choice === &quot;MAP&quot;) {
			worldScripts[&quot;Rescue Stations&quot;].restoreDestination = player.ship.targetSystem;
			player.ship.targetSystem = missionVariables.rescuestation_destsystem;
				mission.runScreen ({title: &quot;Package transportation needed&quot;,
														screenID: &quot;rrs_mission_map&quot;,
														backgroundSpecial: &quot;LONG_RANGE_CHART_QUICKEST&quot;
														},
														worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_missionScreenOpportunity
													);
		}
		 else {
				missionVariables.rescuestation_stage = 2;
				mission.runScreen({title: &quot;Transferring package&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_6_mission_accepted&quot;,
													 model: &quot;rescue_blackbox&quot;,
													 background: &quot;rrsfl_blank_bg.png&quot;},
													function (choice) {
															worldScripts[&quot;Rescue Stations&quot;].acceptMission();
															mission.markSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
															worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_6_description&quot;);
													}
												 );
		}
}

/* Mission functions */

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_6a.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name        = &quot;Rescue Scenario 6a&quot;; 
this.description = &quot;This script adds scenario 6 variant A rescue mission.&quot;; 

//added long range map to the mission screens -spara-
//made plague mine position fixed -spara-
//added background images to mission screens without model -spara-
//fixed description expand bug -spara-

this.scenarioID = &quot;6a&quot;;

this.addedpirates = 0;
this.piratetimer = undefined;

this.startUp = function() {
// make sure Rescue Stations is loaded first
		if (worldScripts[&quot;Rescue Stations&quot;].startUp) {
				worldScripts[&quot;Rescue Stations&quot;].startUp();
		}
		worldScripts[&quot;Rescue Stations&quot;].registerVariant(&quot;6&quot;,this.scenarioID);
}

this.targetSystems2 = function() {
		return SystemInfo.filteredSystems(this, function (other) {
				if (!((other.systemID !== system.info.systemID) &amp;&amp; 
						(!other.sun_gone_nova) &amp;&amp;
						(other.description.indexOf(&quot;disease&quot;) != -1) &amp;&amp;
						(system.info.distanceToSystem(other) &gt; 7) &amp;&amp;
							(system.info.distanceToSystem(other) &lt; 30))) {
						return false;
				} else {
						var route = system.info.routeToSystem(other);
						return (route &amp;&amp; route.distance &lt;= 30);
				}
		});
}

this.targetSystems1 = function() {
		return SystemInfo.filteredSystems(this, function (other) {
				if (!((other.description.indexOf(&quot;disease&quot;) == -1) &amp;&amp;
							(!other.sun_gone_nova) &amp;&amp;
							(other.techlevel &gt;= 11) &amp;&amp;
							(system.info.distanceToSystem(other) &lt;= 15) &amp;&amp; 
							(other.economy &lt;= 1))) { // Rich/Avg industrials
								return false;
				} else {
						var route = system.info.routeToSystem(other);
						return (route &amp;&amp; route.distance &lt;= 15);
				}
		});
}


this.missionAvailable = function() {
		if (Math.random() &gt; 0.3) {
				return false; // sometimes replace
		}
		if (missionVariables.rescuestation_reputation &lt; 40) {
				return false; // not enough reputation
		}
		if (player.bounty &gt; 50) {
				return false; // no fugitives
		}
		if (this.targetSystems1().length &lt; 1) {
				return false; // no suitable systems
		}
		if (this.targetSystems2().length &lt; 1) {
				return false; // no suitable systems
		}
		return true;
}

this.initMissionVariables = function() {
		missionVariables.rescuestation_system = system.ID;
		
		var nearby = this.targetSystems1();
		if (nearby.length == 0) {
				log(this.name,&quot;No target systems found&quot;);
		}
		var destination1 = nearby[Math.floor(nearby.length*Math.random())];

		missionVariables.rescuestation_destsystem = destination1.systemID;
		missionVariables.rescuestation_destsystem_name = destination1.name;

		var direction = worldScripts[&quot;Rescue Stations&quot;].getDirection(system.info,destination1);

		missionVariables.rescuestation_destsystem_desc = destination1.name+&quot; (&quot;+expandDescription(&quot;[rescue_govname_&quot;+destination1.government+&quot;]&quot;)+&quot;, &quot;+Math.round(system.info.distanceToSystem(destination1))+&quot; LY &quot;+direction+&quot;)&quot;;

		var timer = (1.1+Math.random())*(system.info.routeToSystem(destination1).time);

		nearby = this.targetSystems2();
		var destination2 = nearby[Math.floor(nearby.length*Math.random())];
		missionVariables.rescuestation_destsystem2 = destination2.systemID;
		missionVariables.rescuestation_destsystem2_name = destination2.name;

		direction = worldScripts[&quot;Rescue Stations&quot;].getDirection(system.info,destination2);

		missionVariables.rescuestation_destsystem2_desc = destination2.name+&quot; (&quot;+expandDescription(&quot;[rescue_govname_&quot;+destination2.government+&quot;]&quot;)+&quot;, &quot;+Math.round(system.info.distanceToSystem(destination2))+&quot; LY &quot;+direction+&quot;)&quot;;

		timer += (1.1+Math.random())*(destination1.routeToSystem(destination2).time);
		var deadline = (3600*timer)+clock.seconds;

		missionVariables.rescuestation_deadline = deadline;
		missionVariables.rescuestation_deadline_text = clock.clockStringForTime(deadline);

		var reward = Math.floor(system.info.routeToSystem(destination2).distance * 100);
		missionVariables.rescuestation_reward = reward;

		missionVariables.rescuestation_danger = 2 + worldScripts[&quot;Rescue Stations&quot;].dangerScale(192); 

		missionVariables.rescuestation_disease = expandDescription(&quot;[rescue_random_disease]&quot;);

}

this.rescue_shipDockedWithStation = function (rstation) {
		
		if (rstation.isMainStation &amp;&amp; system.ID == missionVariables.rescuestation_destsystem &amp;&amp; missionVariables.rescuestation_stage == 2) {
				if (clock.seconds &lt; missionVariables.rescuestation_deadline) {
						missionVariables.rescuestation_stage = 90;
				} else {
						missionVariables.rescuestation_stage = 1002;
				}
		} else if (rstation.hasRole(&quot;rrs-plague-mine&quot;) &amp;&amp; system.ID == missionVariables.rescuestation_destsystem2 &amp;&amp; missionVariables.rescuestation_stage &gt;= 100) {
				if (clock.seconds &lt; missionVariables.rescuestation_deadline) {
						missionVariables.rescuestation_stage = 1000;
				} else {
						missionVariables.rescuestation_stage = 1001;
				}

		}

}

this.rescue_populatingSystem = function() {
		if (system.ID == missionVariables.rescuestation_destsystem2) {
			var i = 1;
			do {
				var mineloc = Vector3D(system.scrambledPseudoRandomNumber(i), system.scrambledPseudoRandomNumber(i + 1), system.scrambledPseudoRandomNumber(i + 2)).multiply(400E3);
				i++;
			} while (mineloc.magnitude() &lt; 100E3);
				system.addShips(&quot;rrs-plague-mine&quot;,1,mineloc,1);
				system.addShips(&quot;asteroid&quot;, 30+Math.floor(Math.random()*30), mineloc, 40E3);
				system.addShips(&quot;miner&quot;,3,mineloc,20E3);
				var pirateCount = 1+Math.floor(Math.random()*missionVariables.rescuestation_danger);
				system.addGroup(&quot;pirate&quot;, pirateCount, [0,0,0], 15E3);

		}
}

this.rescue_shipExitedWitchspace = function() {
		if (this.piratetimer) {
				this.piratetimer.stop();
		}
		if (missionVariables.rescuestation_stage &gt;= 100) {
				this.addedpirates = 0;
				this.additionalPirates();
		}
		if (system.ID == missionVariables.rescuestation_destsystem2) {
				if (!worldScripts[&quot;Rescue Ambience&quot;].plagueActive()) {
						// there is an unseasonable plague here
						worldScripts[&quot;Rescue Ambience&quot;].plagueSystem();
				}
		}
}

this.rescue_missionScreenOpportunity = function() {
		if (worldScripts[&quot;Rescue Stations&quot;].restoreDestination) {
			player.ship.targetSystem = worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
			delete worldScripts[&quot;Rescue Stations&quot;].restoreDestination;
		}
		if (missionVariables.rescuestation_stage == 1) {
				mission.runScreen ({title: &quot;Medical supplies delivery&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_6a_mission_available&quot;,
														choicesKey: &quot;rescue_scenario_nonurgent_mission_choices_map&quot;,
														model: &quot;rescue_station&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;},
													 worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].missionOfferDecision
													);
		} else if (missionVariables.rescuestation_stage == 90) {
				mission.runScreen ({title: &quot;Medical supplies delivery&quot;,
														screenID: &quot;rrs_mission&quot;,
														messageKey: &quot;rescue_scenario_6a_mission_progress&quot;,
														model: &quot;1t-cargopod&quot;,
														background: &quot;rrsfl_blank_bg.png&quot;});
				missionVariables.rescuestation_stage = 100;
				mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
				mission.markSystem({system: missionVariables.rescuestation_destsystem2, name: &quot;RRS&quot;});

				player.ship.useSpecialCargo(&quot;RRS Medical Supplies&quot;);

		} else if (missionVariables.rescuestation_stage == 1000) {
				var reward = missionVariables.rescuestation_reward;
				player.credits += reward;

				mission.runScreen({title: &quot;Delivery completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_6a_mission_complete&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].missionSuccess();
		} else if (missionVariables.rescuestation_stage == 1001) {
				var lateness = clock.seconds - missionVariables.rescuestation_deadline;
				if (lateness &gt; 864000) {
						lateness = 864000; // more than 10 days late and it doesn&#39;t matter
				}
				missionVariables.rescuestation_reputation += 5; // partial mitigation
				missionVariables.rescuestation_reputation -= Math.floor(lateness/86400); // each extra day late makes it worse
				
				mission.runScreen({title: &quot;Delivery completed&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_6a_mission_toolate&quot;,
													 background: &quot;rrsfl_bg.png&quot;});

				worldScripts[&quot;Rescue Stations&quot;].failMission();
		} else if (missionVariables.rescuestation_stage == 1002) {
				missionVariables.rescuestation_reputation -= 5; // serious error
				mission.runScreen({title: &quot;We found someone else&quot;,
													screenID: &quot;rrs_mission&quot;,
													 messageKey: &quot;rescue_scenario_6a_mission_reallylate&quot;,
													 background: &quot;rrsfl_bg.png&quot;});
				worldScripts[&quot;Rescue Stations&quot;].failMission();
		}
}



/* Mission setup */

this.missionSuccess = function() {
		mission.unmarkSystem({system: missionVariables.rescuestation_destsystem2, name: &quot;RRS&quot;});
		missionVariables.rescuestation_reputation += 15; 
		// nothing special		
		player.ship.removeAllCargo(); // remove the special cargo
}

this.failMission = function () {
		if (missionVariables.rescuestation_stage &gt;= 100) {
				player.ship.removeAllCargo();  // remove the special cargo
		}
		mission.unmarkSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
		mission.unmarkSystem({system: missionVariables.rescuestation_destsystem2, name: &quot;RRS&quot;});
		missionVariables.rescuestation_reputation -= 10; 

		var chance = 0.9;
		if (missionVariables.rescuestation_stage == 1001) {
				chance = 0.5; // better late than never?
		}

		worldScripts[&quot;Rescue News&quot;].sendNews(&quot;rescue_scenario_6a_news&quot;,1,chance); // bad news
}

this.cleanupMission = function() {
		delete missionVariables.rescuestation_reward;
		delete missionVariables.rescuestation_system;
		delete missionVariables.rescuestation_danger;
		delete missionVariables.rescuestation_destsystem;
		delete missionVariables.rescuestation_destsystem_name;
		delete missionVariables.rescuestation_destsystem_desc;
		delete missionVariables.rescuestation_destsystem2;
		delete missionVariables.rescuestation_destsystem2_name;
		delete missionVariables.rescuestation_destsystem2_desc;
		delete missionVariables.rescuestation_deadline;
		delete missionVariables.rescuestation_deadline_text;
		if (this.piratetimer) {
				this.piratetimer.stop();
		}
}


this.missionOfferDecision = function (choice) {
		if (choice == &quot;NO&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].refuseCurrentMission();
				worldScripts[&quot;Rescue Stations&quot;].cleanupMission();
				missionVariables.rescuestation_stage = 0;
		}
		else if (choice === &quot;MAP&quot; || choice === &quot;SWAP&quot;) {
			var options = {
				&quot;1_SWAP&quot; : &quot;Swap destination&quot;,
				&quot;2_RETURN&quot; : &quot;Return&quot;
			};
			if (choice === &quot;MAP&quot;) {
				worldScripts[&quot;Rescue Stations&quot;].restoreDestination = player.ship.targetSystem;
				player.ship.targetSystem = missionVariables.rescuestation_destsystem;
			}
			else {
				if (player.ship.targetSystem === missionVariables.rescuestation_destsystem)
					player.ship.targetSystem = missionVariables.rescuestation_destsystem2;
				else
					player.ship.targetSystem = missionVariables.rescuestation_destsystem;
			}
			mission.runScreen ({
					title: &quot;Medical supplies delivery&quot;,
					screenID: &quot;rrs_mission_map&quot;,
					backgroundSpecial: &quot;LONG_RANGE_CHART_QUICKEST&quot;,
					choices: options
				},
				function (choice) {
					if (choice === &quot;1_SWAP&quot;) {
						worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].missionOfferDecision(&quot;SWAP&quot;);
						return;
					}
					else {
						worldScripts[&quot;Rescue Scenario &quot;+missionVariables.rescuestation_scenario].rescue_missionScreenOpportunity();
						return;
					}
				}
			);
		}
		else {
			missionVariables.rescuestation_stage = 2;
			mission.runScreen({
					title: &quot;Transferring package&quot;,
					screenID: &quot;rrs_mission&quot;,
					messageKey: &quot;rescue_scenario_6a_mission_accepted&quot;,
					model: &quot;rescue_blackbox&quot;
				},
				function (choice) {
						worldScripts[&quot;Rescue Stations&quot;].acceptMission();
						mission.markSystem({system: missionVariables.rescuestation_destsystem, name: &quot;RRS&quot;});
						worldScripts[&quot;Rescue Stations&quot;].setMissionDetails(&quot;rescue_scenario_6a_description&quot;);
				}
			);
		}
}

		
/* Mission functions */



this.additionalPirates = function() {
		if (!player.ship.docked) {
				this.addedpirates++;
				var pirateCount = 1+Math.floor(Math.random()*missionVariables.rescuestation_danger);
				var addplace = player.ship.position.add(player.ship.vectorForward.multiply(50E3));
				system.addGroup(&quot;pirate&quot;, pirateCount, addplace, 10E3);
		}
		
		if (this.addedpirates &lt;= missionVariables.rescuestation_danger) {
				if (system.ID == missionVariables.rescuestation_destsystem2) {
						var delay = 10*(1+system.info.government)+Math.floor(Math.random()*20);
				} else {
						var delay = (20*(4+system.info.government))+Math.floor(Math.random()*20);
				}
				if (this.piratetimer) {
						this.piratetimer.stop();
				}
				this.piratetimer = new Timer(this,this.additionalPirates,delay);
		}

}

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rescue_scenario_6a_miningbase.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;Rescue Scenario 6a Mining Base&quot;;

//support for escort formations oxp -spara-

this.shipSpawned = function () {
	if (worldScripts[&quot;Escort Formations Randomiser&quot;]) {
		worldScripts[&quot;Escort Formations Randomiser&quot;].$setupDefensiveEscorts(this.ship);
	};
}

this.shipDied = function() {
		player.consoleMessage(&quot;Mining base destroyed. Mission failed.&quot;);
		worldScripts[&quot;Rescue Stations&quot;].failMission();
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrs_eq_cargo.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name           =    &quot;rrs_eq_cargo_holder&quot;;
this.author         =    &quot;spara&quot;;
this.copyright      =    &quot;2015 Mika Spåra&quot;;
this.licence        =    &quot;CC BY-NC-SA 3.0&quot;; 
this.description    =    &quot;RRS cargo holder condition script for scripted pods&quot;;

this.allowAwardEquipment = function(eqKey, ship, context) {	
	//add only via scripting
	if (context === &quot;scripted&quot;)
		return true;
	return false;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrs_eq_cond.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name           =    &quot;rrs_eq_cond&quot;;
this.author         =    &quot;spara&quot;;
this.copyright      =    &quot;2015 Mika Spåra&quot;;
this.licence        =    &quot;CC BY-NC-SA 3.0&quot;; 
this.description    =    &quot;RRS equipment condition script&quot;;

this.allowAwardEquipment = function(eqKey, ship, context) {
	
	//add EQ_RESQUE_MISSILE only via scripting
	if (eqKey === &quot;EQ_RESCUE_MISSILE&quot;) {
		if (context === &quot;scripted&quot;) return true;
		else return false;
	}
	//rrs equipment available only from waystation
	if (!player.ship.dockedStation.hasRole(&quot;rescue_station&quot;))
		return false;
		
	switch(eqKey) {
		case &quot;EQ_RRS_SOLAR_MINE&quot;:
			if (missionVariables.rescuestation_solarlabavailable !== 1)
				return false;
			break;
		case &quot;EQ_RRS_FUEL&quot;:
			if (missionVariables.rescuestation_reputation &lt; 20)
				return false;
			break;
		case &quot;EQ_RRS_SCOOPS&quot;:
		case &quot;EQ_RRS_DOCK_COMP&quot;:
		case &quot;EQ_RRS_HEAT_SHIELD&quot;:
		case &quot;EQ_RRS_ASC&quot;:
		case &quot;EQ_RRS_ANA&quot;:
		case &quot;EQ_RRS_FLIGHTFORM_DISCOUNT&quot;:
		case &quot;EQ_RRS_ESCORT_TARGETING_SYSTEM_DISCOUNT&quot;:
		case &quot;EQ_RRS_SCANNER_SHOW_MISSILE_TARGET_DISCOUNT&quot;:
			if (missionVariables.rescuestation_reputation &lt; 40 || missionVariables.rescuestation_reputation &gt; 318)
				return false;
			break;
		case &quot;EQ_RRS_SERVICE&quot;:
			if (missionVariables.rescuestation_reputation &lt; 160)
				return false;
			break;
		case &quot;EQ_RRS_FULLEQUIP&quot;:
			if (missionVariables.rescuestation_reputation &lt; 320)
				return false;
			break;
	}
	return true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrs_escort.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;RRS Escort&quot;;
this.description = &quot;Scripts for the Escorts&quot;;

//naming retouching -spara-

this.lastdamagecomplaint = 0;

this.shipSpawned = function() {
	if (worldScripts.randomshipnames &amp;&amp; (!this.ship.owner || (this.ship.owner &amp;&amp; !this.ship.owner.hasRole(&quot;rrs-arafura&quot;) &amp;&amp; !this.ship.owner.hasRole(&quot;arafura-mission&quot;))))
		this.ship.displayName = this.ship.displayName + &quot;: &quot; + worldScripts.randomshipnames.$randomHunterName(this.ship);
}

this.shipDied = function(whom,why) {
		this.ship.commsMessage(&quot;[rescue_argh]&quot;);
		if (whom == player.ship) {
				missionVariables.rescuestation_reputation -= 10;
		}

/*		if (whom) {
				player.consoleMessage(this.ship.displayName+&quot; killed by &quot;+whom.displayName+&quot; using &quot;+why);
		} else {
				player.consoleMessage(this.ship.displayName+&quot; killed by anonymous using &quot;+why);
		}*/


}

this.shipKilledOther = function(whom) {
		this.ship.commsMessage(&quot;[rescue_kill]&quot;);
}

this.shipAttackedWithMissile = function(missile,whom) {
		if (!this.ship.equipmentStatus(&quot;EQ_ECM&quot;) != &quot;EQUIPMENT_OK&quot;) {
				this.ship.commsMessage(&quot;[rescue_incmissile]&quot;);
		}
}

this.shipTakingDamage = function(amount,whom,type) {
		if (type == &quot;scrape damage&quot; &amp;&amp; (whom.hasRole(&quot;arafura-mission&quot;) || whom.hasRole(&quot;rrs-escort&quot;) || whom.hasRole(&quot;rescue_target&quot;))) {
				this.ship.energy += amount; // cancel damage from collision with leader
				return;
		}
		if (!this.ship.piloted) {
				return;
		}
		if (this.ship.energy &gt; 0) {
				if (this.lastdamagecomplaint+15 &lt; clock.seconds) {
						this.lastdamagecomplaint = clock.seconds;
						if (this.ship.energy &gt; this.ship.maxEnergy/4) {
								this.ship.commsMessage(&quot;[rescue_underfire]&quot;);
						} else {
								this.ship.commsMessage(&quot;[rescue_underheavyfire]&quot;);
						}
				}				
		}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrs_escorttargeting.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;RRS Escort Targeting Equipment&quot;;

this.filter = function(entity) {
		return entity.isShip &amp;&amp; entity.target &amp;&amp; entity.hasHostileTarget;
}

this.activated = function() {
		if (!player.ship.target) {
				player.consoleMessage(&quot;No target selected&quot;);
				return;
		}
		
		var possibles = system.filteredEntities(this,this.filter,player.ship,25600);
		
		for (var i=0;i&lt;possibles.length;i++) {
				if (possibles[i].target == player.ship.target &amp;&amp; possibles[i] != player.ship.target) {
						player.ship.target = possibles[i];
						player.consoleMessage(&quot;Target locked&quot;);
						return;
				}
		}

		player.consoleMessage(&quot;No hostile target found&quot;);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrs_flightpilot.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;RRS Formation Flight Autopilot&quot;;
this.description = &quot;An autopilot for those boring escort bits&quot;;

this.equipmentactive = 0;
this.checkstatus = undefined;
this.autotarget = undefined;
this.music = &quot;uranus.ogg&quot;;

this.activated = function() {
		if (this.equipmentactive == 0) {
				if (system.shipsWithRole(&quot;rrs-autopilot-screen&quot;).length &gt; 0) {
						player.consoleMessage(&quot;Please wait for subsystem reboot to complete&quot;);
						return;
				}
				this.autopilotOn();
		} else {
				this.autopilotOff();
		}
}

this.autopilotAvailable = function() {
		if (player.ship.equipmentStatus(&quot;EQ_DOCK_COMP&quot;) != &quot;EQUIPMENT_OK&quot;) {
				return &quot;Severe damage to autopilot computers&quot;;
		} else if (player.alertCondition == 0) {
				return &quot;Cannot be used while docked&quot;;
		} else if (player.alertCondition == 3) {
				return &quot;Cannot be used while at red alert&quot;;
		} else if (player.alertEnergy) {
				return &quot;Energy banks are not full&quot;;
		} else if (!player.ship.target) {
				return &quot;Select mothership to follow as target&quot;;
		} else if (!player.ship.target.hasRole(&quot;rrs-flightcomp-supported&quot;)) {
				return &quot;Selected target does not support this equipment&quot;;
		} else if (!player.ship.target.script.autopilotwilling) {
				return &quot;Selected target is not currently transmitting&quot;;
		} else if (player.ship.target.savedCoordinates.distanceTo(player.ship.target.position) &lt; 25E3) {
				return &quot;Selected target already in destination vicinity&quot;;
		} else {

				var range = player.ship.position.distanceTo(player.ship.target.position);
				var speedmatch = player.ship.velocity.magnitude()/player.ship.target.velocity.magnitude();
				var headmatch = player.ship.velocity.direction().dot(player.ship.target.velocity.direction());

				if (range &gt; 25E2) {
						return &quot;Approach to within 2500m of selected target&quot;;
				} else if (range &lt; 5E2) {
						return &quot;Withdraw to at least 500m away from selected target&quot;;
				} else if (speedmatch &lt; 0.9) {
						return &quot;Accelerate to match target speed&quot;;
				} else if (speedmatch &gt; 1.1) {
						return &quot;Decelerate to match target speed&quot;;
				} else if (headmatch &lt; 0.99) {
						return &quot;Turn to match target heading&quot;;
				} else {
						return &quot;READY&quot;;
				}
		}
}

this.autopilotOn = function() {
		var available = this.autopilotAvailable();
		if (available == &quot;READY&quot;) {
				this.autopilotActive();
		} else {
				player.consoleMessage(available,5);
				player.consoleMessage(&quot;Please fix error and then reactivate&quot;,5);
		}
}

this.autopilotActive = function() {
		this.equipmentactive = 1;
		this.autotarget = player.ship.target;
		this.checkstatus = new Timer(this,this.autopilotCheckState,3);
		player.ship.target.reactToAIMessage(&quot;PLAYER_ESCORT_AUTOPILOT_ON&quot;);
		player.consoleMessage(&quot;Autopilot initialising&quot;,5);
		var screen = system.addShips(&quot;rrs-autopilot-screen&quot;,1,player.ship.position.add(player.ship.vectorUp.multiply(player.ship.collisionRadius*4)));
		screen[0].orientation = player.ship.orientation;
		screen[0].velocity = player.ship.velocity;
		Sound.playMusic(this.music);

}

this.autopilotCheckState = function() {
		if (this.equipmentactive != 1) {
				return;
		}
		var available = this.autopilotAvailable();
		if (available == &quot;READY&quot;) {
				player.ship.hudHidden = true;
				// schedule another check
				var screen = system.shipsWithRole(&quot;rrs-autopilot-screen&quot;);
				screen[0].position = player.ship.position.add(player.ship.vectorUp.multiply(player.ship.collisionRadius*4));
				this.checkstatus = new Timer(this,this.autopilotCheckState,1);
		} else {
				player.consoleMessage(&quot;Exiting autopilot mode!&quot;);
				// quit autopilot
				this.autopilotOff();
		}
}

this.autopilotOff = function() {
		player.ship.hudHidden = false;
		Sound.stopMusic(this.music);
		if (this.equipmentactive == 0) {
				return;
		}
		this.equipmentactive = 0;
		var screen = system.shipsWithRole(&quot;rrs-autopilot-screen&quot;);
		screen[0].remove(true);
//		worldScripts[&quot;Rescue Autopilot&quot;].autopilotShutdown();
		if (this.checkstatus) {
				this.checkstatus.stop();
		}
		if (this.autotarget.isValid &amp;&amp; this.autotarget.isShip) {
				this.autotarget.reactToAIMessage(&quot;PLAYER_ESCORT_AUTOPILOT_OFF&quot;);
		}
		this.autotarget = undefined;
		player.consoleMessage(&quot;Autopilot disengaged&quot;);
}

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrs_hq_script.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;RRS Headquarters Script&quot;;

this.dockposition = undefined;

this.initialiseStation = function() {
		var busyness = Math.random()/2;
		var subents = this.ship.subEntities;
		var bays = new Array();
		var ffs = new Array();
		var positions = new Array();
		for (var i=0;i&lt;subents.length;i++) {
				if (subents[i].hasRole(&quot;rrs_hq_bay&quot;)) {
						bays.push(subents[i]);
						if (!subents[i].hasRole(&quot;rrs_hq_bay_dock&quot;)) {
								positions.push(subents[i].position);
						} else {
								var activedockpos = subents[i].position;
						}
				} else if (subents[i].hasRole(&quot;rrs_hq_ff&quot;)) {
						ffs.push(subents[i]);
				} else if (!subents[i].hasRole(&quot;rrs_hq_component&quot;)) {
						if (Math.random() &lt; busyness) {
								subents[i].remove(true)
						}
				}
		}
		
		positions.sort(function(a,b) { return Math.random()-0.5; });
		for (var i=0;i&lt;bays.length;i++) {
				if (bays[i].hasRole(&quot;rrs_hq_bay_dock&quot;)) {
						for (var j=0;j&lt;ffs.length;j++) {
								if (ffs[j].position.distanceTo(bays[i].position) &lt; 50) {
										ffs[j].remove(true);
								}
						}
						this.dockposition = bays[i].position;
				} else {
						bays[i].position = positions.shift();
				}
		}

		system.addShips(&quot;rrs-hq-buoy&quot;,1,this.ship.position.add(activedockpos).add(this.ship.vectorForward.multiply(12E3)),1);

}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrs_market.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;rescue-stations-market&quot;;
this.author = &quot;spara&quot;;
this.copyright = &quot;2015 spara&quot;;
this.license     = &quot;CC BY-NC-SA 4.0&quot;;

this.$originalDefsWayStation = {
      &quot;food&quot; : [0, 0, 28,  -2, 0,  0,  3,  0,  0],
      &quot;textiles&quot; : [0, 0, 30,  -1, 0,  0,  3,  0,  0],
      &quot;radioactives&quot; : [0, 0, 50,  -3, -1, 6,  7,  3,  0],
      &quot;slaves&quot; : [0, 0, 25,  0,  0,  0,  0,  0,  0],
      &quot;liquor_wines&quot; : [0, 0, 75,  -5, 0,  0,  15, 0,  0],
      &quot;narcotics&quot; : [0, 0, 50,  0,  0,  0,  0,  0,  0],
      &quot;computers&quot; : [0, 0, 160, 9,  9,  2,  7,  7,  0],
      &quot;machinery&quot; : [0, 0, 120, 4,  4,  4,  7,  7,  0],
      &quot;alloys&quot; : [0, 0, 80,  1,  1,  10, 15, 15, 0]
};

this.$originalDefsHQ = {
      &quot;food&quot; : [0, 0, 22,  -2, 0,  0,  3,  0,  0],
      &quot;radioactives&quot; : [0, 0, 60,  -3, 0,  0,  7,  0,  0],
      &quot;computers&quot; : [0, 0, 160, 9,  9,  2,  7,  7,  0],
      &quot;machinery&quot; : [0, 0, 120, 4,  4,  4,  7,  7,  0],
      &quot;alloys&quot; : [0, 0, 80,  1,  1,  10, 15, 15, 0],
      &quot;furs&quot; : [0, 0, 24,  -1, -1, 85, 3,  3,  0]
};

this.updateLocalCommodityDefinition = function(goodDefinition, station) {
	var commodity = goodDefinition.key;
	if (station.dataKey === &quot;rescue_station&quot;)
		var oldDefs = this.$originalDefsWayStation[commodity];
	else var oldDefs = this.$originalDefsHQ[commodity];
	
	//these are smallish markets
	goodDefinition.capacity = 31;
	
	//old style definition found for the good. calculate it the old way
	if (oldDefs) {
		var market_base_price = oldDefs[2];
		var market_eco_adjust_price = oldDefs[3];
		var market_eco_adjust_quantity = oldDefs[4];
		var market_base_quantity = oldDefs[5];
		var market_mask_price = oldDefs[6];
		var market_mask_quantity = oldDefs[7];
		var market_rnd = Math.floor(Math.random() * 256);

		var economy = system.economy;
		
		var price = (market_base_price + (market_rnd &amp; market_mask_price) + (economy * market_eco_adjust_price)) &amp; 255;
		price *= 0.4;
		
		var quantity = (market_base_quantity + (market_rnd &amp; market_mask_quantity) - (economy * market_eco_adjust_quantity)) &amp; 255;
		if (quantity &gt; 127) quantity = 0;
		
		quantity &amp;= 63;
		
		goodDefinition.quantity = quantity;
		goodDefinition.price = price * 10;
	}
	//no definition found. good is not tradeable
	else {
		goodDefinition.price = 0.0;
		goodDefinition.quantity = 0;
		goodDefinition.capacity = 0;
	}
	return goodDefinition;
};
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrs_player_hunter.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Player Hunters&quot;;
this.description = &quot;Player Hunters&quot;;

this.findPlayer = function() {
		if (this.ship.position.distanceTo(player.ship.position) &lt; 20E3) {

				this.ship.reactToAIMessage(&quot;PLAYER_FOUND&quot;);
		}
//		player.consoleMessage(this.ship.name+&quot;: &quot;+this.ship.position.distanceTo(player.ship.position));

		if (player.ship.speed &gt; player.ship.maxSpeed*10 &amp;&amp; Math.random() &lt; 0.15 &amp;&amp; player.ship.position.distanceTo(this.ship.position) &gt; 30E3) { // torus drive
				this.ship.position = player.ship.position.add(player.ship.vectorForward.multiply(60E3)); // teleporting is cheating, but then these ships don&#39;t have torus drives of their own
		}

		var lead = system.mainStation.position.subtract(player.ship.position).direction().multiply(10E3); // 10km ahead of player towards station

		this.ship.savedCoordinates = player.ship.position.add(lead);
		
}

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrs_solar_lab.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;RRS Solar Lab&quot;;
this.description = &quot;Functions for the RRS portable Solar Laboratory&quot;;

this.lasttemp = -1;
this.reacted = 0;
this.started = 0;

this.replaceIfNeeded = function() {
		if (this.ship.primaryRole == &quot;EQ_RRS_SOLAR_MINE&quot;) {
				var p = this.ship.position;
				this.ship.remove(true);
				system.addShips(&quot;rrs_portable_solar_lab&quot;,1,p,1);
		} else {
				worldScripts[&quot;Rescue Stations&quot;].solarLabDeployed();
		}
}

this.checkProgress = function() {
		var temp = this.ship.temperature;
		if (this.lasttemp == -1) {
				this.lasttemp = temp;
				return; // first check
		}

		this.reacted = 1;
		this.reactionComplete();

//		log(this.name,&quot;Temperature: &quot;+temp);
		if (temp &lt;= this.lasttemp &amp;&amp; temp &lt; 0.75) {
				this.ship.commsMessage(&quot;ERR#9: Too far from sun. Please collect and redeploy&quot;);
				this.lasttemp = temp;
				return; // first check
		}
		if (temp &gt; 0.9) {
				this.ship.commsMessage(&quot;ERR#5: Thermal overload. Please collect immediately.&quot;);
		} else if (temp &gt; 0.75) {
				if (!this.reacted) {
						this.reacted = 1;
						this.reactionComplete();
				}
		} else {
				if (!this.started) {
						this.ship.commsMessage(&quot;Processing in progress.&quot;);
						this.started = 1;
				}
		}
		this.lasttemp = temp;
}

this.reactionComplete = function() {
// check for mission success, use event handler
		worldScripts[&quot;Rescue Stations&quot;].solarLabReactionComplete();
		this.ship.commsMessage(&quot;Reaction complete. Collect lab now.&quot;);
//		log(this.name,&quot;Reaction completed&quot;);
}

this.shipDied = function() {
		worldScripts[&quot;Rescue Stations&quot;].solarLabDestroyed();
}

this.shipWasScooped = function(scooper) {
		scooper.awardEquipment(&quot;EQ_RRS_SOLAR_MINE&quot;);
		worldScripts[&quot;Rescue Stations&quot;].solarLabCollected(scooper);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrs_witchspace_anomaly.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;cim&quot;; 
this.copyright   = &quot;2011-2015 cim.&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name = &quot;RRS witchspace anomaly script&quot;;

//added anomaly with effectdata -spara-

this.effectSpawned = function() {
	this.$diceTimer = new Timer(this, this.$handleActions, 5);
}

this.$handleActions = function() {
	var roll = Math.random();
	if (roll &lt; 0.2) this.$moveAnomaly();
	else if (roll &gt; 0.8) this.$doAnomaly();
	else
		this.$diceTimer = new Timer(this, this.$handleActions, Math.ceil(roll * 6));
}

this.$moveAnomaly = function() {
	this.$moveTime = clock.seconds + 3 + Math.floor(Math.random() * 4);//move for 3-6 seconds
	this.$moveDirection = Vector3D.randomDirection().multiply(10);
	this.$moveFCB = addFrameCallback(this.$doMove.bind(this));	
}

this.$doMove = function(delta) {
	if (this.$moveTime &gt; clock.seconds) {
		this.visualEffect.position = this.visualEffect.position.add(this.$moveDirection);
	}
	else {
		removeFrameCallback(this.$moveFCB);
		delete this.$moveFCB;
		this.$handleActions();
	}
}

this.$doAnomaly = function() {
	var somethingToExplode = system.addShips(&quot;splinter&quot;, 1, this.visualEffect ,0 );
	somethingToExplode[0].explode();
	var thargoid = system.addShips(&quot;thargoid&quot;,1,this.visualEffect,50)[0];
	var arafura = system.shipsWithRole(&quot;arafura-mission&quot;,this.visualEffect,25600);
	if (arafura.length &gt; 0) {
		arafura[0].target = thargoid;
		arafura[0].reactToAIMessage(&quot;THARGOIDS_ABOUT&quot;);
	}
	this.visualEffect.remove();
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrsfl_arafura.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;spara&quot;; 
this.copyright   = &quot;2015 spara&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Arafura rescue boat&quot;;
this.description = &quot;Name ambiance arafuras the same way as mission arafuras and add support for escort formations oxp&quot;;

this.shipSpawned = function() {
	if (worldScripts[&quot;Escort Formations Randomiser&quot;]) {
		worldScripts[&quot;Escort Formations Randomiser&quot;].$setupDefensiveEscorts(this.ship);
	}
	this.wingName = expandDescription(&quot;[rescue_wingnames]&quot;);
	this.ship.displayName = this.ship.displayName + &quot;: &quot; + this.wingName + &quot; Leader&quot;;
	if (this.ship.escorts) {
		for (var i = 0; i &lt; this.ship.escorts.length; i++) {
			this.ship.escorts[i].displayName = this.ship.escorts[i].displayName + &quot;: &quot; + this.wingName + &quot; &quot; + (i+2);
		}
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrsfl_arafura_ind.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;spara&quot;; 
this.copyright   = &quot;2014 - 2015 spara&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;Independent Arafura rescue boat&quot;;
this.description = &quot;Add support for escort formations oxp&quot;;

this.shipSpawned = function() {
	if (worldScripts[&quot;Escort Formations Randomiser&quot;]) {
		worldScripts[&quot;Escort Formations Randomiser&quot;].$setupDefensiveEscorts(this.ship);
	};
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrsfl_asteroid_ambusher.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name               = &quot;ambusher_script&quot;;
this.author               = &quot;spara&quot;;
this.copyright            = &quot;2014 - 2015 Mika Spåra&quot;;
this.description         = &quot;RSS Ambusher shp script&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;

//fixed ai
//Tumbling part from Smivs - &#39;rotateDerelict&#39;. Code by Capt. Murphy.

this.shipSpawned = function() {
	this.rotateAmbushTimer = new Timer(this, this.rotateAmbush,3); // timer to start derelict rotation after 3 seconds
	delete this.shipSpawned;
}

this.rotateAmbush = function(){
 this.rotateVector = Vector3D.randomDirection(); // creates a random axis of rotation.
 this.rotateSpeedFactor = (Math.random() * (0.05) + 0.05); // creates a random rotate speed factor between 0.05 and 0.1 - 0.1 will result in a rotation speed of approx 1 full rotation every 63 seconds, 0.05 in a rotation speed of approx 1 full rotation every 126 seconds.
 this.rotateAmbushCallback = addFrameCallback(this.rotateFunction.bind(this)); // create FrameCallback
}

// delta is the time in game seconds since the last frame.
this.rotateFunction = function(delta) {
	if (!this.ship.isValid){
		removeFrameCallback(this.rotateAmbushCallback);
		delete this.rotateAmbushCallback;return;
	} // end FrameCallback is ship has died;
 if (delta === 0){return;} // do nothing if game is paused;
 var newOrientation = this.ship.orientation.rotate(this.rotateVector,delta*this.rotateSpeedFactor); // calculates new orientation, using delta as a factor so that rotation speed is constant across varying frame rates. delta*this.rotateSpeedFactor is a value in radians. There are approx 6.3 radians in a full rotation.
 this.ship.orientation = newOrientation; // applies new orientation;
}

this.activateAmbush = function() {
	
	//stop tumbling
	removeFrameCallback(this.rotateAmbushCallback);
	delete this.rotateAmbushCallback;
	//turn up the lights
	this.ship.subEntities[0].setMaterials({&quot;bbs_sidewinder_emission.png&quot;: {diffuse_map: &quot;rrsfl_asteroid_sidewinder_e.png&quot;, emission_map: &quot;rrsfl_asteroid_sidewinder_emission-lights.png&quot;, emission_modulate_color: (255, 252, 200, 0.75)}}); //colors the cockpit, navlights and engines only
	//name her
	if (worldScripts.randomshipnames) 
		this.ship.displayName = this.ship.name + &quot;: &quot; + worldScripts.randomshipnames.$randomPirateName(this.ship);
	else this.ship.displayName = this.ship.name;
	//correct scan class
	this.ship.scanClass = &quot;CLASS_NEUTRAL&quot;;
	//bring &#39;em on
	this.ship.switchAI(&quot;rescue-assassinAI.js&quot;);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrsfl_mining_outpost.js</td>
                    <td><pre>&quot;use strict&quot;;

this.author      = &quot;spara&quot;; 
this.copyright   = &quot;2014 - 2015 spara&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.name      = &quot;mining_outpost_ship_script&quot;;
this.description = &quot;Additional action to basic rock hermit AI.&quot;;

//Shooting the outpost or attacking ships near the outpost has concequences.

this.shipBeingAttacked = function(whom) {
	ship.target = whom;
	var defenseShip = this.ship.launchDefenseShip();
	if (defenseShip !== null) defenseShip.AIPrimaryAggressor = whom;
	if (whom === player) whom.bounty++;
}

this.distressMessageReceived = function(aggressor, sender) {
	ship.target = aggressor;
	var defenseShip = this.ship.launchDefenseShip();
	if (defenseShip !== null) defenseShip.AIPrimaryAggressor = aggressor;
	if (aggressor === player) aggressor.bounty++;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/rrsfl_mining_outpost_nc.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;mining_outpost_new_cargoes&quot;;
this.author      = &quot;spara&quot;; 
this.copyright   = &quot;2014 - 2015 spara&quot;; 
this.licence = &quot;CC-BY-SA 3.0&quot;;
this.description = &quot;Mining outpost new cargoes market definition. NC Market is there only to buy.&quot;;

this.startUp = function() {
	if (!worldScripts.CargoTypeExtension) return;
	else 
		worldScripts[&quot;CargoTypeExtension&quot;].registerOXPStation(this.name,&quot;rrs-mining-outpost&quot;);
}

this.exportCargoAmount = function(good) {
		return 0;
}

this.exportCargoPrice = function(good) {
		return 1;
}

this.importCargoPrice = function(good) {
		return 1;
}

this.randomCargoAmount = function(good) {
		return 0;
} 

this.randomCargoChance = function(good) {
		return 0;
}

this.randomImportChance = function(good) {
		return 0.;
}

this.systemImportChance = function(good) {
		return 0;
}

this.importPermitCheck = function() {
		return false;
}

this.exportPermitCheck = function() {
		return false;
}

this.stationGossip = function() {
		return false;
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
