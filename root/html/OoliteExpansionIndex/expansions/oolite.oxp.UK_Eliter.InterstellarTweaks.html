<html>
    <head>
        <title>Expansion Interstellar Tweaks</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Interstellar Tweaks</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">188 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">9 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER I)(&#39;[]&#39; vs &#39;[interstellar, ambience, systems, thargoids]&#39;)</li>
                <li>Conflict Expansions mismatch between OXP Manifest and Expansion Manager at character position 0056 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
                <li>Unresolved dependency reference to oolite.oxp.UK_Eliter.ferdelance_3G:6.5</li>
                <li>Unknown key &#39;upload_date&#39; at https://wiki.alioth.net/img_auth.php/7/7c/Oolite.oxp.UK_Eliter.InterstellarTweaks.oxz!manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds variety to what happens in interstellar space (and makes Frame&#39;s FuelCollector OXP more compatible with Oolite &gt;= 1.8).</td>
                    <td>Adds variety to what happens in interstellar space (and makes Frame&#39;s FuelCollector OXP more compatible with Oolite &gt;= 1.8).</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.UK_Eliter.InterstellarTweaks</td>
                    <td>oolite.oxp.UK_Eliter.InterstellarTweaks</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Interstellar Tweaks</td>
                    <td>Interstellar Tweaks</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>UK_Eliter</td>
                    <td>UK_Eliter</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>6.96</td>
                    <td>6.96</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>interstellar, ambience, systems, thargoids</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                            <li>oolite.oxp.UK_Eliter.ferdelance_3G:6.5</li>
                            <li>oolite.oxp.UK_Eliter.ExtraThargoids:6.5</li>
                    </td>
                    <td>
                            <li>oolite.oxp.UK_Eliter.ferdelance_3G:6.5</li>
                            <li>oolite.oxp.UK_Eliter.ExtraThargoids:6.5</li>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                            <li>InterstellarTweaks.oxp:0</li>
                    </td>
                    <td>
                            <li>InterstellarTweaks.oxp:</li>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://www.aegidian.org/bb/viewtopic.php?f=4&amp;t=11864&amp;hilit=interstellar+tweaks">http://www.aegidian.org/bb/viewtopic.php?f=4&amp;t=11864&amp;hilit=interstellar+tweaks</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/7/7c/Oolite.oxp.UK_Eliter.InterstellarTweaks.oxz">https://wiki.alioth.net/img_auth.php/7/7c/Oolite.oxp.UK_Eliter.InterstellarTweaks.oxz</a></td>
                    <td><a target="_blank" href="http://wiki.alioth.net/img_auth.php/7/7c/Oolite.oxp.UK_Eliter.InterstellarTweaks.oxz">http://wiki.alioth.net/img_auth.php/7/7c/Oolite.oxp.UK_Eliter.InterstellarTweaks.oxz</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 4.0 license</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 4.0 license</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1647017414</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Interstellar%20Tweaks'>http://wiki.alioth.net/index.php/Interstellar%20Tweaks</a></p>
        <h3>Readme &amp; License.txt</h3>
        <pre>
 _        _                   _        _  _             ___                  _
| |._ _ _| |_ ___  _ _  ___ _| |_ ___ | || | ___  _ _  |_ _|_ _ _  ___  ___ | |__ ___
| || &#39; | | | / ._&gt;| &#39;_&gt;&lt;_-&lt;  | | / ._&gt;| || |&lt;_&gt; || &#39;_&gt;  | || | | |/ ._&gt;&lt;_&gt; || / /&lt;_-&lt;
|_||_|_| |_| \___.|_|  /__/  |_| \___.|_||_|&lt;___||_|    |_||__/_/ \___.&lt;___||_\_\/__/


An expansion pack for Oolite

by &#39;UK_Eliter&#39;



---------------------------
REQUIREMENTS
---------------------------

� This expansion pack requires Oolite version *1.82* or above.
� Various expansion packs are recommended (but not necessary) to complement this one.
� See the &#39;General notes&#39; section below.


------------------------
GENERAL NOTES
------------------------

� This expansion pack makes misjumps a little more likely and, fairly often, modifies what happens when one misjumps. One can encounter only the navy, or only thargoids, or empty witchspace or . . various other things. The expansion pack also gives you a chance of having your escape pod rescued in interstellar space by any nearby behemoths or leviathans (presuming you have such ships installed). That chance increased if you have the &#39;electronic thumb&#39; equipment.

� The load that Interstellar Tweaks will place on your computer will be, for the most part, light to moderate (and, mostly, via CPU much more than RAM and graphics card). But if you have many of the expansion packs recommended below installed, then that will increase the load.

� The difficulty of this expansion pack varies automatically, in various ways, with the player score.

� This expansion pack makes various uses of numerous other expansion packs, when they are installed. Most of those expansion packs are listed below. The ones marked &#39;*&#39; are especially recommended for use with Interstellar Tweaks.

	- Armoury;
	- *Behemoth;*
	- Breakable WitchDrive (preferably version 1.3 or above);
	- *Electronic Thumb;*
	- Enhanced MisJump (which changes the &#39;tunnel&#39; effect when one misjumps);*
	- *Escape Pod Locator;*
	- *Extra Thargoids (use version &gt;= 3.0 );* 
	- *Fer-de-Lance 3G (use version &gt;= 5.01 [NB the version!] );*
	- *Fuel Collector* [patching no longer necessary with this version of Interstellar Tweaks]
	- *Galactic Navy;*
	- *Generation Ships* (note: the present expansion pack will - for one thing - make generation ships rarer); 
	- Griff&#39;s shipset expansion packs (for, especially, nice looking thargoids!);
	- Interstellar Help;
	- *Military Fiasco;*
	- Misjump Analyzer;
	- Missionaries;
	- *mPakRedux (a.k.a. &#39;Rusties&#39;);*
	- Spectre [patch no longer necessary];
	- Star Destroyer (use version &gt;= 1.5);
	- Tionisla Orbital Graveyeard (&gt;= 2.4; needs its &#39;Shipwrecks&#39; supplement)
	- TCAT (= &#39;To Catch a Thargoid&#39;);
	- Thargoid Carrier (this will considerably increase the thargoid threat - though it can be offset somewhat via my Fer-de-Lance 3G expansion pack);
	- *Thargorn_Threat (preferably version 1.5.2 or above);*
	- Wormwhole Restoration.

� Interstellar Tweaks is compatible with THARGOID WITCHSPACE DRIVE. Moreover, Interstellar Tweaks seems to work with the WORMWHOLE DRONE expansion pack. Interstellar Tweaks should be compatible with cim&#39;s &#39;Galactic Misjump&#39;, too.


---------------
LICENSE
---------------

This expansion pack is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/2.0/ or send a letter to Creative Commons, 559 Nathan Abbott Way, Stanford, California 94305, USA. 

You are free:

� to copy, distribute, display, and perform the work;
� to make derivative works. 

But only under the following conditions.

� Attribution: you must give the original author credit. 
� Non-commercial use: you may not use this work for commercial purposes. 
� Share Alike: if you alter, transform, or build upon this work, you may distribute the resulting work only under a license materially identical to this one. 

Your fair use right and other rights are in no way affected by the above.


-----------------------------
 ACKNOWLEDGEMENTS
-----------------------------

My thanks to the following (from some of whom I have adapted code):

	Another Commander; Arexack Heretic; Capt. Murphy; cim; Commander McLane; Draco_Caeles; Duggan; Dr Nil and other contributors to the &#39;Your Ad Here&#39; expansion pack; Eric Walch; Gimi; Norby; phkb; Rustem; SirAdrian; Thargoid; Solonar; Switeck. Other OOliters have contributed in smaller ways and I am grateful to them too.


--------------------------------------------
 NOTE FOR EXPANSION PACK MAKERS
--------------------------------------------

This expansion pack takes over Oolite&#39;s populator and repopulator functions for interstellar space.  Sometimes, though, it will run Oolite&#39;s inbuilt populator together with populators from other expansion packs.

Also, and partly because of the old way in which Oolite used to do population, my expansion pack populates and depopulates interstellar space in other, more hack-ish ways.


----------------- END OF FILE ----------------- </pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/IST_TCAT_droneAndControllerOVERRIDE.html">IST_TCAT_droneAndControllerOVERRIDE</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_Tharglet.html">IST_Tharglet</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_alien_cargopod.html">IST_alien_cargopod</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_alloy.html">IST_alloy</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_asteroid.html">IST_asteroid</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_asteroid_b.html">IST_asteroid_b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_boulder.html">IST_boulder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_cargopod.html">IST_cargopod</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_Adder.html">IST_derelict_Adder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_AdderRusty.html">IST_derelict_AdderRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_AdderRusty_tionisla.html">IST_derelict_AdderRusty_tionisla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_Anaconda.html">IST_derelict_Anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_AnacondaRusty.html">IST_derelict_AnacondaRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_AnacondaRusty_tionisla.html">IST_derelict_AnacondaRusty_tionisla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_Asp.html">IST_derelict_Asp</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_AspRusty.html">IST_derelict_AspRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_AspRusty_tionisla.html">IST_derelict_AspRusty_tionisla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_Boa.html">IST_derelict_Boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_BoaRusty.html">IST_derelict_BoaRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_BoaRusty2.html">IST_derelict_BoaRusty2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_BoaRusty2_tionisla.html">IST_derelict_BoaRusty2_tionisla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_BoaRusty_tionisla.html">IST_derelict_BoaRusty_tionisla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_CobraI.html">IST_derelict_CobraI</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_CobraIII.html">IST_derelict_CobraIII</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_CobraIIIRusty.html">IST_derelict_CobraIIIRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_CobraIIIRusty_tionisla.html">IST_derelict_CobraIIIRusty_tionisla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_CobraIRusty.html">IST_derelict_CobraIRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_CobraIRusty_tionisla.html">IST_derelict_CobraIRusty_tionisla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_Ferdelance.html">IST_derelict_Ferdelance</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_Krait.html">IST_derelict_Krait</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_KraitRusty.html">IST_derelict_KraitRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_KraitRusty_tionisla.html">IST_derelict_KraitRusty_tionisla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_MambaRusty.html">IST_derelict_MambaRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_MambaRusty_tionisla.html">IST_derelict_MambaRusty_tionisla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_Moray.html">IST_derelict_Moray</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_MorayMED.html">IST_derelict_MorayMED</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_MorayRusty.html">IST_derelict_MorayRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_Python.html">IST_derelict_Python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_PythonRusty.html">IST_derelict_PythonRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_PythonRusty_tionisla.html">IST_derelict_PythonRusty_tionisla</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_Sidewinder.html">IST_derelict_Sidewinder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_SidewinderRusty.html">IST_derelict_SidewinderRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_Thargoid.html">IST_derelict_Thargoid</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_Viper.html">IST_derelict_Viper</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_ViperInterceptor.html">IST_derelict_ViperInterceptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_ViperInterceptorRusty.html">IST_derelict_ViperInterceptorRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_derelict_ViperRusty.html">IST_derelict_ViperRusty</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_destroyer.html">Star Destroyer (naval)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_generation-ship-cylinder.html">IST_generation-ship-cylinder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_generation-ship-dock.html">IST_generation-ship-dock</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_generation-ship-frame.html">IST_generation-ship-frame</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_generation-ship-thruster.html">IST_generation-ship-thruster</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_genship1.html">Generation Ship (Hijacked)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter1.html">IST_hunter1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter10.html">IST_hunter10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter11a.html">IST_hunter11a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter12.html">IST_hunter12</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter13.html">IST_hunter13</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter14.html">IST_hunter14</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter15.html">IST_hunter15</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter16.html">IST_hunter16</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter17.html">IST_hunter17</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter18.html">IST_hunter18</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter19.html">IST_hunter19</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter19a.html">IST_hunter19a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter19b.html">IST_hunter19b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter2.html">IST_hunter2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter20.html">IST_hunter20</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter21.html">IST_hunter21</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter22.html">IST_hunter22</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter23.html">IST_hunter23</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter23n.html">IST_hunter23n</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter24.html">IST_hunter24</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter25.html">IST_hunter25</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter26.html">IST_hunter26</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter27.html">IST_hunter27</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter28.html">IST_hunter28</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter29.html">IST_hunter29</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter2a.html">IST_hunter2a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter3.html">IST_hunter3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter31.html">IST_hunter31</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter32.html">IST_hunter32</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter33.html">IST_hunter33</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter34.html">IST_hunter34</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter3a.html">IST_hunter3a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter4.html">IST_hunter4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter5.html">IST_hunter5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter5b.html">IST_hunter5b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter6.html">IST_hunter6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter6a.html">IST_hunter6a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter7.html">IST_hunter7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter8.html">IST_hunter8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_hunter9.html">IST_hunter9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_lobster.html">IST_lobster</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_lobsterUber.html">Priest of the Witchspace Lobster</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_lobster_acolyteEscort.html">Acolyte of the Witchspace Lobster</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_lobster_acolyteNonEscort.html">Acolyte of the Witchspace Lobster</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil1.html">GalCop Viper (naval)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil10.html">IST_mil10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil11.html">IST_mil11</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil12.html">IST_mil12</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil13.html">IST_mil13</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil14.html">IST_mil14</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil15.html">IST_mil15</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil16.html">IST_mil16</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil17.html">IST_mil17</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil19.html">IST_mil19</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil20.html">Super-Sidewinder (Military version)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil4.html">IST_mil4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil5b.html">IST_mil5b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil6.html">IST_mil6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil7.html">IST_mil7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil7a.html">IST_mil7a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil8.html">IST_mil8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_mil9.html">IST_mil9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_miner1.html">IST_miner1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_miner1b.html">IST_miner1b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_miner2.html">IST_miner2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_miner3.html">IST_miner3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_miner4.html">IST_miner4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_miner5.html">IST_miner5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_miner6.html">IST_miner6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_miner6b.html">IST_miner6b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_miner7.html">IST_miner7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_miner8.html">IST_miner8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate1.html">IST_pirate1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate10.html">IST_pirate10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate11.html">IST_pirate11</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate11a.html">IST_pirate11a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate12.html">IST_pirate12</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate13.html">IST_pirate13</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate14.html">IST_pirate14</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate15.html">IST_pirate15</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate16.html">IST_pirate16</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate17.html">IST_pirate17</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate18.html">IST_pirate18</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate19.html">IST_pirate19</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate19a.html">IST_pirate19a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate2.html">IST_pirate2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate20.html">IST_pirate20</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate21.html">IST_pirate21</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate22.html">IST_pirate22</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate23.html">IST_pirate23</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate23b.html">IST_pirate23b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate24.html">IST_pirate24</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate25.html">IST_pirate25</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate26.html">IST_pirate26</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate27.html">IST_pirate27</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate28.html">IST_pirate28</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate29.html">IST_pirate29</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate2a.html">IST_pirate2a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate3.html">IST_pirate3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate30.html">IST_pirate30</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate30b.html">IST_pirate30b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate31.html">IST_pirate31</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate32.html">IST_pirate32</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate33.html">IST_pirate33</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate33a.html">IST_pirate33a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate34.html">IST_pirate34</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate35.html">IST_pirate35</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate3a.html">IST_pirate3a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate3b.html">IST_pirate3b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate4.html">IST_pirate4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate5.html">IST_pirate5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate5b.html">IST_pirate5b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate6.html">IST_pirate6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate6a.html">IST_pirate6a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate7.html">IST_pirate7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate8.html">IST_pirate8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pirate9.html">IST_pirate9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pod1.html">IST_pod1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pod2.html">IST_pod2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pod3.html">IST_pod3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_pod4.html">IST_pod4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidDefenceShip.html">IST_thargoidDefenceShip</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidLurker.html">IST_thargoidLurker</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidRebelBattleship.html">Thargoid Battleship (rebel)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidRebelTougherWarship.html">IST_thargoidRebelTougherWarship</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidRebelWarship.html">Thargoid Warship (rebel)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidSweeper.html">IST_thargoidSweeper</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidWarship.html">IST_thargoidWarship</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidWarship-buggly.html">IST_thargoidWarship-buggly</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidWarship-buggly2.html">IST_thargoidWarship-buggly2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidWarship-buggly2b.html">IST_thargoidWarship-buggly2b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidWarship-bugglyB.html">IST_thargoidWarship-bugglyB</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidWarship-frigate.html">IST_thargoidWarship-frigate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_thargoidWarship2.html">IST_thargoidWarship2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/IST_tieFighter.html">TIE Fighter (naval)</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/IST_derelict.js</td>
                    <td><pre>/*
========================================================================
IST_derelict.js
This file is part of the Interstellar Tweaks expansion pack.
Author: UK_Eliter
License: 2017 Creative Commons: attribution, non-commercial, sharealike.
========================================================================
*/


this.name = &quot;IST_derelict.js&quot;;
this.author = &quot;UK_Eliter&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;
this.description = &quot;A script for InterstellarTweaks OXP&quot;;

/*
--------------------------------------------
Start of wrapper for JSHINT 
See also Jshint options above.
The following should be: &#39;function(){&#39; (sic)
--------------------------------------------
*/
(
	function() {

		&quot;use strict&quot;;

		/*
		------------------
		DEBUGGING SWITCHES
		------------------
		*/

		// this.logging = true;
		var consoleDebugMessages = false; // do NOT comment this out. Rather, to disable, set to false.


		/*
		--------------
		EVENT HANDLERS
		--------------
		*/

		this.shipSpawned = function() {
			var r = Math.random();
			if (this.ship.hasRole(&quot;IST_derelictthargoid&quot;)) {
				r += 0.1;
			}
			if (r &lt; 0.2) {
				var fuel = Math.random() * 2.4; // this is in lightyears
				if (r &lt; 0.12) {
					fuel *= (1 + r);
				}
				this.ship.fuel = fuel;
			}
			r = Math.random();
			if (r &lt; 0.9) {
				// energy *recharge* inaccessible via script. (But can use a script for isTakingDamage, or - as in fact I&#39;ve done - set the rate in shipdata.)
				if (r &lt; 0.5) {
					this.ship.energy *= 0.2;
				} else {
					this.ship.energy *= r;
				}
			}
			delete this.shipSpawned;
		};

		this.shipTakingDamage = function(amount) {
			if (this.ship.energy &gt; amount) {
				return;
			}
			if (this.ship.AI === &quot;IST_bombAI.plist&quot;) {
				return;
			}
			if (Math.random() &lt;= 0.015) // 0.015
			{
				this.ship.energy = 50; // ship is about to explode, keep it alive for a moment.
				this.ship.switchAI(&quot;IST_bombAI.plist&quot;);
				return;
			}
			if (this.ship.cargoSpaceCapacity &gt; 0 &amp;&amp; Math.random() &lt; 0.15) // 0.15
			{
				this.ship.energy = 50; // ship is about to explode, keep it alive for a moment.
				var numOfPodsToEject;
				if (this.ship.cargoSpaceCapacity &lt; 8) // this number relates to one below, marked &#39;*&#39;
				{
					numOfPodsToEject = Math.ceil(Math.random() * (this.ship.cargoSpaceCapacity / 4));
				} else {
					numOfPodsToEject = Math.ceil(Math.random() * (this.ship.cargoSpaceCapacity / 7));
					if (numOfPodsToEject &gt; 30) {
						numOfPodsToEject -= 10;
					} else if (numOfPodsToEject &gt; 15) {
						numOfPodsToEject -= (Math.ceil(Math.random() * 12));
					} else if ((numOfPodsToEject &gt; 7) &amp;&amp; (Math.random() &lt; 0.5)) {
						numOfPodsToEject = Math.ceil(Math.random() * (numOfPodsToEject / 2));
					}
				}
				this.ship.spawn(&quot;cargopod&quot;, numOfPodsToEject);
				this.ship.explode(true);
			}
		};

		/*
		------------------------------
		End of wrapper for JSHINT.
		See also Jshint options above.
		------------------------------
		*/

	}).call(this);

// EOF
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/IST_genship.js</td>
                    <td><pre>/* jshint esversion: 6 */

/*
---------------------------------
HEADER
---------------------------------
*/


this.name = &quot;IST_genship.js&quot;;
this.author = &quot;UK_Eliter&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;
this.description = &quot;A ship script for the Interstellar Tweaks OXP&quot;;

/*
---------------------------------
DEBUGGING SWITCHES
---------------------------------
*/

this.logging = false;
//	Corresponds to, or needs, settings in logcontrol.plist?

this.debug = false;
//	false

var consoleDebugMessages = false;
//	Do NOT comment this out. Rather, to disable, set to false.


/*
---------------------------------
SOUNDS
---------------------------------
*/

var mysound_Warning = new SoundSource();
mysound_Warning.sound = &quot;warning.ogg&quot;;
//	This sound built-in to Oolite - and does not need to be declared in the &#39;customsounds&#39; file.

/*
---------------------------------
JSLINT: start of wrapper
---------------------------------
*/

(function() {
	&quot;use strict&quot;;

	/*
	---------------------------------
	DEBUGGING
	---------------------------------
	*/

	this.$debugMessage = function(debugTxt) {
		if (!this.debug) {
			return;
		} // NB. THIS ROUTINE DOES NOTHING IF this.debug IS NOT TRUE
		// else
		if (!debugTxt) {
			player.consoleMessage(&quot;Problem with debug message text!&quot;, 30);
			return;
		}
		player.consoleMessage(&quot;Interstellar Tweaks - &quot; + debugTxt, 12);
		log(&quot;InterstellarTweaks - debugging&quot;, debugTxt);
	};


	/*
	---------------------------------
	MISC
	---------------------------------
	*/

	this.$isEligibleTarget = function(e) {
		return !e.isCloaked &amp;&amp; ((e.isPlayer &amp;&amp; !e.docked) || (e.isShip &amp;&amp; e.ispiloted &amp;&amp; (!e.isThargoid || e.primaryRole === &quot;thargoidRebel&quot;)));
	};


	/*
	---------------------------------
	ROUTINES CALLED BY AI
	---------------------------------
	*/

	this.$_findNearTargets = function() {
		var nearArray = system.filteredEntities(this, this.$isEligibleTarget, this.ship, 25600);
		if (nearArray.length == 0) {
			this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;);
			return;
		}
		// Else ..
		this.targetNumber = ~~(Math.random() * nearArray.length); // NB: ~~ (a.k.a.) math.floor (as Vs .ceil) is correct
		if (this.targetNumber &gt; nearArray.length) {
			log(this.name + &quot; script error, target number too high - please report&quot;);
			this.targetNumber = 0;
		}
		this.ship.target = nearArray[this.targetNumber];
		this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
		if (this.debug) {
			this.$debugMessage(&quot;Near target&quot;);
		}
	};

	this.$_findFarTargets = function() {
		var farArray = system.filteredEntities(this, this.$isEligibleTarget, this.ship, 70000);
		if (farArray.length == 0) {
			this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;);
			// this.$debugMessage(&quot;NO far target&quot;);
			return;
		}
		// Else ..
		this.ship.target = farArray[0]; // set to the closest target off-scanner but in range
		this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
		if (this.debug) {
			this.$debugMessage(&quot;Far target&quot;);
		}
	};

	this.$_validateTarget = function() {
		if (this.ship.target &amp;&amp; this.ship.target.isValid &amp;&amp; this.$isEligibleTarget(this.ship.target)) {
			this.ship.reactToAIMessage(&quot;TARGET_VALID&quot;);
		} else {
			this.ship.reactToAIMessage(&quot;TARGET_INVALID&quot;);
		}
	};

	this.$_curse = function() {
		this.ship.commsMessage(expandDescription(&quot;[thargoid_curses]&quot;), player.ship);
	};


	/*
	---------------------------------
	JSLINT: end of wrapper
	---------------------------------
	*/

}).call(this);


// EOF</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/IST_liveOneScript.js</td>
                    <td><pre>/*
========================================================================
IST_liveOneScript.js
This file is part of the Interstellar Tweaks expansion pack.
Author: UK_Eliter
License: 2017 Creative Commons: attribution, non-commercial, sharealike.
========================================================================
*/

/*
------------------------
JSHINT: Options
------------------------
*/

/*jshint esversion: 6*/
/*jshint sub:true*/


this.name = &quot;IST_liveOneScript.js&quot;;
this.author = &quot;UK_Eliter&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;
this.description = &quot;A ship script for the Interstellar Tweaks OXP&quot;;


/*
--------------
DEBUG SWITCHES
--------------
*/

// this.logging = true;
var consoleDebugMessages = false; // do NOT comment this out. Rather, to disable, set to false.



/*
------------------------
JSHINT: start of wrapper
------------------------
*/

(function() {
	&quot;use strict&quot;;


	/*
	-------------------------------------------------------------
	EVENT HANDLERS
	// Don&#39;t need the &#39;this.shipSpawned&#39; from the &#39;dead derelict&#39;,
	because all live derelicts start off dead.
	--------------------------------------------------------------
	*/

	this.shipTakingDamage = function(amount, whom, type) {
		if (this.isInFactDead || this.ship.podded) {
			return;
		}
		if (this.ship.energy &lt; 20) {
			if (Math.random() &lt; 0.8) {
				this.$_pod();
			}
			return;
		}
		// Else ..
		if (Math.random() &lt; 0.25) {
			this.$_pod();
		}
		// Don&#39;t need anything re cargo here, &#39;cos when the pod jettisoned the new script takes care of that (but have the podded check above just in case).
		// EDIT: &#39;this.isInFactDead&#39; messes with this a bit. Hey ho.
	};

	this.shipDied = this.entityDestroyed = this.playerWillEnterWitchspace = function() {
		if (this.SOS_Timer) {
			if (this.SOS_Timer.isRunning) {
				this.SOS_Timer.stop();
			}
			delete this.SOS_Timer;
		}
	};

	this.shipAttackedWithMissile = function() {
		if (this.isInFactDead || this.ship.podded) {
			return;
		}
		if (Math.random() &lt; 0.9) {
			this.$_pod();
		}
	};


	/*
	---------------------
	ROUTINES CALLED BY AI
	---------------------
	*/

	this.$_setFuelAndConsiderRegularSOS = function() {
		this.isInFactDead = false;
		if (this.ship.fuel &gt; 0) {
			var r = Math.random();
			if ((this.ship.fuel &gt; 3) || (r &lt; 0.9)) {
				this.ship.fuel = r; // can&#39;t do this on a shipSpawned, &#39;cos this ship doesn&#39;t get one of those. Fuel set before this by dead_derelict script.
			}
		}
		if (Math.random() &lt; 0.6) {
			var t = 1 + Math.ceil(Math.random() * 8);
			this.SOS_Timer = new Timer(this, this.$SOS, t);
			// Following is to simulate dead ships that nonetheless broadcast SOS.
			if (Math.random() &lt; 0.1) {
				this.isInFactDead = true;
			}
		}
	};

	this.$_pod = function() {
		if (!this.ship || !this.ship.position || !player.ship || this.ship.podded || this.isInFactDead) {
			return;
		}
		if (this.SOS_Timer &amp;&amp; Math.random &lt; 0.3) {
			if (this.SOS_Timer.isRunning) {
				this.SOS_Timer.stop();
			}
			delete this.SOS_Timer; // Timer likely to have been stopped before now, anyway.
		}
		this.ship.podded = true;
		if (Math.random() &gt; 0.04) {
			var pod = this.ship.spawnOne(&quot;IST_pod&quot;);
			this.ship.switchAI(&quot;nullAI.plist&quot;);
			this.ship.setScript(&quot;IST_derelict.js&quot;);
		} else {
			if (this.SOS_Timer) {
				if (this.SOS_Timer.isRunning) {
					this.SOS_Timer.stop();
				}
				delete this.SOS_Timer;
			}
			if (Math.random() &gt; 0.15) {
				this.ship.commsMessage(&quot;Oh dear . . &quot;);
			}
			this.ship.switchAI(&quot;nullAI.plist&quot;);
			this.ship.explode();
		}
	};

	this.$_plea = function() {
		if (this.isInFactDead || this.ship.podded || !this.ship || !this.ship.position || !player.ship) {
			return;
		}
		var messagePicker = Math.ceil(Math.random() * 35);
		var txt;
		if (this.SOS_Timer &amp;&amp; Math.random &lt; 0.8) {
			if (this.SOS_Timer.isRunning) {
				this.SOS_Timer.stop();
			}
			delete this.SOS_Timer;
		}
		switch (messagePicker) {
			case 1:
				txt = &quot;Please pick up my capsule! I am completely stranded!&quot;;
				break;
			case 2:
				txt = &quot;Help me out, please!&quot;;
				break;
			case 3:
				txt = &quot;I am stuck out here!&quot;;
				break;
			case 4:
				txt = &quot;Take me back to normal space! I will pay you!&quot;;
				break;
			case 6:
				txt = &quot;Pick me up! I&#39;ll pay!&quot;;
				break;
			case 7:
				txt = &quot;Pick me up, and I will make you rich!&quot;;
				break;
			case 8:
				txt = &quot;My ship is broken!&quot;;
				break;
			case 9:
				txt = &quot;My ship is completely broken!&quot;;
				break;
			case 10:
				txt = &quot;Help! Broken ship!&quot;;
				break;
			case 11:
				txt = &quot;Help! No engines!&quot;;
				break;
			case 12:
				txt = &quot;Pick up my escape pod! Please!&quot;;
				break;
			case 13:
				txt = &quot;Help at last! Amazing! Please scoop me (carefully!).&quot;;
				break;
			case 14:
				txt = &quot;Any chance of a lift?&quot;;
				break;
			case 15:
				txt = &quot;Help!&quot;;
				break;
			case 16:
				txt = &quot;Please help!&quot;;
				break;
			case 17:
				txt = &quot;Help!&quot;;
				break;
			case 18:
				txt = &quot;Help!&quot;;
				break;
			case 19:
				txt = &quot;Help!&quot;;
				break;
			case 20:
				txt = &quot;I need help!&quot;;
				break;
			case 21:
				txt = &quot;Please pick up my capsule!&quot;;
				break;
			case 22:
				txt = &quot;&lt;Static&gt;&quot;;
				break;
			default:
				txt = &quot;S O S&quot;;
				break;
		}
		this.ship.commsMessage(txt);
		// always followed by &#39;podding&#39;.
	};


	/*
	---------------
	OTHER FUNCTIONS
	---------------
	*/

	this.$SOS = function $SOS() {
		if (!this.ship) {
			return;
		}
		if (!this.ship.position) {
			return;
		}
		this.ship.commsMessage(&quot;S O S&quot;); // this.ship.broadcastDistressMessage() is (1) only available in += 1.79, (2) perhaps applicable only to combat.
	};



	/*
	---------------------------------
	JSHINT: end of wrapper
	---------------------------------
	*/

}).call(this);


// EOF</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/IST_lobster.js</td>
                    <td><pre>/*
========================================================================
IST_lobster.js
This file is part of the Interstellar Tweaks expansion pack.
Author: UK_Eliter
License: 2017 Creative Commons: attribution, non-commercial, sharealike.
========================================================================
*/


/* jshint esversion: 6 */

this.name = &quot;IST_lobster.js&quot;;
this.author = &quot;UK_Eliter&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;
this.description = &quot;A script for InterstellarTweaks OXP&quot;;


/*
------------------
DEBUGGING SWITCHES
------------------
*/

// this.logging = true;
var consoleDebugMessages = false; // do NOT comment this out. Rather, to disable, set to false.


/*
---------------------------------
JSHINT: start of wrapper
---------------------------------
*/

(function() {
	&quot;use strict&quot;;


	/*
	--------
	FUNCTION
	--------s
	*/

	this.shipAttackedWithMissile = function() {
		// This routine called by built-in handler
		var shipWithECM_localVariable = this.$shipWithECM;
		// log(&quot;InterstellarTweaks - debugging&quot;, &quot;trying to ecm - 1&quot;);
		if (shipWithECM_localVariable &amp;&amp; shipWithECM_localVariable.isValid) {
			// log(&quot;InterstellarTweaks - debugging&quot;, &quot;trying to ecm - 2&quot;);
			shipWithECM_localVariable.fireECM();
			return;
		}
		// Else ..
		this.ship.reactToAIMessage(&quot;ECM_UNAVAILABLE&quot;);
		// log(&quot;InterstellarTweaks - debugging&quot;, &quot;no ecm&quot;);
	};


	/*
	----------------------
	JSHINT: end of wrapper
	----------------------
	*/

}).call(this);


// EOF</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/IST_masterScript.js</td>
                    <td><pre>/*
===================================================================================================================

IST_masterScript.js
This file is part of the Interstellar Tweaks expansion pack.
Author: UK_Eliter
License: 2017 Creative Commons: attribution, non-commercial, sharealike.

_____   __________________  ___________________    __    ___    ____     ______         _________    __ _______
/  _/ | / /_  __/ ____/ __ \/ ___/_  __/ ____/ /   / /   /   |  / __ \   /_  __/      __/ ____/   |  / //_/ ___/
/ //  |/ / / / / __/ / /_/ /\__ \ / / / __/ / /   / /   / /| | / /_/ /    / / | | /| / / __/ / /| | / ,&lt;  \__ \
_/ // /|  / / / / /___/ _, _/___/ // / / /___/ /___/ /___/ ___ |/ _, _/    / /  | |/ |/ / /___/ ___ |/ /| |___/ /
/___/_/ |_/ /_/ /_____/_/ |_|/____//_/ /_____/_____/_____/_/  |_/_/ |_|    /_/   |__/|__/_____/_/  |_/_/ |_/____/

For Oolite &gt;= 1.82.

===================================================================================================================
*/


/*
====================
JSLINT: set options
====================
*/

/*jshint esversion: 6*/
/*jshint sub:true*/


this.name = &quot;IST_masterScript&quot;;
this.author = &quot;UK_Eliter&quot;;
this.copyright = &quot;2017-2022 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;
this.description = &quot;Interstellar Tweaks&quot;;


/*
================
C O N T E N T S
================

1	NOTES

2	DEBUGGING: set switches

3	SOUNDS

4	CONSTANTS

5	DEBUGGING: apply switches

5	GLOBAL VARIABLES

6	OVERVIEW OF THE MAIN ROUTINES

7	EVENT HANDLERS (including startup and populator routines)
	[At present this section seques into most of the code&#39;s other routines]

8	WRAPPER FOR JSLINT, start

9	OPTIMISATION ROUTINES

10	ENTITY-PICKERS (/filters)

11	MISC ROUTINES

12	ERROR &amp; MESSAGE HANDLING

13	WRAPPER FOR JSLINT, end [the wrapper *begins*, perforce, above this table of contents]


=============
1.	N O T E S
=============

MUST END FUNCTION CALLS WITH &#39;()&#39; (or arguments)
else ROUTINE DOES NOT RUN (but gives no error!)

Functions that are run (immediately) by timers should have names
of the following format, else the Oolite log won&#39;t give the function name:

this.$&lt;function name&gt; = function $&lt;function name&gt;()

E.g.:

this.$die_timed = function $die()

NB: ONE GETS ERRORS THAT ARE HARD TO TRACK, AND FLAGGED BY LINTER AT END OF SCRIPT, IF MISMATCH THOSE FUNCTION NAMES.
	SAME GOES FOR IF HAVE *TWO* &#39;{&#39;s at start of function. So, as in Linux kernel convention, don&#39;t do that.

Also, if use the Oolite &#39;profiler&#39;, need to name ALL functions
like that, on pain of them showing as &#39;anonymous&#39; in the profiler.

The scrambledPseudoRandomNumber seeds in this OXP start at: 700000.

Some faster equivalents of mathematical operations
--------------------------------------------------

Math.abs(x):	x &gt;= 0 ? x : -x
Math.max(x,y):	x &gt; y ? x : y
Math.min(x,y):	x&lt;y ? x : y
Math.floor(x):	~~x
Math.round(x):	~~(x+0.5)
Math.ceil(x):	~~(x+1)

While loops of the &#39;while (i--)&#39; form are faster than &#39;for&#39; loops. On how those &#39;while&#39; loops work, see:
https://stackoverflow.com/questions/22181713/what-does-whilei-mean-in-javascript


/*
====================
2. D E B U G G I N G
====================
*/

this.debug_full = false;
//	false.
//	See below for effects.
//	If set to true, then, later, the script changes this.debug to true.

this.debug = false;
//	false

// The only way to easily test the various interstellar scenarios - given how my code is - is to set the probability for them to 1, and to stop other stuff firing first. We set those probabilities in section 4. See also section 5.


/*
==============
3. S O U N D S
==============
*/

// The following two sounds are built into Oolite.
// So they the &#39;customsounds&#39; file need not declare them.

this.mySound_warning = new SoundSource();
this.mySound_warning.sound = &quot;warning.ogg&quot;;

this.mySound_hullBang = new SoundSource();
this.mySound_hullBang.sound = &quot;hullbang.ogg&quot;;


/*
====================
4. C O N S T A N T S
====================
*/

/*
--------------
SICKNESS stuff
--------------
*/

this.sickness_baseChanceOfGetting = 0;
//	0
//	Gets increased by jumps within witchspace.

this.sickness_chanceKills = 0.39;
//	0.39
//	Can be slightly modified by player rank.

/*
---------------------
ESCAPE SEQUENCE stuff
---------------------
*/

this.escapeSequence_baseBugsGetPodChance = 0.08;
//	0.08
//	Gets changed by circumstances. May get error if set below 0.
//	There is a chance that the game itself will destroy the pod.
//	The main cause of death here is simply not being picked up.

this.escapeSequence_baseRescue_chance = 0.85;
//	0.85
//	Gets affected by various things, and is used, sometimes modified,
//	to determine various chances of rescue.
//	And there does need to be a ship to pick you up.
//  See also, below: this.stellar_postRescueAmbush_chance

/*
------------------
SCENARIO - general
------------------
*/

this.scenario_chanceMajorTweak = 0.49;
//	0.49
//	Chance script alters a misjump in any substantial way.
//	Altered by presence of some particular OXPs.
//	NB: &#39;this.debug_full = true&#39; makes this 1.

this.scenario_chanceModifiedAsVsNew = 0.51;
//	0.51
//	Chance of &#39;modified&#39; as versus &#39;new&#39; scenario.
//	There are OXPs thi detection of which will alter the chance.

this.scenario_chanceScriptInducedMisjump = 0.03;
//	0.03
//	Gets drastically lowered if the Misjump Analyzer is installed.

this.scenario_interstellarPostWillExitTimed = 0.75;
//	0.75
//	= Delay after shipWillExitWitchspace for $willExit_interstellar_timed routine.
//	Timed. For, if move player (= when this value is too low) too
//	quickly can (1) lose player&#39;s witchspace rings, (2) crash Oolite,
//	(3) create screen flash. &amp; this value *VERY* sensitive.
//	0.86 seems to crash. 0.75 works.

this.scenario_delayBeforeReturnShipToGroundZero = 0.75;
//	0.75.
//	Delay after shipExitedWitchspace for my $postJump_timed routine.
//	If set too low, get rings - but, if set much higher, can get crashes.

this.scenario_genShipsRemovalChance = 0.76;
//	0.76


/*
------------------
SCENARIO - default
------------------
*/

this.scenario_default_chanceAsteroids = 0.035;
//	0.035

this.scenario_default_chanceExtraSeperateClash = 0.15;
//	0.15

/*
-------------------
SCENARIO - modified
-------------------
*/

this.scenario_modified_limitBattleships_chance = 0.87;
//	0.87
//	Only necessary, &amp; only used, if the Thargorn Threat OXP is installed.

this.scenario_modified_limitBattleships_maxShips = 3;
//	3

this.scenario_modified_wasBattle_chance = 0.28;
//	0.28
//	= chance that, on onlyBugs | onlyNavy, get wreckage too &amp; fewer ships.
//	Value is set slightly higher than would otherwise be.
//	That is for this reason:
//	if we have only a few navy, battle stuff (incl. wreckage) is ignored.

this.scenario_modified_wasBattle_wreckageOnly_chance = 0.15;
//	0.15

this.scenario_modified_onlyBugs_addSweeperChance = 0.41;
//	0.41
//	Needs ExtraThargoids OXP (which might generate sweepers anyway).
//	WasBattle can remove and damage sweepers.

this.scenario_modified_onlyBugs_multiplyBugsChance = 0.07;
//	0.07

this.scenario_modified_onlyBugs_aliensChance = 0.1;
//	0.1

this.scenario_modified_onlyBugs_rebelChance = 0.09;
//	0.09
//	Exclusive with scenario_modified_onlyBugs_aliensChance.
//	Gets increased in galaxy 2.
//	NB: The &#39;new scenario&#39; too allows internicine strife.

this.scenario_modified_onlyBugs_3GChance = 0.11;
//	0.11
//	Various things modify this.

this.scenario_modified_onlyBugs_thargGenship_chance = 0.02;
//	0.02
//	Gets inflected by player rank.
//	The Thargoid GenShip can occur also in the NEW scenario.

this.scenario_modified_chanceOffsetFromAction = 0.09;
//	0.09

this.scenario_modified_chanceNavyAsVBugs = 0.57;
//	0.57
//	Determines chance of &#39;OnlyBugs&#39;.
//	Includes possibility of just adding *extra* navy. Rank-inflected.

this.scenario_modified_chanceOnlyNavyNotExtraNavy = 0.65;
//	0.65

this.scenario_modified_onlyNavy_replaceNavyChance = 0.65;
//	0.65
//	This is one method I use to stop the navy jumping out immediately.
/*
--------------
SCENARIO - new
---------------
*/

this.scenario_new_forceInitiallyEmpty_chance = 0.17;
//	0.17

this.scenario_new_radiation_chance = 0.082;
//	0.082
//	Gets increased in two of the galaxies.
//	&#39;Returns&#39; afterwards.
//	Thus, decreases chance of the scenarios that follows it.

this.scenario_new_asteroids_chance = 0.00;
//	0.09
//	Chance increased in one of the galaxies.
//	Asteroids are occasionally a long way from the player. 

this.scenario_new_asteroids_chanceMiners = 0.18;
//	0.18

this.scenario_new_derelict_chance = 0.15;
//	0.15
//	Any derlict can be fairly far from the player.

this.scenario_new_derelict_range = 24600;
//	24600
//	Derelicts get added within 4000 of this.

this.scenario_new_derelict_chanceIsLive = 0.15;
//	0.15

this.scenario_new_derelict_dead_chanceMultiple = 0.2;
//	0.2

this.scenario_new_pirates_baseChance = 0.01;
//	0.01
//	Chance is increased by: criminality of the relevant systems; rank.
//	Intra-interstellar jumps (*sic*) scale the chance back down.

this.scenario_new_pirates_baseNumber = 3;
//	3
//	This is only part of the equation for the number of pirates.

this.scenario_new_helpee_chance = 0.16;
//	0.16
//	Requires InterstellarHelp OXP.

this.scenario_new_aliens_chance = 0.09;
//	0.09
//	Get increased in galaxy 8 (/7).

this.scenario_new_lobster_chance = 0.06;
//	0.06. Increased in galaxy 4 (/3).

this.scenario_new_warships_chance = 0.45;
//	0.45
//	Get modified, in effect, by other things.
//	One such thing is the detection of the Thargoid Jammers OXP.

this.scenario_new_warships_baseNumber = 2;
//	2

this.scenario_new_sweeperChance = 0.1;
//	0.1
//	Requires ExtraThargoids OXP. Rank-inflected.
//	There is a chance that a pre-existing Thargoid will be a sweeper.

this.scenario_new_hunter_chance = 0.1;
//	0.1
//	Comes halfway down the chain. But can be added via miners, too.

this.scenario_new_thargGenship_chance = 0.02;
//	0.02
//	Inflected later by player rank.
//	Ultimate position in chain for new scenario.
//	Cf. this.scenario_modified_onlyBugs_thargGenship_chance.

/*
-------------
REPOPULATION
------------
*/

//	Default scenario
this.repopulate_chanceEver_default = 0.75;
//	0.75
this.repopulate_maxPossible_default = 100;
//	100
this.repopulate_chance_default = 0.8;
//	0.8

//	Modified scenario - Only navy
this.repopulate_chanceEver_onlyNavy = 0.3;
//	0.3
this.repopulate_maxPossible_onlyNavy = 60;
//	60
this.repopulate_chance_onlyNavy = 0.2;
//	0.2

//	Modified scenario - Only bugs
this.repopulate_chanceEver_onlyBugs = 0.5;
//	0.5
this.repopulate_maxPossible_onlyBugs = 40;
//	40
this.repopulate_chance_onlyBugs = 0.15;
//	0.15

//	New scenario
this.repopulate_chanceEver_newScenario = 0.6;
//	0.6
this.repopulate_maxPossible_newScenario = 70;
//	70
this.repopulate_chance_newScenario = 0.1;
//	0.1


/*
-------------------------------------------------
STELLAR (as Vs rest, which is interstellar) stuff
-------------------------------------------------
*/

this.stellar_misplace_chance = 0.025;
//	0.025
//	= chance of being misplaced within the target system.
//	Various things can increase this chance.

this.stellar_misplace_delay = 0.83;
//	0.83
//	Fires at this time after ShipExitedWitchspace.

this.stellar_misplace_nearSun_chance = 0.16;
//	0.16
//	Can kill immediately.

this.stellar_postRescueAmbush_chance = 0.11;
//	0.11
//	Gets inflected by rank.
//	Applies only to when rescued in interstellar space
//	(and only to &#39;arriving&#39; carriers).


/*
=======================================
5. D E B U G G I N G - Apply switches
=======================================
*/

if (this.debug_full) {
	this.debug = true;

	// NB: DO NOT CHANGE VALUES OF THE FOLLOWING LINES. Rather, comment out if do not want them.
	this.ignorePlayerRank = false;
	this.testWithMisjumps = true;
	// this.scenario_new_forceInitiallyEmpty_chance = 0;
	this.scenario_chanceMajorTweak = 1;
	// Does not foreclose scenario_default_chanceExtraSeperateClash; can be overridden by pseudorandom numbers. 
} else {
	// DEFAULT values are as in my comments.
	this.ignorePlayerRank = false;
	// false
	this.testWithMisjumps = false;
	// false
}

if (this.testWithMisjumps) {
	log(&quot;InterstellarTweaks&quot;, &quot;Testing with misjumps enabled.&quot;);
	this.scenario_chanceScriptInducedMisjump = 1;
}


/*
==================================
6. G L O B A L   V A R I A B L E S
==================================
*/

this.beforeExitIsRunning = false;

this.currentChanceOfSickness = this.sickness_baseChanceOfGetting;
//	Gets raised by jumps into interstellar space.

this.initialisedAtFirstLaunch = false;

this.isSick = false;

this.jumpIsGalactic = false;

this.launch_thargAmbush = false;
//	Can be set to &#39;true&#39; by some event(s) treated elsewhere in the script.

this.MASC_status = 0;

/*
The following two vectors do not get set here (so doing throws a runtime error - unless I did it wrongly).
Instead they get initialised when first used.
this.origin_ambush = new Vector3D(ps);
this.origin_newScenario = new Vector3D(ps);
*/
this.spoofStatus = 0;

this.willDie = false;


/*
=============================================================
7.	O V E R V I E W   O F   T H E   M A I N   R O U T I N E S
Ordered by event, in time order.
=============================================================

(1) this.shipWillLaunchFromStation [Oolite event handler]

On, only, the *first* run of this routine, my code does various things including making array of any OXP worldscripts that contain populator scripts and an array of any that contain repopulator scripts.

(2) this.playerWillEnterWitchspace [Oolite event handler]

If in INTERSTELLAR space, then decide the following, to be acted upon on later:
	Will we tweak the jump?
		If yes, will we do the &#39;new&#39; scenario (which involves removing all ships and moving to a new area of space) or the &#39;modified&#39; one (which involves staying where we are but fiddling). Each scenario has various versions.

(3) this.iinterstellarTweaks_repopulate_interstellar_custom [Setup via planetinfo.plist. Runs immediately before this.shipWillExitWitchspace.]

If doing tweak of the &#39;modified&#39; type - or indeed doing no tweak at all - then run all worldscipts and inbuilt populators that would normally run. Or rather do so under certain conditions . .
If doing tweak of the &#39;new type&#39;, run none of the above populators.
NB: My code does no population, strictly defined, i.e. does not use &#39;system.setPopulator&#39;. That is because it seems feasible (at least while few expansion packs use that method) only to remove various ships - and, after that, add ships - *later* on.

(4) this.shipWillExitWitchspace [Oolite event handler]

If in NORMAL space, then - sometimes - do various things . .
If in INTERSTELLAR space, start a timer (&#39;this.timer_interstellarPostWillExit&#39;) to run routine &#39;this.$willExit_interstellar_timed&#39;.
	(I have this on a timer because one thing that the routine does is to move the player and moving the player immediately crashes Oolite - or at least Oolite&lt;1.79.)

(5) this.$willExit_interstellar_timed [my timed routine]

If in INTERSTELLAR space, actually start to implement the various tweaks.
In case of all (major or major-ish) tweaks except extraNavy, this involves clearing (or parially clearing) space, moving the player - *temporarily* in all cases except for what the program call the &#39;new&#39; scenario - and populating it.

(6) this.shipExitedWitchspace [Oolite event handler]

If doing any modification except extraNavy, set a timer (this.timer_returnEtc) which will run a routine (this.postJump_timed) described below.
(Have this on timer in order to (1) have something closer to the final word on population, (2) keep player away from changes until they are finished.)

(7) this.postJump_timed [my timed routine]

Does any final removal of ships, and - except for when doing the newScenario, returns the player.

There is also

(8) this.interstellarTweaks_repopulate_interstellar_custom [Setup via planetinfo.plist. Runs every 20 seconds in interstellar space.]

This sometimes adds various ships directly, and sometimes runs both Oolite&#39;s inbuilt interstellar repopulator and OXP interstellar repopulators.
*/


/*
================================================
8.	Start of wrapper for JSHINT 
See also Jshint options above.
The following should be: &#39;function(){&#39; (sic)
================================================
*/
// prettier-ignore
(
function() {

&quot;use strict&quot;;


/*
============================================================
9.	OPTIMISATION ROUTINES
	See http://www.aegidian.org/bb/viewtopic.php?f=4&amp;t=18837
============================================================
*/

this._index_in_list = function(item, list) {
	var k = list.length;
	while (k--) {
		if (list[k] === item) return k;
	}
	return -1;
};

/* Thus e.g.

	if(targets.indexOf(ship))

becomes (even within this very script)

	var ws = worldScripts.IST_masterScript;
	if(ws._index_in_list(ship,targets)
	
*/


/*
=========================================================================================
8.	E V E N T   H A N D L E R S   (including startup and population routines)
	At present this section seques into most of the code&#39;s other routines.
 	NB: As per wise convention, all routines save inbuilt event handlers prefixed by &#39;$&#39;.
=========================================================================================
*/

this.startUp = function() {
	var haveExcludedOwnScript = false;
	var i = worldScriptNames.length;
	var OXPworldScripts = [];
	var scriptName;
	var ws;
	// 1st create array of all worldScripts
	while (i--) {
		if (!haveExcludedOwnScript &amp;&amp; worldScriptNames[i] == this.name) {
			haveExcludedOwnScript = true;
		} else {
			scriptName = worldScriptNames[i];
			ws = worldScripts.IST_masterScript;
			if (ws._index_in_list(&quot;oolite-&quot;, scriptName) !== 0) {
				OXPworldScripts.push(scriptName);
				// this.$debugMessage(&quot;ScriptName: &quot;+scriptName);
			}
		}
	}

	// Now define various variables according to whether various OXPS installed
	// (In the case of most but not all of those OXPs, we do so via the array of worldscripts just created).
	if (this.$isArrayed(&quot;aliens_world_script&quot;, OXPworldScripts)) {
		this.OXP_aliens = true;
	} else {
		this.OXP_aliens = false;
	}

	if (this.$isArrayed(&quot;behemoth&quot;, OXPworldScripts)) {
		this.OXP_behemoth = true;
	} else {
		this.OXP_behemoth = false;
	}

	if (this.$isArrayed(&quot;Breakable_WitchDrive&quot;, OXPworldScripts)) {
		this.breakableDrive = true;
	} else {
		this.breakableDrive = false;
	}

	if (this.$isArrayed(&quot;escapePodLocator.js&quot;, OXPworldScripts)) {
		worldScripts[&quot;escapePodLocator.js&quot;].ecl_interstellarSpaceRange = 15;
		worldScripts[&quot;escapePodLocator.js&quot;].ecl_normalSpaceRange = 20;
	}

	if (this.$isArrayed(&quot;extraThargoids_populator&quot;, OXPworldScripts)) {
		this.OXP_extraThargoids = true;
	} else {
		this.OXP_extraThargoids = false;
	}

	if (this.$isArrayed(&quot;ferdelance3_populator&quot;, OXPworldScripts)) {
		this.OXP_3G = true;
	} else {
		this.OXP_3G = false;
	}

	if (this.$isArrayed(&quot;Galactic Misjump&quot;, OXPworldScripts)) {
		this.OXP_misJump = true;
	} else {
		this.OXP_misJump = false;
	}

	if (this.$isArrayed(&quot;hiredGuns_system&quot;, OXPworldScripts)) {
		this.OXP_hiredGuns = true;
	} else {
		this.OXP_hiredGuns = false;
	}

	if (this.$isArrayed(&quot;military_fiasco&quot;, OXPworldScripts)) {
		this.OXP_fiasco = true;
	} else {
		this.OXP_fiasco = false;
	}

	if (this.$isArrayed(&quot;Missiles &amp; Bombs&quot;, OXPworldScripts)) {
		this.OXP_bombs = true;
	} else {
		this.OXP_bombs = false;
	}

	if (this.$isArrayed(&quot;Mauiby&#39;s Wormhole Drones&quot;, OXPworldScripts)) {
		this.OXP_wormDrones = true;
	} else {
		this.OXP_wormDrones = false;
	}

	if (this.$isArrayed(&quot;Fuel Collector&quot;, OXPworldScripts)) {
		this.hackFuelCollectorOnInitialiseAtFirstLaunch = true;
	} else {
		this.hackFuelCollectorOnInitialiseAtFirstLaunch = false;
	}

	if (this.$isArrayed(&quot;misjump_analyser&quot;, OXPworldScripts)) {
		this.OXP_misjumpAnalyzer = true;
		if (!this.testWithMisjumps) {
			this.scenario_chanceScriptInducedMisjump *= 0.2;
		}
	} else {
		this.OXP_misjumpAnalyzer = false;
	}

	if (this.$isArrayed(&quot;murphy-thargoid-drive.js&quot;, OXPworldScripts)) {
		this.OXP_TWD = true;
	} else {
		this.OXP_TWD = false;
	}

	if (EquipmentInfo.infoForKey(&quot;EQ_NEXUS_BUG_MISSILE&quot;)) {
		this.OXP_Nexus = true;
	} else {
		this.OXP_Nexus = false;
	}

	if (this.$isArrayed(&quot;TCAT_masterScript&quot;, OXPworldScripts)) {
		this.OXP_TCAT = true;
	} else {
		this.OXP_TCAT = false;
	}

	if (this.$isArrayed(&quot;Thargorn_Witchspace_Battle&quot;, OXPworldScripts)) {
		this.OXP_ThargoidThreat = true;
	} else {
		this.OXP_ThargoidThreat = false;
	}

	if (this.$isArrayed(&quot;Generation Ships&quot;, OXPworldScripts)) {
		this.OXP_GenShips = true;
	} else {
		this.OXP_GenShips = false;
	} // This works for all versions of this OXP.

	if (this.$isArrayed(&quot;stardestroyer&quot;, OXPworldScripts)) {
		this.OXP_StarDestroyer = true;
	} else {
		this.OXP_StarDestroyer = false;
	}

	// Now check for some OXPS that don&#39;t have worldscripts; do so via roles.
	if (this.$roleExists(&quot;interstellar_help_trader&quot;)) {
		this.OXP_InterstellarHelp = true;
	} else {
		this.OXP_InterstellarHelp = false;
	}

	if (this.$roleExists(&quot;asteroid-billboard&quot;)) {
		this.OXP_YAH = true;
	} else {
		this.OXP_YAH = false;
	}

	if (this.$roleExists(&quot;lobsterworshipper&quot;)) {
		this.OXP_Missionaries = true;
	} else {
		this.OXP_Missionaries = false;
	}

	if (this.$roleExists(&quot;secondWave_toughTharglet&quot;)) {
		this.OXP_SecondWave = true;
	} else {
		this.OXP_SecondWave = false;
	}

	if (this.$roleExists(&quot;spectre&quot;)) {
		this.OXP_Spectre = true;
		this.scenario_chanceMajorTweak += 0.05;
		this.scenario_chanceModifiedAsVsNew -= 0.05;
	} else {
		this.OXP_Spectre = false;
		this.scenario_default_chanceExtraSeperateClash += 0.05;
	}

	if (this.$roleExists(&quot;thargoid_carrier&quot;)) {
		this.OXP_ThargoidCarriers = true;
	} else {
		this.OXP_ThargoidCarriers = false;
	}

	// ADJUST SOME (further) PROBABILITIES
	if (!this.OXP_ThargoidCarriers &amp;&amp; !this.OXP_ThargoidThreat) {
		// If thargoid threat low-ish, increase threat in New. But if threat almost non-existent, then - cos that&#39;s way player wants it - reduce threat in New.
		if (!this.OXP_Spectre || !this.OXP_SecondWave) {
			this.scenario_new_warships_chance += 0.03;
			this.scenario_new_warships_baseNumber += 1;
		} else {
			this.scenario_new_warships_chance -= 0.05;
			if (this.scenario_new_warships_baseNumber &gt; 1) {
				this.scenario_new_warships_baseNumber -= 1;
			}
		}
		scenario_modified_wasBattle_chance -= 0.05;
	}

	var populatorScripts_interstellar = [];
	var repopulatorScripts_interstellar = [];

	i = OXPworldScripts.length;
	while (i--) {
		scriptName = OXPworldScripts[i];
		// this.$debugMessage(&quot;ScriptName: &quot;+scriptName);
		if (worldScripts[scriptName]) {
			if (worldScripts[scriptName].interstellarSpaceWillPopulate &amp;&amp; worldScripts[scriptName].interstellarSpaceWillPopulate !== undefined) {
				populatorScripts_interstellar.push(scriptName);
			}
			// repopulators
			if (worldScripts[scriptName].interstellarSpaceWillRepopulate &amp;&amp; worldScripts[scriptName].interstellarSpaceWillRepopulate !== undefined) {
				repopulatorScripts_interstellar.push(scriptName);
			}
		}
		// Now make the local arrays global.
		this.populatorScripts_interstellar = populatorScripts_interstellar.slice(0);
		this.repopulatorScripts_interstellar = repopulatorScripts_interstellar.slice(0);
	}

	/*

	// this.$debugMessage(&quot;Custom WS POPULATORS:&quot;);
	i = this.populatorScripts_interstellar.length;
	while (i--) {
		this.$debugMessage(&quot;-- &quot;+this.populatorScripts_interstellar[i]);
	}
	this.$debugMessage(&quot;Custom WS RE-POPULATORS:&quot;);
	i = this.repopulatorScripts_interstellar.length;
	while (i--) {
		this.$debugMessage(&quot;-- &quot;+this.repopulatorScripts_interstellar[i]);
	}

	*/

	// MISC
	if (this.debug_full) {
		this.$debugMessage(&quot;Full test mode.&quot;);
		if (this.doTestScenario) {
			this.$debugMessage(&quot;- Test scenario.&quot;);
		}
	} else {
		this.$debugMessage(&quot;Debugging.&quot;);
	}
};

this.$probabilities_adjustbyPlayerRank = function() {
	// NOTE: This runs AFTER the startUp routine
	/*
	harmless 		= 0,
	mostlyHarmless	= 8,
	poor			= 16,
	average			= 32,
	aboveAverage	= 64,
	competent		= 128,
	dangerous		= 512,
	deadly			= 2560,
	elite			= 6400,
	archangel		= 19200;
	*/

	// Note also that chance of bugs in New Scenario is slightly reduced in galaxy 1/0.

	var score = player.score; // an optimisation

	// BELOW DEADLY
	if (score &lt; 2560) {
		return;
	}

	// DEADLY
	if (score &lt; 6400) {
		this.scenario_modified_onlyBugs_multiplyBugsChance *= 1.1;
		this.scenario_new_sweeperChance *= 1.05;
		this.scenario_new_warships_chance *= 1.05;
		return; // NB: return
	}
	// ELITE
	if (score &lt; 19200) {
		this.scenario_new_warships_baseNumber += 1;
		this.scenario_new_pirates_baseNumber += 1;
		this.scenario_new_derelict_chance *= 1.1;
		this.scenario_modified_chanceNavyAsVBugs *= 0.96;
		this.scenario_new_pirates_baseChance *= 1.1;
		this.scenario_new_radiation_chance *= 1.2;
		this.sickness_chanceKills *= 1.12;
		this.scenario_new_sweeperChance *= 1.1;
		this.scenario_new_thargGenship_chance *= 1.35;
		this.scenario_new_warships_chance *= 1.1;
		return; // NB: return
	}
	// Otherwise ..
	// ARCHANGEL
	this.escapeSequence_baseBugsGetPodChance *= 1.05;
	this.scenario_modified_chanceNavyAsVBugs *= 0.94;
	this.scenario_modified_onlyBugs_addSweeperChance *= 1.2;
	this.scenario_modified_onlyBugs_thargGenship_chance *= 1.2;
	this.scenario_new_derelict_chance *= 1.1;
	this.scenario_new_hunter_chance *= 1.13;
	this.scenario_new_lobster_chance *= 1.1;
	this.scenario_new_pirates_baseChance *= 1.15;
	this.scenario_new_pirates_baseNumber += 1;
	this.scenario_new_radiation_chance *= 1.14;
	this.scenario_new_sweeperChance *= 1.17;
	this.scenario_new_thargGenship_chance *= 1.5;
	this.scenario_new_warships_baseNumber += 1;
	this.scenario_new_warships_chance *= 1.14;
	this.sickness_chanceKills *= 1.14;
	this.stellar_postRescueAmbush_chance *= 1.3;
};


/*
-----------------------
Launching, docking etc.
-----------------------
*/

this.shipWillLaunchFromStation = function() {
	if (!this.initialisedAtFirstLaunch) {
		// this.$debugMessage(&quot;Initialisation start&quot;);

		// INITIALISATION
		if (this.hackFuelCollectorOnInitialiseAtFirstLaunch) {
			this.$debugMessage(&quot;Hacking fuel collector ..&quot;);
			// REMOVE the role &quot;shuttle&quot; from the Fuel Collector&#39;s list.
			// For, it allows at least some shuttles to be hacked *while still flying*.
			if (this.$isArrayed(&quot;shuttle&quot;, worldScripts[&quot;Fuel Collector&quot;].legitDerelictRoles)) {
				worldScripts[&quot;Fuel Collector&quot;].legitDerelictRoles.splice(&quot;shuttle&quot;);
			}
			// ADD some roles to Fuel Collector&#39;s list of hackable entities.
			var legitDerelictRolesCopy = worldScripts[&quot;Fuel Collector&quot;].legitDerelictRoles.slice(0);
			// The above copies worldScripts[&quot;Fuel Collector&quot;].legitDerelictRoles to legitDerelictRolesCopy.
			var roles = new Array(
				&quot;assassin-heavy&quot;,
				&quot;assassin-light&quot;,
				&quot;assassin-medium&quot;,
				&quot;escort-heavy&quot;,
				&quot;escort-medium&quot;,
				&quot;hiredGuns_escortHigh&quot;,
				&quot;hiredGuns_escortLow&quot;,
				&quot;hiredGuns_escortMid&quot;,
				&quot;hunter-heavy&quot;,
				&quot;hunter-medium&quot;,
				&quot;IST_derelict&quot;,
				&quot;IST_derelictThargoid&quot;,
				&quot;IST_derelictViper&quot;,
				&quot;IST_liveDerelict&quot;,
				&quot;IST_mil&quot;,
				&quot;IST_miner&quot;,
				&quot;IST_pirate&quot;,
				&quot;pirate-aegis-raider&quot;,
				&quot;pirate-heavy-fighter&quot;,
				&quot;pirate-heavy-freighter&quot;,
				&quot;pirate-interceptor&quot;,
				&quot;pirate-light-fighter&quot;,
				&quot;pirate-light-freighter&quot;,
				&quot;pirate-medium-fighter&quot;,
				&quot;pirate-medium-freighter&quot;,
				&quot;trader-courier&quot;,
				&quot;trader-smuggler&quot;
			);
			var i = roles.length;
			while (i--) {
				if (!this.$isArrayed(roles[i], legitDerelictRolesCopy)) {
					worldScripts[&quot;Fuel Collector&quot;].legitDerelictRoles.push(roles[i]);
				}
			}
			log(this.description, &quot;FOR INFO: fuel-collector elligible roles are now: &quot; + worldScripts[&quot;Fuel Collector&quot;].legitDerelictRoles);
		}
		if (!this.ignorePlayerRank) {
			this.$probabilities_adjustbyPlayerRank();
		}
		this.initialisedAtFirstLaunch = true;
		// this.$debugMessage(&quot;Initialisation end&quot;);
	}

	// MISJUMP
	if ((!player.ship.scriptedMisjump) &amp;&amp; (Math.random() &lt;= this.scenario_chanceScriptInducedMisjump)) {
		player.ship.scriptedMisjump = true;
		var r = Math.random();
		if (r &lt;= 0.3) {
			player.ship.scriptedMisjumpRange = r + 0.2; // traditional misjump value is 0.5.
		}
		this.$debugMessage(&quot;Misjump scheduleded&quot;);
	}

	// SICKNESS
	if (!this.isSick) {
		return;
	}
	// Otherwise
	this.$messagePlayer(&quot;You still have WITCHSPACE SICKNESS. Dock at a main station! Do not jump!&quot;, 15);
	this.mySound_warning.play();
};


this.shipLaunchedFromStation = function(station) {
	// AMBUSH
	if (!this.launch_thargAmbush) {
		return;
	}
	// The following optimizes:: t = Math.ceil(Math.random()*60) +1;
	var t = ~~(1 + (Math.random() * 50));
	this.timer_thargAmbush = new Timer(this, this.$thargAmbush_timed, t);
	this.origin_ambush = player.ship.position;
	this.launch_thargAmbush = false;
};

this.shipWillDockWithStation = function(station) {
	if (station.name === &quot;Generation Ship (Hijacked)&quot;) {
		station.suppressArrivalReports = true;
	}
};

this.shipDockedWithStation = function(station) {
	if (!player.ship.docked) {
		return;
	}
	this.$timerDelete_all();
	this.currentChanceOfSickness = this.sickness_baseChanceOfGetting;
	if (player.ship.dockedStation.name === &quot;Generation Ship (Hijacked)&quot;) {
		this.showScreen = &quot;rejectPage&quot;;
		mission.runScreen({
				title: &quot;Generation Ship (Hijacked)&quot;,
				color: &quot;greenColor&quot;,
				message: &quot;You have docked at a highjacked generation ship.\n\nTen out of ten for style, but minus several million for good thinking, yeah?&quot;,
				model: &quot;thargoid&quot;,
				choicesKey: &quot;IST_genshipDocked&quot;
			},
			function(choice) {
				if (choice === &quot;1_RETURN&quot;) {
					if (Math.random() &lt; 0.3) {
						player.commsMessage(&quot;The thargoids got you!&quot;);
						player.ship.launch(); // have to have this before explode the ship
						if (!this.timer_die) {
							this.timer_die = new Timer(this, this.$die_timed, 1.7);
							return;
						}
					} else {
						player.ship.launch();
						station.reactToAIMessage(&quot;ATTACKED&quot;);
						var damaged = false;
						if (Math.random() &lt; 0.6) {
							var playerEquipmentList = player.ship.equipment;
							if (player.ship.equipment.length &gt; 0) {
								var l;
								if (Math.random() &lt; 0.6) {
									l = 1;
								} else {
									l = 1 + ~~(1 + (Math.random() * 5));
								}
								var i = l;
								var equipmentToDamage;
								while (i--) {
									equipmentToDamage = playerEquipmentList[~~(playerEquipmentList.length * Math.random())];
									if (player.ship.equipmentStatus(equipmentToDamage.equipmentKey) === &quot;EQUIPMENT_OK&quot;) {
										player.ship.setEquipmentStatus(equipmentToDamage.equipmentKey, &quot;EQUIPMENT_DAMAGED&quot;);
										damaged = true;
									}
								}
							}
						}
						if (Math.random() &lt; 0.5) {
							var r = 50 + ~~(1 + (Math.random() * 150));
							player.ship.energy = (player.ship.energy - r);
							damaged = true;
						}
						if (damaged === true) {
							this.mySound_hullBang.play();
						}
					}
				}
			}
		);
	} else {
		if (player.ship.dockedStation.isMainStation) {
			this.isSick = false;
		} else if (Math.random() &lt; 0.2) {
			this.isSick = false;
		}
	}
};


/*
----------
Escape pod
----------
*/

this.escapePodSequenceOver = function() {
	this.$TCAT_reset();
	if (!system.isInterstellarSpace || player.alertCondition === 0) {
		return;
	}
	// Latter condition = is docked already. NB: Apparently is no way of checking whether something else has already set the escape pod location. . So on we go!
	//
	/* FOR TESTING
	if (this.stellar_postRescueAmbush_chance &gt;= 1) {
		navalCarriers = system.addShips(&quot;leviathan&quot;,1,ps,60000);
		player.setEscapePodDestination(navalCarriers[0]);
		this.launch_thargAmbush = true;
		return;
	}
	*/
	var ps = player.ship; // for speed, but changes won&#39;t affect the original variable
	// See whether thargoids destroy pod.
	var bugs = system.filteredEntities(this, this.$isThargoid_normal, ps, 40000);
	if (bugs.length &gt; 0) {
		var actualChanceBugsGetPod = this.escapeSequence_baseBugsGetPodChance;
		var nonBugs = system.filteredEntities(this, this.$isThargoid_not, ps, 40000);
		// Any police?
		if (nonBugs.length &lt; 1) {
			actualChanceBugsGetPod += (bugs.length / 60);
		} else {
			var difference = bugs.length - nonBugs.length;
			actualChanceBugsGetPod *= (difference / 5);
		}
		if (actualChanceBugsGetPod &gt; 0.85) {
			actualChanceBugsGetPod = 0.85;
		}
		if (Math.random() &lt;= actualChanceBugsGetPod) {
			this.$timerDelete_die();
			player.setEscapePodDestination(null); // = you die.
			this.$messagePlayer(&quot;Thargoids destroyed your escape pod!&quot;, 15);
			return;
		}
	}
	// RESCUE
	var actualEscapeSequence_baseRescue_chance = this.escapeSequence_baseRescue_chance;
	if (this.timer_radiationStageOne_damage1 &amp;&amp; this.timer_radiationStageOne_damage1.isRunning) {
		actualEscapeSequence_baseRescue_chance *= 0.5;
	}
	this.$timerDelete_all_exceptDie();
	// TIMERS: can remove radiation timer now.
	if (player.bounty &gt; 39 + ~~(1 + (Math.random() * 11))) {
		player.setEscapePodDestination(null);
		return;
	}
	var navalCarriers;
	// Rescue - near
	navalCarriers = system.filteredEntities(this, this.$isNavy_carrier, ps, 30000);
	if (navalCarriers.length &gt; 0) {
		if (Math.random() &lt;= actualEscapeSequence_baseRescue_chance) {
			player.setEscapePodDestination(navalCarriers[0]);
			return;
		}
	}
	// Rescue - further away
	navalCarriers = system.filteredEntities(this, this.$isNavy_carrier, ps, 100000);
	if (navalCarriers.length &gt; 0) {
		if (Math.random() &lt;= (actualEscapeSequence_baseRescue_chance / 2)) {
			if (Math.random() &lt; 0.7) {
				player.bounty = 0;
			}
			player.setEscapePodDestination(navalCarriers[0]);
			return;
		}
	}
	// Arriving carriers
	if ((this.OXP_behemoth || this.OXP_fiasco) &amp;&amp; (Math.random() &lt;= (actualEscapeSequence_baseRescue_chance / 10))) {
		var carrierType;
		//carrierType: 1 = Behemoth; 2 = Leviathan
		if (this.OXP_behemoth &amp;&amp; this.OXP_fiasco) {
			carrierType = ~~(1 + Math.random());
		} else if (this.OXP_behemoth) {
			carrierType = 1;
		} else {
			carrierType = 2;
		}
		if (Math.random() &lt; 0.2) {
			player.bounty = 0;
		}
		if (carrierType == 1) {
			navalCarriers = system.addShips(&quot;behemoth&quot;, 1, ps, 60000);
		} else {
			navalCarriers = system.addShips(&quot;leviathan&quot;, 1, ps, 60000);
		}
		player.setEscapePodDestination(navalCarriers[0]);
		// Set a possibility of a later ambush.
		if (Math.random() &lt;= this.stellar_postRescueAmbush_chance) {
			this.launch_thargAmbush = true;
		}
	}
};

/*
----------
Jump stuff
----------
*/
this.playerStartedJumpCountdown = function(jump) {
	if (system.isInterstellarSpace) {
		this.isIntraInterstellar = true;
	} else {
		this.isIntraInterstellar = false;
	}
	if (this.OXP_TWD &amp;&amp; worldScripts[&quot;murphy-thargoid-drive.js&quot;].jumping) {
		return;
	}
	if (jump === &quot;galactic&quot; || (this.OXP_misJump &amp;&amp; worldScripts[&quot;Galactic Misjump&quot;].gmj_active === 1)) {
		this.jumpIsGalactic = true;
		return;
	}
	this.jumpIsGalactic = false;
	// Proceed only if a misjump scripted.
	if (!player.ship.scriptedMisjump) {
		return;
	}
	// If the Analzyer doing its thing, end here. Else allow Analyzer to identify the misjump.
	if (this.OXP_misjumpAnalyzer) {
		if (worldScripts.misjump_analyser.misjump) {
			return;
		}
		// Otherwise
		if (player.ship.equipmentStatus(&quot;EQ_MISJUMP_ANALYSER&quot;) === &quot;EQUIPMENT_OK&quot;) {
			var chance;
			if (system.isInterstellarSpace) {
				chance = 0.8;
			} else {
				chance = 0.9;
			}
			var r = Math.random();
			if (r &gt; chance) {
				return;
			}
			if (r &lt; 0.5) {
				this.timer_misjumpWarning = new Timer(this, this.$misjumpWarning_timed, 5);
				return;
			}
			this.timer_misjumpWarning = new Timer(this, this.$misjumpWarning_timed, 6);
		}
	}
};

this.playerCancelledJumpCountdown = function() {
	this.jumpIsGalactic = false; // I think that do not _really_ need this.
	if (this.timer_misjumpWarning) {
		if (this.timer_misjumpWarning.isRunning) {
			this.timer_misjumpWarning.stop();
		}
		delete this.timer_misjumpWarning;
	}
};

this.$misjumpWarning_timed = function $misjumpWarning_timed() {
	var ps = player.ship; // for speed, but changes won&#39;t affect the original variable
	var oldLocation = ps.galaxyCoordinates;
	var newLocation = ps.cursorCoordinates;
	var dx = newLocation.x - oldLocation.x;
	var dy = (newLocation.y - oldLocation.y) / 2;
	this.distance = ~~(0.5 + Math.sqrt(dx * dx + dy * dy) * 2) / 10; // half of jump distance.
	// = this.distance = Math.round(Math.sqrt(dx*dx+dy*dy)*2)/10; // half of jump distance.
	this.mySound_warning.play();
	player.commsMessage(&quot;Warning: witchspace disturbance detected at &quot; + this.distance + &quot; LY ahead!&quot;);
	delete this.timer_misjumpWarning;
};


/*
---------------------
WILL ENTER witchspace
---------------------
*/

// The shipWillEnterWitchspace handler is called immediately before a witchspace jump, while the player is still in the starting system.

this.playerWillEnterWitchspace = function() {
	/* 	This routine:
			- sets &#39;this.scenario&#39; to a value representing some scenario;
			- sets repopulation variables accordingly;
			- does various other vital stuff.
	*/

	// this.$debugMessage(&quot;STAGE *1* - PlayerWillEnterWitchspace&quot;);

	// RESETS
	// this.$timerDelete_interstellarPostWillExit(); // should be removed already
	// this.$timerDelete_returnEtc(); // should be removed already
	// this.$timerDelete_resched(); // should be removed already

	/*
	----------
	ESSENTIALS
	----------
	*/
	this.$timerDelete_radiation();
	this.$TCAT_reset();
	this.$threatOXP_reset();
	this.scenario = &quot;default&quot;;
	this.repopulations_repopulationIteration = 0;
	this.willDie = false;
	if (this.jumpIsGalactic || (this.OXP_TWD &amp;&amp; worldScripts[&quot;murphy-thargoid-drive.js&quot;].jumping)) {
		return;
	}

	/*
	--------------------------------
	DETERMINE TWEAKS - preliminaries
	--------------------------------
	*/

	// Set &#39;systemAreLeavingGovLevel&#39;
	if (system.isInterstellarSpace) {
		if (this.systemAreLeavingGovLevel &lt; 10) {
			this.systemAreLeavingGovLevel += 2;
		}
		// if jumping intrainterstellar, this.systemAreLeavingGovLevel will be set already, and make things progressively safer from pirates - up to a point.
	} else {
		this.systemAreLeavingGovLevel = system.government;
	}

	/*
	-----------------------------------
	DETERMINE TWEAKS - the thing itself
	-----------------------------------
	*/

	var r;
	if (Math.random() &lt; 0.45) {
		r = system.scrambledPseudoRandomNumber(700000);
	} else {
		r = Math.random();
	}
	if (r &gt; this.scenario_chanceMajorTweak) {
		this.$setScenario(&quot;default&quot;);
		return;
	}
	// Otherwise ..
	// Yes, major tweak. So, choose the major tweak.
	if (Math.random() &gt; this.scenario_chanceModifiedAsVsNew) {
		// Set NEW SCENARIO
		this.$setScenario(&quot;newScenario&quot;);
		return;
	}
	if (Math.random() &gt; this.scenario_modified_chanceNavyAsVBugs) {
		// Set ONLY BUGS
		this.$setScenario(&quot;onlyBugs&quot;);
		return;
	}
	if (Math.random() &lt;= this.scenario_modified_chanceOnlyNavyNotExtraNavy) {
		// Set ONLY NAVY
		this.$setScenario(&quot;onlyNavy&quot;);
		return;
	}
	// Set EXTRA NAVY
	this.$setScenario(&quot;extraNavy&quot;);
};

this.$setScenario = function(scenario) {
	this.repopulation_maximum = 0;
	switch (scenario) {
		case &quot;default&quot;:
			if (Math.random() &gt; this.repopulate_chanceEver_default) {
				// The following is equivalent to:
				// this.repopulation_maximum = Math.ceil(Math.random() * this.repopulate_maxPossible_default);
				this.repopulation_maximum = ~~(1 + (Math.random() * this.repopulate_maxPossible_default));
				this.repopulate_chance = this.repopulate_chance_default;
			}
			break;

		case &quot;newScenario&quot;:
			this.$OXP_Threat_restrict(); // Override: Threat
			this.$OXP_TCAT_override(); // Override: TCAT
			if (Math.random() &lt;= this.repopulate_chanceEver_newScenario) {
				// The following is equivalent to:
				// this.repopulation_maximum = Math.ceil(Math.random() * this.repopulate_maxPossible_newScenario);
				this.repopulation_maximum = ~~(1 + (Math.random() * this.repopulate_maxPossible_newScenario));
				this.repopulate_chance = this.repopulate_chance_newScenario;
			}
			break;

		case &quot;onlyBugs&quot;:
			this.$OXP_Threat_restrict();
			this.$OXP_TCAT_override(); // TCAT
			if (Math.random() &gt; this.repopulate_chanceEver_onlyBugs) {
				// The following is equivalent to:
				// this.repopulation_maximum = Math.ceil(Math.random() * this.repopulate_maxPossible_onlyBugs);
				this.repopulation_maximum = ~~(1 + (Math.random() * this.repopulate_maxPossible_onlyBugs));
				this.repopulate_chance = this.repopulate_chance_onlyBugs;
			}
			break;

		case &quot;onlyNavy&quot;:
			this.$OXP_Threat_restrict();
			if (Math.random() &gt; 0.1) {
				this.$OXP_TCAT_override(); // TCAT (which will cause ships to appear to witch-in)
			}
			if (Math.random() &gt; this.repopulate_chanceEver_onlyNavy) {
				// The following is equivalent to:
				// this.repopulation_maximum = Math.ceil(Math.random() * this.repopulate_maxPossible_onlyNavy);
				this.repopulation_maximum = ~~(1 + (Math.random() * this.repopulate_maxPossible_onlyNavy));
				this.repopulate_chance = this.repopulate_chance_onlyNavy;
			}
			// By design there is no case for &#39;extraNavy&#39;.
	}
	this.scenario = scenario;
};


/*
--------------------------------
POPULATION &amp; REPOPULATION ROUTINES
--------------------------------
*/

// POPULATION

// The name of this function must match the name given in the file planetinfo.plist.
this.interstellarTweaks_populate_interstellar_custom = function() {
	// Called immediately before the shipWillExitWitchspace event fires.
	// this.$debugMessage(&quot;interstellarTweaks_repopulate_interstellar_custom:&quot;);
	if (this.scenario != &quot;default&quot; &amp;&amp; this.scenario != &quot;onlyBugs&quot;) {
		return;
		// We run no populator for other scenarios, and one and the same populator for those two scenarios.
	}
	// Run the inbuilt populator
	worldScripts[&quot;oolite-populator&quot;].interstellarSpaceWillPopulate();
	// Run OXP populators
	var i = this.populatorScripts_interstellar.length;
	// this.$debugMessage(&quot;Populators - inbuilt and OXP:&quot;); 
	while (i--) {
		if (!worldScripts[this.populatorScripts_interstellar[i]]) {
			this.$debugMessage(&quot;UNDEFINED POPULATOR!&quot;);
		} else {
			// this.$debugMessage(&quot;Populating :&quot; +worldScripts[this.populatorScripts_interstellar[i]]);
			// We can get errors here, reported in the log against my script, which seemingly owe to *other* OXPs.
			try {
				worldScripts[this.populatorScripts_interstellar[i]].interstellarSpaceWillPopulate();
			} catch (err) {
				this.$error(&quot;Problem with populator &lt;&quot; + worldScripts[this.populatorScripts_interstellar[i]] + &quot;&gt; : &quot; + err.message);
			}
		}
	}
	// this.$debugMessage(&quot;Leaving function interstellarTweaks_repopulate_interstellar_custom&quot;);
};

// RE-REPOPULATION

// The name of this function must match the name given in the file planetinfo.plist.
this.interstellarTweaks_repopulate_interstellar_custom = function() {
	if (!player.ship.isValid || !player.ship.position) {
		return;
	}
	// Sanity check. For, do use player.ship.position in repopulation routines.
	if (this.repopulation_maximum == null) {
		this.$error(&quot;repopulation_maximum not set!&quot;);
		this.repopulation_maximum = 1;
		return;
	}
	if (this.repopulations_repopulationIteration === this.repopulation_maximum) {
		this.$debugMessage(&quot;Max repops reached&quot;);
		return;
	}
	// Otherwise ..
	this.repopulations_repopulationIteration++;
	// this.$debugMessage(&quot;Running repopulator for &quot;+this.scenario);
	// this.$debugMessage(&quot;Repop &quot;+ this.repopulations_repopulationIteration +&quot; of &quot;+this.repopulation_maximum);
	if (this.repopulations_repopulationIteration === 1) {
		if (Math.random() &lt; 0.8) {
			return;
		}
		// The first repopulation arrives rather quickly, so let us tend to skip it.
	}
	// Otherwise ..
	if (Math.random() &lt; this.repopulate_chance) {
		this.$repopulate_interstellar(this.scenario);
	}
};

this.$repopulate_interstellar = function(tweak) {
	switch (tweak) {
		case &quot;newScenario&quot;:
			this.$repopulate_interstellar_newScenario();
			break;
		default:
			this.$repopulate_interstellar_modifiedOrScenario_default();
	}
};

this.$repopulate_interstellar_modifiedOrScenario_default = function() {
	if (system.countShipsWithPrimaryRole(&quot;IST_thargoid&quot;) &lt; 4) {
		// have the above check &#39;cos inbuilt populator checks only for primary role &#39;thargoid&#39; . .
		// Run the INBUILT populator
		worldScripts[&quot;oolite-populator&quot;].interstellarSpaceWillRepopulate();
		// this.$debugMessage(&quot;Re-populating: inbuilt&quot;);
	}
	// Run OXP repopulators
	var i = this.repopulatorScripts_interstellar.length;
	// this.$debugMessage(&quot;# repopulators: &quot;+i);
	while (i--) {
		// this.$debugMessage(&quot;Re-populating: &quot;+worldScripts[this.repopulatorScripts_interstellar[i]]);
		worldScripts[this.repopulatorScripts_interstellar[i]].interstellarSpaceWillRepopulate();
	}
};

this.$repopulate_interstellar_newScenario = function() {
	// Need my own repopulator because inbuilt and OXP repopulators will put ships in the wrong place.
	// Should use the &#39;rings&#39; functions here.

	// RADIATION?
	if (this.timer_radiationStageOne_damage1 &amp;&amp; this.timer_radiationStageOne_damage1.isRunning) {
		return;
	}
	// this.$debugMessage(&quot;Re-populating: new&quot;);

	var n;
	var s;
	var threshold;
	var ps = player.ship; // for speed, but changes won&#39;t affect the original variable
	var origin = this.origin_newScenario;
	// THARGOIDS &amp; GALCOP
	var r = Math.random();
	if (ps.equipmentStatus(&quot;EQ_ELECTRONIC_THUMB&quot;) === &quot;EQUIPMENT_OK&quot;) {
		n = system.countShipsWithPrimaryRole(&quot;interstellar_helper&quot;);
		if (n.length &gt; 0) {
			r *= 1.15;
		} // Make adding Thargoids more likely.
	}
	if (r &gt; 0.45) {
		// Add thargoids, if a check to do with extant thargoids is passed (or on small random chance).
		s = system.filteredEntities(this, this.$isBug, ps, 50000);
		// The following is equivalent to
		threshold = ~~(1 + (Math.random() * 19));
		if ((s.length &lt;= threshold) || (Math.random() &lt; 0.05)) {
			if (r &lt; 0.9) {
				n = 1 + ~~(1 + (Math.random() * 2));
			} else {
				n = ~~(1 + (Math.random() * 7));
			}
			if (r &lt; 0.65) {
				var position = new Vector3D(ps);
				var x = Math.random() * 2000;
				var y = Math.random() * 2000;
				var z = Math.random() * 2000;
				position = position.add([x, y, z]);
				s = this.$addShips_rings(&quot;thargoid&quot;, n, position, 25600);
			} else {
				s = this.$addShips_rings(&quot;thargoid&quot;, n, origin, 25600);
			}
		}
	} else {
		// Add Military - if number of extant military is below a threshold (or on a small random chance).
		n = system.countShipsWithPrimaryRole(&quot;IST_mil&quot;, ps, 50000);
		n += system.countShipsWithPrimaryRole(&quot;police&quot;, ps, 50000);
		n += system.countShipsWithPrimaryRole(&quot;ferdelance3G_interstellar&quot;, ps, 50000);
		// The following is equivalent to:
		// threshold = 1+Math.ceil(Math.random()*8);
		threshold = 1 + ~~(1 + (Math.random() * 8));
		if ((n &gt; threshold) &amp;&amp; (Math.random() &gt; 0.05)) {
			return;
		}
		// Otherwise ..
		if (this.OXP_3G) {
			if (Math.random() &lt; 0.06) {
				// n = 2 + Math.ceil( Math.random()*6 );
				n = 1 + ~~(1 + (Math.random() * 7));
				s = this.$addShips_rings(&quot;ferdelance3G_interstellar&quot;, n, origin, 950);
				return;
			}
		}
		// Otherwise ..
		// The following is equivalent to:
		// n = 3+Math.ceil(Math.random()*6);
		n = 3 + ~~(1 + (Math.random() * 6));
		s = this.$addShips_rings(&quot;IST_mil&quot;, n, origin, 2000);
	}
};



/*
------------------------------------------------------------------------
WILL EXIT witchspace
When this event handler fires, the player is (from a program perspective)
in the destination system (which can be interstellar space),
but the tunnel effect has not yet been shown.
-------------------------------------------------------------------------
*/

this.shipWillExitWitchspace = function() {
	// this.$debugMessage(&quot;willExit_witchspace&quot;); 
	/* FOR TESTING:
	var lobsters = system.addShips(&quot;IST_lobsterUber&quot;,1,[0,0,0],8000);
	*/
	if (this.jumpIsGalactic || (this.OXP_TWD &amp;&amp; worldScripts[&quot;murphy-thargoid-drive.js&quot;].jumping)) {
		return;
	}
	if (!system.isInterstellarSpace) {
		// STELLAR
		this.beforeExitIsRunning = false;
		this.$willExit_stellar();
		return;
	}
	// Otherwise ..
	// INTERSTELLAR
	this.beforeExitIsRunning = true;
	this.timer_interstellarPostWillExit = new Timer(this, this.$willExit_interstellar_timed, this.scenario_interstellarPostWillExitTimed);
	// this.$debugMessage(&quot;STAGE *2* - willExit_witchspace finished OK&quot;);
};

// Consider misplacing the player.
this.$willExit_stellar = function() {
	if (!player.ship) {
		return;
	}
	var realMisplaceChance = this.stellar_misplace_chance;
	if (player.ship.energy &lt; 60) {
		realMisplaceChance += 0.02;
	}
	if (this.breakableDrive) {
		if (player.ship.equipmentStatus(&quot;EQ_BREAKABLE_WITCHDRIVE&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) {
			realMisplaceChance += 0.15;
		}
	}
	if (Math.random() &lt;= realMisplaceChance) {
		this.$timerDelete_stellar();
		this.timer_stellar = new Timer(this, this.$stellar_misplace_timed, this.stellar_misplace_delay);
		// _Sic_ (this.stellar_misplace_delay).
	}
};

this.$stellar_misplace_timed = function $stellar_misplace_timed() {
	var x, y, z;
	this.$messagePlayer(&quot;Drive malfunction - missed witchpoint!&quot;, 10);
	if (Math.random() &lt;= this.stellar_misplace_nearSun_chance &amp;&amp; !system.sun.hasGoneNova) {
		this.$messagePlayer(&quot;ALERT - Approaching the sun. Temperature monitoring is critical!&quot;, 10);
		x = (Math.random() * 200000) - 50000;
		y = (Math.random() * 200000) - 50000;
		z = (Math.random() * 200000) - 50000;
		player.ship.position = system.sun.position.subtract([x, y, z]);
	} else {
		x = (Math.random() * 4000000) + 50000;
		y = (Math.random() * 4000000) + 50000;
		z = (Math.random() * 4000000);
		player.ship.position = player.ship.position.add([x, y, z]);
	}
	this.mySound_warning.play();
};

this.$willExit_interstellar_timed = function $willExit_interstellar_timed() {
	// this.$debugMessage(&quot;STAGE *3* - willExit_interstellar_timed&quot;);
	if (!system.isInterstellarSpace) {
		this.beforeExitIsRunning = false;
		return;
	}
	switch (this.scenario) {
		case &quot;newScenario&quot;:
			this.$willExit_newScenario();
			break;
		case &quot;onlyBugs&quot;:
			this.$willExit_bugsOnly();
			break;
		case &quot;onlyNavy&quot;:
			this.$willExit_navyOnly();
			break;
		case &quot;extraNavy&quot;:
			this.$willExit_extraNavy();
			break;
		default:
			this.$willExit_interstellar_timed_default();
	}
	if (this.OXP_GenShips) {
		this.$willExit_interstellar_timed_considerRemovingAnyGenShips();
	}
	this.beforeExitIsRunning = false;
	// This is a VITAL RESET, but performed above if this routine doesn&#39;t even reach &#39;switch (this.scenario)&#39;.
	// this.$debugMessage(&quot;willExit_interstellar_timed finished OK&quot;);
};

this.$willExit_interstellar_timed_default = function() {
	var n, s;

	if (this.OXP_ThargoidThreat &amp;&amp; Math.random() &lt;= this.scenario_modified_limitBattleships_chance) {
		s = system.filteredEntities(this, this.$isThargoid_battleship);
		if (s.length &gt; this.scenario_modified_limitBattleships_maxShips) {
			var numToRemove = s.length - this.scenario_modified_limitBattleships_maxShips;
			while (numToRemove--) {
				s[numToRemove].remove(true); // s[numToRemove] - *sic*.
			}
		}
	}

	var g, r;
	g = system.info.galaxyID; // Make local for speed.
	switch (g) {
		case 3:
			this.scenario_modified_onlyBugs_rebelChance *= 3;
			break;
		case 5:
			r = this.scenario_default_chanceAsteroids * 1.25;
			break;
		default:
			r = this.scenario_default_chanceAsteroids; // for asteroids.
	}

	// Asteroids
	if (Math.random() &lt;= r) {
		n = 5 + ~~(1 + (Math.random() * 15));
		s = system.addShips(&quot;IST_asteroid&quot;, n, [0, 0, 0], 38000);
		n = ~~(1 + n);
		s = system.addShips(&quot;IST_asteroid&quot;, n, [0, 0, 0], 50000);
	}

	// Separate clash
	if (Math.random() &lt;= this.scenario_default_chanceExtraSeperateClash) {
		// this.$debugMessage(&quot;Extra seperate.&quot;); if (this.debug) {log(&quot;InterstellarTweaks&quot;, &quot;EXTRA OK.&quot;);}
		var x = (Math.random() - 0.5) * 40000;
		var y = (Math.random() - 0.5) * 40000;
		var z = (Math.random() - 0.5) * 40000;
		n = ~~(1 + (Math.random() * 15));
		s = this.$addShips_ringless(&quot;thargoid&quot;, n, [x, y, z], 25000);
		n = ~~(1 + (Math.random() * 15));
		s = this.$addShips_ringless(&quot;IST_mil&quot;, n, [x, y, z], 24000);
	}
};

this.$willExit_interstellar_timed_considerRemovingAnyGenShips = function() {
	var s = system.shipsWithRole(&quot;generationship&quot;);
	var i = s.length;
	if (i &gt; 0 &amp;&amp; (Math.random() &lt;= this.scenario_genShipsRemovalChance)) {
		while (i--) {
			s[i].remove(true);
		}
	}
};

this.$remove_allFromNew = function() {
	// Well, *nearly* all . . Also: will in fact work in scenarios other than &#39;new&#39;.
	// this.$debugMessage(&quot;Removing from new.&quot;);
	// NB: we do need the isShip, because otherwise hasRole does not work.
	var s = system.filteredEntities(this, this.$toRemove_newScenario);
	var i = s.length;
	while (i--) {
		s[i].remove(true);
	}
};

this.$scenario_new_populate = function() {
	// NB: vectors are defined when used, and must always be with a new Vector3D

	// this.$debugMessage(&quot;Populating new.&quot;);
	// this.$debugMessage(&quot;this.origin_newScenario is: &quot;+this.origin_newScenario); 

	var actualChance;
	var galNumber = system.info.galaxyID;

	// FORCE EMPTY
	if ((galNumber === 0) || (galNumber === 7)) {
		actualChance = this.scenario_new_forceInitiallyEmpty_chance * 1.12;
	} else {
		actualChance = this.scenario_new_forceInitiallyEmpty_chance;
	}
	var r;
	if (Math.random() &lt; 0.7) {
		r = system.scrambledPseudoRandomNumber(700001);
	} else {
		r = Math.random();
	}
	if (r &lt;= actualChance) {
		// this.$debugMessage(&quot;Empty&quot;);
		this.$OXP_TCAT_override();
		return; // i.e. end here, without populating the system.
	}

	// RADIATION
	if ((galNumber === 4) || (galNumber === 7)) {
		actualChance = this.scenario_new_radiation_chance * 1.3;
	} else {
		actualChance = this.scenario_new_radiation_chance;
	}
	if (Math.random() &lt; 0.6) {
		r = system.scrambledPseudoRandomNumber(700002);
	} else {
		r = Math.random();
	}
	if (r &lt;= actualChance) {
		this.$scenario_new_radiation();
		return; // NB
	}

	// ASTEROIDS
	if (galNumber === 5) {
		actualChance = this.scenario_new_asteroids_chance * 1.23;
	} else {
		actualChance = this.scenario_new_asteroids_chance;
	}
	if (Math.random() &gt; 0.7) {
		r = system.scrambledPseudoRandomNumber(700004);
	} else {
		r = Math.random();
	}
	if (r &lt;= actualChance) {
		this.$scenario_new_asteroids();
		if (Math.random() &lt; 0.9) {
			return;
		}
	}

	// DERELICT
	if (Math.random() &lt;= this.scenario_new_derelict_chance) {
		this.$scenario_new_derelict();
		if (Math.random() &lt; 0.7) {
			return;
		}
	}

	// PIRATES
	var planetID = player.ship.targetSystem;
	var targetSystemGovLevel = System.infoForSystem(galNumber, planetID).government;
	actualChance = this.scenario_new_pirates_baseChance + (1 - ((this.systemAreLeavingGovLevel + targetSystemGovLevel) / 14)) * 0.4;
	if (Math.random() &gt; 0.2) {
		r = Math.random();
	} else {
		r = system.scrambledPseudoRandomNumber(700005);
	}
	if (r &lt;= actualChance) {
		this.$scenario_new_pirates();
		// Make it likely that (1) is nothing else later, (2) is nothing else now.
		this.repopulate_chance *= 0.6;
		if (Math.random() &lt; 0.7) {
			return;
		}
	}

	// INTERSTELLAR HELP OXP&#39;s HELPEE
	if (this.OXP_InterstellarHelp) {
		if (Math.random() &lt;= this.scenario_new_helpee_chance) {
			this.$scenario_new_helpee();
			return;
		}
	}

	// ALIENS
	if (this.OXP_aliens) {
		if (galNumber === 7) {
			this.scenario_new_aliens_chance *= 1.5;
		}
		if (Math.random() &lt; 0.5) {
			r = Math.random();
		} else {
			r = system.scrambledPseudoRandomNumber(700006);
		}
		if (r &lt;= this.scenario_new_aliens_chance) {
			this.$scenario_new_aliens();
			if (Math.random() &lt; 0.9) {
				return;
			}
		}
	}

	// LOBSTERS
	if (this.OXP_Missionaries) {
		if (galNumber === 3) {
			actualChance = this.scenario_new_lobster_chance * 1.6;
		} else {
			actualChance = this.scenario_new_lobster_chance;
		}
		if (Math.random() &lt; 0.4) {
			r = Math.random();
		} else {
			r = system.scrambledPseudoRandomNumber(700007);
		}
		if (r &lt;= actualChance) {
			this.$scenario_new_lobsters(galNumber);
			// Make it likely that (1) is nothing else now, (2) is nothing else later.
			if (Math.random() &lt; 0.8) {
				this.repopulate_chance *= 0.25;
				return;
			}
		}
	}

	// HUNTERS
	if (Math.random() &lt;= this.scenario_new_hunter_chance) {
		this.$scenario_new_hunters();
	}

	// THARGOIDS
	if (galNumber === 0) {
		actualChance = this.scenario_new_warships_chance * 0.9;
	} else {
		actualChance = this.scenario_new_warships_chance;
	}
	if (Math.random() &lt; 0.4) {
		r = Math.random();
	} else {
		r = system.scrambledPseudoRandomNumber(700008);
	}
	if (r &lt;= actualChance) {
		this.$scenario_new_thargoids();
	}

	// GENSHIPS
	if (this.OXP_GenShips &amp;&amp; Math.random() &lt;= this.scenario_new_thargGenship_chance) {
		this.$scenario_new_genship();
	}
	// NB: Sometimes - depending on how the numbers come out - this function will add no ships.
};

this.$scenario_new_radiation = function() {
	// this.$debugMessage(&quot;Radiation&quot;);
	this.$OXP_TCAT_override();
	// this.$OXP_Threat_restrict(); // done already
	this.mySound_warning.play();
	// remove anything that would not have survived.
	var s = system.allShips;
	if (s.length &gt; 1) {
		if (this.OXP_hiredGuns) {
			s = system.filteredEntities(this, this.$toRemove_radiationScenario_alt);
		} else {
			s = system.filteredEntities(this, this.$toRemove_radiationScenario);
		}
		var i = s.length;
		while (i--) {
			s[i].remove(true);
		}
	}
	// Now do the actual radiation - which can be high or very high.
	var r;
	if (Math.random() &lt; 0.7) {
		r = system.scrambledPseudoRandomNumber(700003);
	} else {
		r = Math.random();
	}
	if (r &lt; 0.25) {
		if (r &lt; 0.2) {
			system.sendAllShipsAway();
		}
		this.$messagePlayer(&quot;WARNING - very high levels of space radiation! ADVICE: leave area immediately!&quot;, 15);
		this.timer_radiationStageOne_damage1 = new Timer(this, this.$radiationDamageToPlayer_andPerhapsSendOtherShipsAway, 0.3, 0.3);
		if (Math.random() &lt; 0.8) {
			this.timer_radiationStageOne_damage2 = new Timer(this, this.$radiationDamageToNPCs, 3.16, 3.16);
		} else {
			this.timer_radiationStageOne_damage2 = new Timer(this, this.$radiationDamageToNPCsWithSickness, 3.16, 3.16);
		}
	} else {
		if (r &lt; 0.95) {
			system.sendAllShipsAway();
		}
		this.$messagePlayer(&quot;WARNING - high levels of space radiation! ADVICE: leave area quickly!&quot;, 15);
		this.timer_radiationStageOne_damage1 = new Timer(this, this.$radiationDamageToPlayer_andPerhapsSendOtherShipsAway, 0.4, 0.4);
		if (Math.random() &lt; 0.8) {
			this.timer_radiationStageOne_damage2 = new Timer(this, this.$radiationDamageToNPCs, 4, 4);
		} else {
			this.timer_radiationStageOne_damage2 = new Timer(this, this.$radiationDamageToNPCsWithSickness, 4, 4);
		}
	}
	this.timer_radiationStageTwo = new Timer(this, this.$radiationStageTwo, 3);
	// The &#39;stage two&#39; timer does another system.sendAllShipsAway(), and then, sometimes, populates.
};

this.$radiationDamageToPlayer_andPerhapsSendOtherShipsAway = function $radiationDamageToPlayer_andPerhapsSendOtherShipsAway() {
	if (!system.isInterstellarSpace) {
		this.$timerDelete_radiation();
		return;
	}
	if (Math.random() &lt; 0.15) {
		system.sendAllShipsAway();
	}
	if (!player.ship) {
		this.$timerDelete_radiation();
		return;
	}
	if (player.ship.equipmentStatus(&quot;EQ_HEAT_SHIELD&quot;) === &quot;EQUIPMENT_OK&quot;) {
		player.ship.energy -= 3.5;
	} else {
		player.ship.energy -= 4.5;
	}
};

this.$radiationDamageToNPCs = function $radiationDamageToNPCs() {
	if (!system.isInterstellarSpace) {
		this.$timerDelete_radiation();
		return;
	}
	if (!player.ship) {
		this.$timerDelete_radiation();
		return;
	}
	var s = system.filteredEntities(this, this.$NPCsToIrradiate);
	var i = s.length;
	var damage;
	// Since we may have done a sendAllShipsAway, let&#39;s check that ships still exist before we do anything to them.
	while (i--) {
		if (!s[i] || !s[i].isValid) {
			continue;
		}
		if (s[i].isThargoid) {
			damage = 23;
		} else {
			if (s[i].heat_insulation &gt; 1) {
				damage = 35;
			} else {
				damage = 45;
			}
		}
		if (s[i].energy &lt;= damage) {
			s[i].explode();
		} else {
			s[i].energy -= damage;
		}
	}
};

this.$radiationDamageToNPCsWithSickness = function $radiationDamageToNPCsWithSickness() {
	this.$radiationDamageToNPCs();
	if (this.isSick) {
		return;
	}
	// Otherwise ..
	var r = Math.random();
	// The following condition works out as approximately every 2.5 minutes.
	if (r &lt; 0.02) {
		if (r &lt; 0.005) {
			this.isSick = true;
			this.$messagePlayer(&quot;You have developed WITCHSPACE SICKNESS.&quot;, 15);
			this.mySound_warning.play();
		} else {
			if (this.currentChanceOfSickness &lt; 0.6) {
				this.currentChanceOfSickness += 0.04;
			}
		}
	}
};

this.$radiationStageTwo = function $radiationStageTwo() // ensure delete this, and radiation timers
{
	if (this.timer_radiationStageTwo) {
		if (this.timer_radiationStageTwo.isRunning) {
			this.timer_radiationStageTwo.stop();
		}
		delete this.timer_radiationStageTwo;
	}
	system.sendAllShipsAway();
	if (Math.random() &gt; (this.scenario_new_derelict_chance / 2)) {
		return;
	}
	// this.$debugMessage(&quot;Derelict&quot;);
	this.$scenario_new_derelict_deadOneOrOnes();
};

this.$scenario_new_asteroids = function() {
	// this.$debugMessage(&quot;Asteroids&quot;);
	// IST_asteroids are like_shipped from Oolite&#39;s inbuilt one, and so shouldn&#39;t be computationally demanding.
	var i, n, r, s, x, y, z;
	var offset;
	var position = new Vector3D(this.origin_newScenario);

	r = Math.random();
	if (r &gt; 0.15) {
		offset = ~~(Math.random() * 200000);
	} else {
		offset = 800000;
	}
	x = (Math.random() - 0.5) * offset;
	y = (Math.random() - 0.5) * offset;
	z = (Math.random() - 0.5) * offset;
	position = position.add([x, y, z]);

	// 1st group
	s = system.addShips(&quot;IST_asteroid&quot;, 26, position, 34000);

	// 2nd group
	n = 6 + ~~(1 + (r * 55));
	s = system.addShips(&quot;IST_asteroid&quot;, n, position, 44000);

	// Perhaps add various further rocks
	if (r &lt; 0.5) {
		n = 5 + ~~(1 + (r * 40));
		s = system.addShips(&quot;IST_asteroid&quot;, n, position, 60000);
		s = system.addShips(&quot;IST_asteroid&quot;, n, position, 70000);
		if (r &lt; 0.2) {
			s = system.addShips(&quot;IST_asteroid&quot;, 10, position, 95000);
		}
	}

	// Miners
	if (Math.random() &lt;= this.scenario_new_asteroids_chanceMiners) {
		// this.$debugMessage(&quot;Miners&quot;);
		n = ~~(1 + (Math.random() * 6));
		if (Math.random() &lt; 0.45) {
			s = system.addShips(&quot;splinter&quot;, n, position, 10000);
		} else {
			s = system.addShips(&quot;IST_boulder&quot;, n, position, 28000);
		}
		n = ~~(1 + (Math.random() * 10));
		s = this.$addShips_ringless(&quot;IST_miner&quot;, n, position, 12000);
		// Miners tend to come with escorts. But, still, consider adding hunters as protection.
		if (n &gt; 5) {
			n = 1 + ~~(1 + (Math.random() * 4));
			var g = system.addGroup(&quot;hunter&quot;, n, position, 30000);
			if (g.ships) {
				s = g.ships;
				i = s.length;
				while (i--) {
					if (s[i]) {
						s[i].setAI(&quot;IST_hunterAI.plist&quot;);
					}
				}
			} else {
				this.$error(&quot;Problem adding hunters to miners&quot;);
			}
		}
	}

	// The billboards OXP adds them near asteroids, so, remove any billboards that will have been added.
	if (this.OXP_YAH) {
		s = system.filteredEntities(this, this.$isBillboard);
		i = s.length;
		while (i--) {
			s[i].remove(true);
		}
	}
};

this.$scenario_new_derelict = function() {
	// this.$debugMessage(&quot;Derelict&quot;);
	if (Math.random() &lt;= this.scenario_new_derelict_chanceIsLive) {
		this.$scenario_new_derelict_liveOne();
		if (Math.random() &lt; 0.75) {
			return;
		} // allow possibility here of other (but dead) derelicts.
	}
	this.$scenario_new_derelict_deadOneOrOnes(); // keep this as function as something else calls it.
};

this.$scenario_new_derelict_liveOne = function() {
	// this.$debugMessage(&quot;IS LIVE&quot;);

	var localRange = this.scenario_new_derelict_range;
	var x = Math.random() * localRange;
	var y = Math.random() * localRange;
	var z = Math.random() * localRange;
	var position = new Vector3D(this.origin_newScenario);
	position = position.add([x, y, z]);
	var s = this.$addShips_ringless(&quot;IST_liveDerelict&quot;, 1, position, 4000);
	if (s.length &lt; 1) {
		return;
	} // Sanity check
	// s[0].lightsActive = false; // done by AI
	if (!s[0].isValid) {
		return;
	} // Sanity check
	// Otherwise ..
	s[0].switchAI(&quot;IST_liveOneAI.plist&quot;);
	s[0].setScript(&quot;IST_liveOneScript.js&quot;);
	// Now remove any persistent escorts.
	var s2 = system.filteredEntities(this, this.$isEscort, s[0], 100000); // Construction requires an entity.
	var i = s2.length;
	while (i--) {
		if (s2[i]) {
			s2[i].remove(true);
		}
	}
};

this.$scenario_new_derelict_deadOneOrOnes = function() {
	var i, s;

	// Decide how many dead derelicts to add.
	if (Math.random() &lt;= this.scenario_new_derelict_dead_chanceMultiple) {
		var n = ~~(1 + (Math.random() * 4));
		if (n === 4 &amp;&amp; Math.random() &lt; 0.15) {
			n += ~~(1 + (Math.random() * 6));
		}
		i = n;
	} else {
		i = 1;
	}
	// Now add the dead derelict(s).
	var localRange = this.scenario_new_derelict_range;
	var position, x, y, z;
	while (i--) {
		x = Math.random() * localRange;
		y = Math.random() * localRange;
		z = Math.random() * localRange;
		// this.$debugMessage(&quot;dead derelict&quot;);
		// this.$debugMessage(&quot;Origin is: &quot;+this.origin_newScenario);
		position = new Vector3D(this.origin_newScenario);
		position = position.add([x, y, z]);
		s = system.addShips(&quot;IST_derelict&quot;, 1, position, 2050);
		if (s[i] &amp;&amp; s[i].isValid) {
			s[i].lightsActive = false;
		}
	}
	// (Awarding cargo by plist doesn&#39;t seem to work - so do it by SHIP script. That script awards fuel too - which set in shipdata, as default, as zero.

	// Somehow, despite the shipdate forbidding it, some derelicts still end up with escorts. So, zap them:
	// (Actually, I may have fixed this. Still, leave the following code in here as a failsafe.)
	if (s[0] &amp;&amp; s[0].isValid) {
		// this.$debugMessage(&quot;starting escort sweep&quot;);
		var s2 = system.filteredEntities(this, this.$isEscort, s[0], 100000); // Construction requires an entity.
		i = s2.length;
		while (i--) {
			if (s2[i]) {
				// this.$debugMessage(&quot;removed one&quot;);
				s2[i].remove(true);
			}
		}
	}
};

this.$scenario_new_pirates = function() {
	// this.$debugMessage(&quot;Pirates&quot;);
	// Add a group. Many of these ships have escorts.
	var n = this.scenario_new_pirates_baseNumber + ~~(1 + (Math.random() * 2));
	var g = system.addGroup(&quot;IST_pirate&quot;, n, this.origin_newScenario, 15500);
};

this.$scenario_new_helpee = function() {
	var s = this.$addShips_ringless(&quot;interstellar_help_trader&quot;, 1, this.origin_newScenario, 25600);
};

this.$scenario_new_aliens = function() {
	// this.$debugMessage(&quot;Aliens&quot;);
	var n = ~~(1 + (Math.random() * 17));
	var s = this.$addShips_ringless(&quot;scorpax&quot;, n, this.origin_newScenario, 28000);
};

this.$scenario_new_lobsters = function(galNumber) {
	// this.$debugMessage(&quot;Lobsters&quot;);
	var n;
	if (galNumber === 3 || galNumber === 7) {
		n = 4 + ~~(1 + (Math.random() * 19));
	} else {
		n = 4 + ~~(1 + (Math.random() * 30));
		if (n &gt; 24 &amp;&amp; Math.random() &lt; 0.22) n *= 2;
	}
	var g = system.addGroup(&quot;IST_lobster&quot;, n, this.origin_newScenario, 15000);
	var s = g.ships;
	// Give first lobster an ECM, and, for each lobster, tell it which one has the ECM.
	if (s[0]) {
		s[0].awardEquipment(&quot;EQ_ECM&quot;);
	}
	var i = s.length;
	while (i--) {
		if (s[i]) {
			s[i].script.$shipWithECM = s[0];
		}
	}
};

this.$scenario_new_thargoids = function() {
	var group;
	var i;
	var n;
	var offset;
	var origin = new Vector3D();
	var position;
	var r;
	var s;
	var scenario;
	var x;
	var y;
	var z;

	// this.$debugMessage(&quot;Thargoids&quot;);
	// Don&#39;t use system.setPopulator, because that only works within a short time window - which my shannanigans places us outside of.

	origin = this.origin_newScenario;
	n = this.scenario_new_warships_baseNumber + ~~(1 + (Math.random() * 6));
	if (n &gt; 4) {
		if (n &lt; 33 &amp;&amp; Math.random() &gt; 0.95) {
			n *= 2;
		}
	}

	scenario = ~~(1 + (Math.random() * 26));
	// Can&#39;t get the linter&#39;s &#39;fall through&#39; option to work, so have reworked the following.
	switch (scenario) {
		case 1:
			s = this.$addShips_ringless(&quot;IST_thargoid&quot;, n, origin, 14000);
			if ((n &gt; 3) &amp;&amp; (Math.random() &lt;= this.scenario_new_sweeperChance)) {
				s = this.$addShips_ringless(&quot;extraThargoids_sweeper&quot;, 1, origin, 18000);
				n++;
			}
			s = this.$addShips_ringless(&quot;thargoid&quot;, n, origin, 14000);
			break;
		case 2:
			s = this.$addShips_ringless(&quot;thargoid&quot;, n, origin, 14000);
			r = ~~(Math.random() * 60000);
			s = this.$addShips_ringless(&quot;IST_thargoid&quot;, n, origin, r);
			break;
		case 3:
			r = ~~(Math.random() * 60000);
			s = this.$addShips_ringless(&quot;IST_thargoid&quot;, n, origin, r);
			break;
		case 4:
			if (Math.random() &lt; 0.8) {
				s = this.$addShips_ringless(&quot;IST_thargoid&quot;, n, origin, 50000);
				s = this.$addShips_ringless(&quot;thargoid&quot;, 5, origin, 50000);
			} else {
				n *= 12;
				if (n &gt; 64) {
					n = 60;
				}
				s = this.$addShips_ringless(&quot;thargoid&quot;, n, origin, 250000);
				s = this.$addShips_ringless(&quot;extraThargoids_sweeper&quot;, 3, origin, 250000);
				if (this.OXP_ThargoidCarriers) {
					s = this.$addShips_ringless(&quot;thargoid_carrier&quot;, 3, origin, 250000);
				}
				if ((score &gt; 7000) &amp;&amp; (Math.random() &lt; 0.4)) {
					s = this.$addShips_ringless(&quot;thargoid&quot;, 40, origin, 300000);
					if (this.OXP_ThargoidCarriers) {
						s = this.$addShips_ringless(&quot;thargoid_carrier&quot;, 6, origin, 250000);
					}
					if ((score &gt; 10000) &amp;&amp; (Math.random() &lt; 0.3)) {
						s = this.$addShips_ringless(&quot;IST_thargoid&quot;, 30, origin, 300000);
						s = this.$addShips_ringless(&quot;extraThargoids_sweeper&quot;, 6, origin, 300000);
						s = this.$addShips_ringless(&quot;thargoid&quot;, 15, [0, 0, 0], 20000);
						if (this.OXP_ThargoidCarriers) {
							s = this.$addShips_ringless(&quot;thargoid_carrier&quot;, 5, origin, 400000);
						}
					}
				}
			}
			break;
		case 5:
			s = this.$addShips_ringless(&quot;thargoid&quot;, n, origin, 15000);
			if (this.OXP_extraThargoids) {
				s = this.$addShips_ringless(&quot;extraThargoids_frigatePoet&quot;, 4, origin, 17000);
			}
			break;
		case 6, 7:
			if (Math.random() &gt; 0.1) {
				offset = ~~(Math.random() * 20000);
			} else {
				offset = 80000;
			}
			x = Math.random() * offset;
			y = Math.random() * offset;
			z = Math.random() * offset;
			position = new Vector3D(origin);
			position = position.add([x, y, z]);
			s = this.$addShips_ringless(&quot;thargoid&quot;, n, position, 15000);
			break;
		case 8:
			s = system.addGroup(&quot;thargoidRebel&quot;, n, origin, 17000);
			// log(&quot;InterstellarTweaks&quot;,&quot;Thargoid rebels added.&quot;);
			if (Math.random() &lt; 0.35) {
				x = Math.random() * offset;
				y = Math.random() * offset;
				z = Math.random() * offset;
				position = new Vector3D(origin);
				position = position.add([x, y, z]);
				s = this.$addShips_ringless(&quot;thargoid&quot;, n, position, 15000);
			} else {
				s = system.addGroup(&quot;thargoidRebel&quot;, 10, origin, 20000);
			}
			break;
		case 9:
			this.$wreckage(origin);
			s = this.$addShips_ringless(&quot;thargoid&quot;, n, origin, 15000);
			break;
		case 10:
			if (Math.random() &gt; 0.1) {
				offset = ~~(Math.random() * 20000);
			} else {
				offset = 80000;
			}
			x = Math.random() * offset;
			y = Math.random() * offset;
			z = Math.random() * offset;
			position = new Vector3D(origin);
			position = position.add([x, y, z]);
			s = this.$addShips_ringless(&quot;IST_thargoid&quot;, n, position, 15000);
			break;
		default:
			// Make this scenario resemble the BBC Elite scenario.
			s = this.$addShips_ringless(&quot;thargoid&quot;, n, origin, 17000);
	}
};

this.$scenario_new_hunters = function() {
	var hunters;
	var i;
	var l;
	var n;
	var ordinanceAvailable;
	var ordinanceCount;
	var origin = new Vector3D();
	var r;
	var s;

	// this.$debugMessage(&quot;Hunters&quot;);

	origin = this.origin_newScenario;

	// Add ships
	// -----------

	// Add a heavy-hunter, in a group of its own.
	hunters = system.addGroup(&quot;hunter-heavy&quot;, 1, origin, 17000);

	if (hunters == null || hunters.ships == null) {
		this.$error(&quot;Problem adding hunters&quot;);
		return;
	}

	// Add a medium hunter and add it to the group
	s = system.addShips(&quot;hunter-medium&quot;, 1, origin, 17000);
	hunters.addShip(s[0]);
	// Now ensure that all the members of the group-as-it-is-presently are somewhat beefy, and set their AI.
	s = hunters.ships;
	l = s.length;
	i = l;
	while (i--) {
		if (s[i] &amp;&amp; s[i].isValid) {
			s[i].setAI(&quot;IST_hunterAI.plist&quot;);
			if (s[i].energyRechargeRate &lt; 6) {
				s[i].energyRechargeRate *= 1.5; // equivalent of adding an energy unit.
			}
			if (s[i].canAwardEquipment(&quot;EQ_ECM&quot;)) {
				s[i].awardEquipment(&quot;EQ_ECM&quot;);
			}
			if (s[i].canAwardEquipment(&quot;EQ_FUEL_INJECTION&quot;)) {
				s[i].awardEquipment(&quot;EQ_FUEL_INJECTION&quot;);
			}
			if (s[i].accuracy &lt; 5) {
				s[i].accuracy += 3;
			}
		}
	}

	// Add some of the hunters defined by this OXP (though those hunters depend heavily on OXPs).
	n = ~~(1 + (Math.random() * 8));
	s = system.addShips(&quot;IST_hunter&quot;, n, origin, 16750);
	if (s) {
		l = s.length;
		i = l;
		while (i--) {
			if (s[i] &amp;&amp; s[i].isValid) {
				hunters.addShip(s[i]);
			}
		}
	}


	// Now, for all the ships: add some ordinance and perhaps a bounty.
	// ----------------------------------------------------------------

	// First, create list of available ordinance.
	ordinanceAvailable = [&quot;EQ_QC_MINE&quot;];
	if (this.OXP_bombs) {
		ordinanceAvailable.push(&quot;EQ_RMB_FRAG_MISSILE&quot;, &quot;EQ_RMB_OVERRIDE_MISSILE&quot;, &quot;EQ_RMB_THARGOID_MISSILE&quot;, &quot;EQ_RMB_THARGOID_MISSILE&quot;);
	}
	if (this.OXP_Nexus) {
		ordinanceAvailable.push(&quot;EQ_NEXUS_BUG_MISSILE&quot;, &quot;EQ_NEXUS_BUG_MISSILE&quot;);
		ordinanceAvailable.push(&quot;EQ_NEXUS_PREMIUM_MISSILE&quot;);
		ordinanceAvailable.push(&quot;EQ_NEXUS_BASIC_MISSILE&quot;);
	}
	ordinanceCount = ordinanceAvailable.length;
	i = ordinanceCount;
	while (i--) {
		ordinanceAvailable.push(&quot;EQ_HARDENED_MISSILE&quot;);
	}

	// Now run through the whole group . .
	s = hunters.ships;
	l = s.length;
	i = l;
	while (i--) {
		if (s[i] &amp;&amp; s[i].isValid) {
			// this.$debugMessage(&quot;i is: &quot;+i);
			// Substitute a missile.
			if (s[i].equipmentStatus(&quot;EQ_MISSILE&quot;) === &quot;EQUIPMENT_OK&quot;) {
				s[i].removeEquipment(&quot;EQ_MISSILE&quot;);
				n = ~~(1 + (r * ordinanceCount));
				s[i].awardEquipment(ordinanceAvailable[n]);
			}
		}
	}
	// Consider upping the bounty of one of the ships.
	if (s[0] &amp;&amp; s[0].isValid) {
		r = Math.random();
		if (r &gt; 0.65) {
			s[0].bounty = s[0].bounty + ~~(1 + (60 * r));
		}
	}
};

this.$scenario_new_genship = function() {
	// this.$debugMessage(&quot;Tharg genship&quot;);

	var offset = 185000;
	var x = (Math.random() - 0.5) * offset;
	var y = (Math.random() - 0.5) * offset;
	var z = (Math.random() - 0.5) * offset;
	var position = new Vector3D(this.origin_newScenario);
	position = position.add([x, y, z]);
	if (position.distanceTo(player.ship.position) &lt; 27500) {
		if (x &gt; 0) {
			x += 5000;
		} else {
			x -= 5000;
		}
		if (y &gt; 0) {
			y += 5000;
		} else {
			y -= 5000;
		}
		if (z &gt; 0) {
			z += 5000;
		} else {
			z -= 5000;
		}
		position.add([x, y, z]);
	}
	var n;
	var s;
	s = system.addShips(&quot;IST_genship&quot;, 1, position);
	if (this.OXP_extraThargoids) {
		n = 1 + ~~(1 + (Math.random() * 6));
		s = system.addShips(&quot;extraThargoids_sweeper&quot;, n, position, 34000);
		if (Math.random() &lt; 0.7) {
			n = ~~(1 + (Math.random() * 5));
			s = system.addShips(&quot;IST_thargoidLurker&quot;, n, position, 34000);
		}
		return;
	}
	var r = Math.random();
	if (r &gt; 0.6) {
		return;
	}
	n = ~~(1 + (r * 15));
	s = system.addShips(&quot;IST_thargoidLurker&quot;, n, position, 34000);
};


// -----------
// NAVY STUFF
// ----------

this.$willExit_extraNavy = function() {
	this.$extraNavyCore();
};

this.$willExit_navyOnly = function() {
	// this.$debugMessage(&quot;OnlyNavy onWillExit - start&quot;);

	// postJump_timed removes non-navy. Yet, if we leave it at that, then Thargoids flash up on the scanner. 
	// So, do &#39;this.$remove_removeMostNonNaval()&#39; later in *this* routine, as well.
	// Need also to stop various populators running - my &#39;iinterstellarTweaks_repopulate_interstellar_custom&#39; fixes that.
	// The REpopulator takes account of the &#39;onlyNavy&#39; scenario, too.

	this.$interstellarShift_forModifiedScenario();
	// Requires, in &#39;postJump_timed&#39;, &#39;this.$returnShipToGroundZero_butPerhapsOffset&#39;.

	// Decide whether to fiddle with the navy (if there&#39;s more than a few naval ships extant).
	var s = system.filteredEntities(this, this.$isNavy);
	if (s.length &gt; 2) {
		// Do we replace it with my custom navy? (Largely to prevent the navy jumping out immediately)
		if (Math.random() &gt; this.scenario_modified_onlyNavy_replaceNavyChance) {
			this.$willExit_navyOnlyNoReplacement();
		} else {
			this.$willExit_navyOnlyWithReplacement();
		}
	}
	// else {
	// 	this.$debugMessage(&quot;OnlyNavy - nothing special doing&quot;);
	//}
	// Do we add extra navy?
	if (Math.random() &lt; 0.2) {
		this.$extraNavyCore();
	}
	this.$remove_removeMostNonNaval();
	this.$stopMostNavyLeaving();
};

this.$stopMostNavyLeaving = function() {
	var s = system.filteredEntities(this, this.$isNavy);
	var i = s.length;
	while (i--) {
		if (s[i].ai !== &quot;IST_milAI.plist&quot; &amp;&amp; s[i].ai !== &quot;ferdelance3G_interstellarAI&quot; &amp;&amp; s[i].ai !== &quot;spectreAI.plist&quot; &amp;&amp; s[i].ai !== &quot;TCAT_raptorAI.plist&quot; &amp;&amp; s[i].ai !== &quot;militaryFiascoCarrierAI&quot; &amp;&amp; s[i].ai !== &quot;IST_navyPootleAI.plist&quot;) {
			if (s[i].ai === &quot;behemothFighterInterceptAI.plist&quot;) {
				s[i].sendAIMessage(&quot;TARGET_LOST&quot;);
				// The above should should prompt the ship to switch into behemothFighterDockingAI.plist.
				// this.$debugMessage(&quot;$stopMostNavyLeaving - found behemothFighterInterceptAI AI&quot;);
			} else {
				// this.$debugMessage(&quot;$stopMostNavyLeaving - found a desired AI but not behemothFighterInterceptAI&quot;);
				s[i].setAI(&quot;IST_navyPootleAI.plist&quot;);
				// seems to miss ships with navyfrigateAI. They are added too late? Workaround is below.
			}
		}
	}
	this.timer_checkAndActOnNavyFrigates = new Timer(this, this.$checkAndActOnNavyFrigatesTimed, 0.1);
	// this.$debugMessage(&quot;ONLY NAVY END&quot;);
};


// NO REPLACEMENT. Decide whether has been a battle.

this.$willExit_navyOnlyNoReplacement = function() {
	// this.$debugMessage(&quot;No replacement&quot;);
	// See whether had a BATTLE.
	if (Math.random() &lt; scenario_modified_wasBattle_chance) {
		return;
	}
	this.$willExit_navyOnlyNoReplacementWithBattle();
};


// REPLACEMENT. Decide whether has been a battle.

this.$willExit_navyOnlyWithReplacement = function() {
	// this.$debugMessage(&quot;Replacing ships&quot;);
	// See if had a BATTLE
	if (Math.random() &lt;= scenario_modified_wasBattle_chance) {
		this.$willExit_navyOnlyWithReplacementWithBattle();
	} else {
		this.$willExit_navyOnlyWithReplacement_noBattle();
	}
};

// Replacement WITHOUT battle.

this.$willExit_navyOnlyWithReplacement_noBattle = function() {
	// REMOVE navy. (We will replace them shortly.)
	var s = system.filteredEntities(this, this.$isNavy);
	if (s == null) {
		return;
	}
	var l = s.length;
	if (l === 0) {
		return;
	}
	if (l &gt; 60) {
		l = 60;
	} // Do not remove more than this, &#39;cos causes problems for adding back.
	var i = l;
	while (i--) {
		s[i].remove(true);
	}
	// Now REPLACE the navy with my navy.
	s = system.addShips(&quot;IST_mil&quot;, l, [0, 0, 0], 25000);
};

// Replacement WITH BATTLE.
this.$willExit_navyOnlyWithReplacementWithBattle = function() {
	// this.$debugMessage(&quot;Was battle&quot;);

	// REMOVE navy. (We will replace most of them shortly.)
	var s = system.filteredEntities(this, this.$isNavy);
	var l = s.length;
	if (l &gt; 0) {
		if (l &gt; 60) {
			l = 60;
		} // Do not remove more than this, &#39;cos causes problems for adding back.
		var i = l;
		while (i--) {
			s[i].remove(true);
		}
		// Now REPLACE SOME the navy with mine - *some* because there has been a battle.
		var n = ~~(1 + (Math.random() * l));
		if (n &gt; 60) {
			n = 60;
		}
		s = system.addShips(&quot;IST_mil&quot;, n, [0, 0, 0], 25000);

		// DAMAGE some of the ships.
		n = s.length; // Get this length, rather than using old l, in case some of the ships could not be added.
		i = ~~(1 + (Math.random() * n));
		if (n &gt; 15) {
			n = 15;
		}
		// this.$debugMessage(&quot;Damaging &quot;+n);
		var d;
		while (i--) {
			if (s[i].isValid) {
				d = 50 + (i * 25);
				if (s[i].energy &gt; d) {
					s[i].energy -= d;
					// i.e. if ship can take the damage without being destroyed, then deal the damage.
				} else {
					s[i].energy = d;
				}
			}
		}
	}
	// WRECKAGE
	this.$wreckage([0, 0, 0]);
};


// NO REPLACEMENT, BUT HAS BEEN BATTLE.
this.$willExit_navyOnlyNoReplacementWithBattle = function() {
	// this.$debugMessage(&quot;Was battle&quot;);
	var s = system.filteredEntities(this, this.$isNavy);
	if (s.length === 0) {
		return;
	}
	var i;
	if (Math.random() &lt;= this.scenario_modified_wasBattle_wreckageOnly_chance) {
		// Remove ALL ships; leave WRECKAGE ONLY
		i = s.length;
		while (i--) {
			s[i].remove(true);
		}
		this.$wreckage([0, 0, 0]);
	} else {
		// Damage and remove ships
		i = ~~(1 + (Math.random() * (s.length - 1)));
		// Determine the faction to remove or damage.
		var d;
		while (i--) {
			// The line below evaluates to true if and only if the variable is divisible by 2.
			if (i % 2 === 0) {
				if (s[i].isValid) {
					s[i].remove(true);
					// this.$debugMessage(&quot;Removed a ship&quot;);
				}
			} else {
				d = 100 + (i * 2);
				if (s[i].isValid) {
					if (s[i].energy &gt; d) {
						s[i].energy -= d; // If the ship can take the damage, then deal it.
					} else {
						s[i].remove(true);
					}
				}
			}
		}
		this.$wreckage([0, 0, 0]);
	}
};

this.$checkAndActOnNavyFrigatesTimedCore = function() {
	var s = system.filteredEntities(this, this.$isNavy_frigate);
	if (s.length === 0) {
		return;
	}
	var i = s.length;
	while (i--) {
		if (s[i].isValid &amp;&amp; s[i].ai === &quot;navyfrigateAI.plist&quot;) {
			if (s[i].AIState === &quot;HYPER_OUT&quot; || s[i].AIState === &quot;STAY_INTERSTELLAR&quot; || s[i].AIState === &quot;GLOBAL&quot;) {
				// this.$debugMessage(&quot;$checkAndActOnNavyFrigatesTimedCore - found plist AI, in a desired state.&quot;);
				s[i].setAI(&quot;IST_navyPootleAI.plist&quot;);
			} else {
				this.$debugMessage(&quot;$checkAndActOnNavyFrigatesTimedCore - found plist AI, but wrong state.&quot;);
			}
		} else if (s[i].ai === &quot;nullAI.plist&quot;) {
			// This could happen when there is a Javascript AI.
			s[i].setAI(&quot;IST_navyPootleAI.plist&quot;);
			// this.$debugMessage(&quot;$checkAndActOnNavyFrigatesTimedCore - Found null (Javascript?) AI.&quot;);
		}
	}
};

this.$checkAndActOnNavyFrigatesTimed = function $checkAndActOnNavyFrigatesTimed() {
	// this.$debugMessage(&quot;$checkAndActOnNavyFrigatesTimed - fired.&quot;);
	// Remove the timer.
	if (this.timer_checkAndActOnNavyFrigates) {
		if (this.timer_checkAndActOnNavyFrigates.isRunning) {
			this.timer_checkAndActOnNavyFrigates.stop();
		}
		delete this.timer_checkAndActOnNavyFrigates;
	}
	this.$checkAndActOnNavyFrigatesTimedCore();
};

this.$wreckage = function(pos) {
	this.$wreckageCore(pos);
	// Consider doing it again:
	if (Math.random() &lt; 0.25) {
		this.$wreckageCore(pos);
	}
};

this.$wreckageCore = function(pos) {
	var n;
	var pos_new;
	var r;
	var s;
	var x, y, z;

	// Alloys
	r = ~~(1 + (Math.random() * 6));
	switch (r) {
		case 1:
			s = system.addShips(&quot;IST_alloy&quot;, r, pos, 19000);
			break;
		case 2:
			s = system.addShips(&quot;IST_alloy&quot;, 2, pos, 20000);
			break;
		case 3:
			n = 3 + ~~(1 + (Math.random() * 13));
			s = system.addShips(&quot;IST_alloy&quot;, n, pos, 35000);
			break;
		default:
			s = system.addShips(&quot;IST_alloy&quot;, r, pos, 18000);
	}

	// Tharglets
	r = Math.random();
	if (r &lt; 0.6) {
		n = ~~(1 + (Math.random() * 14));
		if (r &lt; 0.15) {
			n += 10;
		}
		s = system.addShips(&quot;IST_Tharglet&quot;, n, pos, 29000);
	}

	// Derelicts
	// Vipers
	r = Math.random();
	if (r &lt; 0.12) {
		x = (Math.random() * 56000) - 28000;
		y = (Math.random() * 56000) - 28000;
		z = (Math.random() * 56000) - 28000;
		pos_new = new Vector3D(pos);
		pos_new = pos_new.add([x, y, z]);
		if (r &lt; 0.07) {
			n = 1;
		} else {
			n = 1 + ~~(1 + Math.random);
		}
		while (n--) {
			x = (Math.random() * 56000) - 28000;
			y = (Math.random() * 56000) - 28000;
			z = (Math.random() * 56000) - 28000;
			pos_new = pos_new.add([x, y, z]);
			s = system.addShips(&quot;IST_derelictViper&quot;, 1, pos_new);
		}
	}
	// Thargoids
	r = Math.random();
	if (r &lt; 0.15) {
		pos_new = new Vector3D(pos);
		if (r &lt; 0.05) {
			n = 1;
		} else {
			n = 2 + ~~(1 + Math.random);
		}
		while (n--) {
			x = (Math.random() * 56000) - 28000;
			y = (Math.random() * 56000) - 28000;
			z = (Math.random() * 56000) - 28000;
			pos_new = pos_new.add([x, y, z]);
			s = system.addShips(&quot;IST_derelictThargoid&quot;, 1, pos_new);
		}
	}
};

this.$remove_removeMostNonNaval = function() {
	// this.$debugMessage(&quot;Removing non-navy&quot;);
	var s;
	if (this.OXP_InterstellarHelp &amp;&amp; worldScripts.interstellar_help.interstellarHelp === &quot;FOLLOWING&quot;) {
		s = system.filteredEntities(this, this.$toRemove_nonNavy_butKeepInterstellarHelpShip);
	} else {
		s = system.filteredEntities(this, this.$toRemove_nonNavy);
	}
	var i = s.length;
	// this.$debugMessage(&quot;Removing non-naval: &quot;+i);
	while (i--) {
		s[i].remove(true);
	}
};


// --------------------------
// General New Scenario stuff
// --------------------------

this.$willExit_newScenario = function() {
	this.$newScenarioOnExitCore();
	this.$scenario_new_populate(); // Note: Can&#39;t do another &#39;$remove_allFromNew&#39; after this.
};

this.$newScenarioOnExitCore = function() {
	var d, offset, x, y, z;

	this.$remove_allFromNew();
	offset = 300000000;
	// Determine future ship position a.k.a. this.origin_newScenario.
	// (Note: can&#39;t easily get rid of Thargoid carriers, so just ensure player a long way from them.)
	x = 150000 + ~~(Math.random() * offset);
	y = 150000 + ~~(Math.random() * offset);
	z = 150000 + ~~(Math.random() * offset);
	d = ~~(Math.random() * 9);
	switch (d) {
		case 1:
			x *= -1;
			break;
		case 2:
			y *= -1;
			break;
		case 3:
			z *= -1;
			break;
		case 4:
			x *= -1;
			y *= -1;
			break;
		case 5:
			x *= -1;
			y *= -1;
			z *= -1;
			break;
		case 6:
			y *= -1;
			z *= -1;
			break;
		case 7:
			x *= -1;
			z *= -1;
			break;
		default:
			break;
	}
	this.$interstellarShift_forNewScenario(x, y, z);
	this.$remove_allFromNew(); // again
};

// Carrier mass:	3016,637184	hex: B3CE3B00
// Crusier mass:	1201996	hex: 12574C
// Warship mass:	848632
this.$extraNavyCore = function() {
	// Some code here adapted from &quot;Thargorn_Witchspace_Battle&quot; by Arexack Heretic and Eric Walch.
	if (!player.ship) {
		return;
	}
	var s;
	var baseNumberNavyToAdd = ~~(1 + (Math.random() * 5));
	if (this.scenario !== &quot;onlyNavy&quot;) {
		s = system.entitiesWithScanClass(&quot;CLASS_THARGOID&quot;);
		var c = s.filter(this.$shipWeight_heavy).length;
		if (c &gt; 2) {
			baseNumberNavyToAdd += (3 + ~~(1 + (Math.random() * 5)));
		}
		if (baseNumberNavyToAdd &lt; 12) {
			c = s.filter($shipWeight_medium).length;
			if (c &gt; 4) {
				baseNumberNavyToAdd += 3;
			}
		}
	}
	// Now actually add the ship(s)
	s = system.addShips(&quot;IST_mil&quot;, baseNumberNavyToAdd, [0, 0, 0], 24500);
	if (this.OXP_StarDestroyer &amp;&amp; (system.allShips.length &lt; 50) &amp;&amp; (Math.random() &lt; 0.05)) {
		s = system.addShips(&quot;IST_stardestroyer&quot;, 1, [0, 0, 0], 25000);
	}
};

this.$willExit_bugsOnly = function() {
	this.$willExit_bugsOnlyPreliminaries();
	if (Math.random() &lt;= scenario_modified_wasBattle_chance) {
		this.$willExit_bugsOnlyWasBattle();
	} else {
		this.$willExit_bugsOnlyNoBattle();
	}
	this.$willExit_bugsOnlyPostscript();
	// this.$debugMessage(&quot;ONLY BUGS END&quot;);
};

this.$willExit_bugsOnlyPreliminaries = function() {
	this.$remove_removeMostThargoid();
	this.$interstellarShift_forNewScenario();
	if ((this.OXP_extraThargoids) &amp;&amp; (Math.random() &lt;= this.scenario_modified_onlyBugs_addSweeperChance)) {
		var s = system.addShips(&quot;extraThargoids_sweeper&quot;, 1, [0, 0, 0], 25000);
	}
};

this.$willExit_bugsOnlyWasBattle = function() {
	// this.$debugMessage(&quot;Only bugs - Was battle&quot;);
	var s = system.entitiesWithScanClass(&quot;CLASS_THARGOID&quot;);
	var l = s.length;
	var i;
	if ((l &lt; 3) || (Math.random() &lt;= this.scenario_modified_wasBattle_wreckageOnly_chance)) {
		i = l;
		while (i--) {
			s[i].remove(true);
		}
		// this.$debugMessage(&quot;Wreckage only&quot;);
	} else {
		i = ~~(1 + (Math.random() * (l - 1)));
		// = number of thargoids to remove or damage.
		// this.$debugMessage(&quot;Was &quot;+l); this.$debugMessage(&quot;Removing or damaging &quot;+i);
		while (i--) {
			if (i &gt; 3) {
				s[i].remove(true);
			} else {
				s[i].energy -= 40 + (i * 40);
				if (s[i].energy &lt; 1) {
					s[i].remove(true);
				}
			}
		}
	}
	this.$wreckage([0, 0, 0]);
};

this.$willExit_bugsOnlyNoBattle = function() {
	var r;
	if (Math.random() &gt; 0.5) {
		r = system.scrambledPseudoRandomNumber(700010);
	} else {
		r = Math.random();
	}
	// scrambledPseudoRandomNumber seed here SAME as scenario_new_warships_chance
	if (r &gt; this.scenario_modified_onlyBugs_multiplyBugsChance) {
		return;
	}
	// Otherwise ..
	var s;
	s = system.addShips(&quot;IST_thargoid&quot;, 4, [0, 0, 0], 27000);
	if (!this.OXP_extraThargoids) {
		return;
	}
	// Otherwise ..
	r = Math.random();
	if (r &gt; 0.3) {
		return;
	}
	// Otherwise ..
	var l;
	if (r &gt; 0.1) {
		l = 2;
	} else {
		l = 3;
	}
	s = system.addShips(&quot;uberBuggly&quot;, l, [0, 0, 0], 20000);
};

this.$willExit_bugsOnlyPostscript = function() {
	var l, offset, s, x, y, z;
	if (this.OXP_StarDestroyer &amp;&amp; (Math.random() &lt; 0.03)) {
		offset = 15000;
		x = (Math.random() - 0.5) * offset;
		y = (Math.random() - 0.5) * offset;
		z = (Math.random() - 0.5) * offset;
		s = system.addShips(&quot;IST_stardestroyer&quot;, 1, [x, y, z]);
	}
	if (this.OXP_GenShips) {
		if (Math.random() &lt;= this.scenario_modified_onlyBugs_thargGenship_chance) {
			offset = 175000;
			x = (Math.random() - 0.5) * offset;
			y = (Math.random() - 0.5) * offset;
			z = (Math.random() - 0.5) * offset;
			s = system.addShips(&quot;IST_genship&quot;, 1, [x, y, z]);
		}
	}
	if (this.OXP_aliens &amp;&amp; Math.random() &lt;= this.scenario_modified_onlyBugs_aliensChance) {
		l = 2 + ~~(1 + (Math.random() * 20));
		s = system.addShips(&quot;scorpax&quot;, l, [0, 0, 0], 27000);
		if (Math.random() &lt; 0.2) {
			s = system.addShips(&quot;scorpax&quot;, 7, [0, 0, 0], 25000);
		}
	} else if (Math.random() &lt;= this.scenario_modified_onlyBugs_rebelChance) {
		l = 2 + ~~(1 + (Math.random() * 15));
		if (l &gt; 9 &amp;&amp; Math.random() &lt; 0.1) {
			l += 20;
		}
		s = system.addGroup(&quot;thargoidRebel&quot;, l, [0, 0, 0], 15000);
		log(&quot;InterstellarTweaks&quot;, &quot;Thargoid rebels added.&quot;);
	}
};


/*
----------------------------------------------------------------------------------------------
EXITED witchspace.
This code is called after a witchspace jump has concluded and the tunnel effect has been shown.
-----------------------------------------------------------------------------------------------
*/

this.shipExitedWitchspace = function() {
	// this.$debugMessage(&quot;STAGE *4* - shipExitedWitchspace&quot;);
	if (!player.ship || (this.OXP_TWD &amp;&amp; worldScripts[&quot;murphy-thargoid-drive.js&quot;].jumping)) {
		return;
	}
	if (this.jumpIsGalactic) {
		this.jumpIsGalactic = false;
		return;
	}
	this.jumpIsGalactic = false;
	this.$exited_timed(); // Need this as a seperate routine, so that rescheduled timer can, if necessary, call it
};

this.$exited_timed = function $exited_timed() {
	if (!system.isInterstellarSpace) {
		// STELLAR
		this.$willExit_constants_modular();
		return;
	}
	// Otherwise ..
	// INTERSTELLAR SPACE
	if (this.beforeExitIsRunning) {
		if (this.timer_resched &amp;&amp; this.timer_resched.isRunning) {
			this.$error(&quot;Problem 1 with modified WS exit. There may be a syntax error elsewhere in the script.&quot;);
			return;
		} else {
			this.$timerDelete_resched();
			this.timer_resched = new Timer(this, this.$exited_timed, 0.4);
			return; // N.B.
		}
	}
	// Otherwise ..
	if (this.timer_interstellarPostWillExit &amp;&amp; this.timer_interstellarPostWillExit.isRunning) {
		if (this.timer_resched &amp;&amp; this.timer_resched.isRunning) {
			this.$error(&quot;Problem 2 with modified WS exit. There may be a syntax error elsewhere in the script.&quot;);
			return;
		} else {
			this.$timerDelete_resched();
			this.timer_resched = new Timer(this, this.$exited_timed, 0.4);
		}
		return; // N.B.
	}
	// Otherwise ..
	this.$timerDelete_resched();
	this.$timerDelete_interstellarPostWillExit();
	this.$timerDelete_returnEtc();
	if (this.scenario === &quot;&quot; || this.scenario === &quot;extraNavy&quot;) {
		this.$willExit_constants_modular();
	} else {
		// In this case - case of onlyBugs, onlyNavy, or newScenario - do &#39;alwaysApplicable&#39; later.
		this.$awardMASCetc(); // this removed later on
		this.timer_returnEtc = new Timer(this, this.$postJump_timed, this.scenario_delayBeforeReturnShipToGroundZero);
		// What this routine does depends on the modification. But will always do $willExit_constants_modular.
	}
	// this.$debugMessage(&quot;EXIT: &quot;+this.scenario);
};

this.$awardMASCetc = function() {
	if (!player.ship) {
		return;
	}
	var ps = player.ship; // for speed, but changes won&#39;t affect the original variable
	// 1 = none = 1; 2 = had already; 3 = damaged.
	this.MASC_status = 0;
	this.spoofStatus = 0;
	var equipmentStatus;
	equipmentStatus = ps.equipmentStatus(&quot;EQ_MILITARY_JAMMER&quot;);
	if (equipmentStatus === &quot;EQUIPMENT_OK&quot;) {
		this.MASC_status = 2;
	} else if (equipmentStatus === &quot;EQUIPMENT_DAMAGED&quot;) {
		player.ship.setEquipmentStatus(&quot;EQ_MILITARY_JAMMER&quot;, &quot;EQUIPMENT_OK&quot;);
		this.MASC_status = 3;
	} else {
		this.MASC_status = 1;
		player.ship.awardEquipment(&quot;EQ_MILITARY_JAMMER&quot;);
	}
	// REMOVE SPOOF
	equipmentStatus = ps.equipmentStatus(&quot;EQ_MISSILE_SPOOF&quot;);
	if (equipmentStatus === &quot;EQUIPMENT_OK&quot;) {
		this.spoofStatus = 2;
		player.ship.removeEquipment(&quot;EQ_MISSILE_SPOOF&quot;);
	} else if (equipmentStatus === &quot;EQUIPMENT_DAMAGED&quot;) {
		this.spoofStatus = 3;
	} else {
		this.spoofStatus = 1;
	}
};

this.$stripMASC_etc = function() {
	if (!player.ship) {
		return;
	}
	// MASC
	// 1 = none = 1; 2 = had already; 3 = damaged.
	switch (this.MASC_status) {
		case 1:
			player.ship.removeEquipment(&quot;EQ_MILITARY_JAMMER&quot;);
			break;
			// Didn&#39;t have it before, so remove
		case 2:
			break;
			// Had it before, so leave it on ship.
		case 3:
			player.ship.setEquipmentStatus(&quot;EQ_MILITARY_JAMMER&quot;, &quot;EQUIPMENT_DAMAGED&quot;);
			break;
			// Restore it to broken condition
	}
	// SPOOF
	switch (this.spoofStatus) {
		case 1:
			break;
			// Didn&#39;t have it before, so didn&#39;t remove it, so need do nothing.
		case 2:
			player.ship.awardEquipment(&quot;EQ_MISSILE_SPOOF&quot;);
			break;
			// Had it before, so restore.
		case 3:
			player.ship.awardEquipment(&quot;EQ_MISSILE_SPOOF&quot;);
			player.ship.setEquipmentStatus(&quot;EQ_MISSILE_SPOOF&quot;, &quot;EQUIPMENT_DAMAGED&quot;);
			break;
			// Return it to damaged.
	}
	this.MASC_status = 0;
	this.spoofStatus = 0;
};

this.$postJump_timed = function $postJump_timed() {
	// this.$debugMessage(&quot;STAGE *5* - postJump_timed. Tweak value is: &quot;+this.scenario);
	if (system.isInterstellarSpace) {
		switch (this.scenario) {
			case &quot;onlyNavy&quot;:
				this.$remove_removeMostNonNaval();
				this.$returnShipToGroundZero_butPerhapsOffset();
				break;
			case &quot;onlyBugs&quot;:
				this.$remove_removeMostThargoid();
				this.$returnShipToGroundZero_butPerhapsOffset();
				break;
			case &quot;newScenario&quot;:
				if (!this.origin_newScenario) {
					this.$debugMessage(&quot;NO FUTURE POSITION!&quot;);
					this.$stripMASC_etc();
					this.$willExit_constants_modular();
					return;
				}
				// Otherwise ..
				if (!player.ship) {
					this.$stripMASC_etc();
					return;
				}
				player.ship.position = this.origin_newScenario;
				break;
		}
		this.$stripMASC_etc(); // Don&#39;t need this if in normal space, &#39;cos won&#39;t have fiddled with equipment.
		if (this.OXP_hiredGuns) {
			this.$hiredGunsStuff();
		}
	}
	this.$willExit_constants_modular();
	// this.$debugMessage(&quot;End of returnEtc&quot;);
};

this.$willExit_constants_modular = function() {
	// this.$debugMessage(&quot;$willExit_constants_modular&quot;);
	if (!player.ship) {
		return;
	}
	if (system.isInterstellarSpace) {
		var i, s;
		if (this.OXP_InterstellarHelp &amp;&amp; (Math.random() &lt; 0.7)) {
			// Do this here = as late as possible.
			// Note that the interstellar_help OXP only spawns these ships on a&lt; 0.3 chance.
			s = system.filteredEntities(this, this.$isInterstellarHelpee);
			i = s.length;
			while (i--) {
				s[i].remove(true);
			}
		}
		if (this.OXP_aliens &amp;&amp; (Math.random() &lt; 0.35)) {
			s = system.filteredEntities(this, this.$isAlien);
			i = s.length;
			while (i--) {
				s[i].remove(true);
			}
		}
	}
	// End of &#39;if (system.isInterstellarSpace)&#39;

	if (!this.willDie) {
		this.$check_getSickOrIfDieFromIt();
		// Having this here, rather than below the increase to sickness chance, prevents getting sick on first jump (presuming that initial sickness chance set to zero).
	}
	// Now check whether STILL not scheduled to die.
	if (!this.willDie) {
		if (!this.isSick &amp;&amp; this.currentChanceOfSickness &lt; 0.5) {
			this.currentChanceOfSickness += 0.007;
			// 0.007. This is where, through withchspace jumps, we increase the chance of the player getting sick.
		}
	} else {
		// Don&#39;t destroy the player ship before other OXPs have chance to do their stuff. Also, need delay to allow user to read messages.
		// Disable escape pod.
		if (player.ship.equipmentStatus(&quot;EQ_ESCAPE_POD&quot;) === &quot;EQUIPMENT_OK&quot; || player.ship.equipmentStatus(&quot;EQ_ESCAPE_POD&quot;) === &quot;EQUIPMENT_DAMAGED&quot;) {
			player.ship.removeEquipment(&quot;EQ_ESCAPE_POD&quot;);
		}
		if (!this.timer_die) {
			// this.$debugMessage(&quot;setting die timer&quot;);
			this.timer_die = new Timer(this, this.$die_timed, 4);
			// 4 Seems the right value.
			// this.$debugMessage(&quot;set die timer OK&quot;);
		}
	}
};

this.$hiredGunsStuff = function() {
	if (!player.ship.isValid || !player.ship.position) {
		return;
	}
	// this.$debugMessage(&quot;Removing - escort stuff&quot;);
	var s = system.filteredEntities(this, this.$isHiredGun);
	if (s.length &lt; 1) {
		return;
	}
	var d, i, x, y, z;
	var ps = player.ship; // for speed, but changes won&#39;t affect the original variable
	i = s.length;
	while (i--) {
		d = s[i].position.distanceTo(ps.position);
		if (d &gt; 40000) {
			x = ~~((Math.random() - 0.5) * 25600);
			y = ~~((Math.random() - 0.5) * 25600);
			z = ~~((Math.random() - 0.5) * 25600);
			s[i].position = ps.position.add([x, y, z]);
			// displace it / them a bit. (If leave them VERY displaced, throws exceptions, I think.)
		}
	}
};

this.$returnShipToGroundZero_butPerhapsOffset = function() {
	if (!player.ship) {
		return;
	}
	if (Math.random() &gt; this.scenario_modified_chanceOffsetFromAction) {
		player.ship.position = [0, 0, 0];
		return;
	}
	// Otherwise ..
	var r, x, y, z;
	// this.$debugMessage(&quot;OFFSET&quot;);
	x = (Math.random() * 35000) + 2000;
	y = (Math.random() * 35000) + 2000;
	z = (Math.random() * 35000) + 2000;
	r = ~~(1 + (Math.random() * 8));
	switch (r) {
		case 1:
			x *= -1;
			break;
		case 2:
			y *= -1;
			break;
		case 3:
			z *= -1;
			break;
		case 4:
			x *= -1;
			y *= -1;
			break;
		case 5:
			x *= -1;
			y *= -1;
			z *= -1;
			break;
		case 6:
			y *= -1;
			z *= -1;
			break;
		case 7:
			x *= -1;
			z *= -1;
			break;
		default:
			break;
	}
	player.ship.position = [x, y, z];
};

this.$die_timed = function $die_timed() {
	// The above format, with its repetition of the function name, is right. See http://aegidian.org/bb/viewtopic.php?p=257147#p257147.
	this.$timerDelete_die();
	// Do not automatically delete it, because it might not be running; other things can call this.
	if (!player.ship) {
		return;
	}
	// Next two lines are to avoid auto-eject nonsense, etc.
	if (player.ship.equipmentStatus(&quot;EQ_AUTO_EJECT&quot;) === &quot;EQUIPMENT_OK&quot;) {
		player.ship.removeEquipment(&quot;EQ_AUTO_EJECT&quot;);
	}
	if (player.ship.equipmentStatus(&quot;EQ_EEU&quot;) === &quot;EQUIPMENT_OK&quot;) {
		player.ship.removeEquipment(&quot;EQ_EEU&quot;);
	}
	player.ship.explode();
};

this.$check_getSickOrIfDieFromIt = function() {
	if (this.willDie) {
		return;
	}
	if (this.isSick) {
		if (Math.random() &gt; this.sickness_chanceKills) {
			this.$messagePlayer(&quot;You still have WITCHSPACE SICKNESS. Dock at a main station! Do not jump!&quot;, 15);
			this.mySound_warning.play();
		} else {
			this.willDie = true;
			this.$messagePlayer(&quot;You have TERMINAL WITCHSPACE SICKNESS!&quot;, 15);
			this.mySound_warning.play();
		}
		return;
	}
	// Otherwise ..
	var r;
	if (this.OXP_wormDrones) {
		if ((missionVariables.mauiby_multipleJumps) &amp;&amp; (this.currentChanceOfSickness &gt; 0)) {
			r = this.currentChanceOfSickness / 1.7;
		} else {
			r = this.currentChanceOfSickness;
		}
	} else {
		r = this.currentChanceOfSickness;
	}
	// this.$debugMessage(&quot;Sickness chance: &quot;+r);
	if (Math.random() &lt; r) {
		this.isSick = true;
		this.$messagePlayer(&quot;You have developed WITCHSPACE SICKNESS. Jumping before docking at a main station may kill you!&quot;, 15);
		this.mySound_warning.play();
		this.currentChanceOfSickness = this.sickness_baseChanceOfGetting; // Let us, thusly, reset this here.
	}
};

this.$damageDrive = function() {
	if (!player.ship) {
		return;
	}
	if (player.ship.equipmentStatus(&quot;EQ_BREAKABLE_WITCHDRIVE&quot;) != &quot;EQUIPMENT_OK&quot;) {
		return;
	}
	player.ship.setEquipmentStatus(&quot;EQ_BREAKABLE_WITCHDRIVE&quot;, &quot;EQUIPMENT_DAMAGED&quot;);
};

this.$OXP_TCAT_override = function() {
	if (this.OXP_TCAT) {
		missionVariables.otherOXPs_TCAT_override = true;
		this.TACT_overrode = true;
	} else {
		this.TACT_overrode = false;
	}
};

this.$TCAT_reset = function() {
	if (this.TACT_overrode) {
		missionVariables.otherOXPs_TCAT_override = false;
		this.TACT_overrode = false;
	}
};

this.$OXP_Threat_restrict = function() {
	this.threatOXP_modify = true;
	// sic - and cannot change this variable name (without changing the Threat OXP)
};

this.$threatOXP_reset = function() {
	this.threatOXP_modify = false;
	// sic - and cannot change this variable name (without changing the Threat OXP)
};

this.$remove_removeMostThargoid = function() {
	var s;
	// this.$debugMessage(&quot;Removing non-bugs&quot;);
	if ((this.OXP_InterstellarHelp) &amp;&amp; (worldScripts.interstellar_help.interstellarHelp === &quot;FOLLOWING&quot;)) {
		s = system.filteredEntities(this, this.toRemove_nonThargoid_alt);
	} else {
		s = system.filteredEntities(this, this.toRemove_nonThargoid);
	}
	var i = s.length;
	while (i--) {
		s[i].remove(true);
	}
};

this.$interstellarShift_forNewScenario = function(x, y, z) {
	this.origin_newScenario = [x, y, z];
	// Vital. This is where this.origin_newScenario gets set, for the new scenario.
	this.$interstellarShiftCore();
};

this.$interstellarShift_forModifiedScenario = function() {
	this.$interstellarShiftCore();
};

this.$interstellarShiftCore = function() {
	// this.$debugMessage(&quot;Interstellar shift&quot;);
	if (!player.ship.isValid || !player.ship.position) {
		return;
	}
	player.ship.position = [350000000, 350000000, 350000000];
};


/*
======
TIMERS
======
*/

this.$timerDelete_all_exceptDie = function() {
	// Remove short interval timers before other timers.
	this.$timerDelete_returnEtc();
	this.$timerDelete_interstellarPostWillExit();
	this.$timerDelete_resched();
	this.$timerDelete_radiation();
	this.$timerDelete_checkAndActOnNavyFrigates();
	this.$timerDelete_stellar();
	this.$timerDelete_misjumpWarning();
	this.$timerDelete_thargAmbush();
};

this.$timerDelete_all = function() {
	this.$timerDelete_die();
	this.$timerDelete_all_exceptDie();
};

this.$timerDelete_radiation = function() {
	if (this.timer_radiationStageOne_damage1) {
		if (this.timer_radiationStageOne_damage1.isRunning) {
			this.timer_radiationStageOne_damage1.stop();
		}
		delete this.timer_radiationStageOne_damage1;
	}
	if (this.timer_radiationStageOne_damage2) {
		if (this.timer_radiationStageOne_damage2.isRunning) {
			this.timer_radiationStageOne_damage2.stop();
		}
		delete this.timer_radiationStageOne_damage2;
	}
	if (this.timer_radiationStageTwo) {
		if (this.timer_radiationStageTwo.isRunning) {
			this.timer_radiationStageTwo.stop();
		}
		delete this.timer_radiationStageTwo;
	}
};

this.$timerDelete_thargAmbush = function() {
	if (!this.timer_thargAmbush) {
		return;
	}
	if (this.timer_thargAmbush.isRunning) {
		this.timer_thargAmbush.stop();
	}
	delete this.timer_resched;
};

this.$timerDelete_resched = function() {
	if (!this.timer_resched) {
		return;
	}
	if (this.timer_resched.isRunning) {
		this.timer_resched.stop();
	}
	delete this.timer_resched;
};

this.$timerDelete_returnEtc = function() {
	if (!this.timer_returnEtc) {
		return;
	}
	if (this.timer_returnEtc.isRunning) {
		this.timer_returnEtc.stop();
	}
	delete this.timer_returnEtc;
};

this.$timerDelete_interstellarPostWillExit = function() {
	if (!this.timer_interstellarPostWillExit) {
		return;
	}
	if (this.timer_interstellarPostWillExit.isRunning) {
		this.timer_interstellarPostWillExit.stop();
	}
	delete this.timer_interstellarPostWillExit;
};

this.$timerDelete_checkAndActOnNavyFrigates = function() {
	if (!this.timer_checkAndActOnNavyFrigates) {
		return;
	}
	if (this.timer_checkAndActOnNavyFrigates.isRunning) {
		this.timer_checkAndActOnNavyFrigates.stop();
	}
	delete this.timer_checkAndActOnNavyFrigates;
};

this.$timerDelete_stellar = function() {
	if (!this.timer_stellar) {
		return;
	}
	if (this.timer_stellar.isRunning) {
		this.timer_stellar.stop();
		delete this.timer_stellar;
	}
};

this.$timerDelete_die = function() {
	if (!this.timer_die) {
		return;
	}
	if (this.timer_die.isRunning) {
		this.timer_die.stop();
	}
	delete this.timer_die;
};

this.$timerDelete_misjumpWarning = function() {
	if (!this.timer_misjumpWarning) {
		return;
	}
	if (this.timer_misjumpWarning.isRunning) {
		this.timer_misjumpWarning.stop();
	}
	delete this.timer_misjumpWarning;
};


/*
============================================================
10.	ENTITY-PICKERS (/filters) etc.
	NB: Breaking such lines for readability breaks the code!
============================================================
*/

this.$isHiredGun = function(e) {
	return e.isShip &amp;&amp; e.hasRole(&quot;hiredGuns_escort&quot;);
};

this.$isEscort = function(e) {
	return e.isShip &amp;&amp; (e.primaryRole === &quot;escort&quot; || e.primaryRole === &quot;escort-medium&quot; || e.primaryRole === &quot;escort-heavy&quot;);
};

this.$isAlien = function(e) {
	return e.primaryRole === &quot;kephalan&quot; || e.primaryRole === &quot;odonatean&quot; || e.primaryRole === &quot;scorpax&quot;;
};

// Function for telling whether item is in array.
this.$isArrayed = function(value, array) {
	return (worldScripts.IST_masterScript._index_in_list(value, array) &gt; -1);
};

this.$isBillboard = function(e) {
	return e.isShip &amp;&amp; e.hasRole(&quot;asteroid-billboard&quot;);
};

this.$isBug = function(e) {
	return e.isShip &amp;&amp; e.isThargoid;
};

this.$isInterstellarHelpee = function(e) {
	return e.primaryRole === &quot;interstellar_help_trader&quot;;
};

this.$isNavy = function(e) {
	return e.isShip &amp;&amp; (e.isPolice || e.scanClass === &quot;CLASS_MILITARY&quot;);
};

this.$isNavy_carrier = function(e) {
	return e.isShip &amp;&amp; (e.hasRole(&quot;behemoth&quot;) || e.hasRole(&quot;leviathan&quot;));
};

this.$isNavy_frigate = function(e) {
	return e.isShip &amp;&amp; e.primaryRole === &quot;navy-frigate&quot;;
};

this.$isThargoid_not = function(e) {
	return e.isShip &amp;&amp; !e.isThargoid;
};

this.$isThargoid_normal = function(e) {
	return e.isShip &amp;&amp; e.isThargoid &amp;&amp; e.primaryRole !== &quot;thargoidRebel&quot;;
};

this.$isThargoid_battleship = function(e) {
	return e.isShip &amp;&amp; e.isThargoid &amp;&amp; e.name === &quot;Thargoid Thargorn Battleship&quot;;
};
// Note: the battleship lacks a distinct role, so we have to use its name.

this.$NPCsToIrradiate = function(e) {
	return e.isShip &amp;&amp; !e.isPlayer;
};

this.$shipWeight_heavy = function(e) {
	return e.mass &gt;= 120000000;
};

this.$shipWeight_medium = function(e) {
	return e.mass &gt; 1200000 &amp;&amp; e.mass &lt; 120000000;
};

this.$toRemove_newScenario = function(e) {
	return e.isShip &amp;&amp; !e.isPlayer &amp;&amp; !e.hasRole(&quot;hiredGuns_escort&quot;) &amp;&amp; e.primaryRole !== &quot;interstellar_help_trader&quot; &amp;&amp; !e.hasRole(&quot;ecl_escape_pod_beacon&quot;) &amp;&amp; !e.hasRole(&quot;escape-capsule&quot;) &amp;&amp; !e.hasRole(&quot;uberBuggly&quot;) &amp;&amp; !e.hasRole(&quot;generationship&quot;);
};

this.$toRemove_nonNavy = function(e) {
	return e.isShip &amp;&amp; !e.isPlayer &amp;&amp; !e.isPolice &amp;&amp; e.scanClass !== &quot;CLASS_MILITARY&quot; &amp;&amp; !e.hasRole(&quot;IST_mil&quot;) &amp;&amp; !e.hasRole(&quot;spectre&quot;) &amp;&amp; !e.hasRole(&quot;IST_alien_cargopod&quot;) &amp;&amp; !e.hasRole(&quot;asteroid&quot;) &amp;&amp; !e.hasRole(&quot;IST_derelict&quot;) &amp;&amp; !e.hasRole(&quot;escape-capsule&quot;) &amp;&amp; !e.hasRole(&quot;uberBuggly&quot;) &amp;&amp; !e.hasRole(&quot;generationship&quot;) &amp;&amp; e.primaryRole !== &quot;IST_alloy&quot; &amp;&amp; e.primaryRole !== &quot;IST_Tharglet&quot; &amp;&amp; e.primaryRole !== &quot;IST_cargopod&quot; &amp;&amp; e.primaryRole !== &quot;hiredGuns_escort&quot; &amp;&amp; e.primaryRole !== &quot;ecl_escape_pod_beacon&quot;;
};

this.$toRemove_nonNavy_butKeepInterstellarHelpShip = function(e) {
	return e.isShip &amp;&amp; !e.isPlayer &amp;&amp; !e.isPolice &amp;&amp; e.scanClass !== &quot;CLASS_MILITARY&quot; &amp;&amp; !e.hasRole(&quot;IST_mil&quot;) &amp;&amp; !e.hasRole(&quot;spectre&quot;) &amp;&amp; !e.hasRole(&quot;IST_alien_cargopod&quot;) &amp;&amp; !e.hasRole(&quot;asteroid&quot;) &amp;&amp; !e.hasRole(&quot;IST_derelict&quot;) &amp;&amp; !e.hasRole(&quot;escape-capsule&quot;) &amp;&amp; !e.hasRole(&quot;uberBuggly&quot;) &amp;&amp; !e.hasRole(&quot;generationship&quot;) &amp;&amp; e.primaryRole !== &quot;IST_alloy&quot; &amp;&amp; e.primaryRole !== &quot;IST_Tharglet&quot; &amp;&amp; e.primaryRole !== &quot;IST_cargopod&quot; &amp;&amp; e.primaryRole !== &quot;hiredGuns_escort&quot; &amp;&amp; e.primaryRole !== &quot;ecl_escape_pod_beacon&quot; &amp;&amp; e.primaryRole !== &quot;interstellar_help_trader&quot;;
	// The last entry is how this function diverges from its other version.
};

this.toRemove_nonThargoid = function(e) {
	return e.isShip &amp;&amp; !(e.isPlayer || e.isThargoid || e.primaryRole === &quot;IST_Tharglet&quot; || e.primaryRole === &quot;hiredGuns_escort&quot; || e.primaryRole === &quot;IST_alloy&quot; || e.primaryRole === &quot;IST_alien_cargopod&quot; || e.primaryRole === &quot;IST_cargopod&quot;);
};

this.toRemove_nonThargoid_alt = function(e) {
	return e.isShip &amp;&amp; !(e.isPlayer || e.isThargoid || e.primaryRole === &quot;IST_Tharglet&quot; || e.primaryRole === &quot;hiredGuns_escort&quot; || e.primaryRole === &quot;IST_alloy&quot; || e.primaryRole === &quot;IST_alien_cargopod&quot; || e.primaryRole === &quot;IST_cargopod&quot; || e.primaryRole !== &quot;interstellar_help_trader&quot;);
};

this.$toRemove_radiationScenario = function(e) {
	return e.isShip &amp;&amp; !e.isPlayer &amp;&amp; !e.hasRole(&quot;hiredGuns_escort&quot;) &amp;&amp; e.energy &lt; 150;
};

this.$toRemove_radiationScenario_alt = function(e) {
	return e.isShip &amp;&amp; !e.isPlayer &amp;&amp; e.energy &lt; 150;
};


/*
=================
11. MISC ROUTINES
=================
*/

this.$thargAmbush_timed = function $thargAmbush_timed() {
	this.$timerDelete_thargAmbush();
	var r = Math.random();
	var s;
	var n = 1 + ~~(1 + (Math.random() * 6));
	if (this.OXP_extraThargoids &amp;&amp; (r &lt; 0.7)) {
		s = system.addShips(&quot;extraThargoids_buggly&quot;, n, this.origin_ambush, 8000);
	} else {
		s = system.addShips(&quot;thargoid&quot;, n, this.origin_ambush, 8000);
	}
};


// The &#39;no rings&#39; routines are not needed in the &#39;new scenario&#39;
// - because ships are added there far from the &#39;witchpoint&#39;.
this.$addShips_ringless = function(role, count, position, radius) {
	// this.$debugMessage(&quot;ADD SHIPS WITH NO RINGS&quot;);
	// Sanity (/argument) check.
	var i;
	if (count &lt; 1) {
		this.$error(&quot;Bad count argument &lt;&quot; + count + &quot;&gt; for function addShips_ringless&quot;);
		i = 1; // fix the problem.
	} else {
		i = count;
	}

	var offset, s;
	offset = new Vector3D([50000, 50000, 50000]);
	s = system.addShips(role, count, offset, radius);
	if (s == null) {
		return;
	}
	// Create ship at position &#39;offset&#39;, which far from WP.

	if (position == null) {
		if (this.debug) {
			this.$error(&quot;position is null: addShips_ringless&quot;);
		}
		return;
	}

	// Move the ships.
	offset = new Vector3D(position).subtract(offset);
	while (i--) {
		if (s[i].isValid) {
			s[i].position = s[i].position.add(offset);
			// move s to (position-to-have plus offset).
		}
	}
	return s;
};

// The following function seems unused. So, I have commented it out.
/*
this.$addGroup_ringless = function(role,count,position,radius) 
{
	var i;

	// Sanity (/argument) check.
	if (count &lt; 1) {
		this.$error(&quot;Bad count argument &lt;&quot; + count + &quot;&gt; for function $addGroup_ringless&quot;);
		i = 1; // fix the problem.
	} else {
		i = count;
	}

	var offset;
	var g;
	var s;
	// Create the ships
	offset = new Vector3.D([50000,50000,50000]);
	g = system.addGroup(role,count,offset,radius);
	s = g.ships;
	if (s == null) {return;}

	if (position == null) {
		if (this.debug) {this.$error(&quot;position is null: addGroup_ringless&quot;);}
		return;
	}

	// Move the ships.
	offset = new Vector3D(position).subtract(offset);
	while (i--) {
		if (s[i] &amp;&amp; s[i].isValid) {
			s[i].position=s[i].position.add(offset);
		}
	}
	return g;
};
*/

// The &#39;ring&#39; code below adapted from the YourAdHere expansion pack, by Dr Nil and contributors.
// But I am unsure it is working.

this.$addShips_rings = function(role, count, position, radius) {
	// this.$debugMessage(&quot;ADD SHIPS WITH RINGS&quot;);
	var i;

	// Sanity (/argument) check.
	if (count &lt; 1) {
		this.$error(&quot;Bad count argument &lt;&quot; + count + &quot;&gt; for function $addShips_rings&quot;);
		i = 1; // fix the problem.
	} else {
		i = count;
	}

	// Create the ships at near WP - so that they have rings.
	var s = system.addShips(role, count, [0, 0, 0], radius);

	if (position == null) {
		if (this.debug) {
			this.$error(&quot;position is null: addShips_rings&quot;);
		}
		return;
	}

	// Move the ships.
	while (i--) {
		if (s[i] &amp;&amp; s[i].isValid) {
			s[i].position = s[i].position.add(position);
		}
	}
	return s;
};

this.$roleExists = function(roleString) {
	var dummyShips = system.addShips(roleString, 1, [100000, 100000, 100000]);
	if (dummyShips == null) {
		return false;
	}
	var exists = (dummyShips.length == 1);
	if (exists) {
		if (dummyShips[0].isValid) {
			dummyShips[0].remove(true);
		}
	}
	return exists;
};


/*
============================
12.	ERROR &amp; MESSAGE HANDLING
============================
*/

this.$messagePlayer = function(txt, t) {
	if (this.debug) {
		if (!txt) {
			player.consoleMessage(&quot;Problem with message text!&quot;, 30);
			return;
		}
		if (!t) {
			player.consoleMessage(&quot;Problem with message time!&quot;, 30);
			return;
		}
		if (t &lt; 1) {
			player.consoleMessage(&quot;Problem with message time!&quot;, 30);
			return;
		}
	}
	player.consoleMessage(txt, t);
};

// THIS ROUTINE DOES NOTHING IF this.debug IS NOT TRUE.
this.$debugMessage = function(debugTxt) {
	if (!this.debug) {
		return;
	} // NB.
	// Otherwise ..
	if (!debugTxt) {
		player.consoleMessage(&quot;Problem with debug message text!&quot;, 30);
		return;
	}
	player.consoleMessage(&quot;Interstellar Tweaks - &quot; + debugTxt, 12);
	log(&quot;InterstellarTweaks - DEBUG&quot;, debugTxt);
};

this.$error = function(debugTxt) {
	if (!debugTxt) {
		player.consoleMessage(&quot;Problem with error message text!&quot;, 30);
		log(&quot;InterstellarTweaks - debugging: problem with error message text!&quot;);
		return;
	}
	if (this.debug) {
		player.consoleMessage(&quot;Interstellar Tweaks - ERROR: &quot; + debugTxt, 30);
	}
	log(&quot;InterstellarTweaks - debugging&quot;, debugTxt);
};


/*
======================================
13.		End of wrapper for JSHINT.
		See also Jshint options above.
======================================
*/

}).call(this);


// EOF</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/IST_pirate.js</td>
                    <td><pre>/*
========================================================================
IST_pirate.js
This file is part of the Interstellar Tweaks expansion pack.
Author: UK_Eliter
License: 2017 Creative Commons: attribution, non-commercial, sharealike.
========================================================================
*/


/*
====================
JSLINT: set options
====================
*/

/*jshint esversion: 6*/
/*jshint sub:true*/


this.name = &quot;IST_pirate.js&quot;;
this.author = &quot;UK_Eliter&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;
this.description = &quot;A ship script for the Interstellar Tweaks OXP&quot;;


/*
------------------
DEBUGGING SWITCHES
------------------
*/

// this.logging = true;

var consoleDebugMessages = false;
// Do NOT comment this out. Rather, to disable, set to false.

this.debug = false;
// false


/*
------------------------
JSLINT: start of wrapper
------------------------
*/

(function() {
	&quot;use strict&quot;;


	/*
	--------------
	EVENT HANDLERS
	--------------
	*/

	this.shipSpawned = function() {
		var r = Math.random();
		if (r &lt; 0.6) {
			// Try to replace a normal missile with a more interesting type.
			this.ship.removeEquipment(&quot;EQ_MISSILE&quot;);
			var missileDeficit = this.ship.missileCapacity - this.ship.missiles.length;
			if (worldScripts[&quot;CT_masterScript&quot;] !== undefined) {
				this.ship.awardEquipment(&quot;EQ_ARMOURY_CUTPURSE_MISSILE&quot;);
			} else {
				this.ship.awardEquipment(&quot;EQ_HARDENED_MISSILE&quot;);
			}
		}
		// Bounty
		if (r &gt; 0.2) {
			if (r &gt; 0.94) {
				this.ship.bounty = 50 + (r * Math.ceil(200));
			} else {
				this.ship.bounty = 7 + (r * Math.ceil(90));
			}
		}
		this.ship.script.$playerHasAttackedPirates = false;
		// this.$debugMessage(&quot;Set variable to &quot;+this.ship.script.$playerHasAttackedPirates);
		delete this.shipSpawned;
	};

	this.shipDied = this.entityDestroyed = this.playerWillEnterWitchspace = function() {
		this.$_deleteDetectDecloakTimer();
	};

	this.shipTakingDamage = function(amount, whom, type) {
		if (whom !== player.ship) {
			return;
		}
		// Else
		if (this.ship.script.$playerHasAttackedPirates === false) {
			this.ship.script.$playerHasAttackedPirates = true;
			// this.$debugMessage(&quot;Set variable to &quot;+this.ship.script.$playerHasAttackedPirates);
		}
	};

	this.shipBeingAttackedByCloaked = function() {
		// From the wiki: &#39;There is no parameter provided to identify the cloaked ship.&#39;
		if (!this.cloakedTarget) {
			this.cloakedTarget = system.filteredEntities(this, this.$isCloaked, this.ship, 25600)[0];
		}
		if (this.cloakedTarget &amp;&amp; this.cloakedTarget.isCloaked) {
			if (this.detectDecloakTimer) {
				if (!this.detectDecloakTimer.isRunning) {
					this.detectDecloakTimer.start();
				}
				// This shouldn&#39;t happen - because deleted after each use.
			} else {
				var num = 0.2 + Math.random();
				this.detectDecloakTimer = new Timer(this, $detectDecloakTimed, num, 2.65);
			}
		}
	};

	/*
	---------------------
	ROUTINES CALLED BY AI
	---------------------
	*/

	this.$_deleteDetectDecloakTimer = function $_deleteDetectDecloakTimer() {
		if (this.detectDecloakTimer) {
			if (this.detectDecloakTimer.isRunning) {
				this.detectDecloakTimer.stop();
			}
			delete this.detectDecloakTimer;
		}
	};

	// This function called by AI
	this.$_seekVictim = function() {
		if (!this.ship || !this.ship.isPiloted) {
			return;
		}
		var potentialTargets = system.filteredEntities(this, this.$isPotentialTarget, this.ship, 25600);
		var numPotentialTargets = potentialTargets.length;
		if (numPotentialTargets &lt; 1) {
			this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;);
			return;
			// No need to scan for dead tharglets, &#39;cos they&#39;ll be got via AI&#39;s SCAN_FOR_LOOT.
		}
		// Else
		var r = Math.random();
		if ((numPotentialTargets === 1) || (r &lt; 0.5)) {
			this.ship.target = potentialTargets[0];
		} else {
			if ((numPotentialTargets === 2) || (r &gt; 0.6)) {
				this.ship.target = potentialTargets[1];
			} else {
				this.ship.target = potentialTargets[2];
			}
		}
		this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
	};

	this.$_haveEngaged = function() {
		// Rationale: if this ship is attacking the player, then either this ship or a group-mate OKed it; since it might have been a group mate, tell THIS ship that the player is henceforth a target.
		if (this.ship.target !== player.ship) {
			return;
		}
		// Otherwise
		if (this.ship.script.$playerHasAttackedPirates === false) {
			this.ship.script.$playerHasAttackedPirates = true;
			// this.$debugMessage(&quot;Set variable to &quot;+this.ship.script.$playerHasAttackedPirates);
		}
	};


	/*
	--------------
	OTHER ROUTINES
	--------------
	*/

	this.$isCloaked = function(e) {
		return e.isShip &amp;&amp; e.isCloaked;
	};

	this.$isPotentialTarget = function(e) {
		return e.isShip &amp;&amp; !e.isCloaked &amp;&amp; e.isPiloted &amp;&amp; (((e.isPirateVictim || e.hasRole(&quot;hiredGuns_escort&quot;) || e.isPlayer || e.primaryRole === &quot;IST_lobster&quot;) &amp;&amp; (e.bounty &lt; 50 || e.primaryRole === &quot;IST_lobster&quot;)) || (e.isPlayer &amp;&amp; this.ship.script.$playerHasAttackedPirates));
	};
	// Cf. this.shipSpawned and this.shipTakingDamage

	this.$detectDecloakTimed = function() {
		if (!this.ship || !this.ship.isPiloted) {
			this.$_deleteDetectDecloakTimer();
			return;
		}
		if (!this.cloakedTarget || !this.cloakedTarget.isValid) {
			this.$_deleteDetectDecloakTimer();
			this.ship.reactToAIMessage(&quot;TARGET_LOST&quot;);
			return;
		}
		if (this.ship.position.distanceTo(this.cloakedTarget) &gt; 25600) {
			this.$_deleteDetectDecloakTimer();
			this.ship.reactToAIMessage(&quot;TARGET_LOST&quot;);
			return;
		}
		if (this.cloakedTarget.isCloaked) {
			return;
		} // keep checking
		this.$_deleteDetectDecloakTimer();
		this.ship.target = this.cloakedTarget;
		this.ship.reactToAIMessage(&quot;TARGET_DECLOAKED&quot;);
	};


	/*
	--------------
	DEBUGGING CODE
	--------------
	*/

	// this.$debugMessage = function(debugTxt)
	// {
	// 	if ( !this.debug ) { return; } // NB. THIS ROUTINE DOES NOTHING IF this.debug IS NOT TRUE
	// 	// else
	// 	if ( !debugTxt ) {
	// 		player.consoleMessage( &quot;Problem with debug message text!&quot;, 30 );
	// 		return;
	// 	}
	// 	player.consoleMessage( &quot;Interstellar Tweaks, PIRATES - &quot;+debugTxt, 12 );
	// 	log( &quot;InterstellarTweaks, PIRATES - debugging&quot;, debugTxt );
	// };


	/*
	----------------------
	JSHINT: end of wrapper
	----------------------
	*/

}).call(this);


// EOF</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/IST_thargoid.js</td>
                    <td><pre>/*
========================================================================
IST_thargoid.js
This file is part of the Interstellar Tweaks expansion pack.
Author: UK_Eliter
License: 2017 Creative Commons: attribution, non-commercial, sharealike.
========================================================================
*/



/*
====================
JSLINT: set options
====================
*/

/*jshint esversion: 6*/
/*jshint sub:true*/


this.name = &quot;IST_thargoid.js&quot;;
this.author = &quot;UK_Eliter&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;
this.description = &quot;A script for InterstellarTweaks OXP&quot;;


/*
------------------
DEBUGGING SWITCHES
------------------
*/

this.logging = false; // Corresponds to, or needs, settings in logcontrol.plist?
this.debug = false; // false
var consoleDebugMessages = false; // do NOT comment this out. Rather, to disable, set to false.


/*
------------------------
JSLINT: start of wrapper
-----------------------
*/

(function() {
	&quot;use strict&quot;;


	/*
	--------------
	EVENT HANDLERS
	--------------
	*/

	// Toggle out the following when not debugging.

	// this.shipSpawned = function() {
	// 	this.ship.reportAIMessages = true;
	// 	delete this.shipSpawned;
	// }


	/*
	---------------------
	ROUTINES CALLED BY AI
	---------------------
	*/

	this.$_findTarget = function() {
		var nearArray = system.filteredEntities(this, this.$isEligibleTarget, this.ship, 25600);
		// The above will exclude escorts marked as CLASS_ROCK. But if those attack the ship, it will respond.
		var l = nearArray.length;
		if (l &gt; 0) {
			if (l &gt; 1) {
				var targetNumber = ~~(Math.random() * l);
				// if ( targetNumber &gt; l ) {
				// 	log( this.name + &quot; script ERROR, target number too high - please report.&quot; );
				// 	targetNumber = 0;
				// }
				this.ship.target = nearArray[targetNumber];
			} else {
				this.ship.target = nearArray[0];
			}
			if (Math.random() &lt; 0.2) {
				this.$cursePlayer();
			}
			this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
			return;
		}
		// Otherwise
		var farArray = system.filteredEntities(this, $isEligibleTarget, this.ship, 75000);
		if (farArray.length &gt; 0) {
			if (Math.random() &lt; 0.1) {
				this.$cursePlayer();
			}
			this.ship.target = farArray[0]; // set to the closest target off-scanner but in range
			this.ship.reactToAIMessage(&quot;INTERCEPT&quot;);
		} else {
			this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;);
		}
	};

	this.$_validateAttackerAsTarget = function() {
		if (this.ship.target &amp;&amp; this.ship.target.isValid &amp;&amp; this.$isEligibleTarget(this.ship.target)) {
			this.ship.reactToAIMessage(&quot;TARGET_VALID&quot;);
		} else {
			this.ship.reactToAIMessage(&quot;TARGET_INVALID&quot;);
		}
	};


	/*
	---------------
	OTHER FUNCTIONS
	---------------
	*/

	this.$isEligibleTarget = function(e) {
		return !e.isCloaked &amp;&amp; ((e.isPlayer &amp;&amp; !e.docked) || (e.isShip &amp;&amp; e.ispiloted &amp;&amp; (!e.isThargoid || e.primaryRole === &quot;thargoidRebel&quot;)));
	};

	this.$cursePlayer = function() {
		this.ship.commsMessage(expandDescription(&quot;[thargoid_curses]&quot;, player.ship));
	};


	/*
	---------
	DEBUGGING
	---------
	*/

	// this.$debugMessage = function( debugTxt )
	// {
	// 	if (!this.debug) { return; } // NB. THIS ROUTINE DOES NOTHING IF this.debug IS NOT TRUE
	// 	// else
	// 	if ( !debugTxt ) {
	// 		player.consoleMessage( &quot;Problem with debug message text!&quot;, 30 );
	// 		return;
	// 	}
	// 	player.consoleMessage( &quot;Interstellar Tweaks - &quot;+debugTxt, 12 );
	// 	log( &quot;InterstellarTweaks - debugging&quot;, debugTxt );
	// };


	/*
	----------------------
	JSHINT: end of wrapper
	----------------------
	*/

}).call(this);


// EOF</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/IST_thargoidDefenceShip.js</td>
                    <td><pre>/*
========================================================================
IST_thargoidDefenceShip.js
This file is part of the Interstellar Tweaks expansion pack.
Author: UK_Eliter
License: 2017 Creative Commons: attribution, non-commercial, sharealike.
========================================================================
*/


/*
====================
JSLINT: set options
====================
*/

/*jshint esversion: 6*/
/*jshint sub:true*/


this.name = &quot;IST_thargoidDefenceShip.js&quot;;
this.author = &quot;UK_Eliter&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;
this.description = &quot;A script for InterstellarTweaks OXP&quot;;


/*
------------------
DEBUGGING SWITCHES
------------------
*/

this.logging = false; // Corresponds to, or needs, settings in logcontrol.plist?
this.debug = false; // false
var consoleDebugMessages = false; // do NOT comment this out. Rather, to disable, set to false.


/*
------------------------
JSHINT: start of wrapper
------------------------
*/

(function() {
	&quot;use strict&quot;;


	/*
	--------------
	EVENT HANDLERS
	--------------
	*/

	// Toggle out the following when not debugging.

	// this.shipSpawned = function() {
	// 	this.ship.reportAIMessages = true;
	// 	delete this.shipSpawned;
	// }


	/*
	---------------------
	ROUTINES CALLED BY AI
	---------------------
	*/

	this.$_findTarget = function() {
		var nearArray = system.filteredEntities(this, this.$isEligibleTarget, this.ship, 25600);
		// The above will exclude escorts marked as CLASS_ROCK. But if those attack the ship, it will respond.
		var l = nearArray.length;
		if (l &gt; 0) {
			if (l &gt; 1) {
				var targetNumber = ~~(Math.random() * l);
				// if ( targetNumber &gt; l ) {
				// 	log(this.name + &quot; script ERROR, target number too high - please report.&quot;);
				// 	targetNumber = 0;
				// }
				this.ship.target = nearArray[targetNumber];
			} else {
				this.ship.target = nearArray[0];
			}
			this.$cursePlayer();
			this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
			return;
		}
		// Otherwise
		var farArray = system.filteredEntities(this, $isEligibleTarget, this.ship, 75000);
		if (farArray.length &gt; 0) {
			this.ship.target = farArray[0]; // set to the closest target off-scanner but in range
			this.ship.reactToAIMessage(&quot;INTERCEPT&quot;);
		} else {
			this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;);
		}
	};

	this.$_validateAttackerAsTarget = function() {
		if (this.ship.target &amp;&amp; this.ship.target.isValid &amp;&amp; this.$isEligibleTarget(this.ship.target)) {
			this.ship.reactToAIMessage(&quot;TARGET_VALID&quot;);
		} else {
			this.ship.reactToAIMessage(&quot;TARGET_INVALID&quot;);
		}
	};


	/*
	---------------
	OTHER FUNCTIONS
	---------------
	*/

	this.$isEligibleTarget = function(e) {
		return !e.isCloaked &amp;&amp; ((e.isPlayer &amp;&amp; !e.docked) || (e.isShip &amp;&amp; e.ispiloted &amp;&amp; (!e.isThargoid || e.primaryRole === &quot;thargoidRebel&quot;)));
	};

	this.$cursePlayer = function() {
		this.ship.commsMessage(expandDescription(&quot;[thargoid_curses]&quot;, player.ship));
	};


	/*
	---------
	DEBUGGING
	---------
	*/

	// this.$debugMessage = function(debugTxt)
	// {
	// 	if (!this.debug) { return; } // NB. THIS ROUTINE DOES NOTHING IF this.debug IS NOT TRUE
	// 	// else
	// 	if ( !debugTxt ) {
	// 		player.consoleMessage( &quot;Problem with debug message text!&quot;, 30 );
	// 		return;
	// 	}
	// 	player.consoleMessage( &quot;Interstellar Tweaks - &quot;+debugTxt, 12 );
	// 	log( &quot;InterstellarTweaks - debugging&quot;, debugTxt );
	// };



	/*
	----------------------
	JSHINT: end of wrapper
	----------------------
	*/

}).call(this);


// EOF</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/IST_thargoidRebel.js</td>
                    <td><pre>/*
========================================================================
IST_thargoidRebel.js
This file is part of the Interstellar Tweaks expansion pack.
Author: UK_Eliter
License: 2017 Creative Commons: attribution, non-commercial, sharealike.
========================================================================
*/


/*
--------------------
JSHINT: set options
--------------------
*/

/*jshint esversion: 6*/
/*jshint sub:true*/



this.name = &quot;IST_thargoidRebel.js&quot;;
this.author = &quot;UK_Eliter&quot;;
this.copyright = &quot;2014 Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.licence = &quot;CC-NC-SA 3&quot;;
this.description = &quot;A script for InterstellarTweaks OXP&quot;;


/*
------------------
DEBUGGING SWITCHES
------------------
*/

// this.logging = true;
var consoleDebugMessages = false;
// do NOT comment out the above line. Rather, to disable, set to false.


/*
------------------------
JSHINT: start of wrapper
------------------------
*/

(function() {
	&quot;use strict&quot;;


	/*
	---------
	MAIN CODE
	---------
	*/

	// The AI ensures that a rebel ship can never use its own drive to enter normal space.
	// But rebels can enter each others&#39; wormwholes and thereby (despite the above) enter normal space. Hence this function.
	this.shipSpawned = function() {
		// Fix witchspace.
		this.ship.scriptedMisjump = true;
		delete this.shipSpawned;
	};


	this.$targetShips = function(e) {
		return e.isShip &amp;&amp; e.isThargoid &amp;&amp; !e.isCloaked &amp;&amp; e.primaryRole !== &quot;thargoidRebel&quot;;
	};

	this.$thargoidAIfindEnemy = function() {
		var nearArray = system.filteredEntities(this, this.$targetShips, this.ship, 25600);
		if (nearArray.length &gt; 0) {
			var targetNumber = ~~(Math.random() * nearArray.length);
			this.ship.target = nearArray[targetNumber];
			this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
			return;
		}
		var farArray = system.filteredEntities(this, $targetShips, this.ship, 60000);
		if (farArray.length &gt; 0) {
			this.ship.target = farArray[0]; // set to the closest target off-scanner but in range.
			this.ship.reactToAIMessage(&quot;INTERCEPT_TARGET&quot;);
		} else {
			this.ship.reactToAIMessage(&quot;NO_TARGET_FOUND&quot;);
		}
	};

	this.$validateTarget = function() {
		if (!this.ship.target || !this.ship.target.isValid || this.ship.target.isCloaked) {
			this.ship.reactToAIMessage(&quot;TARGET_INVALID&quot;);
			return;
		}
		if (this.ship.target.isThargoid &amp;&amp; this.ship.target.primaryRole != &quot;thargoidRebel&quot;) {
			this.ship.reactToAIMessage(&quot;TARGET_VALID&quot;);
			return;
		}
		if (this.ship.target.isPolice || this.ship.target.scanClass == &quot;CLASS_MILITARY&quot;) {
			this.ship.reactToAIMessage(&quot;TARGET_GALCOP&quot;);
			return;
		}
		this.ship.reactToAIMessage(&quot;TARGET_INVALID&quot;);
	};


	/*
	----------------------
	JSLINT: end of wrapper
	----------------------
	*/

}).call(this);


// EOF</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
