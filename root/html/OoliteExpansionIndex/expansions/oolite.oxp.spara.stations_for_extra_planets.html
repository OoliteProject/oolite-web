<html>
    <head>
        <title>Expansion Stations for Extra Planets Base</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Stations for Extra Planets Base</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">1 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>http://wiki.alioth.net/index.php/Stations%20for%20Extra%20Planets%20Base -&gt; 404 Not Found</li>
                <li>Low hanging fuit: Information URL exists...</li>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER S)(&#39;[]&#39; vs &#39;[stations]&#39;)</li>
                <li>Required Expansions mismatch between OXP Manifest and Expansion Manager at character position 0077 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds stations to extra planets with atmosphere. Requires Additional Planets oxp and at least one station pack.</td>
                    <td>Adds stations to extra planets with atmosphere. Requires Additional Planets oxp and at least one station pack.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.spara.stations_for_extra_planets</td>
                    <td>oolite.oxp.spara.stations_for_extra_planets</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Stations for Extra Planets Base</td>
                    <td>Stations for Extra Planets Base</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Dockables</td>
                    <td>Dockables</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>spara</td>
                    <td>spara</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.0.1</td>
                    <td>2.0.1</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>stations</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.spara.additional_planets_sr_base:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.spara.additional_planets_sr_base:</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Stations_for_Extra_Planets">http://wiki.alioth.net/index.php/Stations_for_Extra_Planets</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/6/66/Sfep_base_2.0.1.oxz">https://wiki.alioth.net/img_auth.php/6/66/Sfep_base_2.0.1.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873321</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/sfep_template.html">sfep_template</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;stations_for_extra_planets&quot;;
this.description = &quot;populator for extra stations&quot;;

/*
Dear oxp developer, it&#39;s totally possible to dynamically add stations to the mix. Just follow these instructions and all is well.

_Adding stations to the mix_

-decide which of your stations are coriolis, dodo and ico equivalents.
-create an array of arrays [[],[],[]] holding the rolenames of your stations so that in the first array there are your coriolises, in the second one dodos and in the third one icos.
-add your stations to the mix by calling worldScripts[&quot;stations_for_extra_planets&quot;].$addStations(array_of_arrays_of_your_stations) during startUp.
*/

this.$corStations = [];
this.$dodStations = [];
this.$icoStations = [];

this.startUp = function() {
	//register stations to have default markets of new cargoes
	if (worldScripts.CargoTypeExtension)
		worldScripts[&quot;CargoTypeExtension&quot;].registerOXPStation(&quot;CargoTypeExtension-DefaultMarket&quot;,&quot;sfep_station&quot;);
};

//public function for other oxps to add their stations to the oxp during the startUp. newStations-parameter is an array of three arrays [[],[],[]]. One for coriolises, one for dodos and one for icos.
this.$addStations = function(newStations) {
	this.$corStations = this.$corStations.concat(newStations[0]);
	this.$dodStations = this.$dodStations.concat(newStations[1]);
	this.$icoStations = this.$icoStations.concat(newStations[2]);
}

//sort sets once
this.$runOnce = function() {
	this.$corStations.sort();
	this.$dodStations.sort();
	this.$icoStations.sort();
	//just to make sure no-one touches the critical arrays after the startUp.
	delete this.$addStations;
	delete this.$runOnce;
}

//additional planets oxp calls this at the start of the populate.
this.initStationArray = function() {
	if (this.$runOnce) this.$runOnce();
	//match extra stations&#39; types to main station type.
	if (system.techLevel &lt; 11)
		this.$stations = this.$corStations.concat();
	else
		this.$stations = this.$corStations.concat(this.$dodStations, this.$icoStations);
}

//public function to set station populator. Call with planet coordinates and radius
this.setStationPopulator = function(coords, radius, index) {
	//sanity check of the array
	if (this.$stations.length === 0) return;

	//choose station
	var stationInd = Math.floor(system.scrambledPseudoRandomNumber(coords[0]) * this.$stations.length);

	//check station validator for possible deaths.
	if (worldScripts.station_validator &amp;&amp; (worldScripts.station_validator.$deaths(this.$stations[stationInd]).length !== 0))
		return;

	//add station to a random location around the planet
	var polar = Math.PI * system.scrambledPseudoRandomNumber(coords[0]);
	var azimuth = 2.0 * Math.PI * system.scrambledPseudoRandomNumber(coords[1]);
	var directionV = Vector3D(Math.sin(polar) * Math.cos(azimuth), Math.sin(polar) * Math.sin(azimuth), Math.cos(polar));

	//prevent the same station appearing multiple times in one system
	var stationRole = this.$stations.splice(stationInd, 1);

	system.setPopulator(&quot;sfep_&quot;+ (coords[0] + coords[1]), {
		callback: function(pos) {
			var addedStation = system.addShips(stationRole, 1, pos, 0)[0];

			//orientate station dock to the planet just like main station
			var targetVector = coords.subtract(pos ).direction();
			var angle = addedStation.heading.angleTo(targetVector);
			var cross = addedStation.heading.cross(targetVector).direction();
			addedStation.orientation = addedStation.orientation.rotate(cross, -angle);

			//add navigation buoy
			var addedBuoy = system.addShips(&quot;buoy&quot;, 1, addedStation.position.add(addedStation.heading.multiply(10E3)),0)[0];
			addedBuoy.scanClass = &quot;CLASS_BUOY&quot;;
			addedBuoy.displayName = addedStation.displayName + &quot; Buoy&quot;;
			addedBuoy.beaconCode = &quot;N - &quot; + addedBuoy.displayName;
			addedBuoy.beaconLabel = addedStation.displayName;
			//Cheyd&#39;s buoy has some special ai_code in it and needs to be excluded.
			if (!addedBuoy.hasRole(&quot;DHINavBuoy&quot;)) {
				addedBuoy.setAI(&quot;buoyAI.plist&quot;);
				addedBuoy.reactToAIMessage(&quot;START_TUMBLING&quot;);
			}
		}.bind(this),
		location: &quot;COORDINATES&quot;,
		coordinates: coords.add(directionV.multiply(2 * radius)),
		deterministic: true,
		priority: 102
	});
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/sfep_market.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;sfep-market&quot;;
this.author = &quot;spara&quot;;


this.updateLocalCommodityDefinition = function(goodDefinition, station) {

	var distance = station.position.distanceTo(system.mainStation);
	
	//scale max price difference with distance
	//1000 km -&gt; 0.05, 5000 km -&gt; 0.15
	var maxPriceDiff = 0.000000025 * distance + 0.025;
	var priceDiff = Math.random() * maxPriceDiff;
	
	//cheaper or more expensive?
	var coinToss = Math.round(Math.random());
	if (coinToss === 0)  var priceMultiplier = 1 - priceDiff;
	else var priceMultiplier = 1 + priceDiff;
	
	goodDefinition.price *= priceMultiplier;
	
	//scale quantity with random +/- 100 % scale
	
	var quantityDiff = Math.random();
	var coinToss = Math.round(Math.random());
	if (coinToss === 0) var quantityMultiplier = 1 - quantityDiff;
	else var quantityMultiplier = 1 + quantityDiff;
	
	goodDefinition.quantity = Math.round(quantityMultiplier * goodDefinition.quantity);

	return goodDefinition;
};
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
