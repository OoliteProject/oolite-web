<html>
    <head>
        <title>Expansion Deposed</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Deposed</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">5 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">4 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>License not specified</li>
                <li>XML Manifest found</li>
                <li>Unknown key &#39;licence&#39; in XML manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>This is a series of missions starting in galaxy 4. Needs 1700 kills to start.</td>
                    <td>This is a series of missions starting in galaxy 4. Needs 1700 kills to start.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.CmdrWombat.Deposed</td>
                    <td>oolite.oxp.CmdrWombat.Deposed</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Deposed</td>
                    <td>Deposed</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Missions</td>
                    <td>Missions</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Cmdr. Wombat</td>
                    <td>Cmdr. Wombat</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.4</td>
                    <td>1.4</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Deposed_OXP">http://wiki.alioth.net/index.php/Deposed_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/8/84/Deposed_1.4.oxz">https://wiki.alioth.net/img_auth.php/8/84/Deposed_1.4.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873351</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Deposed'>http://wiki.alioth.net/index.php/Deposed</a></p>
        <h3>README.txt</h3>
        <pre>Deposed
=======
v.1.4.0, XXXX 2013.

by Cmdr. Wombat
(revisions by Eric Walch and Commander McLane)


Requirements:

Version 1.77 (or higher) of Oolite is required.


To install:

Move the deposed.oxp file into the AddOns folder in your Oolite folder. The Oolite folder is where the Oolite program resides. The deposed.oxp file is in the Deposed folder along with this README.txt file. DO NOT move the entire Deposed folder into the AddOns folder - you only need the deposed.oxp folder. (Seen as a single file on Mac systems)


Description:

This is a series of Oolite missions connected by a plot of sorts. The plot is not resolved, leaving open the possibility that I, or someone else, will write a sequel series of missions. I have borrowed liberally from various threads on the Oolite bulletin board. Hopefully no one will be offended if they see something they suggested at some point.

These missions start in Galaxy 4. There are no prior mission requirements, but the Naval energy unit from the Thargoid mission could come in handy. For the mission series to start you need ~1700 kills and must be docked at a station. Your location in Galaxy 4 is not important. Note that there are slightly different plot threads in Deposed depending upon your legal status when you start.

It doesn&#39;t matter whether you have completed the Nova mission or not. I tried to tailor parts of the scripts to handle both possibilities. However, it is important that you don&#39;t start the Nova mission part way through this series unless you have no interest in completing the series, or are happy to make your way back to Galaxy 4. There is a point towards the end of the Deposed series where you will trigger the Nova mission if you haven&#39;t already done it - that&#39;s okay, it&#39;s planned to happen that way.


v.1.4.0 Released xxxx 2013 by Eric Walch
- Converted all legacy scripts into JavaScript. 
- The hints for the blackwidows location are no longer on the Systemdata screen (F7) but at the new Interface screen (F4).
- Tuned down the strength of some ships in the first battle as they became stronger through changes in Oolite since Deposed&#39;s original release.
- Tuned up the ship strength of the 2nd and 3th battles, as they seemed to weak in comparison to the first one.
- Added some mission info strings with mission updates.
- The code disables itself after the mission ended, so it does not waste cpu power if the player does not remove the oxp.
- Raised minimum Oolite version to 1.77 to use of the new Interface screen.

v.1.3.4 Released March 2009 by Eric Walch
- Added mission destinations on the long range map.
- Fixed one missing short description.
- Replaced tarantaluaAI.plist by pirateAI.plist. tarantaluaAI was an exact copy of the old oolite 1.55 pirateAI. That AI evolved, so better use always the current pirateAI.
- For three missions the target ships were only added on entering the system by a jump, but not when loading a saved game in that system. Fixed now.

v.1.3.3 Released August 2008 by Commander McLane
- Fixed a bug that would not recognize the elimination of the tarantula or the drug factory.

v.1.3.2 Released February 2008 by Commander McLane
- Fixed a bug that would not recognize the elimination of the three blackwidows.

v.1.3.1 Released January 2008 by Commander McLane
- Fixed a bug that lead to entering in a loop when the mission is first offered.

v.1.3 Released January 2008 by Commander McLane
Made two changes to avoid clashes with other OXPs, and three cosmetic changes:
- Inserted queries before bringing up mission screens according to the method proposed by Eric Walch (see http://wiki.alioth.net/index.php/OXP_mission_offering).
- Changed file-names to make them more unique.
- Inserted a reset of all mission_variables except mission_deposed on finishing the OXP, in order to clean out the save-file.
- Inserted a missing condition-clause on refusal of the initial offering. In this case mission_deposed is set to NOT_PLAYED. No further offers are made.
- Fixed typos in the missiontexts.
- Raised minimum requirement to Oolite 1.65, because I&#39;m not sure when &#39;oneof&#39; was introduced in conditions. I guess there are not many players left who use versions prior to 1.65, anyway.

v.1.2.1 Released 29th December 2007.
Additions by Eric Walch: 
Restructuring the scripting for faster code handling.
Added code to make it compatible with the nova mission. It is advisable to do this mission before you encountered the native nova mission. Starting deposed after the nova mission leaves a possibility that deposed has no ending (removed spoiler about this from the readme file).

v.1.2 Released June 2006.
In response to various pieces of equipment now available to players, I have made some of the opponents encountered in Deposed a little tougher.

v.1.1.1 Released March 2006.
Minor AI bug fix (thanks again to Rxke).

v.1.1 Released March 2006.
Minor bug fixes (thanks Rxke for unearthing them!).

v.1.0 Released May 2005.

Disclaimer:

Feel free to copy, share, alter, mutilate or do whatever you like with these scripts. If there are elements you want to use in your own expansion packs, go right ahead. However, selling or otherwise profiting from them is simply not on. Don&#39;t do it.

If you find any bugs, and there are sure to be some, please send me all the gory details in a Private Message  to Cmdr. Wombat on the Oolite bulletin board. Alternatively, simply make a post there detailing the problem. Note that I am in no way responsible for any clashes with existing or future Oolite expansion packs, although this was play tested without issue with most of the expansion packs from Oosat (up to April, 2005) installed and with Oolite version 1.46 up to 1.48.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/deposed-asp.html">Peldorian Asp</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/deposed-bien.html">Bien Naval Interceptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/deposed-blackwidow.html">Black Widow</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/deposed-medical-drug-factory.html">Drug Factory</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/deposed-tarantula.html">Tarantula</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/deposed-blackwidow.js</td>
                    <td><pre>this.name      = &quot;deposed-blackwidow&quot;; 
this.author    = &quot;eric walch&quot;; 
this.copyright = &quot;&quot;;
this.description = &quot;ship script for Deposed&quot;;
this.version   = &quot;1.0&quot;;

/*  The original ships had military aft lasers. But, with the original Oolite they only fired once
	during a fly-away run. They are now replaced with pulse lasers, that are still more dangerous
	than the military ones in the Oolite version during the original oxp development.
*/

this.shipSpawned = function ()
{
	if (player.score &lt; 2560)
	{
		// Make the mission easier for players when less than Deadly
        // Minimum score to start this part of the mission is 1823
        this.ship.removeEquipment(&quot;EQ_SHIELD_ENHANCER&quot;);
	}
    if (this.ship.accuracy &lt; 0) this.ship.accuracy *= -1; // exclude the stupid versions.
};


this.shipDied = function () {
    // don&#39;t check who killed the ship.
	if (this.ship.primaryRole == &quot;deposed-blackwidow1&quot;) missionVariables.depblk1 = &quot;DESTROYED&quot;;
	if (this.ship.primaryRole == &quot;deposed-blackwidow2&quot;) missionVariables.depblk2 = &quot;DESTROYED&quot;;
	if (this.ship.primaryRole == &quot;deposed-blackwidow3&quot;) missionVariables.depblk3 = &quot;DESTROYED&quot;;
    
	if (missionVariables.depblk1 == &quot;DESTROYED&quot; 
        &amp;&amp; missionVariables.depblk2 == &quot;DESTROYED&quot; 
        &amp;&amp; missionVariables.depblk3 == &quot;DESTROYED&quot;) {
        mission.setInstructionsKey(&quot;deposed2_desc2b&quot;, &quot;deposed&quot;);
        worldScripts.deposed.$markSystem(83);
        worldScripts.deposed.$unmarkSystem(10);
	}
};

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/deposed-medical-drug-factory.js</td>
                    <td><pre>this.name      = &quot;deposed-medical-drug-factory&quot;; 
this.author    = &quot;eric walch&quot;; 
this.copyright = &quot;&quot;;
this.description = &quot;ship script for Deposed&quot;;
this.version   = &quot;1.0&quot;;

this.shipBeingAttacked = function (who) {
    if (this.ship.missiles.length &gt; 0)  this.ship.fireMissile();
}

this.shipDied = function () {
	missionVariables.depdrug = &quot;DESTROYED&quot;;
    worldScripts.deposed.$markSystem(83);
    worldScripts.deposed.$unmarkSystem(111);
    mission.setInstructionsKey(&quot;deposed2_desc4b&quot;, &quot;deposed&quot;);
};

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/deposed-tarantula.js</td>
                    <td><pre>this.name      = &quot;deposed-tarantula&quot;; 
this.author    = &quot;eric walch&quot;; 
this.copyright = &quot;&quot;;
this.description = &quot;ship script for Deposed&quot;;
this.version   = &quot;1.0&quot;;


this.shipSpawned = function () {

    var missilesAvailable = [&quot;EQ_MISSILE&quot;, &quot;EQ_MISSILE&quot;, &quot;EQ_HARDENED_MISSILE&quot;]; //33% are hardheads
    var missileCount = missilesAvailable.length;
    var capacity = this.ship.missileCapacity;
    var start = this.ship.missiles.length; // should be zero.
    
    for (var i=start; i &lt; capacity; i++) {
    	// The ship is defined with an empty missile bay, now fill the bay randomly with above missiles
        this.ship.awardEquipment(missilesAvailable[Math.floor(Math.random() * missileCount)]);
    }    
};


this.shipDied = function () {
	missionVariables.deptaran = &quot;DEAD&quot;;
    worldScripts.deposed.$markSystem(83);
    worldScripts.deposed.$unmarkSystem(255);
    mission.setInstructionsKey(&quot;deposed2_desc3b&quot;, &quot;deposed&quot;);
};
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/deposed.js</td>
                    <td><pre>this.name        = &quot;deposed&quot;; 
this.author      = &quot;Cmdr. Wombat, JS translation by Eric Walch&quot;; 
this.description = &quot;Script used for the Deposed mission.&quot;; 
this.version     = &quot;1.4.0&quot;; 

this.startUp = function() {
	var deposed = missionVariables.deposed;
    if (deposed == &quot;MISSION_COMPLETE&quot; || deposed == &quot;ABANDONED&quot; || deposed == &quot;NOT_PLAYED&quot;) {
        // mission is over, no need to evaluate any code in the future.
        this.$clearHandlers();
    }
    this.firstLaunch = true;
};

this.missionScreenOpportunity = function () {
    var deposed = missionVariables.deposed;
    if (player.ship.dockedStation.isMainStation &amp;&amp; galaxyNumber == 3) {

        if (!deposed &amp;&amp; !missionVariables.deposed_started &amp;&amp; player.score &gt; 1693) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed_teaser&quot;, choicesKey: &quot;deposed_bien&quot;},
                function (choice) {
                if (choice == &quot;YES&quot;) {
                    missionVariables.deposed = &quot;PRELUDE&quot;;
                    missionVariables.depask = &quot;DRILE&quot;;
                    missionVariables.depbien = &quot;OKAY&quot;;
                    missionVariables.deposed_started = &quot;YES&quot;;
                    mission.setInstructionsKey(&quot;deposed_desc0&quot;);
                    this.$markSystem(11);
                }
                if (choice == &quot;NO&quot;) {
                    missionVariables.deposed = &quot;NOT_PLAYED&quot;;
                    this.$missionEnded();
                }
            });
        }

        if (system.ID == 11 &amp;&amp; deposed == &quot;PRELUDE&quot;) {
            this.$unmarkSystem(11);
            missionVariables.deposed = &quot;PART1_1&quot;;
            missionVariables.depbien = &quot;BUGGERED&quot;;
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed_part1_1&quot;});
            if (player.bounty == 0){
                missionVariables.depstat = &quot;CLEAN&quot;;
            } else if (player.bounty &gt; 31) {
                missionVariables.depstat = &quot;FUGITIVE&quot;;
            } else {
                missionVariables.depstat = &quot;OFFENDER&quot;;
            };
            this.$markSystem(119);
            mission.setInstructionsKey(&quot;deposed_desc1&quot;);
        }
        
        if (system.ID == 119 &amp;&amp; deposed == &quot;PART1_1&quot;) {
            this.$unmarkSystem(119);
            missionVariables.deposed = &quot;PART1_2&quot;;
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed_part1_2&quot;});
            this.$markSystem(42);
            mission.setInstructionsKey(&quot;deposed_desc2&quot;);
        }
        
        if (system.ID == 42 &amp;&amp; deposed == &quot;PART1_2&quot;) {
            this.$unmarkSystem(42);
            missionVariables.deposed = &quot;PART1_3&quot;;
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed_part1_3&quot;});
            player.credits += 5000;
            mission.setInstructionsKey(null);
        }
        
        if (system.ID != 42 &amp;&amp; deposed == &quot;PART1_3&quot; &amp;&amp; system.pseudoRandom100 &gt; 80) {
            // the random value excludes all systems in 7LY range. Edbire is probably the closest system
            var missiontext;
            if (missionVariables.depstat == &quot;CLEAN&quot;){
                missionVariables.deposed = &quot;PART1_4&quot;;
                missionKey = &quot;deposed_part1_4c&quot;
            } else if (missionVariables.depstat == &quot;OFFENDER&quot;){
                missionVariables.deposed = &quot;PART1_4&quot;;
                missionKey = &quot;deposed_part1_4o&quot;;
                player.bounty |= 5;
            } else { // = FUGITIVE
                missionVariables.deposed = &quot;PART1_6A&quot;;
                missionKey = &quot;deposed_part1_4f&quot;;
                player.bounty |= 90;
            }
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: missionKey, background: &quot;deposed_iNews.png&quot;});
        }
        
        if (deposed == &quot;PART1_4&quot; &amp;&amp; missionVariables.depask == &quot;DRILE&quot; &amp;&amp; system.pseudoRandom100 &lt; 20) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed_part1_5&quot;, background: &quot;deposed_GalCop.png&quot;, choicesKey: &quot;deposed_galcop&quot;},
                function (choice) {
                if (choice == &quot;YES&quot;) {
                    missionVariables.deposed = &quot;PART1_5A&quot;;
                    mission.setInstructionsKey(&quot;deposed_desc3&quot;);
                    this.$markSystem(197);
                }
                if (choice == &quot;NO&quot;) {
                    missionVariables.deposed = &quot;PART1_6A&quot;;
                    missionVariables.depstat = &quot;FUGITIVE&quot;;
                }
                missionVariables.depask = &quot;ZSKTHAK&quot;;
            });
        }
		
        if (system.ID == 197 &amp;&amp; deposed == &quot;PART1_5&quot;) {
            var missionKey;
            if (missionVariables.depstat == &quot;CLEAN&quot;){
                missionKey = &quot;deposed_part1_6c&quot;;
            } else {
                missionVariables.depstat = &quot;CLEAN&quot;;
                missionKey = &quot;deposed_part1_6o&quot;;
            }
            missionVariables.deposed = &quot;PART1_6A&quot;;
            mission.runScreen({title: &quot;Deposed&quot;, background: &quot;deposed_GalCop.png&quot;, messageKey: missionKey});
            if (player.credits &gt;= 5000) {
                player.credits -= 5000;
            } else {
                player.credits = 0;
            }
            this.$unmarkSystem(197);
            mission.setInstructionsKey(null);
        }
        
        if (deposed == &quot;PART1_6B&quot;) missionVariables.deposed = &quot;PART1_6C&quot;;
 
        if (deposed == &quot;PART1_6D&quot;) missionVariables.deposed = &quot;PART1_6E&quot;;
        
        if (system.ID == 42 &amp;&amp; deposed == &quot;PART1_6&quot;) {
            // there is no hint leading to Zadige. Player has to remember old locations.
            mission.runScreen({title: &quot;Deposed&quot;, background: &quot;deposed_iNews.png&quot;, messageKey: &quot;deposed_part1_7&quot;});
            missionVariables.deposed = &quot;PART1_8A&quot;;
        }
       
        if (deposed == &quot;PART1_8E&quot;) {
            mission.runScreen({title: &quot;Deposed&quot;, background: &quot;deposed_iNews.png&quot;, messageKey: &quot;deposed_inews1&quot;});
            missionVariables.deposed = &quot;PART1_8EE&quot;;
        }

        if (deposed == &quot;PART2&quot; &amp;&amp; missionVariables.depask == &quot;ZSKTHAK&quot; &amp;&amp; system.ID &gt; 149 &amp;&amp; player.score &gt; 1823) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_pirate1&quot;, choicesKey: &quot;deposed_esarqure&quot;},
                function (choice) {
                if (choice == &quot;YES&quot;) {
                    missionVariables.deposed = &quot;PIRATE1&quot;;
                    mission.setInstructionsKey(&quot;deposed2_desc1&quot;);
                    this.$markSystem(83);
                    missionVariables.depask = &quot;SPIDERS&quot;;
                }
                if (choice == &quot;NO&quot;) {
                    missionVariables.deposed = &quot;ABANDONED&quot;;
                    this.$missionEnded(); // clear variables that are no longer needed.
                }
            });
        }

        if (deposed == &quot;PIRATE2&quot; &amp;&amp; missionVariables.depask == &quot;SPIDERS&quot; &amp;&amp; missionVariables.depstat == &quot;CLEAN&quot;) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_contactcops&quot;, choicesKey: &quot;deposed_contact&quot;},
                function (choice) {
                if (choice == &quot;YES&quot;) {
                    mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_cops1&quot;, background: &quot;deposed_GalCop.png&quot;})
                }
                if (choice == &quot;NO&quot;) {
                    missionVariables.depstat = &quot;FUGITIVE&quot;;
                }
            });
            missionVariables.depask = &quot;OFFWEGO&quot;;
            missionVariables.deposed = &quot;PIRATE3&quot;;
        }

        if (deposed == &quot;PIRATE3&quot; &amp;&amp; system.ID == 83) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_pirate2&quot;});
            missionVariables.deposed = &quot;PIRATE4&quot;;
        }

        if (deposed == &quot;PIRATE4&quot; &amp;&amp; system.ID == 83) {
            if (missionVariables.depstat == &quot;CLEAN&quot;) {
                // Give the clean player a hint.
                mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_cops2&quot;, background: &quot;deposed_GalCop.png&quot;});
            }
            missionVariables.deposed = &quot;PIRATE5&quot;;
            missionVariables.depblk1 = &quot;BLACK&quot;;
            missionVariables.depblk2 = &quot;BLACK&quot;;
            missionVariables.depblk3 = &quot;BLACK&quot;;
            this.$unmarkSystem(83);
            this.$markSystem(10);
            mission.setInstructionsKey(&quot;deposed2_desc2&quot;);
        }

        if (deposed == &quot;PIRATE5&quot; &amp;&amp; missionVariables.depblk1 == &quot;DESTROYED&quot; &amp;&amp; missionVariables.depblk2 == &quot;DESTROYED&quot; &amp;&amp; missionVariables.depblk3 == &quot;DESTROYED&quot;) {
            this.$markSystem(83);
            mission.setInstructionsKey(&quot;deposed2_desc2b&quot;);
            if (missionVariables.depstat == &quot;CLEAN&quot;) {
                // Give the clean player a hint.
                mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_cops3&quot;, background: &quot;deposed_GalCop.png&quot;});
            }
            missionVariables.deposed = &quot;PIRATE7&quot;;
        }

        if (deposed == &quot;PIRATE7&quot; &amp;&amp; system.ID == 83) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_pirate3&quot;});
            missionVariables.deposed = &quot;PIRATE8&quot;;
            this.$unmarkSystem(83);
            mission.setInstructionsKey(null);
            player.credits += 9000;
        }

        if (deposed == &quot;PIRATE8&quot;) {
            if (missionVariables.depstat == &quot;CLEAN&quot; &amp;&amp; system.ID == 83) {
                // Give the clean player a hint.
                mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_cops4&quot;, background: &quot;deposed_GalCop.png&quot;});
                missionVariables.deposed = &quot;PIRATE8_1&quot;;
            }
            if (missionVariables.depstat == &quot;FUGITIVE&quot;) {
                 missionVariables.deposed = &quot;PIRATE8_1&quot;;
            }
        }

        if (deposed == &quot;PIRATE8E&quot;) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed_inews2&quot;, background: &quot;deposed_iNews.png&quot;});
            missionVariables.deposed = &quot;PIRATE8EE&quot;;
        }

        if (deposed == &quot;PIRATE9&quot; &amp;&amp; system.ID &lt; 255) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_pirate4&quot;});
            missionVariables.deposed = &quot;PIRATE10&quot;;
            this.$markSystem(255);
            mission.setInstructionsKey(&quot;deposed2_desc3&quot;);
            missionVariables.deptaran = &quot;ALIVE&quot;;
        }

        if (deposed == &quot;PIRATE10&quot;) {
            if (missionVariables.depstat == &quot;CLEAN&quot; &amp;&amp; system.ID &lt; 255) {
                mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_cops5&quot;, background: &quot;deposed_GalCop.png&quot;});
                missionVariables.deposed = &quot;PIRATE11&quot;;
            }
            if (missionVariables.depstat == &quot;FUGITIVE&quot;) {
                 missionVariables.deposed = &quot;PIRATE11&quot;;
            }
        }

        if (deposed == &quot;PIRATE11&quot; &amp;&amp; system.ID == 83 &amp;&amp; missionVariables.deptaran == &quot;DEAD&quot;) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_pirate5&quot;});
            missionVariables.deposed = &quot;PIRATE12&quot;;
            this.$unmarkSystem(83);
            player.credits += 5000;
            mission.setInstructionsKey(null);
            missionVariables.deptaran = null;
        }

        if (deposed == &quot;PIRATE12&quot;) {
            if (missionVariables.depstat == &quot;CLEAN&quot;) {
                // hint for clean players
                mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_cops6&quot;, background: &quot;deposed_GalCop.png&quot;});
            }
            missionVariables.deposed = &quot;PIRATE13&quot;;
        }

        if (deposed == &quot;PIRATE13A&quot;) {
            missionVariables.deposed = &quot;PIRATE13B&quot;;
        }

        if (deposed == &quot;PIRATE13C&quot;) {
            missionVariables.deposed = &quot;PIRATE13D&quot;;
        }

        if (deposed == &quot;PIRATE13E&quot;) {
            missionVariables.deposed = &quot;PIRATE13F&quot;;
        }

        if (deposed == &quot;PIRATE14&quot;) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_pirate6&quot;});
            missionVariables.deposed = &quot;PIRATE15&quot;;
            this.$markSystem(111);
            mission.setInstructionsKey(&quot;deposed2_desc4&quot;);
            missionVariables.depdrug = &quot;ALIVE&quot;;
        }

        if (deposed == &quot;PIRATE15&quot;) {
            if (missionVariables.depstat == &quot;CLEAN&quot;) {
                // hint for clean players
                mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_cops7&quot;, background: &quot;deposed_GalCop.png&quot;});
                missionVariables.deposed = &quot;PIRATE11&quot;;
            }
            missionVariables.deposed = &quot;PIRATE16&quot;;
        }

        if (deposed == &quot;PIRATE16&quot; &amp;&amp; missionVariables.depdrug == &quot;DESTROYED&quot;) {
            missionVariables.deposed = &quot;PIRATE17&quot;;
            deposed = &quot;PIRATE17&quot;;
            missionVariables.depdrug = null;
        }

        if (deposed == &quot;PIRATE17&quot; &amp;&amp; system.ID == 83) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_pirate7&quot;});
            missionVariables.deposed = &quot;PIRATE18&quot;;
            this.$unmarkSystem(83);
            mission.setInstructionsKey(null);
            player.credits += 10000;
        }

        if (deposed == &quot;PIRATE18&quot;) {
            if (missionVariables.depstat == &quot;CLEAN&quot;) {
                // hint for clean players
                mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_cops8&quot;, background: &quot;deposed_GalCop.png&quot;});
            }
            missionVariables.deposed = &quot;PIRATE19&quot;;
        }

        if (deposed == &quot;PIRATE20&quot; &amp;&amp; system.pseudoRandom100 &gt; 80) {  // this also excludes offering at the target system no83.
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_pirate8&quot;});
            missionVariables.deposed = &quot;PIRATE21&quot;;
            this.$markSystem(83);
        }

        if (deposed == &quot;PIRATE21&quot; &amp;&amp; system.ID == 83) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_pirate9&quot;});
            missionVariables.deposed = &quot;PIRATE22&quot;;
            this.$unmarkSystem(83);
            this.$markSystem(138);
            mission.setInstructionsKey(&quot;deposed2_desc5&quot;);
            player.credits += 5000;
        }

        if (deposed == &quot;PIRATE22&quot;) {
            if (missionVariables.depstat == &quot;CLEAN&quot;) {
                // hint for clean players
                mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_cops9&quot;, background: &quot;deposed_GalCop.png&quot;});
            }
            missionVariables.deposed = &quot;PIRATE23&quot;;
        }

        if (deposed == &quot;PIRATE23&quot;) {
            if (!missionVariables.nova &amp;&amp; missionVariables.deposed_started == &quot;YES&quot;) {
                // Allow the native Oolite nova nission from now on.
                missionVariables.novacount = 2;
                missionVariables.deposed_started = &quot;NOVACHANCE&quot;;
            }
            if (system.ID == 138) {
                mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_pirate10&quot;});
                missionVariables.deposed = &quot;PIRATE24&quot;;
                mission.setInstructionsKey(&quot;deposed2_desc5b&quot;);
                this.$unmarkSystem(138);
            }
        }
        
        if (missionVariables.nova_deposed_bug == &quot;YES&quot;) {
            // One of the key systems his a nova system, so there is no solution for the mission.
            // tell this the player.
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;nova_deposed_newsflash&quot;, background: &quot;solar.png&quot;});
            missionVariables.nova_deposed_bug = null;
        }

    }
    
    if (player.ship.dockedStation.isMainStation &amp;&amp; galaxyNumber == 4) {
 
        if (deposed == &quot;PIRATE23&quot; &amp;&amp; missionVariables.deposed_started == &quot;NOVACHANCE&quot; &amp;&amp; missionVariables.nova == &quot;NOVA_HERO&quot;) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_pirate9&quot;});
            this.$markSystem(70);
            missionVariables.deposed = &quot;PIRATE25&quot;;
        }
    
        if (deposed == &quot;PIRATE25&quot; &amp;&amp; system.ID == 70) {
            missionVariables.deposed = &quot;PIRATE26&quot;;
            this.$unmarkSystem(70);
            mission.setInstructionsKey(null);
            var messageKey = (missionVariables.deposed_started == &quot;NOVA_HAPPENED&quot; ? &quot;deposed2_delivery2&quot; : &quot;deposed2_delivery1&quot;);
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: messageKey});
            player.credits += 5000;
        }

        if (deposed == &quot;PIRATE26&quot;) {
            if (missionVariables.depstat == &quot;CLEAN&quot;) {
                // hint for clean players
                mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed2_cops10&quot;, background: &quot;deposed_GalCop.png&quot;});
            }
            missionVariables.deposed = &quot;PIRATE27&quot;;
        }

        if (deposed == &quot;PIRATE28&quot;) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed_inews3&quot;, background: &quot;deposed_iNews.png&quot;});
            missionVariables.deposed = &quot;PIRATE29&quot;;
        }

         if (deposed == &quot;PIRATE29&quot; &amp;&amp; system.pseudoRandom100 &lt; 10) {
            mission.runScreen({title: &quot;Deposed&quot;, messageKey: &quot;deposed_inews_the_end&quot;, background: &quot;deposed_iNews.png&quot;});
            missionVariables.deposed = &quot;MISSION_COMPLETE&quot;;
            this.$missionEnded(); // clear variables that are no longer needed.
        }
    }
    
    if (this.firstLaunch &amp;&amp; (galaxyNumber == 3 || galaxyNumber == 4)) {
        this.$addShips();
        this.firstLaunch = false;
    }
};

this.shipLaunchedFromStation = function (station) {
        
    if (galaxyNumber == 3 &amp;&amp; system.ID == 11 &amp;&amp; missionVariables.deposed == &quot;PIRATE11&quot; &amp;&amp; missionVariables.depbien == &quot;BUGGERED&quot;) {
    // ******* change this to only happen once
        system.addShips(&quot;bienfighter&quot;, 6, station.position, 10000);
    }
};

this.shipExitedWitchspace = function () {
    if (galaxyNumber &lt; 3 || galaxyNumber &gt; 4 || system.isInterstellarSpace) return;
    var deposed = missionVariables.deposed;
    if (galaxyNumber == 3) {
        // Next lines are very inefficient delays, but needed to stay compatible with old save games by the lagacy script version.
        if (deposed == &quot;PART1_4A&quot;) missionVariables.deposed = &quot;PART1_4&quot;;
        if (deposed == &quot;PART1_5A&quot;) missionVariables.deposed = &quot;PART1_5&quot;;
        if (deposed == &quot;PART1_6A&quot;) missionVariables.deposed = &quot;PART1_6B&quot;;
        if (deposed == &quot;PART1_6C&quot;) missionVariables.deposed = &quot;PART1_6D&quot;;
        if (deposed == &quot;PART1_6E&quot;) missionVariables.deposed = &quot;PART1_6&quot;;
        if (deposed == &quot;PART1_8G&quot;) missionVariables.deposed = &quot;PART2&quot;;
        if (deposed == &quot;PART1_8F&quot;) missionVariables.deposed = &quot;PART1_8G&quot;;
        if (deposed == &quot;PART1_8EE&quot;) missionVariables.deposed = &quot;PART1_8F&quot;;
        if (deposed == &quot;PART1_8D&quot;) missionVariables.deposed = &quot;PART1_8E&quot;;
        if (deposed == &quot;PART1_8C&quot;) missionVariables.deposed = &quot;PART1_8D&quot;;
        if (deposed == &quot;PART1_8B&quot;) missionVariables.deposed = &quot;PART1_8C&quot;;
        if (deposed == &quot;PART1_8A&quot;) missionVariables.deposed = &quot;PART1_8B&quot;;
        if (deposed == &quot;PIRATE1&quot;) missionVariables.deposed = &quot;PIRATE2&quot;;
        if (deposed == &quot;PIRATE8G&quot;) missionVariables.deposed = &quot;PIRATE9&quot;;
        if (deposed == &quot;PIRATE8F&quot;) missionVariables.deposed = &quot;PIRATE8G&quot;;
        if (deposed == &quot;PIRATE8EE&quot;) missionVariables.deposed = &quot;PIRATE8F&quot;;
        if (deposed == &quot;PIRATE8D&quot;) missionVariables.deposed = &quot;PIRATE8E&quot;;
        if (deposed == &quot;PIRATE8C&quot;) missionVariables.deposed = &quot;PIRATE8D&quot;;
        if (deposed == &quot;PIRATE8B&quot;) missionVariables.deposed = &quot;PIRATE8C&quot;;
        if (deposed == &quot;PIRATE8A&quot;) missionVariables.deposed = &quot;PIRATE8B&quot;;
        if (deposed == &quot;PIRATE8_1&quot;) missionVariables.deposed = &quot;PIRATE8A&quot;;
        if (deposed == &quot;PIRATE13&quot;) missionVariables.deposed = &quot;PIRATE13A&quot;;
        if (deposed == &quot;PIRATE13B&quot;) missionVariables.deposed = &quot;PIRATE13C&quot;;
        if (deposed == &quot;PIRATE13D&quot;) missionVariables.deposed = &quot;PIRATE13E&quot;;
        if (deposed == &quot;PIRATE13F&quot;) missionVariables.deposed = &quot;PIRATE14&quot;;
        if (deposed == &quot;PIRATE19A&quot;) missionVariables.deposed = &quot;PIRATE20&quot;;
        if (deposed == &quot;PIRATE19&quot;) missionVariables.deposed = &quot;PIRATE19A&quot;;
        
        if (system.sun &amp;&amp; system.sun.hasGoneNova &amp;&amp; [11, 30, 42, 43, 49, 54, 75, 83, 111, 119, 138, 255].indexOf(system.ID) &gt; -1) {
            // one of the mission systems is a nova system.
            missionVariables.nova_deposed_bug == &quot;YES&quot;;
        }
        if (!missionVariables.nova &amp;&amp; missionVariables.deposed_started == &quot;YES&quot;) {
            missionVariables.novacount = 0; // suppress the nova mission.
        }
    }

    if (galaxyNumber == 4) {
        if (deposed == &quot;PIRATE27C&quot;) missionVariables.deposed = &quot;PIRATE28&quot;;
        if (deposed == &quot;PIRATE27B&quot;) missionVariables.deposed = &quot;PIRATE27C&quot;;
        if (deposed == &quot;PIRATE27A&quot;) missionVariables.deposed = &quot;PIRATE27B&quot;;
        if (deposed == &quot;PIRATE27&quot;) missionVariables.deposed = &quot;PIRATE27A&quot;;
    }

    this.$addShips();
};

this.playerEnteredNewGalaxy = function (galaxy) {
    if (galaxy == 4) {
        var deposed = missionVariables.deposed;
        if (deposed == &quot;PIRATE23&quot; &amp;&amp; missionVariables.deposed_started == &quot;NOVACHANCE&quot; &amp;&amp; missionVariables.nova == &quot;NOVA_HERO&quot;) {
            // mission was interrupted by the nova mission without change to pick up the passenger from Usesri. Add one extra message on the next docking.
            this.$markSystem(70);
            mission.setInstructionsKey(&quot;deposed2_desc6b&quot;);
            missionVariables.deposed_started = &quot;NOVA_HAPPENED&quot;
        }
        
        if (deposed == &quot;PIRATE24&quot;) {
            mission.setInstructionsKey(&quot;deposed2_desc6&quot;);
            this.$markSystem(70);
            missionVariables.deposed = &quot;PIRATE25&quot;;
        }
    }
}

this.$searchPeldorianShips = function () {
    var messageKey = &quot;deposed2_any_system&quot;;
    if (system.ID == 10) {
        messageKey = &quot;deposed2_edorqu10&quot;;
    }
    if (system.ID == 30) {
        messageKey = &quot;deposed2_atbitela30&quot;;
    }
    if (system.ID == 54) {
        messageKey = &quot;deposed2_quisbe54&quot;;
    }
    if (system.ID == 95) {
        messageKey = &quot;deposed2_zamaso95&quot;;
    }
    if (system.ID == 148) {
        messageKey = &quot;deposed2_teisen148&quot;;
    }
    if (system.ID == 119) {
        messageKey = &quot;deposed2_esisraan119&quot;;
    }
    if (system.ID == 34) {
        messageKey = &quot;deposed2_lequteor34&quot;;
    }
    if (system.ID == 49) {
        messageKey = &quot;deposed2_beesed49&quot;;
    }
    if (system.ID == 75) {
        messageKey = &quot;deposed2_inve75&quot;;
    }
    if (missionVariables.depblk1 == &quot;DESTROYED&quot; &amp;&amp; missionVariables.depblk2 == &quot;DESTROYED&quot; &amp;&amp; missionVariables.depblk3 == &quot;DESTROYED&quot;) {
        messageKey = &quot;deposed2_blakwidowsdestroyed&quot;;
    }
    mission.runScreen({title: &quot;Deposed&quot;, messageKey: messageKey});
}

this.$addShips = function () {
    if (galaxyNumber == 3) {
        var deposed = missionVariables.deposed;
        if (system.ID == 30 &amp;&amp; deposed == &quot;PIRATE5&quot;) {
            if (missionVariables.depblk1 == &quot;BLACK&quot;) system.addShipsToRoute(&quot;deposed-blackwidow1&quot;, 1, 0.1, &quot;wp&quot;);
            if (missionVariables.depblk2 == &quot;BLACK&quot;) system.addShipsToRoute(&quot;deposed-blackwidow2&quot;, 1, 0.1, &quot;wp&quot;);
            if (missionVariables.depblk3 == &quot;BLACK&quot;) system.addShipsToRoute(&quot;deposed-blackwidow3&quot;, 1, 0.1, &quot;wp&quot;);
        }

        if (system.ID == 255 &amp;&amp; deposed == &quot;PIRATE11&quot; &amp;&amp; missionVariables.deptaran == &quot;ALIVE&quot;) {
            var tarantula = system.addShipsToRoute(&quot;deposed-tarantula&quot;, 1, 0.01, &quot;wp&quot;)[0];
            system.addShips(&quot;deposed-asp&quot;, 6, tarantula.position, 5000);
        }

        if (system.ID == 111 &amp;&amp; deposed == &quot;PIRATE16&quot; &amp;&amp; missionVariables.depdrug == &quot;ALIVE&quot;) {
            var drugFactory = system.addShips(&quot;deposed-medical-drug-factory&quot;, 1, [0,0,-40000], 1000)[0];
            var pirates = system.addShips(&quot;pirate&quot;, 15, [0,0,-40000], 10000);
            system.addShips(&quot;asteroid&quot;, 20, [0,0,-40000], 10000);
            drugFactory.group = new ShipGroup(&quot;Peldorian Clan&quot;, drugFactory);

            // Now add the pirates to the factory group so the factory can signal for help.
            // don&#39;t add the group to each individual pirate, so you still can kill them individually.
            for (var i=1; i &lt; pirates.length; i++) {
                drugFactory.group.addShip(pirates[i]);
            }
        }
        
        if (system.ID == 11 &amp;&amp; missionVariables.depbien == &quot;BUGGERED&quot;) {
            system.addShipsToRoute(&quot;bienfighter&quot;, 4, 0.05, &quot;wp&quot;);
        }

        if (deposed == &quot;PART1_1&quot; || (deposed == &quot;PART1_2&quot; &amp;&amp; system.ID != 42)) {
            var count = Math.floor(Math.random()*6);  // 0 till 5;
            if (count) system.addGroupToRoute(&quot;bienfighter&quot;, count, Math.random(), &quot;wp&quot;);
            
            if (deposed == &quot;PART1_1&quot; &amp;&amp; count) {
                system.addShipsToRoute(&quot;bienfighter&quot;, count, 0.05, &quot;wp&quot;);
            }
        }
        
        if (deposed == &quot;PIRATE5&quot; &amp;&amp; system.mainStation) {
            // add hints at the main station
            system.mainStation.setInterface(&quot;Deposed&quot;,
                {title: expandMissionText(&quot;deposed2_inquiries_title&quot;),
                category: &quot;Inquiries&quot;,
                summary: expandMissionText(&quot;deposed2_inquiries_body&quot;),
                callback: this.$searchPeldorianShips.bind(this) });
        }
    }
};

this.$markSystem = function (ID) {
    mission.markSystem({
       system: ID,
       name: &quot;deposed&quot;,
       markerColor: &quot;redColor&quot;,
       markerScale: 1.1,
       markerShape: &quot;MARKER_X&quot;
    });
    missionVariables.deposedNewmarkers = &quot;YES&quot;; // added to deal with the legacy markers from an old saved game.
}

this.$unmarkSystem = function (ID) {
    var ok = mission.unmarkSystem({
       system: ID,
       name: &quot;deposed&quot;
    });
    if (!ok  &amp;&amp; !missionVariables.deposedNewmarkers) mission.unmarkSystem(ID); // must be an old legacy marker.
}


this.$missionEnded = function () {
    // clear all mission variables except the main one
    missionVariables.depbien = null;
    missionVariables.depask = null;
    missionVariables.depstat = null;
    missionVariables.depblk1 = null;
    missionVariables.depblk2 = null;
    missionVariables.depblk3 = null;
    missionVariables.deptaran = null;
    missionVariables.depdrug = null;
    missionVariables.deposed_started = null;
    missionVariables.deposedNewmarkers = null;
    this.$clearHandlers();
};


this.$clearHandlers = function () {
    delete this.missionScreenOpportunity;
    delete this.shipLaunchedFromStation;
    delete this.shipWillDockWithStation;
    delete this.shipExitedWitchspace;
    delete this.missionScreenOpportunity;
    delete this.guiScreenChanged;
    delete this.playerEnteredNewGalaxy;
};
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
