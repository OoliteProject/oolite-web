<html>
    <head>
        <title>Expansion APRIL Pylon Loader</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion APRIL Pylon Loader</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">6 Equipment</a></li>
          <li><a href="#ships">1 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">3 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER E)(&#39;[]&#39; vs &#39;[equipment, weapons]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>An in-flight pylon reloading system, the Automated Pylon Re-arm In-flight Loader</td>
                    <td>An in-flight pylon reloading system, the Automated Pylon Re-arm In-flight Loader</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.APRIL</td>
                    <td>oolite.oxp.Thargoid.APRIL</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>APRIL Pylon Loader</td>
                    <td>APRIL Pylon Loader</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.03</td>
                    <td>1.03</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>equipment, weapons</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/APRIL_OXP">http://wiki.alioth.net/index.php/APRIL_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/6/68/APRIL_1.03.oxz">https://wiki.alioth.net/img_auth.php/6/68/APRIL_1.03.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873324</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/APRIL%20Pylon%20Loader'>http://wiki.alioth.net/index.php/APRIL%20Pylon%20Loader</a></p>
        <h3>APRIL v1.03 Readme &amp; License.txt</h3>
        <pre>APRIL OXP by Thargoid.

From the ship equipment department, we introduce the Automated Pylon Re-arm In-flight Loader, AKA the APRIL system.

As its name suggests, this retrofittable technology allows storage and in-flight re-arming of extra pylon mounted weaponry and equipment. It is compatible with all current armaments except the Aquarian Missile Machine unit, which is automatically excluded from storage. It is also incompatible with the pylon-switching mechanism on Vortex and Maelstrom craft, on which it is based.

The standard system is available from tech level 12 systems for 40,000 credits. This doubles the fitted ships pylon capacity via reloading. For an additional 25,000 credits, the system can be upgraded to a military specification, adding an additional bank of storage (overall tripling the capacity).

Note that this OXP also makes the APRIL system available to NPCs (at a 0.2 weighted role as a missile), inducing a full missile reload to their pylons. Just to maintain balance :)

--------------------------------------------------------------
Instructions for use:

After purchase, the current pylon load can be transferred into the system by selecting the appropriate option on the equipment (3/F3) screen (only available if there is at least one loaded pylon). Similar options are available to view and unload the system from the equipment screen.

When in-flight, the system will automatically reload the ships pylons when empty if the last item used was a missile (note if the last launch was a mine the automatic reload is not triggered - this is a glitch in Oolite v1.76.x and should be resolved in Oolite v1.77 and beyond). Alternatively, a manual unload can be initated at any time in flight by selecting the system (via the &quot;shift-N&quot; key) and then priming it (via the &quot;n&quot; key).

When in-flight, the system content can be viewed by selecting the status screen (5/F5) and then going to the marketplace screen (8/F8) from there. The content screen will display up to the first 20 items stored, for ships with an over-large number of pylons. It is not recommended to browse this screen in the middle of battle :)

--------------------------------------------------------------
License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement.
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)

--------------------------------------------------------------
Instructions:

Unzip the file, and then move the folder &quot;APRIL Pylon Loader 1.03.oxp&quot; to the AddOns directory of your Oolite installation, and also the enclosed zip file of bigShips oxp on which this OXP relies. Then start the game up and the ships should be added. 

--------------------------------------------------------------
Version history:

19/04/2012 - First release, version 1.00
19/04/2012 - Minor script fix to add a missing variable definition on first purchase
03/05/2012 - Another minor script fix to prevent erroneous awarding of expansion on reloading
26/11/2012 - Tweak to replace boolean mission variables with string ones, to prevent save/restore issue. Also adds cargo space usage for 1.77.
--------------------------------------------------------------

Acknowledgements:

With thanks to Solonar for extensive beta-testing, and Capt Murphy for the 1.02 bug report.</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_APRIL.html">APRIL Pylon Reloader</a></td>
                    <td>yes</td>
                    <td align="right">400000</td>
                    <td align="center">12+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_APRIL_EXPANSION.html">APRIL Reloader Expansion</a></td>
                    <td>no</td>
                    <td align="right">250000</td>
                    <td align="center">13+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_APRIL_INVENTORY.html">APRIL reloader content</a></td>
                    <td>no</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_APRIL_NPC_MISSILE.html">NPC Reloader</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_APRIL_TRANSFER.html">Transfer pylon load to APRIL reloader</a></td>
                    <td>no</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_APRIL_UNLOAD.html">Unload APRIL reloader to pylons</a></td>
                    <td>no</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/april_NPCReloader.html">april_NPCReloader</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/april_NPC.js</td>
                    <td><pre>this.name					= &quot;april_NPC.js&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Script for NPC missile reload&quot;;
this.version				= &quot;1.00&quot;;

this.shipSpawned = function()
	{
	if(!this.ship || !this.ship.owner || !this.ship.owner.isValid)	{ return; }
	
	this.pylonCount = this.ship.owner.missileCapacity - this.ship.owner.missiles.length;
	
	if(this.pylonCount &gt; 0)
		{
		var loadCounter = 0 ; // reset the counter
		for(loadCounter = 0;loadCounter&lt;this.pylonCount;loadCounter++)
			{ this.ship.owner.awardEquipment(this.ship.selectNewMissile()); }
		}
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/april_activate.js</td>
                    <td><pre>this.name					= &quot;april_activate.js&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Script for manual activation of the APRIL&quot;;
this.version				= &quot;1.00&quot;;

this.activated = function()
	{
	if(worldScripts[&quot;april_worldScript.js&quot;])
		{ worldScripts[&quot;april_worldScript.js&quot;].aprilTriggered(); } 
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/april_worldScript.js</td>
                    <td><pre>this.name					= &quot;april_worldScript.js&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Script for APRIL reloader&quot;;
this.version				= &quot;1.03&quot;;

this.startUp = function()
	{
	if(player.ship.equipmentStatus(&quot;EQ_APRIL&quot;) === &quot;EQUIPMENT_UNAVAILABLE&quot;) { return; }

	if(!missionVariables.aprilExpanded)	{ missionVariables.aprilExpanded = &quot;FALSE&quot;; }
	this.storeSpace = player.ship.missileCapacity;
	if(missionVariables.aprilExpanded === &quot;TRUE&quot;) { this.storeSpace *= 2; }
	if(missionVariables.aprilMemory)
		{ 
		this.storeArray = missionVariables.aprilMemory.split(&quot;:&quot;);
		this.validateArray();
		}
	else
		{ this.storeArray = []; }
	this.missileArray = [];
	missionVariables.aprilLoad = this.storeArray.length;
	if(this.storeArray.length === this.storeSpace)
		{ missionVariables.aprilFull = &quot;TRUE&quot;; }
	else
		{ missionVariables.aprilFull = &quot;FALSE&quot;; }	
	}

this.validateArray = function()
	{
	if(this.storeArray.length === 0) { return; }
	var arrayCounter = this.storeArray.length - 1;
	for(arrayCounter = this.storeArray.length - 1;arrayCounter&gt;=0;arrayCounter--)
		{
		if(EquipmentInfo.allEquipment.indexOf(EquipmentInfo.infoForKey(this.storeArray[arrayCounter])) === -1)
			{ this.storeArray.splice(arrayCounter,1); }
		}
	this.tidyArray();	
	}
	
this.playerWillSaveGame = function(type)
	{ 
	if(player.ship.equipmentStatus(&quot;EQ_APRIL&quot;) === &quot;EQUIPMENT_UNAVAILABLE&quot;) { return; }

	this.storeMissileArray = &quot;&quot;;
	var storeCounter = 0;
	for(storeCounter = 0;storeCounter&lt;this.storeArray.length;storeCounter++)
		{ this.storeMissileArray = this.storeMissileArray + this.storeArray[storeCounter] + &quot;:&quot;; }
	this.storeMissileArray = this.storeMissileArray.slice(0,-1);	
	missionVariables.aprilMemory = this.storeMissileArray;
	}	

this.playerBoughtNewShip = function(ship)
	{
	if(player.ship.equipmentStatus(&quot;EQ_APRIL&quot;) === &quot;EQUIPMENT_UNAVAILABLE&quot;) { return; }

	this.storeArray = [];
	this.missileArray = [];
	if(missionVariables.aprilMemory) { delete missionVariables.aprilMemory; }
	if(missionVariables.aprilFull) { delete missionVariables.aprilFull; }
	if(missionVariables.aprilLoad) { delete missionVariables.aprilLoad; }
	if(missionVariables.aprilExpanded) { delete missionVariables.aprilExpanded; }
	this.storeSpace = player.ship.missileCapacity;
	}
	
this.playerBoughtEquipment = function(equipment)
	{
	switch(equipment)
		{	
		case &quot;EQ_APRIL&quot;:
			{
			missionVariables.aprilExpanded = &quot;FALSE&quot;;
			missionVariables.aprilFull = &quot;FALSE&quot;;
			this.missileArray = [];
			this.storeArray = [];
			missionVariables.aprilLoad = 0;
			this.storeSpace = player.ship.missileCapacity;
			break;
			}	
		case &quot;EQ_APRIL_UNLOAD&quot;:
			{
			player.ship.removeEquipment(&quot;EQ_APRIL_UNLOAD&quot;);
			this.aprilTriggered();
			break;
			}
		case &quot;EQ_APRIL_EXPANSION&quot;:
			{
			missionVariables.aprilExpanded = &quot;TRUE&quot;;
			missionVariables.aprilFull = &quot;FALSE&quot;;
			this.storeSpace = player.ship.missileCapacity * 2;
			break;
			}
		case &quot;EQ_APRIL_INVENTORY&quot;:
			{
			player.ship.removeEquipment(&quot;EQ_APRIL_INVENTORY&quot;);
			this.displayInventory();
			break;
			}	
		case &quot;EQ_APRIL_TRANSFER&quot;:
			{
			player.ship.removeEquipment(&quot;EQ_APRIL_TRANSFER&quot;);
			if(this.storeArray.length === this.storeSpace)
				{
				player.consoleMessage(&quot;APRIL capacity filled&quot;);
				missionVariables.aprilFull = &quot;TRUE&quot;;
				}
			else
				{
				this.missileArray = [];
				this.mmLoaded = &quot;no&quot;;
				var loopCounter = 0 ; // reset the counter
				for(loopCounter = 0;loopCounter &lt; player.ship.missiles.length;loopCounter++)
					{
					if(player.ship.missiles[loopCounter].equipmentKey === &quot;EQ_ARMOURY_MISSILEMACHINE_MINE&quot;)
						{ this.mmLoaded = &quot;yes&quot;; }
					else
						{ this.missileArray.push(player.ship.missiles[loopCounter].equipmentKey); }
					}				

				player.ship.awardEquipment(&quot;EQ_MISSILE_REMOVAL&quot;);
				if(this.mmLoaded === &quot;yes&quot;) 
					{
					player.ship.awardEquipment(&quot;EQ_ARMOURY_MISSILEMACHINE_MINE&quot;); 
					this.mmLoaded = &quot;no&quot;;
					}
				
				this.availableSpace = this.storeSpace - this.storeArray.length;
				
				var listCounter = 0 ; // reset the counter
				for(listCounter = 0;listCounter&lt;this.availableSpace;listCounter++)
					{ this.storeArray.push(this.missileArray.pop()); }
				
				this.tidyArray();
				
				if(this.storeArray.length === this.storeSpace)
					{
					player.consoleMessage(&quot;APRIL capacity filled&quot;);
					missionVariables.aprilFull = &quot;TRUE&quot;;
					}
					
				if(this.missileArray.length &gt; 0)	
					{
					var listCounter = 0 ; // reset the counter
					for(listCounter = 0;listCounter&lt;this.missileArray.length;listCounter++)
						{ player.ship.awardEquipment(this.missileArray[listCounter]); }
					}
				}	
			missionVariables.aprilLoad = this.storeArray.length;
			break;
			}
		}	
	}
	
this.tidyArray = function()
	{
	var loopCounter = this.storeArray.length - 1 ; // reset the counter
	for(loopCounter = this.storeArray.length - 1;loopCounter &gt;= 0;loopCounter--)
		{ if(this.storeArray[loopCounter] === undefined) { this.storeArray.pop(); } }				
	}

this.shipReleasedEquipment = this.shipFiredMissile = function()
	{
	if(player.ship.equipmentStatus(&quot;EQ_APRIL&quot;) === &quot;EQUIPMENT_UNAVAILABLE&quot;) { return; }
	this.missileCheckTimer = new Timer(this, this.checkMissiles, 0.25); 
	}
	
this.checkMissiles = function()
	{
	if(player.ship.equipmentStatus(&quot;EQ_APRIL&quot;) !== &quot;EQUIPMENT_OK&quot; || player.ship.missiles.length &gt; 0)
		{ return; }
	this.aprilTriggered();
	}	
	
this.aprilTriggered = function()
	{
	if(this.storeArray.length === 0)
		{
		player.consoleMessage(&quot;APRIL store empty&quot;);
		missionVariables.aprilLoad = this.storeArray.length;
		return;
		}
		
	this.freePylons = player.ship.missileCapacity - player.ship.missiles.length;
	if(this.freePylons === 0)
		{
		player.consoleMessage(&quot;All pylons are full&quot;);
		missionVariables.aprilLoad = this.storeArray.length;
		return;
		}
		
	var listCounter = 0 ; // reset the counter
	for(listCounter = 0;listCounter&lt;this.freePylons;listCounter++)
		{
		this.transfer = this.storeArray.pop();
		if(this.transfer !== undefined) { player.ship.awardEquipment(this.transfer); }
		}
		
	this.tidyArray();	
	missionVariables.aprilFull = &quot;FALSE&quot;;
	missionVariables.aprilLoad = this.storeArray.length;
	}
	
this.guiScreenChanged = function(to, from)
	{
	if(player.ship.docked || player.ship.equipmentStatus(&quot;EQ_APRIL&quot;) !== &quot;EQUIPMENT_OK&quot; || player.ship.equipmentStatus(&quot;EQ_MULTIBAY&quot;) === &quot;EQUIPMENT_OK&quot;) { return; }
		
	if(to &amp;&amp; from &amp;&amp; to == &quot;GUI_SCREEN_MARKET&quot; &amp;&amp; from == &quot;GUI_SCREEN_STATUS&quot;)
			{ this.displayInventory(); }	
	}		

this.displayInventory = function()
	{
	mission.runScreen({title:&quot;APRIL Content&quot;});
	if(this.storeArray.length === 0)
		{
		mission.addMessageText(&quot;\n\n\nThe APRIL system is currently empty.\n\nWeaponry can be stored via the equipment screen when docked.&quot;);
		return;
		}
	else
		{
		var minShow = 0;
		if(this.storeArray.length &gt; 20) { minShow = this.storeArray.length - 20; }
		var pylonCounter = this.storeArray.length -1; // reset the counter
		var displayCounter = 1;
		for(pylonCounter = this.storeArray.length - 1; pylonCounter &gt;= minShow; pylonCounter--)
			{ 
			mission.addMessageText(displayCounter + &quot; - &quot; + EquipmentInfo.infoForKey(this.storeArray[pylonCounter]).name); 
			displayCounter++;
			}
		if(this.storeArray.length &lt; 18) { mission.addMessageText(&quot;\nCapacity used: &quot; + this.storeArray.length + &quot; of &quot; + this.storeSpace); }
		if(this.storeArray.length &gt; 20) { mission.addMessageText(&quot;...                                                 Press Space Commander&quot;); }
		}
	}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
