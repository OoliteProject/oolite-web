<html>
    <head>
        <title>Expansion Shield Cycler</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Shield Cycler</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">11 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">8 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Conflict Expansions mismatch between OXP Manifest and Expansion Manager at character position 0071 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Distributes shield energy between fore and aft shields. Adjustable with OXPConfig.</td>
                    <td>Distributes shield energy between fore and aft shields. Adjustable with OXPConfig.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Lone_Wolf.ShieldCycler</td>
                    <td>oolite.oxp.Lone_Wolf.ShieldCycler</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Shield Cycler</td>
                    <td>Shield Cycler</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Lone_Wolf</td>
                    <td>Lone_Wolf</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.12</td>
                    <td>1.12</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.Svengali.CCL:1.7.1</li>
                            <li>oolite.oxp.Svengali.OXPConfig:2.3.1</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Svengali.CCL:1.7.1</li>
                            <li>oolite.oxp.Svengali.OXPConfig:2.3.1</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                            <li>oolite.oxp.Lone_Wolf.ShieldCyclerNext:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Lone_Wolf.ShieldCyclerNext:</li>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/ShieldCycler">http://wiki.alioth.net/index.php/ShieldCycler</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/c/c5/ShieldCycler_1.12.oxz">https://wiki.alioth.net/img_auth.php/c/c5/ShieldCycler_1.12.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-SA 4</td>
                    <td>CC BY-SA 4</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873465</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Shield%20Cycler'>http://wiki.alioth.net/index.php/Shield%20Cycler</a></p>
        <h3>ShieldCycler  v 1.12 ReadMe &amp; License.txt</h3>
        <pre>--------------------------------------------------------------

License:
This work is licensed under the Creative Commons Attribution-Share Alike 4.0 Unported License.
To view a copy of this license, visit http://creativecommons.org/licenses/by-sa/4.0/ 
or send a letter to Creative Commons, 171 Second Street, Suite 300, San Francisco, California, 94105, USA. 

--------------------------------------------------------------

Now Fully Configurable !

Thanks to Svengali and everyone that contributed to Cabal Common Library &amp; OxpConfig.

--------------------------------------------------------------

Background

Why do spaceships have 2 shields and not 1 (round ship) or 12 (dodecahedron station) ?

Early shields could not protect a whole spaceship, only small areas of the ship.
Engines, power core, cockpit, crew quarters were among the first areas to get shields protection.
Soon this let to many small isolated shield pockets throughout the ship, and that was not managable.
The military (well known for having the &#39;right&#39; priorities) decided that the crucial parts of a spaceship were 
powercore and cockpit.
Without power your weapons are useless, and you also need someone to press the trigger (or repair the powercore ...).
In all existing shipdesigns at the time the powercore was at the back of the ship, and the cockpit at the front side.
(there was no weapon powerful enough to damage a space station, so they didn&#39;t have shields at all).
This resulted in aft shields and forward shields.

As shield technology improved, more and more of the ship got shield protection.
The closer the aft and forward shielded parts got together, the more they influenced and weakened eachother.
A new device was proposed to deal with these problems : a shield inhibitor.
The idea was to put many of these devices in speficic locations in the ship to achieve the desired effect.
During Proof of Concept small scale lab tests of the inhibitor, an intern messed up some settings.
Instead of 2 separate shields they had 1 shield for about 2 minutes.
The designer was informed of this, checked and realised he had used simplified algorithms for the basic components.
By using the latest quantum physics algortihms for the components, he was able to proof both combining and separation of shields were possible.

Converting the algorithm to a solution usable in a device however was much harder.
Analysis showed that solving the combining equations would take atleast 1000 times
the computer effort needed for the separation.
Guess what solution was chosen by the military ?

Location :

&quot;The Loving Feline&quot;, a Seedy Space Bar somewhere in Santaari

While sipping Zaquession evil juice, commander Lone_Wolf (rated competent) reflected upon his trip here.
During the voyage from the witchpoint to the main station, his cobbie had become the target of 10 pirates at once.
Injectors saved the cobbie, but while running 6 equipment items had been damaged. 
Lone_Wolf was an engineer before he chose a new careerpath as a bountyhunter / trader and had repaired the items with succes.
What bothered him however was that when the damage occurred, his forward shields were still at full strength.
Only the aft shield was depleted.
He knew the shield technology history, but computers had become much more powerful since that choice was made.
&quot;A combining inhibitor would have saved me a lot of work today, and likely have saved the lives of many pilots&quot;.
a few tables further a mixed group of 5 pilots was talking, all were rated dangerous or higher.
&quot;Time to ask more experienced pilots&quot;

From the experiended pilots Lone_Wolf learned that there were rumours about a &quot;Shield Equalizer&quot; being in development. No details about it were known though, not even the name of the designer or company.
Lone_Wolf decided it was best to start a design by himself and see if he could find more info.
Fortunately the Loving Feline had a high enough tech level and good hyperspace communications, so he decided to stay there a while. (the presence of both clean and pirate ships near would help with testing).
The first prototype of LW&#39;s &quot;Shield Cycler&quot; was ready soon, and worked ok, but lacked options for control and finetuning.
A few weeks later a redesigned prototype was ready for it&#39;s first in-flight tests, but no clean pilots were available to help with testing. Lone_Wolf decided to take a break and do some research.
He found out the hypermail address of the developer of &quot;Shield Equalizer&quot; , CommonSenseOTB, and contacted him.

It turned out this guy was indeed working on a similar device, but felt it should be fully automated and need very little pilot control. 
He also planned to combine the equalizer with a capacitor that stored shield energy &amp; indicated he planned to use the Shield Equalizer as the starting point for a company.
LW had no interest in starting a company, but intended to release the design into the public domain, so engineers everywhere could build it.
LW and CSOTB did agree to make their designs compatible, so pilots could use both but their goals were to different to make 1 device.


Shield Cycler

Continually adjusts shield energy in automatic or manually chosen configuration.


Both - Equal shields aft and forward
Forward - Max forward shield, remainder on aft shield
Aft - Max aft shield, remainder (if any) on forward shield
Disabled : inactive

Threshold, launch configuration and enabling / disabling manual cycler settings can be done through OxpConfig while docked.
All adjustments are instantaneous, but use some ship energy.
The powerloss needed for changing the configuration is related to number of energy banks and the same for all types of cyclers.
Shield adjusting comes with a powerloss that depends on the amount of energy that needs to be transferred and differs between types.


To enjoy all options ShieldCycler offers, you should have 2 other oxps installed :
  Cabal Common Library 1.7.1
  OxpConfig 2.3.1 or later


Buyable Devices :

Shield Cycler Basic, 100 credits , TL 2
    works automatically, both setting.

Manual Configurator Basic 200 credits, TL 1
    requires SC Basic or better
    primable with Shift+n
    allows in-flight manual switching between both/forward/aft/disabled configuration
    powerloss for changing is : nr_of_energy_banks + 5

Shield Cycler Standard, 24900 credits, TL 11
    reduced powerloss
    requires Shield Booster, compatible with Mil. Shields
    Allows the setting of a threshold that determines when adjustments begins.
    
Manual Configurator Standard, 36600 credits, TL 11
    requires SC Standard or Advanced
    primable with Shift+n
    allows in-flight manual switching between both/forward/aft configuration
    reduces powerloss of SC Standard &amp; SC Advanced by 20%


Shield Cycler Advanced, 61500 credits, TL 14
    requires Mil. Shields
    reduced powerlosses
    allows choosing of a specific setting on Launch
    
Manual Configurator Advanced, 146400 credits, TL 14
    requires SC Advanced
    primable with Shift+n
    reduces powerloss of SC Advanced by 50%
    uses ship power of 2* energy banks for each in-flight change
    Allows to disable any of the possible settings.
    NOTE : atleast 1 needs to be enabled.
    
Sell in-flight configurator, 100 credits, TL 1
    removes all in-flight configuration devices and thus reverts all to the automatic version, 60% refund

Sell Shield Cycler, 100 credits, TL 1
    removes all automatic shield cycler devices, 60% refund
    Will only be visible if you have no manual configurator anymore.


Power loss table for shield adjustments (values shown are valid when you have no manual configurator installed)

transferred energy            &lt; 64    64 - 127    128 - 191   192 - 255   256 - 319   &gt; 320
Shield Cycler Basic           4       5           6           8           12          14      
Shield Cycler Standard        3       4           4           6           8           10
Shield Cycler Advanced        2       2           3           4           6           7

Notes for players :
  
-   Shield Cycler &amp; Manual Configurator devices can be damaged, although NOT destroyed.
    When damaged they will still work, but with reduced functionality.
    There is a repair option, accessible from the F3 screen.

-   None of the shield cyclers / manual configurator devices are visible in the F3 equipment screen, they are however visible in F5+F5 screen.

-   The basic versions of Shield Cycler and Manual Configurator lay the groundwork which the other versions need,
    that&#39;s the main reason why the standard/advanced versions are listed as upgrades.
    removal is done by downgrading, but to make it easier for pilots the tech will combine several downgrades into one.
    


Notes for &quot;Dark Siders&quot; :

-   If you have equipment items that are not compatible or require shieldcycler devices to be present  :
    The presence of any shield cycler device can be checked by testing for &quot;EQ_SC_SHIELD_CYCLER_INTERNAL&quot; .
    to test for Manual Configurator devices only, use &quot;EQ_SC_MANUAL_CONFIGURATOR_INTERNAL&quot;

-   There are several functions for use by other oxps, check wiki .
    
-   Incase you wish to use ShieldCycler for npc ships, check SC_Core.js script, function this._sc_adjust and contact me.

--------------------------------------------------------------

Todo list / current situation

releases :
oxp &amp; oxz Shield Cycler 1.12 (stable version)

oxp &amp; oxz Shield Cycler Next 1.12 (development version )


Plans/Future versions
    

v1.13 switch to OxpConfig v3
      list OxpConfig v3 as required dependency

v1.14
    in-flight repair options
    Thargoid has told me he feels partial repairs don&#39;t fit in with the goal of repairbots. He has warned me about several potential problems, and urged me to keep them contained in my oxp at first due to these.

v1.20

    re-release 1.14.x as stable
    remove code to convert pre-1.10 savegames
    add new cycler mode &quot;Lowest&quot; that mimics shieldequalizer functionality
    investigate whether the timer based functionality (smooth transfer / sound ) used by shieldequaliser can be combined with my event-driven approach for shield cycler device
    add capacitors from shieldequalizer, making sure they are compatible with other oxps. 
    Keep timer-based behaviour for capacitors ?
    bigger capacitors, like in hardships oxp
    additonal configure options (using OxpConfig) to work with the new devices
    add start/stop functionality for capacitors
    have SC next conflict with shieldequalizer+capacitors oxp

    
    
    
--------------------------------
History

v 1.12
new stable version
small fixes

v 1.11.3 :
Upon buying a new ship, shield cycler devices were not removed anymore, corrected.
small fixes

v1.11.2
Cabal Common Library and OxpConfig are now required dependencies
new external methods _sc_store_devices &amp; _sc_retrieve_devices : allows Ship Storage Helper to store/retrieve ships with SC devices installed correctly

v1.11.1
    bugfix in shipLaunchedEscapePod
    implemented 1.82 functionality
    Minimum Oolite version is now 1.81

v1.11

    switch from unbreakable equipment to loss of functionality when damaged
    used schema :
    every direct hit will reduce functionality by 10% , but it won&#39;t go below 40% functionality
    since the presence / absence of shield booster and mil shields already influences SC performance, there is no additonal functionality loss when they are damaged
    new repair option when docked (F3 screen) 
    repair price  :
    calculate total price of all installed SC devices
    multiply by .5
    multiply with (100 -functionality)/100

v1.10.2
    oxpcSettings : switched from Notify to DynamicNotify
    conflicts with ShieldCycler 1.0 oxz
    released as oxz

v1.10.1
    small bugfixes

v1.10.

    Major rewrite
    code split over many (currently 9) script files instead of 2 to improve maintainability / flexibility.
    objects are used to share information between scripts where possible 
    oxp disables itself if savegame to old or to new.
    start/stop functionality changed
    new option through oxpconfig to disable entire oxp
      (the options for pilots to disable Shield Cycler were limited and dependant on having certain equipment).
    use JSON for missionvariables
    add functionality for npc ships to use shield cycler
      (npc ships wanting to use this will need a custom ship script to give them shield functionality, an alternative would be to adjust customshields oxp to use this new functionality)
    display device versions &amp; damage level on F5+F5 screen
      (damage level won&#39;t change until 1.11.0 )
    power loss for changing configuration was 2 * (nr_of_energybanks + 1) , this led to a ship with 8 banks loosing almost an entire bank of energy after just 3 changes.
      new formula : nr_of_energybanks + 5
    added shipLaunchedEscapePod event

1.0
- added code to test for savegames created with 1.10+ (JSON)
- minor fix in equipment.plist
- license changed to CC-by-SA 4
- released as oxz &amp; oxp


0.31
- new function : b-key sets shieldcycler back to whatever the launch setting is
- optimizied &amp; simplified code
- updated CCL / OxpConfig requirements
- added manifest.plist to oxp
- requires Oolite 1.80


0.30.3
- adjusted to work with CCL 1.6 &amp; OxpConfig 2.0.12

0.30.2
- small fixes
- updated to check for recent cabal_common &amp; oxpconfig versions
- auto-sell cycler devices when player buys a new ship

0.30.1
- bugfixes
- encountered problems related to different JS execution contexts for equipment event handlers, shipscript event handlers and worldscript event handlers
  rewrite has as side-benefit that the code no longer uses global vars ( except missionvars) .
- added sc_stop &amp; sc-start functions so other oxps can stop/start cycler functionality
- more in-script documentation

0.21.2
- added configurable options
  requires Cabal Common Library 1.4.1 (or later) and OxpConfig2 2.03 (or later)
- If CCL / OxpConfig2 are not present or to old, everything works but there will be no configure options
- cleaned up/ optimised code

0.20.1
- cycling to forward when forward shield was at full strength used energy, corrected.

0.20
- brought back disabled setting (was removed in 0.14 )
- shipLaunchedFromStation didn&#39;t check if player has a shield cycler, fixed
- Equipment names changed to EQ_SC_AAAAAA scheme
- variables now all start with sc_
- both automatic and manual versions are now available, see above for details
- halved power needed for switching configuration, as old number meant 4 switches would drain a complete energybank
- preparations to use OxpConfig for changing settings in later version

0.14
-	Basic Shield cycler made incompatible with Shield Booster and Mil. Shields
	Standard Shield cycler incompatible with Mil. Shields
-	cycling the configuration now subtracts 4 * # of energy banks from ship energy. 
-	adjusting also uses shield energy, but the amount is now fixed and related to the transferred amount of shield energy.

0.13
-	created basic, standard &amp; advanced version incl. sell option.
-	cycling / adjusting uses ship energy
-	added EQ_Shield_Equalizer as incompatible equipment
-	clean / optimize code

0.12 
-	first public version with 1 device
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SC_MANUAL_CONFIGURATOR_ADVANCED.html">In-flight configurator Advanced</a></td>
                    <td>no</td>
                    <td align="right">1464000</td>
                    <td align="center">14+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SC_MANUAL_CONFIGURATOR_BASIC.html">In-flight configurator for Shield Cycler</a></td>
                    <td>no</td>
                    <td align="right">2000</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SC_MANUAL_CONFIGURATOR_INTERNAL.html">SC Manual Configurator</a></td>
                    <td>no</td>
                    <td align="right">1</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SC_MANUAL_CONFIGURATOR_STANDARD.html">standard version In-flight configurator</a></td>
                    <td>no</td>
                    <td align="right">366000</td>
                    <td align="center">11+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SC_SC_REPAIR.html">Repair SC devices</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SC_SELL_MANUAL_CONFIGURATOR.html">Sell in-flight configurator</a></td>
                    <td>yes</td>
                    <td align="right">1000</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SC_SELL_SHIELD_CYCLER.html">Sell Shield Cycler</a></td>
                    <td>yes</td>
                    <td align="right">1000</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SC_SHIELD_CYCLER_ADVANCED.html">Advanced Shield Cycler</a></td>
                    <td>no</td>
                    <td align="right">615000</td>
                    <td align="center">14+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SC_SHIELD_CYCLER_BASIC.html">Basic Shield Cycler</a></td>
                    <td>no</td>
                    <td align="right">1000</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SC_SHIELD_CYCLER_INTERNAL.html">Shield Cycler</a></td>
                    <td>no</td>
                    <td align="right">1</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SC_SHIELD_CYCLER_STANDARD.html">Standard Shield Cycler</a></td>
                    <td>no</td>
                    <td align="right">249000</td>
                    <td align="center">11+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/SC_Core.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;SC Core&quot;;
this.author         = &quot;Lone_Wolf&quot;;
this.copyright      = &quot;(C) 2011-2012, 2014-2015 Lone_Wolf.&quot;;
this.licence        = &quot;CC-by-SA 4.0&quot;;
this.description    = &quot;calculate shield values when cycling&quot;;
this.version        = &quot;1.12&quot;;

    this._sc_cycler_loss =
    //  power loss for no cycler, basic,standard, advanced adjustments based on adjustment / 64
    //  64 is used because that&#39;s the amount of energy in 1 energybank.
      [
	[ 0, 0, 0, 0, 0, 0 ],     // no cycler present, so no power loss
	[ 4, 5, 6, 8, 12, 14 ],   // basic cycler
	[ 3, 4, 4, 6, 8, 10 ],    // standard cycler
	[ 2, 2, 3, 4, 6, 7 ],     // advanced cycler
      ];
    this._sc_manual_reduction =
    // powerloss multiplier for manual configurators
    // none, basic, standard, advanced
    [ 1, 1, 0.50, 0.20];

this.startUp = function()
  {
    if ( worldScripts[&quot;Shield Cycler&quot;].startUp ) { worldScripts[&quot;Shield Cycler&quot;].startUp(); };
  };

this._sc_sc_adjust = function(init)
  {
    // setup things for player.ship shield cycling
    var adjust_input =
      {
	caller: &quot;Shield Cycler&quot;,
	setting: worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.current_configuration,
	functional: worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.functional,
	fwd: player.ship.forwardShield,
	fwd_threshold: ( player.ship.maxForwardShield * worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.threshold * 0.01 ),
	aft: player.ship.aftShield,
	aft_threshold: ( player.ship.maxAftShield * worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.threshold * 0.01 ),
	version: worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version,
	manual_version: worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version,
	init: init,
	max_energy: player.ship.maxEnergy
      };
    var adjust_output = {power: 0, fwd:0, aft:0};
    adjust_output = this._sc_adjust(adjust_input);
    if ( adjust_input.init )
      { player.commsMessage( &quot;Cycler configuration : &quot; + worldScripts[&quot;Shield Cycler&quot;]._sc_const.names[ adjust_input.setting ] ); };
    if ( adjust_output.power &gt; 0 )
      {
        // apply changes to shields &amp; energy
	player.ship.forwardShield = adjust_output.fwd;
	player.ship.aftShield = adjust_output.aft;
	player.ship.energy -= adjust_output.power;
      };
    return adjust_output.power;
  };

  
  
  
  
  
this._sc_adjust = function (adjust)
  {
    /* adjust is an object set by the calling function
      properties of the object adjust :
	name		type	meaning
     	caller		string	identifier of calling oxp
     	setting		int	0 = disabled, 1 = aft, 2 = forward, 3 = equal
	functional	%	indicates how much damage shieldcycler device has, 100 = no damage
	fwd		int	current forward shield strength
	fwd_threshold	int	see code
	aft		int	aft shield strength
	aft_threshold	int	see code
	version		int	number 0,1,2,3 determining which version of automatic shield cycler is present
	manual_version	string	number 0,1,2,3 determining which version of manual configurator is present
	init		bool	true : calc powerloss for switching to another setting
				false : calc powerloss for cycling
	max_energy	int	needed to calculate powerloss for init = true
	
      returns an object with these properties :
	power: amount of energy used for cycling or -1 in case of error
	fwd: new forward shield value
	aft: new aft shield value
	
	NOTE : this function is intended to be usable for both player &amp; npc ships
    */
    // set result at power 0, fwd &amp; aft at input values. This corresponds with no changes needed.
    var result = { power:0,fwd:adjust.fwd,aft:adjust.aft};
    var energy_transfer = -1;
    var desired_transfer = 0;
    switch ( worldScripts[&quot;Shield Cycler&quot;]._sc_const.names[adjust.setting] )
    {
      case &quot;Equal&quot;:
          if ( adjust.aft !== adjust.fwd )
            {
              if ( (adjust.fwd &lt; adjust.fwd_threshold) || (adjust.aft &lt; adjust.aft_threshold)  )
                {
                  desired_transfer = 0.5 * Math.abs( adjust.fwd - adjust.aft );
		  energy_transfer = desired_transfer * adjust.functional * 0.01 ;
                  result.fwd = ( adjust.fwd &lt; adjust.aft ) ? adjust.fwd + energy_transfer : adjust.fwd - energy_transfer ;
                  result.aft = ( adjust.fwd &lt; adjust.aft ) ? adjust.aft - energy_transfer : result.aft = adjust.aft + energy_transfer ;
                };
            };
          break;
      case &quot;Forward&quot;:
          if ( adjust.fwd &lt; adjust.fwd_threshold )
            { 
              desired_transfer  = ( desired_transfer &lt;= adjust.aft ) ? adjust.fwd_threshold - adjust.fwd : adjust.aft ;
              energy_transfer = desired_transfer * adjust.functional * 0.01 ;
	      result.fwd = adjust.fwd + energy_transfer;
              result.aft = adjust.aft - energy_transfer;
            };
          break;
      case &quot;Aft&quot;:
          if ( adjust.aft &lt; adjust.aft_threshold )
            {
              desired_transfer  = ( desired_transfer &gt; adjust.fwd ) ? adjust.aft_threshold - adjust.aft : adjust.fwd ;
	      energy_transfer = desired_transfer * adjust.functional * 0.01 ;
	      result.fwd = adjust.fwd - energy_transfer;
              result.aft = adjust.aft + energy_transfer;
            };
          break;
      case &quot;Disabled&quot;:
          // no adjustments are done in disabled configuration, so no energy is transferred
          desired_transfer = 0;
	  break;
      default:
	// should never happen unless caller has set an invalid mode
	desired_transfer = -1;
  	result.power = -1;
	log(this.name,JSON.stringify(adjust));
	log(this.name,worldScripts[&quot;Shield Cycler&quot;]._sc_const.names[adjust.setting]);
	log(this.name,JSON.stringify(result));
	log(this.name,&quot;error while adjusting shields&quot;);
        break;
    };
    // no transfer done, so no power loss
    if ( desired_transfer = 0 ) { result.power = 0; return result;};
    // incase something went very wrong
    if ( desired_transfer &lt; 0 ) { return result; };
    if ( adjust.init )
	    { 
	      result.power = 2 * ( Math.floor( adjust.max_energy / 64) + 1);
	    }
	  else
	    { 
	      result.power = this._sc_cycler_loss[adjust.version] [Math.floor(desired_transfer / 64)];
	      result.power *= this._sc_manual_reduction[adjust.manual_version];
	    };
    return result;
  };
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/SC_Equipment_Conditions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;SC equipment condtion script&quot;;
this.author         = &quot;Lone_Wolf&quot;;
this.copyright      = &quot;(C) 2011-2012, 2014-2015 Lone_Wolf.&quot;;
this.licence        = &quot;CC-by-SA 4.0&quot;;
this.description    = &quot;SC equipment condition script&quot;;
this.version        = &quot;1.12&quot;;

this.allowAwardEquipment = function(equipment, ship, context)
{
  if ( worldScripts[&quot;Shield Cycler&quot;].startUp ) { worldScripts[&quot;Shield Cycler&quot;].startUp(); };
  var allowed = false;
  switch ( equipment )
    {
      case &quot;EQ_SC_SHIELD_CYCLER_BASIC&quot;:
	allowed = ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) ? true : false;
	break;
      case &quot;EQ_SC_SHIELD_CYCLER_STANDARD&quot;:
	allowed = ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.basic ) ? true : false;
	break;
      case &quot;EQ_SC_SHIELD_CYCLER_ADVANCED&quot;:
	allowed = ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.standard ) ? true : false;
	break;
      case &quot;EQ_SC_MANUAL_CONFIGURATOR_BASIC&quot;:
	if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version != worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) 
	  { 
	    allowed = ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) ? true : false; 
	  };
	break;
      case &quot;EQ_SC_MANUAL_CONFIGURATOR_STANDARD&quot;:
	if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version &gt; worldScripts[&quot;Shield Cycler&quot;]._sc_const.basic )
	  {
	    allowed = ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.basic ) ? true : false;
	  };
	break;
      case &quot;EQ_SC_MANUAL_CONFIGURATOR_ADVANCED&quot;:
	if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.advanced )
	  {
	    allowed = ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.standard ) ? true : false;
	  };
	break;
      case &quot;EQ_SC_SELL_SHIELD_CYCLER&quot;:
	if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version &gt; worldScripts[&quot;Shield Cycler&quot;]._sc_const.none )
	  {
	    allowed = ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) ? true : false;
	  };
	break;
      case &quot;EQ_SC_SELL_MANUAL_CONFIGURATOR&quot;:
	allowed = ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version != worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) ? true : false;
	break;
      case &quot;EQ_SC_SHIELD_CYCLER_INTERNAL&quot;:
	allowed = ( context == &quot;scripted&quot; ) ? true : false;
	break;
      case &quot;EQ_SC_MANUAL_CONFIGURATOR_INTERNAL&quot;:
	allowed = ( context == &quot;scripted&quot; ) ? true : false;
	break;
      case &quot;EQ_SC_SC_REPAIR&quot;:
	if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version &gt; worldScripts[&quot;Shield Cycler&quot;]._sc_const.none )  
	  {
	    allowed = ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.functional &lt; 100 ) ? true : false;
	  };
	break;
      default:
	break;
    };
  return allowed;
};

this.updateEquipmentPrice = function(equipment, price)
{
  var repair_cost = price;
  if ( equipment == &quot;EQ_SC_SC_REPAIR&quot; )
    {
      repair_cost = worldScripts[&quot;Shield Cycler&quot;]._sc_worm.sc_cost[ worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version ];
      repair_cost += worldScripts[&quot;Shield Cycler&quot;]._sc_worm.manual_cost[ worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version ];
      repair_cost *= 0.1;
      repair_cost = 0.5 * repair_cost *  (100 - worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.functional ) / 100;
    };
  return repair_cost;
};

  </pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/SC_Equipment_Events.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;SC equipment events&quot;;
this.author         = &quot;Lone_Wolf&quot;;
this.copyright      = &quot;(C) 2011-2012, 2014-2015 Lone_Wolf.&quot;;
this.licence        = &quot;CC-by-SA 4.0&quot;;
this.description    = &quot;SC equipment event handler&quot;;
this.version        = &quot;1.12&quot;;

this.activated = function()
  {
    if ( worldScripts[&quot;Shield Cycler&quot;].startUp ) { worldScripts[&quot;Shield Cycler&quot;].startUp(); };
    // Triggered by pressing n-key while shieldcycler is primed
    // is only called when player has a manual configurator installed and player presses n-key while device is primed
    // verify if oxp is active, just-in-case
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.general.disabled ) { return; };
    // verify if shield cycler devices are active, just in case
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.general.sc_disabled ) { return; };
    var loop_ready = false;
    var new_config = worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.current_configuration;
    do
      {
	new_config = ( new_config + 1 ) % worldScripts[&quot;Shield Cycler&quot;]._sc_const.cycle.count;
	loop_ready = !( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.cycler_mask &amp; Math.pow(2, new_config) );
       }
    while ( loop_ready );
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.current_configuration = new_config;
    var error = worldScripts[&quot;SC Core&quot;]._sc_sc_adjust(true);
    if (error &lt; 0 )
      {
	player.commsMessage(&quot;Error - check latest log&quot;,10);
	log(this.name,&quot;error while cycling settings&quot;);
      };
  };

this.mode = function()
  {
    if ( worldScripts[&quot;Shield Cycler&quot;].startUp ) { worldScripts[&quot;Shield Cycler&quot;].startUp(); };
    // verify if oxp is active
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.general.disabled ) { return; };
    // checking if SC devices are active
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.general.sc_disabled ) { return; };
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.current_configuration = worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.start_configuration;
    var error = worldScripts[&quot;SC Core&quot;]._sc_sc_adjust(true);
    if (error &lt; 0 )
      {
	player.commsMessage( &quot;Error - check latest log&quot;,10);
	log(this.name,&quot;error while resetting to start configuration&quot;);
      };
  };
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/SC_Savegame_Compatibility_Check.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;SC check savegame compatiblity&quot;;
this.author         = &quot;Lone_Wolf&quot;;
this.copyright      = &quot;(C) 2011-2012, 2014-2015 Lone_Wolf.&quot;;
this.licence        = &quot;CC-by-SA 4.0&quot;;
this.description    = &quot;SC check savegame compatiblity&quot;;
this.version        = &quot;1.12&quot;;

this._sc_check_savegame = function(savegame_version)
  {
    // return values
    // 0 : to old
    // 1 : conversion needed
    // 2 : missionvars not present, creation needed
    // 3 : missionvars present &amp; correct version
    // 4 : to new
    if ( missionVariables.sc_settings == null )
      {
	// pre v1.10 or missionvars not created yet
	if ( missionVariables.sc_config !== null || missionVariables.sc_active !== null ) 
	  {
	    // if either of those are used, the savegame was created with a pre 0.21.2 version and to old
	    return 0;
	  }
	if ( missionVariables.sc_threshold !== null)
	  {
	    // missionVariables.sc_threshold exists, so savegame is from 0.21.2 or later, but before v1.10
	    // in higher versions conversion of this format will no longer be supported
	    return 1;
	  }
	// must be a new v1.10+ game, missionvars need to be created
	return 2;
      };
    // missionVariables.sc_settings  exists, so must be v1.10 or later and uses JSON
    var temp_settings = JSON.parse(missionVariables.sc_settings);
    var savegame_diff = savegame_version - temp_settings.general.savegame_version ;
    if ( savegame_diff  &lt; -1 )
      { 
	// savegame format is more then 1 version behind of current version, conversion is not supported so to old
	return 0;
      }
    if ( savegame_diff == -1 )
      { 
	// savegame is 1 version behind, conversion supported
	// intended for future use when savegame_version &gt; 0
	return 1;
      };
    if ( savegame_diff == 0 )
      { 
	// savegame format hasn&#39;t changed
	return 3;
      };
    // savegame was created with a newer version then supported by installed version of SC
    // should occur only when user has downgraded SC
    return 4;
  };
  </pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/SC_Savegame_Conversion.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;SC savegame conversion&quot;;
this.author         = &quot;Lone_Wolf&quot;;
this.copyright      = &quot;(C) 2011-2012, 2014-2015 Lone_Wolf.&quot;;
this.licence        = &quot;CC-by-SA 4.0&quot;;
this.description    = &quot;SC convert savegames&quot;;
this.version        = &quot;1.12&quot;;

// code to convert 0.21.2 &lt;= savegame &lt; 1.10.0 to new JSON format introduced in 1.10

this._sc_convert_0_21_2 = function()
  {
    if ( missionVariables.sc_configuration_options !== null ) { delete missionVariables.sc_configuration_options; };      // removed in 0.21.3
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.threshold = parseInt(missionVariables.sc_threshold); 
    delete missionVariables.sc_threshold;
    // configuration order is reversed in 1.10
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.start_configuration = 3 - parseInt(missionVariables.sc_start_configuration);
    delete missionVariables.sc_start_configuration;
    // new in 1.10
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.current_configuration = worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.start_configuration;
    // cycler possible options were stored in 4 vars, now in a bitmask
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.cycler_mask = 0x00f;
    var temp_mask = 0;
    if ( this._sc_string2bool(missionVariables.sc_both_enabled) ) { temp_mask += 8; };
    delete missionVariables.sc_both_enabled;
    if ( this._sc_string2bool(missionVariables.sc_forward_enabled) ) { temp_mask += 4; };
    delete missionVariables.sc_forward_enabled;
    if ( this._sc_string2bool(missionVariables.sc_aft_enabled) ) { temp_mask += 2; };
    delete missionVariables.sc_aft_enabled;
    if ( this._sc_string2bool(missionVariables.sc_disabled_enabled) ) { temp_mask += 1; };
    delete missionVariables.sc_disabled_enabled;
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.cycler_mask = temp_mask;
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version = parseInt(missionVariables.sc_version);
    switch ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version )
      {
	case worldScripts[&quot;Shield Cycler&quot;]._sc_const.advanced:
	  worldScripts[&quot;Shield Cycler&quot;]._sc_change_configuration(2, false);
	case worldScripts[&quot;Shield Cycler&quot;]._sc_const.standard:
	  worldScripts[&quot;Shield Cycler&quot;]._sc_change_configuration(1, false);
	  break;
	default:
	  break;
      };
    delete missionVariables.sc_version;
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version = parseInt(missionVariables.sc_manual_version);
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version === worldScripts[&quot;Shield Cycler&quot;]._sc_const.advanced )
      { worldScripts[&quot;Shield Cycler&quot;]._sc_change_configuration(3, false); };
    delete missionVariables.sc_manual_version;
    // new in 1.10 
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.functional = 100;
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.general.disabled = false;
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.general.sc_disabled = false;
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.general.savegame_version = worldScripts[&quot;Shield Cycler&quot;]._sc_const.savegame_version;
    log(this.name,JSON.stringify(worldScripts[&quot;Shield Cycler&quot;]._sc_settings));
    delete this._sc_string2bool;
  };

this._sc_string2bool = function(setting)
/*  Missionvars are stored as strings, but i need booleans. this function uses simple logic to ensure i get true booleans, not fuzzy ones.
    returns a boolean value of either true or false
*/
  {
    if ( setting === &quot;true&quot; )
      { return true;}
    else
      { return false;};
  };

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/SC_Shipscript_Events.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;SC shipscript events&quot;;
this.author         = &quot;Lone_Wolf&quot;;
this.copyright      = &quot;(C) 2011-2012 , 2014-2015 Lone_Wolf.&quot;;
this.licence        = &quot;CC-by-SA 4.0&quot;;
this.description    = &quot;SC shipscript events handler&quot;;
this.version        = &quot;1.12&quot;;


this.startUp = function()
  {
    if ( worldScripts[&quot;Shield Cycler&quot;].startUp ) { worldScripts[&quot;Shield Cycler&quot;].startUp(); };
  };

this.shipLaunchedFromStation = function(station)
  {
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.general.disabled ) { return; };
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.general.sc_disabled ) { return; };
    // check if player has a Shield Cycler
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) { return; };
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.current_configuration = worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.start_configuration;
    worldScripts[&quot;SC Core&quot;]._sc_sc_adjust(true);
  };

this.shipTakingDamage = function(amount, fromEntity, damageType)  
  {   
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.general.disabled ) { return; };
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.general.sc_disabled ) { return; };
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) { return; };
    worldScripts[&quot;SC Core&quot;]._sc_sc_adjust(false);
  };

this.shipLaunchedEscapePod = function(escapepod, passengers)
  {
    // reset devices / vars when pilot ejects
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) { return; };
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version != worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) 
      { 
	worldScripts[&quot;Shield Cycler&quot;]._sc_change_configuration(3, true);
	player.ship.removeEquipment(&quot;EQ_SC_MANUAL_CONFIGURATOR_INTERNAL&quot;);
	worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version  = worldScripts[&quot;Shield Cycler&quot;]._sc_const.none;
	worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.cycler_mask  = 0x00f;
      };
    worldScripts[&quot;Shield Cycler&quot;]._sc_change_configuration(2, true);
    worldScripts[&quot;Shield Cycler&quot;]._sc_change_configuration(1, true);
    player.ship.removeEquipment(&quot;EQ_SC_SHIELD_CYCLER_INTERNAL&quot;);
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version  = worldScripts[&quot;Shield Cycler&quot;]._sc_const.none;
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.start_configuration = worldScripts[&quot;Shield Cycler&quot;]._sc_const.both;
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.threshold = 100;
    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.functional = 100;
    worldScripts[&quot;Shield Cycler&quot;]._sc_update_oxpconfig_vars();
  };
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/SC_Worldscript_Events.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;SC worldscript events&quot;;
this.author         = &quot;Lone_Wolf&quot;;
this.copyright      = &quot;(C) 2011-2012 , 2014-2015 Lone_Wolf.&quot;;
this.licence        = &quot;CC-by-SA 4.0&quot;;
this.description    = &quot;SC worldscript event handler&quot;;
this.version        = &quot;1.12&quot;;

this.startUp = function()
  {
    if ( worldScripts[&quot;Shield Cycler&quot;].startUp ) { worldScripts[&quot;Shield Cycler&quot;].startUp(); };
  };

// worldscript events
this.guiScreenWillChange = function(to, from)
  {
    if ( to !== &quot;GUI_SCREEN_MANIFEST&quot; ) { mission.setInstructions(null); return; };
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) { return; };
    var _sc_display_strings = [&quot;none&quot;,&quot;basic&quot;,&quot;standard&quot;,&quot;advanced&quot;];
    var sc_display_cycler = _sc_display_strings[ worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version ];
    var sc_display_manual = &quot;&quot;;
    var sc_display_functional = worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.functional ;
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version != worldScripts[&quot;Shield Cycler&quot;]._sc_const.none )
      { 
        sc_display_manual = _sc_display_strings[ worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version ];
      };
    var instruct = 
      [
        &quot;Shield Cycler Status&quot;,
        &quot;SC version: &quot;  + sc_display_cycler,
        &quot;Manual Configurator: &quot; + sc_display_manual,
        sc_display_functional + &quot; %% functional&quot;
      ];
    mission.setInstructions( instruct );
  };

this.playerWillSaveGame = function()
  {
    missionVariables.sc_settings = JSON.stringify(worldScripts[&quot;Shield Cycler&quot;]._sc_settings);
  };

this.playerBoughtNewShip = function(ship)
  {
    // sell shieldcycler equipment if still present and reset missionvars
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version == worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) { return; };
    var refund = 0;
    if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version != worldScripts[&quot;Shield Cycler&quot;]._sc_const.none ) 
      { 
	refund = worldScripts[&quot;Shield Cycler&quot;]._sc_remove_manual();
      };
    refund += worldScripts[&quot;Shield Cycler&quot;]._sc_remove_shield_cycler();
  };

this.equipmentDamaged = function(equipmentKey)
  {
    switch ( equipmentKey )
      {
	case &quot;EQ_SC_SHIELD_CYCLER_INTERNAL&quot;:
	case &quot;EQ_SC_MANUAL_CONFIGURATOR_INTERNAL&quot;:
	  player.commsMessage(&quot;ShieldCycler devices taking damage, functionality is reduced&quot;,6);
	  player.ship.setEquipmentStatus(EquipmentInfo.infoForKey(equipmentKey), &quot;EQUIPMENT_OK&quot;);
	  if ( worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.functional &gt;= 50 )
	    { worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.functional -= 10; }
	  else
	    {  worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.functional = 40; };
	  break;
	default:
	  break;
      };
  };

this.playerBoughtEquipment = function(equipmentKey)
  {
    // This function supplements the code in equipment.plist &amp; SC_Equipment_Condtion.js
    switch ( equipmentKey )
        {
          case &quot;EQ_SC_SHIELD_CYCLER_BASIC&quot;:
            player.ship.removeEquipment(equipmentKey);
	    player.ship.awardEquipment(&quot;EQ_SC_SHIELD_CYCLER_INTERNAL&quot;);
            worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.start_configuration = worldScripts[&quot;Shield Cycler&quot;]._sc_const.cycle.both;
            worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.threshold = 100;
	    worldScripts[&quot;Shield Cycler&quot;]._sc_update_oxpconfig_vars();
            worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.functional = 100;
	    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version  = worldScripts[&quot;Shield Cycler&quot;]._sc_const.basic;
            break;
          case &quot;EQ_SC_SHIELD_CYCLER_STANDARD&quot;:
            player.ship.removeEquipment(equipmentKey);
            worldScripts[&quot;Shield Cycler&quot;]._sc_change_configuration(1, false);
	    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version  = worldScripts[&quot;Shield Cycler&quot;]._sc_const.standard;
            break;
          case &quot;EQ_SC_SHIELD_CYCLER_ADVANCED&quot;:
            player.ship.removeEquipment(equipmentKey);
            worldScripts[&quot;Shield Cycler&quot;]._sc_change_configuration(2, false);
	    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.version  = worldScripts[&quot;Shield Cycler&quot;]._sc_const.advanced;
            break;
          case &quot;EQ_SC_MANUAL_CONFIGURATOR_BASIC&quot;:
	    player.ship.removeEquipment(equipmentKey);
            player.ship.awardEquipment(&quot;EQ_SC_MANUAL_CONFIGURATOR_INTERNAL&quot;);
            worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.cycler_mask  = 0x00f;
	    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version  = worldScripts[&quot;Shield Cycler&quot;]._sc_const.basic;
            break;
          case &quot;EQ_SC_MANUAL_CONFIGURATOR_STANDARD&quot;:
	    player.ship.removeEquipment(equipmentKey);
	    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version  = worldScripts[&quot;Shield Cycler&quot;]._sc_const.standard;
            break;
          case &quot;EQ_SC_MANUAL_CONFIGURATOR_ADVANCED&quot;:
	    player.ship.removeEquipment(equipmentKey);
            worldScripts[&quot;Shield Cycler&quot;]._sc_change_configuration(3, false);
	    worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.manual_version  = worldScripts[&quot;Shield Cycler&quot;]._sc_const.advanced;
            break;
          case &quot;EQ_SC_SELL_MANUAL_CONFIGURATOR&quot;:
            player.credits = player.credits + worldscripts[&quot;Shield Cycler&quot;]._sc_remove_manual();
            break;
	  case &quot;EQ_SC_SELL_SHIELD_CYCLER&quot;:
            player.credits = player.credits + worldscripts[&quot;Shield Cycler&quot;]._sc_remove_shield_cycler();
            break;
	  case &quot;EQ_SC_SC_REPAIR&quot;:
            worldScripts[&quot;Shield Cycler&quot;]._sc_settings.sc.functional = 100;
	    break;
          default:
            break;
        };
  };
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/ShieldCycler.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;Shield Cycler&quot;;
this.author         = &quot;Lone_Wolf&quot;;
this.copyright      = &quot;(C) 2011-2012, 2014-2015 Lone_Wolf.&quot;;
this.licence        = &quot;CC-by-SA 4.0&quot;;
this.description    = &quot;Keeps shield energy aligned with a specific configuration&quot;;
this.version        = &quot;1.12&quot;;

/* Main script for Shield Cycler
 * + functions used in other SC scripts
 * + functions used by/for other oxps
*/

/* All settings that need saving are stored in missionVariables.sc_settings using JSON
   for ease of use &amp; performance the SC scripts internally use the object this._sc_settings / worldScripts[&quot;Shield Cycler&quot;]._sc_settings
     
	name				Type	Introduced in	Used by / Comment
	_sc_settings			obj	1.10
	  sc				obj	1.10
		threshold		int	0.21.2		OxpConfig
								    percentage, can be 0-100
		start_configuration     int	0.21.2		OxpConfig
								    number , 0 = disabled 1 = aft 2 = fwd 3 = equal
		current_configuration	int	1.10		shipscript events, equipment events
								    number , 0 = disabled 1 = aft 2 = fwd 3 = equal
		cycler_mask            	int	1.10		OxpConfig
								    bitmask (size = 4 ) used to keep track which settings are available for cycling
								    bit order (MSB first) : equal, forward, aft , disabled
								    bit = 1 : available, 0 not available
		functional		int	1.10		equipment condition script
								    percentage, 100 is fully functional, 20 is minimum 
								    for 1.10 only 100 is used
								    in 1.11+ this value will be decreased when EQ_SC_SHIELD_CYCLER_INTERNAL or EQ_SC_MANUAL_CONFIGURATOR_INTERNAL get hit
		version			int	0.21.2		SC_Core.js
								 number, 0=none 1 = basic , 2 = standard, 3 =advanced 
		manual_version		int	0.21.2		SC_Core.js
								 number, 0=none 1 = basic , 2 = standard, 3 =advanced 
          general			obj     1.10
		disabled		bool	1.10		if true, all devices handled by this oxp will do nothing
		sc_disabled		bool	1.10		if true, presence of EQ_SC_SHIELD_CYCLER_INTERNAL &amp; EQ_SC_MANUAL_CONFIGURATOR_INTERNAL will have no effect
		savegame_version	int	1.10		This is a special var intended to track missionVariables changes

  NOTE : missionvariables are loaded at startup, then converted into this._sc_setting object .
	 during game the missionvariables are NOT kept uptodate.
	 they are stored only when player saves game, done in SC_Worldscript_Events.js .

  equipment items
    EQ_SC_SHIELD_CYCLER_INTERNAL          - indicates any shield cycler/manual configurator is installed
    EQ_SC_SHIELD_CYCLER_BASIC
    EQ_SC_SHIELD_CYCLER_STANDARD
    EQ_SC_SHIELD_CYCLER_ADVANCED
    EQ_SC_MANUAL_CONFIGURATOR_INTERNAL    - present if a manual configurator is installed
    EQ_SC_MANUAL_CONFIGURATOR_BASIC
    EQ_SC_MANUAL_CONFIGURATOR_STANDARD
    EQ_SC_MANUAL_CONFIGURATOR_ADVANCED
    EQ_SC_SELL_SHIELD_CYCLER
    EQ_SC_SELL_MANUAL
    EQ_SC_SC_REPAIR
    
    NOTE EQ_SC_SHIELD_CYCLER_INTERNAL and EQ_SC_MANUAL_CONFIGURATOR_INTERNAL will be present in the savefile but NOT visible on the F5 equipment screen

*/

// RO stuff, i haven&#39;t been able to figure out how to make these read-only, so the values here can be changed by code, but that&#39;s not supposed to happen
this._sc_const =
  {
    none:0,basic:1,standard:2,advanced:3,
    cycle: { disabled:0,aft:1,forward:2,both:3,count:4 },
    names: [ &quot;Disabled&quot;,&quot;Aft&quot;,&quot;Forward&quot;,&quot;Equal&quot;],
    savegame_version:0
  };

// WORM stuff
this._sc_worm =
  {
    sc_cost: [0, 0, 0, 0 ],
    manual_cost: [ 0, 0, 0, 0 ]
  };
  
// R/W stuff
this._sc_settings =
  {
    sc:
      {
	threshold:100,
	start_configuration:this._sc_const.both,
	current_configuration:this._sc_const.both,
	cycler_mask:0x00f,
	functional:100,
	version:this._sc_const.none,
	manual_version:this._sc_const.none
      },
    general: { disabled:false,sc_disabled:false,savegame_version:this._sc_const.savegame_version }
  };
	
// Properties for internal use
this._sc_error = 0;
    /* used for error tracking
    * 0 = no error
    * 1 = savegame to old
    * 2 = savegame to new
    */

// for OxpConfig
// these need to be kept in sync at all times 
this._sc_oxp_status = this._sc_settings.general.disabled;
this._sc_sc_status = this._sc_settings.general.sc_disabled;
// only changed through oxpconfig, synced from this.oxpcNotifyOnChange()
this._sc_threshold = this._sc_settings.sc.threshold;
this._sc_start_configuration = this._sc_settings.sc.start_configuration;
this._sc_cycler_mask = this._sc_settings.sc.cycler_mask;
this.deactivated = false;
    /*  this property is used by OxpConfig to detect whether it should allow configuration changes.
	deactivated = false : default behaviour
	deactivated = true :  OxpConfig will not allow configuration changes
    */

this.oxpcSettings = 
  { 
    Info:
      {
        Name:&quot;Shield Cycler&quot;,DynamicNotify:true,LeaveData:true,
        InfoB:&quot;enable / disable Shield Cycler oxp functionality / the devices it manages&quot;,
        InfoS:&quot;Threshold % determines when adjusting is done. 100 = always, 0 = never. Start configuration is the configuration that will be set upon launch (3 = equal, 2 = fwd, 1= aft, 0 = disabled).&quot;,
        InfoE:&quot;enable / disable the availability of the settings for manual cycling. Note : if you disable all, Shield Cycler oxp will enable the disabled setting&quot;
      },
    Bool0: {Name:&quot;_sc_oxp_status&quot;,Def:false,Hide:false,Desc:&quot;disable SC OXP.&quot;},
    Bool1: {Name:&quot;_sc_sc_status&quot;,Def:false,Hide:false,Desc:&quot;disable cycler devices.&quot;},
    SInt0: {Name:&quot;_sc_threshold&quot;,Def:100,Max:100,Hide:true,Desc:&quot;threshold %&quot;},
    SInt1: {Name:&quot;_sc_start_configuration&quot;,Def:3,Max:3,Hide:true,Desc:&quot;launch setting&quot;},
    EInt0: {Name:&quot;_sc_cycler_mask&quot;,Def:0x001,Max:0x00f,Hide:true,Desc:[&quot;Disabled&quot;,&quot;Aft&quot;,&quot;Forward&quot;,&quot;Equal&quot;]}
  };

this.startUp = function()
  {
    // CCL &amp; OxpConfig are required for SC, but this is taken care of by Oolite itself through the manifest.plist file.
    // This version of SC requires 1.81+ , that is checked through manifest.plist &amp; requires.plist
    switch ( worldScripts[&quot;SC check savegame compatiblity&quot;]._sc_check_savegame(this._sc_settings.general.savegame_version) )
      {
	case 0:
	  // savegame to old
	  this._sc_settings.general.disabled = true;
	  this.deactivated= true;
	  this._sc_error = 1;
	  player.commsMessage(&quot;Your savegame is to old for this version of Shield Cycler&quot;,10);
	  player.commsMessage(&quot;Shield Cycler is DISABLING itself now&quot;,10);
	  player.commsMessage(&quot;ask for help on Oolite BBS.&quot;,10);
	  log(this.name,&quot; - DISABLED because savefile is to old&quot;);
	  break;
	case 1:
	  // savegame needs converting from old-style missionvars to JSON
	  worldScripts[&quot;SC savegame conversion&quot;]._sc_convert_0_21_2();
	  this._sc_update_oxpconfig_vars();
	  log(this.name,&quot; - savegame missionvars converted into _sc_settings&quot;);
	  break;
	case 2:
	  // missionvars not present, will be created when game is saved
	  break;
	case 3:
	  // everything in order, load missionvars
	  this._sc_settings = JSON.parse(missionVariables.sc_settings);
	  this._sc_update_oxpconfig_vars();
  	  if ( ( this._sc_settings.sc.version &gt; this._sc_const.basic ) ) { this._sc_change_configuration(1, false); };
	  if ( this._sc_settings.sc.version == this._sc_const.advanced ) { this._sc_change_configuration(2, false); };
	  if ( this._sc_settings.sc.manual_version == this._sc_const.advanced ) { this._sc_change_configuration(3, false); };	  
	  log(this.name,&quot; - savegame missionvars loaded&quot;);
	  break;
	case 4:
	  // savegame to new
	  this._sc_settings.general.disabled = true;
	  this.deactivated= true;
	  this._sc_error = 2;
	  player.commsMessage(&quot;Your savegame is to NEW for this version of Shield Cycler&quot;,10);
	  player.commsMessage(&quot;Shield Cycler is DISABLED&quot;,10);
	  player.commsMessage(&quot;ask for help on Oolite BBS.&quot;,10);
	  log(this.name,&quot; - DISABLED because savefile  is to NEW&quot;);
	  break;
	default:
	  break;
      };
    if ( !this._sc_settings.general.disabled )
      {
        // calculate total price values
        this._sc_worm.sc_cost[1] = EquipmentInfo.infoForKey(&quot;EQ_SC_SHIELD_CYCLER_BASIC&quot;).price;
        this._sc_worm.sc_cost[2] = this._sc_worm.sc_cost[1] + EquipmentInfo.infoForKey(&quot;EQ_SC_SHIELD_CYCLER_STANDARD&quot;).price;
        this._sc_worm.sc_cost[3] = this._sc_worm.sc_cost[2] + EquipmentInfo.infoForKey(&quot;EQ_SC_SHIELD_CYCLER_ADVANCED&quot;).price;
        this._sc_worm.manual_cost[1] = EquipmentInfo.infoForKey(&quot;EQ_SC_MANUAL_CONFIGURATOR_BASIC&quot;).price;
        this._sc_worm.manual_cost[2] = this._sc_worm.manual_cost[1] + EquipmentInfo.infoForKey(&quot;EQ_SC_MANUAL_CONFIGURATOR_STANDARD&quot;).price;
        this._sc_worm.manual_cost[3] = this._sc_worm.manual_cost[2] + EquipmentInfo.infoForKey(&quot;EQ_SC_MANUAL_CONFIGURATOR_ADVANCED&quot;).price;
      };
        
  delete this.startUp;
  };

// Helper functions for all SC scripts including this one
  this._sc_change_configuration = function(setting, hide)
  {
    // sets/resets visibility of configure options in OCPConfig
    switch ( setting )
      {
        case 1:
            this.oxpcSettings.SInt0.Hide = hide;
            break;
        case 2:
            this.oxpcSettings.SInt1.Hide = hide;
            break;
        case 3:
            this.oxpcSettings.EInt0.Hide = hide;
            break;
        default:
            break;
      };
  };
  
this._sc_update_oxpconfig_vars = function()
  {
    this._sc_oxp_status = this._sc_settings.general.disabled;
    this._sc_sc_status = this._sc_settings.general.sc_disabled;
    this._sc_threshold = this._sc_settings.sc.threshold;
    this._sc_start_configuration = this._sc_settings.sc.start_configuration;
    this._sc_cycler_mask = this._sc_settings.sc.cycler_mask;  
  };

this._sc_remove_manual = function()
  {
    // remove manual configurator devices only
    // returns refund value in credits
    var refund1 = this._sc_worm.manual_cost[this._sc_settings.sc.manual_version];
    refund1 = refund1 * this._sc_settings.sc.functional * 0.01;
    player.ship.removeEquipment(&quot;EQ_SC_MANUAL_CONFIGURATOR_INTERNAL&quot;);
    this._sc_settings.sc.manual_version  = this._sc_const.none;
    this._sc_settings.sc.cycler_mask  = 0x00f;
    this._sc_update_oxpconfig_vars();
    refund1 = parseInt(refund1 * 0.1 * 0.6);
    return refund1;
  };  

this._sc_remove_shield_cycler = function()
  {
    // remove all shield cycler devices
    // returns refund value in credits
    var refund1 = 0;
    // if manual configurator devices are present, remove them first
    if ( this._sc_settings.sc.manual_version != this._sc_const.none )
      {
        refund1 = this._sc_remove_manual();
      }
    refund1 = refund1 + this._sc_worm.sc_cost[ this._sc_settings.sc.version ];
    switch ( this._sc_settings.sc.version )
      {
        case this._sc_const.advanced:
           this._sc_change_configuration(2, true);
        case this._sc_const.standard:
           this._sc_change_configuration(1, true);
           break;
        default:
          break;
      };
    refund1 = refund1 * this._sc_settings.sc.functional * 0.01;
    player.ship.removeEquipment(&quot;EQ_SC_SHIELD_CYCLER_INTERNAL&quot;);
    this._sc_settings.sc.version  = this._sc_const.none;
    this._sc_settings.sc.start_configuration = this._sc_const.both;
    this._sc_settings.sc.threshold = 100;
    this._sc_update_oxpconfig_vars();
    this._sc_settings.sc.functional = 100;
    refund1 = parseInt(refund1 * 0.1 * 0.6);
    return refund1;
  };
  

  
// functions for use by other oxps

this._sc_stop = function(device)
  {
/*	device is a string to indicate which devices handled by SC oxp need to be stopped
	currently has 2 possible values : 
	&quot;ALL&quot; : disable all devices
	&quot;SC&quot; : disables just the shieldcycler
	In future versions there will be more options

	returns
	-3 if SC was disabled
	-2 if device was stopped already
	-1 device string invalid
	0 if stopping was succesfull
	NOTE : no messages to player or logfile, imo this is the responsibility of the calling oxp
	NOTE : calling worldScripts[&quot;Shield Cycler&quot;]._sc_stop(&quot;SC&quot;) DOES NOT disable the entire oxp.
*/
    var success = -3;
    if ( this._sc_error == 0 )
      {
	switch ( device )
	  {
	    case &quot;ALL&quot;:
	      if ( this._sc_settings.general.disabled )
		{ success = -2; }
	      else 
		{ 
		  this._sc_settings.general.disabled = true;
		  this._sc_update_oxpconfig_vars();
		  success = 0;
		};
	      break;
	    case &quot;SC&quot;:
	      if ( this._sc_settings.general.sc_disabled )
		{ success = -2; }
	      else
		{
		  this._sc_settings.general.sc_disabled = true;
		  this._sc_update_oxpconfig_vars;
		  success = 0;
		};
	      break;
	    default:
	      succes = -1;
	      break;
	  };
      };
    return success;
  };

this._sc_start = function(device)
  {
/*	device is a string to indicate which devices handled by SC oxp need to be started
	currently has 2 possible values : 
	&quot;ALL&quot; : start all devices
	&quot;SC&quot; : start just the shieldcycler

	returns
	-3 if SC is disabled
	-2 if device was started already
	-1 device string invalid
	0 if starting was succesfull
	Note : no messages to player or logfile, imo this is the responsibility of the calling oxp
*/
    var success = -3;
    var adjust_error = 0;
    if ( this._sc_error == 0 )
      {
	switch ( device )
	  {
	    case &quot;ALL&quot;:
	      if ( !this._sc_settings.general.disabled )
		{ success = -2; }
	      else
		{
		  this._sc_settings.general.disabled = false;
		  this._sc_settings.general.sc_disabled = false;
		  this._sc_update_oxpconfig_vars();
		  // start sc_device
		  if ( this._sc_settings.sc.version &gt; this._sc_const.none ) 
		    { 
		      adjust_error = worldScripts[&quot;SC Core&quot;]._sc_sc_adjust(true);
		      if ( adjust_error &lt; 0 )
			{
			  player.commsMessage(&quot;ERROR while starting shield cycler device, check latest log&quot;,10); 
			  log(this.name,&quot; unable to adjust shields while starting entire oxp&quot;);
			};
		    };
		  success = 0;
		};
	      break;
	    case &quot;SC&quot;:
	      if ( !this._sc_settings.general.sc_disabled )
		{ success = -2; }
	      else
		{
		  this._sc_settings.general.sc_disabled = false;
		  this._sc_update_oxpconfig_vars();
		  if ( this._sc_settings.sc.version &gt; this._sc_const.none ) 
		    { 
		      adjust_error = worldScripts[&quot;SC Core&quot;]._sc_sc_adjust(true);
		      if ( adjust_error  &lt; 0 )
			{
			  player.commsMessage(&quot;ERROR while starting shield cycler device, check latest log&quot;,10); 
			  log(this.name,&quot; unable to adjust shields while starting sc device&quot;);
			};
		      success = 0;
		    };
		};
	      break;
	    default:
	      success = -1;
	      break;
	  };
      };
    return success;
  };


this._sc_store_devices = function()
  {
    // Shield Cycler devices are not portable between ships and will stay that way.
    // This poses a problem for oxps (like Ship Storage Helper) that store ships for later retrieval
    // returns an object with 2 strings :
    // first holds SC values in JSON format
    // second is encrypted version of first
    var sc_values =
      {
        json: &quot;&quot;,
        enc: &quot;&quot;
      };
    sc_values.json = JSON.stringify(this._sc_settings);
    var helper = new worldScripts.Cabal_Common_Functions.Cabal_Common();
    sc_values.enc = helper.strEncrypt( sc_values.json, &quot;ShieldCycler&quot; );
    // since ship is stored, ignore refund
    var temp = this._sc_remove_shield_cycler();
    return sc_values;
  }
  
this._sc_retrieve_devices = function(sc_values)
  {
    // counterpart of this._sc_store_devices
    // input : an object created by this._sc_store_devices
    // returns a code value :
    // 0 : import sucessfull
    // 1 : input != an object
    // 2 : object has wrong structure
    // 3 : invalid json data
    // 4 : plain version doesn&#39;t match encrypted version
    // 5 : stored data to old
    // 6 : stored data to new
    
    if ( typeof sc_values !== &quot;object&quot; ) { return 1; };
    if ( typeof sc_values.json !== &quot;string&quot; || sc_values.enc !== &quot;string&quot; ) { return 2; };
    var temp = &quot;&quot;;
    try
      { temp = JSON.parse(sc_values.json) }
    catch(e)
      { return 3; };
    var helper = new worldScripts.Cabal_Common_Functions.Cabal_Common();
    if ( sc_values.json !== helper.strDecrypt( sc_values.json, &quot;ShieldCycler&quot; ) ) { return 4; };
    // Data is valid JSON and created by SC
    var version_diff = parseInt( this._sc_settings.general.savegame_version - sc_values.general.savegame_version  ) ;
    if ( version_diff &lt; -1 ) { return 5;} ; // to old
    if ( version_diff &gt; 1 ) { return 6; } ; // to new
    // version_diff == 1 is impossible for now, but in future versions it will indicate conversion is needed
    // only case left is when version_diff == 0
    this._sc_settings = temp;
    this._sc_update_oxpconfig_vars();
    if ( ( this._sc_settings.sc.version &gt; this._sc_const.basic ) ) { this._sc_change_configuration(1, false); };
    if ( this._sc_settings.sc.version == this._sc_const.advanced ) { this._sc_change_configuration(2, false); };
    if ( this._sc_settings.sc.manual_version == this._sc_const.advanced ) { this._sc_change_configuration(3, false); };     
    log(this.name,&quot; - imported stored ship data&quot;);
    return 0;
  };

// OXPConfig2 related

this.oxpcNotifyOnChange = function(n)
  {
    // called by OXPConfig when player changes values
    switch (n)
      {
	case 1:
	  // booleans changed
	  var error = 0;
	  if ( this._sc_oxp_status !== this._sc_settings.general.disabled )
	    {
	      var old_status = this._sc_settings.general.disabled;
	      error = ( this._sc_oxp_status ) ? this._sc_stop(&quot;ALL&quot;) : this._sc_start(&quot;ALL&quot;);
	      if ( error == 0 )
		{ 
		  this._sc_settings.general.disabled = this._sc_oxp_status;
		}
	      else
		{ 
		  log(this.name,&quot; old value:&quot; + old_status);
		  log(this.name,&quot; new value:&quot; + this._sc_oxp_status);
		  log(this.name,&quot; - problem with applying change for SC oxp status&quot;);
		  this._sc_oxp_status = old_status;
		};
	    }
	  else
	    {
	      if ( this._sc_sc_status !== this._sc_settings.general.sc_disabled )
		{
		  if ( this._sc_settings.sc.version &gt; this._sc_const.none )
		    {
		      this._sc_sc_status = this._sc_settings.general.sc_disabled;
		      log(this.name,&quot; Buy a shieldcycler before you try to change it&#39;s status !&quot;);
		    }
		  else
		    {
		      old_status = this._sc_settings.general.sc_disabled;
		      if ( this._sc_sc_status ) { error = this._sc_stop(&quot;SC&quot;); } else { error = this._sc_start(&quot;SC&quot;); }
		      if ( error == 0 )
			{ 
			  this._sc_settings.sc.general.sc_disabled = this._sc_sc_status;
			}
		      else
			{ 
			  log(this.name,&quot; old value:&quot; + this._sc_settings.general.sc_disabled );
			  log(this.name,&quot; new value:&quot; + this._sc_sc_status );
			  log(this.name,&quot; - problem with applying change for SC device status&quot;);
			  this._sc_sc_status = old_status;
			};
		    };
		};
	    };
	  break;
	case 2:
	  // integers changed
	  this._sc_settings.sc.threshold = this._sc_threshold;
	  this._sc_settings.sc.start_configuration = this._sc_start_configuration;
	  break;
	case 4:
	  // bitmask changed
	  if ( this._sc_cycler_mask == 0x000 ) { this._sc_cycler_mask = 0x001;}
	  this._sc_settings.sc.cycler_mask = this._sc_cycler_mask;
	  break;
	default:
	  break;
      };
  };
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
