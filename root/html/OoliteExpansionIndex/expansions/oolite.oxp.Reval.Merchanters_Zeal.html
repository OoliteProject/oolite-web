<html>
    <head>
        <title>Expansion Merchanter&#39;s Zeal</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Merchanter&#39;s Zeal</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>http://wiki.alioth.net/index.php/Merchanter&#39;s%20Zeal -&gt; 404 Not Found</li>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Join the Merchanters&#39; League for free, accurate, and succinct advice on buy- and sell-prices at every station in every system you visit. Advisories via the F4 Interface as well as witchpoint in-flight comms. MZ uses your trading history as its basis for buy-advice, and for sell-advice your own hold&#39;s manifest. It makes an ideal pairing with the lucrative More Moolah Market (MZ + MM = $$$)</td>
                    <td>Join the Merchanters&#39; League for free, accurate, and succinct advice on buy- and sell-prices at every station in every system you visit. Advisories via the F4 Interface as well as witchpoint in-flight comms. MZ uses your trading history as its basis for buy-advice, and for sell-advice your own hold&#39;s manifest. It makes an ideal pairing with the lucrative More Moolah Market (MZ + MM = $$$)</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Reval.Merchanters_Zeal</td>
                    <td>oolite.oxp.Reval.Merchanters_Zeal</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Merchanter&#39;s Zeal</td>
                    <td>Merchanter&#39;s Zeal</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Reval</td>
                    <td>Reval</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.1</td>
                    <td>1.1</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/c/ca/Merchanters_Zeal.oxz">https://wiki.alioth.net/img_auth.php/c/ca/Merchanters_Zeal.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1671375624</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/mz_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Merchanter&#39;s Zeal&quot;;
this.author = &quot;Reval&quot;;
this.version = &quot;1.1&quot;;
this.license = &quot;CC-BY-NC-SA 4.0&quot;;
this.description = &quot;Join the Merchanters&#39; League for free, accurate, and succinct advice on buy- and sell-prices at every station in every system you visit. Advisories via the F4 Interface as well as witchpoint in-flight comms. MZ uses your trading history as its basis for buy-advice, and for sell-advice your own hold&#39;s manifest. It makes an ideal pairing with the lucrative More Moolah Market (MZ + MM = $$$)&quot;;


this.startUp = function() {
	// buy &#39;histories&#39;
	this.$mzIndBuy = new Array();
	this.$mzAgrBuy = new Array();
	// balance necessary b/f WPSA kicks in
	this.$mzWPThresh = 2000;
}


this.startupComplete = function() {
	// load buy &#39;histories&#39;
	var buy = missionVariables.mzAgrBuy; if (buy!=null) 
		this.$mzAgrBuy = JSON.parse(missionVariables.mzAgrBuy);
	buy = missionVariables.mzIndBuy; if (buy!=null)
		this.$mzIndBuy = JSON.parse(missionVariables.mzIndBuy);

	this.$mzSystem = System.systemNameForID(system.ID);
	var p = player.ship;
	var pc = player.commsMessage;
	// dock ship
	var sta = p.dockedStation;
	pc(&quot;The Merchanters&#39; League welcomes you to &quot;+this.$mzSystem+&quot;!&quot;,7);
	pc(&quot;Please check our special advisories on your F4 Interface.&quot;,7);
	// prep ML Advisory interfaces
	this._mzPrepSales(sta);
	this._mzPrepBuy(sta);
}


this.playerWillSaveGame = function(message) {
	// save buy &#39;histories&#39;
	missionVariables.mzAgrBuy = JSON.stringify(this.$mzAgrBuy);
	missionVariables.mzIndBuy = JSON.stringify(this.$mzIndBuy);
}



this.shipDockedWithStation = function(station) {
	this.$mzSystem = System.systemNameForID(system.ID);
	var p = player.ship;
	var pc = player.commsMessage;
	// dock ship
	pc(&quot;The Merchanters&#39; League welcomes you to &quot;+this.$mzSystem+&quot;!&quot;,7);
	pc(&quot;Please check our special advisories on your F4 Interface.&quot;,7);
	// prep ML Advisory interfaces
	this._mzPrepSales(station);
	this._mzPrepBuy(station);
}


this.shipWillEnterWitchspace = function() {
	var ml = manifest.list;
	var pc = player.commsMessage;
	// note what was bought in last system
	var ind = (system.economy&lt;4);
	if (ind) this.$mzIndBuy = ml; 
		else this.$mzAgrBuy = ml;
}


this.shipExitedWitchspace = function() {
	this.$mzSystem = System.systemNameForID(system.ID);
	// witchpoint sell-advisory via comms
	if (player.credits &gt; this.$mzWPThresh)
		this._mzSellAdvisory();
}


// witchpoint sell-advisory via comms
this._mzSellAdvisory = function() {
	var s=system.stations, ml = manifest.list;
	var pc = player.commsMessage, ps = player.ship;
	var col = ps.messageGuiTextCommsColor;
	ps.messageGuiTextCommsColor = &quot;orangeColor&quot;;
	// prices of ship&#39;s hold commodities, plus quantity
	var i = 0, c = 0;
	for (i=0; i&lt;s.length; i++) {
		if (s[i].name!=&quot;Rock Hermit&quot;) { 
			for (c=0; c&lt;ml.length; c++)
				pc(s[i].name + &quot;: &quot; + ml[c].displayName + &quot; @ &quot; + this._mzMPrice(s[i],ml[c].commodity) + &quot; (&quot; + this._mzMQuantity(s[i],ml[c].commodity) + &quot;)&quot;,9);
		}
		pc(&quot; &quot;);
	}
	ps.messageGuiTextCommsColor = col;
}



/* helper functions */

// price of a good at a given station, in cr
this._mzMPrice = function(sta, good) {
	var price=0.0, mar=sta.market;
	price = mar[good].price/10;
	return price.toFixed(1);
}


// quantity of a good at a given station
this._mzMQuantity = function(sta, good) {
	var quant=0, mar=sta.market;
	quant = mar[good].quantity;
	return quant;
}



// F4 Interface Advisories


// create Sales Advisory on the F4 Interfaces screen
this._mzPrepSales = function(station) {
	station.setInterface(&quot;mzSales&quot;,{
	title: &quot;ML Quick Sell Advisory&quot;,
	category: &quot;$$ Merchanters&#39; League&quot;,
	summary: &quot;Sell-advice from the &quot;+this.$mzSystem+&quot; Merchanters&#39; League.&quot;,
	callback: this._mzShowSales.bind(this)
	});	
}


// sell advice from the Merchanters&#39; League
this._mzShowSales = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$mzSystem+&quot; Merchanters&#39; League: Sell!&quot;;
	
	parameters.message = &quot;&quot;;
	
	var s=system.stations, ml = manifest.list;
	// prices of ship&#39;s hold commodities, plus quantity
	var i = 0, c = 0;
	for (i=0; i&lt;s.length; i++) {
		if (s[i].name!=&quot;Rock Hermit&quot;) { 
			for (c=0; c&lt;ml.length; c++)
				parameters.message += s[i].name + &quot;: &quot; + ml[c].displayName + &quot; @ &quot; + this._mzMPrice(s[i],ml[c].commodity) + &quot; (&quot; + this._mzMQuantity(s[i],ml[c].commodity) + &quot;) \n&quot;;
			parameters.message += &quot; \n&quot;;
		}
	}

	parameters.choicesKey = &quot;mzAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;Luck in the Markets!&quot;);
	}
}



// create Buy Advisory on the F4 Interfaces screen
this._mzPrepBuy = function(station) {
	station.setInterface(&quot;mzBuy&quot;,{
	title: &quot;ML Quick Buy Advisory&quot;,
	category: &quot;$$ Merchanters&#39; League&quot;,
	summary: &quot;Buy-advice from the &quot;+this.$mzSystem+&quot; Merchanters&#39; League.&quot;,
	callback: this._mzShowBuy.bind(this)
	});	
}


// buy advice from the Merchanters&#39; League
this._mzShowBuy = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$mzSystem+&quot; Merchanters&#39; League: Buy!&quot;;
	
	parameters.message = &quot;&quot;;
	
	var s=system.stations, ind = (system.economy&lt;4);

	// use buy history from last agricultural or industrial system
	if (ind) var hist = this.$mzIndBuy; else var hist = this.$mzAgrBuy;
	// check that there _is_ a buying history
	if (hist.length==0) { 
		// there is no buying history
		parameters.message += &quot;You have no buying-history yet, but here&#39;s our advice on two prime stock commodities...\n\n&quot;; 
			var i = 0;
			if (ind) {
			for (i=0; i&lt;s.length; i++) { 
				if (s[i].name!=&quot;Rock Hermit&quot;) { 
					parameters.message += s[i].name + &quot;: Computers @ &quot; + this._mzMPrice(s[i],&quot;computers&quot;) + &quot; (&quot; + this._mzMQuantity(s[i],&quot;computers&quot;) + &quot;) \n&quot;;
					parameters.message += s[i].name + &quot;: Luxuries @ &quot; + this._mzMPrice(s[i],&quot;luxuries&quot;) + &quot; (&quot; + this._mzMQuantity(s[i],&quot;luxuries&quot;) + &quot;) \n\n&quot;;
				}
			}
		} else {
			for (i=0; i&lt;s.length; i++) { 
				if (s[i].name!=&quot;Rock Hermit&quot;) {
					parameters.message += s[i].name + &quot;: Pelts &amp; Furs @ &quot; + this._mzMPrice(s[i],&quot;furs&quot;) + &quot; (&quot; + this._mzMQuantity(s[i],&quot;furs&quot;) + &quot;) \n&quot;;
					parameters.message += s[i].name + &quot;: Wines &amp; Spirits @ &quot; + this._mzMPrice(s[i],&quot;liquor_wines&quot;) + &quot; (&quot; + this._mzMQuantity(s[i],&quot;liquor_wines&quot;) + &quot;) \n\n&quot;;
				}
			}
		}
		parameters.message += &quot;\n&quot;;
	}
	// there _is_ a buying history
	else {

		// prices of ship&#39;s last hold commodities, plus quantity
		var i = 0, c = 0;
		for (i=0; i&lt;s.length; i++) {
			if (s[i].name!=&quot;Rock Hermit&quot;) { 
				for (c=0; c&lt;hist.length; c++)
					parameters.message += s[i].name + &quot;: &quot; + hist[c].displayName + &quot; @ &quot; + this._mzMPrice(s[i],hist[c].commodity) + &quot; (&quot; + this._mzMQuantity(s[i],hist[c].commodity) + &quot;) \n&quot;;
				parameters.message += &quot; \n&quot;;
			}
		}
	}
	
	parameters.choicesKey = &quot;mzAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;Luck in the Markets!&quot;);
	}
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
