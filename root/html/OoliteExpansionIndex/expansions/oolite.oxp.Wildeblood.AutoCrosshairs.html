<html>
    <head>
        <title>Expansion Auto Crosshairs</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Auto Crosshairs</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>License not specified</li>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER C)(&#39;[]&#39; vs &#39;[crosshairs]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Once the equipment is purchased, the cross-hairs change shape to alert the pilot to the precise moment a target is centred. Please use responsibly - Wildefire Systems does not endorse or condone hostility between spacefarers. The equipment can be bought at space ports with a technological level of 11 or above, for 1750 credits.</td>
                    <td>Once the equipment is purchased, the cross-hairs change shape to alert the pilot to the precise moment a target is centred. Please use responsibly - Wildefire Systems does not endorse or condone hostility between spacefarers. The equipment can be bought at space ports with a technological level of 11 or above, for 1750 credits.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Wildeblood.AutoCrosshairs</td>
                    <td>oolite.oxp.Wildeblood.AutoCrosshairs</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Auto Crosshairs</td>
                    <td>Auto Crosshairs</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Wildeblood</td>
                    <td>Wildeblood</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.1.1</td>
                    <td>1.1.1</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>crosshairs</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Auto_Crosshairs">http://wiki.alioth.net/index.php/Auto_Crosshairs</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/5/5a/AutoCrosshairs_1.1.1.oxz">https://wiki.alioth.net/img_auth.php/5/5a/AutoCrosshairs_1.1.1.oxz</a></td>
                    <td><a target="_blank" href="AutoCrosshairs_1.1.1.oxz">AutoCrosshairs_1.1.1.oxz</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873303</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Auto%20Crosshairs'>http://wiki.alioth.net/index.php/Auto%20Crosshairs</a></p>
        <h3>Auto Crosshairs READ ME.txt</h3>
        <pre>------------------------------
Auto Crosshairs OXP ver. 1.1.1
------------------------------
  Date: October 5th, 2014
Author: Wildeblood


---------------------
Installation and use:
---------------------

This OXP adds an equipment item which changes the way the gun-sight cross-hairs behave in Oolite. In standard Oolite the cross-hairs are static, and only differ in appearance depending on the type of weapons installed. With this OXP installed, once the equipment (the Wildefire Systems Type 4 Gunsight) is purchased, the cross-hairs change shape to alert the pilot to the precise moment a target is centred. Please use responsibly - Wildefire Systems does not endorse or condone hostility between spacefarers.

Simply place the Auto Crosshairs OXP into your &quot;AddOns&quot; folder. The equipment can be bought at space ports with a technological level of 11 or above, for 1750 credits. Only usable with Oolite 1.77 or later. No configuration is needed or normally possible. For players who can&#39;t resist tinkering inside OXPs, there is a parameter at the top of the javascript file (this.$precision = 2; // Whole number 1-5), you could experiment with.


----------------------------------
Customizing the cross-hair design:
----------------------------------

To use a different cross-hairs file to the included one there is no need to modify this OXP; Auto Crosshairs can automatically detect and use patches for it in other OXPs. Create a file with the design of cross-hairs you want to use when on target. In any world script (script.js file):

this.name = &quot;Any name will work&quot;;
this.version = &quot;1.0&quot;;

Define an object called $autoCrosshairs, and within it an object with the same name as your HUD file:

this.$autoCrosshairs = {};
this.$autoCrosshairs[&quot;hud.plist&quot;] = {};

Then define two properties called off and on with the names of the cross-hair files you want to use when the target is off-centre or on-centre:

this.$autoCrosshairs[&quot;hud.plist&quot;].off = &quot;crosshairs.plist&quot;;
this.$autoCrosshairs[&quot;hud.plist&quot;].on = &quot;my_fancy_on_target_crosshairs.plist&quot;;

You can declare the whole $autoCrosshairs object simply like this:-

this.$autoCrosshairs = {
    &quot;hud.plist&quot;: {
        off: &quot;crosshairs.plist&quot;,
        on: &quot;my_fancy_on_target_crosshairs.plist&quot;
    }
}

That example will associate your fancy on-target crosshairs with the default HUD and crosshairs. You can also associate crosshair files with a specific HUD file, e.g.:

this.$autoCrosshairs = {
    &quot;coluber_hud_ch01.plist&quot;: {
        off: &quot;coluber_hud_ch01_off_target_crosshairs.plist&quot;,
        on: &quot;coluber_hud_ch01_on_target_crosshairs.plist&quot;
    }
}

It does not matter whether these patches for Auto Crosshairs are in the same OXP as their associated HUD or another OXP.


-----------
Change Log:
-----------

1.1.1 (October 5th, 2014) Discard HUD settings if HUD file changes.

1.1 (October 2nd, 2014) Same as version 1.0.88.

1.0.88 (October 2nd, 2014) Ver 1.1 beta: because a crosshair reset causes a HUD reset, this now saves and routinely restores reticleTargetSensitive, scannerNonLinear, and scannerUltraZoom settings. (I think this is wrong, but the commoonity seem to think it is right. Too bad if another script is actually trying to change these settings on the fly.) A backup copy of the version 1.0.77 script remains inside.

1.0.77 (October 1st, 2014) Ver 1.1 beta: enhanced patchability.

1.0.66 (September 30th, 2014) Ver 1.1 beta: automatically detects patch files at start-up.

1.0.5 (September 29th, 2014) Bug fix: check that on-target crosshairs file isn&#39;t accidentally recorded as off-target file.

1.0.4 (May 23rd, 2013) Bug introduced in 1.0.3 fixed, and new on-target cross-hair design.

1.0.3 (May 22nd, 2013) Added alternative cross-hair for mining laser.

1.0.2 (May 20th, 2013) Better compatibility with other cross-hair switching OXPs.

1.0.1 (May 20th, 2013) Bug fix: stop frame callback if equipment is damaged.

1.0 (May 20th, 2013) First published.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_AUTO_CROSSHAIRS.html">Auto Crosshairs</a></td>
                    <td>yes</td>
                    <td align="right">17500</td>
                    <td align="center">11+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name    = &quot;Auto Crosshairs&quot;;
this.version = &quot;1.1.1&quot;;

/* ====================================================================================
			OTHER SCRIPTS CAN SAFELY TWIDDLE THIS AT ANY TIME...
======================================================================================= */

this.$precision = 2; // Whole number 1-5

/* ====================================================================================
			STARTING &amp; STOPPING FRAME CALLBACK
======================================================================================= */

    this.shipTargetAcquired = function (target) {
        &quot;use strict&quot;;
        if (player.ship.equipmentStatus(&quot;EQ_AUTO_CROSSHAIRS&quot;) === &quot;EQUIPMENT_OK&quot;) {
            if (this.$crosshairs[player.ship.hud]) {
                this.$onTargetCrosshairs  = this.$crosshairs[player.ship.hud].on;
                this.$offTargetCrosshairs = this.$crosshairs[player.ship.hud].off;
            } else {
                this.$onTargetCrosshairs  = this.$crosshairs.default.on;
                this.$offTargetCrosshairs = this.$crosshairs.default.off;
            //    if (player.ship.crosshairs != this.$onTargetCrosshairs) {
            //        this.$offTargetCrosshairs = player.ship.crosshairs;
            //    }
            }
            if (this.$offTargetCrosshairs === null) {
                this.$ooliteQuirk = [
                    player.ship.hud,
                    player.ship.reticleTargetSensitive,
                    player.ship.scannerNonLinear,
                    player.ship.scannerUltraZoom
                ];
            }
            this.$runningFCB = addFrameCallback(this._targetAlert.bind(this));
        }
    }

    this._ooliteQuirk = function () {
        &quot;use strict&quot;;
        if (player.ship.hud == this.$ooliteQuirk[0]) {
            player.ship.reticleTargetSensitive = this.$ooliteQuirk[1];
            player.ship.scannerNonLinear = this.$ooliteQuirk[2];
            player.ship.scannerUltraZoom = this.$ooliteQuirk[3];
        } else {
            // The HUD has changed, so preserving these settings is no longer our responsibility.
            delete this.$ooliteQuirk;
        }
    }

    this.shipWillDockWithStation = this.shipWillEnterWitchspace = this.shipDied = function () {
        &quot;use strict&quot;;
        this._removeFCB();
    }

    this.equipmentDamaged = this.equipmentDestroyed = function (equipment) {
        &quot;use strict&quot;;
        if (equipment === &quot;EQ_AUTO_CROSSHAIRS&quot;) {
            this._removeFCB();
        }
    }

    this._removeFCB = function () {
        &quot;use strict&quot;;
        if (this.$runningFCB) {
            removeFrameCallback(this.$runningFCB);
            delete this.$runningFCB;
            delete this.$currentState;
            player.ship.crosshairs = this.$offTargetCrosshairs;
            if (this.$ooliteQuirk) {
                this._ooliteQuirk();
                delete this.$ooliteQuirk;
            }
        }
    }

/* ====================================================================================
			TARGET SENSITIVITY (FRAME CALLBACK)
======================================================================================= */

    this._targetAlert = function () {
        &quot;use strict&quot;;
        var self = player.ship;
        if (self.target) {
            var target = self.target;
            var range  = target.position.distanceTo(self.position) - target.collisionRadius;
            var deviation;
            switch (self.viewDirection) {
                case &quot;VIEW_FORWARD&quot;:   deviation = self.vectorForward.angleTo(target.position.subtract(self.position)) * range; break;
                case &quot;VIEW_AFT&quot;:       deviation = self.vectorForward.angleTo(self.position.subtract(target.position)) * range; break;
                case &quot;VIEW_PORT&quot;:      deviation = self.vectorRight.angleTo(self.position.subtract(target.position)) * range;   break;
                case &quot;VIEW_STARBOARD&quot;: deviation = self.vectorRight.angleTo(target.position.subtract(self.position)) * range;   break;
                default:               deviation = self.vectorForward.angleTo(target.position.subtract(self.position)) * range; // forward
            }
            if (deviation &lt; target.collisionRadius / this.$precision) {
                if (this.$currentState === &quot;ON_TARGET&quot;) {
                    return;
                }
                player.ship.crosshairs = this.$onTargetCrosshairs;
                this.$currentState = &quot;ON_TARGET&quot;;
                return;
            } else {
                if (this.$currentState === &quot;OFF_TARGET&quot;) {
                    return;
                }
                player.ship.crosshairs = this.$offTargetCrosshairs;
                if (this.$ooliteQuirk) {
                    this._ooliteQuirk();
                }
                this.$currentState = &quot;OFF_TARGET&quot;;
                return;
            }
        } else { // If player.ship.target is gone.
            this._removeFCB();
        }
    }

/* ====================================================================================
			SCAN FOR SPECIAL HUDs AT STARTUP...
======================================================================================= */

    this.startUpComplete = function () {
        &quot;use strict&quot;;
        if (!this.$crosshairs) {
            this.$crosshairs = {default: {off: null, on: &quot;auto-crosshairs-on-target.plist&quot;}};
        }
        var scriptName;
        var arrayLength = worldScriptNames.length;
        for (var i = 0; i &lt; arrayLength; i++) {
            scriptName = worldScriptNames[i];
            if (worldScripts[scriptName].$autoCrosshairs) {
                var definition = worldScripts[scriptName].$autoCrosshairs;
                for (prop in definition) {
                    this.$crosshairs[prop] = {};
                    this.$crosshairs[prop].off = definition[prop].off;
                    this.$crosshairs[prop].on = definition[prop].on;
                }
            }
        }
        delete this.startUpComplete;
    }

/* ====================================================================================
			COPYRIGHT NOTICE

	(C) 2013,2014 Wildeblood. All rights reserved. 
	Free to use, but DO NOT PROMULGATE MODIFIED VERSIONS.

This was created by some fellow with the user name &quot;Wildeblood&quot; on the Oolite forums, 
he&#39;ll tell you his real name if you bother to ask.
To use means to play with, modify or re-use in whole or in part, and to distribute freely.
To use DOES NOT imply to use for commercial gain, which would be a breach of copyright.
To promulgate means to make official announcements.
======================================================================================= */</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
