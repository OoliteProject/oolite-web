<html>
    <head>
        <title>Expansion Laser Arrangement</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Laser Arrangement</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN CAPITAL LETTER E)(&#39;[]&#39; vs &#39;[Equipment, Weapons]&#39;)</li>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Allows lasers to be moved between the different laser mounts available on the ship, when docked.</td>
                    <td>Allows lasers to be moved between the different laser mounts available on the ship, when docked.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.phkb.LaserArrangement</td>
                    <td>oolite.oxp.phkb.LaserArrangement</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Laser Arrangement</td>
                    <td>Laser Arrangement</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>phkb</td>
                    <td>phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.3</td>
                    <td>1.3</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>Equipment, Weapons</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/6/68/LaserArrangement.oxz">https://wiki.alioth.net/img_auth.php/6/68/LaserArrangement.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873324</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Laser%20Arrangement'>http://wiki.alioth.net/index.php/Laser%20Arrangement</a></p>
        <h3>readme.txt</h3>
        <pre>Laser Arrangement
by Nick Rogers

Overview
========
This OXP allows for lasers to be moved from one position to another, when docked. This allows commanders to quickly customise their ship, without needing to visit the F3 screen and fiddling about with selling and then repurchasing lasers.

Operations
==========
A new F4 Interface page will be available in all stations, called &quot;Laser arrangement&quot;, under &quot;Ship Systems&quot;. When you select this option, the current set of installed lasers will be shown in each of their respective positions. A menu will be shown allowing for one of these lasers to be selected.

After selecting a laser, the destination position can be chosen. This can either be an empty laser position, or a position with an existing laser. In the case where a laser is already installed in the desired destination, the two lasers will be swapped.

Note: The interface will only be available if there is more than one laser mount available in the current ship.

License
=======
This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/

Version History
===============
1.3
- Code tweaks for integration with planned OXP&#39;s.

1.2
- Unable to move a laser into the aft position.

1.1
- Restricted movement of multiple laser installations to only those positions with the same number of laser installations.

1.0
- Initial release.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.author = &quot;phkb&quot;;
this.copyright = &quot;2018 phkb&quot;;
this.description = &quot;Allows lasers to be moved to different mounts, when docked&quot;;
this.name = &quot;LaserArrangement&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;

this._page = 0;
this._selected = &quot;&quot;;
this._selectedName = &quot;&quot;;
this._multiple = 1;

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function () {
    this.$initInterface(player.ship.dockedStation);
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillDockWithStation = function (station) {
    this.$initInterface(station);
}

//-------------------------------------------------------------------------------------------------------------
this.playerBoughtNewShip = function (ship, price) {
    this.$initInterface(player.ship.dockedStation);
}

//-------------------------------------------------------------------------------------------------------------
// establishes the F4 interface for switching laser mounts while docked
this.$initInterface = function $initInterface(station) {
    // can only move lasers if there is more than one mount to move them between
    // 0 = none, 1 = forward only
    if (player.ship.weaponFacings &gt; 1) {
        station.setInterface(this.name, {
            title: &quot;Laser arrangement&quot;,
            category: &quot;Ship Systems&quot;,
            summary: &quot;Allows lasers to be moved between the different mounts available on the ship.&quot;,
            callback: this.$showInitial.bind(this)
        });
    } else {
        station.setInterface(this.name, null);
    }
}

//-------------------------------------------------------------------------------------------------------------
this.$showInitial = function $showInitial() {
    this._page = 0;
    this._selected = &quot;&quot;;
    this.$showPage();
}

//-------------------------------------------------------------------------------------------------------------
this.$showPage = function $showPage() {
	var p = player.ship;
	var curChoices = {};
    var text = &quot;&quot;;
    var col1 = 10;    
	var def = &quot;99_EXIT&quot;;
    var laserName = &quot;&quot;;
    var laserEq = &quot;&quot;;

    var bl = worldScripts.BreakableLasers_Main;

    if (this._page === 0) {
        text = &quot;Select the laser you want to move:\n\n&quot;;

        if (worldScripts.LMSS_Core &amp;&amp; (p.equipmentStatus(&quot;EQ_LMSS_ACTIVATOR&quot;) === &quot;EQUIPMENT_OK&quot;)) {
            curChoices[&quot;00_LMSS&quot;] = {
                text: &quot;LMSS dockside services&quot;
            };
        }

        if (&quot; 1 3 5 7 9 11 13 15 &quot;.indexOf(&quot; &quot; + p.weaponFacings.toString() + &quot; &quot;) &gt;= 0) {
            text += this.$padTextRight(&quot;Forward: &quot;, col1);
            laserEq = p.forwardWeapon.equipmentKey;
            laserName = p.forwardWeapon.name;
            if (bl &amp;&amp; laserEq == bl._damagedEq) laserName = EquipmentInfo.infoForKey(bl._holdDamage[&quot;FORWARD&quot;].primary).name + &quot; (Damaged)&quot;;

            text += (laserEq === &quot;EQ_WEAPON_NONE&quot; ? &quot;--None--&quot; : laserName + (p.weaponPositionForward.length &gt; 1 ? &quot; x &quot; + p.weaponPositionForward.length : &quot;&quot;)) + &quot;\n&quot;;
            curChoices[&quot;01_FORWARD&quot;] = {
                text: &quot;Select forward lasers&quot;,
                color: (laserEq === &quot;EQ_WEAPON_NONE&quot; ? &quot;grayColor&quot; : &quot;orangeColor&quot;),
                unselectable: (laserEq === &quot;EQ_WEAPON_NONE&quot; ? true : false)
            };
        }
        if (&quot; 2 3 6 7 10 11 14 15 &quot;.indexOf(&quot; &quot; + p.weaponFacings.toString() + &quot; &quot;) &gt;= 0) {
            text += this.$padTextRight(&quot;Aft: &quot;, col1);
            laserEq = p.aftWeapon.equipmentKey;
            laserName = p.aftWeapon.name;
            if (bl &amp;&amp; laserEq == bl._damagedEq) laserName = EquipmentInfo.infoForKey(bl._holdDamage[&quot;AFT&quot;].primary).name + &quot; (Damaged)&quot;;

            text += (laserEq === &quot;EQ_WEAPON_NONE&quot; ? &quot;--None--&quot; : laserName + (p.weaponPositionAft.length &gt; 1 ? &quot; x &quot; + p.weaponPositionAft.length : &quot;&quot;)) + &quot;\n&quot;;
            curChoices[&quot;02_AFT&quot;] = {
                text: &quot;Select aft lasers&quot;,
                color: (laserEq === &quot;EQ_WEAPON_NONE&quot; ? &quot;grayColor&quot; : &quot;orangeColor&quot;),
                unselectable: (laserEq === &quot;EQ_WEAPON_NONE&quot; ? true : false)
            };
        }
        if (&quot; 4 5 6 7 12 13 14 15 &quot;.indexOf(&quot; &quot; + p.weaponFacings.toString() + &quot; &quot;) &gt;= 0) {
            text += this.$padTextRight(&quot;Port: &quot;, col1);
            laserEq = p.portWeapon.equipmentKey;
            laserName = p.portWeapon.name;
            if (bl &amp;&amp; laserEq == bl._damagedEq) laserName = EquipmentInfo.infoForKey(bl._holdDamage[&quot;PORT&quot;].primary).name + &quot; (Damaged)&quot;;
            
            text += (laserEq === &quot;EQ_WEAPON_NONE&quot; ? &quot;--None--&quot; : laserName + (p.weaponPositionPort.length &gt; 1 ? &quot; x &quot; + p.weaponPositionPort.length : &quot;&quot;)) + &quot;\n&quot;;
            curChoices[&quot;03_PORT&quot;] = {
                text: &quot;Select port lasers&quot;,
                color: (laserEq === &quot;EQ_WEAPON_NONE&quot; ? &quot;grayColor&quot; : &quot;orangeColor&quot;),
                unselectable: (laserEq === &quot;EQ_WEAPON_NONE&quot; ? true : false)
            };
        }
        if (&quot; 8 9 10 11 12 13 14 15 &quot;.indexOf(&quot; &quot; + p.weaponFacings.toString() + &quot; &quot;) &gt;= 0) {
            text += this.$padTextRight(&quot;Starboard: &quot;, col1);
            laserEq = p.starboardWeapon.equipmentKey;
            laserName = p.starboardWeapon.name;
            if (bl &amp;&amp; laserEq == bl._damagedEq) laserName = EquipmentInfo.infoForKey(bl._holdDamage[&quot;STARBOARD&quot;].primary).name + &quot; (Damaged)&quot;;
            
            text += (laserEq === &quot;EQ_WEAPON_NONE&quot; ? &quot;--None--&quot; : laserName + (p.weaponPositionStarboard.length &gt; 1 ? &quot; x &quot; + p.weaponPositionStarboard.length : &quot;&quot;)) + &quot;\n&quot;;
            curChoices[&quot;04_STARBOARD&quot;] = {
                text: &quot;Select starboard lasers&quot;,
                color: (laserEq === &quot;EQ_WEAPON_NONE&quot; ? &quot;grayColor&quot; : &quot;orangeColor&quot;),
                unselectable: (laserEq === &quot;EQ_WEAPON_NONE&quot; ? true : false)
            };
        }

        curChoices[&quot;99_EXIT&quot;] = &quot;Exit&quot;;
    }

    if (this._page === 1) {
        text = &quot;Select destination for &quot; + this._selected.toLowerCase() + &quot; laser &#39;&quot; + this._selectedName + &quot;&#39;:&quot;;
        if (&quot; 1 3 5 7 9 11 13 15 &quot;.indexOf(&quot; &quot; + p.weaponFacings.toString() + &quot; &quot;) &gt;= 0 &amp;&amp; p.weaponPositionForward.length === this._multiple) {
            laserEq = p.forwardWeapon.equipmentKey;
            laserName = p.forwardWeapon.name;
            if (bl &amp;&amp; laserEq == bl._damagedEq) laserName = EquipmentInfo.infoForKey(bl._holdDamage[this._selected].primary).name + &quot; (Damaged)&quot;;

            if (this._selected !== &quot;FORWARD&quot;) {
                curChoices[&quot;11_FORWARD&quot;] = {
                    text: &quot;Forward position&quot; + (laserEq !== &quot;EQ_WEAPON_NONE&quot; ? &quot; (Swap with &quot; + laserName + (p.weaponPositionForward.length &gt; 1 ? &quot; x &quot; + p.weaponPositionForward.length : &quot;&quot;) + &quot;)&quot; : &quot;&quot;),
                    color: &quot;orangeColor&quot;
                }
            } else {
                curChoices[&quot;11_FORWARD&quot;] = {
                    text: &quot;Forward position (selected)&quot;,
                    color: &quot;grayColor&quot;,
                    unselectable: true
                }
            }
        }
        if (&quot; 2 3 6 7 10 11 14 15 &quot;.indexOf(&quot; &quot; + p.weaponFacings.toString() + &quot; &quot;) &gt;= 0 &amp;&amp; p.weaponPositionAft.length === this._multiple) {
            laserEq = p.aftWeapon.equipmentKey;
            laserName = p.aftWeapon.name;
            if (bl &amp;&amp; laserEq == bl._damagedEq) laserName = EquipmentInfo.infoForKey(bl._holdDamage[this._selected].primary).name + &quot; (Damaged)&quot;;

            if (this._selected !== &quot;AFT&quot;) {
                curChoices[&quot;12_AFT&quot;] = {
                    text: &quot;Aft position&quot; + (laserEq !== &quot;EQ_WEAPON_NONE&quot; ? &quot; (Swap with &quot; + p.aftWeapon.name + (p.weaponPositionAft.length &gt; 1 ? &quot; x &quot; + p.weaponPositionAft.length : &quot;&quot;) + &quot;)&quot; : &quot;&quot;),
                    color: &quot;orangeColor&quot;
                };
            } else {
                curChoices[&quot;12_AFT&quot;] = {
                    text: &quot;Aft position (selected)&quot;,
                    color: &quot;grayColor&quot;,
                    unselectable: true
                };
            }
        }
        if (&quot; 4 5 6 7 12 13 14 15 &quot;.indexOf(&quot; &quot; + p.weaponFacings.toString() + &quot; &quot;) &gt;= 0 &amp;&amp; p.weaponPositionPort.length === this._multiple) {
            laserEq = p.portWeapon.equipmentKey;
            laserName = p.portWeapon.name;
            if (bl &amp;&amp; laserEq == bl._damagedEq) laserName = EquipmentInfo.infoForKey(bl._holdDamage[this._selected].primary).name + &quot; (Damaged)&quot;;

            if (this._selected !== &quot;PORT&quot;) {
                curChoices[&quot;13_PORT&quot;] = {
                    text: &quot;Port position&quot; + (laserEq !== &quot;EQ_WEAPON_NONE&quot; ? &quot; (Swap with &quot; + laserName + (p.weaponPositionPort.length &gt; 1 ? &quot; x &quot; + p.weaponPositionPort.length : &quot;&quot;) + &quot;)&quot; : &quot;&quot;),
                    color: &quot;orangeColor&quot;
                };
            } else {
                curChoices[&quot;13_PORT&quot;] = {
                    text: &quot;Port position (selected)&quot;,
                    color: &quot;grayColor&quot;,
                    unselectable: true
                };
            }
        }
        if (&quot; 8 9 10 11 12 13 14 15 &quot;.indexOf(&quot; &quot; + p.weaponFacings.toString() + &quot; &quot;) &gt;= 0 &amp;&amp; p.weaponPositionStarboard.length === this._multiple) {
            laserEq = p.starboardWeapon.equipmentKey;
            laserName = p.starboardWeapon.name;
            if (bl &amp;&amp; laserEq == bl._damagedEq) laserName = EquipmentInfo.infoForKey(bl._holdDamage[this._selected].primary).name + &quot; (Damaged)&quot;;

            if (this._selected !== &quot;STARBOARD&quot;) {
                curChoices[&quot;14_STARBOARD&quot;] = {
                    text: &quot;Starboard position&quot; + (laserEq !== &quot;EQ_WEAPON_NONE&quot; ? &quot; (Swap with &quot; + laserName + (p.weaponPositionStarboard.length &gt; 1 ? &quot; x &quot; + p.weaponPositionStarboard.length : &quot;&quot;) + &quot;)&quot; : &quot;&quot;),
                    color: &quot;orangeColor&quot;
                };
            } else {
                curChoices[&quot;14_STARBOARD&quot;] = {
                    text: &quot;Starboard position (selected)&quot;,
                    color: &quot;grayColor&quot;,
                    unselectable: true
                };
            }
        }
        curChoices[&quot;98_CANCEL&quot;] = &quot;Cancel&quot;;
        curChoices[&quot;99_EXIT&quot;] = &quot;Exit&quot;;
    }

	var opts = {
		screenID: &quot;oolite-la-dockside-map&quot;,
		title: &quot;Laser Arrangement&quot;,
		allowInterrupt: true,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
		overlay: {
			name: &quot;la-arrow.png&quot;,
			height: 546
		},
		choices: curChoices,
		initialChoicesKey: def,
		message: text
	};
	mission.runScreen(opts, this.$screenHandler, this);
}

//-------------------------------------------------------------------------------------------------------------
this.$screenHandler = function $screenHandler(choice) {
    if (choice == null) return;

    var p = player.ship;
    var bl = worldScripts.BreakableLasers_Main;

    switch (choice) {
        case &quot;00_LMSS&quot;:
            worldScripts.LMSS_Core.$showLMSSList();
            return;
        case &quot;01_FORWARD&quot;:
            this._selected = &quot;FORWARD&quot;;
            this._selectedName = p.forwardWeapon.name;
            if (bl &amp;&amp; this._selectedName == bl._damagedEq) this._selectedName = EquipmentInfo.infoForKey(bl._holdDamage[this._selected].primary).name;
            this._multiple = p.weaponPositionForward.length;
            this._page = 1;
            break;
        case &quot;02_AFT&quot;:
            this._selected = &quot;AFT&quot;;
            this._selectedName = p.aftWeapon.name;
            if (bl &amp;&amp; this._selectedName == bl._damagedEq) this._selectedName = EquipmentInfo.infoForKey(bl._holdDamage[this._selected].primary).name;
            this._multiple = p.weaponPositionAft.length;
            this._page = 1;
            break;
        case &quot;03_PORT&quot;:
            this._selected = &quot;PORT&quot;;
            this._selectedName = p.portWeapon.name;
            if (bl &amp;&amp; this._selectedName == bl._damagedEq) this._selectedName = EquipmentInfo.infoForKey(bl._holdDamage[this._selected].primary).name;
            this._multiple = p.weaponPositionPort.length;
            this._page = 1;
            break;
        case &quot;04_STARBOARD&quot;:
            this._selected = &quot;STARBOARD&quot;;
            this._selectedName = p.starboardWeapon.name;
            if (bl &amp;&amp; this._selectedName == bl._damagedEq) this._selectedName = EquipmentInfo.infoForKey(bl._holdDamage[this._selected].primary).name;
            this._multiple = p.weaponPositionStarboard.length;
            this._page = 1;
            break;
        case &quot;11_FORWARD&quot;:
            var hold = &quot;EQ_WEAPON_NONE&quot;;
            var from = &quot;FORWARD&quot;;
            if (worldScripts.LMSS_Core) worldScripts.LMSS_Core._switching = true;
            if (p.forwardWeapon.equipmentKey !== &quot;EQ_WEAPON_NONE&quot;) hold = p.forwardWeapon.equipmentKey;
            switch (this._selected) {
                case &quot;AFT&quot;:
                    p.forwardWeapon = p.aftWeapon.equipmentKey;
                    p.aftWeapon = hold;
                    break;
                case &quot;PORT&quot;:
                    p.forwardWeapon = p.portWeapon.equipmentKey;
                    p.portWeapon = hold;
                    break;
                case &quot;STARBOARD&quot;:
                    p.forwardWeapon = p.starboardWeapon.equipmentKey;
                    p.starboardWeapon = hold;
                    break;
            }
            if (bl) bl.$transferPrimaryLaser(this._selected, from);
            if (worldScripts.LMSS_Core) worldScripts.LMSS_Core._switching = false;
            this._selected = &quot;&quot;;
            this._page = 0;
            break;
        case &quot;12_AFT&quot;:
            var hold = &quot;EQ_WEAPON_NONE&quot;;
            var from = &quot;AFT&quot;;
            if (worldScripts.LMSS_Core) worldScripts.LMSS_Core._switching = true;
            if (p.aftWeapon.equipmentKey !== &quot;EQ_WEAPON_NONE&quot;) hold = p.aftWeapon.equipmentKey;
            switch (this._selected) {
                case &quot;FORWARD&quot;:
                    p.aftWeapon = p.forwardWeapon.equipmentKey;
                    p.forwardWeapon = hold;
                    break;
                case &quot;PORT&quot;:
                    p.aftWeapon = p.portWeapon.equipmentKey;
                    p.portWeapon = hold;
                    break;
                case &quot;STARBOARD&quot;:
                    p.aftWeapon = p.starboardWeapon.equipmentKey;
                    p.starboardWeapon = hold;
                    break;
            }
            if (bl) bl.$transferPrimaryLaser(this._selected, from);
            if (worldScripts.LMSS_Core) worldScripts.LMSS_Core._switching = false;
            this._selected = &quot;&quot;;
            this._page = 0;
            break;
        case &quot;13_PORT&quot;:
            var hold = &quot;EQ_WEAPON_NONE&quot;;
            var from = &quot;PORT&quot;;
            if (worldScripts.LMSS_Core) worldScripts.LMSS_Core._switching = true;
            if (p.portWeapon.equipmentKey !== &quot;EQ_WEAPON_NONE&quot;) hold = p.portWeapon.equipmentKey;
            switch (this._selected) {
                case &quot;FORWARD&quot;:
                    p.portWeapon = p.forwardWeapon.equipmentKey;
                    p.forwardWeapon = hold;
                    break;
                case &quot;AFT&quot;:
                    p.portWeapon = p.aftWeapon.equipmentKey;
                    p.aftWeapon = hold;
                    break;
                case &quot;STARBOARD&quot;:
                    p.portWeapon = p.starboardWeapon.equipmentKey;
                    p.starboardWeapon = hold;
                    break;
            }
            if (bl) bl.$transferPrimaryLaser(this._selected, from);
            if (worldScripts.LMSS_Core) worldScripts.LMSS_Core._switching = false;
            this._selected = &quot;&quot;;
            this._page = 0;
            break;
        case &quot;14_STARBOARD&quot;:
            var hold = &quot;EQ_WEAPON_NONE&quot;;
            var from = &quot;AFT&quot;;
            if (worldScripts.LMSS_Core) worldScripts.LMSS_Core._switching = true;
            if (p.starboardWeapon.equipmentKey !== &quot;EQ_WEAPON_NONE&quot;) hold = p.starboardWeapon.equipmentKey;
            switch (this._selected) {
                case &quot;FORWARD&quot;:
                    p.starboardWeapon = p.forwardWeapon.equipmentKey;
                    p.forwardWeapon = hold;
                    break;
                case &quot;AFT&quot;:
                    p.starboardWeapon = p.aftWeapon.equipmentKey;
                    p.aftWeapon = hold;
                    break;
                case &quot;PORT&quot;:
                    p.starboardWeapon = p.portWeapon.equipmentKey;
                    p.portWeapon = hold;
                    break;
            }
            if (bl) bl.$transferPrimaryLaser(this._selected, from);
            if (worldScripts.LMSS_Core) worldScripts.LMSS_Core._switching = false;
            this._selected = &quot;&quot;;
            this._page = 0;
            break;
        case &quot;98_CANCEL&quot;:
            this._selected = &quot;&quot;;
            this._page = 0;
            break;
    }

	if (choice != &quot;99_EXIT&quot;) {
		this.$showPage();
	}
}

//-------------------------------------------------------------------------------------------------------------
// appends space to currentText to the specified length in &#39;em&#39;
this.$padTextRight = function $padTextRight(currentText, desiredLength, leftSwitch) {
	if (currentText == null) currentText = &quot;&quot;;
	var hairSpace = String.fromCharCode(31);
	var ellip = &quot;…&quot;;
	var currentLength = defaultFont.measureString(currentText.replace(/%%/g, &quot;%&quot;));
	var hairSpaceLength = defaultFont.measureString(hairSpace);
	// calculate number needed to fill remaining length
	var padsNeeded = Math.floor((desiredLength - currentLength) / hairSpaceLength);
	if (padsNeeded &lt; 1) {
		// text is too long for column, so start pulling characters off
		var tmp = currentText;
		do {
			tmp = tmp.substring(0, tmp.length - 2) + ellip;
			if (tmp === ellip) break;
		} while (defaultFont.measureString(tmp.replace(/%%/g, &quot;%&quot;)) &gt; desiredLength);
		currentLength = defaultFont.measureString(tmp.replace(/%%/g, &quot;%&quot;));
		padsNeeded = Math.floor((desiredLength - currentLength) / hairSpaceLength);
		currentText = tmp;
	}
	// quick way of generating a repeated string of that number
	if (!leftSwitch || leftSwitch === false) {
		return currentText + new Array(padsNeeded).join(hairSpace);
	} else {
		return new Array(padsNeeded).join(hairSpace) + currentText;
	}
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
