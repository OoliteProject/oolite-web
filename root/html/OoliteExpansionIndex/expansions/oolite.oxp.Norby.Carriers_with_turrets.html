<html>
    <head>
        <title>Expansion Carriers with turrets</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Carriers with turrets</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">2 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Required Expansions mismatch between OXP Manifest and Expansion Manager at character position 0059 (DIGIT ZERO vs LATIN SMALL LETTER N)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Short range turrets applied on Carriers as a big help in close defese. Requires Carriers OXP.</td>
                    <td>Short range turrets applied on Carriers as a big help in close defese. Requires Carriers OXP.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Norby.Carriers_with_turrets</td>
                    <td>oolite.oxp.Norby.Carriers_with_turrets</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Carriers with turrets</td>
                    <td>Carriers with turrets</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Ships</td>
                    <td>Ships</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Norby</td>
                    <td>Norby</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.0</td>
                    <td>1.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.Norby.Carriers:0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Norby.Carriers:</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Carriers">http://wiki.alioth.net/index.php/Carriers</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/7/7c/Carriers_with_turrets_1.0.oxz">https://wiki.alioth.net/img_auth.php/7/7c/Carriers_with_turrets_1.0.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 4.0</td>
                    <td>CC BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873343</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Carriers%20with%20turrets'>http://wiki.alioth.net/index.php/Carriers%20with%20turrets</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/carriers-mainturret.html">Main Turret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/carriers-turret.html">Carrier Turret</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/carriers-turret.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;carriers-turret&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2015 Norbert Nagy&quot;;
this.description = &quot;Place turret inside of the shields and send message if a turret gone.&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;

this.$Carriersturret_HitTimer = null;

//this.shipBeingAttacked = function(whom) {
this.shipTakingDamage = function(amount, whom, type) {
	if(amount&lt;=0) return;//player shield can take the whole damage
//if(this.ship.isPlayer) {var a=Math.round(amount); var e=Math.round(this.ship.energy);}//debug
	if(this.ship.scriptInfo.hardarmour &gt; 0) { //Hard Armour support
		var d = Math.min(this.ship.scriptInfo.hardarmour, amount);
		if( this.ship.energy &gt; 5 ) this.ship.energy += d; //hardly explode without if
		amount -= d;
	}
//if(this.ship.isPlayer) player.commsMessage(a+&quot; &quot;+Math.round(amount)+&quot; &quot;+e+&quot; &quot;+Math.round(this.ship.energy));//debug
	if(amount&lt;=0) return;//extra check after armor
	var energydamage = amount;
	var owner = this.ship.owner;
	if(owner.isValid &amp;&amp; !this.ship.scriptInfo.noturretshield
		&amp;&amp; !owner.scriptInfo.noturretshield) {//can disable turret shield in shipdata.plist
		var angle = 3.14;//unknown attacker assumed in front
		if(whom &amp;&amp; whom.isValid)
			angle = owner.vectorForward.angleTo(owner.position.subtract(whom.position));
		if(owner.isPlayer) {
			if(angle &gt; 1.57) {//forward
				if(energydamage &gt; owner.forwardShield) { //hit the shield first
					this.ship.energy += owner.forwardShield;
					energydamage -= owner.forwardShield;
					owner.forwardShield = 0;
				} else {
					if(owner.isPlayer) var d = Math.round(this.ship.energy);//debug
					this.ship.energy += energydamage;
					if(this.ship.isPlayer) player.console(this.ship.name+&quot; &quot;+d+&quot; &quot;+Math.round(this.ship.energy)
						+&quot; &quot;+Math.round(amount));//debug					
					owner.forwardShield -= energydamage;
					energydamage = 0;
				}
			} else { //aft
				if(energydamage &gt; owner.aftShield) {
					this.ship.energy += owner.aftShield;
					energydamage -= owner.aftShield;
					owner.aftShield = 0;
				} else {
					this.ship.energy += energydamage;
					owner.aftShield -= energydamage;
					energydamage = 0;
				}
			}
		} else if(worldScripts[&quot;customshields&quot;]) { //NPC, check if CustomShields installed
			if(angle &lt; 1.57) {
				if(energydamage &gt; owner.script.customshieldsaftshieldlevel) {
					this.ship.energy += owner.script.customshieldsaftshieldlevel;
					energydamage -= owner.script.customshieldsaftshieldlevel;
					owner.script.customshieldsaftshieldlevel = 0;
				} else {
					this.ship.energy += energydamage;
					owner.script.customshieldsaftshieldlevel -= energydamage;
					energydamage = 0;
				}
			} else {
				if(energydamage &gt; owner.script.customshieldsforwardshieldlevel) {
					this.ship.energy += owner.script.customshieldsforwardshieldlevel;
					energydamage -= owner.script.customshieldsforwardshieldlevel;
					owner.script.customshieldsforwardshieldlevel = 0;
				} else {
					this.ship.energy += energydamage;
					owner.script.customshieldsforwardshieldlevel -= energydamage;
					energydamage = 0;
				}
			}			
		}
	}
	if(energydamage &gt; 0 &amp;&amp; owner.isPlayer) {
		if(!this.$Carriersturret_HitTimer)  { 
			//delayed show the energy of the turret after hit to avoid too many messages
			this.$Carriersturret_HitTimer = new Timer(this, this.$Carriersturret_Hit, 1);
		}
	}
}

this.$Carriersturret_Pos = function() {
	var pos = &quot;&quot;;
	if(this.ship.name === &quot;Main Turret&quot;) pos+=&quot;Main &quot;;//Main Turret always placed in Front
	else if(this.ship.position.z &gt; 2)  pos+=&quot;Fore &quot;;
	if(this.ship.position.z &lt; -105)  pos+=&quot;Aft &quot;; //side and top turrets are 104.85m behind the center
	if(this.ship.position.x &gt; 2)  pos+=&quot;Port &quot;;
	if(this.ship.position.x &lt; -2)  pos+=&quot;Starboard &quot;;
	if(this.ship.position.y &gt; 2)  pos+=&quot;Up &quot;;
	if(this.ship.position.y &lt; -2)  pos+=&quot;Down &quot;;
	return(pos);
}

this.$Carriersturret_Hit = function() {
	player.consoleMessage(this.$Carriersturret_Pos()+&quot;Turret &quot;+Math.ceil(this.ship.energy)+&quot; armor left.&quot;);
	if(this.$Carriersturret_HitTimer) {
		this.$Carriersturret_HitTimer.stop();
		delete this.$Carriersturret_HitTimer;
	}
}

this.shipDied = function () {
	if(this.ship.owner === player.ship) {
		player.commsMessage(this.$Carriersturret_Pos()+&quot;Turret gone.&quot;);
	}
};
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/carriers_with_turrets.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;carriers_with_turrets&quot;;
this.author      = &quot;Norby&quot;;
this.copyright   = &quot;2015 Norbert Nagy&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;
this.description = &quot;Carriers with turrets&quot;;

//The simple existence of this script make detectable in any js that Carriers has turrets:
//
// if( worldScripts.carriers_with_turrets ) {
//	/* do something with turreted Carriers */
// }</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
