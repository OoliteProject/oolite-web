<html>
    <head>
        <title>Expansion Navigation MFD</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Navigation MFD</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER M)(&#39;[]&#39; vs &#39;[mfd]&#39;)</li>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Display navigational information in an MFD. Information includes data from hyperdrive system and space compass.</td>
                    <td>Display navigational information in an MFD. Information includes data from hyperdrive system and space compass.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.spara.navigation_mfd</td>
                    <td>oolite.oxp.spara.navigation_mfd</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Navigation MFD</td>
                    <td>Navigation MFD</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>HUDs</td>
                    <td>HUDs</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Mika Spara</td>
                    <td>Mika Spara</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.9.0</td>
                    <td>1.9.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>mfd</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/0/0b/Navigation_MFD.oxz">https://wiki.alioth.net/img_auth.php/0/0b/Navigation_MFD.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873228</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Navigation%20MFD'>http://wiki.alioth.net/index.php/Navigation%20MFD</a></p>
        <h3>navigation_mfd_readme_&amp;_license.txt</h3>
        <pre>Navi MFD OXP ver 1.9.0 (18.1.2018)

Author: spara (Mika Spåra)

_Overview_

Display navigational information in an MFD. Information includes data from hyperdrive system and space compass. Costs 650 credits.

_Requirements_

* Oolite 1.82

_Installing_

Install the OXP by copying navigation_mdf.oxz to your AddOns-folder.

_Credits_

------

This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_NAVIGATION_MFD.html">Navigation MFD</a></td>
                    <td>yes</td>
                    <td align="right">6500</td>
                    <td align="center">7+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name               = &quot;navi_mfd&quot;;
this.author               = &quot;spara&quot;;
this.copyright            = &quot;2015 Spara&quot;;
this.description         = &quot;Show navigational info in an MFD&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;

//distance unit to show in mfd.
this.$distUnits = [&quot;OU&quot;, &quot;km&quot;, &quot;m&quot;];

//basis in meters for one distUnit.
//for kiloometers, set to 1000
//for OUs, set to 905520, which is roughly the distance of planet and sun in Lave in an unmodified game.
this.$ostronomicalUnits = [905520, 1000, 1];
this.$rounding = [6, 3, 0];
this.$unitSetting = 0;

this.libSettings = { 
	Name: this.name, Display: &quot;Settings&quot;, Alias:&quot;Navigation MFD&quot;, Alive:&quot;libSettings&quot;,
	SInt: {
		S0:{Name:&quot;$unitSetting&quot;, Def:0, Min:0, Max:2, Desc:&quot;Display units&quot;},
		Info:&quot;0 = OU, 1 = km, 2 = m&quot;},
};

this.startUp = function() {
	this.$interval = 1; //Refresh frequency. (in secs)
	
	if (missionVariables.NavigationMFD_Units) {
		this.$unitSetting = parseInt(missionVariables.NavigationMFD_Units);
	}
	//timer for display update
	this.$distanceTimer = new Timer(this,this.$updateDistance,0,this.$interval);
	this.$distanceTimer.stop();
	
	//storage variable
	this.$targetName = &quot;unknown&quot;;
	
	//symbols
	this.$govs = new Array();
	for (var i = 0; i &lt; 8 ; i++) {
		this.$govs.push(String.fromCharCode(i));
	}
	this.$ecos = new Array();
	for (i = 0; i &lt; 8 ; i++) {
		this.$ecos.push(String.fromCharCode(23 - i));
	}
	this.$nova = String.fromCharCode(215) + &quot; &quot; + String.fromCharCode(215) + &quot; &quot;;
	
	//for route planner to work in interstellar space too	
	this.$savedSystem = system.ID;
	
	//bgs voice countdown timer differs from core countdown
	//hyper countdown is synced to bgs or ctz if present,
	//otherwise to core countdown
	if (worldScripts[&quot;BGS-M&quot;] || worldScripts[&quot;countdown_to_zero&quot;]) this.$BGS = true;
	
	//docking clearance status for stations
	this.$clearanceStation = null;
}

this.startUpComplete = function() {
	// register our settings, if Lib_Config is present
	if (worldScripts.Lib_Config) worldScripts.Lib_Config._registerSet(this.libSettings);
}

this.playerWillSaveGame = function() {
	missionVariables.NavigationMFD_Units = this.$unitSetting;
}

//start display timer when launching and entering system
this.shipWillLaunchFromStation = this.shipExitedWitchspace = function() {
	//for route planner to work in interstellar space too
	if (!system.isInterstellarSpace) this.$savedSystem = system.ID;
	this.$setHyperMessage();
	this.$distanceTimer.start();
}

//switch to countdown synced timer
this.playerStartedJumpCountdown = function(type, seconds) {
	if (type === &quot;standard&quot;) {
		this.$distanceTimer.stop();
		this.$countdown = seconds;
		this.$hyperTimer = new Timer(this,this._hyperDriveCountdown,0,1);
	}
}

//switch back to basic timer
this.playerCancelledJumpCountdown = this.playerJumpFailed = function() {
	if (this.$hyperTimer) {
		this.$hyperTimer.stop();
		delete this.$hyperTimer;
		delete this.$countdown;
	}
	this.$distanceTimer.start();
}

//update display once and stop countdown timer
this.shipWillEnterWitchspace = function() {
	//triggers &quot;hyperjump in progress&quot; message
	if (this.$hyperTimer) {
		this.$countdown = -1;
		this.$updateDistance();
		this.$hyperTimer.stop();
		delete this.$hyperTimer;
		delete this.$countdown;
	}
}

//update hyperspace display data when switching from map
this.guiScreenChanged = function(to, from) {
	if (from === &quot;GUI_SCREEN_SHORT_RANGE_CHART&quot; || from === &quot;GUI_SCREEN_LONG_RANGE_CHART&quot;) {
		this.$setHyperMessage();
		this.$updateDistance();
	}
}

//update compass target data and start timer on launch
this.shipLaunchedFromStation = function() {
	this.compassTargetChanged(player.ship.compassTarget, player.ship.compassMode);
	this.$distanceTimer.start();
}

//stop timers when docking
this.shipWillDockWithStation = function() {
	//yes, it&#39;s possible to dock while hyperspace countdown is running
	if (this.$hyperTimer) {
		this.$hyperTimer.stop();
		delete this.$hyperTimer;
		delete this.$countdown;
		this.$setHyperMessage();
		this.$updateDistance();
	}
	this.$distanceTimer.stop();
}

//hyper countdown timer function
this._hyperDriveCountdown = function _hyperDriveCountdown() {
	this.$updateDistance();
	this.$countdown--;
}

//update mfd
this.$updateDistance = function $updateDistance() {
	if (player.ship.equipmentStatus(&quot;EQ_NAVIGATION_MFD&quot;) === &quot;EQUIPMENT_OK&quot;) {
		player.ship.setMultiFunctionText(&quot;navi_mfd&quot;,this.$message());
	}
	else player.ship.setMultiFunctionText(&quot;navi_mfd&quot;, null);
}

//compose output
this.$message = function() {
	//hyperspace data is updated only when it changes
	var message = this.$hyperMessage;
	message += &quot;Hyperdrive Status:\n&quot; + this.$status();
	var target = player.ship.compassTarget;
	//valid target case
	if (target) {
		if (target.isStation) {
			var stationStatus = this._stationStatus(target);
		}
		else var stationStatus = &quot;&quot;;
		message += this._paddedHyperInfo(&quot;Space Compass:&quot;) + stationStatus + &quot;\n&quot; + this.$truncate(&quot;  &quot; + this.$targetName, 14) + &quot;\n&quot;;
		var distInM = player.ship.position.distanceTo(target) - target.collisionRadius;
		if (distInM &lt; 0) distInM = 0;
		var dist = distInM/this.$ostronomicalUnits[this.$unitSetting];
		message += &quot;Distance: &quot; + dist.toFixed(this.$rounding[this.$unitSetting]) + &quot; &quot; + this.$distUnits[this.$unitSetting] +&quot;\n&quot;;
		message += &quot;Estimated Travel Time: &quot;;
		var vPtoT = target.position.subtract(player.ship.position); //player-target vector
		var dotVH = player.ship.velocity.dot(vPtoT); //dot product between velocity and heading
		if (dotVH &gt; 0.1) {//check heading
			var vVelPtoT = vPtoT.multiply(dotVH / (vPtoT.dot(vPtoT))); //velocity vector projection on player-target vector    
			var timeToTarget = distInM / vVelPtoT.magnitude();
			var hours = Math.floor(timeToTarget / 3600);
			var mins = Math.floor((timeToTarget - 3600 * hours) / 60);
			var secs = Math.floor(timeToTarget - hours * 3600 - mins * 60);
			if (hours &lt; 10) 
				hours = &quot;0&quot;+hours;
			if (mins &lt; 10) 
				mins = &quot;0&quot;+mins;
			if (secs &lt; 10) 
				secs = &quot;0&quot;+secs;
			message += hours+&quot;:&quot;+mins+&quot;:&quot;+secs;
		}
		else message = message + &quot;**:**:**&quot;;
	}
	//null case
	else {
		message += &quot;Space Compass Target:\n  -\n&quot;;
		message += &quot;Distance: -\n&quot;;
		message += &quot;Estimated Travel Time: **:**:**&quot;;
	}
	return message;
}

//remember the station which clearance was asked from
this.playerRequestedDockingClearance = function() {
	this.$clearanceStation = player.ship.target;
}

//the docking status of stations
this._stationStatus = function(whom) {
	if (whom.requiresDockingClearance) {
		if (whom === this.$clearanceStation) {
			switch (player.dockingClearanceStatus) {
				case &quot;DOCKING_CLEARANCE_STATUS_REQUESTED&quot;:
					return &quot;Dock: Hold&quot;;
					break;
				case &quot;DOCKING_CLEARANCE_STATUS_GRANTED&quot;:
					return &quot;Dock: Granted&quot;;
					break;
				case &quot;DOCKING_CLEARANCE_STATUS_TIMING_OUT&quot;:
					return &quot;Dock: Expiring&quot;;
					break;
			}
		}
		return &quot;Dock: Request&quot;;
	}
	return &quot;Dock: Free&quot;;
}

//compose hyperspace output
this.$setHyperMessage = function() {

	// nextSystem new in for Oolite 1.86
	if (player.ship.hasOwnProperty(&quot;nextSystem&quot;) === true) {
		var hyperSystemObj = System.infoForSystem(galaxyNumber, player.ship.nextSystem);
	} else {
		var hyperSystemObj = System.infoForSystem(galaxyNumber, player.ship.targetSystem);
		
		//first condition for compatibility with older versions of Oolite
		if (player.ship.routeMode &amp;&amp; player.ship.targetSystem !== system.ID) {
			
			var mode = player.ship.routeMode;
			if (mode === &quot;OPTIMIZED_BY_JUMPS&quot; || mode === &quot;OPTIMIZED_BY_TIME&quot;) {
				// cope with the situation of being in interstellar space and then selecting your originating system as the target
				if (player.ship.targetSystem === this.$savedSystem &amp;&amp; system.isInterstellarSpace === true) {
					hyperSystemObj = System.infoForSystem(galaxyNumber, this.$savedSystem);
				} else {
					var routeToNextSyst = System.infoForSystem(galaxyNumber, this.$savedSystem).routeToSystem(hyperSystemObj, mode);
					if (routeToNextSyst &amp;&amp; routeToNextSyst.route.length &gt;= 1 &amp;&amp; routeToNextSyst.route[1]) {
						hyperSystemObj = System.infoForSystem(galaxyNumber, routeToNextSyst.route[1]);
					}
					//if no route can be plotted, set hyperSystemObj to current system to nullify target from printout
					else hyperSystemObj = system.info;
				}
			}
		}
	}
	var hyperSystem = hyperSystemObj.name;
	
	//in interstellar space the distance calculation is done manually.
	if (system.isInterstellarSpace) {
		var s = player.ship.galaxyCoordinatesInLY;
		var t = hyperSystemObj.coordinates;
		//this is officially weird
		this.$hyperDistance = 0.4 * Math.floor(2.5 * Math.sqrt(Math.pow(s[0] - t[0], 2) + Math.pow(s[1] - t[1], 2)));
	}
	else {
		this.$hyperDistance = hyperSystemObj.distanceToSystem(system.info);
	}
	//default to no target set
	var hyperTime = &quot;**:**:**\n&quot;;
	var hyperDistance = &quot;-&quot;;
	if (!hyperSystemObj.sun_gone_nova) {
		var planetDistance = ((hyperSystemObj.planet_distance - hyperSystemObj.radius * 10)/this.$ostronomicalUnits[this.$unitSetting]).toFixed(this.$rounding[this.$unitSetting]);// + &quot; &quot; + this.$distUnits[this.$unitSetting];
	}
	else var planetDistance = &quot;-&quot;;

	if (hyperSystemObj.systemID != -1) {
		var W2P = Vector3D([0, 0, hyperSystemObj.planet_distance]);
		if (hyperSystemObj.sun_distance_modifier) {
			var P2SDist = hyperSystemObj.sun_distance_modifier * hyperSystemObj.radius * 10;
		}
		else if (hyperSystemObj.sun_distance_multiplier) {
			var P2SDist = hyperSystemObj.sun_distance * hyperSystemObj.sun_distance_multiplier;
		}
		else var P2SDist = hyperSystemObj.sun_distance;
		var P2S = Vector3D(hyperSystemObj.sun_vector.split(&quot; &quot;)).multiply(-1 * P2SDist);
		var sunDistance = ((W2P.add(P2S).magnitude() - hyperSystemObj.sun_radius)/this.$ostronomicalUnits[this.$unitSetting]).toFixed(this.$rounding[this.$unitSetting]) + &quot; (&quot; + this.$distUnits[this.$unitSetting] + &quot;)&quot;;
	}

	//target system set
	if (hyperSystem !== system.name) {
		if (this.$hyperDistance &lt; 0.1) var hyperDistance = &quot;0.1&quot;;
		else var hyperDistance = this.$hyperDistance.toFixed(1);
		hyperDistance += &quot; ly&quot;;

		//calculate time for valid cases only
		if (player.ship.hasHyperspaceMotor &amp;&amp; this.$hyperDistance &lt;= 7) {
			var hyperTime = this.$hyperDistance * this.$hyperDistance;//in hours
			var hours = Math.floor(hyperTime);
			var mins = Math.floor((hyperTime - hours) * 60);
			var secs = Math.floor((hyperTime - hours - mins / 60) * 3600);
			if (hours &lt; 10) hours = &quot;0&quot;+hours;
			if (mins &lt; 10) mins = &quot;0&quot;+mins;
			if (secs &lt; 10) secs = &quot;0&quot;+secs;
			hyperTime = hours+&quot;:&quot;+mins+&quot;:&quot;+secs+&quot;\n&quot;;
		}
	}
	
	if (system.isInterstellarSpace) {
		this.$hyperMessage = &quot;Present System: Interstellar space\n&quot;;
	}
	else {
		if (!system.sun.hasGoneNova) {
			this.$hyperMessage = this._hyperSystemLine(&quot;Present System:&quot;, system.name + &quot; (TL&quot;+ (system.techLevel+1) +&quot;)&quot;, this.$ecos[system.economy] + this.$govs[system.government])+&quot;\n&quot;;
		}
		else {
			this.$hyperMessage = this._hyperSystemLine(&quot;Present System:&quot;, system.name + &quot; (TL0)&quot;, this.$nova)+&quot;\n&quot;;
		}
	}
	if (hyperSystem !== system.name) {
		if (!hyperSystemObj.sun_gone_nova) {
			this.$hyperMessage += this._hyperSystemLine(&quot;Target System:&quot;, hyperSystem + &quot; (TL&quot;+ (hyperSystemObj.techlevel + 1) +&quot;)&quot;, this.$ecos[hyperSystemObj.economy] + this.$govs[hyperSystemObj.government]) + &quot;\n&quot;;
		}
		else {
			this.$hyperMessage += this._hyperSystemLine(&quot;Target System:&quot;, hyperSystem + &quot; (TL0)&quot;, this.$nova) + &quot;\n&quot;;
		}
	}
	else this.$hyperMessage += &quot;Target System: &quot; + hyperSystem + &quot;\n&quot;;
	
	//this.$hyperMessage = this.$hyperMessage + &quot;Estimated Travel Time: &quot; + hyperTime;
	this.$hyperMessage += this._paddedHyperInfo(&quot;  Distance: &quot; + hyperDistance);
	this.$hyperMessage += &quot;Time: &quot; + hyperTime;
	//this.$hyperMessage += &quot;  Main Lane: &quot; + planetDistance + &quot;\n&quot;;
	this.$hyperMessage += this._paddedHyperInfo(&quot;  Planet: &quot; + (isNaN(planetDistance) ? &quot;-&quot; : planetDistance));
	this.$hyperMessage += &quot;Sun: &quot; + sunDistance + &quot;\n&quot;;
}

//helper to format system lines
this._hyperSystemLine = function(preText, systemName, systemSymbol) {
	var line = preText + &quot; &quot; + systemName;
	return line + this._pads(line + systemSymbol, 14.4) + systemSymbol;
}

//helper to format 1st hyper system data line
this._paddedHyperInfo = function(text) {
	return text + this._pads(text, 7.1);
}

//padding function
this._pads = function(text, width) {
	var hairSpace = String.fromCharCode(31);
	var hairSpaceLength = defaultFont.measureString(hairSpace);
	var currentLength = global.defaultFont.measureString(text);
	var padsNeeded = Math.floor((width - currentLength) / hairSpaceLength);
	if (padsNeeded &gt;= 1) {
		return new Array(padsNeeded).join(hairSpace);
	}
	else return &quot;&quot;;	
}

//update compass target name. there&#39;s some cim still here.
this.compassTargetChanged = function(whom, mode) {
	this.$targetName = &quot;Initializing...&quot;;
	if (!whom) return;//null case
	if (whom.displayName) this.$targetName = whom.displayName;
	else if (whom.name) this.$targetName = whom.name;
	else if (whom.beaconLabel) this.$targetName = whom.beaconLabel;
	else if (whom.beaconCode) this.$targetName = whom.beaconCode;
	else this.$targetName = &quot;Unidentified&quot;;
	if (mode === &quot;COMPASS_MODE_BASIC&quot;) {
		if (whom.isPlanet) this.$targetName = &quot;Planet&quot;;
		else this.$targetName = &quot;Main Station&quot;;
	}
	else if (mode === &quot;COMPASS_MODE_BEACONS&quot;) {
		// Escape capsule locator OXP
		if (this.$targetName === &quot;Metal fragment&quot; &amp;&amp; whom.beaconCode.substr(0,1) === &quot;E&quot;)
			this.$targetName = &quot;Escape Capsule&quot;;
		else if (this.$targetName === &quot;Navigation Buoy&quot;) {
			if (whom.beaconCode.substr(0,1) === &quot;g&quot;)
				this.$targetName = &quot;GRS Buoy Factory Nav Buoy&quot;;
			else if (whom.beaconCode.substr(0,1) === &quot;N&quot;)
				this.$targetName = &quot;Main Station Nav Buoy&quot;;
		}
		// Tracker OXP
		else if (this.$targetName === &quot;Tracker&quot;) {
			if (whom.target.displayName)
				this.$targetName = whom.target.displayName;
			else this.$targetName = whom.target.name;
			this.$targetName += &quot; (Tracked)&quot;;
		}
	}
	else if (mode === &quot;COMPASS_MODE_PLANET&quot;)
		this.$targetName = &quot;Planet&quot;;
	else if (mode === &quot;COMPASS_MODE_SUN&quot;) {
		//distant suns oxp
		if (system.info.sun_name)
			this.$targetName = system.info.sun_name + &quot; (Sun)&quot;;
		else this.$targetName = &quot;Sun&quot;;
	}
	else if (mode === &quot;COMPASS_MODE_STATION&quot;)
		this.$targetName = &quot;Main Station&quot;;
	this.$updateDistance();
}

//hyperdrive status. mass locks, fuel etc. there&#39;s some cim here too.
this.$status = function() {
	if (this.$countdown &amp;&amp; this.$countdown === -1) {
		return &quot;  Hyperjump in progress\n&quot;;
	}
	if (!player.ship.hasHyperspaceMotor) return &quot;  Not installed\n&quot;;
	if (player.ship.targetSystem === system.ID) {
		return &quot;  Present system targeted\n&quot;;
	}
	if (this.$hyperDistance &gt; 7) return &quot;  Target out of range\n&quot;;
	if (player.ship.fuel &lt; this.$hyperDistance) {
		return &quot;  Not enough fuel\n&quot;;
	}
	var position = player.ship.position;
	function isBlocker(entity) {
		if (!entity.isShip) return false;
		if (entity.mass / position.squaredDistanceTo(entity) &gt;= 10) {
			return true;
		}
		return false;
	}
	var blockers = system.filteredEntities(this, isBlocker, player.ship, 25600);
	if (blockers.length &gt; 0)
		return this.$truncate(&quot;  Too close to &quot; + blockers[0].name, 14) + &quot;\n&quot;;
	if (this.$countdown) {
		//sync to BGS countdown
		if (this.$BGS) {
			return &quot;  Countdown in progress &quot; + (this.$countdown - 1) + &quot;\n&quot;;
		}
		//sync to core countdown
		else {
			return &quot;  Countdown in progress &quot; + this.$countdown + &quot;\n&quot;;
		}
	}
	return &quot;  Ready\n&quot;;
}

//squeezing looks ugly, so I&#39;ll truncate instead.
this.$truncate = function(line, width) {
	var lastChar = &quot;&quot;;
	//remove characters from the end of the line.
	while (global.defaultFont.measureString(line) &gt; width) {
		lastChar = line.charAt(line.length - 1);
		line = line.slice(0, -1);
	}
	//no chopping was done. return
	if (lastChar === &quot;&quot;) return line;
	//if the last char is a space or last removed char was space, return
	if (line.charAt(line.length - 1) === &quot; &quot; || lastChar === &quot; &quot;) {
		return line;
	}
	//if the last char is a char and the second last is a space, remove the char and return
	if (line.charAt(line.length - 2) === &quot; &quot;) {
		return line.slice(0, -1);
	}
	//it seems that we have a chopped word in our hands. looks nicer to end it with a dot
	line += &quot;.&quot;;
	while (global.defaultFont.measureString(line) &gt; width) {
		line = line.slice(0, -2);
		line += &quot;.&quot;;
	}
	return line;
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
