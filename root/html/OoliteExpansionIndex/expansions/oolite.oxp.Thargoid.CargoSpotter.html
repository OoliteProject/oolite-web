<html>
    <head>
        <title>Expansion Cargo Spotter</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Cargo Spotter</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER E)(&#39;[]&#39; vs &#39;[equipment]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>A piece of equipment which highlights scoopable items in a virtual glow on your visual display.</td>
                    <td>A piece of equipment which highlights scoopable items in a virtual glow on your visual display.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.CargoSpotter</td>
                    <td>oolite.oxp.Thargoid.CargoSpotter</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Cargo Spotter</td>
                    <td>Cargo Spotter</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.1</td>
                    <td>1.1</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>equipment</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Cargo_Spotter_OXP">http://wiki.alioth.net/index.php/Cargo_Spotter_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/8/88/CargoSpotter-1.1.oxz">https://wiki.alioth.net/img_auth.php/8/88/CargoSpotter-1.1.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873354</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Cargo%20Spotter'>http://wiki.alioth.net/index.php/Cargo%20Spotter</a></p>
        <h3>Readme.txt</h3>
        <pre>Cargo Spotter OXP
-----------------
by Thargoid

A little OXP, which adds a new piece of equipment for any scavenger, miner or bounty hunter. As small scoopable items like cargo pods, splinters and escape pods can often be difficult to see, this addition to the ships HUD overlays them with a virtual flashing glow. Thus they are easier to spot from a distance and home in on.

The update costs 300 credits, and should be available in systems of tech level 12 or higher.

This OXP uses Cim&#39;s new visual effects class. Thus it requires Oolite version 1.77 or above to work.


License
-------

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license.


Version history
---------------
v1.00 (08/01/2013)
* First release

v1.01 (26/02/2013)
* Minor script tweak to add missing $ (thanks to UK_Eliter for the notification).

v1.1 (Oct/2020)
* Changes equipment from primeable to always active (to reduce the chain of primeable equipments).
* Updates license to remove the &quot;Thargoid clauses&quot; after Thargoid allowed modification when retired from maintaining his OXps (http://aegidian.org/bb/viewtopic.php?f=4&amp;t=17085)

</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_CARGOSPOTTER.html">Cargo Spotter</a></td>
                    <td>yes</td>
                    <td align="right">3000</td>
                    <td align="center">12+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/cargoSpotter_glow.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;cargoSpotter_glow.js&quot;;
this.author      = &quot;Thargoid&quot;;
this.copyright   = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Glow script.&quot;;
this.version     = &quot;1.1&quot;;

//------------------------------------------------------------------------------------//
this.effectSpawned = function _cspotter_effectSpawned() { 
    if (!this.visualEffect) return;
    this.callbackID = addFrameCallback(this.$positionGlow.bind(this)); 
}

//------------------------------------------------------------------------------------//
this.effectRemoved = function _cspotter_effectRemoved() {
    if(this.callbackID)  removeFrameCallback(this.callbackID); 
    delete this.callbackID;
}   

//------------------------------------------------------------------------------------//
this.$positionGlow = function _cspotter_positionGlow() {
    if (missionVariables.cargoSpotter !== &quot;ACTIVE&quot; || !this.visualEffect || !this.visualEffect.isValid
        || !this.visualEffect.hasOwnProperty(&quot;$cargoSpotter_cargoEntity&quot;) || !this.visualEffect.$cargoSpotter_cargoEntity.isInSpace
        || !player.ship || !player.ship.isValid || this.visualEffect.position.distanceTo(player.ship.position) &gt; 25600) { 

            delete this.visualEffect.$cargoSpotter_cargoEntity.$cargoSpotter_tagged;
            this.visualEffect.remove();
            return;
    }
    this.visualEffect.position = this.visualEffect.$cargoSpotter_cargoEntity.position;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/cargoSpotter_worldScript.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;cargoSpotter_worldScript.js&quot;;
this.author      = &quot;Thargoid&quot;;
this.copyright   = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Script for Cargo Spotter&quot;;
this.version     = &quot;1.1&quot;;

//
// Event Handlers
//

//-----------------------------------------------------------------------------------//
this.startUp = this.shipLaunchedFromStation = this.shipExitedWitchspace = function _cspotter_start() { 
    if (player.ship.equipmentStatus(&quot;EQ_CARGOSPOTTER&quot;) === &quot;EQUIPMENT_OK&quot;) {
        missionVariables.cargoSpotter = &quot;ACTIVE&quot;; 
        this.$startTimer();
    } else 
        missionVariables.cargoSpotter = &quot;INACTIVE&quot;;
}

//-----------------------------------------------------------------------------------//
this.shipDied = this.shipDockedWithStation = this.shipWillEnterWitchspace = this.$stopTimer = function _cspotter_stopTimer() {
    missionVariables.cargoSpotter = &quot;INACTIVE&quot;;
    if (this.scanTimer &amp;&amp; this.scanTimer.isRunning) {
        this.scanTimer.stop();  
        delete this.scanTimer;
    }
}

//-----------------------------------------------------------------------------------//
this.equipmentDamaged = function _cspotter_equipmentDamaged(equipment) {
    if(equipment === &quot;EQ_CARGOSPOTTER&quot;)  { 
        missionVariables.cargoSpotter = &quot;INACTIVE&quot;;
        this.$stopTimer(); 
    }
}    

//
// Internal functions
//

//-----------------------------------------------------------------------------------//
this.$startTimer = function _cspotter_startTimer() { 
    if (!this.scanTimer)
        this.scanTimer = new Timer(this, this.$findCargo, 0, 1)
    else
        this.scanTimer.start();
}
    
//-----------------------------------------------------------------------------------//
this.$findCargo = function _cspotter_findCargo() { // cargo pods, alloys, boulders/splinters &amp;&amp; uncontrolled thargons
    function _cspotter_targetCargo(entity) { 
        return (    entity.isShip &amp;&amp; 
                    (entity.isCargo || entity.isBoulder || (entity.hasRole(&quot;thargon&quot;) &amp;&amp; entity.AI === &quot;dumbAI.plist&quot;) ) &amp;&amp; 
                    entity.isInSpace &amp;&amp; !entity.hasOwnProperty(&quot;$cargoSpotter_tagged&quot;)); 
    }

    var cargoArray = system.filteredEntities(this, _cspotter_targetCargo, player.ship, 25600); 
    if (cargoArray.length === 0) return;
    
    var i = cargoArray.length;
    var c;
    while (i--) {
        c = cargoArray[i];
        c.$cargoSpotter_tagged = true;
        this.glowKey = &quot;cargoSpotter_blueGlow&quot;; // default highlight glow for cargopods &amp; alloys
        if (c.hasRole(&quot;thargon&quot;)) this.glowKey = &quot;cargoSpotter_greenGlow&quot;;  // highlight inactive thargons in green
        if (c.isBoulder || c.hasRole(&quot;splinter&quot;)) this.glowKey = &quot;cargoSpotter_grayGlow&quot;;  // highlight rocks in grey
        if (c.hasRole(&quot;escape-capsule&quot;)) this.glowKey = &quot;cargoSpotter_redGlow&quot;;  // highlight escape pods in red            
        this.glow = system.addVisualEffect(this.glowKey, c.position);
        this.glow.$cargoSpotter_cargoEntity = c;
    }
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
