<html>
    <head>
        <title>Expansion Asteroid Storm</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Asteroid Storm</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">52 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">5 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>License not specified</li>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN CAPITAL LETTER A)(&#39;[]&#39; vs &#39;[Asteroids, Mission]&#39;)</li>
                <li>Unknown key &#39;licence&#39; at https://wiki.alioth.net/img_auth.php/2/2a/AsteroidStorm_4.3.oxz!manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>This OXP adds more models and textures for asteroids to the game and as bonus one mission.</td>
                    <td>This OXP adds more models and textures for asteroids to the game and as bonus one mission.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.LittleBear.AsteroidStorm</td>
                    <td>oolite.oxp.LittleBear.AsteroidStorm</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Asteroid Storm</td>
                    <td>Asteroid Storm</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Ambience</td>
                    <td>Ambience</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Little Bear, Eric Walch</td>
                    <td>Little Bear, Eric Walch</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>4.3</td>
                    <td>4.3</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>Asteroids, Mission</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Asteroid_Storm">http://wiki.alioth.net/index.php/Asteroid_Storm</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/2/2a/AsteroidStorm_4.3.oxz">https://wiki.alioth.net/img_auth.php/2/2a/AsteroidStorm_4.3.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873257</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Asteroid%20Storm'>http://wiki.alioth.net/index.php/Asteroid%20Storm</a></p>
        <h3>asteroidstorm_readme.txt</h3>
        <pre>			    	  Asteroid Storm OXP - V4.03
			        -----------------------------

			(New Asteroid Models and Textures by &quot;Charlie&quot;)
			         (Scripting by &quot;LittleBear&quot;)
			    (Further scripting for 3.4+  by &quot;Kaks&quot;)
				(Original JS script by &quot;Dajt&quot;)
			     (Galatic Police Image by &quot;Wombat&quot;)
                            (Retextured all asteroids by &quot;Eric&quot;)


With this version all of Charlies asteroids now appear, but in a much improved mesh and with normalmapping.

------------------------------------------------------------------------------------------------

An addon for Oolite by Giles Williams.

Based on &quot;Elite&quot; by Ian Bell and David Braben.

Version 4.03 - compatible with Oolite 1.74 and higher. 


-------------------------------------------------------------------------------------------------

Overview
--------

This OXP adds more models and textures for Asteroids to the game. All the new asteroids were
modeled and textured by &quot;Charlie&quot;, based upon asteroids in the Real Life Sol System. Some are
really big and will be marked by your ID computer as a &quot;Large Asteroid&quot;!

In the native game there are only two types of asteroid. If you play with this OXP installed then
there is more variety to the shapes and sizes of the asteroids you encounter as they have 15
different shapes and sizes. The chance and number of boulders formed when an asteroid is
destroyed also varies for each type of asteroid.

The OXP also adds an asteroid related mission, well suited to a novice commander in Galaxy 1.

You are docked at a station near Lave, in a system well known to suffer from asteroid storms.
Sure enough, as you drop off your cargo, you hear the sound of small asteroids glancing off
the Station&#39;s shields. Suddenly all hell breaks loose, Commanders running for their ships,
leaving their cargo behind!

A Large Asteroid has been detected approaching the Station. It is so massive that if it strikes,
destruction of the mighty Dodec is certain. Will you stay and help or get out of Dodge?

The mission has three possible endings depending on your actions.

The mission will trigger when you are docked at a certain system within 7 light years of Lave
and are ranked at least &quot;Above Average&quot;. I won&#39;t tell you the name of the system, but you may
find that checking your F7 screen gives a clue!

This is intended to be a fairly easy mission, but a bit of fun!

Updates from V1.0
-----------------

1) Version 2.0 adds the models and textures for Charlie&#39;s asteroids to the game generally.

2) A code optimisation to remove the System&#39;s station permanently, if it is destroyed.
   (The station is now removed by setting the System&#39;s station to &quot;none&quot;.)

Updates from V2.0
-----------------

1) Texture case names fixed. No problem on Windows or Mac, but the old version had case
sensitivity bugs, which caused a problem on Unix.

2) Eric&#39;s mission clash prevention code added, to ensure this OXP doesn&#39;t clash with any other
OXPs that display mission briefing screens.

3) The &quot;Large Asteroids&quot; added to the Universe generally have a higher energy value, making
them more resilient to laser fire than a small asteroid.

4) The system which &quot;suffers from deadly asteroid storms&quot; now has a higher than average number of
asteroids in the space lanes, and a small (non-dangerous) storm occurs near the station whenever
the system is visited. Displaced asteroids can also be seen whizzing through the spacelanes.

Updates from v.3.0
------------------ 

1) 	Legacy script: reduced number of tests done by the script to 3, improving overall system performance.

2) 	Made the mission slightly tougher.

3) 	Added alternative mission ending: in some cases, the station will be partially hit by the asteroid, with irreversible damage to the station&#39;s main reactor.

4) 	Further cleanup of asteroids, including solving more upper/lower case problems with linux &amp; case sensitive macs.

5) 	In case of cowardice, legal status now worsens by 25 points, as opposed to being set at 25.

6) 	1.68 and 1.69: message screen - after loading savegame - explaining how to enable the 1.65 version on their computer.

7) 	1.70: If the player score is 50% higher than the minimum required for the mission, the asteroid will be tougher still.

8) 	1.70: If the main station is destroyed, stations added by other OXPs will also be removed from the system.

9) 	1.70: Workaround for &#39;indestructible stations&#39;, With nice station explosion, 30-60 seconds after partial asteroid hit.

10)	1.70: Once mission finishes, run only 1 event handler, improving overall system performance.

11)	1.70: Mission records who destroyed the asteroid, and gives a smaller reward to player if NPCs did it.

12)	1.70: If the player had an energy bomb before the mission and can get back to the station, they get their bomb back.

13)	1.71: The further the asteroid is from the station, the more hits will be needed to destroy it.


v.3.45
------
- Cleanup script bugfixed, large asteroids labelled properly.

v.3.46
------

A role key is added to all asteroids added by this OXP. In the previous version only the Large Asteroids had a role. This
meant that only these appeared in game (oops)! On the old version, only 1 new type of asteroid was added even though the
OXP has the graphics and models to add 12 different types. The new versions now works as intended and you will see a greater
variety to the shapes and sizes of all asteroids in the Ooniverse. Only the graphics are changed, rocks are still rocks!

v.3.50
------
Because of the large scripting changes since Oolite 1.70, some of the special stuff to make it work with 1.70 is removed again and instead code is added to make it work with 1.71+. (1.72.0 has a bug but will generate a warning on screen. You need than to update to at least 1.72.1)
All normal big asteroids now have a script that let them generate additional boulders throughout the asteroid and not just in the centre. 

v.3.51
------
Added ships to &quot;help&quot; the player killing the asteroids.
Several minor bug fixes on 3.50.  

v.3.52
------
Changed role of station-alloy. Anything with station in the role is handled as such. Even as part of a name.

v.3.53
------
Added code so it won&#39;t run with Oolite 1.74+. It needs rewriting to work with that Oolite version.

v.3.54
------
Removed the warning.ogg sound from this oxp because it was already part of Oolite since at least Oolite 1.40.
Repaired the meshes of all asteroids (Griff). This gave much z-fighting of the texture. Completely retextured all asteroids with the original textures but now free of defects.

v3.55
------
Added low resolution normal maps to the asteroids for better experience on computers with shader capability.

v.4.00
------
Added the new mission offering for Oolite 1.74. Raised minimum version to 1.74.
Changed the asteroid behaviour in the mission system during the &quot;storm&quot;. They now fly a more logical path heading for the planet as centre of gravity.
Recompiled the asteroid models to the new .dat structure with explicit normals.
Added better resolution normal maps to the asteroids to simulate a surface texture on computers with shaders. (256x256 textures)
Randomised textures, so that any asteroid can get any texture so we now have 120 different combinations of asteroids and surface structure.
Disabled Oolite&#39;s own asteroids and boulders from appearing. (like_ship copies of them created by other oxp&#39;s will still appear)
Made the texture selection less random for asteroids added close to the previous one, resulting in areas of similar textured asteroids.
Added new boulders.

v.4.01
------
Fixed a casing bug that will give errors after Oolite 1.74

v.4.02
------
Changed the texture mapping on the asteroids. Now the same texture repeats a few times around the asteroids to create an effective higher resolution for the texture as seen in play.

v.4.02
------
Updated for Oolite 1.77+ were the energy bomb can be missing.

Known Performance Issues (for old systems like mine!)
----------------------------------------------------

When you launch into the Storm during the mission, Oolite will freeze for a few seconds whilst
it adds all the Asteroids to the Ooniverse. Once the Asteroids are added, the game runs normally.

If the Station is destroyed, Oolite will freeze for a few seconds whilst it adds all the
wreackage that the destroyed station throws out! 
Much of this slowdown is fixed in Oolite versions after Oolite 1.65


LittleBear &amp;&amp; Others
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder.html">ASBoulder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder1.html">ASBoulder1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder10.html">ASBoulder10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder11.html">ASBoulder11</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder2.html">ASBoulder2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder3.html">ASBoulder3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder4.html">ASBoulder4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder5.html">ASBoulder5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder6.html">ASBoulder6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder7.html">ASBoulder7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder8.html">ASBoulder8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ASBoulder9.html">ASBoulder9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid1.html">Asteroid</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid1-demo.html">Casteroid1-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid10.html">Casteroid10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid10-demo.html">Casteroid10-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid11.html">Casteroid11</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid11-demo.html">Casteroid11-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid12.html">Casteroid12</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid12-demo.html">Casteroid12-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid2.html">Casteroid2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid2-demo.html">Casteroid2-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid3.html">Casteroid3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid3-demo.html">Casteroid3-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid4.html">Casteroid4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid4-demo.html">Casteroid4-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid5.html">Casteroid5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid5-demo.html">Casteroid5-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid6.html">Casteroid6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid6-demo.html">Casteroid6-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid7.html">Casteroid7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid7-demo.html">Casteroid7-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid8.html">Casteroid8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid8-demo.html">Casteroid8-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid9.html">Casteroid9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/Casteroid9-demo.html">Casteroid9-demo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBasteroid1.html">Asteroid</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBasteroid10.html">LBasteroid10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBasteroid2.html">LBasteroid2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBasteroid3.html">LBasteroid3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBasteroid4.html">LBasteroid4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBasteroid5.html">LBasteroid5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBasteroid6.html">LBasteroid6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBasteroid7.html">LBasteroid7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBasteroid8.html">LBasteroid8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBasteroid9.html">LBasteroid9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBbadrock.html">Doomsday Asteroid</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBbadrockI.html">LBbadrockI</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBbadrockII.html">LBbadrockII</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBbadrockIII.html">LBbadrockIII</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/LBstationbits.html">Debris</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aststat.html">Leesti High</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/AsteroidStorm.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name			= &quot;AsteroidStorm&quot;;
this.author			= &quot;Dajt, Kaks, LittleBear&quot;;
this.copyright		= &quot;Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.description	= &quot;A mission to save a space station, original script.js (Oolite 1.65-js) by Dajt, updated &amp; expanded by Kaks &amp; adapted to Oolite 1.73+ by Eric.&quot;;
this.version		= &quot;4.03&quot;;

// declare working variables
this.badrocks=[&quot;badrockI&quot;,&quot;badrockII&quot;,&quot;badrockIII&quot;];
this.badrock=&quot;&quot;;
this.lasthit=&quot;&quot;;
this.lastPosition = 0;
/*
Materials from the following list are randomly used by the asteroids. You can add your own materials to the list by putting
your new textures in the texture folder and adding the definition to the list below.
Some materials use a seperate specular file, other materials use the diffuse texture as specular and have the
shininess map in the alpha chanel of this file.
*/
this.materials = [
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm01.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm01_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true}, 
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm02.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm06_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true}, 
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm02.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm02_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm03.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm03_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm05.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm05_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm05_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm05.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm03_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm07.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm07_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm08.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm04_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm08.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm08_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm09.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm09_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm09.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm03_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm09.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm07_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm10.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm10_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm11.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm11_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm11.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm13.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm02_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm_specular.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm13.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm13_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm13.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm14.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm14_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm14.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}},
{&quot;asteroid.png&quot;:{diffuse_map: {name:&quot;astorm15.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                normal_map: {name:&quot;astorm15_normal.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                specular_map: {name:&quot;astorm15.png&quot;, &quot;repeat_s&quot;:true, &quot;repeat_t&quot;:true},
                shininess: 30}}
];
this.lastMaterial = this.boulderMaterial = this.materials[0];
this.materialCount = this.materials.length;

this.startUp = function (){
	if (missionVariables.asteroids === &quot;asteroids_FINISHED&quot;) this.cleanup();
};

this.cleanup = function (){
    //disable the events - tell them why!
    delete this.shipWillLaunchFromStation;
    delete this.shipWillEnterWitchspace;
    delete this.missionScreenOpportunity;
};

this.anyInt = function (n1,n2){
    return Math.round(Math.random()*(n2-n1)+n1);
};

this.changeInfo = function (){
    var d=&quot;The planet Leesti is reasonably fabled for Zero-G cricket and Leestiian evil juice, but cursed by deadly asteroid storms. Leesti&#39;s orbital station was recently destroyed by a large asteroid strike. Ships without planet landing capabilities are therefore advised to avoid this system.&quot;;
    System.infoForSystem(0, 55).description = d;
    System.infoForSystem(0, 55).productivity /= 100;
};

this.wipeStationReally = function (){
	this.wipeStation(true);
};

this.wipeStation = function (really) {
	missionVariables.asteroids = &quot;asteroids_OVER&quot;;
	missionVariables.asteroids_statdead =1;
	this.byeStation=true;
	if (system.mainStation){
		system.mainStation.displayName=&quot;Damaged Leesti High&quot;;
    }
	if (system.countShipsWithRole(&quot;aststat&quot;)&gt;0){
		this.changeInfo();
        if (Math.random()&lt;.25||really){
			var pos=system.mainStation.position;
			system.mainStation.explode();
            system.addShips(&quot;alloy&quot;, 50, pos, 250);
            this.removeAllStations(); //(make sure no other station becomes mainStation)
		} else{
			system.description=system.description.replace(/was recently destroyed by/,&quot;is currently being evacuated after&quot;);
			system.mainStation.commsMessage(&quot;MAIN REACTOR BREACH, EXPLOSION IMMINENT!&quot;);
            system.mainStation.energy = 100;
			for (var i=0; i&lt;5; i++) system.mainStation.launchShuttle();
			this.setBadrockMiner(system.mainStation.launchShipWithRole(&quot;miner&quot;, true)); // true cancels all dockings.
			this.timer=new Timer(this, this.wipeStationReally, this.anyInt(18, 38));
		}
	} else{
		system.legacy_addSystemShips(&quot;alloy&quot;, 50, 1); //should work even with a missing station.
    }
};

this.missionScreenOpportunity = function (){
    if (player.ship.docked){
        this.missionOffers();
    }
};

this.missionOffers = function (){
	// Don&#39;t offer the missions when showing a mission screen  or mission.choice needs processing
	// wait until called again via missionScreenEnded, next docking, or missionChoiceWasReset
	if (this.myMissionShown) return;
	{
		if (!player.ship.dockedStation.isMainStation) return;
		if (system.ID===55 &amp;&amp; galaxyNumber===0){
			if ((!missionVariables.asteroids &amp;&amp; player.score&gt;63) || 
                            (missionVariables.asteroids === &quot;asteroids_BRIEFED&quot;)){
				missionVariables.asteroids = &quot;asteroids_BRIEFED&quot;;
				this.asteroids_bombremoved =
				this.asteroids_rockdead = 0;
				mission.runScreen({title: &quot;Asteroid Storm&quot;, messageKey: &quot;asteroidsbrief_1&quot;,
                            overlay: &quot;GalCop.png&quot;, model: this.badrocks[0], music: &quot;astormSiren.ogg&quot;}) // &quot;son et lumiere&quot; :)
                this.hullbang = new Timer(this, this.playHit, 4, 1); // add some ambiance.
				this.badrock=&quot;&quot;;
                this.myMissionShown= true;
			}
			if (missionVariables.asteroids===&quot;asteroids_RUNNING&quot;){
				// do we still have a doomsday asteroid?
				if (system.shipsWithRole(this.badrock).length&gt;0){
					mission.runScreen({title: &quot;Asteroid Storm&quot;, messageKey: &quot;asteroidsbrief_2&quot;,
                            overlay: &quot;GalCop.png&quot;, music: &quot;astormSiren.ogg&quot;});  //get back out!
                    this.hullbang = new Timer(this, this.playHit, 4, 1); // add some ambiance.
                } else { // inside the station, mission running, but no asteroid. this should never happen 
					missionVariables.asteroids = &quot;asteroids_OVER&quot;;
					this.asteroids_rockdead=1;
				}
                this.myMissionShown= true;
			}
		} 
		
		if (missionVariables.asteroids &amp;&amp; missionVariables.asteroids != &quot;asteroids_FINISHED&quot;) {
			if (missionVariables.asteroids === &quot;asteroids_COWARD&quot;){
				player.credits -= 200;
				player.bounty += 25;
				missionVariables.asteroids = &quot;asteroids_FINISHED&quot;;
				mission.runScreen({title: &quot;Asteroid Storm&quot;, messageKey: &quot;asteroidsbrief_3&quot;, overlay: &quot;GalCop.png&quot;});
				this.myMissionShown= true;
			}
			if (missionVariables.asteroids === &quot;asteroids_OVER&quot;){
				if (missionVariables.asteroids_statdead===1){ //0 or 1
					if (this.byeStation &amp;&amp; system.ID==55){ //&quot;damaged leesti&quot;
						//inside the damaged station.
						if (this.timer) this.timer.stop();
						if (this.asteroids_bombremoved&gt;0){
							this.addEnergyBomb();
						}
						mission.runScreen({title: &quot;Asteroid Storm&quot;, messageKey: &quot;asteroidsbrief_7&quot;, overlay: &quot;GalCop.png&quot;}); //we&#39;re doomed!
					}else{
                        // failed. Must be docking in an other system.
						mission.runScreen({title: &quot;Asteroid Storm&quot;, messageKey: &quot;asteroidsbrief_4&quot;, overlay: &quot;GalCop.png&quot;}); //you tried!
                    }
					player.credits += 200;
					if (system.ID!=55 || galaxyNumber!=0) //we saw the doomed station, didn&#39;t bother to go in
						this.changeInfo();
				} else if (this.asteroids_rockdead===1){
					if (this.badRockKiller===&quot;PLAYER&quot;){
						player.credits += 1000;
						player.bounty=0;
                        var addedBomb = this.addEnergyBomb(); // do it always here.
						if (addedBomb)
                            mission.runScreen({title: &quot;Asteroid Storm&quot;, messageKey: &quot;asteroidsbrief_5&quot;, overlay: &quot;GalCop.png&quot;});//you did it!
                        else
                            mission.runScreen({title: &quot;Asteroid Storm&quot;, messageKey: &quot;asteroidsbrief_5b&quot;, overlay: &quot;GalCop.png&quot;});//you did it!
					} else {
						player.credits += 350;
						mission.runScreen({title: &quot;Asteroid Storm&quot;, messageKey: &quot;asteroidsbrief_6&quot;, overlay: &quot;GalCop.png&quot;});//you helped doing it!
						if (this.asteroids_bombremoved&gt;0){
							this.addEnergyBomb();
						}
					}
				}
				missionVariables.asteroids = &quot;asteroids_FINISHED&quot;;
				this.myMissionShown= true;
			}
		}
	}
};

this.addEnergyBomb = function () {
    // equipment can be unknown after Oolite 1.76
    if (player.ship.equipmentStatus(&quot;EQ_ENERGY_BOMB&quot;) !== &quot;EQUIPMENT_UNKNOWN&quot;)
    {
        player.ship.awardEquipment(&quot;EQ_ENERGY_BOMB&quot;);
        return true;
    }
    return false;
}


/*
Credits to Kaks. Below Kaks uses a very complicated method to set properties of the badrock from
within this worldScript. In current Oolite versions one can do this much easier, but Kaks had to use
this complex way to let it work with Oolite 1.70. Part of the complexity I wrote out of it and part I 
let in as a tribute to Kaks who left some very nice sample code with it.
All b.xxx become properties of the rock itself and can be used in that ship script.
Without this the objects &quot;missionVariables&quot; and &quot;System&quot; could not be used reliable in oolite 1.70 ship scripts.
Eric Walch
*/
this.doomRocks = function (){
    if (!this.trajectory) this.setAsteroidTrajectory();
	var rockPosition;
	var rockDistance = this.anyInt(4000,20000);  // addition range relative to station.
	rockPosition = system.mainStation.position.add(this.trajectory.multiply(rockDistance));
	missionVariables.asteroids = &quot;asteroids_RUNNING&quot;;
    var badrock = system.addShips(this.badrock, 1, rockPosition, 10)[0];
    if (badrock){
        badrock.recharge=(rockDistance/7000)-1; //rough estimate
        badrock.scannerDisplayColor1 = [0.0, 0.8, 0.8, 1.0]; // cyan-like
        var miner = system.addShips(&quot;miner&quot;, 4, rockPosition, 10E3);
        for (var i=0; i&lt;miner.length; i++) if (miner[i]) this.setBadrockMiner(miner[i]);
        log(this.name, &quot;Adding doomsday asteroid at: &quot;+rockDistance+&quot; meters&quot;);
    }
    system.addShips(&quot;ast1&quot;, 27, rockPosition, 15E3);
};

this.setBadrockMiner = function (ship){
    ship.switchAI(&quot;LBbadrockMinerAI.plist&quot;);
    ship.primaryRole = &quot;LBbadrockMiner&quot;; // role needed to interact with badrock.
};

this.shipWillLaunchFromStation = function (){
	if (system.ID===55 &amp;&amp; galaxyNumber===0){
        this.myMissionShown=false;
		if (this.byeStation){
			this.timer=new Timer(this, this.wipeStationReally, this.anyInt(3,19));
			return;
		}
		var asteroids = system.countShipsWithPrimaryRole(&quot;ast1&quot;)
		if (asteroids&lt;3)
            for (var i=0; i&lt;4; i++) this.addAsteroid(3);
		if (missionVariables.asteroids === &quot;asteroids_RUNNING&quot;|| missionVariables.asteroids === &quot;asteroids_BRIEFED&quot;){
			if (player.ship.equipmentStatus(&quot;EQ_ENERGY_BOMB&quot;) === &quot;EQUIPMENT_OK&quot;){
				player.ship.removeEquipment(&quot;EQ_ENERGY_BOMB&quot;);
				this.asteroids_bombremoved=1;
			}
			if (this.badrock===&quot;&quot;){ // choose once.
				if (player.score&lt;96) this.badrock=this.badrocks[0]  // weak, easy with 2x beam laser.
				else if (player.score&lt;180) this.badrock=this.badrocks[1] // strong
				else this.badrock=this.badrocks[2]; // very strong, needs 2x military laser.
			}
			if (system.countShipsWithRole(this.badrock)===0)
				this.doomRocks();
		}
	}
};

this.shipWillEnterWitchspace = function (){
	if (missionVariables.asteroids === &quot;asteroids_RUNNING&quot;){
		if (system.countShipsWithRole(this.badrock)===0)
			missionVariables.asteroids = &quot;asteroids_OVER&quot;;
		else{
			missionVariables.asteroids = &quot;asteroids_COWARD&quot;;
			missionVariables.asteroids_statdead=1;
			this.changeInfo();
		}
	}
};

this.shipWillExitWitchspace = function (){
	if (system.ID===55 &amp;&amp; galaxyNumber===0){
        for (var i=0; i&lt;4; i++) this.addAsteroid(3);
		system.addShips(&quot;asteroid&quot;, 3);
		if (missionVariables.asteroids_statdead===1){
            this.timer = new Timer(this, this.removeAllStations, 0); // make sure it runs after all other oxps.
            this.timer2 = new Timer(this, this.removeAllStations, 5); // also remove delayed added ones.
            for (var i=0; i&lt;5; i++) this.addAsteroid(4); // add some more rocks during mission
		}
	}
};

this.removeAllStations = function (){
    // Find all stations and dockable items in the system.
    var stations = system.filteredEntities(this, function (entity) { return entity.isStation; });
    // Blow them all up.
    stations.forEach(function (entity) { entity.remove(true); });
};

this.setAsteroidTrajectory = function (){
    if (system.mainStation) this.trajectory = system.mainStation.position.subtract(system.mainPlanet.position).direction()
    else this.trajectory = new Vector3D(-0.95569, 0.131987, -0.263126);
};

this.addAsteroid = function (count){
    if (!this.trajectory) this.setAsteroidTrajectory();
    var multiplier = 3 + 10 * Math.random();
    var distance = system.mainPlanet.radius * multiplier; // at least 3 radii away (station is at 2 radii)
    var pos = system.mainPlanet.position.add(this.trajectory.multiply(distance));
    
    if (Math.random() &lt; 0.3) system.addShips(&quot;ast1&quot;, 1, pos, 1E3) // on very likely ramming course.
    else system.addShips(&quot;ast1&quot;, 1, pos, 10E3 * multiplier); // spread more widely
    
    // asteroids focus themself at one point on their journey to the planet, so spread them
    // furter appart when adding them further away.
    if (count &gt; 1) system.addShips(&quot;ast1&quot;, count-1, pos, 15E3 * multiplier);
};

// function is called by timer.
this.playHit = function (){
    if (!player.ship.docked){
        this.hullbang.stop();
        delete this.hullbang;
        return;
    }
    if (Math.random() &lt; 0.9) return;
    this.mySound = new SoundSource;
    this.mySound.sound = &quot;hullbang.ogg&quot;;
    this.mySound.play(1);
};

this.getMaterial = function (pos){
    var dif = pos - this.lastPosition;
    dif *= dif;
    if (dif &gt; 400E6){
        // Only switch material for distant asteroids so that we obtain asteroid clusters of similar type.
        // for effectifines we only compare the z component of the position.
        this.lastPosition = pos;
        this.lastMaterial = this.materials[Math.floor(Math.random()*this.materialCount)];
        //log(this.name, &quot;Made new material selection. Difference = &quot;+Math.round(Math.sqrt(dif))+&quot; m&quot;);
    }
    return this.lastMaterial;
};
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/AsteroidStormAsteroid.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name      = &quot;AsteroidStormAsteroid&quot;; 
this.author    = &quot;eric walch&quot;; 
this.copyright = &quot;� 2008 eric walch.&quot;; 
this.description = &quot;Code for an self colouring asteroid&quot;; 
this.version   = &quot;1.2&quot;;

this.shipSpawned = function(){ 
    this.ship.primaryRole = &quot;asteroid&quot;;
    if (this.ship.isBoulder){ // created by one of the very big asteroids.
        this.ship.displayName = &quot;Big boulder&quot;;
        this.ship.isBoulder = false;
    }
    this.material = worldScripts.AsteroidStorm.getMaterial(this.ship.position.z); // remember this.
    this.ship.setMaterials(this.material);
};

this.shipDied = function (){
    // store the used material in the worldScript, so the created boulders can
    // retreive it there. We have no direct reference to the created boulders.
    worldScripts.AsteroidStorm.boulderMaterial = this.material;
};</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/AsteroidStormBoulder.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name      = &quot;AsteroidStormBoulder&quot;; 
this.author    = &quot;eric walch&quot;; 
this.copyright = &quot;� 2008 eric walch.&quot;; 
this.description = &quot;Code for an self colouring boulder&quot;; 
this.version   = &quot;1.2&quot;;

this.shipSpawned = function (miner){ 
    this.ship.setMaterials(worldScripts.AsteroidStorm.boulderMaterial);
};
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/LBasteroid.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name      = &quot;LBAsteroid&quot;; 
this.author    = &quot;eric walch&quot;; 
this.copyright = &quot;� 2008 eric walch.&quot;; 
this.description = &quot;Code for regeneration of special asteroid&quot;; 
this.version   = &quot;1.00&quot;;

this.shipSpawned = function (){
    this.ship.savedCoordinates = system.mainPlanet.position;
    delete this.shipSpawned;
}

this.shipDied = function(ship){ 
    worldScripts.AsteroidStorm.addAsteroid(1);
    if (ship &amp;&amp; ship.isStation &amp;&amp; this.ship.position.distanceTo(player.ship) &lt; 7E3) this.playHit();

	delete this.shipDied; // make sure it is not called again.
}

this.playHit = function (){
    this.mySound = new SoundSource;
    this.mySound.sound = player.ship.docked ? &quot;hullbang.ogg&quot; : &quot;hit.ogg&quot;;
    this.mySound.play(1);
};</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/LBbadrock.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;LBbadrock&quot;;
this.author = &quot;LittleBear,Kaks&quot;;
this.copyright = &quot;Jan/Feb 2008 - But do what you like with it in your OXPs!&quot;;
this.description = &quot;who shot the asteroid last?&quot;
this.version = &quot;1.18&quot;;

this.lastEnergy = this.ship.energy;
this.lasthit = &quot;&quot;;

this.shipDied = function (who, why){
	log(this.name, &quot;Rock killed by: &quot;+who+&quot;, by means of &quot;+why)
	missionVariables.asteroids = &#39;asteroids_OVER&#39;;
	worldScripts[&quot;AsteroidStorm&quot;].asteroids_rockdead = 1;
    var bigExplosion = (this.lastEnergy &gt; this.ship.maxEnergy * 0.5); // player cheats with super weapon.
    var stationPosition = system.mainStation.position;
	if (who &amp;&amp; who.isStation || bigExplosion || why === &quot;cascade weapon&quot;) worldScripts[&quot;AsteroidStorm&quot;].wipeStation(false);
    if (bigExplosion){
        var rocks = this.ship.spawn(&quot;ast1&quot;, 20);
        var vel = stationPosition.subtract(this.ship.position).direction();
        for (var i=0; i &lt; 13; i++) rocks[i].velocity = vel.multiply(500 + Math.random()*1000); // throw some rocks in direction of station.
    }
	// Collided with station or player used Q-bomb or similar super weapon.
	if ((who &amp;&amp; who.isPlayer) || this.lasthit === &quot;PLAYER&quot;)
		worldScripts[&quot;AsteroidStorm&quot;].badRockKiller = &quot;PLAYER&quot;
    else
		worldScripts[&quot;AsteroidStorm&quot;].badRockKiller = &quot;NPC&quot;; // this line only happens when the 2 last shots were not the plaer!
	delete this.shipDied; // make sure it is not called again.
	// in 1.72 becomeExplosion is not triggering the shipDied event. 1.71 and probably 1.73 will. (Edit: only fixed since 1.75.4)
}

this.shipBeingAttacked = function (who){

    this.lasthit = (who &amp;&amp; who.isPlayer) ? &quot;PLAYER&quot; : &quot;NPC&quot;;
	if (who &amp;&amp; who.primaryRole === &quot;LBbadrockMiner&quot;) this.ship.energy = this.lastEnergy; // don&#39;t count the mining hits
	if (this.ship.recharge&gt;=0){
		this.ship.recharge-=(this.ship.maxEnergy-this.ship.energy)/this.ship.maxEnergy;
		this.ship.energy=this.ship.maxEnergy;
		}
	this.lastEnergy = this.ship.energy;
}

this.wipeStation = function (){
	this.shipDied(system.mainStation, &quot;scriptMessage&quot;)  //In oolite 1.72 the shipDied() is not executed for ships dying with an AI &quot;becomeExplosion&quot; command.
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
