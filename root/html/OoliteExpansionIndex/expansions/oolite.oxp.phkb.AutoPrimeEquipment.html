<html>
    <head>
        <title>Expansion Auto-Prime Equipment</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Auto-Prime Equipment</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>http://wiki.alioth.net/index.php/Auto-Prime%20Equipment -&gt; 404 Not Found</li>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Automatic priming of equipment when current MFD changes.</td>
                    <td>Automatic priming of equipment when current MFD changes.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.phkb.AutoPrimeEquipment</td>
                    <td>oolite.oxp.phkb.AutoPrimeEquipment</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Auto-Prime Equipment</td>
                    <td>Auto-Prime Equipment</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Miscellaneous</td>
                    <td>Miscellaneous</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>phkb</td>
                    <td>phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.2</td>
                    <td>1.2</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/2/2b/AutoPrimeEquipment.oxz">https://wiki.alioth.net/img_auth.php/2/2b/AutoPrimeEquipment.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-SA 4.0</td>
                    <td>CC-BY-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873258</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        
        <h3>readme.txt</h3>
        <pre>Auto Prime Equipment
By Nick Rogers

Overview
========
This OXP attempts to make life a bit simpler for pilots by automatically priming a specific piece of equipment whenever the MFD related to it is selected in an MFD slot. The trigger for the automatic priming is either when an MFD is cycled to a particular MFD ID (using the &quot;;&quot; key), or an MFD slot is selected where a particular MFD ID is already displayed (using the &quot;:&quot;) key.

At present, the following equipment items will be activated when their MFD is selected:
    Comms Log MFD (if the Comms Log is in non-passive mode)
    Damage Report MFD (if the Damage Report MFD is in non-passive mode)
    Broadcast Comms MFD
    Range Finder MFD
    Manifest Scanner
    Market Inquirer MFD
    Waypoint Here MFD
    Escort Deck
    Telescope
    
This OXP requires Oolite 1.86/86 in order to function.

3rd Party Interface
===================
If other MFD&#39;s would like to add themselves to this control mechanism, they simply need to add this line to their startup scripts:

  worldScripts.AutoPrimeEquipment.$addConfig(&quot;MyMFDID&quot;, &quot;EQ_MY_EQUIP_ID&quot;);

The first parameter is the ID being used for the MFD. This value is required.

The second parameter is the equipment key for the equipment item to be primed when the mfd ID is selected. Entering a value of &quot;&quot; (blank) will result in the MFD ID being removed from the list.

License
=======
This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/

Version History
===============
1.2
- Corrections to manifest.plist file.

1.1
- Added MFD/equipment item pairs for Telescope and Escort Deck.

1.0
- Initial public release
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;AutoPrimeEquipment&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2017 phkb&quot;;
this.description = &quot;Automatic priming of equipment when current MFD changes.&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;

// preloaded with some examples
this._config = {
    &quot;CommsLogMFD&quot;:&quot;EQ_COMMSLOGMFD&quot;,
    &quot;DamageReportMFD&quot;:&quot;EQ_DAMAGE_REPORT_MFD&quot;,
    &quot;BroadcastCommsMFD&quot;:&quot;EQ_BROADCASTCOMMSMFD&quot;,
    &quot;RangeFinderMFD&quot;:&quot;EQ_GCM_RANGE_FINDER_MFD&quot;,
    &quot;ManifestScanner&quot;:&quot;EQ_MANIF_SCANNER&quot;,
    &quot;inquirer_mfd&quot;:&quot;EQ_MARKET_INQUIRER_MFD&quot;,
    &quot;Waypoint_Here_MFD&quot;:&quot;EQ_WPH_ASC_UPGRADE&quot;,
    &quot;escortdeck&quot;:&quot;EQ_ESCORTDECK&quot;,
    &quot;telescope&quot;:&quot;EQ_TELESCOPE&quot;
};
this._unprime = &quot;&quot;;

//-------------------------------------------------------------------------------------------------------------
// public function to add extra config items
// mfdID = the ID of the MFD (required)
// eqKey = the equipment key for the equipment item to be primed when the MFD is selected
this.$addConfig = function(mfdID, eqKey) {
    if (mfdID === &quot;&quot;) return;
    if (eqKey === &quot;&quot; &amp;&amp; mfdID !== &quot;&quot;) {
        delete this._config[mfdID];
    } else {
        this._config[mfdID] = eqKey;
    }
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillLaunchFromStation = function() {
    // special case for escort deck, which has two different equipment items, depending on ship size
    if (player.ship.equipmentStatus(&quot;EQ_ESCORTDECKXL&quot;) === &quot;EQUIPMENT_OK&quot;) {
        this.$addConfig(&quot;escortdeck&quot;, &quot;EQ_ESCORTDECKXL&quot;);
    } else {
        this.$addConfig(&quot;escortdeck&quot;, &quot;EQ_ESCORTDECK&quot;);
    }
}

//-------------------------------------------------------------------------------------------------------------
this.selectedMFDChanged = function(index) {
    var equipkey = this._config[player.ship.multiFunctionDisplayList[index]];
    if (equipkey) this.$primeEquipment(equipkey); 
    else this.$unprimeEquipment();
}

//-------------------------------------------------------------------------------------------------------------
this.mfdKeyChanged = function(index, key) {
    var equipkey = this._config[key];
    if (equipkey) this.$primeEquipment(equipkey);
    else this.$unprimeEquipment();
}

//-------------------------------------------------------------------------------------------------------------
this.playerChangedPrimedEquipment = function(equipmentKey) {
    // if the player manually changes the primed equipment, but we have an unprime value set, update it
    if (equipmentKey !== &quot;&quot; &amp;&amp; this._unprime !== &quot;&quot; &amp;&amp; player.ship.equipmentStatus(equipmentKey) === &quot;EQUIPMENT_OK&quot;) this._unprime = equipmentKey;
}

//-------------------------------------------------------------------------------------------------------------
this.$primeEquipment = function(equipmentKey) {
    var p = player.ship;
    // only prime equipment if it&#39;s installed and undamaged
    if (p.equipmentStatus(equipmentKey) !== &quot;EQUIPMENT_OK&quot;) return;
    // check the currently primed equipment item
    if (p.hasOwnProperty(&quot;primedEquipment&quot;)) {
        var check = p.primedEquipment;
        // if it&#39;s not one of the ones in our config, make a note of it so we can switch back to it later
        if (!this.$equipmentInConfig(check)) this._unprime = p.primedEquipment;
    }
    p.setPrimedEquipment(equipmentKey);
}

//-------------------------------------------------------------------------------------------------------------
this.$unprimeEquipment = function() {
    if (this._unprime !== &quot;&quot;) {
        player.ship.setPrimedEquipment(this._unprime);
        this._unprime = &quot;&quot;;
    }
}

//-------------------------------------------------------------------------------------------------------------
this.$equipmentInConfig = function(equipmentKey) {
    var k = Object.keys(this._config);
    for (var i = 0; i &lt; k.length; i++) {
        if (this._config[k[i]] === equipmentKey) return true;
    }
    return false;
}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
