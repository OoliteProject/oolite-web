<html>
    <head>
        <title>Expansion Planetary Compass</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Planetary Compass</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER E)(&#39;[]&#39; vs &#39;[equipment, system]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds planets, suns and moons to the ASC, and gives names to them. Requires at least one name-pack to be installed</td>
                    <td>Adds planets, suns and moons to the ASC, and gives names to them. Requires at least one name-pack to be installed</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.PlanetaryCompass</td>
                    <td>oolite.oxp.Thargoid.PlanetaryCompass</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Planetary Compass</td>
                    <td>Planetary Compass</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.02</td>
                    <td>1.02</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>equipment, system</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                            <li>oolite.oxp.Thargoid.PlanetaryCompassPackA:1.00</li>
                            <li>oolite.oxp.Thargoid.PlanetaryCompassPackB:1.00</li>
                            <li>oolite.oxp.Thargoid.PlanetaryCompassPackC:1.00</li>
                            <li>oolite.oxp.Thargoid.PlanetaryCompassPackD:1.00</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Thargoid.PlanetaryCompassPackA:1.00</li>
                            <li>oolite.oxp.Thargoid.PlanetaryCompassPackB:1.00</li>
                            <li>oolite.oxp.Thargoid.PlanetaryCompassPackC:1.00</li>
                            <li>oolite.oxp.Thargoid.PlanetaryCompassPackD:1.00</li>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Planetary_Compass_OXP">http://wiki.alioth.net/index.php/Planetary_Compass_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/b/b9/Planetary_Compass_1.01.oxz">https://wiki.alioth.net/img_auth.php/b/b9/Planetary_Compass_1.01.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873451</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Planetary%20Compass'>http://wiki.alioth.net/index.php/Planetary%20Compass</a></p>
        <h3>Planetary Compass v1.02 Readme &amp; License.txt</h3>
        <pre>Planetary Compass OXP by Thargoid.

A little OXP which enables the advanced space compass to also detect planets (sub-planets) and moons. The planets appear as &quot;P&quot; and the moons as &quot;M&quot;. No purchases or installation (other than the OXP) is needed, it just fills in the odd gap that has always existed in the ASC.

The planets are named in order from the sun outward, using roman numeral designations after the systems name. The main planet is referred to as Prime. Moons are assigned random names, although these should be repeatable for a given system across multiple visits.

The .displayName parameter will be the full name as displayed (including the planetary body type), and the .name parameter will be just the planet/moons name without any other designation.

Lastly it is possible for other OXPs to introduce their own custom names to added planets or moons by setting its displayName or .name parameter (system.planets[x].displayName = &quot;yournamehere&quot; or equivalent .name). If both are set then displayName will be used. Built-in it will correctly name the Tianve pulsar from the Tianve OXP - if any other OXPs need such naming please let me know.

This OXP uses Cim&#39;s new visual effects class. It also works best with Cim&#39;s Talkative Advanced Space Compass and one of the planet/moon adding OXPs (System Redux etc).

Thus it requires Oolite version 1.80 or above to work.

--------------------------------------------------------------
License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement.
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)

--------------------------------------------------------------
Instructions:

Unzip the file, and then move the folder &quot;Planetary Compass 1.01.oxp&quot; to the AddOns directory of your Oolite installation. 

--------------------------------------------------------------
Version history:

08/01/2013 - Version 1.00 - First release.
11/02/2013 - Version 1.01 - Script tweak to also put delay on first station exit (to allow other scripts time to set up their planets and moons).
01/07/2014 - Version 1.02 - Update for oolite 1.80 scripting.

--------------------------------------------------------------

Acknowledgements:

Thanks to Cim for his work on the visual effects new code in Oolite 1.77, and for being so patient with my suggestions and requests for features etc. And to everyone who joined the discussion on the forum about planetary naming.

And thanks to Spara for the heads-up on the first launch issue, as it depends on script run order (which is OS dependent).</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>this.name           = &quot;planetaryCompass_worldScript.js&quot;;
this.author         = &quot;Thargoid&quot;;
this.copyright      = &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description    = &quot;World script for planetary compass OXP&quot;;
this.version        = &quot;1.02&quot;;
&quot;use strict&quot;;

this.startUp = function()
	{ 
	this.planetNames = [ &quot;I&quot;, &quot;II&quot;, &quot;III&quot;, &quot;IV&quot;, &quot;V&quot;, &quot;VI&quot;, &quot;VII&quot;, &quot;VIII&quot;, &quot;IX&quot;, &quot;X&quot;, &quot;XI&quot;, &quot;XII&quot;, &quot;XIII&quot;, &quot;XIV&quot;, &quot;XV&quot;, &quot;XVI&quot;, &quot;XVII&quot;, &quot;XVIII&quot;, &quot;XIX&quot;, &quot;XX&quot; ];
	this.moonNames = new Array();
	
	if(worldScriptNames.length &gt; 0) // scan for moon name pack scripts
		{
		var scriptCounter = 0 ; // reset the counter
		for(scriptCounter = 0;scriptCounter&lt;worldScriptNames.length;scriptCounter++)
			{
			if(worldScriptNames[scriptCounter] &amp;&amp; worldScripts[worldScriptNames[scriptCounter]] &amp;&amp; worldScripts[worldScriptNames[scriptCounter]].$planetaryCompass_addMoonNames)
				{ worldScripts[worldScriptNames[scriptCounter]].$planetaryCompass_addMoonNames(); }
			}
		}
	
	if(this.moonNames.length === 0)
		{
		log(&quot;Planetary Compass&quot;, &quot;No planetary compass moon name packs installed - please add at least one!&quot;);
		delete this.shipWillLaunchFromStation;
		delete this.shipExitedWitchspace;
		delete this.$setUpNames;
		delete this.$checkForSpecialPlanets;
		}
	}
	
this.shipWillLaunchFromStation = function(station)
	{
	this.shipExitedWitchspace();
	delete this.shipWillLaunchFromStation;
	}	

this.shipExitedWitchspace = function()
	{ this.scriptDelay = new Timer(this, this.$setUpNames, 0.25); }
	
this.$setUpNames = function()
	{
	this.$checkForSpecialPlanets();
	if(system.isInterstellarSpace || !system.sun || system.sun.isGoingNova || system.sun.hasGoneNova) { return; }

	function allPlanets(entity) {return entity.isPlanet}; 
	this.stellarArray = system.filteredEntities(this, allPlanets, system.sun); // use this instead of system.planets array to get order correct
		
	var moonRow = Math.floor(this.moonNames.length * system.scrambledPseudoRandomNumber(system.ID * galaxyNumber)); // chose a row from the name grid
	this.shuffleCount = 0;
	function shuffleMoons() 
		{
		this.shuffleCount++;
		return 0.5 - system.scrambledPseudoRandomNumber(system.ID + this.shuffleCount);
		}
	var systemMoons = this.moonNames[moonRow].sort(shuffleMoons); // shuffle the list of names in the row
	
	var moonCount = 0;
	var planetCount = 0;
	var loopCounter = 0;
	
	for(loopCounter = 0;loopCounter&lt;this.stellarArray.length;loopCounter++)
		{
		planetCount %= this.planetNames.length; // as a fallback in case there are more entities than name row items
		moonCount %= systemMoons.length;

		if(this.stellarArray[loopCounter].isMainPlanet)
			{
 			if(this.stellarArray[loopCounter].hasOwnProperty(&quot;isGasGiant&quot;) &amp;&amp; this.stellarArray[loopCounter].isGasGiant)
				{ this.planetType = &quot;Gas Giant&quot;; }
			else
				{ this.planetType = &quot;Planet&quot;; }
			system.mainPlanet.name = system.name + &quot; Prime&quot;;
			system.mainPlanet.displayName = system.name + &quot; Prime (&quot; + this.planetType + &quot;)&quot;;  
			planetCount++;
			continue; 
			}
		
		if(this.stellarArray[loopCounter].name !== system.name || this.stellarArray[loopCounter].name === undefined || this.stellarArray[loopCounter].displayName !== undefined) // if it&#39;s an OXP-added planet/moon entity which is already named
			{ continue; }

		if(this.stellarArray[loopCounter].hasAtmosphere)
			{ 
			this.beacon = system.addVisualEffect(&quot;planetaryCompass_planet&quot;, this.stellarArray[loopCounter].position); 
			if(this.stellarArray[loopCounter].hasOwnProperty(&quot;isGasGiant&quot;) &amp;&amp; this.stellarArray[loopCounter].isGasGiant)
				{ this.planetType = &quot;Gas Giant&quot;; }
			else
				{ this.planetType = &quot;Planet&quot;; }

			this.beacon.beaconCode = system.name + &quot; &quot; + this.planetNames[planetCount];
			this.beacon.beaconLabel = system.name + &quot; &quot; + this.planetNames[planetCount] + &quot; (&quot; + this.planetType + &quot;)&quot;;
			planetCount++;
			}
		else
			{ 
			this.beacon = system.addVisualEffect(&quot;planetaryCompass_moon&quot;, this.stellarArray[loopCounter].position);
			this.beacon.beaconCode = systemMoons[moonCount];
			this.beacon.beaconLabel = systemMoons[moonCount] + &quot; (Moon)&quot;;
			moonCount++;
			}
		}
	}

this.$checkForSpecialPlanets = function()
	{	
	if(galaxyNumber === 0 &amp;&amp; system.ID === 246) // if we&#39;re at Tianve (G0, S227), name the pulsar
		{
		for (let i=0; i&lt;system.planets.length; i++) 
			{ 
			if(system.planets[i].texture === &quot;tianve_pulsar.png&quot;) 
				{ system.planets[i].displayName = &quot;Tianve Pulsar&quot;; } 
			}
		return;	
		}
	}	</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
