<html>
    <head>
        <title>Expansion Duplex Fuel Tank</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Duplex Fuel Tank</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">8 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Additional fuel tank (3LY) with duplex interaction with main tank. Improved technology allows not only to pump the fuel in the main tank, but also to make the opposite action, for example, in/after skimming process.</td>
                    <td>Additional fuel tank (3LY) with duplex interaction with main tank. Improved technology allows not only to pump the fuel in the main tank, but also to make the opposite action, for example, in/after skimming process.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.AndreyBelov.DuplexFuelTank</td>
                    <td>oolite.oxp.AndreyBelov.DuplexFuelTank</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Duplex Fuel Tank</td>
                    <td>Duplex Fuel Tank</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Andrey Belov aka timer</td>
                    <td>Andrey Belov aka timer</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.52</td>
                    <td>0.52</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/DuplexFuelTank_OXP">http://wiki.alioth.net/index.php/DuplexFuelTank_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/1/17/DuplexFuelTank.oxz">https://wiki.alioth.net/img_auth.php/1/17/DuplexFuelTank.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1677423756</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Duplex%20Fuel%20Tank'>http://wiki.alioth.net/index.php/Duplex%20Fuel%20Tank</a></p>
        <h3>Readme.txt</h3>
        <pre>Duplex Fuel Tank OXP
====================

== Overview ==

Additional fuel tank (3LY) with duplex interaction with main tank.
Improved technology allows one not only to pump the fuel into the main tank,
but also to make the opposite action, for example, in skimming process.
The Duplex Fuel Tank takes 8t of cargo space. It is excellent purchase for
enthusiasts of long journeys — as now, You always can refuel ALL your tanks by
Sun skimming or from the gutted fuel tank of an unlucky pirate (with the remarkable Fuel Collector OXP).


== Requires ==

Oolite 1.79;
You need at least 8t free cargo space for device installation;
You must have bought the Fuel Scoops before this becomes available.


== Usage ==

Press &quot;Shift&quot;+&quot;n&quot; until you have selected the duplex tank as your primed equipment.
Press &quot;b&quot; to pump fuel from the main tank to the duplex tank.
Press &quot;n&quot; to pump fuel from the duplex tank to the main tank.


== Gratitude to ==

Smivs - thanks for all ;)


== History ==

2023-02-26 v0.52 - some code cleanup and minor changes.
2015-06-05 v0.51
2013-02-01 v0.4
2013-01-30 v0.3
2013-01-29 v0.1


== Links ==

https://wiki.alioth.net/index.php/DuplexFuelTank_OXP
http://aegidian.org/bb/viewtopic.php?f=4&amp;t=13489


== Licence ==

CC BY-NC-SA 3.0
see http://creativecommons.org/licenses/by-nc-sa/3.0/ for more info.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUPLEX_FUEL_TANK.html">Duplex Fuel Tank - takes up 8t of cargo space</a></td>
                    <td>no</td>
                    <td align="right">620000</td>
                    <td align="center">12+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUPLEX_FUEL_TANK_CTRL.html">DFT</a></td>
                    <td>no</td>
                    <td align="right">10</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUPLEX_FUEL_TANK_REFILL.html">Refill 1LY in additional DFT</a></td>
                    <td>no</td>
                    <td align="right">75</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUPLEX_FUEL_TANK_REMOVAL.html">Sell Duplex Fuel Tank - reclaims 8t of cargo space</a></td>
                    <td>yes</td>
                    <td align="right">4200</td>
                    <td align="center">12+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUPLEX_FUEL_TANK_STATE_0.html">Duplex Fuel Tank (empty)</a></td>
                    <td>yes</td>
                    <td align="right">10</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUPLEX_FUEL_TANK_STATE_1.html">Duplex Fuel Tank (1/3)</a></td>
                    <td>yes</td>
                    <td align="right">10</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUPLEX_FUEL_TANK_STATE_2.html">Duplex Fuel Tank (2/3)</a></td>
                    <td>yes</td>
                    <td align="right">10</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_DUPLEX_FUEL_TANK_STATE_3.html">Duplex Fuel Tank (full)</a></td>
                    <td>yes</td>
                    <td align="right">10</td>
                    <td align="center">2+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. 
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/duplex_fuel_tank.js</td>
                    <td><pre>(function(){

&#39;use strict&#39;;

this.name        = &#39;DuplexFuelTank&#39;;
this.author      = &#39;Andrey Belov&#39;;
this.copyright   = &#39;© 2015 Andrey Belov aka timer [ TiNe Corp. ]&#39;;
this.licence     = &#39;CC BY-NC-SA 3.0&#39;; // see http://creativecommons.org/licenses/by-nc-sa/3.0/ for more info.
this.description = &#39;Additional fuel tank with duplex interaction with main tank.&#39;;
this.version     = &#39;0.52&#39;;


const _DFT_MAX_FUEL      = 3;
const _DFT_MAX_SHIP_FUEL = 7.0;


this.playerBoughtEquipment = function(equipmentKey) {
    if ( equipmentKey === &#39;EQ_DUPLEX_FUEL_TANK_REFILL&#39; ) {
        this._dft_refill();
    }
    else if ( equipmentKey === &#39;EQ_DUPLEX_FUEL_TANK&#39; ) {
        this._dft_buy();
    }
    else if ( equipmentKey === &#39;EQ_DUPLEX_FUEL_TANK_REMOVAL&#39; ) {
        this._dft_sell();
    }
};

this._dft_buy = function() {
    player.ship.awardEquipment(&#39;EQ_DUPLEX_FUEL_TANK_CTRL&#39;);
    player.ship.awardEquipment(&#39;EQ_DUPLEX_FUEL_TANK_STATE_&#39; + _DFT_MAX_FUEL);
};

this._dft_sell = function() {
    player.ship.removeEquipment(&#39;EQ_DUPLEX_FUEL_TANK_REMOVAL&#39;);
    player.ship.removeEquipment(&#39;EQ_DUPLEX_FUEL_TANK_CTRL&#39;);
    let cs = this._dft_get_current_state();
    player.ship.removeEquipment(&#39;EQ_DUPLEX_FUEL_TANK_STATE_&#39; + cs);
    player.ship.removeEquipment(&#39;EQ_DUPLEX_FUEL_TANK&#39;);
    player.credits += (EquipmentInfo.infoForKey(&#39;EQ_DUPLEX_FUEL_TANK&#39;).price * 0.07);
};

this._dft_refill = function() {
    let cs = this._dft_get_current_state();

    player.ship.removeEquipment(&#39;EQ_DUPLEX_FUEL_TANK_REFILL&#39;);
    if ( cs &lt; _DFT_MAX_FUEL ) {
        player.ship.removeEquipment(&#39;EQ_DUPLEX_FUEL_TANK_STATE_&#39; + cs);
        player.ship.awardEquipment(&#39;EQ_DUPLEX_FUEL_TANK_STATE_&#39; + (cs+1));
    }
};

// Call from EQ script
this.$dft_pump_to_main = function() {
    let cs = this._dft_get_current_state();

    if ( cs &lt; 1 ) {
        this._dft_print(&#39;DFT: additional tank is empty.&#39;);
        return;
    }

    if ( player.ship.fuel &gt;= _DFT_MAX_SHIP_FUEL ) {
        this._dft_print(&#39;DFT: main tank full.&#39;);
        return;
    }

    let ff = 1.0 - ( _DFT_MAX_SHIP_FUEL - player.ship.fuel );
    if ( ff &gt; 0 ) {
        this._dft_print(&#39;DFT: main tank full, &#39; + ff.toFixed(1) + &#39; fuel lost.&#39;);
    }

    player.ship.removeEquipment(&#39;EQ_DUPLEX_FUEL_TANK_STATE_&#39; + cs);
    cs--;
    player.ship.awardEquipment(&#39;EQ_DUPLEX_FUEL_TANK_STATE_&#39; + cs);

    player.ship.fuel += 1.0;

    if ( player.ship.fuel &gt; _DFT_MAX_SHIP_FUEL ) {
        // should never happens
        player.ship.fuel = _DFT_MAX_SHIP_FUEL;
    }

    this._dft_print_state(cs);
};

// Call from EQ script
this.$dft_pump_from_main = function() {
    let cs = this._dft_get_current_state();

    if ( cs &gt;= _DFT_MAX_FUEL ) {
        this._dft_print(&#39;DFT: additional tank is full.&#39;);
        return;
    }

    if ( player.ship.fuel &lt; 1.0 ) {
        this._dft_print(&#39;DFT: main tank too low.&#39;);
        return;
    }

    player.ship.removeEquipment(&#39;EQ_DUPLEX_FUEL_TANK_STATE_&#39; + cs);
    cs++;
    player.ship.awardEquipment(&#39;EQ_DUPLEX_FUEL_TANK_STATE_&#39; + cs);

    player.ship.fuel -= 1.0;

    this._dft_print_state(cs);
};

this._dft_print_state = function(cs) {
    this._dft_print(&#39;DFT state: &#39; + cs + &#39;/&#39; + _DFT_MAX_FUEL);
};

this._dft_print = function(msg) {
    // TODO MFD?
    player.consoleMessage(msg, 3);
};

this._dft_get_current_state = function() {
    for ( let k = 0; k &lt;= _DFT_MAX_FUEL; k++ ) {
        if ( player.ship.equipmentStatus(&#39;EQ_DUPLEX_FUEL_TANK_STATE_&#39;+k) === &#39;EQUIPMENT_OK&#39; ) {
            return k;
        }
    }

    return 0;
};

// Special for Smivs ;)
this.$dftSabotage = function() {
    if ( player.ship.equipmentStatus(&#39;EQ_DUPLEX_FUEL_TANK&#39;) === &#39;EQUIPMENT_OK&#39; ) {
        let cs = this._dft_get_current_state();
        if ( cs &gt; 0 ) {
            player.ship.removeEquipment(&#39;EQ_DUPLEX_FUEL_TANK_STATE_&#39; + cs);
            player.ship.awardEquipment(&#39;EQ_DUPLEX_FUEL_TANK_STATE_0&#39;);
            player.consoleMessage(&#39;DFT malfunction: fuel leak!&#39;, 3);
        }
    }
};

// Condition scripting method (Thanks Smivs again)
this.allowAwardEquipment = function( equipment, ship, context ) {
    // Can&#39;t buy service equipment - only scripting operations
    return !!(context == &#39;scripted&#39;);
};

}).call(this);
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/eq_duplex_fuel_tank.js</td>
                    <td><pre>(function(){

&#39;use strict&#39;;

this.name        = &#39;eqDuplexFuelTank&#39;;
this.author      = &#39;Andrey Belov&#39;;
this.description = &#39;http://wiki.alioth.net/index.php/DuplexFuelTank_OXP&#39;;


/* Use button &quot;n&quot; for pump fuel to main tank */
this.activated = function() {
    this._dft_pump(true);
};

/* Use button &quot;b&quot; for pump fuel from main tank */
this.mode = function() {
    this._dft_pump(false);
};

this._dft_pump = function(mode) {
    if ( player.ship.equipmentStatus(&#39;EQ_DUPLEX_FUEL_TANK&#39;) !== &#39;EQUIPMENT_OK&#39; ) {
	    return;
	}

	let dft = worldScripts[&#39;DuplexFuelTank&#39;];

    if (mode) {
        dft.$dft_pump_to_main();
    }
    else {
        dft.$dft_pump_from_main();
    }
};

}).call(this);
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
