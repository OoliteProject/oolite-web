<html>
    <head>
        <title>Expansion Space Crowds</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Space Crowds</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">1 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Unknown key &#39;upload_date&#39; at https://wiki.alioth.net/img_auth.php/6/6c/Oolite.oxp.astrobe.spacecrowds.oxz!manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds random encounters in deep space.

Based on and inspired from E. Walch&#39;s Deep Space Pirates.</td>
                    <td>Adds random encounters in deep space.

Based on and inspired from E. Walch&#39;s Deep Space Pirates.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.astrobe.spacecrowds</td>
                    <td>oolite.oxp.astrobe.spacecrowds</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Space Crowds</td>
                    <td>Space Crowds</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Activities</td>
                    <td>Activities</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Astrobe</td>
                    <td>Astrobe</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.2.0</td>
                    <td>1.2.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://www.aegidian.org/bb/viewtopic.php?f=4&amp;t=19053">http://www.aegidian.org/bb/viewtopic.php?f=4&amp;t=19053</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/6/6c/Oolite.oxp.astrobe.spacecrowds.oxz">https://wiki.alioth.net/img_auth.php/6/6c/Oolite.oxp.astrobe.spacecrowds.oxz</a></td>
                    <td><a target="_blank" href="http://wiki.alioth.net/img_auth.php/6/6c/Oolite.oxp.astrobe.spacecrowds.oxz">http://wiki.alioth.net/img_auth.php/6/6c/Oolite.oxp.astrobe.spacecrowds.oxz</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873328</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Space%20Crowds'>http://wiki.alioth.net/index.php/Space%20Crowds</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/DSProck-hermit.html">DSProck-hermit</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;spacecrowds&quot;; 
this.author      = &quot;Astrobe&quot;; 
this.copyright   = &quot;2017 Creative Commons: attribution, non-commercial, sharealike.&quot;; 
this.description = &quot;Creates random encounters when the Torus drive has been in use for a long time.&quot;; 
this.version     = &quot;1.2.0&quot;;
// Configurability contributed by PHKB.
// Additionnal options to preserve derelicts and asteroids contributed by Dybal.

/* How to add your own encounter scenarios:
 * Create a function that spawns all the necessary stuff.
 * This function will be called by Space Crowds (SC):
 * - with one parameter which is around where to spawn the ships (typically you pass it to system.addGroup().
 *   This is a suggested position that is a few scanner ranges ahead of the player. But you can spawn your ships
 *   behind the player if you want. Just make sure the player has good chances to be masslocked as a result.
 *   The masslock doesn&#39;t have to be certain, for the player to be able to avoid trouble by careful eyeballing
 *   is considered &quot;fair game&quot; (let other OXPs like Bullet Drive deal with that if that&#39;s too easy for some players).
 * - this is bound to SC&#39;s script object, so you can use its facilities like $spawnRandomRoles
 * Then, call $pushScenario or $pushRareScenario with your name of the symbol of your function.
 * There are two scenario lists. The former is used 99% of the times, the latter 1% of the times.
 * Among those two lists the probabilities are even.
 * If you really want to give your scenario relatively more weight, just push it multiple times.
 *
 * $spawnRandomRoles(n, role, pos, radius)
 * $spawnRandomRoles is a utility function that let you spawn easily a group of ships in one role.
 * n is the maximum number of ships. The function performs n-1 times a coinflip to determine how many
 * ships to spawn. As a result, we get a bell curve-like distribution centered on n/2, meaning that
 * the function will spawn most often n/2 ships, and more rarely 1 or n. The function will spawn at least
 * one ship.
 * roles is a string indicating the role of the ships (&quot;pirate&quot; or &quot;police&quot; or &quot;trader&quot; etc.)
 * pos is the spawning position; typically you pass the suggested position you&#39;ve received from SC.
 * radius is the radius of the spawning sphere. The bigger, the more the ships will be spread-out.
 * This parameter is optional and will default to 5Km if not given (scanner range is 25Km).
 *
 * How to test your scenarios
 * The main problem with testing is that scenarios are chosent randomly, so it can take a while
 * until you get your scenario.
 * Use $flushScenarios() to remove the other scenarios and then add your scenario, so your scenario
 * will be the only available one besides the rare scenarios. When you&#39;re done testing, remove the
 * the $flushScenarios() line and move your scenario to the $pushRareScenario() if needed.
 * You can use the $report() function to log whatever you need to.
 *
 * Possible errors:
 * Javascript exception &quot;group is null&quot; : role doesn&#39;t exist; could be a typo in the name (eg &quot;hunters&quot; instead of &quot;hunter&quot;)
 * Javascript exception &quot;commonEvents is undefined&quot;: scenario list is empty. Maybe you flushed (for testing purposes)
 * the scenarion list after you added your scenario? Can also be a typo in scenario name.
 */

this.$commonEvents=[];
this.$rareEvents=[];
this.$spawnedShips=[];
this.$chance = 0.02;
this.$rare_chance = 0.01;
this.preserve_derelicts = false;
this.preserve_asteroids = false;

this.libSettings = {Name:this.name, Display:&quot;Config&quot;, Alias:&quot;Space Crowds&quot;, Alive:&quot;libSettings&quot;,
Bool:{
    B0:{Name:&quot;$preserve_derelicts&quot;, Def:false, Desc:&quot;Preserve derelicts&quot;},
    B1:{Name:&quot;$preserve_asteroids&quot;, Def:false, Desc:&quot;Perserve asteroids&quot;},
    Info:&quot;true:Preserve, false:Remove when out of player&#39;s sight&quot;},
SInt:{
	S0:{Name:&quot;$chance&quot;, Def:0.02, Min:0.0001, Max:1, Desc:&quot;Chance of encounter&quot;, Float:true},
	S1:{Name:&quot;$rare_chance&quot;, Def:0.01, Min:0.0001, Max:1, Desc:&quot;Rare chance&quot;, Float:true},
	Info:&quot;0 - Chance of having an encounter\n1 - Chance of encounter being a rare one&quot;},
};

// utilities
this.$spawnRandomRoles=function(n, roles, pos, radius)
{
	radius = (typeof radius !== &#39;undefined&#39;) ?  radius : 8E3;
	var random=Math.random;
	var count=1; // at least one
	for(var i=0; i&lt;n-1; i++)
	{
		if(random()&lt;0.5) continue;
		count++;
	}

    var group=system.addGroup(roles, count, pos, radius);
	group.ships.forEach(function(ship) {ship.fuel=random()*7; this.$spawnedShips.push(ship); }, this);
    this.$report(&quot;Adding &quot; + count + &quot; &quot; + roles);
	return group;
}

// basic scenarios
this.$small_pirate_pack=function(pos) {this.$spawnRandomRoles(5, &quot;pirate&quot;, pos);}
this.$small_hunter_pack=function(pos) {this.$spawnRandomRoles(5, &quot;hunter&quot;, pos);}
this.$small_police_patrol=function(pos) {this.$spawnRandomRoles(5, &quot;police&quot;, pos);}
this.$small_traders_pack=function(pos) {this.$spawnRandomRoles(5, &quot;trader&quot;, pos);}

this.$adaptative=function(pos)
{
	this.$report(&quot;Adaptative&quot;);
	var s=system.government;
	if(s&lt;=4) this.$spawnRandomRoles(7-s, &quot;pirate&quot;, pos);
	else this.$spawnRandomRoles(s, &quot;police&quot;, pos);
}

this.$pirates_vs_police=function(pos)
{
	this.$report(&quot;Pirates vs Police&quot;);
	this.$small_pirate_pack(pos);
	this.$small_police_patrol(pos);
}

this.$pirates_vs_hunters=function(pos)
{
	this.$report(&quot;Pirates vs Hunters&quot;);
	this.$small_pirate_pack(pos);
	this.$small_hunter_pack(pos);
}

this.$pirates_vs_traders=function(pos)
{
	this.$report(&quot;Pirates vs Traders&quot;);
	this.$small_pirate_pack(pos);
	this.$small_traders_pack(pos);
}

this.$boulder_field=function(pos)
{
	// The &quot;popping&quot; with asteroids is too obvious, so we use boulders.
	// However, they seem to have a low &quot;visibility range&quot;, so typically
	// some of them are almost immediately removed.
	// We should give those boulder some speed so as to deter miner-players
	// from setting a way point here in order to come back later; they won&#39;t find
	// anything because those boulders will be removed as soon as they get out
	// of sight.
	this.$report(&quot;Boulders&quot;);
	var g=this.$spawnRandomRoles(20, &quot;boulder&quot;, pos, 2E3);
	g.ships.forEach(function(ship) { ship.temperature=0; }, this);

}

this.$empty=function(pos)
{
	this.$report(&quot;Empty&quot;);
}

this.$cargo=function(pos)
{
	this.$report(&quot;Cargo&quot;);
	if(Math.random()&lt;0.5) this.$spawnRandomRoles(1, &quot;cargopod&quot;, pos);
}

this.$traders_vs_thargoids=function(pos) // rare
{
	this.$report(&quot;Traders vs Thargoids&quot;);
	this.$small_traders_pack(pos);
	this.$spawnRandomRoles(5, &quot;thargoid&quot;, pos);
}

this.$police_vs_thargoids=function(pos) // rare
{
	this.$report(&quot;Police vs Thargoids&quot;);
	this.$small_police_patrol(pos);
	this.$spawnRandomRoles(6, &quot;thargoid&quot;, pos);
}

this.$thargoid_fleet=function(pos) // rare
{
	// Around 5 Thargoid ships, expect no support.
	this.$report(&quot;Tharmageddon!&quot;);
	this.$spawnRandomRoles(10, &quot;thargoid&quot;, pos);
}
this.$pirateNet=function(pos) // rare
{
	// A large group of pirates widely spread in order to catch lone ships
	this.$report(&quot;Pirate net&quot;);
	this.$spawnRandomRoles(10, &quot;pirate&quot;, pos, 15E3);
}

this.$pushScenario = function (proc)
{
	this.$commonEvents.push(proc);
}

this.$pushRareScenario = function (proc)
{
	this.$rareEvents.push(proc);
}

this.$flushScenarios = function (proc)
{
	this.$commonEvents.length=0;
}

this.$report = function (msg)
{
	log(this.name, msg);
}

this.startUp = function ()
{
	this.dsGroup = new ShipGroup(&quot;DeepSpaceShips&quot;); // start with an empty group
	//this.$pushScenario(this.$small_pirate_pack);
	//this.$pushScenario(this.$small_police_patrol);
	this.$pushScenario(this.$small_traders_pack);
	this.$pushScenario(this.$small_hunter_pack);
	this.$pushScenario(this.$empty);
	this.$pushScenario(this.$pirates_vs_police);
	this.$pushScenario(this.$pirates_vs_hunters);
	this.$pushScenario(this.$pirates_vs_traders);
	this.$pushScenario(this.$boulder_field);
	this.$pushScenario(this.$cargo);
	this.$pushScenario(this.$adaptative);
	this.$pushRareScenario(this.$traders_vs_thargoids);
	this.$pushRareScenario(this.$police_vs_thargoids);
	this.$pushRareScenario(this.$thargoid_fleet);
	this.$pushRareScenario(this.$pirateNet);
}

this.startUpComplete = function() {
	if (missionVariables.SpaceCrowds_Chance) this.$chance = parseFloat(missionVariables.SpaceCrowds_Chance);
	if (missionVariables.SpaceCrowds_Rare) this.$rare_chance = parseFloat(missionVariables.SpaceCrowds_Rare);
    if (missionVariables.SpaceCrowds_Preserve_Derelicts &amp;&amp; missionVariables.SpaceCrowds_Preserve_Derelicts == 1)
        this.$preserve_derelicts = true;
    else
        this.$preserve_derelicts = false;
    if (missionVariables.SpaceCrowds_Preserve_Asteroids &amp;&amp; missionVariables.SpaceCrowds_Preserve_Asteroids == 1)
        this.$preserve_asteroids = true;
    else
        this.$preserve_asteroids = false;

	// register our settings, if Lib_Config is present
	if (worldScripts.Lib_Config) worldScripts.Lib_Config._registerSet(this.libSettings);
}

this.playerWillSaveGame = function() {
	missionVariables.SpaceCrowds_Chance = this.$chance;
	missionVariables.SpaceCrowds_Rare = this.$rare_chance;
    if (this.$preserve_derelicts) 
        missionVariables.SpaceCrowds_Preserve_Derelicts = 1;
    else
        missionVariables.SpaceCrowds_Preserve_Derelicts = 0;
    if (this.$preserve_asteroids) 
        missionVariables.SpaceCrowds_Preserve_Asteroids = 1;
    else
        missionVariables.SpaceCrowds_Preserve_Asteroids = 0;
        
}

this.shipLaunchedFromStation = function ()
{
    if (this.checkTimer)
        this.checkTimer.start()
    else
        this.checkTimer = new Timer(this, this.$check, 5, 1000/(player.ship.maxSpeed*3)); // about every 1.3 second for Adder (maxSpeed=240).
}

this.$check = function ()
{
	if(player.ship.torusEngaged
			&amp;&amp; Math.random()&gt;(1 - this.$chance)
			&amp;&amp; !system.isInterstellarSpace) 
	{
		this.$report(&quot;Chance!&quot;);
		this.$createEncounter();
	}
	else
	{
		this.$removeFarShips();
	}
}

this.$createEncounter = function ()
{
	var ourShip=player.ship;
	if(system.countShipsWithRole(&quot;station&quot;, ourShip, 240E3) &gt; 0)
	{
		this.$report(&quot;Station nearby&quot;);
		return;
	}

	var pos = ourShip.position.add(ourShip.heading.multiply(48E3)).add(Vector3D.random(15E3));

	if(Math.random()&lt;this.$rare_chance)
	{
		var n=Math.floor(Math.random()*this.$rareEvents.length);
		this.$rareEvents[n].call(this, pos);
	}
	else
	{
		var n=Math.floor(Math.random()*this.$commonEvents.length);
		this.$commonEvents[n].call(this, pos);
	}
}

this.$removeFarShips=function()
{
	var spawnedShips=this.$spawnedShips;
	var count=0;
	var e;
	for(var i=0; i&lt;spawnedShips.length; i++)
	{
		// ship might actually be long dead, but Oolite seems to handle that case well.
		try
		{
			if(!spawnedShips[i].position.distanceTo(player.ship.position)&gt;100E3)
			{
				if(spawnedShips[i].isShip &amp;&amp; 
						!(this.preserve_derelicts &amp;&amp; spawnedShips[i].isDerelict) &amp;&amp;
						!(this.preserve_asteroids &amp;&amp; spawnedShips[i].isBoulder) )
				{
					spawnedShips[i].remove();
					spawnedShips[i]=null; // for cleanup
					count++;
				}
			}
		}
		catch(e)
		{
			spawnedShips[i]=null;
		}
	}
	//cleanup
	if(count)
	{
		this.$spawnedShips=spawnedShips.filter(function(e) { return e!=null; });
		this.$report(&quot;Removed &quot;+count+&quot; ships&quot;);
	}
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
