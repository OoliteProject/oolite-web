<html>
    <head>
        <title>Expansion Fuel Collector</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Fuel Collector</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">2 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Found XML equipment list</li>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN CAPITAL LETTER E)(&#39;[]&#39; vs &#39;[Equipment]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td> 	Fuel Collector scoops fuel from killed ships and collects fuel while cruising, even in witch space.</td>
                    <td> 	Fuel Collector scoops fuel from killed ships and collects fuel while cruising, even in witch space.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Frame.FuelCollector</td>
                    <td>oolite.oxp.Frame.FuelCollector</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Fuel Collector</td>
                    <td>Fuel Collector</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Frame</td>
                    <td>Frame</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.07</td>
                    <td>0.07</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Fuel_Collector_OXP">http://wiki.alioth.net/index.php/Fuel_Collector_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/c/c9/Oolite.oxp.Frame.FuelCollector.oxz">https://wiki.alioth.net/img_auth.php/c/c9/Oolite.oxp.Frame.FuelCollector.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 3.0</td>
                    <td>CC BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873469</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Fuel%20Collector'>http://wiki.alioth.net/index.php/Fuel%20Collector</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_FRAME_FUEL_COLLECTOR.html">Fuel Collector</a></td>
                    <td>yes</td>
                    <td align="right">20000</td>
                    <td align="center">11+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/FuelC-cob3-alternate.html">Cob3 Fuel ship tester</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/frame_itsatrap.html">Wreckage</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/frame_fuel_collector.js</td>
                    <td><pre>this.name        = &quot;Fuel Collector&quot;; 
this.author      = &quot;Dennis Thony Pedersen (frame)&quot;; 
this.copyright   = &quot;CC BY-NC-SA 3.0&quot;; 
this.description = &quot;Device that collects fuel from wrecks &amp; derelict ships&quot;; 
this.version     = &quot;0.07&quot;; 

this.startUp = function()
{
	//modify this array if certain roles falls outside your preferences
	//These roles are ships that are &quot;hackeble&quot; by the Fuel Collector
	//you can ofcourse remove the con_role to, its there for fast editing...
this.legitDerelictRoles = new Array (
	&quot;pirate&quot;,
	&quot;trader&quot;,
	&quot;hunter&quot;,
	&quot;escort&quot;,
	&quot;sunskim-trader&quot;,
	&quot;shuttle&quot;,
	&quot;miner&quot;,
	&quot;scavenger&quot;,
	&quot;dredgerDerelict&quot;, // on request of lestradae 
	&quot;Fuel_collector_estest&quot; // allways carries an escape pod...
	)

this.fuel_below01 = 0
this.fuel_level_1 = 5
this.fuel_level_2 = 10
this.fuel_level_3 = 20
this.fuel_level_4 = 30
this.checkawardhowoften = 3
this.myswitch = true	//reactivated for 1.72 and 1.72.1
this.myswitch1 = false	//reactivated for 1.72 and 1.72.1
this.myswitch3 = false; //switch indicates that we are inside the vicinity of a planet...
this.tonearsun = 290000
this.tonearplanet = 50000
this.nearsun = 350000
this.averagesun = 450000
this.farfromsun = 520000
this.ispaceswitch = true
this.hacktime = 3
this.derelictcount = this.hacktime+1
this.derelictID = false
this.firstrun = true
this.mcounter = 0;
this.mmactive = false;
this.sustain = 3;
this.delay = 3;
this.leech = 0;
this.trapship = false;
this.trapcounter = 0;
this.planetlist = 0;
this.MainPlanetName = false;
this.nottoclose = false;
this.planetlistdone = false;
this.toclosetoplanet = false;
//Sound.load(&quot;FCscoop.ogg&quot;)		//lets not use this for now, it would stop any playing music
//Sound.load(&quot;FCtrumblesqueal.ogg&quot;)	// Testing if two sounds could play at the same time, thats a negative

}

this.$itsatrap = function() 
{
	if(this.trapship)
	{
		this.trapcounter ++
		//player.ship.consoleMessage(&quot;its going 2:&quot;+this.trapship.shipDisplayName+&quot;:&quot;+this.trapcounter,3)
		if(this.trapcounter &gt; 3)
		{
			this.itsatrapTimer.stop()
			//player.ship.consoleMessage(&quot;its going 3:&quot;+this.trapship.shipDisplayName+&quot;:DEAD&quot;,3)
			this.trapcounter = 0
			this.trapship.explode()
			this.trapship.spawn(&quot;FCFrameSelfDestruct&quot;,1)
			
			//this.trapship = false
			return
		}
		return // we only get here in case of this.trapcounter&lt;3
	}	
	else //ship died
	{
		this.itsatrapTimer.stop()
		this.trapcounter = 0
		this.trapship = false
		return
	}
	//we should never get here..
	log(&quot;Fuel Collector&quot;,&quot;Error its a trap, we should never get here&quot;)
}

this.$buildplanetlist = function()
{ //function very much in developing stages.. 	

	//if(this.planetlistdone) //make sure....
	//return 

	if(!system.sun)
	return;	//sanity check.. no distance measurements to sun, or else we get errors..
		//number planets by posistion in the array.. execpt main planet ofcourse
	
	if(system.planets.length == 1) //sanity check...
	{
		this.MainPlanetName = system.name //+&quot; 1&quot; //used +1 one for testing..
		return //return from here, there is no more planets in the system
	}
	
	//this.temp = new Array();
	this.planetlist = new Array();
	this.moonlist = new Array();	
	
	for(var i = 0;i&lt;system.planets.length;i++)
	{
		if(!system.planets[i].hasAtmosphere) //presume moon if no atmosphere
		{
			this.moonlist.push(system.planets[i])			
		}
		else
		{
			this.planetlist.push(system.planets[i])
		}
	}
	
	this.noofplanets = this.planetlist.length
	this.noofmoons = this.moonlist.length
	
	//log(&quot;Fuel Collector&quot;,&quot;planets n is &quot;+this.noofplanets)
	//log(&quot;Fuel Collector&quot;,&quot;moons n is &quot;+this.noofmoons)
	
	//we dont need a check for planets,its greater than 0
	
	//build a distancelist
	if(this.noofplanets&gt;1) //sanity check
	{
		for(var i = 0;i&lt;this.noofplanets;i++)
		{
			this.planetlist[i].name = system.name +&quot; &quot;+this.$romanize(i+1)
			this.planetlist[i].moons = 0;
		}
	}
	else
	{
		this.planetlist[0].name = system.name
		this.planetlist[0].moons = 0;
	}
		
	/* for(i = 0;i&lt;this.noofplanets;i++)
	{
		log(&quot;Fuel Collector&quot;,&quot;name:&quot;+this.planetlist[i].name)		
	}
	*/
	
	if(this.moonlist)
	{			
		for(i=0;i&lt;this.noofmoons;i++)
		{
			let motherplanet = 0
			let cr = this.moonlist[i].position.distanceTo(planetlist[0])
			
			for(var al=0;al&lt;this.noofplanets;al++)
			{				
				if(cr&gt;this.moonlist[i].position.distanceTo(planetlist[al]))
				{
					cr = this.moonlist[i].position.distanceTo(planetlist[al])
					this.planetlist[al].moons = 0;
					motherplanet = al
				}				
			}
			this.planetlist[motherplanet].moons ++;
			this.moonlist[i].name = this.planetlist[motherplanet].name +&quot;¥s moon &quot;+this.$romanize(this.planetlist[motherplanet].moons)
			this.moonlist[i].motherplanet = motherplanet
		}
		// next is a sanity check of wheter or not a planet has more than 1 moon.... if not, the name gets changed to not include the roman letter
		for(i=0;i&lt;this.noofmoons;i++)
		{
			if(this.planetlist[moonlist[i].motherplanet].moons == 1)
			{			
                this.moonlist[i].name = this.planetlist[this.moonlist[i].motherplanet].name +&quot;¥s moon&quot;				
			}
		}
	}	
}

this.$self_destruct_countdown = function()
{
	//self destruct is allready initiated, all we need to check is if the
	//the ship is still alive..
	if(this.trapship)
	{
		this.trapship.setAI(&quot;dumbAI.plist&quot;)
		//player.ship.consoleMessage(&quot;its going 1&quot;+this.trapship.shipDisplayName,3)
		this.itsatrapTimer = new Timer(this, this.$itsatrap,0,3)
	}
	//do nothing ship is dead..
}

this.$consolemessage = function()
{
	if(player.ship.docked)
	{ 
		this.consolemessageTimer.stop()
		return
	}
	
	this.mcounter ++
	if(this.mcounter &lt; this.delay)
	return
	this.consolemessageTimer.stop()
	this.mmactive = false
	this.mcounter = 0
	delete this.consolemessageTimer //remove so that we can set a new one with a new interval
}	

this.$delayedmessage = function(message,delay,sustain)
{	
	//this is a delayed message, it pops up on screen after n seconds = delay, and will stay there for n=sustain time
	if(this.mmactive)
	{
		//log(&quot;Fuel Collector&quot;, &quot;WARNING!!! this.$delayedmessage: Timer start before other is expired&quot;)
		this.additionalfuel =+ this.leech
		return
	}
	
	this.additional_fuel = 0;
	this.mmessage = message	
	this.sustain = sustain
	this.delay = delay
	this.mmactive = true
	
	//start our timer..
	
	this.consolemessageTimer = new Timer(this, this.$consolemessage,0,delay)
}

this.$checkifover01 = function(fuel_award)
{	
	this.fuel_below01 += fuel_award	
	if(this.fuel_below01 &gt; 1000)
	{
		
		player.ship.fuel += 0.1
		//Sound.playMusic(&quot;FCscoop.ogg&quot;)
		//Sound.playMusic(&quot;FCtrumblesqueal.ogg&quot;)			
		player.consoleMessage(&quot;Fuel Collector&quot;, 10)
		player.consoleMessage(&quot;Gathered fuel: 0.1 ly&quot;, 10)
			
		this.fuel_below01 -= 1000
	}
}

this.$extractfuel = function()
{
	if(player.ship.equipmentStatus(&quot;EQ_FRAME_FUEL_COLLECTOR&quot;) != &quot;EQUIPMENT_OK&quot; || player.ship.equipmentStatus(&quot;EQ_FUEL_SCOOPS&quot;) != &quot;EQUIPMENT_OK&quot;) //checkup of both dependacies
	{		
		this.extractfuelTimer.stop()
		
		player.consoleMessage(&quot;Fuel Collector&quot;,3)
		player.consoleMessage(&quot;Malfunction!!!&quot;,3)
				
		this.derelictID = false //set if we somehow mysteriously got it fixed
		return
	}
	
	if(player.ship.docked)
	{ 
		this.extractfuelTimer.stop() //should not happen, but for safety reasons, there could in theory be a dereclict ship right outside the docking bay
		return
	}
	if(!this.derelictID || this.derelictID != player.ship.target) //does ship exist, and is linked ship still the players target
	{
		player.consoleMessage(&quot;Fuel Collector&quot;,3)
		player.consoleMessage(&quot;Lost link&quot;,3)		
		this.extractfuelTimer.stop()
		//either way make sure that we dont enter a reoccuring loop
		this.derelictID = false
		return
	}
	else if(this.derelictID)
	{
		if(player.ship.position.distanceTo(this.derelictID) &gt; 300) //within range ?
		{
			this.extractfuelTimer.stop()
			
            player.consoleMessage(&quot;Fuel Collector&quot;,3)
            player.consoleMessage(&quot;Lost link to &quot;+this.derelictID.displayName,3)
			
			if(this.derelictID.fuel &gt; 0.09) //check if there is any fuel left in ships tanks
			this.derelictID = false	//if so set Id to false so we can connect to it again, next time we come in range
			return
		}
	}			
	
	if(this.derelictID.fuel &gt; 0.09)	//extract fuel of any in the tank
	{
		this.derelictID.fuel -= 0.1
		//Sound.playSound(&quot;FCscoop.ogg&quot;)		
		player.ship.fuel += 0.1
		if(player.ship.fuel == 7.0)	//are our tank full ?
		{
            player.consoleMessage(&quot;Fuel Collector&quot;,3)
            player.consoleMessage(&quot;Tank full&quot;,3)
			
			this.extractfuelTimer.stop()
			this.derelictID = false	//if so set Id to false so we can connect to it again, next time we come in range
			return
		}
		return // we check for empty tank next time
	}
	
	//if we made it here it means the victims fuel tank is empty
    player.consoleMessage(&quot;Fuel Collector&quot;,3)
    player.consoleMessage(this.derelictID.displayName+&quot;¥s Fuel tank is empty&quot;,3)		
	this.extractfuelTimer.stop()	
}

	
	

this.$DerelictCheck = function()
{
	if(player.ship.equipmentStatus(&quot;EQ_FRAME_FUEL_COLLECTOR&quot;) != &quot;EQUIPMENT_OK&quot; || player.ship.equipmentStatus(&quot;EQ_FUEL_SCOOPS&quot;) != &quot;EQUIPMENT_OK&quot;) //checkup of both dependacies
	{		
		this.DerelictCheckTimer.stop()
		if(!(this.derelictcount == this.hacktime+1))
		{
				player.consoleMessage(&quot;Fuel Collector&quot;,3)
				player.consoleMessage(&quot;Malfunction!!!&quot;,3)			
		}
		this.derelictcount == this.hacktime+1
			
		return
	}
	
	if(player.ship.docked)
	{
		this.DerelictCheckTimer.stop() //should not happen, but for safety reasons, there could theory be a dereclict ship right outside the docking bay
		this.derelictcount = this.hacktime+1
		return
	}
	
	let a_derelict_ship = player.ship.target
	
	if(!a_derelict_ship) //first check that there is a ship locked in players target computer
	{
		this.DerelictCheckTimer.stop()
		if(!(this.derelictcount == this.hacktime+1))
		{
			player.consoleMessage(&quot;Fuel Collector&quot;,3)
			player.consoleMessage(&quot;Malfunction!!!&quot;,3)
		}
		this.derelictcount == this.hacktime+1
		
		return	//no active target return and stop timer.. 
	}
	if(a_derelict_ship.AI != &quot;nullAI.plist&quot;) //is this ship unpiloted, if so it could be derelict
	{
		this.DerelictCheckTimer.stop()
		this.derelictcount = this.hacktime+1
		player.consoleMessage(&quot;Fuel Collector&quot;,3)
		player.consoleMessage(&quot;Lost link&quot;,3)	
		return // not unpiloted(something must have happend).. stop timer
	}
	if(player.ship.position.distanceTo(a_derelict_ship) &gt; 300) //are we still within the 300 meters limit
	{
		this.DerelictCheckTimer.stop()
		this.derelictcount = this.hacktime+1
		player.consoleMessage(&quot;Fuel collector: Weak Signal&quot;,3)
		player.consoleMessage(&quot;Lost link to &quot;+a_derelict_ship.displayName, 3)
		
		return //we left the minimum distance.. stop timer
	}
	//if(a_derelict_ship.isPirate || a_derelict_ship.isTrader || a_derelict_ship.hasRole(&quot;hunter&quot;) || a_derelict_ship.hasRole(&quot;shuttle&quot;) || a_derelict_ship.hasRole(&quot;miner&quot;) || a_derelict_ship.hasRole(&quot;escort&quot;))	//legit derelict ship Traders &amp; Pirates &amp; Hunters
	if(this.$CheckLegitDerelictRole(a_derelict_ship))
	{
		//do stuff here
		this.derelictcount --
		player.consoleMessage(&quot;Hacking: &quot;+a_derelict_ship.displayName+&quot; &quot;+this.derelictcount, 1)
		if(this.derelictcount &lt; 1)
		{
			let rab = Math.random()
			
			if(a_derelict_ship.fuel &lt; 0.1)
			{				
				player.consoleMessage(&quot;Fuel Collector: Ship has no fuel in tank&quot;,3)				
				this.derelictID = a_derelict_ship //mark as last ship connected to is empty
				
				if(a_derelict_ship.isPirate)//high odds for ship will self destruct..
				{
					if(rab&lt;0.5)
					{
						//player.ship.consoleMessage(&quot;gonna go boom boom boom:pirate&quot;,3)
						this.trapship = a_derelict_ship
						this.$self_destruct_countdown()
					}
					
					//run random boobytrap
					//we use a new timer that slowly but surely drains the ships energy bank //would be nice to alter recharge rate, but i guees that is not a possibility
				}
				else	//low odds for ship will have a bobbytrap
				{
					if(rab&lt;0.05)
					{
						//player.ship.consoleMessage(&quot;gonna go boom boom boom:trader&quot;,3)
						this.trapship = a_derelict_ship
						this.$self_destruct_countdown()
					}
				}								
				
				this.derelictcount = this.hacktime+1
				this.DerelictCheckTimer.stop()
				return
			}
			else
			{
				if(a_derelict_ship.isPirate &amp;&amp; rab &lt;0.5) //high odds
				{
					//player.ship.consoleMessage(&quot;gonna go boom boom boom:pirate&quot;,3)
					this.trapship = a_derelict_ship
					this.$self_destruct_countdown()
				}
				else if(rab&lt;0.05)
				{
					//player.ship.consoleMessage(&quot;gonna go boom boom boom:trader&quot;,3)
					this.trapship = a_derelict_ship
					this.$self_destruct_countdown()
				}	
								
				this.derelictcount = this.hacktime+1
				player.consoleMessage(&quot;Extracting fuel&quot;,3)
				this.derelictID = a_derelict_ship				
				this.extractfuelTimer = new Timer(this,this.$extractfuel,0,1) //tip dont use an arguement when you start a timer like this,this.mytimer(arguement) it will make a CTD			
				this.DerelictCheckTimer.stop()
				return // return because we dont need more checking from here..
			}			
		}
	}
	else	//no legit roles return and stop timer
	{	
		this.DerelictCheckTimer.stop()
		this.derelictcount = this.hacktime+1
		player.consoleMessage(&quot;Fuel Collector&quot;,3) //we might have changed targets..
		player.consoleMessage(&quot;Lost link &quot;, 3)
		return //no legit roles
	}	
}

this.$CruiseCheck = function()
{
	if(player.ship.docked)
	{
		this.CruiseCheckTimer.stop()
		return // return because we really dont need more checking from here
			//return also saves a few cycles, instead of having the CPU do 3 extra Compares it just jumps to an address in memory
	}
	
	//if(this.tonearplanet) //if it is zero, then return
	//return
	
	// we never got here if the fuel collector was not started in the first place which is why
        // we can use explicit OR	
	if(player.ship.equipmentStatus(&quot;EQ_FRAME_FUEL_COLLECTOR&quot;) != &quot;EQUIPMENT_OK&quot; || player.ship.equipmentStatus(&quot;EQ_FUEL_SCOOPS&quot;) != &quot;EQUIPMENT_OK&quot;) //is EQ damaged ?
	{
		this.CruiseCheckTimer.stop() // should we stop or keep it running, in order for it to be repaired..
		//i&#39;d say performance is of the essense here, therefore we kill it until next witchspace / station launch
		return // return because we really dont need more checking from here
	}
    	
	//player.ship.consoleMessage(&quot;entering cruisecheck&quot;, 3) // for testing
	
		
	//if(system.isInterstellarSpace) //some person in the future might add a sun in interstellar space
	if(!system.sun)
			//so if there is a sun present, it will activate the crusing mode collector	
	{
		if(this.ispaceswitch &amp;&amp; this.firstrun)
		{
			this.ispaceswitch = false
			this.firstrun = false
			player.consoleMessage(&quot;Fuel Collector&quot;,3)
			player.consoleMessage(&quot;Interstellar space: Fly at max speed to extract fuel&quot;,3)
		}
		
		//if there is not a sun there it will extract whatever it can from its surroundings..
		//however only as long as the player is at max speed.
		if(player.ship.speed == player.ship.maxSpeed)		
		this.$checkifover01(this.fuel_level_1*Math.random())
		return  
	}
	else 
	{		
		//what distance are we at to the star
		// to close and it will shutdown, to far away it will collect very little
		
		/* a notice on why it shuts down, when to close
		
		due to the fine filter of the fuel collector, it will shut down when it
		gets to close to the star so that the filter is having a chance of getting
		cleaned by the subsequent cleaning, which in effect harvest the fuel from
		the filter
		
		The fuel scoop will then take over shortly after..
		*/
		
		
		let sun_distance = player.ship.position.distanceTo(system.sun)+system.sun.radius	
		/* This is the old shut off if to close to sun..
		// this however didnt take into consideration, the proximity to the planet
		*/
		
		if((player.ship.speed &gt; player.ship.maxSpeed) || ( 7 == player.ship.fuel)) //|| means explicit or // injector or warp speed
		{
            return // return because we really dont need more checking from here
		}
		
		let distancemodifier =10
				
		if(sun_distance&lt; this.averagesun)
		distancemodifier = 30
		if(sun_distance&lt; this.nearsun)
		distancemodifier = 50 //this is near the filters saturation limit,..
				
		let speedp = 100/player.ship.maxSpeed*player.ship.speed
		
		if(speedp&gt;89)
		{
			this.$checkifover01(this.fuel_level_4+distancemodifier)			
			//player.consoleMessage(&quot;speed over 89 %&quot;, 3) // for testing
			return			
		}
		
		if(speedp&gt;49)
		{
			this.$checkifover01(this.fuel_level_3+distancemodifier)
			//player.consoleMessage(&quot;speed over 49 %&quot;,3) // for testing
			return			
		}
		
		if(speedp&gt;19)
		{
			this.$checkifover01(this.fuel_level_2+distancemodifier)
			//player.consoleMessage(&quot;speed over 19 %&quot;,3) // for testing
			return			
		}		
	}
}

this.$killCheck = function()
{
	//while this is no more the function that awards fuel after a kill, it still does valueble checkups
	if(player.ship.docked)
	{
		this.KillCheckTimer.stop()
		return
	}
	else
	{
		if(player.ship.fuel &lt; 7 &amp;&amp; player.ship.speed &lt;= player.ship.maxSpeed) //if players tank is full, no need to check, dont work at injector or warp speed
		{
			let pl_target = player.ship.target
			//derelict ship section.   			
			if(pl_target &amp;&amp; (this.derelictcount == this.hacktime+1)) //11 means our timer has not yet started, lets save some cpu cycles
			{
				let target_ship_AI = pl_target.AI
				if(target_ship_AI == &quot;nullAI.plist&quot; &amp;&amp; this.derelictID != pl_target)	//derelict ships have nullAI.plist, ID means this is the last ship that has been linked too we either emptied its tanks, or it was empty
				{
					//player.ship.consoleMessage(&quot;got NULLAI:&quot;+pl_target.primaryRole, 3)
					this.derelictID = false
					if(player.ship.position.distanceTo(pl_target) &lt; 301)
					{
						//log(&quot;Fuel Collector&quot;, &quot;distance below 301&quot;)
						//log(&quot;this.DerelictCheckTimer is&quot;+this.DerelictCheckTimer)
						let isRunning = false
						if(this.DerelictCheckTimer)
						{
							if(this.DerelictCheckTimer.isRunning)
							isRunning = true
						}
						//if(pl_target.isPirate || pl_target.isTrader || pl_target.hasRole(&quot;hunter&quot;) &amp;&amp; !this.DerelictCheckTimer)
						if(this.$CheckLegitDerelictRole(pl_target) &amp;&amp; !isRunning)	//legit derelict ship Traders &amp; Pirates &amp; Hunters
						{
							//log(&quot;Fuel Collector&quot;, &quot;got role&quot;)
							if(this.DerelictCheckTimer)
								this.DerelictCheckTimer.start()
							else
								this.DerelictCheckTimer = new Timer(this,this.$DerelictCheck,0,1) //tip dont use an arguement when you start a timer like this,this.mytimer(arguement) it will make a CTD
							player.consoleMessage(&quot;Fuel Collector&quot;, 3)
								player.consoleMessage(&quot;Established link to &quot;+pl_target.displayName, 3)
						}
					}
				}
			}
		}
	}
	//check if Equipment has been damaged during battle..
	// we never got here if the fuel collector was not started in the first place which is why
	// we can use explicit OR
	if(player.ship.equipmentStatus(&quot;EQ_FRAME_FUEL_COLLECTOR&quot;) != &quot;EQUIPMENT_OK&quot; || player.ship.equipmentStatus(&quot;EQ_FUEL_SCOOPS&quot;) != &quot;EQUIPMENT_OK&quot;) //checkup of both dependacies
		this.KillCheckTimer.stop()
}

this.$CheckLegitDerelictRole = function(the_object)
{
	for(var i=0;i&lt;this.legitDerelictRoles.length;i++)
	{
		if(the_object.primaryRole == this.legitDerelictRoles[i])
		return true
	}
	
	return false
}

this.shipLaunchedFromStation = function() //script starts here after startup borrowed from bouy repair great work Erich ;)
{
	//this.myswitch = true	//just in case there is a station inside the tonear zone
	//this.myswitch1 = false
	if(!this.planetlistdone)
	this.$buildplanetlist()
	this.planetlistdone = true
	
	this.ispaceswitch = true
	// &amp;&amp; is correct, we need both dependancies for the Fuel Collector to start...	
		if(player.ship.equipmentStatus(&quot;EQ_FRAME_FUEL_COLLECTOR&quot;) == &quot;EQUIPMENT_OK&quot; &amp;&amp; player.ship.equipmentStatus(&quot;EQ_FUEL_SCOOPS&quot;) == &quot;EQUIPMENT_OK&quot;) //checkup of both dependacies
	{
		if(this.KillCheckTimer)
		this.KillCheckTimer.start()
		else
		this.KillCheckTimer = new Timer(this, this.$killCheck,0,3)
		
		if(this.CruiseCheckTimer)
		this.CruiseCheckTimer.start()
		else
		this.CruiseCheckTimer = new Timer(this,this.$CruiseCheck,0,this.checkawardhowoften)
	}
}

this.shipExitedWitchspace = function() //script starts here once player jumps to a new system
{
	// reset our switches player can have witched out, well within the tonear zone
	this.$buildplanetlist();
	this.ispaceswitch = true
	
	// &amp;&amp; is correct, we need both dependancies for the Fuel Collector to start...
	if(player.ship.equipmentStatus(&quot;EQ_FRAME_FUEL_COLLECTOR&quot;) == &quot;EQUIPMENT_OK&quot; &amp;&amp; player.ship.equipmentStatus(&quot;EQ_FUEL_SCOOPS&quot;) == &quot;EQUIPMENT_OK&quot;) //checkup of both dependaciesif(player.ship.hasEquipment(&quot;EQ_FRAME_FUEL_COLLECTOR&quot;))
	{
		if(this.KillCheckTimer)
		this.KillCheckTimer.start()
		else
		this.KillCheckTimer = new Timer(this, this.$killCheck,0,3)
		  
		if(this.CruiseCheckTimer)
		this.CruiseCheckTimer.start()
		else
		this.CruiseCheckTimer = new Timer(this,this.$CruiseCheck,0,this.checkawardhowoften)
	}
}

this.shipDied = function()
{
	//player.ship.consoleMessage(&quot;player died&quot;,10)
	if(this.KillCheckTimer)
	this.KillCheckTimer.stop()
	if(this.CruiseCheckTimer)
	this.CruiseCheckTimer.stop()
	if(this.consolemessageTimer)
	this.consolemessageTimer.stop()
	if(this.extractfuelTimer)
	this.extractfuelTimer.stop()
	if(this.itsatrapTimer)
	this.itsatrapTimer.stop()
}

this.shipTargetDestroyed = function(target)
{
	//should work as it will return if neither is present...
	if(player.ship.equipmentStatus(&quot;EQ_FRAME_FUEL_COLLECTOR&quot;) != &quot;EQUIPMENT_OK&quot; || player.ship.equipmentStatus(&quot;EQ_FUEL_SCOOPS&quot;) != &quot;EQUIPMENT_OK&quot;)
	return
	
	if((target.fuel &gt; 0.09) &amp;&amp; (player.ship.position.distanceTo(target) &lt; 2000) &amp;&amp; !(player.ship.speed &gt; player.ship.maxSpeed) &amp;&amp; !target.isThargoid)
	{
		let leech = target.fuel
		let leech2 = target.fuel/0.1
		//let ra = Math.random()	//percentage
		//leech = target.fuel*ra // random percetange to start with
		let ra=Math.random()
		if(ra&gt;0.3)
		leech=leech2*0.1*0.015 //roughtly 0.1 lyof 7 ly
		if(ra&lt;=0.3)
		leech=leech2*0.2*0.030 //award only 5%
		if(ra&lt;0.1)
		leech=leech2*0.5*0.060 //award 10%
    					
		//roundoff
		leech = Math.round(leech/0.1)*0.1		    					 					   					
		
		if(leech &gt;0) //only award if victim actually had any fuel left..
		{
			let ourmessage = &quot;Fuel: &quot;+leech+&quot; LY&quot;
			player.ship.fuel += leech
			
			//Sound.playMusic(&quot;FCscoop.ogg&quot;)
			//Sound.playMusic(&quot;FCtrumblesqueal.ogg&quot;)
			this.$delayedmessage(ourmessage,3,3) //lets avoid all the message garble when getting a kill
		}
	}
}

this.shipExitedPlanetaryVicinity = function()
{
	//log(&quot;Fuel Collector 0.4&quot;,&quot;Script Message: we exited vicinity&quot;) // used to trace a bug in 1.72.1
	this.tonearplanet --
	if(this.tonearplanet &lt; 0)
	{
		log(&quot;Fuel Collector 0.4&quot;,&quot;Script messages that this.tonearplanet went negative:&quot;+this.tonearplanet)
	}
	
	/* this.tonearplanet counts how many times we entered a planetary/moon/sun vicinity
	and substracts from that how many times we left a planetary vicinity
	if this.tonearplanet is 0 or false, it means we are in no planetary vicinities
	
	we are not spoiled here with the information of which planets vicinity we just left.
	we just are told, that we left one.. 
	*/
	if(player.ship.equipmentStatus(&quot;EQ_FRAME_FUEL_COLLECTOR&quot;) != &quot;EQUIPMENT_OK&quot; || player.ship.equipmentStatus(&quot;EQ_FUEL_SCOOPS&quot;) != &quot;EQUIPMENT_OK&quot;)
	return		
	
	if(this.tonearplanet)	
	player.consoleMessage(&quot;Fuel Collector activated&quot;,3)
	
}

this.shipEnteredPlanetaryVicinity = function(planet)
{
	//log(&quot;Fuel Collector 0.4&quot;,&quot;Script Message: we entered planet vicinity :&quot;+planet)
	
	if(this.tonearplanet) //if the device is allready deactivated..
	{
		this.tonearplanet ++
		return
	}
	
	this.tonearplanet ++
	if(this.tonearplanet&gt;system.planets.length)
	{
		log(&quot;Fuel Collector 0.4&quot;,&quot;Script messages that this.tonearplanet went above the number of globes&quot;+this.tonearplanet)
	}
	
	
	if(player.ship.equipmentStatus(&quot;EQ_FRAME_FUEL_COLLECTOR&quot;) != &quot;EQUIPMENT_OK&quot;)
	{
		return
	}
	
	if(player.ship.equipmentStatus(&quot;EQ_FUEL_SCOOPS&quot;) != &quot;EQUIPMENT_OK&quot;)
	{
		return
	}
	
	
	if(planet.isSun) //sun checking
	{
		player.consoleMessage(&quot;Fuel Collector deactivated&quot;,3)
		player.consoleMessage(&quot;Too close to &quot;+system.name+&quot;¥s sun&quot;,3)		
		return
	}	
	
	if(system.planets.length == 1) // single planet system checking..
	{
		player.consoleMessage(&quot;Fuel Collector deactivated&quot;,3)
		player.consoleMessage(&quot;Too close to &quot;+system.name,3)		
		return
	}	
	
	this.toclosetoname = false;
	
	// is this a planet
	
	for(var i = 0;i&lt;this.planetlist.length;i++)
	{
		if(planet == this.planetlist[i])
		{
			this.toclosetoname = this.planetlist[i].name
		}
	}
	
	if(!this.toclosetoname) //if there where no match for a planet it means this is a moon
	{
		for(i = 0;i&lt;this.moonlist.length;i++)
		{
			if(planet == this.moonlist[i])
			this.toclosetoname = this.moonlist[i].name
		}	
		
	}
	
	player.consoleMessage(&quot;Fuel Collector deactivated&quot;,3)
	player.consoleMessage(&quot;Too close to &quot;+this.toclosetoname,3)	
}

this.$romanize = function(num)
{ // credits due where credits are earned: picked this up from 
  // http://blog.stevenlevithan.com/archives/javascript-roman-numeral-converter
	if (!+num)
		return num;
	var	digits = String(+num).split(&quot;&quot;),
		key = [&quot;&quot;,&quot;C&quot;,&quot;CC&quot;,&quot;CCC&quot;,&quot;CD&quot;,&quot;D&quot;,&quot;DC&quot;,&quot;DCC&quot;,&quot;DCCC&quot;,&quot;CM&quot;,
		       &quot;&quot;,&quot;X&quot;,&quot;XX&quot;,&quot;XXX&quot;,&quot;XL&quot;,&quot;L&quot;,&quot;LX&quot;,&quot;LXX&quot;,&quot;LXXX&quot;,&quot;XC&quot;,
		       &quot;&quot;,&quot;I&quot;,&quot;II&quot;,&quot;III&quot;,&quot;IV&quot;,&quot;V&quot;,&quot;VI&quot;,&quot;VII&quot;,&quot;VIII&quot;,&quot;IX&quot;],
		roman = &quot;&quot;,
		i = 3;
	while (i--)
		roman = (key[+digits.pop() + (i * 10)] || &quot;&quot;) + roman;
	return Array(+digits.join(&quot;&quot;) + 1).join(&quot;M&quot;) + roman;
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
