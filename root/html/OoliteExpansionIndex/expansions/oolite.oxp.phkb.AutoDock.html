<html>
    <head>
        <title>Expansion AutoDock</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion AutoDock</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Gives players without a docking computer the ability to engage an autopilot docking sequence for a small charge.</td>
                    <td>Gives players without a docking computer the ability to engage an autopilot docking sequence for a small charge.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.phkb.AutoDock</td>
                    <td>oolite.oxp.phkb.AutoDock</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>AutoDock</td>
                    <td>AutoDock</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>phkb</td>
                    <td>phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.1.0</td>
                    <td>1.1.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/7/79/AutoDock.oxz">https://wiki.alioth.net/img_auth.php/7/79/AutoDock.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 4.0</td>
                    <td>CC BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873342</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/AutoDock'>http://wiki.alioth.net/index.php/AutoDock</a></p>
        <h3>readme.txt</h3>
        <pre>AutoDock Facility
By Nick Rogers

Overview
========
This OXP gives players who don&#39;t have a docking computer the ability to dock at Main Stations using remote guidance technology driven from the station itself, for a small charge. This is similar to facilities available in some versions of Elite (ArcElite and Elite Plus being notable examples).

No special equipment needs to be purchased. When the player approaches the main station they can press &quot;C&quot; to begin the automatic docking process, and 10 Cr will be deducted from their account. If the player disengages the autopilot they will be refunded half this cost. If fast docking is available at a station, the player can also press &quot;Shift-C&quot; to fast dock. If, in the future, the player purchases a docking computer, no further auto-docking charges will take place, unless their docking computers are damaged.

This OXP is based on work by CommonSenseOTB who released a version similar to this for Oolite 1.76/77, but new features in 1.82 allow for a much simpler implementation.

Licence
=======
This work is licensed under the Creative Commons Attribution-ShareAlike 4.0 International Public License. To view a copy of this license, visit http://http://creativecommons.org/licenses/by-sa/4.0/ or send a letter to Creative Commons, 171 Second Street, Suite 300, San Francisco, California, 94105, USA.

Version History
===============
Version 1.1.0
- Added configuration items to Library (if installed).

Version 1.0.1
- Fixed small Javascript bug.

Version 1.0.0
- Initial release
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_NDC_AUTODOCK.html">The No-Dock-Computer Autodock facility</a></td>
                    <td>no</td>
                    <td align="right">50</td>
                    <td align="center">1+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/autodock_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;Autodock_Conditions&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2015 phkb&quot;;
this.description = &quot;Condition script for the Autodock computer&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;

//-------------------------------------------------------------------------------------------------------------
this.allowAwardEquipment = function(equipment, ship, context) {
	if (context != &quot;scripted&quot;) return false;
	return true
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/autodock_core.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;Autodock_Core&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2015 phkb&quot;;
this.description = &quot;Main routine for handling autodock option&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;

this._payment = 10;				// the cost of an autodock. (should be an even number so the refund price doesn&#39;t have decimals)
this._minTechLevel = 0;			// the minimum techlevel required for an autodock (this matches main logic of being 1 less that the actual TL. ie entering 6 here means TL7)
this._mainStationOnly = true;	// flag that indicates whether autodock is provided at the main station only (true), or all stations (false)
this._abort = false;			// used if the player has the autodock, but credit went below payment amount during flight, then tries to autodock
								// docking will be cancelled, and this flag prevents the player from being refunded as no payment would have been made.


// configuration settings for use in Lib_Config
this._adConfig = {Name:this.name, Display:&quot;Settings&quot;, Alias:&quot;Autodock&quot;, Alive:&quot;_adConfig&quot;, 
	Bool:{B0:{Name:&quot;_mainStationOnly&quot;, Def:true, Desc:&quot;Autodock at main stns&quot;},Info:&quot;Autodock only available at main stations.&quot;},
	SInt:{
		S0:{Name:&quot;_payment&quot;, Def:10, Desc:&quot;Payment Amount&quot;, Min:1, Max:100},
		S1:{Name:&quot;_minTechLevel&quot;, Def:0, Desc:&quot;Minimum tech level&quot;, Min:0, Max:14},
		Info:&quot;0 - Cost of autodock, in credits\n1 - Minimum tech level for autodock&quot;}
};
this._trueValues = [&quot;yes&quot;, &quot;1&quot;, 1, &quot;true&quot;, true];

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function() {
	// register our settings, if Lib_Config is present
	if (worldScripts.Lib_Config) worldScripts.Lib_Config._registerSet(this._adConfig);
	if (missionVariables.Autodock_Payment) this._payment = parseInt(missionVariables.Autodock_Payment);
	if (missionVariables.Autodock_TechLevel) this._minTechLevel = parseInt(missionVariables.Autodock_TechLevel);
	if (missionVariables.Autodock_MainStation) this._mainStationOnly = (this._trueValues.indexOf(missionVariables.Autodock_MainStation) &gt;= 0 ? true : false);
}

//-------------------------------------------------------------------------------------------------------------
this.playerWillSaveGame = function() {
	missionVariables.Autodock_Payment = this._payment;
	missionVariables.Autodock_TechLevel = this._minTechLevel;
	missionVariables.Autodock_MainStation = this._mainStationOnly;
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillDockWithStation = function(station) {
	// make sure the equipment is removed on docking
	var p = player.ship;
	// check for an fast-dock
	var diff = (global.clock.adjustedSeconds - global.clock.seconds);
	if (diff &gt; 1000 &amp;&amp; diff &lt;= 1200) {
		if (p.equipmentStatus(&quot;EQ_NDC_AUTODOCK&quot;) == &quot;EQUIPMENT_OK&quot;) {
			this.$notifyAndDeduct();
		}
	}
	p.removeEquipment(&quot;EQ_NDC_AUTODOCK&quot;);
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillLaunchFromStation = function(station) {
	// auto install after launching (to cope with scenario where player docks at another station, or the same one even)
	if ((station.isMainStation &amp;&amp; this._mainStationOnly == true) || this._mainStationOnly == false) {
		this.$installAutoDock();
	}
}

//-------------------------------------------------------------------------------------------------------------
this.shipEnteredStationAegis = function(station) {
	var p = player.ship;
	if (this._mainStationOnly == true) this.$installAutoDock();
	// if we have less that payment amount when we hit the aegis, remove the autodock item so the player can&#39;t fast-dock
	if (player.credits &lt; this._payment &amp;&amp; p.equipmentStatus(&quot;EQ_NDC_AUTODOCK&quot;) == &quot;EQUIPMENT_OK&quot;) {
		p.removeEquipment(&quot;EQ_NDC_AUTODOCK&quot;);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.shipExitedStationAegis = function(station) {
	if (this._mainStationOnly == true) {
		var p = player.ship;
		p.removeEquipment(&quot;EQ_NDC_AUTODOCK&quot;);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.shipExitedWitchspace = function() {
	var p = player.ship;
	// remove the equipment, then attempt to reinstall it
	// this allows for the new system not having a high enough tech level
	p.removeEquipment(&quot;EQ_NDC_AUTODOCK&quot;);
	// only instal the autodock at this point if the mainstationonly flag is set to false (meaning all stations)
	if (this._mainStationOnly == false) this.$installAutoDock();
}

//-------------------------------------------------------------------------------------------------------------
this.playerStartedAutoPilot = function() {
	var p = player.ship;
	if (p.equipmentStatus(&quot;EQ_NDC_AUTODOCK&quot;) === &quot;EQUIPMENT_OK&quot;){
		if (player.credits &gt;= this._payment) {
			this.$notifyAndDeduct();
		} else {
			// in the off chance the player has dropped below payment amount between installing the autodock and arriving in a new system
			// (eg bribing ships via the Broadcast comms MFD)
			this._abort = true;
			p.disengageAutopilot();
			player.consoleMessage(&quot;Insufficient credit available for autodock. Manual docking required.&quot;);
			p.removeEquipment(&quot;EQ_NDC_AUTODOCK&quot;);

		}
	}
}

//-------------------------------------------------------------------------------------------------------------
this.playerCancelledAutoPilot = function() {
	var p = player.ship;
	if (p.equipmentStatus(&quot;EQ_NDC_AUTODOCK&quot;) == &quot;EQUIPMENT_OK&quot; &amp;&amp; this._abort == false) {
		// notify player
		player.consoleMessage(&quot;Control returned to pilot...depositing partial refund of &quot; + formatCredits(this._payment / 2, false, true) + &quot; to your account.&quot;, 5);
		// refund player
		player.credits += (this._payment / 2);
		// make sure the player still has enough cash for an autodock, and remove it if they don&#39;t
		if (player.credits &lt; this._payment) p.removeEquipment(&quot;EQ_NDC_AUTODOCK&quot;);
	}
	this._abort = false;
}

//-------------------------------------------------------------------------------------------------------------
this.equipmentDamaged = function(equipment) {
	// if the dock computer gets damaged, add the autodock equipment
	if (equipment == &quot;EQ_DOCK_COMP&quot;) {
		// if we&#39;re only doing this at main stations, check if we&#39;re within the aegis when the docking computer was damaged
		if (this._mainStationOnly == true &amp;&amp; player.ship.withinStationAegis == false) {
			// if not, return at this point, as the autodocker will be installed when we hit the aegis
			return;
		}
		this.$installAutoDock();
	}
}

//-------------------------------------------------------------------------------------------------------------
this.equipmentRepaired = function(equipment){
	// check for equipment being repaired in flight
	if (equipment == &quot;EQ_DOCK_COMP&quot;) {
		var p = player.ship;
		// if the dock computer gets repaired in flight, remove the autodock
		if (p.status == &quot;STATUS_IN_FLIGHT&quot;) p.removeEquipment(&quot;EQ_NDC_AUTODOCK&quot;);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$installAutoDock = function() {
	var p = player.ship;
	// give the player the autodock equipment if the tech level is greater than/equal to min tech level and the player doesn&#39;t have a working dock comp and has more than required credit
	if (system.info.techlevel &gt;= this._minTechLevel &amp;&amp; player.credits &gt;= this._payment) {
		if (p.equipmentStatus(&quot;EQ_DOCK_COMP&quot;) != &quot;EQUIPMENT_OK&quot;) {
			p.awardEquipment(&quot;EQ_NDC_AUTODOCK&quot;);
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$notifyAndDeduct = function() {
	player.consoleMessage(&quot;Transferring flight control to station for docking procedure...deducting &quot; + formatCredits(this._payment, false, true) + &quot; from your account.&quot;, 5);
	player.credits -= this._payment;
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
