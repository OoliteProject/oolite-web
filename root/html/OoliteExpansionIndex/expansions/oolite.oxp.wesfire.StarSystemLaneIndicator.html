<html>
    <head>
        <title>Expansion Star System Lane Indicator</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Star System Lane Indicator</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>An upgrade to the compass, indicating lane position of spaceship in the current star system and/or a beacon to the nearest point of a lane.</td>
                    <td>An upgrade to the compass, indicating lane position of spaceship in the current star system and/or a beacon to the nearest point of a lane.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.wesfire.StarSystemLaneIndicator</td>
                    <td>oolite.oxp.wesfire.StarSystemLaneIndicator</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Star System Lane Indicator</td>
                    <td>Star System Lane Indicator</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>wesfire</td>
                    <td>wesfire</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.8</td>
                    <td>0.8</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/4/42/StarSystemLaneIndicator.oxz">https://wiki.alioth.net/img_auth.php/4/42/StarSystemLaneIndicator.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 4</td>
                    <td>CC BY-NC-SA 4</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873283</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Star%20System%20Lane%20Indicator'>http://wiki.alioth.net/index.php/Star%20System%20Lane%20Indicator</a></p>
        <h3>StarSystemLaneIndicator_readme.txt</h3>
        <pre>




Instructions:

Do not unzip the .oxz file, just move into the AddOns folder of your Oolite installation.

License:

This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike License version 4.0.



Changelog:
 2020.12.    v0.8  Use MFD for display info. Simplified the oxz (removed NPC, old way of display info...).
 2019.01.27  v0.5  First release.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SSLI_MFD.html">Star System Lane Indicator MFD</a></td>
                    <td>yes</td>
                    <td align="right">7000</td>
                    <td align="center">8+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/SSLaneIndicator.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name	= &quot;SSLaneIndicator&quot;;
this.author	= &quot;wesfire&quot;;
this.copyright	= &quot;2020 wesfire&quot;;
this.description= &quot;Main script to:-calculate and display curent lane position.-set compass lane nearest spot.&quot;;
this.version	= &quot;0.8&quot;;
this.licence	= &quot;CC BY-NC-SA 4.0&quot;;


//internal properties, should not touch

this.$SSLI_t = [1];//null;//new Array(1); //Smart traders ship list
this.$SSLI_bb =null;//VisualEFFECT FOR COMPASS
this.$SSLI_SmartTraderExists =false;//Spawned smart trader exists
this.$SSLI_spawnCounter;//Spawn Counter(Only 1 &#39;Smart&#39; trader and aproximatly every 10 min)
this.$SSLI_MODE_N=0;//MODE id
this.$SSLI_MFDSETOK=false;//For MFD exist and quick setup with N prime button

//worldscript events

this.startUp = function() {
    this.$SSLI_MODE_N=0;
    this.$SSLI_spawnCounter=0.0;
    this.$SSLI_MFDSETOK=false;  
    player.ship.setMultiFunctionText(&quot;SSLaneIndicator&quot; , &quot;StarSystemLaneIndicator&quot;,false);

}
//Equipment mode...b key
this.mode = function ()
{
    if(player.ship.equipmentStatus(&quot;EQ_ADVANCED_COMPASS&quot;) != &quot;EQUIPMENT_OK&quot; ||
            player.ship.equipmentStatus(&quot;EQ_SSLI_MFD&quot;) != &quot;EQUIPMENT_OK&quot; ){
        player.consoleMessage(&quot;..ERROR..&quot;,4);
        this.$SSLI_MFDSETOK=false;
        return -1;
    }
    
    this.$SSLI_MODE_N=this.$SSLI_MODE_N+1;
    if(this.$SSLI_MODE_N%5==0){
        player.consoleMessage(&quot;SSLI, MODE: Only MFD GUI&quot;,4);
        player.ship.setMultiFunctionText(&quot;SSLaneIndicator&quot; , &quot;StarSystemLaneIndicator\n\nPress &#39;N&#39; to acivate MFD GUI. &quot;,false);
    }
    else if(this.$SSLI_MODE_N%5==1){
        player.consoleMessage(&quot;SSLI, MODE: Lane-1 WP.  &quot;,4);
        player.ship.setMultiFunctionText(&quot;SSLaneIndicator&quot; , &quot;StarSystemLaneIndicator\n\nPress &#39;N&#39; to acivate MFD GUI and \nset compass to nearest point of\nLane-1\n(WhichPointBeacon-MainPlanet)\nlane axis.&quot;,false);
    }
    else if(this.$SSLI_MODE_N%5==2){
        player.consoleMessage(&quot;SSLI, MODE: Lane-2 SW.  &quot;,4);
        player.ship.setMultiFunctionText(&quot;SSLaneIndicator&quot; , &quot;StarSystemLaneIndicator\n\nPress &#39;N&#39; to acivate MFD GUI and \nset compass to nearest point of\nLane-2\n(Star-WhichPointBeacon)\nlane axis.&quot;,false);
    }
    else if(this.$SSLI_MODE_N%5==3){
        player.consoleMessage(&quot;SSLI, MODE: Lane-3 SP.  &quot;,4);
        player.ship.setMultiFunctionText(&quot;SSLaneIndicator&quot; , &quot;StarSystemLaneIndicator\n\nPress &#39;N&#39; to acivate MFD GUI and \nset compass to nearest point of\nLane-3\n(Star-MainPlanet)\nlane axis.&quot;,false);
    }
    else if(this.$SSLI_MODE_N%5==4){
        player.consoleMessage(&quot;SSLI, MODE: Lane-A (N). &quot;,4);
        player.ship.setMultiFunctionText(&quot;SSLaneIndicator&quot; , &quot;StarSystemLaneIndicator\n\nPress &#39;N&#39; to acivate MFD GUI and \nset compass to nearest point of\nLane-A\n(MainStation &amp; Parallel to Lane-1)\nlane axis.&quot;,false);
    }
}

//Equipment primed and activated....
this.activated = function ()
{

    if(player.ship.equipmentStatus(&quot;EQ_ADVANCED_COMPASS&quot;) != &quot;EQUIPMENT_OK&quot; ||
            player.ship.equipmentStatus(&quot;EQ_SSLI_MFD&quot;) != &quot;EQUIPMENT_OK&quot; ){
        player.consoleMessage(&quot;..ERROR..&quot;,4);
        this.$SSLI_MFDSETOK=false;
        return -1;
    }else if(this.$SSLI_MFDSETOK==false){
      
        //this.$SSLI_MFDSETOK=player.ship.setMultiFunctionDisplay(player.ship.multiFunctionDisplays, &quot;SSLaneIndicator&quot;);

    }
    //Init MFD vars to display
    this.$p1=this.$p2=this.$p3=&quot;\xa0|\xa0&quot;;
    this.$p4=this.$p5=this.$p6=&quot;\xa0/\xa0&quot;;
    this.$p7=this.$p8=this.$p9=&quot;\xa0-\xa0&quot;;
    this.$p10=&quot;\xa0-\xa0&quot;;

    player.ship.setMultiFunctionText(&quot;SSLaneIndicator&quot; , &quot;StarSystemLaneIndicator&quot;,false);
    var $SSLaneIndicator_ppos = player.ship.position;
    var $SSLaneIndicator_mppos = system.mainPlanet.position;
    var $SSLaneIndicator_wpos = new Vector3D([0,0,0]);
    var $SSLaneIndicator_spos = system.sun.position;
    //Calculate lanes edges not from planet-Star centers but from 1.2*radius of planet or Star
    var $SSLaneIndicator_mppos1 = Vector3D.interpolate($SSLaneIndicator_wpos,$SSLaneIndicator_mppos,($SSLaneIndicator_wpos.distanceTo($SSLaneIndicator_mppos)-(system.mainPlanet.radius*1.2))/($SSLaneIndicator_wpos.distanceTo($SSLaneIndicator_mppos)));
    var $SSLaneIndicator_mppos2 = Vector3D.interpolate($SSLaneIndicator_mppos,$SSLaneIndicator_spos,((system.mainPlanet.radius*1.2))/($SSLaneIndicator_mppos.distanceTo($SSLaneIndicator_spos)));
    var $SSLaneIndicator_spos2 = Vector3D.interpolate($SSLaneIndicator_spos,$SSLaneIndicator_mppos2,((system.sun.radius*1.2))/($SSLaneIndicator_spos.distanceTo($SSLaneIndicator_mppos2)));
    var $SSLaneIndicator_spos3 = Vector3D.interpolate($SSLaneIndicator_wpos,$SSLaneIndicator_spos,($SSLaneIndicator_wpos.distanceTo($SSLaneIndicator_spos)-(system.sun.radius*1.2))/($SSLaneIndicator_wpos.distanceTo($SSLaneIndicator_spos)));
//BEACON compass FUNCTIONALITY

    if (this.$SSLI_MODE_N % 5 == 0){//GUI ON COMPASS
        player.consoleMessage(&quot;MFD output only ...&quot;,4);
        if (this.$SSLI_bb==null)
        {
            //  log(this.name, &quot;null&quot;);
        }
        else if(this.$SSLI_bb.isVisualEffect){
            this.$SSLI_bb.remove();
        }

    }

    else if (this.$SSLI_MODE_N % 5 == 1){//Lane-1
        player.consoleMessage(&quot;SSLI Spot 1 set ...&quot;,4);
        if (this.$SSLI_bb==null)
        {
            //  log(this.name, &quot;null&quot;);
        }
        else if(this.$SSLI_bb.isVisualEffect){
            this.$SSLI_bb.remove();
        }
        //PROJECTION player position to lane
        var $SSLaneIndicator_CWP_spot = this.$SSLI_closestPointOnLine ($SSLaneIndicator_wpos,$SSLaneIndicator_mppos1,$SSLaneIndicator_ppos);
        // If direction same(NOT IN BETWEEN)...
        if($SSLaneIndicator_CWP_spot.subtract($SSLaneIndicator_wpos).dot($SSLaneIndicator_CWP_spot.subtract($SSLaneIndicator_mppos1)) &gt; 0)
        {
             //...PICK nearest edge of lane
             if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_wpos)&gt;$SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_mppos1))
             {
                 //$SSLaneIndicator_CWP_spot = $SSLaneIndicator_mppos1;
             }
             else
             {
                 //$SSLaneIndicator_CWP_spot = $SSLaneIndicator_wpos;
             }
        }
        this.$SSLI_bb = system.addVisualEffect(&quot;SSLI_EMPTYVE_beacon&quot;,$SSLaneIndicator_CWP_spot);
        this.$SSLI_bb.beaconLabel = &quot;Lane-1&quot;;
        player.ship.compassTarget = this.$SSLI_bb;//SWITCH COMPASS
    }

    else if (this.$SSLI_MODE_N % 5 == 3){//Lane-3 Star-PLANET
        player.consoleMessage(&quot;SSLI Spot 3 set ...&quot;,4);
        if (this.$SSLI_bb==null)
        {
            //log(this.name, &quot;null&quot;);
        }
        else if(this.$SSLI_bb.isVisualEffect){
            this.$SSLI_bb.remove();
        }
        //PROJECTION player position to lane
        var $SSLaneIndicator_CSP_spot = this.$SSLI_closestPointOnLine ($SSLaneIndicator_spos2,$SSLaneIndicator_mppos2,$SSLaneIndicator_ppos);
        // If direction same(NOT IN BETWEEN)...
        if($SSLaneIndicator_CSP_spot.subtract($SSLaneIndicator_spos2).dot($SSLaneIndicator_CSP_spot.subtract($SSLaneIndicator_mppos2)) &gt; 0)
        {
             //...PICK nearest edge of lane
             if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_spos2)&gt;$SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_mppos2) )
             {
                 //$SSLaneIndicator_CSP_spot = $SSLaneIndicator_mppos2;
             }
             else
             {
                 //$SSLaneIndicator_CSP_spot = $SSLaneIndicator_spos2;
             }
        }
        this.$SSLI_bb = system.addVisualEffect(&quot;SSLI_EMPTYVE_beacon&quot;,$SSLaneIndicator_CSP_spot);
        this.$SSLI_bb.beaconLabel = &quot;Lane-3-Star-P&quot;;
        player.ship.compassTarget = this.$SSLI_bb;//SWITCH COMPASS
    }

    else if (this.$SSLI_MODE_N % 5 == 2){//Lane-2 STAR-WITCHPOINT
        player.consoleMessage(&quot;SSLI Spot 2 set ...&quot;,4);
        if (this.$SSLI_bb==null)
        {
            //log(this.name, &quot;null&quot;);
        }
        else if(this.$SSLI_bb.isVisualEffect){
            this.$SSLI_bb.remove();
        }
        //PROJECTION player position to lane
        var $SSLaneIndicator_CSW_spot = this.$SSLI_closestPointOnLine ($SSLaneIndicator_spos3,$SSLaneIndicator_wpos,$SSLaneIndicator_ppos);
        // If direction same(NOT IN BETWEEN)...
        if($SSLaneIndicator_CSW_spot.subtract($SSLaneIndicator_spos3).dot($SSLaneIndicator_CSW_spot.subtract($SSLaneIndicator_wpos)) &gt; 0)
        {
             //...PICK nearest edge of lane
             if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_spos3)&gt;$SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_wpos))
             {
                 //$SSLaneIndicator_CSW_spot = $SSLaneIndicator_wpos;
             }
             else
             {
                 //$SSLaneIndicator_CSW_spot = $SSLaneIndicator_spos3;
             }
        }
        this.$SSLI_bb = system.addVisualEffect(&quot;SSLI_EMPTYVE_beacon&quot;,$SSLaneIndicator_CSW_spot);
        this.$SSLI_bb.beaconLabel = &quot;Lane-2-Star-W&quot;;
        player.ship.compassTarget = this.$SSLI_bb;//SWITCH COMPASS
    }

    else if (this.$SSLI_MODE_N % 5 == 4){//Lane-A
        player.consoleMessage(&quot;SSLI Spot A set ...&quot;,4);
        if (this.$SSLI_bb==null)
        {
            //log(this.name, &quot;null&quot;);
        }
        else if(this.$SSLI_bb.isVisualEffect){
            this.$SSLI_bb.remove();
        }
        //LANE A edges position
        var $SSLaneIndicator_xyn = new Vector3D([0,0,1]);//xy plane normal
        var $SSLaneIndicator_ACmppos = system.mainPlanet.position;// mainPlanet position vector
        var $SSLaneIndicator_ACmspos = system.mainStation.position;//mainStation position vector
        var $SSLaneIndicator_ACmpms = $SSLaneIndicator_ACmspos.subtract($SSLaneIndicator_ACmppos);// Vector from mainPlanet to mainStation
        var $SSLaneIndicator_ACmpmsproj = $SSLaneIndicator_ACmpms.subtract($SSLaneIndicator_xyn.multiply($SSLaneIndicator_ACmpms.dot($SSLaneIndicator_xyn)));//Projection of vector mainPlanet to mainStation to xy plane
        var $SSLaneIndicator_Awpos=$SSLaneIndicator_ACmpmsproj.direction().multiply(75000.0);// A lane at witchpoint;
        var $SSLaneIndicator_Amppos=$SSLaneIndicator_Awpos.add(new Vector3D([0,0,$SSLaneIndicator_mppos1.z]));// A LANE at main planet;
        //PROJECTION player position to lane
        var $SSLaneIndicator_CAWP_spot = this.$SSLI_closestPointOnLine ($SSLaneIndicator_Awpos,$SSLaneIndicator_Amppos,$SSLaneIndicator_ppos);
        // If direction same(NOT IN BETWEEN)...
        if($SSLaneIndicator_CAWP_spot.subtract($SSLaneIndicator_Awpos).dot($SSLaneIndicator_CAWP_spot.subtract($SSLaneIndicator_Amppos)) &gt; 0)
        {
             //...PICK nearest edge of lane
             if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_Awpos)&gt;$SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_Amppos))
             {
                 $SSLaneIndicator_CAWP_spot = $SSLaneIndicator_Amppos;
             }
             else
             {
                 $SSLaneIndicator_CAWP_spot = $SSLaneIndicator_Awpos;
             }
        }

        this.$SSLI_bb = system.addVisualEffect(&quot;SSLI_EMPTYVE_beacon&quot;,$SSLaneIndicator_CAWP_spot);
        this.$SSLI_bb.beaconLabel = &quot;Lane-A (N)&quot;;
        player.ship.compassTarget = this.$SSLI_bb;//SWITCH COMPASS
    }

//MainPlanet-Witchpoint ,GUI DISPLAY and CONSOLE MESAG
    //Find closest point of lane center 
    var $SSLaneIndicator_pInCMPW = this.$SSLI_closestPointOnLine ($SSLaneIndicator_wpos,$SSLaneIndicator_mppos1,$SSLaneIndicator_ppos);
    if($SSLaneIndicator_pInCMPW.z &gt;0 &amp;&amp; $SSLaneIndicator_pInCMPW.z &lt; $SSLaneIndicator_mppos1.z){//witchPoint&gt;Player&lt;MainPlanet LANE-1
        if($SSLaneIndicator_ppos.subtract($SSLaneIndicator_pInCMPW).magnitude()&lt;50000){//Inside WB - MP cylinder
	    player.consoleMessage(&quot;In Lane-1 (WitchPoint - Main Planet) &quot;,4);

            this.$p2=&quot;@&quot;;//return 1;

        }else if($SSLaneIndicator_ppos.subtract($SSLaneIndicator_pInCMPW).magnitude()&lt;100000){
            //Calculate angle between mainStation and playerShip vectors on xy plane
            var $SSLaneIndicator_xyn = new Vector3D([0,0,1]);//xy plane normal
            var $SSLaneIndicator_mspos = system.mainStation.position;//mainStation position vector
            var $SSLaneIndicator_mpms = $SSLaneIndicator_mspos.subtract($SSLaneIndicator_mppos);// Vector from mainPlanet to mainStation
            var $SSLaneIndicator_mpmsproj = $SSLaneIndicator_mpms.subtract($SSLaneIndicator_xyn.multiply($SSLaneIndicator_mpms.dot($SSLaneIndicator_xyn)));//Projection of vector mainPlanet to mainStation to xy plane
            var $SSLaneIndicator_pposproj = $SSLaneIndicator_ppos.subtract($SSLaneIndicator_xyn.multiply($SSLaneIndicator_ppos.dot($SSLaneIndicator_xyn)));//Projection of vector of player to xy plane
            var $SSLaneIndicator_rPMS = $SSLaneIndicator_mpmsproj.angleTo($SSLaneIndicator_pposproj);//ANgle in Radians
            //clockwise or counterclockwise angle
            var $SSLaneIndicator_crossPMS = $SSLaneIndicator_mpmsproj.cross($SSLaneIndicator_pposproj);//Cross product of projections
            var $SSLaneIndicator_cwQ = $SSLaneIndicator_crossPMS.dot($SSLaneIndicator_xyn);//Dot prod of cross and normal. &gt;0 cw, &lt;0 ccw.

            if ($SSLaneIndicator_rPMS&lt;=0.3925 || ($SSLaneIndicator_mpms.x == 0 &amp;&amp; $SSLaneIndicator_mpms.y ==0 )){
	        player.consoleMessage(&quot;In Lane-A (MainStation &amp; parallel to Lane-1) &quot;,4);
                this.$p10=&quot;@&quot;;//return 4;
            }
	}else{
           // player.consoleMessage(&quot;**NOT** In lane witch-mPlanet Cylinder&quot;);
	}
    }else{
        //player.consoleMessage(&quot;**OFF** lane witch-mPlanet &quot;);
        //...PICK nearest edge of lane
        if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_wpos)&gt;$SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_mppos1))
        {
            //$SSLaneIndicator_CWP_spot = $SSLaneIndicator_mppos1;
            if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_pInCMPW)&lt;50000){//IF in lane Cylinder
                this.$p1=&quot;@&quot;;
            }
        }
        else
        {
            //$SSLaneIndicator_CWP_spot = $SSLaneIndicator_wpos;
            if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_pInCMPW)&lt;50000){//IF in lane Cylinder
                this.$p3=&quot;@&quot;;
            }
        }
    }

//MainPlanet-Star ,GUI DISPLAY and CONSOLE MESAG
    var $SSLaneIndicator_pInCMPS = this.$SSLI_closestPointOnLine ($SSLaneIndicator_spos2,$SSLaneIndicator_mppos2,$SSLaneIndicator_ppos);
    if($SSLaneIndicator_pInCMPS.subtract($SSLaneIndicator_mppos2).dot($SSLaneIndicator_pInCMPS.subtract($SSLaneIndicator_spos2)) &lt;= 0){

        if($SSLaneIndicator_ppos.subtract($SSLaneIndicator_pInCMPS).magnitude()&lt;50000){
	    player.consoleMessage(&quot;In Lane 3 (Star - MainPlanet).&quot;,4);
            this.$p8=&quot;@&quot;;//return 3;
        }
        else{
            //player.consoleMessage(&quot;**NOT** In lane Star-mPlanet Cylinder&quot;);
	}
    }else{

          //  player.consoleMessage(&quot;**OFF** lane Star-mPlanet &quot;);
          //...PICK nearest edge of lane
             if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_spos2)&gt;$SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_mppos2) )
             {
                 //$SSLaneIndicator_CSP_spot = $SSLaneIndicator_mppos2;
                 if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_pInCMPS)&lt;50000){//IF in lane Cylinder
                     this.$p7=&quot;@&quot;;
                 }
             }
             else
             {
                 //$SSLaneIndicator_CSP_spot = $SSLaneIndicator_spos2;
                 if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_pInCMPS)&lt;50000){//IF in lane Cylinder
                     this.$p9=&quot;@&quot;;
                 }
             }      
    }

//WitchPoint-Star ,GUI DISPLAY and CONSOLE MESAG
    var $SSLaneIndicator_pInCWS = this.$SSLI_closestPointOnLine ($SSLaneIndicator_spos3,$SSLaneIndicator_wpos,$SSLaneIndicator_ppos);
    if($SSLaneIndicator_pInCWS.subtract($SSLaneIndicator_wpos).dot($SSLaneIndicator_pInCWS.subtract($SSLaneIndicator_spos3)) &lt;= 0 ){
        if($SSLaneIndicator_ppos.subtract($SSLaneIndicator_pInCWS).magnitude()&lt;50000){
	    player.consoleMessage(&quot;In Lane 2 (Star - Witchpoint).&quot;,4);

            this.$p5=&quot;@&quot;;//return 2;
        }
        else{
            //player.consoleMessage(&quot;**NOT** In lane Star-Witchpoint Cylinder&quot;);
	}

    }else{
        //player.consoleMessage(&quot;**OFF** lane Star-Witchpoint &quot;);
             //...PICK nearest edge of lane
             if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_spos3)&gt;$SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_wpos))
             {
                 //$SSLaneIndicator_CSW_spot = $SSLaneIndicator_wpos;
                 if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_pInCWS)&lt;50000){//IF in lane Cylinder
                     this.$p6=&quot;@&quot;;
                 }
             }
             else
             {
                 //$SSLaneIndicator_CSW_spot = $SSLaneIndicator_spos3;
                 if ($SSLaneIndicator_ppos.distanceTo($SSLaneIndicator_pInCWS)&lt;50000){//IF in lane Cylinder
                     this.$p4=&quot;@&quot;;
                 }
             }
    }

//NO_LANE ,GUI DISPLAY and CONSOLE MESAG
    if (this.$p2!=&quot;@&quot; &amp;&amp; this.$p5!=&quot;@&quot; &amp;&amp; this.$p8!=&quot;@&quot; &amp;&amp; this.$p10!=&quot;@&quot;){
   
        player.consoleMessage(&quot;Not in any Known Lane.&quot;,4);
    }


    //MFD OUTPUT
    player.ship.setMultiFunctionText(&quot;SSLaneIndicator&quot; , &quot;Star System Lane Indicator&quot;+
       &quot;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0&quot;+
       &quot;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0&quot;+this.$p1+&quot;\xa0\xa0\xa0\xa0\xa0\xa0\xa0&quot;+this.$p4+&quot;\xa0\xa0\xa0\xa0\xa0&quot;+
       &quot;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0&quot;+this.$p7+&quot;\xa0P\xa0&quot;+this.$p8+&quot;\xa0S\xa0&quot;+this.$p9+&quot;\xa0\xa0\xa0\xa0&quot;+
       &quot;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0&quot;+this.$p2+&quot;\xa0&quot;+this.$p5+&quot;\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0&quot;+
       &quot;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0W\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0&quot;+
       &quot;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0&quot;+this.$p6+&quot;\xa0&quot;+this.$p3+&quot;\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0&quot;+
       &quot;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0Lane-A:&quot;+this.$p10+&quot;\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0&quot;+
       &quot;\n\t@:Position&quot;+&quot;\tP:Planet&quot;+&quot;\t-|/:Lanes&quot;+&quot;\n\tW:Whichpoint beacon&quot;+&quot;\tS:Star&quot;+ &quot;\n&quot;,false);
    //MFD OUTPUT END

    return 0;
}

//Compass gui remove target
this.$SSLI_compToNone = function(){
    if (this.$SSLI_bb==null)
        {
            //  log(this.name, &quot;null-und&quot;);
        }
    else if(this.$SSLI_bb.isVisualEffect){
            this.$SSLI_bb.remove();
        }
}

//Calculate position p projection to line of points a,b
this.$SSLI_closestPointOnLine  = function( $SSLaneIndicator_a, $SSLaneIndicator_b, $SSLaneIndicator_p ){
    var $SSLaneIndicator_ab = $SSLaneIndicator_b.subtract($SSLaneIndicator_a);
    var $SSLaneIndicator_ap = $SSLaneIndicator_p.subtract($SSLaneIndicator_a);
    var $SSLaneIndicator_result = $SSLaneIndicator_a.add(  $SSLaneIndicator_ab.multiply($SSLaneIndicator_ap.dot($SSLaneIndicator_ab)/($SSLaneIndicator_ab.dot($SSLaneIndicator_ab))));
    return $SSLaneIndicator_result;
}

</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
