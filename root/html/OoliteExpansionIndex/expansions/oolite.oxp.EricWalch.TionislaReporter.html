<html>
    <head>
        <title>Expansion Tionisla Reporter</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Tionisla Reporter</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">4 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">5 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Have you always wanted to explore the universe beyond its boundaries? Then this mission has something for you. The head of the Tionisla Chronicle will send you out to fetch material for an article that will make headlines. And you are the author of it.</td>
                    <td>Have you always wanted to explore the universe beyond its boundaries? Then this mission has something for you. The head of the Tionisla Chronicle will send you out to fetch material for an article that will make headlines. And you are the author of it.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.EricWalch.TionislaReporter</td>
                    <td>oolite.oxp.EricWalch.TionislaReporter</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Tionisla Reporter</td>
                    <td>Tionisla Reporter</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Missions</td>
                    <td>Missions</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Eric Walsh, phkb</td>
                    <td>Eric Walsh, phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.3.9</td>
                    <td>1.3.9</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Tionisla_Reporter">http://wiki.alioth.net/index.php/Tionisla_Reporter</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/c/c8/Tionisla_Reporter.oxz">https://wiki.alioth.net/img_auth.php/c/c8/Tionisla_Reporter.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1626941945</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Tionisla%20Reporter'>http://wiki.alioth.net/index.php/Tionisla%20Reporter</a></p>
        <h3>readme.txt</h3>
        <pre>Tionisla Reporter
version 1.3 by Eric Walch

Minimum version requirement Oolite 1.82

== Overview ==
This oxp adds a simple mission for a starting commander. As the name already suggest, the mission starts at Tionisla, where the Tionisla Chronicle is located.

== Story ==
Have you always wanted to explore the universe beyond its boundaries? Then this mission has something for you. The head of the Tionisla Chronicle will send you out to fetch material for an article that will make headlines. And you are the author of it.

== Disclamer ==
This mission was mainly written to use some of the new 1.75 features. At the same time it means the commander will see stuff that was not possible in older missions. One of the things is the camera that can make a screenshot. This is a function that actually saves a picture in the screenshot folder. However, it was decided that the actual saving a picture will not be possible in the final release version of Oolite 1.77 and newer, only in the test versions. For the mission itself it is not important if the actual picture is there.

== Difficulty ==
This is an easy mission that does not add additional pirates and does not lead you through pirate systems. It also starts near the Lave system, so it should be very suitable for a starting commander.

== Installation ==
Drop this oxp in your &quot;AddOns&quot; folder.
For de-installation just remove the oxp from the AddOns folder. Leaving the OXP in your Addons folder will mean you can re-visit mission locations and find things still exist. Removing the OXP will remove all mission locations.

== Licence ==
This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/3.0/

Planet image from http://planetpixelemporium.com/pluto.html and is copyright (c) by James Hastings-Trew.
Station model courtesy of dertien.

Version History
1.3.9	Resolved conflict with Interstellar Tweaks.
1.3.8	Camera is now portable between ships.
1.3.7	Corrected error in shipdata.plist.
1.3.6	Corrected the manifest identifier.
1.3.5	Removed the &quot;hasOwnProperty&quot; methods against missionVariables, as results were unpredictable.
1.3.4	Status of misjump hint will persist across saves.
		Fixed bugs that prevented the planet and station from being created.
		Planet will now be created regardless of status of station.
		Increased number of defence ships assigned to the station.
1.3.3	Made the turrets a bit more obvious.
1.3.2	Fixed spelling mistakes in missiontext.plist.
1.3.1	Added check for station destruction.
		Small graphical change to station for more uniqueness.
		Minor code adjustments.
1.3.0	Updated station model to be a variant of dertien&#39;s Octahedron station.
		Updated planet texture to a higher resolution.
		Updated station market script.
		Updated equipment.plist to use condition script.
		Updated planetinfo.plist so that the mission destination can be reached from either direction.
		Updated planetinfo.plist by removing deprecated scripting methods, replaced with Javascript versions.
		Fixed incorrect commodity references in script files.
		Mission locations will persist after the mission is complete, in order to maintain game-world consistency.
		Minor updates to mission text, fixing a couple of gramatical errors and adding a bit more flavour-text.
1.2.0	Fixed a problem with a certain device that should not be openly for sale.
		Now uses the new mission destination marker when used with Oolite 1.77
1.1.0	Changed code to make sure any Oolite version after 1.76 will not break the chart with mission destinations.
		Fixed a bug that broke the mission in Oolite 1.76.1
1.0.1	Added a check for a mission function in a future deployment version of Oolite.
1.0.0 	First release
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_EREHWON_PHOTOCAMERA.html">Tionisla photo camera</a></td>
                    <td>yes</td>
                    <td align="right">1</td>
                    <td align="center">2+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/ErehwonBuoy.html">ErehwonBuoy</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ErehwonStation.html">Erehwon Station</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/ErehwonTurret.html">ErehwonTurret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/erehwon_dockingbay.html">Erehwon Station</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/erehwonCamera.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name           = &quot;erehwonCamera&quot;;
this.author         = &quot;Eric Walch&quot;;
this.copyright		= &quot;2010 Eric Walch&quot;;
this.description	= &quot;Ship photocamera equipment activation script. Based on example code by another_commander&quot;;
this.licence		= &quot;CC-by-NC-SA 3.0&quot;;

this.activated = function() {
	var self = this.ship;
    var target = self.target;
    var photoName = &quot;wasted_photo_nr_&quot; + (11 - missionVariables.erehwonPictureCount);
    var station = system.shipsWithPrimaryRole(&quot;erehwonStation&quot;);
    if (station) target = station[0];

	player.consoleMessage(&quot;Photo shot.&quot;);

	if (target &amp;&amp; target.displayName == &quot;Erehwon Station&quot;) {
        var range = target.position.distanceTo(self.position) - target.collisionRadius;
        var minDistance = target.collisionRadius * 3; // screen filling
        var maxDistance = target.collisionRadius * 10; // 1/5 of screen filling
        var inRange =  (range &lt; maxDistance &amp;&amp; range &gt; minDistance);
        var deviation; // deviation in meter.

        switch (self.viewDirection) {
            case &quot;VIEW_FORWARD&quot;: deviation = self.vectorForward.angleTo(target.position.subtract(self.position)) * range; break;
            case &quot;VIEW_AFT&quot;: deviation = self.vectorForward.angleTo(self.position.subtract(target.position)) * range;break;
            case &quot;VIEW_PORT&quot;: deviation = self.vectorRight.angleTo(self.position.subtract(target.position)) * range;break;
            case &quot;VIEW_STARBOARD&quot;: deviation = self.vectorRight.angleTo(target.position.subtract(self.position)) * range;break;
            default : deviation = 2 * target.collisionRadius; // can&#39;t target when not viewing from inside ship.
        }

        var centered = (deviation &lt; target.collisionRadius);
        if (inRange &amp;&amp; centered) {
            missionVariables.erehwonFotoShot = &quot;YES&quot;;
            player.consoleMessage(&quot;Good photo for an article!!&quot;);
            photoName = &quot;Erehwon_station&quot;;
            if (missionVariables.erehwonGotStory == &quot;YES&quot;) {
                if (missionVariables.erehwonReconnaissance != &quot;SUCCESS&quot;) {
                    worldScripts[&quot;Tionisla Reporter&quot;].$unmarkSystem(144);
                    worldScripts[&quot;Tionisla Reporter&quot;].$markSystem(124);
                }
                missionVariables.erehwonReconnaissance = &quot;SUCCESS&quot;;
                mission.setInstructionsKey(&quot;erehwonReconnaissance_missioninfo2&quot;, &quot;Tionisla Reporter&quot;);
            }
        }
        else {
            if (!inRange) {
                if (range &gt;= maxDistance)
					player.consoleMessage(&quot;Useless photo, to far away!!&quot;)
                else
					player.consoleMessage(&quot;Useless photo, to close!!&quot;);
            }
            else {
                player.consoleMessage(&quot;Useless photo, off-centre!!&quot;);
            }
        }

	}
    if (global.takeSnapShot != undefined) takeSnapShot(photoName); // This function will only work in testversions, never in an official release.
    if (--missionVariables.erehwonPictureCount &lt; 1) {
        self.removeEquipment(&quot;EQ_EREHWON_PHOTOCAMERA&quot;);
        player.consoleMessage(&quot;Film is full&quot;);
    }
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/erehwonMarket.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name      = &quot;erehwon_market&quot;;
this.author    = &quot;spara&quot;;
this.copyright = &quot;2014 spara&quot;;
this.license   = &quot;CC BY-NC-SA 4.0&quot;;

this.$originalDefs = {
      &quot;food&quot;: [0, 0, 19, -2, 0, 0, 1, 0, 0],
      &quot;textiles&quot;: [0, 0, 20, -1, 0, 0, 3, 0, 0],
      &quot;radioactives&quot;: [0, 0, 42, -3, -3, 1, 7, 3, 0],
      &quot;slaves&quot;: [0, 0, 40, -5, 0, 0, 31, 0, 0],
      &quot;liquor_wines&quot;: [0, 0, 105, -5, 0, 0, 15, 0, 0],
      &quot;luxuries&quot;: [0, 0, 236, 8, 0, 0, 3, 0, 0],
      &quot;narcotics&quot;: [0, 0, 235, 29, 0, 0, 120, 0, 0],
      &quot;computers&quot;: [0, 0, 51, 14, 0, 0, 3, 0, 0],
      &quot;machinery&quot;: [0, 0, 117, 6, 0, 0, 7, 0, 0],
      &quot;alloys&quot;: [0, 0, 78, 1, 0, 0, 31, 0, 0],
      &quot;firearms&quot;: [0, 0, 32, 13, 0, 0, 7, 0, 0],
      &quot;furs&quot;: [0, 0, 36, -9, 0, 0, 63, 0, 0],
      &quot;minerals&quot;: [0, 0, 16, -1, -1, 85, 3, 3, 0],
	  &quot;gold&quot;: [0, 0, 73 , -1, -1, 5, 7, 3, 1],
	  &quot;platinum&quot;: [0, 0, 145, -2, -2, 6, 31, 7, 1],
	  &quot;gem_stones&quot;: [0, 0, 25, -1, -1, 250, 15, 15, 2],
      &quot;alien_items&quot;: [0, 0, 22, 15, 0, 0, 7, 0, 0]

};

this.updateLocalCommodityDefinition = function(goodDefinition) {
	var commodity = goodDefinition.key;
	var oldDefs = this.$originalDefs[commodity];
	//old style definition found for the good. calculate it the old way
	if (oldDefs) {
		var market_base_price = oldDefs[2];
		var market_eco_adjust_price = oldDefs[3];
		var market_eco_adjust_quantity = oldDefs[4];
		var market_base_quantity = oldDefs[5];
		var market_mask_price = oldDefs[6];
		var market_mask_quantity = oldDefs[7];
		var market_rnd = Math.floor(Math.random() * 256);

		var economy = system.economy;

		var price = (market_base_price + (market_rnd &amp; market_mask_price) + (economy * market_eco_adjust_price)) &amp; 255;
		price *= 0.4;

		var quantity = (market_base_quantity + (market_rnd &amp; market_mask_quantity) - (economy * market_eco_adjust_quantity)) &amp; 255;
		if (quantity &gt; 127) quantity = 0;
		quantity &amp;= 63;

		goodDefinition.price = price * 10;
		goodDefinition.quantity = quantity;
	}
	//no definition found. nullify the goods.
	else {
		goodDefinition.price = 0;
		goodDefinition.quantity = 0;
	}
	return goodDefinition;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/erehwonMission.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;Tionisla Reporter&quot;;
this.author      = &quot;Eric Walch&quot;;
this.copyright   = &quot;2011-2012 Eric Walch&quot;;
this.description = &quot;worldScript for the erehwon mission&quot;;
this.licence     = &quot;CC-by-NC-SA 3.0&quot;;

// Code adjusted by phkb to make Ewehwon appear in the same location any time the player misjumps between USLE and BIORLE
this._restoreIST = false;

//-------------------------------------------------------------------------------------------------------------
this.startUp = function (){
    //this.misjumpInfo = &quot;&quot;;
    if (!missionVariables.erehwonReconnaissance) {
        missionVariables.erehwonReconnaissance = &quot;START&quot;;
        missionVariables.erehwonFotoShot = &quot;NO&quot;;
        missionVariables.erehwonGotStory = &quot;NO&quot;;
        missionVariables.erehwomMisJumpInfo = &quot;&quot;;
    } else if (missionVariables.erehwonReconnaissance == &quot;FINISHED&quot;) {
        this.cleanUp();
    }
}

//-------------------------------------------------------------------------------------------------------------
this.missionScreenOpportunity = function (){
    if (!player.ship.docked || galaxyNumber != 0) return;
    this.missionOffers();
}

//-------------------------------------------------------------------------------------------------------------
this.missionOffers = function (){
    if (player.ship.dockedStation.isMainStation) {
        if (system.ID == 124) {
            if (missionVariables.erehwonReconnaissance == &quot;START&quot;) {
                mission.runScreen({
					screenID:&quot;tionisla_reporter&quot;,
                    title: &quot;Tionisla Chronicle&quot;,
                    messageKey: &quot;erehwonReconnaissance_briefing&quot;,
                    choicesKey: &quot;erehwonReconnaissance_choice&quot;
                    }, this.choiceEvaluation
                );
            }
            if (missionVariables.erehwonReconnaissance == &quot;SUCCESS&quot;) {
                mission.runScreen({
					screenID:&quot;tionisla_reporter&quot;,
                    title: &quot;Tionisla Chronicle&quot;,
                    messageKey: &quot;erehwonReconnaissance_debriefing&quot;,
                    model: &quot;erehwonStation&quot;
                    }
                );
                mission.displayModel.orientation = [0.75, 0, -0.6, 0];
                delete missionVariables.erehwonGotStory;
                delete missionVariables.erehwonFotoShot;
                delete missionVariables.erehwonPictureCount;
                //delete missionVariables.showErehwon;
                delete missionVariables.erehwomMisJumpInfo;
                missionVariables.erehwonReconnaissance = &quot;EPILOGUE&quot;;
                missionVariables.erehwonEpilogue = 1;
                missionVariables.erehwonActiontime = clock.days + 30;
                player.ship.removeEquipment(&quot;EQ_EREHWON_PHOTOCAMERA&quot;);
                mission.setInstructionsKey(null);
                this.$unmarkSystem(124);
                player.credits += 500;
            }
            if (missionVariables.erehwonReconnaissance == &quot;ACCEPTED&quot; &amp;&amp;
                    missionVariables.erehwonPictureCount == 0 &amp;&amp;  missionVariables.erehwonFotoShot == &quot;NO&quot;) {
                mission.runScreen({
					screenID:&quot;tionisla_reporter&quot;,
                    title: &quot;Tionisla Chronicle&quot;,
                    messageKey: &quot;erehwonReconnaissance_failure&quot;,
                    choicesKey: &quot;erehwonReconnaissance_choice2&quot;
                    }, this.choiceEvaluation
                );
            }
            if (missionVariables.erehwonReconnaissance == &quot;ACCEPTED&quot; &amp;&amp;
                    player.ship.equipmentStatus(&quot;EQ_EREHWON_PHOTOCAMERA&quot;) == &quot;EQUIPMENT_DAMAGED&quot;) {
                mission.runScreen({
					screenID:&quot;tionisla_reporter&quot;,
                    title: &quot;Tionisla Chronicle&quot;,
                    messageKey: &quot;erehwonReconnaissance_damaged&quot;,
                    choicesKey: &quot;erehwonReconnaissance_choice2&quot;
                    }, this.choiceEvaluation
                );
            }
        }
        /*if (system.ID == 144 &amp;&amp; missionVariables.erehwomMisJumpInfo !== &quot;&quot;) {
            missionVariables.erehwomMisJumpInfo = &quot;BIORLE&quot;;
        }
        if (system.ID == 48 &amp;&amp; missionVariables.erehwomMisJumpInfo == &quot;BIORLE&quot;) {
            missionVariables.erehwomMisJumpInfo = &quot;USLE&quot;;
        }*/
        if (system.ID == 144 &amp;&amp; missionVariables.erehwomMisJumpInfo !== &quot;GIVEN&quot;) {
            mission.runScreen({
                title: &quot;Tionisla Chronicle&quot;,
                messageKey: &quot;erehwonReconnaissance_biorle&quot;
            });
            missionVariables.erehwomMisJumpInfo = &quot;GIVEN&quot;;
        }
        if (missionVariables.erehwonReconnaissance == &quot;DECLINED&quot; &amp;&amp; missionVariables.erehwonActiontime &gt; clock.days) {
            mission.runScreen({
				screenID:&quot;tionisla_reporter&quot;,
                title: &quot;Tionisla Chronicle&quot;,
                messageKey: &quot;erehwonReconnaissance_declined&quot;
            });
            missionVariables.erehwonReconnaissance = &quot;FINISHED&quot;;
            missionVariables.erehwonTimerStart = null;
            this.cleanUp();
        }
        if (missionVariables.erehwonReconnaissance == &quot;EPILOGUE&quot; &amp;&amp; clock.days &gt; missionVariables.erehwonActiontime) {
            if (!missionVariables.erehwonDestroyed || missionVariables.erehwonDestroyed === false) {
                // credits for the idea and next 6 messages go to SandJ
                var erehwonEpilogue = missionVariables.erehwonEpilogue++;
                missionVariables.erehwonActiontime = clock.days + 30; // set new time
                mission.runScreen({
    				screenID:&quot;tionisla_reporter&quot;,
                    title: &quot;Tionisla Chronicle&quot;,
                    messageKey: &quot;erehwonReconnaissance_epilogue_&quot; + erehwonEpilogue
                });
                switch(erehwonEpilogue) {
                    case 1:
                        player.credits += 50;
                        break;
                    case 2:
                        player.ship.fuel = 7;
                        break;
                    case 3:
                        var narcotics = player.ship.cargoSpaceAvailable;
                        if (narcotics &gt; 35) narcotics = 35; // add a limit
                        manifest.narcotics += narcotics;
                        break;
                    case 4:
                        player.credits += 75;
                        break;
                    case 5:
                        player.credits += 50;
                        missionVariables.erehwonActiontime += 100; // wait a bit longer for the last one
                        break;
                    case 6:
                        manifest.gem_stones += 100;
                    default:
                        // we ran out of messages. Clean up now.
                        missionVariables.erehwonActiontime = null;
                        missionVariables.erehwonEpilogue = null;
                        missionVariables.erehwonReconnaissance = &quot;FINISHED&quot;;
                        this.cleanUp();
                        break;
                }
            }
        }
    } else if (player.ship.dockedStation.displayName == &quot;Erehwon Station&quot;) {
        if (missionVariables.erehwonGotStory &amp;&amp; missionVariables.erehwonGotStory == &quot;NO&quot;) {
            missionVariables.erehwonGotStory = &quot;YES&quot;;
            mission.runScreen({
                screenID:&quot;tionisla_reporter&quot;,
                title: &quot;Tionisla Chronicle&quot;,
                messageKey: &quot;erehwonReconnaissance_story&quot;
            });
        }
        if (missionVariables.erehwonFotoShot &amp;&amp; missionVariables.erehwonFotoShot == &quot;YES&quot;) {
            if (missionVariables.erehwonReconnaissance != &quot;SUCCESS&quot;)
            {
                this.$unmarkSystem(144);
                this.$markSystem(124);
            }
            missionVariables.erehwonReconnaissance = &quot;SUCCESS&quot;;
            mission.setInstructionsKey(&quot;erehwonReconnaissance_missioninfo2&quot;);
        }
    }
}

//-------------------------------------------------------------------------------------------------------------
this.choiceEvaluation = function (choice) {
    switch (choice) {
        case &quot;OFFER_ACCEPTED&quot;:
            missionVariables.erehwonReconnaissance = &quot;ACCEPTED&quot;;
            player.ship.awardEquipment(&quot;EQ_EREHWON_PHOTOCAMERA&quot;);
            missionVariables.erehwonPictureCount = 10;
            mission.setInstructionsKey(&quot;erehwonReconnaissance_missioninfo1&quot;);
            this.$markSystem(144);
            mission.runScreen({
				screenID:&quot;tionisla_reporter&quot;,
                title: &quot;Tionisla Chronicle&quot;,
                messageKey: &quot;erehwonReconnaissance_accepted&quot;
                }
            );
            break;

        case &quot;OFFER_DECLINED&quot;:
            missionVariables.erehwonReconnaissance = &quot;DECLINED&quot;;
            missionVariables.erehwonActiontime = clock.days + 30;
            break;
    }
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillEnterWitchspace = function (cause) {
	missionVariables.showErehwon = &quot;NO&quot;; // avoid adding planet on multiple misjumps.
    if (!system.isInterstellarSpace &amp;&amp; galaxyNumber === 0) {
		if (cause === &quot;standard jump&quot; &amp;&amp; (system.ID === 48 || system.ID === 144)) {
            missionVariables.showErehwon = &quot;YES&quot;;
			if (missionVariables.erehwomMisJumpInfo == &quot;GIVEN&quot; &amp;&amp; (system.ID == 48 || system.ID == 144) &amp;&amp; cause === &quot;standard jump&quot;) {
				if ((player.ship.targetSystem == 48 || player.ship.targetSystem == 144) &amp;&amp; Math.random() &lt; 0.2) {
					player.ship.scriptedMisjump = true;
				}
			}
		}
    }
}

//-------------------------------------------------------------------------------------------------------------
this.shipExitedWitchspace = function () {
    if (this._restoreIST === true) {
        worldScripts[&quot;IST_masterScript&quot;].shipWillExitWitchspace = worldScripts[&quot;IST_masterScript&quot;].$hold_shipWillExitWitchspace;
        delete worldScripts[&quot;IST_masterScript&quot;].$hold_shipWillExitWitchspace;
        this._restoreIST = false;
    }
}

//-------------------------------------------------------------------------------------------------------------
this.$markSystem = function (ID) {
    if (0 &lt; oolite.compareVersion(&quot;1.77&quot;)) {
        mission.markSystem(ID);
    } else {
        mission.markSystem({
            system: ID,
            name: &quot;Tionisla Reporter&quot;,
            markerColor: &quot;magentaColor&quot;,
            markerShape: &quot;MARKER_DIAMOND&quot;
        });
    }
}

//-------------------------------------------------------------------------------------------------------------
this.$unmarkSystem = function (ID) {
    if (0 &lt; oolite.compareVersion(&quot;1.77&quot;)) {
        mission.unmarkSystem(ID);
    } else {
        var ok = mission.unmarkSystem({system: ID, name: &quot;Tionisla Reporter&quot;});
        if (!ok) mission.unmarkSystem(ID); // must have had a legacy marker. Clear that also.
    }
}

//-------------------------------------------------------------------------------------------------------------
this.cleanUp = function () {
    delete this.missionScreenOpportunity;
    //delete this.shipWillEnterWitchspace;
}

//-------------------------------------------------------------------------------------------------------------
this.$erehwon_systemWillPopulate = function() {
    if (this.$populatorRun) return;
    // turn off IST, just in case
    if (worldScripts[&quot;IST_masterScript&quot;]) {
        worldScripts[&quot;IST_masterScript&quot;].$hold_shipWillExitWitchspace = worldScripts[&quot;IST_masterScript&quot;].shipWillExitWitchspace;
        delete worldScripts[&quot;IST_masterScript&quot;].shipWillExitWitchspace;
        this._restoreIST = true;
    }

	system.setPopulator(&quot;oolite-interstellar-thargoids&quot;, {
        priority: 10,
        location: &quot;WITCHPOINT&quot;,
        groupCount: 2 + Math.floor(Math.random() * 4),
        callback: function(pos) {system.addShips(&quot;thargoid&quot;, 1, pos, 0);}
	});
	this.$populatorRun = true;

	if (missionVariables.showErehwon === &quot;YES&quot;) {
        system.addPlanet(&quot;Planet_Erehwon&quot;);
        // only add the station if it hasn&#39;t been destroyed
        if (!missionVariables.erehwonDestroyed || missionVariables.erehwonDestroyed === false) {
            system.addShips(&quot;erehwonStation&quot;, 1, Vector3D(-50000, 4000, 413000).fromCoordinateSystem(&quot;abs&quot;), 1);
        }
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/erehwonStation.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;ErehwonStation&quot;;
this.author      = &quot;eric walch&quot;;
this.copyright   = &quot;2008 Eric Walch&quot;;
this.description = &quot;station at Erehwon Planet. About 3 LY west of Biorle in galaxy 1&quot;;
this.licence     = &quot;CC-by-NC-SA 3.0&quot;;

// Just add a default buoy. Advanced compass itself is not working in interstellar space
this.shipSpawned = function () {
    var planet = system.planets[0];
    if (planet) {
        var targetVector = planet.position.subtract(this.ship.position).direction();
        this.ship.orientation = targetVector.rotationTo(new Vector3D(0,0,1));
        system.addShips(&quot;erehwon-buoy&quot;, 1, this.ship.position.add(this.ship.heading.multiply(10E3)), 1);
    }
	if (worldScripts.StationDockControl) {
		worldScripts.StationDockControl._trafficNone.push(&quot;ErehwonStation&quot;);
		worldScripts.StationDockControl._shuttleTrafficNone.push(&quot;ErehwonStation&quot;);
	}
    delete this.shipSpawned;
}

this.stationLaunchedShip = function (ship) {
    if (ship &amp;&amp; ship.AI == &quot;route2sunskimAI.plist&quot;) {
        // no sunskimming possible from this station.
        ship.fuel = 7;
        ship.switchAI(&quot;exitingTraderAI.plist&quot;);
    }
}

this.shipDied = function(whom, why) {
    missionVariables.erehwonDestroyed = true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/reporterConditions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;TionislaReporter_Conditions&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2016 phkb&quot;;
this.description = &quot;Condition script for equipment.&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	if (context === &quot;scripted&quot;) return true;
	return false;
}
	
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
