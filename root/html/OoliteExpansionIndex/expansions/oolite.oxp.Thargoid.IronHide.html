<html>
    <head>
        <title>Expansion IronHide</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion IronHide</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">3 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER E)(&#39;[]&#39; vs &#39;[equipment]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Enhanced armour for the ship&#39;s hull to better protect against combat damage and general bumps and knocks.</td>
                    <td>Enhanced armour for the ship&#39;s hull to better protect against combat damage and general bumps and knocks.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.IronHide</td>
                    <td>oolite.oxp.Thargoid.IronHide</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>IronHide</td>
                    <td>IronHide</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid, Milo</td>
                    <td>Thargoid, Milo</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>3.06</td>
                    <td>3.06</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>equipment</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/IronHide_OXP">http://wiki.alioth.net/index.php/IronHide_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/a/a0/Oolite.oxp.Thargoid.IronHide.3.06.oxz">https://wiki.alioth.net/img_auth.php/a/a0/Oolite.oxp.Thargoid.IronHide.3.06.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873396</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/IronHide'>http://wiki.alioth.net/index.php/IronHide</a></p>
        <h3>IronHide ReadMe &amp; License.txt</h3>
        <pre>IronHide OXP by Thargoid, now maintained by Milo.

The Ships Systems Department of the Aquarian Shipbuilding Corporation introduce their latest development - IronHide armour. This is a simple but effective technology which applies a special treatment to the hull of the customer ship which helps to strengthen it against combat and physical damage in collaboration with the ship&#39;s shielding.

In practice the armour helps to absorb damage that gets passed (or takes down) the shields, although if a truly concentrated attack occurs then localised penetration and energy damage may still occur. This is especially true of missile attacks, which can still cause internal damage and equipment failure due to concussion effects. The current strength of the armour can be viewed on the ship&#39;s manifest (F5-F5) screen, and any damage can be repaired at a suitably high-tech station.

The armour itself is available from all good tech 5 locations, for a recommended retail price of just 750 credits. These stations should also be able to quote for repairs to damaged installations. It should also be noted that insurers class armour as a combat consumable, and so its replacement is not included as part of the insurance for equipment such as escape pods and lifeboats.

A special enhanced upgrade for military uses has also been developed, and may be available to customers at tech 10 systems (the upgrade requires an undamaged civilian-grade installation). The upgrade doubles the effectiveness of the regular armour.

Requires v1.82 or later of Oolite. It will not run on older versions.

--------------------------------------------------------------

License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement. Basically if it&#39;s unique or would identify or overwrite anything in the original OXP, then you may not re-use it (for obvious compatibility reasons).
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* The license information (either as this file or merged into a larger one) must be included in the OXP.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)

--------------------------------------------------------------

Instructions:

Look for IronHide in the Equipment category of the in-game expansions manager, or download the OXZ file manually and put it in your AddOns folder.

--------------------------------------------------------------

Version history:

31/07/2010 - Version 1.00, initial release.

01/08/2010 - Version 1.01, changed shield strength from this. to mission variables to maintain across save games.

19/02/2011 - Version 2.00, upgrade for 1.75 trunk - and operating properly now after shields are gone!

19/06/2020 - Version 3.00, updated by Milo; IronHide OXP now requires Oolite 1.79+; armour durability increased but energy restoration is now proportional to damage absorbed (previously the ship&#39;s energy was fully restored after every hit, which could conflict with other OXPs&#39; attempts to regulate energy levels); damage below 5 (10 for military grade) will not degrade IronHide armour; further improved compatibility with other OXPs by checking damage type instead of energy level to decide which damage the armour can absorb.

20/06/2020 - Version 3.01, updated by Milo; IronHide OXP now requires Oolite 1.82+; introduced a new script_info property in equipment.plist (ironHide_percentArmourLostPerDamagePointTaken), which functionally replaces the ironHide_strength mission variable (now unused by IronHide, but kept and returned to its pre-3.00 values because CombatMFD uses it for its SEE indicator); eliminated the &quot;damage below X will not degrade armour&quot; threshold (any damage that gets through shields now will consume armour); set damage_probability to zero so IronHide cannot be made &quot;inoperable&quot; (appear broken on the F5 screen) before it is fully consumed; introduced price variance for installation and repairs proportional to ship surface area (cobra3-player is the baseline); added installation_time of 12 hours for both civilian and military grades and a proportional time advance when repairing (repairing X percent is 25% faster than installing X percent, a small incentive to repair before the armour is destroyed; note that if military grade armour is fully consumed, you must first reinstall civilian grade [12 hrs] and then upgrade to military grade [12 hrs], so it saves even more time if you repair military grade before it breaks; also, while not a change from previous versions, military grade armour costs less to repair than it costs to install).

21/06/2020 - Version 3.02, updated by Milo; doubled price variance for larger ships and applied proportional adjustment to repair costs (they were still using the baseline price); improved compatibility with ShipVersion OXP by not offering IronHide for purchase on ships that ShipVersion does not allow to use it (when ShipVersion OXP is detected, civilian IronHide is only for ships with mass 30t or higher and military IronHide is only for ships with mass 130t or higher).

21/06/2020 - Version 3.04, updated by Milo; improved handling of invalid ironHide_milFlag missionVariable (not zero or one) from old saved game; modified allowAwardEquipment handler to allow other OXPs to add IronHide to player ships (e.g., Ship Storage Helper).

21/06/2020 - Version 3.05, updated by Milo; re-assess damage-to-armour multiplier each time the ship launches, in case another OXP replaced the player ship, awarded IronHide, or changed the grade of the armour.

21/06/2020 - Version 3.06, updated by Milo; if armour percentage is above zero but EQ_IRONHIDE is missing at startUp or at launch, set percentage to zero (in case another OXP removed IronHide without changing percentage); allow other OXPs to awardEquipment(&quot;EQ_IRONHIDE&quot;) to NPC ships (e.g., Ship Storage Helper using it as a placeholder for player-&gt;npc-&gt;player transitions), but IronHide does nothing for NPC ships, so outside of scripted additions, do not allow NPC ships to spawn with IronHide armour, and do not allow awardEquipment(&quot;EQ_IRONHIDE_MIL&quot; or &quot;EQ_IRONHIDE_REPAIRS&quot;) on NPCs because those are used only as script triggers from the F3 purchase screen.

--------------------------------------------------------------

Acknowledgements:

With thanks to ClymAngus for a discussion long ago over a pint about the possibilities of armour for ships.

And to Ahruman for implementing the damage event allowing this OXP to be written as it should be, rather than as surrogate shields :)</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_IRONHIDE.html">IronHide Armour</a></td>
                    <td>yes</td>
                    <td align="right">7500</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_IRONHIDE_MIL.html">IronHide Armour Military Upgrade</a></td>
                    <td>yes</td>
                    <td align="right">7500</td>
                    <td align="center">10+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_IRONHIDE_REPAIR.html">Quotation for repair of IronHide armour</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">5+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/thargoid-ironhide.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name			= &quot;IronHide Armour Script&quot;;
this.author			= &quot;Thargoid&quot;;
this.copyright		= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description	= &quot;Script for IronHide armour, for player ship only&quot;;
this.version		= &quot;3.06&quot;;

this.startUp = function()
{
	if(!missionVariables.ironHide_percentage)
		missionVariables.ironHide_percentage = 0; // float from 0 to 100 representing percentage of armour remaining
	else if (player.ship.equipmentStatus(&quot;EQ_IRONHIDE&quot;) !== &quot;EQUIPMENT_OK&quot;)
		missionVariables.ironHide_percentage = 0; // 3.06: resolve inconsistency caused by other OXPs removing IronHide without setting percentage to zero

	missionVariables.ironHide_milFlag = missionVariables.ironHide_milFlag ? 1 : 0; // boolean 0 or 1 representing whether the armour is military-grade

	// strength represents total damage the armour can absorb (does not regenerate unless repaired), and is configurable in equipment.plist, so always reload it
	missionVariables.ironHide_strength = parseInt(EquipmentInfo.infoForKey(missionVariables.ironHide_milFlag ? &quot;EQ_IRONHIDE_MIL&quot; : &quot;EQ_IRONHIDE&quot;).scriptInfo.ironHideStrength);
	// as of IronHide 3.01, ironHide_strength is no longer used, so it is only here for compatibility with other OXPs that look at the value

	// below is how much to charge per percentage of armour to be repaired, proportional to the price of a new set of civilian grade armour
	this.ironHideFactor = this.updateEquipmentPrice(&quot;EQ_IRONHIDE&quot;, parseInt(EquipmentInfo.infoForKey(&quot;EQ_IRONHIDE&quot;).price)) / 1000;
}

this.updateEquipmentPrice = function(equipmentKey, currentPrice)
{
	if (equipmentKey === &quot;EQ_IRONHIDE&quot; || equipmentKey === &quot;EQ_IRONHIDE_MIL&quot;)
	{
		// calculate price proportional to ship surface area
		var adjust = player.ship.boundingBox.magnitude() / 157.30239913964633; // baseline is from a stock cobra3-player
		return (adjust &gt; 1) ? Math.ceil(adjust * 2 * currentPrice) : currentPrice; // only adjust price upwards, don&#39;t discount for smaller ships
	}
	return currentPrice;
}

this.shipDockedWithStation = function(station)
{
	// below is how much to charge per percentage of armour to be repaired; necessary to recalculate after startUp because player may have changed ships
	this.ironHideFactor = this.updateEquipmentPrice(&quot;EQ_IRONHIDE&quot;, parseInt(EquipmentInfo.infoForKey(&quot;EQ_IRONHIDE&quot;).price)) / 1000;
}

// this.equipmentDamaged = function(equipment) // unnecessary since 3.01 because damage_probability is set to zero in equipment.plist
// {
	// if(equipment === &quot;EQ_IRONHIDE&quot;)
	// {
		// player.ship.setEquipmentStatus(&quot;EQ_IRONHIDE&quot;,&quot;EQUIPMENT_OK&quot;); // as it doesn&#39;t make sense for the armour to be inoperable-damaged
	// }
// }

this.shipLaunchedFromStation = function() // 3.05: moved from startUp to every launch in case another OXP used replaceShip and awardEquipment(&quot;EQ_IRONHIDE&quot;) and set milFlag to a different value
{
	// below is the multiplier for damage taken to determine how much armour percentage is lost (e.g., if dmgMult is 0.2 and 10 damage is taken, ironHide_percentage drops by 10 * 0.2 = 2)
	this.ironHideDamageMult = parseFloat(EquipmentInfo.infoForKey(missionVariables.ironHide_milFlag ? &quot;EQ_IRONHIDE_MIL&quot; : &quot;EQ_IRONHIDE&quot;).scriptInfo.ironHide_percentArmourLostPerDamagePointTaken);
	
	if (missionVariables.ironHide_percentage &gt; 0 &amp;&amp; player.ship.equipmentStatus(&quot;EQ_IRONHIDE&quot;) !== &quot;EQUIPMENT_OK&quot;)
		missionVariables.ironHide_percentage = 0; // 3.06: resolve inconsistency caused by other OXPs removing IronHide without setting percentage to zero
}

this.shipTakingDamage = function(amount, fromEntity, damageType)
{
	if(amount &lt; 1) return; // all damage was absorbed by shields

	var ps = player.ship, percLeft = missionVariables.ironHide_percentage, dmgMult = this.ironHideDamageMult; // cache for performance
	if(percLeft &gt; 0 &amp;&amp; damageType === &quot;energy damage&quot;) // have armour, check damageType instead of energy level to improve compatibility with other OXPs
	{
		if(percLeft &gt; amount * dmgMult) // armour is sufficient to absorb all the damage
		{
			ps.energy += amount; // formula change: restore the amount absorbed by armour instead of ps.energy = ps.maxEnergy
			missionVariables.ironHide_percentage = percLeft - amount * dmgMult;
		}
		else // damage fully consumes remaining armour
		{
			ps.energy += percLeft / dmgMult; // whatever armour was left absorbed as much as it could
			player.consoleMessage(&quot;IronHide armour has been destroyed!&quot;, 8);
			ps.removeEquipment(&quot;EQ_IRONHIDE&quot;);
			missionVariables.ironHide_percentage = 0;
			missionVariables.ironHide_milFlag = 0;
			mission.setInstructionsKey(null);
		}
	}
}

this.guiScreenWillChange = function(newScreen, oldScreen)
{
	if(newScreen === &quot;GUI_SCREEN_MANIFEST&quot;)
	{
		//if (equipmentStatus(&quot;EQ_IRONHIDE&quot;) === &quot;EQUIPMENT_OK&quot;)
		if(missionVariables.ironHide_percentage &gt; 0) // 3.06 replaced condition above to ensure armour visibility even if EQ_IRONHIDE is missing (e.g., removed by other OXPs without adjusting missionVariables)
			mission.setInstructions([expandMissionText(missionVariables.ironHide_milFlag ? &quot;ironHideMil_short&quot; : &quot;ironHideCiv_short&quot;)]);
		else
			mission.setInstructionsKey(null);
	}
}

this.allowAwardEquipment = function(eqKey, ship, context)
{
	// if (context === &quot;newShip&quot; || context === &quot;purchase&quot;) // equipment pre-installed on a ship in a station shipyard (F3 F3), or equipment for purchase on the F3 screen
	if (ship === player.ship) // 3.04: replaced conditions above, to allow scripted awardEquipment but still restrict to player-only (e.g., by Ship Storage Helper)
	{
		if (eqKey === &quot;EQ_IRONHIDE&quot;) {
			if (player.ship.mass &lt; 30000 &amp;&amp; worldScripts[&quot;shipversion&quot;]) return false; // ShipVersion OXP does not allow IronHide for ships with mass below 30t
			if (missionVariables.ironHide_percentage &gt; 0) return false; // have armour, but missing equipment (can be caused by other OXPs removing equipment or changing IronHide mission variables)
			return true; // no restrictions on civilian grade armour
		} else if (eqKey === &quot;EQ_IRONHIDE_MIL&quot; &amp;&amp; missionVariables.ironHide_percentage === 100 &amp;&amp; missionVariables.ironHide_milFlag === 0) {
			if (player.ship.mass &lt; 130000 &amp;&amp; worldScripts[&quot;shipversion&quot;]) return false; // ShipVersion OXP does not allow military IronHide for ships with mass below 130t
			return true; // only if your civilian armour is fully repaired and you don&#39;t already have military grade armour
		} else if (eqKey === &quot;EQ_IRONHIDE_REPAIR&quot; &amp;&amp; missionVariables.ironHide_percentage &lt; 100) {
			return true; // only if your armour is damaged
		}
	} else if (context === &quot;scripted&quot; &amp;&amp; eqKey === &quot;EQ_IRONHIDE&quot;) { // equipment added to NPC ships by scripts from other OXPs
		return true; // allow this for NPC ships assuming that another OXP has a good reason to do this (e.g., Ship Storage Helper using it as a placeholder for player-&gt;npc-&gt;player transitions)
	}
	// default is no in all other cases (IronHide does nothing for NPC ships, so don&#39;t allow the game to spawn NPCs with IronHide, and don&#39;t allow awarding the military or repair equipment to non-player ships because they are placeholders for triggering playerBoughtEquipment and are removed immediately after)
	return false;
}

this.playerBoughtEquipment = function(equipment)
{
	switch(equipment)
	{
		case(&quot;EQ_IRONHIDE&quot;): // always available
			missionVariables.ironHide_milFlag = 0;
			missionVariables.ironHide_percentage = 100;
			this.dmgMult = parseFloat(EquipmentInfo.infoForKey(equipment).scriptInfo.ironHide_percentArmourLostPerDamagePointTaken);
			break;

		case(&quot;EQ_IRONHIDE_MIL&quot;): // only available when armour is fully repaired (therefore ironHide_percentage is already 100 and does not need to be set here)
			missionVariables.ironHide_milFlag = 1;
			this.dmgMult = parseFloat(EquipmentInfo.infoForKey(equipment).scriptInfo.ironHide_percentArmourLostPerDamagePointTaken);
			player.ship.removeEquipment(&quot;EQ_IRONHIDE_MIL&quot;); // only used as a placeholder for purchase
			break;

		case(&quot;EQ_IRONHIDE_REPAIR&quot;): // only available when armour is damaged
			missionVariables.ironHide_cost = (100 - missionVariables.ironHide_percentage) * this.ironHideFactor;
			if(missionVariables.ironHide_mil === 1)
				missionVariables.ironHide_cost *= 1.5; // cheaper to repair than buying armour new (price * 2 vs. price * 1.5)
			player.ship.removeEquipment(&quot;EQ_IRONHIDE_REPAIR&quot;);
			if(player.credits &lt; missionVariables.ironHide_cost)
				mission.runScreen({title: &quot;Too Expensive&quot;, messageKey:&quot;ironHide_tooExpensive&quot;});
			else
				mission.runScreen({title: &quot;Armour Repair&quot;, messageKey:&quot;ironHide_repair&quot;, choicesKey:&quot;ironHide_choices&quot;}, this.choice);
			break;

		case(&quot;EQ_RENOVATION&quot;):
			if(missionVariables.ironHide_percentage === 100 || player.ship.equipmentStatus(&quot;EQ_IRONHIDE&quot;) === &quot;EQUIPMENT_UNAVAILABLE&quot;)
				break; // don&#39;t have armour or it&#39;s full-strength, so no repair needed during renovations
			else if(player.ship.equipmentStatus(&quot;EQ_IRONHIDE&quot;) === &quot;EQUIPMENT_OK&quot;)
			{
				missionVariables.ironHide_cost = (100 - missionVariables.ironHide_percentage) * this.ironHideFactor;
				if(missionVariables.ironHide_milFlag === 1)
					missionVariables.ironHide_cost *= 1.5; // cheaper to repair than buying armour new (price * 2 vs. price * 1.5)
				if(missionVariables.ironHide_cost &gt; 0 &amp;&amp; missionVariables.ironHide_cost &lt; player.credits)
					mission.runScreen({title: &quot;Armour Repair&quot;, messageKey:&quot;ironHide_renovationRepair&quot;, choicesKey:&quot;ironHide_renovationChoices&quot;}, this.choice);
			}
			break;
	}
}

this.choice = function(choice)
{
	switch(choice)
	{
		case &quot;IRONHIDE_1_ACCEPT&quot;:
			// repair time is proportional to installation time of 12 hours but 25% faster (0.75 * 12 * 60 * 60 = 32400 seconds)
			clock.addSeconds(32400 * (100 - missionVariables.ironHide_percentage) / 100);
			player.credits -= missionVariables.ironHide_cost;
			missionVariables.ironHide_percentage = 100;
			break;
		case &quot;IRONHIDE_1_RENOVATION_ACCEPT&quot;:
			// repair time is included in renovation time (convenient) even though cost is not
			player.credits -= missionVariables.ironHide_cost;
			missionVariables.ironHide_percentage = 100;
			break;
		case &quot;IRONHIDE_2_REJECT&quot;:
			break;
	}
}

this.playerBoughtNewShip = this.shipLaunchedEscapePod = function()
{ // reset everything for a new ship, as armour isn&#39;t transferable or covered by insurance
	player.ship.removeEquipment(&quot;EQ_IRONHIDE&quot;);
	missionVariables.ironHide_percentage = 0;
	missionVariables.ironHide_milFlag = 0;
	mission.setInstructionsKey(null);
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
