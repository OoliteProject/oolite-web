<html>
    <head>
        <title>Expansion Towbar Payout - Medium</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Towbar Payout - Medium</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
                <li>Unknown key &#39;requires_oxp&#39; at https://wiki.alioth.net/img_auth.php/e/eb/TowbarPayout-Medium-1.1.oxz!manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Reduces Towbar&#39;s salvaged equipment payout.</td>
                    <td>Reduces Towbar&#39;s salvaged equipment payout.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.dybal.towbarPayout-Medium</td>
                    <td>oolite.oxp.dybal.towbarPayout-Medium</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Towbar Payout - Medium</td>
                    <td>Towbar Payout - Medium</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Dybal</td>
                    <td>Dybal</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.1</td>
                    <td>1.1</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/e/eb/TowbarPayout-Medium-1.1.oxz">https://wiki.alioth.net/img_auth.php/e/eb/TowbarPayout-Medium-1.1.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Cc BY-NC-SA 4.0</td>
                    <td>Cc BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873505</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Towbar%20Payout%20-%20Medium'>http://wiki.alioth.net/index.php/Towbar%20Payout%20-%20Medium</a></p>
        <h3>Readme.txt</h3>
        <pre>License 

CC-BY-NC-SA 4.0 - Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International
(https://creativecommons.org/licenses/by-nc-sa/4.0/)

------------------------------------------------------------
Towbar Payout - Medium

This OXP changes the policies Towbar uses to calculate the value of the equipment from a salvaged ship.

Its intent is reduce the payout for the expensive equipment to keep the earnings for salvaging high enoughto pay the costs and be attractive, but not so high that the salvager amasses a huge amount of credits so quicly that money loses its meaning.

The salvaging price starts at 25% of the full price for the equipment; if the equipment is damaged, the salvaged price is halved to 12.5%.

The damage probability of an equipment is function of its Tech Level, going from 20% for TL 1 to 95% to TL 16.

After that, if the &lt;price damage discounted&gt;  is above 500 Cr a new salvaged price is calculated using the formulae (it has to be plotted and the curve shape seen to be understood, try https://www.desmos.com/calculator):

    &lt;salvaged price&gt; = 5 * &lt;price damage discounted&gt; / sqrt(&lt;price damage discounted&gt; / 2)

Finally, there is a minimum payout: if the &lt;damage discounted price&gt; was above 300 Cr we pay at least 50 Cr, otherwise we pay at least 10 Cr; if the &lt;salvaged price&gt; calcuated by the formulae above is bellow this minimun, the minimum is paid.

This should reduce the equipment value for a fully kitted NPC to around 3~4k Cr, compared to the 20~50k Cr for Towbar pre 0.104, or the 4~8k of standard policy of the 0.104 version.

--------------------------------------------------------------
Change log

v1.0
- Initial version

v1.1
- Looks for EquipmentInfo.scriptInfo.towbar_max_salvage_price
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/payout.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;towbarPayout-Medium&quot;;
this.author      = &quot;Dybal&quot;;
this.copyright   = &quot;2020 Dybal&quot;;
this.licence     = &quot;CC BY-NC-SA 4.0&quot;;
this.description = &quot;Alternative payout policy for salvaged equipments&quot;;
this.version     = &quot;1.1&quot;;

this.$display = &quot;Medium&quot;; // for use by Towbar in Lib_Config

//---------------------------------------------------------------------
this.startUpComplete = function _Towbar_EqPayout_Medium_startUpComplete() {
    var wstb = worldScripts.towbar;

    if (wstb) {
        if (wstb.$TowbarEquipmentPayoutHandlers) {
            // Towbar version &gt;= 0.105
            log(this.name, &quot;Registering Towbar Equipment Payout handler &#39;&quot;+this.$display+&quot;&#39;&quot;);
            wstb.$TowbarEquipmentPayoutHandlers.push(this.$Towbar_EqPayout_Medium);
            this.$Towbar_EqPayout_Medium.display = this.$display;
        } else if (wstb.$Towbar_EqSalvagePrice) {
            // Towbar version 0.104
            log(this.name, &quot;Overwriting Towbar Equipment Payout handler&quot;);
            wstb.$Towbar_EqSalvagePrice = this.$Towbar_EqPayout_Medium;
        }
    }
}

//---------------------------------------------------------------------
this.$Towbar_EqPayout_Medium = function _Towbar_EqPayout_Medium(eqInfo) {
    if (!eqInfo || !eqInfo.equipmentKey) return 0;
    var price = eqInfo.price / 10; // price in credits
    var discounted = 0.25 * price;
    var damage_prob = 0.5 + ((eqInfo.techLevel&lt;16 ? eqInfo.techLevel : Math.random()*15)-6)/20;
    var damaged = (Math.random() &lt; damage_prob);
    var damaged_price, salvage_price;

    if (eqInfo.scriptInfo &amp;&amp; eqInfo.scriptInfo.towbar_max_salvage_price) 
        discounted = price = parseFloat(eqInfo.scriptInfo.towbar_max_salvage_price);

    if (discounted &lt; 10) return 0;

    if (damaged) 
        damaged_price = discounted / 2;
    else
        damaged_price = discounted;

    if (damaged_price &gt; 500) // 500 Cr
        salvage_price = 5 * damaged_price / Math.sqrt(damaged_price/2);
    else if (damaged_price &gt; 300) // 300 Cr
        salvage_price = Math.max(50, damaged_price); // at least 50 Cr
    else
        salvage_price = Math.max(10, damaged_price); // at least 10 Cr

    salvage_price = Math.round(salvage_price / 10) * 10; // get multiple of 10 number
    if (this.$TowbarDebug) log(this.name,&quot;towbarPayout-Medium &quot;+eqInfo.equipmentKey+&quot;, TL:&quot;+eqInfo.techLevel+&quot;, price:&quot;+(eqInfo.price/10).toFixed(0)+&quot;, damage_prob:&quot;+damage_prob.toFixed(4)+&quot;, damaged:&quot;+damaged+&quot;, discounted:&quot;+discounted.toFixed(0)+&quot;, depreciated:&quot;+damaged_price.toFixed(0)+&quot;, payout:&quot;+salvage_price.toFixed(0));
    return salvage_price;
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
