<html>
    <head>
        <title>Expansion Docking Fees</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Docking Fees</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds a small docking fee and docking messages to all GalCop stations based on system tech level.  Many OXP stations are also given unique fees or docking messages.</td>
                    <td>Adds a small docking fee and docking messages to all GalCop stations based on system tech level.  Many OXP stations are also given unique fees or docking messages.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Layne.DockingFees</td>
                    <td>oolite.oxp.Layne.DockingFees</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Docking Fees</td>
                    <td>Docking Fees</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Ambience</td>
                    <td>Ambience</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Layne &amp; Eris</td>
                    <td>Layne &amp; Eris</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.1</td>
                    <td>2.1</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://aegidian.org/bb/viewtopic.php?f=6&amp;t=17382">http://aegidian.org/bb/viewtopic.php?f=6&amp;t=17382</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/a/ae/DockingFees.oxz">https://wiki.alioth.net/img_auth.php/a/ae/DockingFees.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1659327373</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Docking%20Fees'>http://wiki.alioth.net/index.php/Docking%20Fees</a></p>
        <h3>Readme.txt</h3>
        <pre>Layne&#39;s Docking Fees
====================
Version 1.6

This is a minor OXP for Oolite-- it adds docking fees based on tech level to all GalCop stations (the fee is 1/2 the system&#39;s tech level, between 0.5 credits for a tech 1 to 7.5 credits at tech 15) as well as some colourful docking messages chosen at random.  Rock hermits and many OXP stations are also included, either as no-cost landing stations (they either offer limited services or poor trading) or in some cases costing more than the main station to dock. (Astrofactories/commie factories cost a bribe to dock with because of the cheaper equipment prices, casinos cost twice as much as the main station because they&#39;re luxury retreats, etc.)  I have attempted to include as many OXP stations as I could find, but the list is by no means complete due to the number of additional stations that are mission-created or in older OXPs.  Thanks to additional station lists provided by Norby, I believe that all OXP stations that exist as of June 2015 have been at least accounted for (Though not all have been given special messages or fees).

Special thanks to phkb for help understanding the structure of the message callbacks; my friend Eris (who does not play Oolite but knows her Javascript very well in-deed).  Thanks to everyone on the Oolite forum who gave me scripting pointers.  Thanks to Norby for the comprehensive list of OXP stations and additional suggestions.

3rd Party interface
-------------------
To add a unique docking message for a specific station use the following code:
    worldScripts[&quot;Docking Fees&quot;].$addFee(&quot;my_station_role&quot;, {fee:20, message:&quot;Welcome to my station, commander! Have a nice day, and thanks for paying your [fee_amt] fee.&quot;});
&quot;my_station_role&quot; must be a role of the station in question.
Possible parameters:
    fee             the fee amount to deduct from the player
    multiplier      a multiplier which is applied to the default fee calculation, allowing you to make your station 
                    more expensive (numbers greater than 1) or cheaper (numbers between 0 and 1) than the default.
    messageKey      the key name of the docking message from descriptions.plist.
    message         the text of the message to be displayed.

Text in &quot;message&quot;, and inside your descriptions.plist messageKey text, can include the following text inserts:
    [fee_amt]       will be replaced by the fee paid by the player.
    [st_name]       will be replaced by the station name where the player is docking.

To disable docking fees for a particular station, use the following code:
    worldScripts[&quot;Docking Fees&quot;].$addFee(&quot;my_station_role&quot;, {messageKey:&quot;&quot;});

This OXP is licensed under Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0).  Please share and enjoy.

History:
4-22-15 1.0
Initial version of script posted on Oolite forum.

4-23-15 1.1
Changes to script by phkb to add support for non-galcop stations.

4-23-15 1.2
OXP (config files, etc.) constructed and messages moved to docking report screen.  Multiple new messages written for galcop and more OXP stations (Commies, Dictators, Feudal, etc.) added.

4-26-15 1.3
First public release of OXP package.

5-7-15  1.4
Corrections to scripting for compatibility with Combat Simulator OXP.  Additional stations (Sentinel, Lave Academy, Training) added to script.  Minor typos corrected in docking report.

6-9-15  1.5
One additional docking message per tech level for a total of fifteen new messages!

6-15-15 1.6
Fee script changed to exclude any station not specifically included in the script (random OXP stations will no longer have docking fees assigned).  Many, many (and did I say many?) new stations have been added to the list, though most have only a generic docking message or none at all.

7-27-15 1.6.1
Bugfix to correct Escape Capsule misbehaviours!

7-2-18 1.6.2
Fixed issue with long decimal values being displayed in arrival messages.
Fixed issue with incorrect role being used for current Black Monks stations.
Added message for Tionisla Orbital Graveyard station.

7-6-21 2.0
Reworked logic to allow for new stations to be added into the system without recoding.
Code refactoring.

8-1-22 2.1
Added currency symbol to arrival text.
Fixed issue of defaulting to main station fee when fee equals 0.</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. 
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. 
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/docking_fee.js</td>
                    <td><pre>// oolite.oxp.Layne.DockingFees
&quot;use strict&quot;;
this.name = &quot;Docking Fees&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;

this._simulator = false; // holding variable to work out whether this launch/dock routine was part of a simulator run
this._escapepod = false;
this._fees = {};

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function () {
	this.$addCoreFees();
}

//-------------------------------------------------------------------------------------------------------------
this.shipLaunchedEscapePod = function (escapepod, passengers) {
	this._escapepod = true;
}

//-------------------------------------------------------------------------------------------------------------
this.shipDockedWithStation = function (station) {
	// if this was a simulator run, reset the variable and return - no docking fee in this case
	if (this._simulator == true) {
		this._simulator = false;
		return;
	}
	// is this a redock after an escape pod
	if (this._escapepod == true) {
		this._escapepod = false;
		return;
	}

	// work out fee based on system tech level and station type
	var f = ((system.techLevel * 0.5) + 0.5);
	var fee = 0;
	var messageKey = &quot;&quot;; //no message by default
	var message = &quot;&quot;;

	// add the current system techlevel, gov and eco to mission variables so they can be referenced by descriptions
	missionVariables.systemTechLevel = system.techLevel;
	missionVariables.systemGovernment = system.government;
	missionVariables.systemEconomy = system.economy;

	if (station.isMainStation) { // main system stations for GalCop
		var def = this._fees[&quot;_default&quot;];
		fee = (def.hasOwnProperty(&quot;fee&quot;) ? def.fee : (def.hasOwnProperty(&quot;multiplier&quot;) ? f * def.multiplier : 0));
		// make sure the &quot;messageKey&quot; value is the same as what you used in the descriptions.plist file
		messageKey = expandDescription(def.messageKey);
		message = def.message;
	}
	
	var roles = Object.keys(this._fees);
	for (var i = 0; i &lt; roles.length; i++) {
		if (station.hasRole(roles[i])) {
			var chk = this._fees[roles[i]];
			fee = (chk.hasOwnProperty(&quot;fee&quot;) ? chk.fee : (chk.hasOwnProperty(&quot;multiplier&quot;) ? f * chk.multiplier : 0));
			messageKey = expandDescription(chk.messageKey);
			message = chk.message;
		}
	}

	if (fee &gt; 0) { // ignore any station not specifically assigned a fee or message
		if (player.credits &gt; fee) { // make sure the player has enough credits
			player.credits -= fee;
		} else {
			player.addMessageToArrivalReport(&quot;Welcome Commander! You seem to be down on your luck, so we&#39;ve waived the docking fee this time.  You can work it off washing dishes in the station commissary!&quot;);
			this.$cleanUp();
			// don&#39;t try to send any other message
			return;
		}
	}
	// display the docking message
	if (messageKey != &quot;&quot; || message != &quot;&quot;) {
		if (messageKey != &quot;&quot;) {
			player.addMessageToArrivalReport(expandDescription(&quot;[&quot; + messageKey + &quot;]&quot;, {
				fee_amt: formatCredits(fee, true, true),
				st_name: station.displayName
			}));
		} else {
			player.addMessageToArrivalReport(expandDescription(messageKey, {
				fee_amt: formatCredits(fee, true, true),
				st_name: station.displayName
			}));
		}
	}
	this.$cleanUp();
}

//-------------------------------------------------------------------------------------------------------------
this.$cleanUp = function() {
	delete missionVariables.systemTechLevel;
	delete missionVariables.systemGovernment;
	delete missionVariables.systemEconomy;
}

//-------------------------------------------------------------------------------------------------------------
// check when the player launches if this is a simulator run
this.shipLaunchedFromStation = function (station) {
	if (this.$simulatorRunning()) this._simulator = true;
}

//-------------------------------------------------------------------------------------------------------------
// routine to check the combat simulator worldscript, to see if it&#39;s running or not
this.$simulatorRunning = function () {
	var w = worldScripts[&quot;Combat Simulator&quot;];
	if (w &amp;&amp; w.$checkFight &amp;&amp; w.$checkFight.isRunning) return true;
	return false;
}

//-------------------------------------------------------------------------------------------------------------
// adds a fee object to the dictionary
// role: the station role to be checked for
// obj is a dictionary with the following options:
//		fee: a simple value to be used for the fee (eg 20) which overrides the default calc
//		multiplier: a multiplier to be applied to the default fee calculation (eg 1.5)
//      messageKey: the key from descriptions.plist that holds the docking message to be added to the arrival report (eg &quot;my_dock_message&quot;)
//		message: the docking message to be added to the arrival report (eg &quot;Welcome to my station, commander!&quot;)
// note: if both messageKey and message are defined, the messageKey will take priority
// note: if no fee or multiplier are specified, but the message keys are defined and not blank, the multiplier will be set to 1, 
// 			which applies a normal fee calculation.
// note: descriptions can include [fee_amt] and [st_name], which will be expanded to be the fee amount and the station name respectively.
// note: to have a station ignored, just specify a blank message. For example: $addFee(&quot;my_station_role&quot;, {message:&quot;&quot;});
this.$addFee = function (role, obj) {
	var newfee = {};

	if (obj.hasOwnProperty(&quot;fee&quot;)) {
		newfee.fee = obj.fee;
	}
	if (obj.hasOwnProperty(&quot;multiplier&quot;)) {
		newfee.multiplier = obj.multiplier;
	}
	if (obj.hasOwnProperty(&quot;messageKey&quot;)) {
		newfee.messageKey = obj.messageKey;
	} else {
		newfee.messageKey = &quot;&quot;;
	}
	if (obj.hasOwnProperty(&quot;message&quot;)) {
		newfee.message = obj.message;
	} else {
		newfee.message = &quot;&quot;;
	}
	if ((!newfee.hasOwnProperty(&quot;fee&quot;) || newfee.fee == 0) &amp;&amp; (!newfee.hasOwnProperty(&quot;multiplier&quot;) || newfee.multiplier == 0) &amp;&amp; (newfee.messageKey != &quot;&quot; || newfee.message != &quot;&quot;)) {
		newfee.multiplier = 1;
	}

	this._fees[role] = newfee;
}

//-------------------------------------------------------------------------------------------------------------
this.$addCoreFees = function () {
	this.$addFee(&quot;_default&quot;, {messageKey: &quot;dockfee_[mission_systemTechLevel]&quot;}); // default for main stations
	this.$addFee(&quot;rockhermit&quot;, {fee: 0, messageKey: &quot;dockfee_rock&quot;}); // rockhermits are free, must be before astromine
	this.$addFee(&quot;sfep_station&quot;, {multiplier: 0.5, messageKey: &quot;dockfee_[mission_systemTechLevel]&quot;}); // stations for extra planets are cheaper to visit than main station
	this.$addFee(&quot;constore&quot;, {fee: 0, messageKey: &quot;dockfee_store&quot;}); // con stores are free for encouraging customers
	this.$addFee(&quot;smivs_pizza_giftshop&quot;, {messageKey: &quot;&quot;}); // space-pizza charges a fee of its own, so no dock message
	this.$addFee(&quot;oolite-tutorial-station&quot;, {messageKey: &quot;&quot;}); // the training station in the tutorial; no fee or message
	this.$addFee(&quot;rrs-plague-mine&quot;, {messageKey: &quot;&quot;}); // plague mine, free docking for medical couriers
	this.$addFee(&quot;random_hits_any_spacebar&quot;, {multiplier: 1.5, messageKey: &quot;dockfee_spacebar&quot;}); // space bars are a little bit more expensive
	this.$addFee(&quot;rrs_group_spacestation&quot;, {fee: 0, messageKey: &quot;dockfee_RSS&quot;}); // rescue stations are free
	this.$addFee(&quot;casinoship&quot;, {multiplier: 2, messageKey: &quot;dockfee_hoopy&quot;}); // casinos are a bit more expensive
	this.$addFee(&quot;wildShips_kiota&quot;, {multiplier: 1.3, messageKey: &quot;dockfee_kiota&quot;}); // kiota ships are a little bit more expensive
	this.$addFee(&quot;rrs-mining-outpost&quot;, {fee: 0,	messageKey: &quot;dockfee_mining&quot;}); // mining outposts are free
	this.$addFee(&quot;free_trade_zone&quot;, {fee: 0, messageKey: &quot;dockfee_FTZ&quot;}); // free trade zones charge huge fuel prices in lieu of fee
	this.$addFee(&quot;astromine&quot;, {fee: 20, messageKey: &quot;dockfee_astromine&quot;}); // penal colonies require a fair bribe to enter
	this.$addFee(&quot;comczgf&quot;, {multiplier: 2.5, messageKey: &quot;dockfee_ZGF&quot;}); // Zero-G-Factories require a small bribe to enter
	this.$addFee(&quot;comslapu&quot;, {multiplier: 2.5, messageKey: &quot;dockfee_SLAPU&quot;}); // SLAPU collectives require a small bribe to enter
	this.$addFee(&quot;astrofactory&quot;, {multiplier: 2, messageKey: &quot;dockfee_astrofactory&quot;}); // imperial factories require a small bribe to enter
	this.$addFee(&quot;laveAcademy_academy&quot;, {fee: 0, messageKey: &quot;dockfee_laveacademy&quot;}); // Lave Academy is free as a public service
	this.$addFee(&quot;anarchies_sentinel_station&quot;, {fee: 0, messageKey: &quot;dockfee_secom&quot;}); // Sentinel Stations are free naval bases
	this.$addFee(&quot;anarchies_renegade_station&quot;, {messageKey: &quot;&quot;}); // renegade stations have their own penalties for docking
	this.$addFee(&quot;anarchies_hacker_outpost&quot;, {fee: 0, messageKey: &quot;dockfee_hackers&quot;}); // if you can find them, hacker outposts are free
	this.$addFee(&quot;anarchies_salvage_gang&quot;, {multiplier: 2, messageKey: &quot;dockfee_salvager&quot;}); // salvage gangs need a bribe to grease the wheels
	this.$addFee(&quot;navystat&quot;, {fee: 0, messageKey: &quot;dockfee_secom&quot;}); // navy stations are free (your tax dollars at work)
	this.$addFee(&quot;behemoth&quot;, {fee: 0, messageKey: &quot;dockfee_behemoth&quot;}); // behemoths are free
	this.$addFee(&quot;liners_liner&quot;, {fee: 0, messageKey: &quot;dockfee_liner&quot;}); // passenger liners are free
	this.$addFee(&quot;feudal-hunting-lodge&quot;, {fee: 0, messageKey: &quot;dockfee_hunting&quot;}); // royal lodges are free
	this.$addFee(&quot;planetFall_surface&quot;, {multiplier: 1.2, messageKey: &quot;dockfee_planet&quot;}); // planets are slightly more to discourage spacers
	this.$addFee(&quot;monkbranch&quot;, {fee: 0, messageKey: &quot;dockfee_monks&quot;}); // black monk monasteries are free
	this.$addFee(&quot;blackmonk_monastery&quot;, {fee: 0, messageKey: &quot;dockfee_monks&quot;});
	this.$addFee(&quot;taxi_station&quot;, {multiplier: 0.5, messageKey: &quot;dockfee_taxi&quot;}); // taxi stations just charge for the parking
	this.$addFee(&quot;aquatics_HQ&quot;, {fee: 0, messageKey: &quot;dockfee_aquatica&quot;}); //Aquatics Shipyards are free to dock with
	this.$addFee(&quot;GRS-Station&quot;, {fee: 0, messageKey: &quot;dockfee_buoystat&quot;}); //BuoyRepair HQ is free to dock with
	this.$addFee(&quot;pagroove_superhub&quot;, {multiplier: 2, messageKey: &quot;dockfee_suphub&quot;}); //Superhubs are expensive to dock with
	this.$addFee(&quot;toriA&quot;, {multiplier: 1.2, messageKey: &quot;dockfee_[mission_systemTechLevel]&quot;}); //Torus station cost more than standard GalCop stations
	this.$addFee(&quot;toriB&quot;, {multiplier: 1.2, messageKey: &quot;dockfee_[mission_systemTechLevel]&quot;}); //Torus station cost more than standard GalCop stations
	this.$addFee(&quot;dredgers&quot;, {fee: 0, messageKey: &quot;dockfee_dredgj&quot;}); //Deep Space Dredger are free to dock with, if you can find one
	this.$addFee(&quot;globestation&quot;, {multiplier: 1.5, messageKey: &quot;dockfee_[mission_systemTechLevel]&quot;}); //Globe stations are more expensive to dock with
	this.$addFee(&quot;globestationxl&quot;, {multiplier: 1.5, messageKey: &quot;dockfee_[mission_systemTechLevel]&quot;}); //Globe stations are more expensive to dock with

	this.$addFee(&quot;tgy_station&quot;, {messageKey: &quot;dockfee_togy&quot;}); // tionisla orbital graveyard
	this.$addFee(&quot;togy_station&quot;, {messageKey: &quot;dockfee_togy&quot;}); // tionisla orbital graveyard
	this.$addFee(&quot;baakili-fartrader&quot;, {multiplier: 0.5, messageKey: &quot;dockfee_short&quot;}); //Baakili Far Trader
	this.$addFee(&quot;bh01&quot;, {multiplier: 0.5, messageKey: &quot;dockfee_short&quot;}); //Bulk Haulers
	this.$addFee(&quot;broadcast_array&quot;, {messageKey: &quot;&quot;}); //Tionisla Chronicle Array - ignore
	this.$addFee(&quot;cb68_sodalite_station-riredi-coluber&quot;, {messageKey: &quot;dockfee_short&quot;}); //Riredi
	this.$addFee(&quot;draven_c&quot;, {messageKey: &quot;dockfee_short&quot;}); //Draven Carrier
	this.$addFee(&quot;draven_st&quot;, {messageKey: &quot;dockfee_short&quot;}); //Draven Oodulldoff Station
	this.$addFee(&quot;habmk2&quot;, {messageKey: &quot;dockfee_short&quot;}); //Zieman&#39;s Habitat Station
	this.$addFee(&quot;kihq&quot;, {messageKey: &quot;dockfee_short&quot;}); //Koneko Industries OXP
	this.$addFee(&quot;mandotech-main-station&quot;, {messageKey: &quot;dockfee_short&quot;}); //MandotechStation Shipyard
	this.$addFee(&quot;medusa&quot;, {messageKey: &quot;dockfee_short&quot;}); //Nuit Space Station OXP
	this.$addFee(&quot;PAGroove-Orisis&quot;, {messageKey: &quot;dockfee_short&quot;}); //Orisis
	this.$addFee(&quot;ryan_villa&quot;, {fee: 0, messageKey: &quot;&quot;}); //Ryan&#39;s Villa - ignore
	this.$addFee(&quot;SIRF-YARD&quot;, {messageKey: &quot;dockfee_short&quot;}); //S.I.R.F.
	this.$addFee(&quot;sothis&quot;, {messageKey: &quot;dockfee_short&quot;}); //SothisTC
	this.$addFee(&quot;taranis&quot;, {messageKey: &quot;dockfee_short&quot;}); //Taranis
	this.$addFee(&quot;tianve-pulsar-station&quot;, {messageKey: &quot;dockfee_short&quot;}); //Tianve and Navy Station
	this.$addFee(&quot;transhabstation&quot;, {messageKey: &quot;dockfee_short&quot;}); //Transhab station
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
