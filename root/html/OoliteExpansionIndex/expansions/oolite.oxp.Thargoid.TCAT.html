<html>
    <head>
        <title>Expansion To Catch a Thargoid</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion To Catch a Thargoid</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">18 Equipment</a></li>
          <li><a href="#ships">69 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">19 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER E)(&#39;[]&#39; vs &#39;[equipment, ships, mission]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Mission set in Galaxy 3 for Dangerous or above rank Commanders. Follow-up to Thargoid Plans.</td>
                    <td>Mission set in Galaxy 3 for Dangerous or above rank Commanders. Follow-up to Thargoid Plans.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.TCAT</td>
                    <td>oolite.oxp.Thargoid.TCAT</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>To Catch a Thargoid</td>
                    <td>To Catch a Thargoid</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Missions</td>
                    <td>Missions</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.11</td>
                    <td>1.11</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>equipment, ships, mission</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/TCAT_OXP">http://wiki.alioth.net/index.php/TCAT_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/3/3a/TCAT_1.11.oxz">https://wiki.alioth.net/img_auth.php/3/3a/TCAT_1.11.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873275</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/To%20Catch%20a%20Thargoid'>http://wiki.alioth.net/index.php/To%20Catch%20a%20Thargoid</a></p>
        <h3>TCAT v1.11 Readme &amp; License.txt</h3>
        <pre>&quot;To Catch a Thargoid&quot; OXP by Thargoid.

A new mission based in Galaxy 3, as a follow-on and sequel to Thargoid Plans. The bugs are back and looking for revenge.

In addition to the mission, this OXP adds several new alien ships plus the response from the Galactic Navy Intelligence to their increased threat - the fearsome Raptor assault strike frigates. 

The Raptors plus a selection of the new Thargoid craft are added generally to the game mix, regardless of galaxy or mission status (if the mission is completed the relevant script parts are automatically removed and do not slow the game). Some may make things a little tougher, but others may come to your rescue!


Requirements -

This OXP is scripted for Oolite v1.75 or later, and will not run on any earlier versions of the game. 

The mission is set in Galaxy 3, and requires the player to have at least 1500 kills to their name and to have completed the &quot;Thargoid Plans&quot; trunk mission. If these conditions are met then the mission may randomly be offered on docking, after which time detailed instructions are provided in mission screens with pointers via the manifest (F5-F5) screen.

--------------------------------------------------------------

License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement. Basically if it&#39;s unique or would identify or overwrite anything in the original OXP, then you may not re-use it (for obvious compatibility reasons).
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* The license information (either as this file or merged into a larger one) must be included in the OXP.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)

--------------------------------------------------------------

Instructions:

Unzip the file, and then move the folder &quot;TCAT 1.11.oxp&quot; to the AddOns directory of your Oolite installation. Then start the game up and the ships should be added. 

Version history:

18/05/2010 - Version 1.00, Initial (semi-beta) release, prior to 1.74 test release.
15/06/2010 - Version 1.01, small bugfix (don&#39;t try and use the same mission variable for two different purposes!)
16/06/2010 - Version 1.02, two more small fixes (self-correction of 1.00 bug and adding Navy station if save-game in same system).
19/06/2010 - Version 1.03, a couple more small tweaks, plus made the final stage of the mission tougher (no more cloaking device cheating!).
14/07/2010 - Version 1.04, a minor tweak to shipdata.plist to make Raptor turrets actually do some damage!
23/12/2010 - Version 1.05, minor code tweak to ensure Mantis appears even if player goes and saves/restarts during invasion.
13/02/2011 - Version 1.06, removal of upper limit, to allow running with 1.75
19/02/2011 - Version 1.10, 1.75 release. ECM Jammer now equipment-key controlled, and AI glitch fixed in general Thargoid AI.
15/04/2012 - Version 1.11, update of thargoidAI due to recursion frustration issue.

--------------------------------------------------------------

Acknowledgements:

With thanks to another_commander, Ahruman, Eric Walch, PAGroove and a whole host of others for various inputs and suggestions during the long period that this OXP has been brewing.

And special thanks to UK_Eliter for last-minute playtesting and suggestions for 1.03 improvements</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_CLEARPYLONS.html">Dump all pylon mounted weapons</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_DISABLED_ECM.html">Disabled ECM System</a></td>
                    <td>yes</td>
                    <td align="right">1</td>
                    <td align="center">100+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_DUMMY_MINE.html">Quirium Cascade Mine</a></td>
                    <td>yes</td>
                    <td align="right">25000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_DUMMY_MISSILE.html">ECM Hardened Missile</a></td>
                    <td>yes</td>
                    <td align="right">3500</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_DUMMY_NEU.html">Naval Energy Unit</a></td>
                    <td>yes</td>
                    <td align="right">400000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_DUMMY_SHIELDS.html">Military Shield Enhancement</a></td>
                    <td>yes</td>
                    <td align="right">400000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_ECM_JAMMER.html">E.C.M. Jammer</a></td>
                    <td>yes</td>
                    <td align="right">50000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_EU_FIXGRADE.html">Energy Unit Upgrade</a></td>
                    <td>yes</td>
                    <td align="right">200000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_EU_UPGRADE.html">Energy Unit Upgrade</a></td>
                    <td>yes</td>
                    <td align="right">200000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_FREE_JAMMER_MINE.html">Thargon Jammer Mine</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_FREE_MINE.html">Quirium Cascade Mine</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_FREE_MISSILE.html">ECM Hardened Missile</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_JAMMER_MINE.html">Thargon Jammer Mine</a></td>
                    <td>yes</td>
                    <td align="right">10000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_MANTIS_FLEET_MISSILE.html">Fleet of ships for the Mantis Dreadnaught</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">101+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_NEU_REPAIR.html">Naval Energy Unit Repair</a></td>
                    <td>yes</td>
                    <td align="right">50000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_NPC_DRONE_MISSILE.html">NPC Thargon Drone</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">101+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_NPC_NAILBOMB_MISSILE.html">NPC Nailbomb Missile</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">101+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_TCAT_NPC_TRIDENT_MISSILE.html">NPC Trident Missile</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">101+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_armadaInterceptor.html">Thargoid Interceptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_armadaWarship.html">Thargoid Pathfinder</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_blastDoor.html">Station Blast Shield</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_blueCircuitRaptor.html">TCAT_blueCircuitRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_bugBase.html">Thargoid Guard Outpost</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_bugStation.html">Thargoid Spy Station</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_burningFuel.html">Burning witchspace fuel</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_circuitRaptor.html">TCAT_circuitRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_claw.html">Raptor&#39;s Claw Mine</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_controller0.html">Thargoid Controller</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_controller10.html">TCAT_controller10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_controller5.html">TCAT_controller5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_controllerDrone.html">Thargoid Defence Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_darkRaptor.html">TCAT_darkRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_defenseRaptor.html">Raptor Defense Interceptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_drone.html">Thargoid Defence Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_dummy_mine.html">TCAT_dummy_mine</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_dummy_missile.html">TCAT_dummy_missile</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_freeOrbiter.html">Kamikaze Orbiter</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_goldRaptor.html">TCAT_goldRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_greenCircuitRaptor.html">TCAT_greenCircuitRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_grooveRaptor.html">TCAT_grooveRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_guard.html">Thargoid Guardian</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_guardRot.html">Thargoid Guardian</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_gunTower.html">Asteroid</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_interceptor.html">Thargint Robot Interceptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_interceptorLeft.html">Thargoid Interceptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_interceptorRight.html">Thargoid Interceptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_jammer.html">Thargon Jamming Mine</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_jumpGate.html">Thargoid Jumpgate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_largeWreckage.html">Wreckage</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_lightRaptor.html">TCAT_lightRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_mantis.html">Thargoid Mantis Dreadnaught</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_mantisFLL.html">Mantis Sub-Ent Front Lower Left</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_mantisFLR.html">Mantis Sub-Ent Front Lower Right</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_mantisFUL.html">Mantis Sub-Ent Front Upper Left</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_mantisFUR.html">Mantis Sub-Ent Front Upper Right</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_mantisRLL.html">Mantis Sub-Ent Rear Lower Left</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_mantisRLR.html">Mantis Sub-Ent Rear Lower Right</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_mantisRUL.html">Mantis Sub-Ent Rear Upper Left</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_mantisRUR.html">Mantis Sub-Ent Rear Upper Right</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_nail.html">Explosive Fragment</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_nailBomb.html">Thargoid Projectile</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_navyBeacon.html">Naval Marker Beacon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_navyStation.html">Navy Intelligence Station</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_orbiter.html">Thargoid Orbiter</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_raptor.html">Raptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_redCircuitRaptor.html">TCAT_redCircuitRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_rockLaser.html">Mantis Laser Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_rockTurret.html">Turret Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_smallWreckage.html">Wreckage</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_sneak.html">Thargoid Sneak Courier</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_squadBlueCircuitRaptor.html">TCAT_squadBlueCircuitRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_squadCircuitRaptor.html">TCAT_squadCircuitRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_squadDarkRaptor.html">TCAT_squadDarkRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_squadDrone.html">TCAT_squadDrone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_squadGoldRaptor.html">TCAT_squadGoldRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_squadGreenCircuitRaptor.html">TCAT_squadGreenCircuitRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_squadGrooveRaptor.html">TCAT_squadGrooveRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_squadLightRaptor.html">TCAT_squadLightRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_squadRaptor.html">TCAT_squadRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_squadRedCircuitRaptor.html">TCAT_squadRedCircuitRaptor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_subEntLaser.html">Laser Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_subEntTurret.html">Turret Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_survivingWreckage.html">Wreckage</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_talon.html">Raptor&#39;s Talon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_trident.html">Trident Missile</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_tridentTine.html">Trident Tine</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/TCAT_warship.html">Thargoid Pathfinder</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_base.js</td>
                    <td><pre>this.name					= &quot;TCAT_base&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Thargoid base script.&quot;;
this.version				= &quot;1.0&quot;;

this.shipSpawned = function()
	{
	this.ship.target = player.ship; 
    this.ship.alertCondition = 2;
	
	if(this.scanTimer)
		{
		this.scanTimer.start();
		}
	else
		{
		this.scanTimer = new Timer(this, this.mineScan, 0, 4.75);
		}
	this.launchAllFlag = &quot;NO&quot;;	
	}
	
this.playerWillEnterWitchspace = function()
	{
	if(this.scanTimer)
		{
		this.scanTimer.stop();
		}
	}

this.mineScan = function()
	{
	function TCAT_localMines(entity) { 
	var isWeapon = entity &amp;&amp; entity.isValid &amp;&amp; entity.isWeapon, 
		isActive = entity.AI !== &quot;TCAT_deactivatedAI.plist&quot;, 
		mines = [&quot;EQ_QC_MINE&quot;, &quot;EQ_RMB_CASCADE_MISSILE&quot;, &quot;EQ_RMB_LAW_MISSILE&quot;, &quot;EQ_RMB_OVERRIDE_MISSILE&quot;, 
			&quot;energy-bomb&quot;, &quot;EQ_NUKE2_MISSILE&quot;, &quot;EQ_HARPOON_NUKE2_MISSILE&quot;, &quot;EQ_PHOTON_MISSILE&quot;, &quot;RANDOM_HITS_MINE&quot;], 
		isLocalMine = mines.some(function (mine, i, array) {return entity.hasRole(mine);}); 
	return isWeapon &amp;&amp; isActive &amp;&amp; isLocalMine; 
	} 
	
	this.mineArray = system.filteredEntities(this, TCAT_localMines, this.ship, 25600);
	
	if(this.mineArray.length &gt; 0)
		{
		player.consoleMessage(&quot;Cascade suppression field detected&quot;, 6);
		this.mineArray.forEach(function (mine) 
			{
			mine.setAI(&quot;TCAT_deactivatedAI.plist&quot;); 
			mine.displayName = &quot;Disarmed &quot; + mine.displayName;
			mine.scannerDisplayColor1 = &quot;whiteColor&quot;;
			mine.scannerDisplayColor2 = &quot;whiteColor&quot;;
			}
			)
		}
	}

	this.findNonThargoid = function() 
	{ 
	function targetShips(entity) {return entity.isShip &amp;&amp; !entity.docked &amp;&amp; entity.scanClass != &quot;CLASS_ROCK&quot; &amp;&amp; entity.scanClass != &quot;CLASS_CARGO&quot; &amp;&amp; entity.scanClass != &quot;CLASS_BUOY&quot; &amp;&amp; entity.scanClass != &quot;CLASS_THARGOID&quot; &amp;&amp; !entity.isCloaked &amp;&amp; !entity.hasRole(&quot;thargoid&quot;) &amp;&amp; !entity.hasRole(&quot;thargon&quot;) &amp;&amp; !entity.hasRole(&quot;TCAT_jumpGate&quot;)}; 
	this.nearArray = system.filteredEntities(this, targetShips, this.ship, 25600); 
 
	if(this.nearArray.length &gt; 0)
		{
		this.targetNumber = Math.floor(Math.random() * this.nearArray.length);
		if(this.targetNumber &gt; this.nearArray.length)
			{
			log(this.name + &quot; script error, target number too high - please report&quot;);
			this.targetNumber = 0;
			}
		this.ship.target = this.nearArray[this.targetNumber];
        this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
		}
	else
		{
		this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;)
		}
	}

this.launchAll = function()
	{
	this.launchAllFlag = &quot;LAUNCH&quot;;
	this.launchGuards();
	}
	
this.launchGuards = function()
	{
	this.guardLength = this.ship.subEntities.length;

	if(this.guardLength &gt; 0)
		{
		for(var guardCounter = this.guardLength-1;guardCounter &gt;= 0;guardCounter--)
			{
			if(Math.random() &gt; 0.25 || this.launchAllFlag == &quot;LAUNCH&quot;)
				{
				this.guardPosition = this.ship.subEntities[guardCounter].position;
				this.guardOrientation = this.ship.subEntities[guardCounter].orientation;
				this.ship.subEntities[guardCounter].remove();

				var subGuard = this.ship.spawnOne(&quot;TCAT_guardRot&quot;);
				subGuard.position = this.localToGlobal(this.guardPosition);
				subGuard.orientation = this.guardOrientation.multiply(this.ship.orientation);
				}
			}
		}
	}

this.localToGlobal = function(position)
	{ // sub-ent position is relative to mother, but for swapping we need the absolute global position
	let orientation = this.ship.orientation;
	orientation.w = -orientation.w; // this is needed to get things in the right place for some reason?
	return this.ship.position.add(position.rotateBy(orientation));
	}
	
this.otherShipDocked = function(whom)		
	{	
	if(whom.isPlayer)
		{ // if we&#39;re in the bug station
		mission.runScreen({title: &quot;Right species, wrong place&quot;, messageKey:&quot;TCAT_bugBase&quot;}, this.relaunch);
		}
	}	
	
this.relaunch = function()
	{
	player.ship.launch();
	}
	
this.shipDied = function(who, why)
	{
	if(this.scanTimer &amp;&amp; this.scanTimer.isRunning)
		{
		this.scanTimer.stop();
		}
		
	this.fuelCount = 15 + Math.ceil(Math.random() * 10);
	this.largeCount = 4 + Math.ceil(Math.random() * 3);
	this.smallCount = 5 + Math.ceil(Math.random() * 5);

	system.legacy_addShipsWithinRadius(&quot;TCAT_burningFuel&quot;, this.fuelCount, &quot;abs&quot;, this.ship.position, 10);
	system.legacy_addShipsWithinRadius(&quot;TCAT_smallWreckage&quot;, this.smallCount, &quot;abs&quot;, this.ship.position, 5);

	if(this.largeCount &gt; 0)
		{
		system.legacy_addShipsWithinRadius(&quot;TCAT_largeWreckage&quot;, this.largeCount, &quot;abs&quot;, this.ship.position, 5);
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_bugStation.js</td>
                    <td><pre>this.name					= &quot;TCAT_bugStation&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Thargoid station ship script.&quot;;
this.version				= &quot;1.0&quot;;

function TCAT_localMines(entity) { 
	var isWeapon = entity.isWeapon, 
		isActive = entity.AI !== &quot;TCAT_deactivatedAI.plist&quot;, 
		mines = [&quot;EQ_QC_MINE&quot;, &quot;EQ_RMB_CASCADE_MISSILE&quot;, &quot;EQ_RMB_LAW_MISSILE&quot;, &quot;EQ_RMB_OVERRIDE_MISSILE&quot;, 
			&quot;energy-bomb&quot;, &quot;EQ_NUKE2_MISSILE&quot;, &quot;EQ_HARPOON_NUKE2_MISSILE&quot;, &quot;EQ_PHOTON_MISSILE&quot;, &quot;RANDOM_HITS_MINE&quot;], 
		isLocalMine = mines.some(function (mine, i, array) {return entity.hasRole(mine);}); 
	return isWeapon &amp;&amp; isActive &amp;&amp; isLocalMine; 
	} 
	
function targetShips(entity) {return entity.isShip &amp;&amp; !entity.docked &amp;&amp; entity.scanClass != &quot;CLASS_ROCK&quot; &amp;&amp; entity.scanClass != &quot;CLASS_CARGO&quot; &amp;&amp; !entity.isThargoid &amp;&amp; !entity.isCloaked}; 		

this.shipSpawned = function()
	{
	this.ship.target = player.ship; 
    this.ship.alertCondition = 2;
	if(this.scanTimer)
		{
		this.scanTimer.start();
		}
	else
		{
		this.scanTimer = new Timer(this, this.mineScan, 0, 4.75);
		}
		
	if(this.cavalryTimer)
		{
		this.cavalryTimer.start();
		}
	else
		{
		this.cavalryTimer = new Timer(this, this.addRaptor, 60, 60);
		}	
	this.cavalryChance = 0;
	this.cavalryCount = 0;
	
	missionVariables.TCAT_door = &quot;DROPPED&quot;;
	this.spawnDoor();
	}

this.findNonThargoid = function() 
	{ 
	if(this.ship.target)
		{
		this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
		return;
		}
	
	this.targetArray = system.filteredEntities(this, targetShips, this.ship, 25600); 
 
	if(this.targetArray.length &gt; 0)
		{
		this.targetNumber = Math.floor(Math.random() * this.targetArray.length);
		if(this.targetNumber &gt; this.targetArray.length)
			{
			log(this.name + &quot; script error, target number too high - please report&quot;);
			this.targetNumber = 0;
			}
		this.ship.target = this.targetArray[this.targetNumber];
        this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
		}
	else
		{
		this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;)
		}
	}; 	
	
this.playerWillEnterWitchspace = this.shipDied = function()
	{
	if(this.doorTimer &amp;&amp; this.doorTimer.isRunning)
		{
		this.doorTimer.stop();
		}
	if(this.scanTimer &amp;&amp; this.scanTimer.isRunning)
		{
		this.scanTimer.stop();
		}	
	if(this.cavalryTimer &amp;&amp; this.cavalryTimer.isRunning)
		{
		this.cavalryTimer.stop();
		}	
		
	}


this.mineScan = function()
	{
	this.mineArray = system.filteredEntities(this, TCAT_localMines, this.ship, 25600);
	
	if(this.mineArray.length &gt; 0)
		{
		player.consoleMessage(&quot;Cascade suppression field detected&quot;, 6);
		this.mineArray.forEach(function (mine) 
			{
			mine.setAI(&quot;TCAT_deactivatedAI.plist&quot;); 
			mine.displayName = &quot;Disarmed &quot; + mine.displayName;
			mine.scannerDisplayColor1 = &quot;whiteColor&quot;;
			mine.scannerDisplayColor2 = &quot;whiteColor&quot;;
			}
			)
		}
	
	if(player.ship.isCloaked &amp;&amp; this.ship &amp;&amp; this.ship.position.distanceTo(player.ship.position) &lt; 512000 &amp;&amp; Math.random() &gt; 0.33) // so that the cloak can&#39;t really be used to defeat the mission
		{
		player.ship.removeEquipment(&quot;EQ_CLOAKING_DEVICE&quot;); // done this way rather than by setEquipmentStatus to 
		player.ship.awardEquipment(&quot;EQ_CLOAKING_DEVICE&quot;); // avoid triggering repair bots, repair system or DCN.
		player.consoleMessage(&quot;Cloaking device feedback malfunction!&quot;, 6);
		}
	}

this.addRaptor = function()
	{
	if(Math.random() &lt; this.cavalryChance)
		{
		system.legacy_addShipsAtPrecisely(&quot;TCAT_raptor&quot;, 1, &quot;abs&quot;, this.ship.position.add([2000, 5000, -22000]));
		this.cavalryChance = 0;
		this.cavalryCount += 1;
		}
	else
		{
		this.cavalryChance += 0.1;
		}
	if(this.cavalryCount == 3 || !this.ship || !this.ship.isValid)
		{
		this.cavalryTimer.stop();
		}
	}
	
this.otherShipDocked = function(whom)		
	{	
	if(whom.isPlayer)
		{ // if we&#39;re in the bug station
		mission.runScreen({title: &quot;The Fat Lady Sings&quot;, messageKey:&quot;TCAT_bugStation&quot;}, this.bugBang);
		}
	}

this.stationLaunchedShip = function(whom)
	{
	if(!whom.isPlayer &amp;&amp; missionVariables.TCAT_door == &quot;DROPPED&quot;)
		{
		this.doorTimer = new Timer(this, this.spawnDoor, 2);
		}
	if(whom.isPlayer)
		{
		player.consoleMessage(&quot;Warning - Quirium escape detected in station. Detonation imminent - evacuate the area!&quot;,6);
		this.doorArray = system.shipsWithRole(&quot;TCAT_blastDoor&quot;);
		if(this.doorArray.length &gt; 0)
			{
			this.doorArray[0].remove();
			missionVariables.TCAT_door = &quot;DESTROYED&quot;;
			}
		}
	}
	
this.bugBang = function()
	{
	missionVariables.TCAT_mission = &quot;SUCCESS&quot;;
	mission.setInstructionsKey(&quot;TCAT_shortSuccess&quot;, &quot;TCAT_missionScript&quot;);
	mission.unmarkSystem(168);
	mission.markSystem(138);
	this.ship.switchAI(&quot;TCAT_stationExplodeAI.plist&quot;);
	player.ship.launch();
	}
	
this.spawnDoor = function()
	{
	var blastDoor = this.ship.spawnOne(&quot;TCAT_blastDoor&quot;);
	blastDoor.orientation = this.ship.orientation;
	blastDoor.position = this.ship.position.add(this.ship.orientation.vectorForward().multiply(500));
	missionVariables.TCAT_door = &quot;PRESENT&quot;;
	}

this.dropDoor = function()
	{
	this.doorArray = system.shipsWithRole(&quot;TCAT_blastDoor&quot;);
	if(this.doorArray.length &gt; 0)
		{
		this.doorArray[0].remove();
		missionVariables.TCAT_door = &quot;DROPPED&quot;;
		}		
	this.ship.reactToAIMessage(&quot;LAUNCH_DEFENDER&quot;);	
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_claw.js</td>
                    <td><pre>this.name           = &quot;TCAT_claw&quot;;
this.author         = &quot;Thargoid&quot;;
this.copyright		= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description    = &quot;Ship script for the claw mine&quot;;
this.version        = &quot;1.0&quot;;

this.spawnTalons = function() 
	{ 
	if(player.ship &amp;&amp; this.ship.position.distanceTo(player.ship.position) &lt;25600)
		{
		player.consoleMessage(&quot;Mine launch detected - Raptor&#39;s Claw mine&quot;);
		}
	
	this.talonCount = 4 + Math.ceil(Math.random() * 12);
	function allAlienShips(entity) {return entity.isShip &amp;&amp; entity.scanClass == &quot;CLASS_THARGOID&quot;}; 
	function notThargons(entity) {return !entity.hasRole(&quot;thargon&quot;) &amp;&amp; !entity.hasRole(&quot;tharglet&quot;)};
	var anyAlienShips = system.filteredEntities(this, allAlienShips, this.ship, 25600); 
	var motherShips = anyAlienShips.filter(notThargons);
	
	var loopCounter = 0 ; // reset the counter
	for(loopCounter = 0; loopCounter &lt; this.talonCount; loopCounter++)
		{
		var Talon = this.ship.spawnOne(&quot;TCAT_talon&quot;);
		this.xDistance = ((Math.random() * 10) - 5);
		this.yDistance = ((Math.random() * 10) - 5);
		this.zDistance = ((Math.random() * 10) - 5);
		Talon.position = this.ship.position.add([this.xDistance, this.yDistance, this.zDistance]);

		let launchVector = Talon.position.subtract(this.ship.position).direction(); // unit vector pointing away from the mine
		let angle = Talon.heading.angleTo(launchVector); // angle between current heading and target heading
		let cross = Talon.heading.cross(launchVector).direction(); // set the plane where we should rotate in
		Talon.orientation = Talon.orientation.rotate(cross, -angle);
		
		if(motherShips.length &gt; 0) // if we have Thargoid motherships around, target them in preference
			{
			Talon.target = motherShips[Math.floor(Math.random() * motherShips.length)];
			}
		else
			{
			if(anyAlienShips.length &gt; 0) // if we have something to target
				{
				Talon.target = anyAlienShips[Math.floor(Math.random() * anyAlienShips.length)];
				}
			else
				{
				Talon.explode(); // self destruct if nothing to target
				}
		}	}
	} 

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_door.js</td>
                    <td><pre>this.name		= &quot;TCAT_door&quot;;
this.author       = &quot;Thargoid&quot;;
this.copyright	= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description  = &quot;Script for blast door&quot;;
this.version	= &quot;1.0&quot;;

this.shipDied = function(whom, why)
	{
	if(why != &quot;removed&quot;)
		{
		missionVariables.TCAT_door = &quot;DESTROYED&quot;;
		}		
	}

this.shipBeingAttackedByCloaked = function()
	{
	if(player.ship.isCloaked)
		{
		player.ship.removeEquipment(&quot;EQ_CLOAKING_DEVICE&quot;); // done this way rather than by setEquipmentStatus to 
		player.ship.awardEquipment(&quot;EQ_CLOAKING_DEVICE&quot;); // avoid triggering repair bots, repair system or DCN.
		player.consoleMessage(&quot;Cloaking device feedback malfunction!&quot;, 6);
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_ecmJammer.js</td>
                    <td><pre>this.name					= &quot;ECM_jammerScript&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Script for ECM Jammer&quot;;
this.version				= &quot;1.00&quot;;

function ECMJammer_ecmShips(entity) {return entity.isShip &amp;&amp; (entity.equipmentStatus(&quot;EQ_TCAT_DISABLED_ECM&quot;) === &quot;EQUIPMENT_OK&quot; || entity.equipmentStatus(&quot;EQ_ECM&quot;) === &quot;EQUIPMENT_OK&quot;)};

this.activated = function()
	{	
	if(!this.ecmTimer)
		{
		player.consoleMessage(&quot;ECM Jammer activated&quot;,6);
		this.ecmTimer = new Timer(this, this.disableECM,0,0.25)		
		}
	else
		{
		player.consoleMessage(&quot;ECM Jammer deactivated&quot;,6);
		this.stopTimer();
		}
	}
	
this.stopTimer = this.shipWillEnterWitchspace = this.shipWillDockWithStation = this.shipDied = function()
	{
	if(this.ecmTimer &amp;&amp; this.ecmTimer.isRunning)
		{
		this.enableECM();		
		this.ecmTimer.stop();
		delete this.ecmTimer;
		}
	}

this.disableECM = function()
	{
	player.ship.energy = player.ship.energy - 4;
	if(player.ship.energy &lt; 64)
		{
		player.consoleMessage(&quot;Energy low - deactivating ECM Jammer&quot;, 6);
		this.stopTimer();
		return;
		}
		
	var fullList = system.filteredEntities(this, ECMJammer_ecmShips, player.ship); // all ships in the system with ECM or disabled ECM
	var closeList = system.filteredEntities(this, ECMJammer_ecmShips, player.ship, 25600); // all ships in scanner range with ECM or disabled ECM
	
	if(fullList.length &gt; 0)
		{
		var ecmCounter = 0 ; // reset the counter
		for(ecmCounter = 0;ecmCounter&lt;fullList.length;ecmCounter++)
			{
			fullList[ecmCounter].removeEquipment(&quot;EQ_TCAT_DISABLED_ECM&quot;);
			fullList[ecmCounter].awardEquipment(&quot;EQ_ECM&quot;);
			}
		}

	if(closeList.length &gt; 0)
		{
		var ecmCounter = 0 ; // reset the counter
		for(ecmCounter = 0;ecmCounter&lt;closeList.length;ecmCounter++)
			{
			closeList[ecmCounter].removeEquipment(&quot;EQ_ECM&quot;);
			closeList[ecmCounter].awardEquipment(&quot;EQ_TCAT_DISABLED_ECM&quot;);
			}
		}	
		
	}
	
this.enableECM = function()
	{
	var fullList = system.filteredEntities(this, ECMJammer_ecmShips, player.ship); // all ships in the system with ECM or disabled ECM
	if(fullList.length &gt; 0)
		{
	var ecmCounter = 0 ; // reset the counter
	for(ecmCounter = 0;ecmCounter&lt;fullList.length;ecmCounter++)
			{
			fullList[ecmCounter].removeEquipment(&quot;EQ_TCAT_DISABLED_ECM&quot;);
			fullList[ecmCounter].awardEquipment(&quot;EQ_ECM&quot;);
			}
		}
	}
	
this.equipmentDamaged = this.equipmentDestroyed = function(equipment)
	{	
	if(equipment == &quot;EQ_TCAT_ECM_JAMMER&quot;) // if the jammer&#39;s broken in-flight
		{
		this.stopTimer();
		}
		
	var fullList = system.filteredEntities(this, ECMJammer_ecmShips, player.ship); // all ships in the system with ECM or disabled ECM
	if(fullList.length &gt; 0)
		{
		var ecmCounter = 0 ; // reset the counter
		for(ecmCounter = 0;ecmCounter&lt;fullList.length;ecmCounter++)
			{
			fullList[ecmCounter].removeEquipment(&quot;EQ_TCAT_DISABLED_ECM&quot;);
			fullList[ecmCounter].awardEquipment(&quot;EQ_ECM&quot;);
			}
		}	
		
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_guard.js</td>
                    <td><pre>this.name					= &quot;TCAT_guard&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Thargoid Guardian ship script.&quot;;
this.version				= &quot;1.0&quot;;


this.launchOrbiters = function()
	{
	this.subLength = this.ship.subEntities.length;

	if(this.subLength &gt; 0)
		{
		for(var subCounter = this.subLength-1;subCounter &gt;= 0;subCounter--)
			{
			var subOrientation = this.ship.subEntities[subCounter].orientation;
			var offsetVector = this.ship.subEntities[subCounter].orientation.vectorForward();
			var subOffset = offsetVector.multiply(100);
			this.ship.subEntities[subCounter].remove();

			var orbiter = this.ship.spawnOne(&#39;TCAT_freeOrbiter&#39;);
			orbiter.orientation = subOrientation;
			orbiter.position = this.ship.position.add(subOffset);
			if(this.ship.target) {orbiter.target = this.ship.target;}
			}
		}
	}
	
	this.findNonThargoid = function() 
	{ 
	function targetShips(entity) {return entity.isShip &amp;&amp; !entity.docked &amp;&amp; entity.scanClass != &quot;CLASS_ROCK&quot; &amp;&amp; entity.scanClass != &quot;CLASS_CARGO&quot; &amp;&amp; entity.scanClass != &quot;CLASS_THARGOID&quot; &amp;&amp; !entity.isCloaked &amp;&amp; !entity.hasRole(&quot;thargoid&quot;) &amp;&amp; !entity.hasRole(&quot;thargon&quot;) &amp;&amp; !entity.hasRole(&quot;TCAT_jumpGate&quot;)}; 
	this.nearArray = system.filteredEntities(this, targetShips, this.ship, 25600); 
	this.farArray = system.filteredEntities(this, targetShips, this.ship, 60000); 
 
	if(this.nearArray.length &gt; 0)
		{
		this.targetNumber = Math.floor(Math.random() * this.nearArray.length);
		if(this.targetNumber &gt; this.nearArray.length)
			{
			log(this.name + &quot; script error, target number too high - please report&quot;);
			this.targetNumber = 0;
			}
		this.ship.target = this.nearArray[this.targetNumber];
        this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
		}
	else
		{
		if(this.farArray.length &gt; 0)
			{
			this.ship.target = this.farArray[0]; // set to the closest target off-scanner but in range
			this.ship.reactToAIMessage(&quot;INTERCEPT_TARGET&quot;);
			}
		else
			{
			this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;)
			}
		}
	}

this.checkTarget = function()
	{
	if(this.ship.target &amp;&amp; this.ship.target.scanClass != &quot;CLASS_THARGOID&quot; &amp;&amp; !this.ship.target.hasRole(&quot;thargoid&quot;) &amp;&amp; !this.ship.target.hasRole(&quot;thargon&quot;))
		{
		this.ship.reactToAIMessage(&quot;TARGET_VALID&quot;);
		}
	else
		{
		this.ship.AIState = &quot;LOOK_FOR_TARGETS&quot;;
		}
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_guardRot.js</td>
                    <td><pre>this.name					= &quot;TCAT_guardRot&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Thargoid Guardian ship swap.&quot;;
this.version				= &quot;1.0&quot;;


this.shipSwap = function()
	{	
	var newShip = this.ship.spawnOne(&#39;TCAT_guard&#39;);
	newShip.orientation = this.ship.orientation.rotate(this.ship.orientation.vectorRight(), (0.5 * Math.PI));
	newShip.position = this.ship.position;
	newShip.energy = this.ship.energy;
	if(this.ship.group)
		{
		newShip.group = this.ship.group;
		}
	if(this.ship.target) 
		{
		newShip.target = this.ship.target;
		}
	this.ship.remove();
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_jammer.js</td>
                    <td><pre>this.name           = &quot;TCAT_jammer&quot;;
this.author         = &quot;Thargoid&quot;;
this.copyright		= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description    = &quot;Ship script for Thargon jammer mine&quot;;
this.version        = &quot;1.00&quot;;

this.performJamming = function() 
	{ 
	if(player.ship &amp;&amp; this.ship.position.distanceTo(player.ship.position) &lt;25600)
		{
		player.consoleMessage(&quot;Mine launch - Thargon Jammer mine&quot;);
		}

	function isThargon(entity) 
		{ 
		return (entity.isShip &amp;&amp; (entity.primaryRole == &quot;thargon&quot; || entity.primaryRole == &quot;tharglet&quot; || entity.primaryRole == &quot;CT_thargon&quot;));
    		}

	var thargonArray = system.filteredEntities(this, isThargon, this.ship, 25600)
	if(thargonArray.length &gt; 0)
		{
		var thargCounter = 0 ; // reset the counter
		for(thargCounter = 0; thargCounter &lt; thargonArray.length; thargCounter++)
			{
			this.jamChance = (this.ship.position.distanceTo(thargonArray[thargCounter].position)) / 25600;
			this.diceRole = Math.random();
			if(this.diceRole &gt; this.jamChance)
				{
				thargonArray[thargCounter].switchAI(&quot;TCAT_uncontrolledThargonAI.plist&quot;);
				}
			}
		}
	}

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_jumpGate.js</td>
                    <td><pre>this.name					= &quot;TCAT_jumpGate&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Script for Thargoid jumpgates&quot;;
this.version				= &quot;1.0&quot;;


function TCAT_allGates(entity) {return entity.isShip &amp;&amp; entity != this.ship &amp;&amp; entity.hasRole(&quot;TCAT_jumpGate&quot;)}; // all gates except this one
function TCAT_clients(entity) {return entity.isShip &amp;&amp; !entity.isStation &amp;&amp; entity.primaryRole != &quot;TCAT_gateGuard&quot; &amp;&amp; !entity.isWeapon &amp;&amp; !entity.isRock &amp;&amp; !entity.isCargo &amp;&amp; (!entity.hasOwnProperty(&quot;TCAT_receivingGate&quot;)|| entity.TCAT_receivingGate == null)}; // ships that can use jumpgates (exclude spawned defenders, missiles, mines, asteroids and cargo pods
function TCAT_oldClients(entity) {return entity.isShip &amp;&amp; entity.hasOwnProperty(&quot;TCAT_receivingGate&quot;) &amp;&amp; entity.TCAT_receivingGate != null &amp;&amp; entity.position.distanceTo(this.ship.position) &gt; 500 &amp;&amp; entity.position.distanceTo(this.ship.position) &lt; 5000}; // ships which have come through this gate and are now between 500m and 5km from it

this.shipSpawned = function()
	{
	this.ship.orientation = [1, 0, 0, 0]; // point them all in the same direction, along universal Z.
	this.defenderCount = 10; // max number of defenders that can be launched overall by the gate if attacked
	
	if(this.scanTimer)
		{
		this.scanTimer.start();
		}
	else
		{
		this.scanTimer = new Timer(this, this.shipApproach, 0, 1.0); // scan for jumping ships every 1 second - too long/short?
		}
	}

this.playerWillEnterWitchspace = this.shipDied = function()
	{
	if(this.scanTimer)
		{
		this.scanTimer.stop();
		}
	}

this.shipApproach = function()
	{		
	var pastClients = system.filteredEntities(this, TCAT_oldClients, this.ship, 5000) // if any old clients are around, strip their client status
	if(pastClients.length &gt; 0)
		{
		for(var i = 0; i &lt; pastClients.length; i++)
			{
			pastClients[i].TCAT_receivingGate = null;
			if(pastClients[i].isPlayer) 	
				{
				player.consoleMessage(&quot;Jump gate cleared.&quot;, 6);
				}
			}
		}
	
	var queue = system.filteredEntities(this, TCAT_clients, this.ship, 250); // if there is no-one wanting to jump, end the test
	if(queue.length == 0)
		{
		return;
		}
	
	var gates = system.filteredEntities(this, TCAT_allGates, this.ship); // check whether there is a second gate to receive the jumper
	if(gates.length == 0) 
		{
		if(queue[0].isPlayer) 
			{
			player.consoleMessage(&quot;Jump gate off-line.&quot;, 6);
			}
		return;
		}
	
	if(queue[0].hasOwnProperty(&quot;TCAT_receivingGate&quot;) &amp;&amp; queue[0].TCAT_receivingGate == this.ship) // if the jumper has just arrived, end the test
		{
		return;
		}
	
	if(queue[0].isPlayer)
		{
		player.consoleMessage(&quot;Jump gate activated.&quot;, 6);
		player.ship.target = null;
		}
	queue[0].TCAT_receivingGate = gates[0]; // note the gate that is about to receive the jumper
	queue[0].position = gates[0].position; // move the jumper to the receiving gate
	queue[0].orientation = gates[0].orientation; // re-orient the jumper to point out of the gate
	if(queue[0].AI == &quot;TCAT_useGateAI.plist&quot;)
		{
		queue[0].reactToAIMessage(&quot;JUMPED&quot;);
		}
	}

this.findGates = function()
	{
	var gates = system.filteredEntities(this, TCAT_allGates, this.ship);	
	if(gates.length == 0)
		{
		this.ship.reactToAIMessage(&quot;NO_GATE&quot;);
		}
	else
		{
		this.ship.reactToAIMessage(&quot;GATE_FOUND&quot;);
		}
	};
	
this.underAttack = function()
	{
	if(this.defenderCount &gt; 0 &amp;&amp; worldScripts[&quot;TCAT_masterScript&quot;] &amp;&amp; worldScripts[&quot;TCAT_masterScript&quot;].defenderAllowed())
		{
		var defender = this.ship.spawnOne(&quot;TCAT_gateGuard&quot;);
		defender.position = this.ship.position;
		defender.orientation = this.ship.orientation;
		this.defenderCount -= 1;
		}
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_largeWreck.js</td>
                    <td><pre>this.name 			= &quot;TCAT_largeWreck&quot;; 
this.author 		= &quot;Thargoid&quot;; 
this.copyright		= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description	= &quot;Break-up of larger wreckage into small ones&quot;; 
this.version 		= &quot;1.0&quot;; 

this.shipDied = function()
	{
	this.subSmallCount = (Math.ceil(Math.random() * 5) - 2); // between 0 (-1) and 3 pieces of small wreckage spawned from large one
	if(this.subSmallCount &gt; 0) // if we have a positive amount of small wreckage
		{
		this.ship.spawn(&quot;TCAT_smallWreckage&quot;, this.subSmallCount); // spawn the small wreckage
		}
	this.fuelCount = (Math.ceil(Math.random() * 10)); // between 1-10 burning fuel entities
	this.ship.spawn(&quot;TCAT_burningFuel&quot;, this.fuelCount); // spawn the burning fuel
	delete this.shipDied;
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_mantis.js</td>
                    <td><pre>this.name					= &quot;TCAT_mantis&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Thargoid base script.&quot;;
this.version				= &quot;1.0&quot;;

function TCAT_localMines(entity) { 
	var isWeapon = entity.isWeapon, 
		isActive = entity.AI !== &quot;TCAT_deactivatedAI.plist&quot;, 
		mines = [&quot;EQ_QC_MINE&quot;, &quot;EQ_RMB_CASCADE_MISSILE&quot;, &quot;EQ_RMB_LAW_MISSILE&quot;, &quot;EQ_RMB_OVERRIDE_MISSILE&quot;, 
			&quot;energy-bomb&quot;, &quot;EQ_NUKE2_MISSILE&quot;, &quot;EQ_HARPOON_NUKE2_MISSILE&quot;, &quot;EQ_PHOTON_MISSILE&quot;, &quot;RANDOM_HITS_MINE&quot;], 
		isLocalMine = mines.some(function (mine, i, array) {return entity.hasRole(mine);}); 
	return isWeapon &amp;&amp; isActive &amp;&amp; isLocalMine; 
	} 

function targetShips(entity) {return entity.isShip &amp;&amp; !entity.docked &amp;&amp; entity.scanClass != &quot;CLASS_ROCK&quot; &amp;&amp; entity.scanClass != &quot;CLASS_CARGO&quot; &amp;&amp; !entity.isThargoid &amp;&amp; !entity.isCloaked}; 	
	
this.shipSpawned = function()
	{
	this.armadaGroup = system.addGroup(&quot;TCAT_armada&quot;, 6, this.ship.position, 15000);
	this.armadaGroup.leader = this.ship;
	
	if(this.scanTimer)
		{
		this.scanTimer.start();
		}
	else
		{
		this.scanTimer = new Timer(this, this.mineScan, 0, 4.75);
		}
	this.scrambleFlag = null;
	}
	
this.playerWillEnterWitchspace = function()
	{
	if(this.scanTimer)
		{
		this.scanTimer.stop();
		}
	}

this.checkTarget = function()
	{
	if(this.ship.target &amp;&amp; !this.ship.target.scanClass == &quot;CLASS_THARGOID&quot; &amp;&amp; !this.ship.target.hasRole(&quot;thargoid&quot;) &amp;&amp; !this.ship.target.hasRole(&quot;thargon&quot;))
		{
		this.ship.reactToAIMessage(&quot;TARGET_VALID&quot;);
		}
	else
		{
		this.ship.reactToAIMessage(&quot;NO_TARGET&quot;);
		}
	}

this.mineScan = function()
	{
	this.mineArray = system.filteredEntities(this, TCAT_localMines, this.ship, 25600);
	
	if(this.mineArray.length &gt; 0)
		{
		player.consoleMessage(&quot;Cascade suppression field detected&quot;, 6);
		this.mineArray.forEach(function (mine) 
			{
			mine.setAI(&quot;TCAT_deactivatedAI.plist&quot;); 
			mine.displayName = &quot;Disarmed &quot; + mine.displayName;
			mine.scannerDisplayColor1 = &quot;whiteColor&quot;;
			mine.scannerDisplayColor2 = &quot;whiteColor&quot;;
			}
			)
		}
	}

this.findStation = function()
	{
	this.stationArray = system.shipsWithPrimaryRole(&quot;TCAT_navyStation&quot;);
	if(this.stationArray.length == 0)
		{
		this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;);	
		}
	else
		{
		this.ship.target = this.stationArray[0];
		this.ship.reactToAIMessage(&quot;STATION_FOUND&quot;);
		}
	}
	
this.scramble = function()
		{
		this.scrambleFlag = &quot;LAUNCH&quot;;
		this.launchGuards();
		}
	
this.launchGuards = function()
	{
	this.subLength = this.ship.subEntities.length;
	if(this.subLength == 0)
		{
		return;
		}

	this.guardArray = [];
	for(var guardCounter = 0;guardCounter &lt; this.subLength;guardCounter++)
		{
		if(this.ship.subEntities[guardCounter].hasRole(&quot;TCAT_guardRot&quot;))
			{
			this.guardArray.push(guardCounter);
			}
		}

	if(this.guardArray.length == 0)
		{
		return;
		}

	for(var guardCounter = this.guardArray.length - 1;guardCounter &gt;= 0;guardCounter--)
		{
		if(Math.random() &lt; 0.1 || this.scrambleFlag == &quot;LAUNCH&quot;)
			{
			this.guardPosition = this.ship.subEntities[this.guardArray[guardCounter]].position;
			this.guardOrientation = this.ship.subEntities[this.guardArray[guardCounter]].orientation;
			this.ship.subEntities[this.guardArray[guardCounter]].remove();
			var subGuard = this.ship.spawnOne(&quot;TCAT_guardRot&quot;);
			subGuard.position = this.localToGlobal(this.guardPosition);
			subGuard.orientation = this.guardOrientation.multiply(this.ship.orientation);
			this.armadaGroup.addShip(subGuard);
			}
		}
	}

this.localToGlobal = function(position)
	{ // sub-ent position is relative to mother, but for swapping we need the absolute global position
	let orientation = this.ship.orientation;
	orientation.w = -orientation.w; // this is needed to get things in the right place for some reason?
	return this.ship.position.add(position.rotateBy(orientation));
	}

this.shipEnteredWitchspace = function()
	{
	this.scanTimer.stop();
	if(this.ship.escorts.length &gt; 0) // could we use escortGroup here?
		{
		for(var escortCounter = this.ship.escorts.length - 1;escortCounter &gt;= 0;escortCounter--)
			{
			this.ship.escorts[escortCounter].remove();
			}
		}
	this.ship.remove();
	}
	
this.shipFiredMissile = function(missile, target)
	{
	if(missile.hasRole(&quot;TCAT_guard&quot;) || missile.hasRole(&quot;TCAT_armada&quot;)) // if the mantis launched a ship &quot;missile&quot; add it to the ship group
		{
		this.armadaGroup.addShip(missile);
		}
	}	
	
this.shipDied = function(who, why)
	{
	this.scanTimer.stop();
	
	if(missionVariables.TCAT_mission &amp;&amp; (missionVariables.TCAT_mission == &quot;INCOMING&quot; || missionVariables.TCAT_mission == &quot;ARMADA&quot;))
		{
		missionVariables.TCAT_mission = &quot;REPELLED&quot;;
		}
		
	this.fuelCount = 15 + Math.ceil(Math.random() * 10);
	this.largeCount = 4 + Math.ceil(Math.random() * 3);
	this.smallCount = 5 + Math.ceil(Math.random() * 5);

	system.legacy_addShipsWithinRadius(&quot;TCAT_burningFuel&quot;, this.fuelCount, &quot;abs&quot;, this.ship.position, 10);
	system.legacy_addShipsWithinRadius(&quot;TCAT_smallWreckage&quot;, this.smallCount, &quot;abs&quot;, this.ship.position, 5);

	if(this.largeCount &gt; 0)
		{
		system.legacy_addShipsWithinRadius(&quot;TCAT_largeWreckage&quot;, this.largeCount, &quot;abs&quot;, this.ship.position, 5);
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_masterScript.js</td>
                    <td><pre>this.name					= &quot;TCAT_masterScript&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;WorldScript for TCAT OXP.&quot;;
this.version				= &quot;1.0&quot;;

this.shipExitedWitchspace = function()
	{
	if(missionVariables.TCAT_overRide == true || missionVariables.TCAT_mission == &quot;HUNT&quot;)
		{
		return;
		}

	this.policeCount = system.entitiesWithScanClass(&quot;CLASS_POLICE&quot;).length + system.entitiesWithScanClass(&quot;CLASS_MILITARY&quot;).length; 
	this.thargoidCount = system.entitiesWithScanClass(&quot;CLASS_THARGOID&quot;).length - system.countShipsWithRole(&quot;thargon&quot;); 

	if(this.thargoidCount &gt; 6 || Math.random() &lt; ((this.thargoidCount-this.policeCount) / 10))
		{
		system.legacy_addShips(&quot;TCAT_squadRaptor&quot;, 1);
		return;
		}

	if(this.thargoidCount &gt; 3 || Math.random() &lt; ((this.thargoidCount-this.policeCount) / 5))
		{
		system.legacy_addShips(&quot;TCAT_raptor&quot;, 1);
		}
	}
	
this.playerBoughtEquipment = function(equipment) // swap freebies and dummy equipment for the real thing at naval intel station
	{
	switch(equipment)
		{
		case &quot;EQ_TCAT_DUMMY_MINE&quot;:
		case &quot;EQ_TCAT_FREE_MINE&quot;:
			{
			player.ship.removeEquipment(&quot;EQ_TCAT_DUMMY_MINE&quot;);
			player.ship.removeEquipment(&quot;EQ_TCAT_FREE_MINE&quot;);
			player.ship.awardEquipment(&quot;EQ_QC_MINE&quot;);
			break;
			}

		case &quot;EQ_TCAT_DUMMY_MISSILE&quot;:	
		case &quot;EQ_TCAT_FREE_MISSILE&quot;:
			{
			player.ship.removeEquipment(&quot;EQ_TCAT_DUMMY_MISSILE&quot;);
			player.ship.removeEquipment(&quot;EQ_TCAT_FREE_MISSILE&quot;);
			player.ship.awardEquipment(&quot;EQ_HARDENED_MISSILE&quot;);
			break;
			}		
				
		case &quot;EQ_TCAT_DUMMY_NEU&quot;:
			{ // as the mission can&#39;t run without Thargoid Plans being completed, the player must have access to this anyway.
			player.ship.removeEquipment(&quot;EQ_TCAT_DUMMY_NEU&quot;);
			if (player.ship.equipmentStatus(&quot;EQ_ENERGY_UNIT&quot;) != &quot;EQUIPMENT_UNAVAILABLE&quot;)
				{
				player.ship.setEquipmentStatus(&quot;EQ_ENERGY_UNIT&quot;, &quot;EQUIPMENT_OK&quot;);
				player.ship.removeEquipment(&quot;EQ_ENERGY_UNIT&quot;);
				}
			player.ship.awardEquipment(&quot;EQ_NAVAL_ENERGY_UNIT&quot;);
			break;
			}	
		
		case &quot;EQ_TCAT_DUMMY_SHIELDS&quot;:
			{ 
			player.ship.removeEquipment(&quot;EQ_TCAT_DUMMY_SHIELDS&quot;);
			player.ship.awardEquipment(&quot;EQ_NAVAL_SHIELD_BOOSTER&quot;);
			break;
			}			
		
		case &quot;EQ_TCAT_CLEARPYLONS&quot;:
			{
			player.ship.removeEquipment(&quot;EQ_TCAT_CLEARPYLONS&quot;);
			this.credits = player.credits;
			player.ship.awardEquipment(&quot;EQ_MISSILE_REMOVAL&quot;);
			player.credits = this.credits;
			break;
			}
		
		case &quot;EQ_TCAT_EU_UPGRADE&quot;:
		case &quot;EQ_TCAT_EU_FIXGRADE&quot;:
			{
			player.ship.removeEquipment(&quot;EQ_TCAT_EU_UPGRADE&quot;);
			player.ship.removeEquipment(&quot;EQ_ENERGY_UNIT&quot;);
			player.ship.awardEquipment(&quot;EQ_NAVAL_ENERGY_UNIT&quot;);
			}

			case &quot;EQ_TCAT_NEU_REPAIR&quot;:
			{
			player.ship.removeEquipment(&quot;EQ_TCAT_NEU_REPAIR&quot;);
			player.ship.awardEquipment(&quot;EQ_NAVAL_ENERGY_UNIT&quot;);
			}
		
		}
	}	
	
// Code below is used by ship scripts 

this.jammerTime = clock.absoluteSeconds // for use of spacing Raptor Jammer Mine launches by ship scripts to min of 60s. 
this.clawTime = clock.absoluteSeconds // for use of spacing Raptor Claw Mine launches by ship scripts to min of 120s. 
this.defenderTime = clock.absoluteSeconds // for use of spacing jumpgate defender launches by ship scripts to min of 20s. 

this.jammerAllowed = function() 
	{ 
	if((clock.absoluteSeconds - this.jammerTime) &gt; 60) 
		{ 
		this.jammerTime = clock.absoluteSeconds; 
		return true; 
		} 
	else 
		{
		return false; 
		}
	}

this.clawAllowed = function() 
	{ 
	if((clock.absoluteSeconds - this.clawTime) &gt; 120) 
		{ 
		this.clawTime = clock.absoluteSeconds; 
		return true; 
		} 
	else 
		{
		return false; 
		}
	}

this.defenderAllowed = function() 
	{ 
	if((clock.absoluteSeconds - this.defenderTime) &gt; 20) 
		{ 
		this.defenderTime = clock.absoluteSeconds; 
		return true; 
		} 
	else 
		{
		return false; 
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_missionScript.js</td>
                    <td><pre>this.name					= &quot;TCAT_missionScript&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Mission script for TCAT OXP.&quot;;
this.version				= &quot;1.0&quot;;

this.startUp = function()
	{
	// mission has already been rejected or completed, clean up and remove active script parts
	if(missionVariables.TCAT_mission == &quot;CASE_CLOSED&quot;) 
		{
		this.cleanUp();
		return;
		}
		
	this.warningSound = new SoundSource; 
	this.warningSound.sound = &quot;TCAT_alert.ogg&quot;;
	this.warningSound.loop = false;
	 
	//initialise mission variables
	if(!missionVariables.TCAT_sneakCount)
		{
		missionVariables.TCAT_sneakCount = 0;
		}
		
	if(!missionVariables.TCAT_missionBlock)
		{
		missionVariables.TCAT_missionBlock = false;
		}

	if(!missionVariables.TCAT_navalStatus || (missionVariables.TCAT_navalStatus != &quot;ALIVE&quot; &amp;&amp; missionVariables.TCAT_navalStatus != &quot;DEAD&quot;))
		{
		missionVariables.TCAT_navalStatus = &quot;ALIVE&quot;;
		}
	}
	
this.cleanUp = function() // get rid of active script elements if no longer needed.
		{
		delete this.shipLaunchedFromStation;
		delete this.playerEnteredNewGalaxy;
		delete this.playerExitedWitchspace;
		delete this.missionScreenOpportunity;
		delete this.playerBoughtNewShip;
		delete this.playerWillEnterWitchspace;
		mission.setInstructionsKey(null, &quot;TCAT_missionScript&quot;);
		return;
		}
	
this.playerBoughtNewShip = function(ship)
		{ // if player buys a new ship after the device is fitted, stop the mission
		if(missionVariables.TCAT_mission == &quot;SNEAK&quot; 
			|| missionVariables.TCAT_mission == &quot;CAUGHT&quot; 
			|| missionVariables.TCAT_mission == &quot;INCOMING&quot; 
			|| missionVariables.TCAT_mission == &quot;ARMADA&quot; 
			|| missionVariables.TCAT_mission == &quot;REPELLED&quot; 
			|| missionVariables.TCAT_mission == &quot;HUNT&quot;)
			{
			player.consoleMessage(&quot;Naval intelligence device self-destructed!&quot;, 6);
			missionVariables.TCAT_mission = &quot;CASE_CLOSED&quot;;
			this.cleanUp();
			}
		}
	
this.missionScreenOpportunity = function()
	{	
	// next check if we have any conditions preventing the offering or continuing of the mission
	if(!player.ship.docked // we&#39;re in space
			|| player.score &lt; 1500 // need 1500 kills to begin (for a little space between this and Thargoid Plans)
			|| galaxyNumber != 2 // we&#39;re not in G3
			|| !missionVariables.thargplans // Thargoid Plans mission never started
			|| missionVariables.thargplans != &quot;MISSION_COMPLETE&quot; // Thargoid Plans mission not completed
			|| missionVariables.TCAT_mission == &quot;NOT_NOW&quot; // player rejected mission and it&#39;s not time to re-offer yet
			|| (Math.random() &gt; 0.25 &amp;&amp; missionVariables.TCAT_mission == &quot;OFFER&quot;) // only 1 in 4 chance of initial offer anyway
			) 
		{
		return;
		}
	
	if(player.ship.dockedStation.isMainStation &amp;&amp; system.ID != 138) // initial offering in system main station, as long as it&#39;s not Anenveza.
		{	
		switch(missionVariables.TCAT_mission)
			{
			case &quot;OFFER&quot;: // make the initial offer
				{
				mission.runScreen({title: &quot;Hide and Sneak&quot;, messageKey:&quot;TCAT_initialOffer&quot;, choicesKey:&quot;TCAT_choices&quot;}, this.choice);
				break;
				}
			case &quot;REJECTED&quot;: // player said no
				{
				missionVariables.TCAT_mission = &quot;NOT_NOW&quot;;
				mission.setInstructionsKey(null, &quot;TCAT_missionScript&quot;);
				missionVariables.TCAT_reOffer = -0.1;
				mission.runScreen({title: &quot;How unfortunate...&quot;, messageKey:&quot;TCAT_rejected&quot;});
				break;
				}
			case &quot;ACCEPTED&quot;: // player said yes
				{
				missionVariables.TCAT_mission = &quot;BRIEFING_1&quot;;
				mission.setInstructionsKey(&quot;TCAT_shortGoToStation&quot;, &quot;TCAT_missionScript&quot;);
				mission.markSystem(138);
				mission.runScreen({title: &quot;Excellent...&quot;, messageKey:&quot;TCAT_accepted&quot;});
				break;
				}
			}
		return;	
		}
	
	if(system.ID == 138 &amp;&amp; (missionVariables.TCAT_mission == &quot;INCOMING&quot; || missionVariables.TCAT_mission == &quot;ARMADA&quot;) &amp;&amp; system.countShipsWithRole(&quot;TCAT_mantis&quot;) == 0)
		{
		system.addShipsToRoute(&quot;TCAT_mantis&quot;, 1, 0.9, &quot;sw&quot;);
		system.addShipsToRoute(&quot;TCAT_squadRaptor&quot;, 1, 0.75, &quot;sw&quot;);
		}
	
	if(player.ship.dockedStation.hasRole(&quot;TCAT_navyStation&quot;))
		{
		switch(missionVariables.TCAT_mission) // offerings once player is at the navy station
			{
			case &quot;BRIEFING_1&quot;: // player accepted and went to military station - start sneak briefing
				{
				missionVariables.TCAT_mission = &quot;BRIEFING_2&quot;;
				mission.unmarkSystem(138);
				mission.runScreen({title: &quot;Briefing&quot;, messageKey:&quot;TCAT_briefing_1&quot;});
				break;
				}
			case &quot;BRIEFING_2&quot;: // briefing second screen
				{
				missionVariables.TCAT_mission = &quot;BRIEFING_3&quot;;
				mission.runScreen({title: &quot;Know your prey&quot;, messageKey:&quot;TCAT_briefing_2&quot;, model:&quot;TCAT_sneak&quot;});
				break;
				}
			case &quot;BRIEFING_3&quot;: // briefing third screen
				{
				if(!missionVariables.TCAT_missionBlock)
					{
					mission.setInstructionsKey(&quot;TCAT_shortHideAndSeek&quot;, &quot;TCAT_missionScript&quot;);
					missionVariables.TCAT_missionBlock = true;
					missionVariables.TCAT_qDept = true; // make the equipment at the station available
					mission.runScreen({title: &quot;Good luck!&quot;, messageKey:&quot;TCAT_briefing_3&quot;});
					}
				break;
				}
			case &quot;SNEAK&quot;: // less than 15 sneaks caught
				{
				if(!missionVariables.TCAT_missionBlock)
					{
					missionVariables.TCAT_missionBlock = true;
					mission.runScreen({title: &quot;More Intelligence Needed&quot;, messageKey:&quot;TCAT_sneak&quot;});
					}	
				break;
				}
			case &quot;CAUGHT&quot;: // 15 sneaks found, next briefing - interrupted by invasion fleet
				{	
				missionVariables.TCAT_mission = &quot;INCOMING&quot;;			
				mission.runScreen({title: &quot;A Plan Revealed&quot;, messageKey:&quot;TCAT_caught&quot;});
				this.warningSound.play()
				if(system.countShipsWithRole(&quot;TCAT_mantis&quot;) == 0)
					{
					system.addShipsToRoute(&quot;TCAT_mantis&quot;, 1, 0.9, &quot;sw&quot;);
					system.addShipsToRoute(&quot;TCAT_squadRaptor&quot;, 1, 0.75, &quot;sw&quot;);
					}
				break;
				}	
			case &quot;INCOMING&quot;: // 15 sneaks found, next briefing - interrupted by invasion fleet
				{
				if(!missionVariables.TCAT_missionBlock)
					{
					missionVariables.TCAT_missionBlock = true;
					mission.setInstructionsKey(&quot;TCAT_shortInvasion&quot;, &quot;TCAT_missionScript&quot;);	
					missionVariables.TCAT_mission = &quot;ARMADA&quot;;			
					player.ship.fuel += 7;
					mission.runScreen({title: &quot;Scramble!&quot;, messageKey:&quot;TCAT_invasion&quot;});
					}
				break;
				}	
			case &quot;ARMADA&quot;: // if we&#39;re back before the invasion is over
				{
				if(!missionVariables.TCAT_missionBlock)
					{	
					player.ship.fuel += 7;
					mission.runScreen({title: &quot;They&#39;re still coming!&quot;, messageKey:&quot;TCAT_armada&quot;});
					missionVariables.TCAT_missionBlock = true;
					}
				break;
				}
			case &quot;REPELLED&quot;: // Invasion fleet repelled, time for the finale
				{
				if(!missionVariables.TCAT_missionBlock)
					{				
					mission.setInstructionsKey(&quot;TCAT_shortEndGame&quot;, &quot;TCAT_missionScript&quot;);
					mission.markSystem(168);
					mission.runScreen({title: &quot;Endgame&quot;, messageKey:&quot;TCAT_repelled&quot;});
					missionVariables.TCAT_mission = &quot;HUNT&quot;;
					missionVariables.TCAT_missionBlock = true;
					}
				break;
				}
			case &quot;HUNT&quot;: // Left for the finale, but back before the kaboom?
				{
				if(!missionVariables.TCAT_missionBlock)
					{	
					mission.runScreen({title: &quot;Back already?&quot;, messageKey:&quot;TCAT_hunt&quot;});
					missionVariables.TCAT_missionBlock = true;
					}
				break;
				}
			case &quot;SUCCESS&quot;: // Sneak station destroyed - job done
				{
				missionVariables.TCAT_mission = &quot;CASE_CLOSED&quot;;
				mission.setInstructionsKey(null, &quot;TCAT_missionScript&quot;);
				mission.unmarkSystem(138);
				player.credits += 50000;
				player.bounty = 0;
				mission.runScreen({title: &quot;Mission Accomplished!&quot;, messageKey:&quot;TCAT_success&quot;},this.cleanUp);
				break;
				}	
			}	
		}
	}
	
this.choice = function(choice)
	{
	switch(choice)
		{
		case &quot;TCAT_1_ACCEPTED&quot;:
			{
			missionVariables.TCAT_mission = &quot;ACCEPTED&quot;;
			break;
			}
		case &quot;TCAT_2_REJECTED&quot;:
			{
			missionVariables.TCAT_mission = &quot;REJECTED&quot;;
			break;
			}
		}
	}
	
this.shipLaunchedFromStation = function()
	{
	switch(missionVariables.TCAT_mission)
		{
		case &quot;BRIEFING_2&quot;:
		case &quot;BRIEFING_3&quot;:
		case &quot;DISMISSED&quot;:
			{ // in case of forced launch during mission screen sequence
			missionVariables.TCAT_mission = &quot;SNEAK&quot;;
			break;
			}
		}	
	missionVariables.TCAT_missionBlock = null;	
	}

this.playerWillEnterWitchspace = function()
	{
	if((missionVariables.TCAT_mission == &quot;ARMADA&quot;) &amp;&amp; galaxyNumber == 3 &amp;&amp; system.ID == 138)
		{ // if the player runs away during the armada attack
		missionVariables.TCAT_mission = &quot;CASE_CLOSED&quot;;
		missionVariables.TCAT_navalStatus = &quot;DEAD&quot;;
		this.cleanUp();
		}
	}
	
this.shipWillLaunchFromStation = function(station) // first launch only
	{
	if(station.isMainStation)
		{
		if(!missionVariables.TCAT_mission) // set the mission up if it&#39;s not defined, but so it won&#39;t trigger on game start-up
			{missionVariables.TCAT_mission = &quot;OFFER&quot;;}	
		this.shipExitedWitchspace();
		
		if(galaxyNumber == 2 &amp;&amp; system.ID == 138 &amp;&amp; missionVariables.TCAT_navalStatus == &quot;ALIVE&quot; &amp;&amp; system.countShipsWithRole(&quot;TCAT_navyStation&quot;) == 0)
			{
			system.addShipsToRoute(&quot;TCAT_navyStation&quot;, 1, 0.5, &quot;sw&quot;);
			}
		
		if(galaxyNumber == 2 &amp;&amp; system.ID == 168 &amp;&amp; missionVariables.TCAT_mission == &quot;HUNT&quot; &amp;&amp; system.countShipsWithRole(&quot;TCAT_bugStation&quot;) == 0)
			{
			this.setUpBugStation(225000, 100000, -4000000);
			return;
			}	
		
		delete this.shipWillLaunchFromStation;
		}
	}
	
this.playerEnteredNewGalaxy	= function(galaxyNumber)
	{ // if we jump galaxies whilst mission is running or after rejection
	if(galaxyNumber == 3 &amp;&amp; missionVariables.TCAT_mission != &quot;OFFER&quot;)
		{
		missionVariables.TCAT_mission = &quot;CASE_CLOSED&quot;;
		missionVariables.TCAT_navalStatus = &quot;DEAD&quot;;
		this.cleanUp();
		}
	}

this.shipWillExitWitchspace = function()
	{
	if(system.isInterstellarSpace || galaxyNumber != 2)
		{
		return;
		}

	if(system.ID == 138 &amp;&amp; missionVariables.TCAT_navalStatus == &quot;ALIVE&quot; &amp;&amp; system.countShipsWithRole(&quot;TCAT_navyStation&quot;) == 0)
		{
		system.addShipsToRoute(&quot;TCAT_navyStation&quot;, 1, 0.5, &quot;sw&quot;);
		return;
		}
		
	if(system.ID == 168 &amp;&amp; missionVariables.TCAT_mission == &quot;HUNT&quot; &amp;&amp; system.countShipsWithRole(&quot;TCAT_bugStation&quot;) == 0)
		{
		this.setUpBugStation(22500, 10000, -400000);
		return;
		}	
	
	this.ambush = (System.infoForSystem(galaxyNumber, system.ID).routeToSystem(System.infoForSystem(galaxyNumber, 168)).route.length - 1) / 6;
	if(missionVariables.TCAT_mission == &quot;HUNT&quot; &amp;&amp; (Math.random() &gt; this.ambush))
		{
		this.ambushDelay = Math.ceil(Math.random() * 6) + 4;
		this.ambushTimer = new Timer(this, function() {this.ambushPlayer(this.ambush);}, this.ambushDelay);
		}
	}
	
this.ambushPlayer = function(ambush)
	{
	system.legacy_addShipsWithinRadius(&quot;TCAT_warship&quot;, (4-Math.ceil(ambush * 3)), &quot;abs&quot;, player.ship.position, 15000);
	player.consoleMessage(&quot;ALERT - Alien ambush in progress!&quot;, 6);
	}
	
this.shipDockedWithStation = function(station)
	{
	if(station.hasRole(&quot;TCAT_navyStation&quot;))
		{
		missionVariables.TCAT_navalEquipment = true;
		}
	else
		{
		missionVariables.TCAT_navalEquipment = false;
		}

	}
	
this.guiScreenChanged = function()
	{
	if(!player.ship.docked || !player.ship.dockedStation.hasRole(&quot;TCAT_navyStation&quot;)) // if we&#39;re not at the navy station
		{ return; }

	// replace marketplace screen with exam offering mission screen
	if(guiScreen == &quot;GUI_SCREEN_MARKET&quot;)
		{
		mission.runScreen({title: &quot;Do we look like Tescoos?&quot;, messageKey: &quot;TCAT_noTrading&quot;});
		}
	}	
	
this.shipExitedWitchspace = function()
	{	
	if(missionVariables.TCAT_mission == &quot;NOT_NOW&quot;)
		{
		missionVariables.TCAT_reOffer += 0.01; // incremental 1% added chance per jump of re-offering the mission
		if(Math.random() &lt; missionVariables.TCAT_reOffer)
			{
			missionVariables.TCAT_mission = &quot;OFFER&quot;;
			}
		}
		
	if(system.isInterstellarSpace || system.sun.isGoingNova || system.sun.hasGoneNova || missionVariables.TCAT_mission != &quot;SNEAK&quot;)
		{ // stop the addition if interstellar space, system is going Nova, or if this part of the mission is not running.
		return;
		}
		
	this.sneakChance = 0.5 - ((system.techLevel + system.government) / 100);
	if(Math.random() &lt; this.sneakChance)
		{
		system.addShipsToRoute(&quot;TCAT_sneak&quot;, 1);
		this.delayedMessage(&quot;Sneak detected - transferring co-ordinates to ASC&quot;, 6, 5);
		}
	}

this.delayedMessage = function(messageString, duration, delay)
	{
	this.messageTimer = new Timer(this, function() {this.displayMessage(messageString, duration);}, delay);
	}
	
this.displayMessage = function(messageString, duration)
	{
	if(messageString)
		{
		if(!duration || duration &lt; 1)
			{
			duration = 6;
			}
		player.consoleMessage(messageString, duration);
		}
	}
	
this.setUpBugStation = function(xPos,yPos,zPos)
	{
	if(!xPos) {xPos = 0;};
	if(!yPos) {yPos = 0;};
	if(!zPos) {zPos = 0;};
	
	system.legacy_addShipsAtPrecisely(&quot;TCAT_bugStation&quot;, 1, &quot;abs&quot;, [xPos, yPos, zPos]);
	system.legacy_addShipsAtPrecisely(&quot;TCAT_bugBase&quot;, 1, &quot;abs&quot;, [xPos-2000, yPos, zPos+1000]);
	system.legacy_addShipsAtPrecisely(&quot;TCAT_bugBase&quot;, 1, &quot;abs&quot;, [xPos+2000, yPos, zPos+1000]);
	system.legacy_addShipsAtPrecisely(&quot;TCAT_bugBase&quot;, 1, &quot;abs&quot;, [xPos+2000, yPos, zPos-24000]);
	system.legacy_addShipsAtPrecisely(&quot;TCAT_bugBase&quot;, 1, &quot;abs&quot;, [xPos-2000, yPos, zPos-24000]);
	system.legacy_addShipsWithinRadius(&quot;TCAT_warship&quot;, 2, &quot;abs&quot;, [xPos, yPos, zPos-24000], 10000);
	
	system.legacy_addShipsAtPrecisely(&quot;TCAT_jumpGate&quot;, 1, &quot;abs&quot;, [xPos+2000, yPos+5000, zPos-48000]); // far jump gate
	system.legacy_addShipsAtPrecisely(&quot;TCAT_jumpGate&quot;, 1, &quot;abs&quot;, [2000, 2000, -100000]); // near jump gate
	
	system.legacy_addShipsAtPrecisely(&quot;TCAT_navyBeacon&quot;, 1, &quot;abs&quot;, [2500, 2500, -80000]); // jump gate marker buoy
	system.legacy_addShipsAtPrecisely(&quot;TCAT_bugBase&quot;, 1, &quot;abs&quot;, [4000, 4000, -98000]); // guard base near jump gate
	system.legacy_addShipsAtPrecisely(&quot;TCAT_raptor&quot;, 1, &quot;abs&quot;, [300, 300, -15000]); // raptor flying about
	
	this.gateRockCount = Math.ceil(Math.random() * 26) + 14; // Between 15 and 40 normal asteroids near the gate
	this.rockCount = Math.ceil(Math.random() * 26) + 94; // Between 95 and 120 normal asteroids
	this.gunCount = Math.floor(this.rockCount / 10); // Between 9 and 12 asteroids with hidden gun emplacements
	this.warshipCount = Math.ceil(Math.random() * 6) + 1; // Between 1 and 7 warships

	system.legacy_addShipsWithinRadius(&quot;asteroid&quot;, this.gateRockCount, &quot;abs&quot;, [xPos, yPos, zPos-24000], 20000);
	
	for(var asteroidCounter = 0;asteroidCounter &lt; this.rockCount;asteroidCounter++)
		{
		this.spawnOffset = new Vector3D.randomDirection().multiply((Math.random() * 44000) + 6000);
		this.newPosition = this.spawnOffset.add([xPos, yPos, zPos]);
		system.legacy_addShipsAtPrecisely(&quot;asteroid&quot;, 1, &quot;abs&quot;, this.newPosition);
		}

	for(var towerCounter = 0;towerCounter &lt; this.gunCount;towerCounter++)
		{
		this.spawnOffset = new Vector3D.randomDirection().multiply((Math.random() * 38000) + 12000);
		this.newPosition = this.spawnOffset.add([xPos, yPos, zPos]);
		system.legacy_addShipsAtPrecisely(&quot;TCAT_gunTower&quot;, 1, &quot;abs&quot;, this.newPosition);
		}
		
	for(var shipCounter = 0;shipCounter &lt; this.warshipCount;shipCounter++)
		{
		this.spawnOffset = new Vector3D.randomDirection().multiply((Math.random() * 38000) + 12000);
		this.newPosition = this.spawnOffset.add([xPos, yPos, zPos]);
		system.legacy_addShipsAtPrecisely(&quot;TCAT_warship&quot;, 1, &quot;abs&quot;, this.newPosition);
		}	
	
	this.spawnOffset = new Vector3D.randomDirection().multiply((Math.random() * 34000) + 6000);
	this.newPosition = this.spawnOffset.add([xPos, yPos, zPos]);
	system.legacy_addShipsAtPrecisely(&quot;TCAT_controller5&quot;, 1, &quot;abs&quot;, this.newPosition);
	};
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_nailBomb.js</td>
                    <td><pre>this.name           = &quot;TCAT_nailBomb&quot;;
this.author         = &quot;Thargoid&quot;;
this.copyright		= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description    = &quot;Ship script for the Thargoid &#39;Nailbomb&#39; missile&quot;;
this.version        = &quot;1.0&quot;;

this.spawnNails = function() 
	{ 
	var loopCounter = 0 ; // reset the counter
	for(loopCounter = 0; loopCounter &lt; 9; loopCounter++)
		{
		var Nail = this.ship.spawnOne(&quot;TCAT_nail&quot;);
		this.xDistance = ((Math.random() * 4) - 2);
		this.yDistance = ((Math.random() * 4) - 2);
		this.zDistance = ((Math.random() * 4) - 2);
		Nail.position = this.ship.position.add([this.xDistance, this.yDistance, this.zDistance]);
		}
	}; 

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_navalStation.js</td>
                    <td><pre>this.name					= &quot;TCAT_navalStation&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Naval station ship script.&quot;;
this.version				= &quot;1.0&quot;;


this.shipSpawned = function()
	{
	if(this.rechargeTimer)
		{
		this.rechargeTimer.start();
		}
	else
		{
		this.rechargeTimer = new Timer(this, this.rechargeStation, 0, 1);
		}
	this.squadsLaunched = 0;
	}

this.rechargeStation = function()
	{
	if(missionVariables.TCAT_mission != &quot;ARMADA&quot; &amp;&amp; this.ship.energy &lt; this.ship.maxEnergy)
		{
		this.ship.energy += 98;
		}
		
	if(missionVariables.TCAT_mission == &quot;ARMADA&quot; &amp;&amp; this.squadsLaunched &lt; 2 &amp;&amp; Math.random() &gt; ((this.ship.energy / this.ship.maxEnergy) + 0.4) )
		{
		this.ship.AIState = &quot;LAUNCH_SQUAD&quot;;
		this.squadsLaunched++;
		}
		
	if(this.ship.missiles.length &lt; this.ship.missileCapacity &amp;&amp; Math.random() &lt; ((this.ship.missileCapacity - this.ship.missiles.length)/(10*this.ship.missileCapacity)))
		{
		this.ship.awardEquipment(&quot;EQ_TCAT_NPC_TRIDENT_MISSILE&quot;);
		}
	}

this.missileCheck = function()
	{
	if(this.ship.missiles.length &gt; 0 &amp;&amp; this.ship.target &amp;&amp; Math.random() &lt; ((this.ship.missileCapacity - this.ship.missiles.length)/(this.ship.missileCapacity)))
		{
		this.ship.fireMissile();
		}
	}
	
this.stationLaunchedShip = function(ship)
	{
	if(ship.isPlayer &amp;&amp; missionVariables.TCAT_mission == &quot;ARMADA&quot;)
		{
		this.ship.AIState = &quot;LAUNCH_SQUAD&quot;;
		delete this.stationLaunchedShip;
		}
	}
	
this.shipDied = function()
	{	
	missionVariables.TCAT_mission = &quot;CASE_CLOSED&quot;;
	missionVariables.TCAT_navalStation = &quot;DEAD&quot;;
	
	this.fuelCount = 35 + Math.ceil(Math.random() * 10);
	this.largeCount = 17 + Math.ceil(Math.random() * 3);
	this.smallCount = 35 + Math.ceil(Math.random() * 5);

	system.legacy_addShipsWithinRadius(&quot;TCAT_burningFuel&quot;, this.fuelCount, &quot;abs&quot;, this.ship.position, 10);
	system.legacy_addShipsWithinRadius(&quot;TCAT_smallWreckage&quot;, this.smallCount, &quot;abs&quot;, this.ship.position, 5);
	system.legacy_addShipsWithinRadius(&quot;TCAT_largeWreckage&quot;, this.largeCount, &quot;abs&quot;, this.ship.position, 5);

	this.playerWillEnterWitchspace();	
	}

this.playerWillEnterWitchspace = function()
	{
	if(this.rechargeTimer &amp;&amp; this.rechargeTimer.isRunning)
		{
		this.rechargeTimer.stop();
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_raptor.js</td>
                    <td><pre>this.name					= &quot;TCAT_raptor&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Raptor class ship script.&quot;;
this.version				= &quot;1.0&quot;;


this.shipSpawned = function()
	{
	if(!worldScripts[&quot;TCAT_masterScript&quot;])
		{
		log(&quot;TCAT Master Script Missing!!!!!!!!&quot;);
		}
	if(this.ship.primaryRole == &quot;TCAT_squadRaptor&quot; || this.ship.primaryRole == &quot;thargoid&quot;)
		{
		this.ship.primaryRole = &quot;TCAT_raptor&quot;;
		}

	this.shipName = expandDescription(&#39;[TCAT_raptorName]&#39;);
	this.ship.displayName = &quot;Raptor - ASF &quot; + this.shipName;
	if(this.ship.hasRole(&quot;TCAT_squadRaptor&quot;))
		{
		this.ship.displayName = &quot;Command  &quot; + this.ship.displayName;
		}

	this.jammerCount = 1 + Math.ceil(Math.random() * 3);
	this.clawCount = Math.floor(Math.random() * 3);
	}

this.dropJammer = function()
	{
	if(this.jammerCount &gt; 0 &amp;&amp; worldScripts[&quot;TCAT_masterScript&quot;] &amp;&amp; worldScripts[&quot;TCAT_masterScript&quot;].jammerAllowed())
		{
		this.ship.ejectItem(&quot;TCAT_jammer&quot;);
		this.jammerCount -= 1;
		}
	}

this.dropClaw = function()
	{
	if(this.clawCount &gt; 0 &amp;&amp; worldScripts[&quot;TCAT_masterScript&quot;] &amp;&amp; worldScripts[&quot;TCAT_masterScript&quot;].clawAllowed())
		{
		this.ship.ejectItem(&quot;TCAT_claw&quot;);
		this.clawCount -= 1;
		}
	}

this.locateThargoids = function()
	{
	this.alienArray = system.entitiesWithScanClass(&quot;CLASS_THARGOID&quot;);
	if(this.alienArray.length == 0)
		{
		this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;);	
		}
	else
		{
		this.ship.target = this.alienArray[0];
		this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
		}
	}
	
this.scanForAliens = function()
	{
	function allShips(entity) {return entity.isShip}; 
	function thargoidMotherships(entity) {return entity.hasRole(&quot;thargoid-mothership&quot;) &amp;&amp; !entity.hasRole(&quot;TCAT_jumpGate&quot;)};
	function jammerMines(entity) {return entity.hasRole(&quot;TCAT_jammer&quot;)}; 
	function clawMines(entity) {return entity.hasRole(&quot;TCAT_claw&quot;)}; 
	function activeThargons(entity) {return entity.scanClass == &quot;CLASS_THARGOID&quot; &amp;&amp; (entity.hasRole(&quot;thargon&quot;) || entity.hasRole(&quot;tharglet&quot;))}; 

	var anyShips = system.filteredEntities(this, allShips, this.ship, 25600);
	this.thargoidCount = anyShips.filter(thargoidMotherships).length; 
	this.thargonCount = anyShips.filter(activeThargons).length;
	this.jammerActive = anyShips.filter(jammerMines).length;
	this.clawActive = anyShips.filter(clawMines).length;

	if(this.jammerCount &gt; 0 &amp;&amp; this.jammerActive == 0 &amp;&amp; this.thargonCount &gt; 0 &amp;&amp; Math.random() &gt; (0.1 + (this.thargonCount * 0.15))) 
		{ 
		this.dropJammer(); 
		} 
		
	if(this.clawCount &gt; 0 &amp;&amp; this.clawActive == 0 &amp;&amp; this.thargoidCount &gt; 0 &amp;&amp; Math.random() &gt; (0.1 + (this.thargoidCount * 0.05))) 
		{ 
		this.dropClaw(); 
		} 	

	if(this.thargoidCount &gt; 0 &amp;&amp; (!this.ship.target || (this.ship.target &amp;&amp; !this.ship.target.scanClass == &quot;CLASS_THARGOID&quot;)))
		{
		this.ship.target = anyShips.filter(thargoidMotherships)[0];
		this.ship.AIState = &quot;ATTACK_SHIP&quot;;
		}
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_sneak.js</td>
                    <td><pre>this.name           = &quot;TCAT_sneak&quot;;
this.author         = &quot;Thargoid&quot;;
this.copyright		= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description    = &quot;Ship script for Thargoid sneak courier.&quot;;
this.version        = &quot;1.0&quot;;

this.shipWasScooped = function(scooper)
	{
	if (scooper.isPlayer)
		{
		missionVariables.TCAT_sneakCount += 1;
		player.consoleMessage(&quot;Thargoid courier captured.&quot;, 6);
		this.enoughData = (missionVariables.TCAT_sneakCount / 10) - 0.5; // chance of having enough data, from -0.5 to 1
		if(Math.random() &lt; this.enoughData) // if we&#39;ve caught enough sneaks now
			{
			player.consoleMessage(&quot;We have sufficient data - please return to the Naval station.&quot;, 10);
			missionVariables.TCAT_mission = &quot;CAUGHT&quot;;
			mission.setInstructionsKey(&quot;TCAT_shortBackToBase&quot;, &quot;TCAT_missionScript&quot;); //  mission note to go back to base
			}
		else
			{
			mission.setInstructionsKey(&quot;TCAT_shortHideAndSeek&quot;, &quot;TCAT_missionScript&quot;); //  update the F5-F5 screen count
			}
		}
	}
	
this.shipExitedWormhole = function()
	{
	if(this.ship.escorts.length &gt; 0)
		{
		for(var escortCounter = this.ship.escorts.length-1;escortCounter &gt;= 0;escortCounter--)
			{
			this.ship.escorts[escortCounter].remove();
			}
		}
	this.ship.remove();
	}
	
this.shipBeingAttacked = function()
	{
	this.shutDownChance = this.ship.energy / this.ship.maxEnergy;
	if(Math.random() &gt; this.shutDownChance)
		{
		this.ship.AIState = &quot;SHUTDOWN&quot;;
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_thargoid.js</td>
                    <td><pre>this.name           = &quot;TCAT_thargoid&quot;;
this.author         = &quot;Thargoid&quot;;
this.copyright		= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description    = &quot;Ship script for general Thargoid vessels&quot;;
this.version        = &quot;1.0&quot;;

this.spawnedAsEscort = function(mother)
	{
	if(mother.isThargoid)
		{
		this.ship.switchAI(&quot;TCAT_escortAI.plist&quot;);
		}
	}

this.findNonThargoid = function() 
	{ 
	if(this.ship.target)
		{
		this.ship.AIState = &quot;ATTACK_SHIP&quot;;
		return;
		}
	
	function targetShips(entity) {return entity.isShip &amp;&amp; !entity.docked &amp;&amp; entity.scanClass != &quot;CLASS_ROCK&quot; &amp;&amp; entity.scanClass != &quot;CLASS_CARGO&quot; &amp;&amp; !entity.isThargoid &amp;&amp; !entity.isCloaked &amp;&amp; entity.primaryRole != &quot;TCAT_jumpGate&quot;}; 
	this.nearArray = system.filteredEntities(this, targetShips, this.ship, 25600); 
	this.farArray = system.filteredEntities(this, targetShips, this.ship, 60000); 
 
	if(this.nearArray.length &gt; 0)
		{
		this.targetNumber = Math.floor(Math.random() * this.nearArray.length);
		if(this.targetNumber &gt; this.nearArray.length)
			{
			log(this.name + &quot; script error, target number too high - please report&quot;);
			this.targetNumber = 0;
			}
		this.ship.target = this.nearArray[this.targetNumber];
        this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
		}
	else
		{
		if(this.farArray.length &gt; 0)
			{
			this.ship.target = this.farArray[0]; // set to the closest target off-scanner but in range
			this.ship.reactToAIMessage(&quot;INTERCEPT_TARGET&quot;);
			}
		else
			{
			this.ship.reactToAIMessage(&quot;FRUSTRATED&quot;)
			}
		}
	}; 

this.validateTarget = function()
	{
	if(this.ship.target &amp;&amp; this.ship.target.scanClass != &quot;CLASS_THARGOID&quot; &amp;&amp; !this.ship.target.hasRole(&quot;thargoid&quot;) &amp;&amp; !this.ship.target.hasRole(&quot;thargon&quot;))
		{
		this.ship.reactToAIMessage(&quot;TARGET_VALID&quot;);
		}
	else
		{
		this.ship.reactToAIMessage(&quot;TARGET_INVALID&quot;);
		}
	}
	
this.findStation = function()
	{
	this.stationArray = system.shipsWithPrimaryRole(&quot;TCAT_navyStation&quot;);
	if(this.stationArray.length == 0)
		{
		this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;);	
		}
	else
		{
		this.ship.target = this.stationArray[0];
		this.ship.reactToAIMessage(&quot;STATION_FOUND&quot;);
		}
	}
	
this.shipDied = function ()
	{
	this.ship.commsMessage(expandDescription(&quot;[thargoid_curses]&quot;));
	};

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/TCAT_trident.js</td>
                    <td><pre>this.name           = &quot;TCAT_trident&quot;;
this.author         = &quot;Thargoid&quot;;
this.copyright		= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description    = &quot;Ship script for the trident missile&quot;;
this.version        = &quot;1.0&quot;;

this.spawnTines = function() 
	{ 
	var loopCounter = 0 ; // reset the counter
	for(loopCounter = 0; loopCounter &lt; 9; loopCounter++)
		{
		var Tine = this.ship.spawnOne(&quot;TCAT_tridentTine&quot;);
		this.xDistance = ((Math.random() * 40) - 20);
		this.yDistance = ((Math.random() * 40) - 20);
		Tine.position = this.ship.position.add([this.xDistance, this.yDistance, 0]);
		Tine.orientation = this.ship.orientation; 
		if(this.ship.target)
			{
			Tine.target = this.ship.target;
			}
		}
	} 

</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
