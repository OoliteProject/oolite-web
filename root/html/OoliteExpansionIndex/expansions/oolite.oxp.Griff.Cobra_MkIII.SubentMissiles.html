<html>
    <head>
        <title>Expansion Subentity Missiles for Griff Cobra MkIII</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Subentity Missiles for Griff Cobra MkIII</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Subentity Missiles for NPC Cobra Mk III. Requires a video card capable of supporting Oolite Shaders.</td>
                    <td>Subentity Missiles for NPC Cobra Mk III. Requires a video card capable of supporting Oolite Shaders.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Griff.Cobra_MkIII.SubentMissiles</td>
                    <td>oolite.oxp.Griff.Cobra_MkIII.SubentMissiles</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Subentity Missiles for Griff Cobra MkIII</td>
                    <td>Subentity Missiles for Griff Cobra MkIII</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Retextures</td>
                    <td>Retextures</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Griff</td>
                    <td>Griff</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.02</td>
                    <td>1.02</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                            <li>oolite.oxp.Griff.Cobra_MkIII:1.04.3</li>
                            <li>oolite.oxp.Griff.Missiles:1.02.1</li>
                            <li>oolite.oxp.Griff_alloys_and_wreckage:1.0</li>
                    </td>
                    <td>
                            <li>oolite.oxp.Griff.Cobra_MkIII:1.04.3</li>
                            <li>oolite.oxp.Griff.Missiles:1.02.1</li>
                            <li>oolite.oxp.Griff_alloys_and_wreckage:1.0</li>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Griff_Industries">http://wiki.alioth.net/index.php/Griff_Industries</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/b/bd/Oolite.oxp.Griff.Cobra_MkIII.SubentMissiles.oxz">https://wiki.alioth.net/img_auth.php/b/bd/Oolite.oxp.Griff.Cobra_MkIII.SubentMissiles.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873455</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Subentity%20Missiles%20for%20Griff%20Cobra%20MkIII'>http://wiki.alioth.net/index.php/Subentity%20Missiles%20for%20Griff%20Cobra%20MkIII</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. 
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. 
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/griff_cobra_III_externalMissiles.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name				= &quot;griff_cobra_III_(alt)_externalMissiles.js&quot;;
this.author				= &quot;Thargoid&quot;;
this.copyright			= &quot;Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.description		= &quot;Generic external missile launching script&quot;;
this.version			= &quot;1.01&quot;;

this.shipSpawned = function()
	{ // just to ensure ship is fully loaded with selected missile type and nothing else
	if(this.ship.scriptInfo.missileRole) // missileRole should be defined in shipdata.plist
		{ this.missileRole = this.ship.scriptInfo.missileRole; }
	else
		{ this.missileRole = &quot;EQ_MISSILE&quot;; } // default to standard missile if not
    
    if (this.ship.scriptInfo.initialMissiles)
        {this.initialMissiles = parseInt(this.ship.scriptInfo.initialMissiles);}
    else
        {this.initialMissiles = this.ship.missileCapacity;};
    
	if (this.ship.missiles.length &gt; 0) this.ship.awardEquipment(&quot;EQ_MISSILE_REMOVAL&quot;); // remove all spawning missiles and restock with selected ones.
	var addCounter = 0; 
	for(addCounter = 0; addCounter &lt; this.initialMissiles;addCounter++)
		{ this.ship.awardEquipment(this.missileRole); }
	}

this.shipFiredMissile = function(missile, target)
	{
	if(!this.ship.subEntities || this.ship.subEntities.length === 0) {return}; // if we&#39;ve run out of sub-ents before we run out of missiles
	
	var subCounter = this.ship.subEntities.length - 1; // Set counter to number of sub-ents minus 1 (as entity array goes up from zero)
	for(subCounter = this.ship.subEntities.length - 1;subCounter&gt;=0;subCounter--)
		{
		if(this.ship.subEntities[subCounter].hasRole(missile.primaryRole)) // if the sub-ent is the same as the missile being fired
			{
			missile.position = this.localToGlobal(this.ship.subEntities[subCounter].position); // move the fired missile to the sub-ent position
			missile.orientation = this.ship.subEntities[subCounter].orientation.multiply(this.ship.orientation); // point the missile in the right direction
			missile.desiredSpeed = missile.maxSpeed;
			this.ship.subEntities[subCounter].remove(); // remove the sub-ent version of the missile
			break; // come out of the loop, as we&#39;ve done our swap
			}
		}
	}

this.localToGlobal = function(position)
	{ // sub-ent position is relative to mother, but for swapping we need the absolute global position
	let orientation = this.ship.orientation;
	return this.ship.position.add(position.rotateBy(orientation));
	}

this.shipTakingDamage = function(amount, fromEntity, damageType)
	{
	if(this.ship.missiles.length === 0 &amp;&amp; this.ship.subEntities.length === 0) // if we&#39;re all out of missiles and any sub-entities, bail out.
		{ return; }
	
	this.missileSubs = 0;
	var subCounter = this.ship.subEntities.length - 1; // Set counter to number of sub-ents minus 1 (as entity array goes up from zero)
	for(subCounter = this.ship.subEntities.length - 1;subCounter&gt;=0;subCounter--)
		{
		if(this.ship.subEntities[subCounter].hasRole(this.missileRole)) // if the sub-ent is a missile, count it
			{ this.missileSubs++; }
		}
	
	if(this.missileSubs === 0 &amp;&amp; this.ship.subEntities.length === 0) // if we&#39;re all out of missiles and missile sub-entities, bail out.
		{ return; }
	
	if(this.missileSubs &lt; this.ship.missiles.length) // if we&#39;ve got more missiles than sub-entity missiles
		{
		this.ship.awardEquipment(&quot;EQ_MISSILE_REMOVAL&quot;); // get rid of all missiles
		if(this.missileSubs &gt; 0)
			{
			var missileCounter = 0; 
			for(missileCounter = 0;missileCounter&lt;this.missileSubs;missileCounter++) // restock with the correct number of selected missile
				{ this.ship.awardEquipment(this.missileRole); }
			}
		return;	
		}
		
	if(this.missileSubs &gt; this.ship.missiles.length) // if we&#39;ve got less missiles than sub-entity missiles
		{
		this.difference = this.missileSubs - this.ship.missiles.length;
		var removeCounter = 0; 
		for(removeCounter = 0;removeCounter&lt;this.difference;removeCounter++) // loop through however many subs we need to remove
				{
				var subCounter = this.ship.subEntities.length - 1; // Set counter to number of sub-ents minus 1 (as entity array goes up from zero)
				for(subCounter = this.ship.subEntities.length - 1;subCounter&gt;=0;subCounter--)
					{
					if(this.ship.subEntities[subCounter].hasRole(this.missileRole)) // if the sub-ent is a missile, remove it
						{ 
						this.ship.subEntities[subCounter].remove(); 
						break;
						}
					}
				}
		return;		
		}	
	}
	
this.shipDied = function() // event that occurs when the entity (ship) whose script this is dies
	{

	if(!this.ship || (player.ship.isValid &amp;&amp; this.ship.position.distanceTo(player.ship.position) &gt; 50000)) return; // exit the script if the explosion happens far from the player

 		this.largeCount = (Math.ceil(Math.random() * 4)); // between 0-4 pieces of wreckage
		this.tinyCount =  (Math.ceil(Math.random() * 10) + 5); // between 5-10 tiny spark fragments
		this.sparkCount =  (Math.ceil(Math.random() * 20) + 10); // between 10-20 spin spark fragments
		this.ship.spawn(&quot;griffspark&quot;, this.tinyCount); // spawn the tiny spark fragments


	if(this.largeCount &gt; 0) // if there is large wreckage
		{
		this.ship.spawn(&quot;griffwreckage&quot;, this.largeCount); // spawn the larger wreckage
		this.ship.spawn(&quot;spinspark&quot;, this.sparkCount); // spawn the spin sparks

		}

	}	</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
