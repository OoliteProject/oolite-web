<html>
    <head>
        <title>Expansion Elite Trader Meta</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Elite Trader Meta</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">15 Equipment</a></li>
          <li><a href="#ships">16 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">28 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>http://wiki.alioth.net/index.php/Elite%20Trader%20Meta -&gt; 404 Not Found</li>
                <li>Low hanging fuit: Information URL exists...</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Already a meta-game, the Guild of Elite Traders subverts Galcop and turns everything toward Trade. Perks include anti-masslock, witchpoint refuel, a forever-clean record, constant ship-enhancement, bonuses, new ship, lodges, cloak, fast dock; and Market scores count toward Elite. Progress in Grade brings a further edge. But - do not kill! Elite Trader Meta is an all-inclusive package featuring: Elite Trader, Auxiliary Pylon, Cargo Pods 10-50 TC, Cargo Space Refit, FE Ships, GETter HUD, Goods Containers 10-50 TC, and Overdrive.</td>
                    <td>Already a meta-game, the Guild of Elite Traders subverts Galcop and turns everything toward Trade. Perks include anti-masslock, witchpoint refuel, a forever-clean record, constant ship-enhancement, bonuses, new ship, lodges, cloak, fast dock; and Market scores count toward Elite. Progress in Grade brings a further edge. But - do not kill! Elite Trader Meta is an all-inclusive package featuring: Elite Trader, Auxiliary Pylon, Cargo Pods 10-50 TC, Cargo Space Refit, FE Ships, GETter HUD, Goods Containers 10-50 TC, and Overdrive.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Reval.Elite_Trader_Meta</td>
                    <td>oolite.oxp.Reval.Elite_Trader_Meta</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Elite Trader Meta</td>
                    <td>Elite Trader Meta</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Reval</td>
                    <td>Reval</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.19.2</td>
                    <td>1.19.2</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Elite_Trader_OXZ">http://wiki.alioth.net/index.php/Elite_Trader_OXZ</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/4/40/Elite_Trader_Meta.oxz">https://wiki.alioth.net/img_auth.php/4/40/Elite_Trader_Meta.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1670336354</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_10TC_POD.html">Cargo Pod 10 TC</a></td>
                    <td>yes</td>
                    <td align="right">100000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_20TC_POD.html">Cargo Pod 20 TC</a></td>
                    <td>yes</td>
                    <td align="right">200000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_30TC_POD.html">Cargo Pod 30 TC</a></td>
                    <td>yes</td>
                    <td align="right">300000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_40TC_POD.html">Cargo Pod 40 TC</a></td>
                    <td>yes</td>
                    <td align="right">400000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_50TC_POD.html">Cargo Pod 50 TC</a></td>
                    <td>yes</td>
                    <td align="right">500000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_AUTO_J.html">Overdrive</a></td>
                    <td>yes</td>
                    <td align="right">70000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_AUX_PYLON.html">Auxiliary Pylon</a></td>
                    <td>yes</td>
                    <td align="right">150000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_CARGO_REFIT.html">Cargo Space Refit</a></td>
                    <td>yes</td>
                    <td align="right">5000</td>
                    <td align="center">5+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_CLOAKING_DEVICE.html">Hull Shroud</a></td>
                    <td>yes</td>
                    <td align="right">100000</td>
                    <td align="center">10+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ET_AUTODOCK.html">G.E.T. fast-docking facility</a></td>
                    <td>no</td>
                    <td align="right">50</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_GC1_MINE.html">Goods Container 10 TC</a></td>
                    <td>yes</td>
                    <td align="right">100000</td>
                    <td align="center">7+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_GC2_MINE.html">Goods Container 20 TC</a></td>
                    <td>yes</td>
                    <td align="right">200000</td>
                    <td align="center">7+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_GC3_MINE.html">Goods Container 30 TC</a></td>
                    <td>yes</td>
                    <td align="right">300000</td>
                    <td align="center">7+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_GC4_MINE.html">Goods Container 40 TC</a></td>
                    <td>yes</td>
                    <td align="right">400000</td>
                    <td align="center">7+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_GC5_MINE.html">Goods Container 50 TC</a></td>
                    <td>yes</td>
                    <td align="right">500000</td>
                    <td align="center">7+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/FE_constrictor2.html">Constrictor II</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/FE_constrictor2-guardian.html">Constrictor IIg</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/FE_constrictor2-player.html">FE_constrictor2-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/gecko-player.html">gecko-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/goods-container1.html">Goods Container 10 TC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/goods-container2.html">Goods Container 20 TC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/goods-container3.html">Goods Container 30 TC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/goods-container4.html">Goods Container 40 TC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/goods-container5.html">Goods Container 50 TC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/guild_lodge_template.html">guild_lodge_template</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/guild_lodge_tetrahedron_station.html">G.E.T. Guild Lodge</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/krait-player.html">krait-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/mamba-player.html">mamba-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/sidewinder-player.html">sidewinder-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/viper-player.html">Viper Mk 1 FE</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/viper2-player.html">Viper Mk 2 FE</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/aj_script.js</td>
                    <td><pre>&quot;use strict&quot;
this.name = &quot;Overdrive&quot;;
this.author = &quot;Reval&quot;;
this.license = &quot;CC-BY-NC-SA 4.0&quot;;
this.version = &quot;1.4&quot;;
this.description = &quot;FE Shipyards will re-route part of your Jump circuitry, linking it to your vehicle&#39;s velocity-controller. When full speed is set, J-drive will engage in a limited mode, similar in effect to an injector, but silent, fluid, faster, and without the attendant fuel-waste. We call it the O-drive. To disengage it, decelerate to below your normal top speed.&quot;;


this.shipWillLaunchFromStation = function() {
	// start monitor if O-D installed and connected
	if ((this.$ajConnected) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_AUTO_J&quot;) === &quot;EQUIPMENT_OK&quot;)) {
		if(!this.$ajTimer) this.$ajTimer=new Timer(this,this._ajMonitorSpeed.bind(this),0,0.25);
		// note nominal maximum speed
		this.$ajMaxSpeed = player.ship.maxSpeed;
		// if E.T. present, use the Guild&#39;s enhanced speed
		if (this.$ajET)
			this.$ajETLast = worldScripts[&quot;Elite Trader&quot;].$etLastSpeed;
	}
}


this.shipWillDockWithStation = function(station) {
	this._ajStopOverdrive();
}


this.shipDockedWithStation = function(station) {
	// prepare connect/disconnect options Interface
	var ps=player.ship;
	if (ps.equipmentStatus (&quot;EQ_AUTO_J&quot;) === &quot;EQUIPMENT_OK&quot;) 
		this._ajPrepOptions(station);
}


this.shipWillEnterWitchspace = function(cause) {
     // stop O-D before entering witchspace
	 this._ajStopOverdrive();
}


this.playerWillSaveGame = function() {
	// save connected status
	if (this.$ajConnected) var con=1; else var con=0;
	missionVariables.ajConnected = con;
}


this.startUPComplete = function() {
	// load connected status
	if (missionVariables.ajConnected != null) {
		var con=missionVariables.ajConnected;
		this.$ajConnected = (con == 1);
	}
	
}


this.startUp = function() {
	// is E.T. present?
	this.$ajET = false;
	if (worldScripts[&quot;Elite Trader&quot;]) 
		this.$ajET = true;
	// record etLastSpeed
	this.$ajETLast = player.ship.maxSpeed;
	// O-drive connection switch
	this.$ajConnected = true;
	this.$ajEngaged = false;
	this.$ajMaxed = false;
	this.$ajFactor = 10.0;
	this.$ajMaxSpeed = 0.0;
	// for total reset (connect/disconnect)
	this.$ajNominal = player.ship.maxSpeed;
}


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	var ps = player.ship;
	if (equipment == &quot;EQ_AUTO_J&quot;) {
		pc(&quot;Re-routing J-circuits for O-drive.&quot;,9);
		pc(&quot;Overdrive is operative.&quot;,9);
		// prepare connect/disconnect options 
		var sta = player.ship.dockedStation;			
		if (ps.equipmentStatus (&quot;EQ_AUTO_J&quot;) === &quot;EQUIPMENT_OK&quot;) 
			this._ajPrepOptions(sta);
	}	
}


this._ajAdjustSpeed = function() {
	if (!this.$ajEngaged)
		if (!this.$ajMaxed) {
			player.ship.maxSpeed*=this.$ajFactor;
			this.$ajMaxed = true;
			this.$ajEngaged=true;
		}
}


this._ajMonitorSpeed = function() {
	var pss = player.ship.speed;
	if (this.$ajEngaged) {
		// stop the O-drive if J-Drive engaged
		if (player.ship.torusEngaged) 
			this._ajStopOverdrive();
		// stop the O-drive if decelerated to marker
		if (pss &lt; this.$ajMaxSpeed)
			this._ajStopOverdrive();
	} else {
		// start the O-drive
		if ((pss==this.$ajETLast) || (pss==this.$ajMaxSpeed)) {
			this._ajAdjustSpeed();
			player.consoleMessage(&quot;O-drive engaged.&quot;);
		}
	}
}


this._ajStopOverdrive = function() {
	if (this.$ajET)
		player.ship.maxSpeed = this.$ajETLast; else
		player.ship.maxSpeed=this.$ajMaxSpeed;
	this.$ajEngaged = false;
	this.$ajMaxed = false;
	player.consoleMessage(&quot;O-drive disengaged.&quot;);
}



// create Overdrive connection options  
this._ajPrepOptions = function(station) {
	station.setInterface(&quot;ajOpt&quot;,{
	title: &quot;Your FE Shipyards O-drive connection options&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards offers the option to connect or disconnect your Overdrive. This will also act as a &#39;reset&#39; in case of unexpected behaviour.&quot; ,
	callback: this._ajShowOptions.bind(this)
	});	
}


// show Overdrive connection options
this._ajShowOptions = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;Overdrive Connection Options&quot;;
	
	parameters.message = &quot;Connect or disconnect your Overdrive circuits? \n\n&quot;;
	
	parameters.choicesKey = &quot;ajChoice&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_CONNECT&quot;) {
			this.$ajConnected = true;
			this.$ajEngaged = false;
			this.$ajMaxed = false;
			if (this.$ajET)
				this.$ajETLast = worldScripts[&quot;Elite Trader&quot;].$etLastSpeed; else
				this.$ajMaxSpeed = this.$ajNominal;
			player.commsMessage(&quot;Overdrive is connected.&quot;);
		} else {
			this.$ajConnected = false;
			this.$ajEngaged = false;
			this.$ajMaxed = false;
			if (this.$ajET)
				this.$ajETLast = worldScripts[&quot;Elite Trader&quot;].$etLastSpeed; else
				this.$ajMaxSpeed = this.$ajNominal;
			player.commsMessage(&quot;Overdrive is disconnected.&quot;);
		}
	}	
}

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/ap_conditions.js</td>
                    <td><pre>// conditions for award of Auxiliary Pylon
&quot;use strict&quot;;
this.name = &quot;AP Conditions&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	
	if (equipment == &quot;EQ_AUX_PYLON&quot;) return true;
	return true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/ap_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Auxiliary Pylon&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_AUX_PYLON&quot;) {
			pc(&quot;Modifying underbelly for pylon attachment.&quot;,9);
			pc(&quot;Fitting one Auxiliary Pylon.&quot;,9);
	}	
}


this.equipmentRemoved = function(equipmentKey) {
    var pc=player.consoleMessage;
	if (equipmentKey == &quot;EQ_AUX_PYLON&quot;) {
		pc(&quot;Auxiliary Pylon cannot be removed.&quot;,7);
	}
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/autodock_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	if (context != &quot;scripted&quot;) return false;
	return true
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/cp1_conditions.js</td>
                    <td><pre>// conditions for award of 10 TC Cargo Pod
&quot;use strict&quot;;
this.name = &quot;CP10 Conditions&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_10TC_POD&quot;) {
		// fittable only if auxiliary pylon is installed
		if (player.ship.equipmentStatus (&quot;EQ_AUX_PYLON&quot;) === &quot;EQUIPMENT_OK&quot;) {
			// and not displayed if any pod is already fitted
			if ((player.ship.equipmentStatus (&quot;EQ_10TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_20TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_30TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_40TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_50TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;))
				return true; else return false;
		} else return false;
	}	
	return true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/cp1_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Cargo Pod 10 TC&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_10TC_POD&quot;) {		
		pc(&quot;Attaching one 10 TC Pod to auxiliary pylon.&quot;,9);
		player.ship.cargoSpaceCapacity += 10;
		pc(&quot;Ship&#39;s total capacity = &quot;+player.ship.cargoSpaceCapacity+&quot; TC.&quot;,9);
		// always 1 because only one pod can be fitted
		this.$cp1Pods=1;
	}	
}


this.equipmentRemoved = function(equipmentKey) {
    var pc=player.consoleMessage;
	if (equipmentKey == &quot;EQ_10TC_POD&quot;) {
		pc(&quot;Detaching one 10 TC Pod from auxiliary pylon.&quot;,9);
		player.ship.cargoSpaceCapacity -= 10;
		pc(&quot;Ship&#39;s total capacity = &quot;+player.ship.cargoSpaceCapacity+&quot; TC.&quot;,9);
	}
}



this.startUpComplete = function () {
	var pc = player.consoleMessage;
	if (missionVariables.cp1Pods != null) 
		this.$cp1Pods = missionVariables.cp1Pods;
	// Load total fees taken
	if (missionVariables.cp1HandlingFeeTotal != null)
		this.$cp1HandlingFeeTotal = missionVariables.cp1HandlingFeeTotal;
	if (missionVariables.cp1HandlingPaid != null)
		this.$cp1HandlingPaid = missionVariables.cp1HandlingPaid;
	if (missionVariables.cp1MaintenanceFeeTotal != null)
		this.$cp1MaintenanceFeeTotal = missionVariables.cp1MaintenanceFeeTotal;
	if (missionVariables.cp1DismantlingFeeTotal != null)
		this.$cp1DismantlingFeeTotal = missionVariables.cp1DismantlingFeeTotal; 
    // Load system-to-system runs w/pod
	if (missionVariables.cp1Runs != null)
		this.$cp1Runs = missionVariables.cp1Runs;
	// Load Handling fee count
	if (missionVariables.cp1HandlingCount != null)
		this.$cp1HandlingCount = missionVariables.cp1HandlingCount;
	// Load handling fee exemption status
	if (missionVariables.cp1HFExempt != null)
		this.$cp1HFExempt = missionVariables.cp1HFExempt;
	// Load Maintenance fee count
	if (missionVariables.cp1MaintenanceCount != null)
		this.$cp1MaintenanceCount = missionVariables.cp1MaintenanceCount;
	// CHECK
	log(this.name, this.name+&quot; startup complete.&quot;);
	// prepare pod Account screen
	var sta = player.ship.dockedStation;
	if (this.$cp1Pods&gt;0) this._cp1PrepAcc(sta);
	// optionally, prepare handling fee waiver request
	if (this.$cp1Pods&gt;0) this._cp1PrepEx(sta);
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// check for G.E.T. presence
	this.$cp1ET = false;
	if (worldScripts[&quot;Elite Trader&quot;]) 
		this.$cp1ET = true;
	// TEST	
	if (this.$cp1ET) log(this.name, &quot;Finds Elite Trader present&quot;);
	// check for FE Ships Player
	this.$cp1FES = false;
	if (worldScripts[&quot;FE Ships Player&quot;]) 
		this.$cp1FES = true;
	// TEST	
	if (this.$cp1ET) log(this.name, &quot;Finds FE Ships Player present&quot;);
	// number of pods - when fitted, always 1
	this.$cp1Pods = 0;
	// purchase cost of pod in cr
	this.$cp1Cost = 10000;
	// handling fee
	this.$cp1HandlingFee = 0.005*this.$cp1Cost; // 0.005 of cost
	this.$cp1HandlingFeeTotal = 0;
	this.$cp1HandlingPaid = &quot;yes&quot;; // or &quot;no&quot; - easier than boolean
	this.$cp1HandlingCount = 0;
	this.$cp1HFExempt = &quot;no&quot;;
	// maintenance fee
	this.$cp1MaintenanceFee = 0.05*this.$cp1Cost; // 0.05 of cost
	this.$cp1MaintenanceFeeTotal = 0;
	this.$cp1MaintenancePaid = &quot;no&quot; // or &quot;yes&quot;
	this.$cp1MaintenanceInterval = 10; // in runs (according to cost)
	this.$cp1MaintenanceCount = 0;
	// dismantling fee
	this.$cp1DismantlingFee = 0.1*this.$cp1Cost; // 0.1 of cost
	this.$cp1DismantlingFeeTotal = 0.0;
	// system-to-system runs w/pod
	this.$cp1Runs = 0;
}


this.playerWillSaveGame = function(message) {
	missionVariables.cp1Pods = this.$cp1Pods;
	// save total fees taken
	missionVariables.cp1HandlingFeeTotal = this.$cp1HandlingFeeTotal;
	missionVariables.cp1MaintenanceFeeTotal = this.$cp1MaintenanceFeeTotal;
	missionVariables.cp1DismantlingFeeTotal = this.$cp1DismantlingFeeTotal;
	missionVariables.cp1HandlingPaid = this.$cp1HandlingPaid;
	// system-to-system runs w/pod
	missionVariables.cp1Runs =this.$cp1Runs;
	// handling fee count
	missionVariables.cp1HandlingCount = this.$cp1HandlingCount;
	// handling fee exemption (G.E.T.)
	missionVariables.cp1HFExempt = this.$cp1HFExempt;
	// maintenance fee count
	missionVariables.cp1MaintenanceCount = this.$cp1MaintenanceCount;
}


this.shipDockedWithStation = function(station) {
	// take handling fee (if not exempt)
	var pc = player.consoleMessage;
	var ex = this.$cp1HFExempt;
	// check we have pods, the fee is not paid, and we&#39;re not exempt
	if ((this.$cp1Pods&gt;0) &amp;&amp; (this.$cp1HandlingPaid===&quot;no&quot;) &amp;&amp; (ex===&quot;no&quot;)) {
		var fee = 0;
		for (var x=1; x&lt;= this.$cp1Pods; x++)
			fee += this.$cp1HandlingFee;
		// record fee and debit trader&#39;s account
		this.$cp1HandlingFeeTotal += fee;
		player.credits -= fee;
		this.$cp1HandlingPaid = &quot;yes&quot;;
		pc(&quot;10 TC Pod handling fees: &quot;+fee+&quot; cr&quot;,9);
		this.$cp1HandlingCount++;
	}

	// conditionally take maintenance fee
	if (this.$cp1Pods&gt;0) this._cp1DoMaintenance();
	
	// prepare pod Account and Licence page
	if (this.$cp1Pods&gt;0) this._cp1PrepAcc(station);
	
	// prepare handling fee waiver request if ET or FESP is present
	if (this.$cp1Pods&gt;0) this._cp1PrepEx(station);
}



this.shipExitedWitchspace = function() {
	// set handling paid to &#39;no&#39;
	this.$cp1HandlingPaid = &quot;no&quot;;
	this.$cp1Runs ++;
}


/* Common helper functions */


// assess and take maintenance fee
this._cp1DoMaintenance = function() {
	var pc = player.consoleMessage;
	var runs = this.$cp1Runs;
	var intv = this.$cp1MaintenanceInterval;
	var mfee = this.$cp1MaintenanceFee;
	// take maintenance fee after y runs
	if ( (runs &gt; 0) &amp;&amp; ((runs % intv)==0) ) {
		// maintenance for x pods
		var fee = 0;
		for (var x=1; x&lt;= this.$cp1Pods; x++)
			fee += mfee;
		// maintenance fee tally &amp; debit
		this.$cp1MaintenanceFeeTotal += fee;
		player.credits -= fee;
		pc(&quot;10 TC Pod Maintenance fees: &quot;+fee+&quot; cr&quot;,9);
		// update Maintenance count
		this.$cp1MaintenanceCount++;
	}
}


/* F4 Interfaces */


// create F.E.S. &#39;Licence &amp; Account&#39; page 
this._cp1PrepAcc = function(station) {
	station.setInterface(&quot;cp1Acc&quot;,{
	title: &quot;Your FE Shipyards 10 TC Pod Class Licence&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;Your FE Shipyards 10 TC Pod account screen shows terms, fees paid, load, and other useful information.&quot;,
	callback: this._cp1ShowAcc.bind(this)
	});	
}


// show F.E.S. &#39;Licence &amp; Account&#39; page
this._cp1ShowAcc = function() {
	var hfc = this.$cp1HandlingCount;
	var mfc = this.$cp1MaintenanceCount;
	var mfi = this.$cp1MaintenanceInterval;
	var hft = this.$cp1HandlingFeeTotal;
	var mft = this.$cp1MaintenanceFeeTotal;
	var dft = this.$cp1DismantlingFeeTotal;
		
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	if (this.$cp1Pods&gt;0) 
		parameters.message +=&quot;Your Account and Licence for 10 TC Class Goods Pods x &quot;+this.$cp1Pods+&quot;: \n\n&quot;; 
	 else
		parameters.message +=&quot;You have no 10 TC Class Pods licensed with us at this time. \n\n&quot;;
	
	parameters.message +=&quot;Handling fees paid: &quot;+hft+&quot; cr (&quot;+hfc+&quot;) \n&quot;;
	parameters.message +=&quot;Maintenance fees paid: &quot;+mft+&quot; cr (&quot;+mfc+&quot;) \n&quot;;
	parameters.message +=&quot;Dismantling fees paid: &quot;+dft+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;Our pods are re-used many times per cycle, often many times per day. Maintaining them in clean and serviceable condition for their maximum useful lifetime is our prime concern at FE Shipyards, and we trust that you, our valued customer, understand the need for your own participation in this costly and ongoing process. \n\n&quot;;
	
	parameters.message += &quot;The handling charge (0.005 of cost) is levied upon docking, the maintenance fee (0.05 of cost) every &quot;+mfi+&quot; system-to-system trading runs. \n\n&quot;
	
	parameters.message += &quot;If you cancel your Pod account with us at any time, we must charge the dismantling fee (0.1 of cost) to re-modify and restore your vessel&#39;s pylon for weapons-use. \n&quot;;
	
	parameters.choicesKey = &quot;cp1Acknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}
}



// create F.E.S. handling fee waiver/restoration request  
this._cp1PrepEx = function(station) {
	station.setInterface(&quot;cp1Ex&quot;,{
	title: &quot;Your FE Shipyards Pod Handling Fee Waiver Request&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards grants Guilders and FE shipowners the privileged option to waive our handling and dismantling fees for the 10-ton pod class.&quot; ,
	callback: this._cp1ShowEx.bind(this)
	});	
}


// show F.E.S. handling &amp; dismantling fee waiver/restoration request
this._cp1ShowEx = function() {
	var priv = ((this.$cp1ET)||(this.$cp1FES));
	var privo = &quot;&quot;;
	if (this.$cp1FES) privo=&quot;FE shipowner&quot;;
	if (this.$cp1ET) privo=&quot;Guilder&quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;Re: your request to waive your 10 TC pod fees.\n\n&quot;
	
	parameters.message += &quot;The handling fee (0.005 of cost) is taken from your account upon docking, and is merely to cover our attachment/detachment &amp; loading/unloading services. The dismantling fee (0.1 of cost) is charged when re-modifying your pylons for weapons-use after Licence cancellation. \n\n&quot;;
	
	if (priv)
		parameters.message += &quot;FE Shipyards grants you, as a &quot;+privo+&quot;, the privileged option to waive our handling and dismantling fees, although you are free - and encouraged - to continue supporting our efforts to provide the efficient service you as an Elite Trader deserve. \n\n&quot;;
	else
		parameters.message += &quot;FE Shipyards regrets that we are unable at this time to grant you an exemption from fees, which is a privilege of Guilders and FE shipowners exclusively. \n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;cp1YesNoEx&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_AYE&quot;)  {
			if (priv) this.$cp1HFExempt = &quot;yes&quot;; else this.$cp1HFExempt = &quot;no&quot;;
		} else this.$cp1HFExempt = &quot;no&quot;;
		player.commsMessage(&quot;FE Shipyards thanks you for your attention.&quot;);
	}	
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/cp2_conditions.js</td>
                    <td><pre>// conditions for award of 20 TC Cargo Pod
&quot;use strict&quot;;
this.name = &quot;CP20 Conditions&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_20TC_POD&quot;) {
		// fittable only if auxiliary pylon is installed
		if (player.ship.equipmentStatus (&quot;EQ_AUX_PYLON&quot;) === &quot;EQUIPMENT_OK&quot;) {
			// and not displayed if any pod is already fitted
			if ((player.ship.equipmentStatus (&quot;EQ_10TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_20TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_30TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_40TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_50TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;))
				return true; else return false;
		} else return false;
	}	
	return true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/cp2_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Cargo Pod 20 TC&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_20TC_POD&quot;) {		
		pc(&quot;Attaching one 20 TC Pod to auxiliary pylon.&quot;,9);
		player.ship.cargoSpaceCapacity += 20;
		pc(&quot;Ship&#39;s total capacity = &quot;+player.ship.cargoSpaceCapacity+&quot; TC.&quot;,9);
		// always 1 because only one pod can be fitted
		this.$cp2Pods=1;
	}	
}


this.equipmentRemoved = function(equipmentKey) {
    var pc=player.consoleMessage;
	if (equipmentKey == &quot;EQ_20TC_POD&quot;) {
		pc(&quot;Detaching one 20 TC Pod from auxiliary pylon.&quot;,9);
		player.ship.cargoSpaceCapacity -= 20;
		pc(&quot;Ship&#39;s total capacity = &quot;+player.ship.cargoSpaceCapacity+&quot; TC.&quot;,9);
	}
}



this.startUpComplete = function () {
	var pc = player.consoleMessage;
	if (missionVariables.cp2Pods != null) 
		this.$cp2Pods = missionVariables.cp2Pods;
	// Load total fees taken
	if (missionVariables.cp2HandlingFeeTotal != null)
		this.$cp2HandlingFeeTotal = missionVariables.cp2HandlingFeeTotal;
	if (missionVariables.cp2HandlingPaid != null)
		this.$cp2HandlingPaid = missionVariables.cp2HandlingPaid;
	if (missionVariables.cp2MaintenanceFeeTotal != null)
		this.$cp2MaintenanceFeeTotal = missionVariables.cp2MaintenanceFeeTotal;
	if (missionVariables.cp2DismantlingFeeTotal != null)
		this.$cp2DismantlingFeeTotal = missionVariables.cp2DismantlingFeeTotal; 
    // Load system-to-system runs w/pod
	if (missionVariables.cp2Runs != null)
		this.$cp2Runs = missionVariables.cp2Runs;
	// Load Handling fee count
	if (missionVariables.cp2HandlingCount != null)
		this.$cp2HandlingCount = missionVariables.cp2HandlingCount;
	// Load handling fee exemption status
	if (missionVariables.cp2HFExempt != null)
		this.$cp2HFExempt = missionVariables.cp2HFExempt;
	// Load Maintenance fee count
	if (missionVariables.cp2MaintenanceCount != null)
		this.$cp2MaintenanceCount = missionVariables.cp2MaintenanceCount;
	// CHECK
	log(this.name, this.name+&quot; startup complete.&quot;);
	// prepare pod Account screen
	var sta = player.ship.dockedStation;
	if (this.$cp2Pods&gt;0) this._cp2PrepAcc(sta);
	// optionally, prepare handling fee waiver request
	if (this.$cp2Pods&gt;0) this._cp2PrepEx(sta);
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// check for G.E.T. presence
	this.$cp2ET = false;
	if (worldScripts[&quot;Elite Trader&quot;]) 
		this.$cp2ET = true;
	// TEST	
	if (this.$cp2ET) log(this.name, &quot;Finds Elite Trader present&quot;);
	// check for FE Ships Player
	this.$cp2FES = false;
	if (worldScripts[&quot;FE Ships Player&quot;]) 
		this.$cp2FES = true;
	// TEST	
	if (this.$cp2ET) log(this.name, &quot;Finds FE Ships Player present&quot;);
	// number of pods - when fitted, always 1
	this.$cp2Pods = 0;
	// purchase cost of pod in cr
	this.$cp2Cost = 20000;
	// handling fee
	this.$cp2HandlingFee = 0.005*this.$cp2Cost; // 0.005 of cost
	this.$cp2HandlingFeeTotal = 0;
	this.$cp2HandlingPaid = &quot;yes&quot;; // or &quot;no&quot; - easier than boolean
	this.$cp2HandlingCount = 0;
	this.$cp2HFExempt = &quot;no&quot;;
	// maintenance fee
	this.$cp2MaintenanceFee = 0.05*this.$cp2Cost; // 0.05 of cost
	this.$cp2MaintenanceFeeTotal = 0;
	this.$cp2MaintenancePaid = &quot;no&quot; // or &quot;yes&quot;
	this.$cp2MaintenanceInterval = 20; // in runs (according to cost)
	this.$cp2MaintenanceCount = 0;
	// dismantling fee
	this.$cp2DismantlingFee = 0.1*this.$cp2Cost; // 0.1 of cost
	this.$cp2DismantlingFeeTotal = 0.0;
	// system-to-system runs w/pod
	this.$cp2Runs = 0;
}


this.playerWillSaveGame = function(message) {
	missionVariables.cp2Pods = this.$cp2Pods;
	// save total fees taken
	missionVariables.cp2HandlingFeeTotal = this.$cp2HandlingFeeTotal;
	missionVariables.cp2MaintenanceFeeTotal = this.$cp2MaintenanceFeeTotal;
	missionVariables.cp2DismantlingFeeTotal = this.$cp2DismantlingFeeTotal;
	missionVariables.cp2HandlingPaid = this.$cp2HandlingPaid;
	// system-to-system runs w/pod
	missionVariables.cp2Runs =this.$cp2Runs;
	// handling fee count
	missionVariables.cp2HandlingCount = this.$cp2HandlingCount;
	// handling fee exemption (G.E.T.)
	missionVariables.cp2HFExempt = this.$cp2HFExempt;
	// maintenance fee count
	missionVariables.cp2MaintenanceCount = this.$cp2MaintenanceCount;
}


this.shipDockedWithStation = function(station) {
	// take handling fee (if not exempt)
	var pc = player.consoleMessage;
	var ex = this.$cp2HFExempt;
	// check we have pods, the fee is not paid, and we&#39;re not exempt
	if ((this.$cp2Pods&gt;0) &amp;&amp; (this.$cp2HandlingPaid===&quot;no&quot;) &amp;&amp; (ex===&quot;no&quot;)) {
		var fee = 0;
		for (var x=1; x&lt;= this.$cp2Pods; x++)
			fee += this.$cp2HandlingFee;
		// record fee and debit trader&#39;s account
		this.$cp2HandlingFeeTotal += fee;
		player.credits -= fee;
		this.$cp2HandlingPaid = &quot;yes&quot;;
		pc(&quot;20 TC Pod handling fees: &quot;+fee+&quot; cr&quot;,9);
		this.$cp2HandlingCount++;
	}

	// conditionally take maintenance fee
	if (this.$cp2Pods&gt;0) this._cp2DoMaintenance();
	
	// prepare pod Account and Licence page
	if (this.$cp2Pods&gt;0) this._cp2PrepAcc(station);
	
	// prepare handling fee waiver request if ET or FESP is present
	if (this.$cp2Pods&gt;0) this._cp2PrepEx(station);
}



this.shipExitedWitchspace = function() {
	// set handling paid to &#39;no&#39;
	this.$cp2HandlingPaid = &quot;no&quot;;
	this.$cp2Runs ++;
}


/* Common helper functions */


// assess and take maintenance fee
this._cp2DoMaintenance = function() {
	var pc = player.consoleMessage;
	var runs = this.$cp2Runs;
	var intv = this.$cp2MaintenanceInterval;
	var mfee = this.$cp2MaintenanceFee;
	// take maintenance fee after y runs
	if ( (runs &gt; 0) &amp;&amp; ((runs % intv)==0) ) {
		// maintenance for x pods
		var fee = 0;
		for (var x=1; x&lt;= this.$cp2Pods; x++)
			fee += mfee;
		// maintenance fee tally &amp; debit
		this.$cp2MaintenanceFeeTotal += fee;
		player.credits -= fee;
		pc(&quot;20 TC Pod Maintenance fees: &quot;+fee+&quot; cr&quot;,9);
		// update Maintenance count
		this.$cp2MaintenanceCount++;
	}
}


/* F4 Interfaces */


// create F.E.S. &#39;Licence &amp; Account&#39; page 
this._cp2PrepAcc = function(station) {
	station.setInterface(&quot;cp2Acc&quot;,{
	title: &quot;Your FE Shipyards 20 TC Pod Class Licence&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;Your FE Shipyards 20 TC Pod account screen shows terms, fees paid, load, and other useful information.&quot;,
	callback: this._cp2ShowAcc.bind(this)
	});	
}


// show F.E.S. &#39;Licence &amp; Account&#39; page
this._cp2ShowAcc = function() {
	var hfc = this.$cp2HandlingCount;
	var mfc = this.$cp2MaintenanceCount;
	var mfi = this.$cp2MaintenanceInterval;
	var hft = this.$cp2HandlingFeeTotal;
	var mft = this.$cp2MaintenanceFeeTotal;
	var dft = this.$cp2DismantlingFeeTotal;
		
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	if (this.$cp2Pods&gt;0) 
		parameters.message +=&quot;Your Account and Licence for 20 TC Class Goods Pods x &quot;+this.$cp2Pods+&quot;: \n\n&quot;; 
	 else
		parameters.message +=&quot;You have no 20 TC Class Pods licensed with us at this time. \n\n&quot;;
	
	parameters.message +=&quot;Handling fees paid: &quot;+hft+&quot; cr (&quot;+hfc+&quot;) \n&quot;;
	parameters.message +=&quot;Maintenance fees paid: &quot;+mft+&quot; cr (&quot;+mfc+&quot;) \n&quot;;
	parameters.message +=&quot;Dismantling fees paid: &quot;+dft+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;Our pods are re-used many times per cycle, often many times per day. Maintaining them in clean and serviceable condition for their maximum useful lifetime is our prime concern at FE Shipyards, and we trust that you, our valued customer, understand the need for your own participation in this costly and ongoing process. \n\n&quot;;
	
	parameters.message += &quot;The handling charge (0.005 of cost) is levied upon docking, the maintenance fee (0.05 of cost) every &quot;+mfi+&quot; system-to-system trading runs. \n\n&quot;
	
	parameters.message += &quot;If you cancel your Pod account with us at any time, we must charge the dismantling fee (0.1 of cost) to re-modify and restore your vessel&#39;s pylon for weapons-use. \n&quot;;
	
	parameters.choicesKey = &quot;cp2Acknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}
}



// create F.E.S. handling fee waiver/restoration request  
this._cp2PrepEx = function(station) {
	station.setInterface(&quot;cp2Ex&quot;,{
	title: &quot;Your FE Shipyards Pod Handling Fee Waiver Request&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards grants Guilders and FE shipowners the privileged option to waive our handling and dismantling fees for the 20-ton pod class.&quot; ,
	callback: this._cp2ShowEx.bind(this)
	});	
}


// show F.E.S. handling &amp; dismantling fee waiver/restoration request
this._cp2ShowEx = function() {
	var priv = ((this.$cp2ET)||(this.$cp2FES));
	var privo = &quot;&quot;;
	if (this.$cp2FES) privo=&quot;FE shipowner&quot;;
	if (this.$cp2ET) privo=&quot;Guilder&quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;Re: your request to waive your 20 TC pod fees.\n\n&quot;
	
	parameters.message += &quot;The handling fee (0.005 of cost) is taken from your account upon docking, and is merely to cover our attachment/detachment &amp; loading/unloading services. The dismantling fee (0.1 of cost) is charged when re-modifying your pylons for weapons-use after Licence cancellation. \n\n&quot;;
	
	if (priv)
		parameters.message += &quot;FE Shipyards grants you, as a &quot;+privo+&quot;, the privileged option to waive our handling and dismantling fees, although you are free - and encouraged - to continue supporting our efforts to provide the efficient service you as an Elite Trader deserve. \n\n&quot;;
	else
		parameters.message += &quot;FE Shipyards regrets that we are unable at this time to grant you an exemption from fees, which is a privilege of Guilders and FE shipowners exclusively. \n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;cp2YesNoEx&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_AYE&quot;)  {
			if (priv) this.$cp2HFExempt = &quot;yes&quot;; else this.$cp2HFExempt = &quot;no&quot;;
		} else this.$cp2HFExempt = &quot;no&quot;;
		player.commsMessage(&quot;FE Shipyards thanks you for your attention.&quot;);
	}	
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/cp3_conditions.js</td>
                    <td><pre>// conditions for award of 30 TC Cargo Pod
&quot;use strict&quot;;
this.name = &quot;CP30 Conditions&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_30TC_POD&quot;) {
		// fittable only if auxiliary pylon is installed
		if (player.ship.equipmentStatus (&quot;EQ_AUX_PYLON&quot;) === &quot;EQUIPMENT_OK&quot;) {
			// and not displayed if any pod is already fitted
			if ((player.ship.equipmentStatus (&quot;EQ_10TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_20TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_30TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_40TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_50TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;))
				return true; else return false;
		} else return false;
	}	
	return true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/cp3_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Cargo Pod 30 TC&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_30TC_POD&quot;) {		
		pc(&quot;Attaching one 30 TC Pod to auxiliary pylon.&quot;,9);
		player.ship.cargoSpaceCapacity += 30;
		pc(&quot;Ship&#39;s total capacity = &quot;+player.ship.cargoSpaceCapacity+&quot; TC.&quot;,9);
		// always 1 because only one pod can be fitted
		this.$cp3Pods=1;
	}	
}


this.equipmentRemoved = function(equipmentKey) {
    var pc=player.consoleMessage;
	if (equipmentKey == &quot;EQ_30TC_POD&quot;) {
		pc(&quot;Detaching one 30 TC Pod from auxiliary pylon.&quot;,9);
		player.ship.cargoSpaceCapacity -= 30;
		pc(&quot;Ship&#39;s total capacity = &quot;+player.ship.cargoSpaceCapacity+&quot; TC.&quot;,9);
	}
}



this.startUpComplete = function () {
	var pc = player.consoleMessage;
	if (missionVariables.cp3Pods != null) 
		this.$cp3Pods = missionVariables.cp3Pods;
	// Load total fees taken
	if (missionVariables.cp3HandlingFeeTotal != null)
		this.$cp3HandlingFeeTotal = missionVariables.cp3HandlingFeeTotal;
	if (missionVariables.cp3HandlingPaid != null)
		this.$cp3HandlingPaid = missionVariables.cp3HandlingPaid;
	if (missionVariables.cp3MaintenanceFeeTotal != null)
		this.$cp3MaintenanceFeeTotal = missionVariables.cp3MaintenanceFeeTotal;
	if (missionVariables.cp3DismantlingFeeTotal != null)
		this.$cp3DismantlingFeeTotal = missionVariables.cp3DismantlingFeeTotal; 
    // Load system-to-system runs w/pod
	if (missionVariables.cp3Runs != null)
		this.$cp3Runs = missionVariables.cp3Runs;
	// Load Handling fee count
	if (missionVariables.cp3HandlingCount != null)
		this.$cp3HandlingCount = missionVariables.cp3HandlingCount;
	// Load handling fee exemption status
	if (missionVariables.cp3HFExempt != null)
		this.$cp3HFExempt = missionVariables.cp3HFExempt;
	// Load Maintenance fee count
	if (missionVariables.cp3MaintenanceCount != null)
		this.$cp3MaintenanceCount = missionVariables.cp3MaintenanceCount;
	// CHECK
	log(this.name, this.name+&quot; startup complete.&quot;);
	// prepare pod Account screen
	var sta = player.ship.dockedStation;
	if (this.$cp3Pods&gt;0) this._cp3PrepAcc(sta);
	// optionally, prepare handling fee waiver request
	if (this.$cp3Pods&gt;0) this._cp3PrepEx(sta);
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// check for G.E.T. presence
	this.$cp3ET = false;
	if (worldScripts[&quot;Elite Trader&quot;]) 
		this.$cp3ET = true;
	// TEST	
	if (this.$cp3ET) log(this.name, &quot;Finds Elite Trader present&quot;);
	// check for FE Ships Player
	this.$cp3FES = false;
	if (worldScripts[&quot;FE Ships Player&quot;]) 
		this.$cp3FES = true;
	// TEST	
	if (this.$cp3ET) log(this.name, &quot;Finds FE Ships Player present&quot;);
	// number of pods - when fitted, always 1
	this.$cp3Pods = 0;
	// purchase cost of pod in cr
	this.$cp3Cost = 30000;
	// handling fee
	this.$cp3HandlingFee = 0.005*this.$cp3Cost; // 0.005 of cost
	this.$cp3HandlingFeeTotal = 0;
	this.$cp3HandlingPaid = &quot;yes&quot;; // or &quot;no&quot; - easier than boolean
	this.$cp3HandlingCount = 0;
	this.$cp3HFExempt = &quot;no&quot;;
	// maintenance fee
	this.$cp3MaintenanceFee = 0.05*this.$cp3Cost; // 0.05 of cost
	this.$cp3MaintenanceFeeTotal = 0;
	this.$cp3MaintenancePaid = &quot;no&quot; // or &quot;yes&quot;
	this.$cp3MaintenanceInterval = 30; // in runs (according to cost)
	this.$cp3MaintenanceCount = 0;
	// dismantling fee
	this.$cp3DismantlingFee = 0.1*this.$cp3Cost; // 0.1 of cost
	this.$cp3DismantlingFeeTotal = 0.0;
	// system-to-system runs w/pod
	this.$cp3Runs = 0;
}


this.playerWillSaveGame = function(message) {
	missionVariables.cp3Pods = this.$cp3Pods;
	// save total fees taken
	missionVariables.cp3HandlingFeeTotal = this.$cp3HandlingFeeTotal;
	missionVariables.cp3MaintenanceFeeTotal = this.$cp3MaintenanceFeeTotal;
	missionVariables.cp3DismantlingFeeTotal = this.$cp3DismantlingFeeTotal;
	missionVariables.cp3HandlingPaid = this.$cp3HandlingPaid;
	// system-to-system runs w/pod
	missionVariables.cp3Runs =this.$cp3Runs;
	// handling fee count
	missionVariables.cp3HandlingCount = this.$cp3HandlingCount;
	// handling fee exemption (G.E.T.)
	missionVariables.cp3HFExempt = this.$cp3HFExempt;
	// maintenance fee count
	missionVariables.cp3MaintenanceCount = this.$cp3MaintenanceCount;
}


this.shipDockedWithStation = function(station) {
	// take handling fee (if not exempt)
	var pc = player.consoleMessage;
	var ex = this.$cp3HFExempt;
	// check we have pods, the fee is not paid, and we&#39;re not exempt
	if ((this.$cp3Pods&gt;0) &amp;&amp; (this.$cp3HandlingPaid===&quot;no&quot;) &amp;&amp; (ex===&quot;no&quot;)) {
		var fee = 0;
		for (var x=1; x&lt;= this.$cp3Pods; x++)
			fee += this.$cp3HandlingFee;
		// record fee and debit trader&#39;s account
		this.$cp3HandlingFeeTotal += fee;
		player.credits -= fee;
		this.$cp3HandlingPaid = &quot;yes&quot;;
		pc(&quot;30 TC Pod handling fees: &quot;+fee+&quot; cr&quot;,9);
		this.$cp3HandlingCount++;
	}

	// conditionally take maintenance fee
	if (this.$cp3Pods&gt;0) this._cp3DoMaintenance();
	
	// prepare pod Account and Licence page
	if (this.$cp3Pods&gt;0) this._cp3PrepAcc(station);
	
	// prepare handling fee waiver request if ET or FESP is present
	if (this.$cp3Pods&gt;0) this._cp3PrepEx(station);
}



this.shipExitedWitchspace = function() {
	// set handling paid to &#39;no&#39;
	this.$cp3HandlingPaid = &quot;no&quot;;
	this.$cp3Runs ++;
}


/* Common helper functions */


// assess and take maintenance fee
this._cp3DoMaintenance = function() {
	var pc = player.consoleMessage;
	var runs = this.$cp3Runs;
	var intv = this.$cp3MaintenanceInterval;
	var mfee = this.$cp3MaintenanceFee;
	// take maintenance fee after y runs
	if ( (runs &gt; 0) &amp;&amp; ((runs % intv)==0) ) {
		// maintenance for x pods
		var fee = 0;
		for (var x=1; x&lt;= this.$cp3Pods; x++)
			fee += mfee;
		// maintenance fee tally &amp; debit
		this.$cp3MaintenanceFeeTotal += fee;
		player.credits -= fee;
		pc(&quot;30 TC Pod Maintenance fees: &quot;+fee+&quot; cr&quot;,9);
		// update Maintenance count
		this.$cp3MaintenanceCount++;
	}
}


/* F4 Interfaces */


// create F.E.S. &#39;Licence &amp; Account&#39; page 
this._cp3PrepAcc = function(station) {
	station.setInterface(&quot;cp3Acc&quot;,{
	title: &quot;Your FE Shipyards 30 TC Pod Class Licence&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;Your FE Shipyards 30 TC Pod account screen shows terms, fees paid, load, and other useful information.&quot;,
	callback: this._cp3ShowAcc.bind(this)
	});	
}


// show F.E.S. &#39;Licence &amp; Account&#39; page
this._cp3ShowAcc = function() {
	var hfc = this.$cp3HandlingCount;
	var mfc = this.$cp3MaintenanceCount;
	var mfi = this.$cp3MaintenanceInterval;
	var hft = this.$cp3HandlingFeeTotal;
	var mft = this.$cp3MaintenanceFeeTotal;
	var dft = this.$cp3DismantlingFeeTotal;
		
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	if (this.$cp3Pods&gt;0) 
		parameters.message +=&quot;Your Account and Licence for 30 TC Class Goods Pods x &quot;+this.$cp3Pods+&quot;: \n\n&quot;; 
	 else
		parameters.message +=&quot;You have no 30 TC Class Pods licensed with us at this time. \n\n&quot;;
	
	parameters.message +=&quot;Handling fees paid: &quot;+hft+&quot; cr (&quot;+hfc+&quot;) \n&quot;;
	parameters.message +=&quot;Maintenance fees paid: &quot;+mft+&quot; cr (&quot;+mfc+&quot;) \n&quot;;
	parameters.message +=&quot;Dismantling fees paid: &quot;+dft+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;Our pods are re-used many times per cycle, often many times per day. Maintaining them in clean and serviceable condition for their maximum useful lifetime is our prime concern at FE Shipyards, and we trust that you, our valued customer, understand the need for your own participation in this costly and ongoing process. \n\n&quot;;
	
	parameters.message += &quot;The handling charge (0.005 of cost) is levied upon docking, the maintenance fee (0.05 of cost) every &quot;+mfi+&quot; system-to-system trading runs. \n\n&quot;
	
	parameters.message += &quot;If you cancel your Pod account with us at any time, we must charge the dismantling fee (0.1 of cost) to re-modify and restore your vessel&#39;s pylon for weapons-use. \n&quot;;
	
	parameters.choicesKey = &quot;cp3Acknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}
}



// create F.E.S. handling fee waiver/restoration request  
this._cp3PrepEx = function(station) {
	station.setInterface(&quot;cp3Ex&quot;,{
	title: &quot;Your FE Shipyards Pod Handling Fee Waiver Request&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards grants Guilders and FE shipowners the privileged option to waive our handling and dismantling fees for the 30-ton pod class.&quot; ,
	callback: this._cp3ShowEx.bind(this)
	});	
}


// show F.E.S. handling &amp; dismantling fee waiver/restoration request
this._cp3ShowEx = function() {
	var priv = ((this.$cp3ET)||(this.$cp3FES));
	var privo = &quot;&quot;;
	if (this.$cp3FES) privo=&quot;FE shipowner&quot;;
	if (this.$cp3ET) privo=&quot;Guilder&quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;Re: your request to waive your 30 TC pod fees.\n\n&quot;
	
	parameters.message += &quot;The handling fee (0.005 of cost) is taken from your account upon docking, and is merely to cover our attachment/detachment &amp; loading/unloading services. The dismantling fee (0.1 of cost) is charged when re-modifying your pylons for weapons-use after Licence cancellation. \n\n&quot;;
	
	if (priv)
		parameters.message += &quot;FE Shipyards grants you, as a &quot;+privo+&quot;, the privileged option to waive our handling and dismantling fees, although you are free - and encouraged - to continue supporting our efforts to provide the efficient service you as an Elite Trader deserve. \n\n&quot;;
	else
		parameters.message += &quot;FE Shipyards regrets that we are unable at this time to grant you an exemption from fees, which is a privilege of Guilders and FE shipowners exclusively. \n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;cp3YesNoEx&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_AYE&quot;)  {
			if (priv) this.$cp3HFExempt = &quot;yes&quot;; else this.$cp3HFExempt = &quot;no&quot;;
		} else this.$cp3HFExempt = &quot;no&quot;;
		player.commsMessage(&quot;FE Shipyards thanks you for your attention.&quot;);
	}	
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/cp4_conditions.js</td>
                    <td><pre>// conditions for award of 40 TC Cargo Pod
&quot;use strict&quot;;
this.name = &quot;CP40 Conditions&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_40TC_POD&quot;) {
		// fittable only if auxiliary pylon is installed
		if (player.ship.equipmentStatus (&quot;EQ_AUX_PYLON&quot;) === &quot;EQUIPMENT_OK&quot;) {
			// and not displayed if any pod is already fitted
			if ((player.ship.equipmentStatus (&quot;EQ_10TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_20TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_30TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_40TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_50TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;))
				return true; else return false;
		} else return false;
	}	
	return true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/cp4_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Cargo Pod 40 TC&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_40TC_POD&quot;) {		
		pc(&quot;Attaching one 40 TC Pod to auxiliary pylon.&quot;,9);
		player.ship.cargoSpaceCapacity += 40;
		pc(&quot;Ship&#39;s total capacity = &quot;+player.ship.cargoSpaceCapacity+&quot; TC.&quot;,9);
		// always 1 because only one pod can be fitted
		this.$cp4Pods=1;
	}	
}


this.equipmentRemoved = function(equipmentKey) {
    var pc=player.consoleMessage;
	if (equipmentKey == &quot;EQ_40TC_POD&quot;) {
		pc(&quot;Detaching one 40 TC Pod from auxiliary pylon.&quot;,9);
		player.ship.cargoSpaceCapacity -= 40;
		pc(&quot;Ship&#39;s total capacity = &quot;+player.ship.cargoSpaceCapacity+&quot; TC.&quot;,9);
	}
}



this.startUpComplete = function () {
	var pc = player.consoleMessage;
	if (missionVariables.cp4Pods != null) 
		this.$cp4Pods = missionVariables.cp4Pods;
	// Load total fees taken
	if (missionVariables.cp4HandlingFeeTotal != null)
		this.$cp4HandlingFeeTotal = missionVariables.cp4HandlingFeeTotal;
	if (missionVariables.cp4HandlingPaid != null)
		this.$cp4HandlingPaid = missionVariables.cp4HandlingPaid;
	if (missionVariables.cp4MaintenanceFeeTotal != null)
		this.$cp4MaintenanceFeeTotal = missionVariables.cp4MaintenanceFeeTotal;
	if (missionVariables.cp4DismantlingFeeTotal != null)
		this.$cp4DismantlingFeeTotal = missionVariables.cp4DismantlingFeeTotal; 
    // Load system-to-system runs w/pod
	if (missionVariables.cp4Runs != null)
		this.$cp4Runs = missionVariables.cp4Runs;
	// Load Handling fee count
	if (missionVariables.cp4HandlingCount != null)
		this.$cp4HandlingCount = missionVariables.cp4HandlingCount;
	// Load handling fee exemption status
	if (missionVariables.cp4HFExempt != null)
		this.$cp4HFExempt = missionVariables.cp4HFExempt;
	// Load Maintenance fee count
	if (missionVariables.cp4MaintenanceCount != null)
		this.$cp4MaintenanceCount = missionVariables.cp4MaintenanceCount;
	// CHECK
	log(this.name, this.name+&quot; startup complete.&quot;);
	// prepare pod Account screen
	var sta = player.ship.dockedStation;
	if (this.$cp4Pods&gt;0) this._cp4PrepAcc(sta);
	// optionally, prepare handling fee waiver request
	if (this.$cp4Pods&gt;0) this._cp4PrepEx(sta);
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// check for G.E.T. presence
	this.$cp4ET = false;
	if (worldScripts[&quot;Elite Trader&quot;]) 
		this.$cp4ET = true;
	// TEST	
	if (this.$cp4ET) log(this.name, &quot;Finds Elite Trader present&quot;);
	// check for FE Ships Player
	this.$cp4FES = false;
	if (worldScripts[&quot;FE Ships Player&quot;]) 
		this.$cp4FES = true;
	// TEST	
	if (this.$cp4ET) log(this.name, &quot;Finds FE Ships Player present&quot;);
	// number of pods - when fitted, always 1
	this.$cp4Pods = 0;
	// purchase cost of pod in cr
	this.$cp4Cost = 40000;
	// handling fee
	this.$cp4HandlingFee = 0.005*this.$cp4Cost; // 0.005 of cost
	this.$cp4HandlingFeeTotal = 0;
	this.$cp4HandlingPaid = &quot;yes&quot;; // or &quot;no&quot; - easier than boolean
	this.$cp4HandlingCount = 0;
	this.$cp4HFExempt = &quot;no&quot;;
	// maintenance fee
	this.$cp4MaintenanceFee = 0.05*this.$cp4Cost; // 0.05 of cost
	this.$cp4MaintenanceFeeTotal = 0;
	this.$cp4MaintenancePaid = &quot;no&quot; // or &quot;yes&quot;
	this.$cp4MaintenanceInterval = 40; // in runs (according to cost)
	this.$cp4MaintenanceCount = 0;
	// dismantling fee
	this.$cp4DismantlingFee = 0.1*this.$cp4Cost; // 0.1 of cost
	this.$cp4DismantlingFeeTotal = 0.0;
	// system-to-system runs w/pod
	this.$cp4Runs = 0;
}


this.playerWillSaveGame = function(message) {
	missionVariables.cp4Pods = this.$cp4Pods;
	// save total fees taken
	missionVariables.cp4HandlingFeeTotal = this.$cp4HandlingFeeTotal;
	missionVariables.cp4MaintenanceFeeTotal = this.$cp4MaintenanceFeeTotal;
	missionVariables.cp4DismantlingFeeTotal = this.$cp4DismantlingFeeTotal;
	missionVariables.cp4HandlingPaid = this.$cp4HandlingPaid;
	// system-to-system runs w/pod
	missionVariables.cp4Runs =this.$cp4Runs;
	// handling fee count
	missionVariables.cp4HandlingCount = this.$cp4HandlingCount;
	// handling fee exemption (G.E.T.)
	missionVariables.cp4HFExempt = this.$cp4HFExempt;
	// maintenance fee count
	missionVariables.cp4MaintenanceCount = this.$cp4MaintenanceCount;
}


this.shipDockedWithStation = function(station) {
	// take handling fee (if not exempt)
	var pc = player.consoleMessage;
	var ex = this.$cp4HFExempt;
	// check we have pods, the fee is not paid, and we&#39;re not exempt
	if ((this.$cp4Pods&gt;0) &amp;&amp; (this.$cp4HandlingPaid===&quot;no&quot;) &amp;&amp; (ex===&quot;no&quot;)) {
		var fee = 0;
		for (var x=1; x&lt;= this.$cp4Pods; x++)
			fee += this.$cp4HandlingFee;
		// record fee and debit trader&#39;s account
		this.$cp4HandlingFeeTotal += fee;
		player.credits -= fee;
		this.$cp4HandlingPaid = &quot;yes&quot;;
		pc(&quot;40 TC Pod handling fees: &quot;+fee+&quot; cr&quot;,9);
		this.$cp4HandlingCount++;
	}

	// conditionally take maintenance fee
	if (this.$cp4Pods&gt;0) this._cp4DoMaintenance();
	
	// prepare pod Account and Licence page
	if (this.$cp4Pods&gt;0) this._cp4PrepAcc(station);
	
	// prepare handling fee waiver request if ET or FESP is present
	if (this.$cp4Pods&gt;0) this._cp4PrepEx(station);
}



this.shipExitedWitchspace = function() {
	// set handling paid to &#39;no&#39;
	this.$cp4HandlingPaid = &quot;no&quot;;
	this.$cp4Runs ++;
}


/* Common helper functions */


// assess and take maintenance fee
this._cp4DoMaintenance = function() {
	var pc = player.consoleMessage;
	var runs = this.$cp4Runs;
	var intv = this.$cp4MaintenanceInterval;
	var mfee = this.$cp4MaintenanceFee;
	// take maintenance fee after y runs
	if ( (runs &gt; 0) &amp;&amp; ((runs % intv)==0) ) {
		// maintenance for x pods
		var fee = 0;
		for (var x=1; x&lt;= this.$cp4Pods; x++)
			fee += mfee;
		// maintenance fee tally &amp; debit
		this.$cp4MaintenanceFeeTotal += fee;
		player.credits -= fee;
		pc(&quot;40 TC Pod Maintenance fees: &quot;+fee+&quot; cr&quot;,9);
		// update Maintenance count
		this.$cp4MaintenanceCount++;
	}
}


/* F4 Interfaces */


// create F.E.S. &#39;Licence &amp; Account&#39; page 
this._cp4PrepAcc = function(station) {
	station.setInterface(&quot;cp4Acc&quot;,{
	title: &quot;Your FE Shipyards 40 TC Pod Class Licence&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;Your FE Shipyards 40 TC Pod account screen shows terms, fees paid, load, and other useful information.&quot;,
	callback: this._cp4ShowAcc.bind(this)
	});	
}


// show F.E.S. &#39;Licence &amp; Account&#39; page
this._cp4ShowAcc = function() {
	var hfc = this.$cp4HandlingCount;
	var mfc = this.$cp4MaintenanceCount;
	var mfi = this.$cp4MaintenanceInterval;
	var hft = this.$cp4HandlingFeeTotal;
	var mft = this.$cp4MaintenanceFeeTotal;
	var dft = this.$cp4DismantlingFeeTotal;
		
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	if (this.$cp4Pods&gt;0) 
		parameters.message +=&quot;Your Account and Licence for 40 TC Class Goods Pods x &quot;+this.$cp4Pods+&quot;: \n\n&quot;; 
	 else
		parameters.message +=&quot;You have no 40 TC Class Pods licensed with us at this time. \n\n&quot;;
	
	parameters.message +=&quot;Handling fees paid: &quot;+hft+&quot; cr (&quot;+hfc+&quot;) \n&quot;;
	parameters.message +=&quot;Maintenance fees paid: &quot;+mft+&quot; cr (&quot;+mfc+&quot;) \n&quot;;
	parameters.message +=&quot;Dismantling fees paid: &quot;+dft+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;Our pods are re-used many times per cycle, often many times per day. Maintaining them in clean and serviceable condition for their maximum useful lifetime is our prime concern at FE Shipyards, and we trust that you, our valued customer, understand the need for your own participation in this costly and ongoing process. \n\n&quot;;
	
	parameters.message += &quot;The handling charge (0.005 of cost) is levied upon docking, the maintenance fee (0.05 of cost) every &quot;+mfi+&quot; system-to-system trading runs. \n\n&quot;
	
	parameters.message += &quot;If you cancel your Pod account with us at any time, we must charge the dismantling fee (0.1 of cost) to re-modify and restore your vessel&#39;s pylon for weapons-use. \n&quot;;
	
	parameters.choicesKey = &quot;cp4Acknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}
}



// create F.E.S. handling fee waiver/restoration request  
this._cp4PrepEx = function(station) {
	station.setInterface(&quot;cp4Ex&quot;,{
	title: &quot;Your FE Shipyards Pod Handling Fee Waiver Request&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards grants Guilders and FE shipowners the privileged option to waive our handling and dismantling fees for the 40-ton pod class.&quot; ,
	callback: this._cp4ShowEx.bind(this)
	});	
}


// show F.E.S. handling &amp; dismantling fee waiver/restoration request
this._cp4ShowEx = function() {
	var priv = ((this.$cp4ET)||(this.$cp4FES));
	var privo = &quot;&quot;;
	if (this.$cp4FES) privo=&quot;FE shipowner&quot;;
	if (this.$cp4ET) privo=&quot;Guilder&quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;Re: your request to waive your 40 TC pod fees.\n\n&quot;
	
	parameters.message += &quot;The handling fee (0.005 of cost) is taken from your account upon docking, and is merely to cover our attachment/detachment &amp; loading/unloading services. The dismantling fee (0.1 of cost) is charged when re-modifying your pylons for weapons-use after Licence cancellation. \n\n&quot;;
	
	if (priv)
		parameters.message += &quot;FE Shipyards grants you, as a &quot;+privo+&quot;, the privileged option to waive our handling and dismantling fees, although you are free - and encouraged - to continue supporting our efforts to provide the efficient service you as an Elite Trader deserve. \n\n&quot;;
	else
		parameters.message += &quot;FE Shipyards regrets that we are unable at this time to grant you an exemption from fees, which is a privilege of Guilders and FE shipowners exclusively. \n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;cp4YesNoEx&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_AYE&quot;)  {
			if (priv) this.$cp4HFExempt = &quot;yes&quot;; else this.$cp4HFExempt = &quot;no&quot;;
		} else this.$cp4HFExempt = &quot;no&quot;;
		player.commsMessage(&quot;FE Shipyards thanks you for your attention.&quot;);
	}	
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/cp5_conditions.js</td>
                    <td><pre>// conditions for award of 50 TC Cargo Pod
&quot;use strict&quot;;
this.name = &quot;CP50 Conditions&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_50TC_POD&quot;) {
		// fittable only if auxiliary pylon is installed
		if (player.ship.equipmentStatus (&quot;EQ_AUX_PYLON&quot;) === &quot;EQUIPMENT_OK&quot;) {
			// and not displayed if any pod is already fitted
			if ((player.ship.equipmentStatus (&quot;EQ_10TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_20TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_30TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_40TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;) &amp;&amp; (player.ship.equipmentStatus (&quot;EQ_50TC_POD&quot;) !== &quot;EQUIPMENT_OK&quot;))
				return true; else return false;
		} else return false;
	}	
	return true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/cp5_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Cargo Pod 50 TC&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_50TC_POD&quot;) {		
		pc(&quot;Attaching one 50 TC Pod to auxiliary pylon.&quot;,9);
		player.ship.cargoSpaceCapacity += 50;
		pc(&quot;Ship&#39;s total capacity = &quot;+player.ship.cargoSpaceCapacity+&quot; TC.&quot;,9);
		// always 1 because only one pod can be fitted
		this.$cp5Pods=1;
	}	
}


this.equipmentRemoved = function(equipmentKey) {
    var pc=player.consoleMessage;
	if (equipmentKey == &quot;EQ_50TC_POD&quot;) {
		pc(&quot;Detaching one 50 TC Pod from auxiliary pylon.&quot;,9);
		player.ship.cargoSpaceCapacity -= 50;
		pc(&quot;Ship&#39;s total capacity = &quot;+player.ship.cargoSpaceCapacity+&quot; TC.&quot;,9);
	}
}



this.startUpComplete = function () {
	var pc = player.consoleMessage;
	if (missionVariables.cp5Pods != null) 
		this.$cp5Pods = missionVariables.cp5Pods;
	// Load total fees taken
	if (missionVariables.cp5HandlingFeeTotal != null)
		this.$cp5HandlingFeeTotal = missionVariables.cp5HandlingFeeTotal;
	if (missionVariables.cp5HandlingPaid != null)
		this.$cp5HandlingPaid = missionVariables.cp5HandlingPaid;
	if (missionVariables.cp5MaintenanceFeeTotal != null)
		this.$cp5MaintenanceFeeTotal = missionVariables.cp5MaintenanceFeeTotal;
	if (missionVariables.cp5DismantlingFeeTotal != null)
		this.$cp5DismantlingFeeTotal = missionVariables.cp5DismantlingFeeTotal; 
    // Load system-to-system runs w/pod
	if (missionVariables.cp5Runs != null)
		this.$cp5Runs = missionVariables.cp5Runs;
	// Load Handling fee count
	if (missionVariables.cp5HandlingCount != null)
		this.$cp5HandlingCount = missionVariables.cp5HandlingCount;
	// Load handling fee exemption status
	if (missionVariables.cp5HFExempt != null)
		this.$cp5HFExempt = missionVariables.cp5HFExempt;
	// Load Maintenance fee count
	if (missionVariables.cp5MaintenanceCount != null)
		this.$cp5MaintenanceCount = missionVariables.cp5MaintenanceCount;
	// CHECK
	log(this.name, this.name+&quot; startup complete.&quot;);
	// prepare pod Account screen
	var sta = player.ship.dockedStation;
	if (this.$cp5Pods&gt;0) this._cp5PrepAcc(sta);
	// optionally, prepare handling fee waiver request
	if (this.$cp5Pods&gt;0) this._cp5PrepEx(sta);
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// check for G.E.T. presence
	this.$cp5ET = false;
	if (worldScripts[&quot;Elite Trader&quot;]) 
		this.$cp5ET = true;
	// TEST	
	if (this.$cp5ET) log(this.name, &quot;Finds Elite Trader present&quot;);
	// check for FE Ships Player
	this.$cp5FES = false;
	if (worldScripts[&quot;FE Ships Player&quot;]) 
		this.$cp5FES = true;
	// TEST	
	if (this.$cp5ET) log(this.name, &quot;Finds FE Ships Player present&quot;);
	// number of pods - when fitted, always 1
	this.$cp5Pods = 0;
	// purchase cost of pod in cr
	this.$cp5Cost = 50000;
	// handling fee
	this.$cp5HandlingFee = 0.005*this.$cp5Cost; // 0.005 of cost
	this.$cp5HandlingFeeTotal = 0;
	this.$cp5HandlingPaid = &quot;yes&quot;; // or &quot;no&quot; - easier than boolean
	this.$cp5HandlingCount = 0;
	this.$cp5HFExempt = &quot;no&quot;;
	// maintenance fee
	this.$cp5MaintenanceFee = 0.05*this.$cp5Cost; // 0.05 of cost
	this.$cp5MaintenanceFeeTotal = 0;
	this.$cp5MaintenancePaid = &quot;no&quot; // or &quot;yes&quot;
	this.$cp5MaintenanceInterval = 50; // in runs (according to cost)
	this.$cp5MaintenanceCount = 0;
	// dismantling fee
	this.$cp5DismantlingFee = 0.1*this.$cp5Cost; // 0.1 of cost
	this.$cp5DismantlingFeeTotal = 0.0;
	// system-to-system runs w/pod
	this.$cp5Runs = 0;
}


this.playerWillSaveGame = function(message) {
	missionVariables.cp5Pods = this.$cp5Pods;
	// save total fees taken
	missionVariables.cp5HandlingFeeTotal = this.$cp5HandlingFeeTotal;
	missionVariables.cp5MaintenanceFeeTotal = this.$cp5MaintenanceFeeTotal;
	missionVariables.cp5DismantlingFeeTotal = this.$cp5DismantlingFeeTotal;
	missionVariables.cp5HandlingPaid = this.$cp5HandlingPaid;
	// system-to-system runs w/pod
	missionVariables.cp5Runs =this.$cp5Runs;
	// handling fee count
	missionVariables.cp5HandlingCount = this.$cp5HandlingCount;
	// handling fee exemption (G.E.T.)
	missionVariables.cp5HFExempt = this.$cp5HFExempt;
	// maintenance fee count
	missionVariables.cp5MaintenanceCount = this.$cp5MaintenanceCount;
}


this.shipDockedWithStation = function(station) {
	// take handling fee (if not exempt)
	var pc = player.consoleMessage;
	var ex = this.$cp5HFExempt;
	// check we have pods, the fee is not paid, and we&#39;re not exempt
	if ((this.$cp5Pods&gt;0) &amp;&amp; (this.$cp5HandlingPaid===&quot;no&quot;) &amp;&amp; (ex===&quot;no&quot;)) {
		var fee = 0;
		for (var x=1; x&lt;= this.$cp5Pods; x++)
			fee += this.$cp5HandlingFee;
		// record fee and debit trader&#39;s account
		this.$cp5HandlingFeeTotal += fee;
		player.credits -= fee;
		this.$cp5HandlingPaid = &quot;yes&quot;;
		pc(&quot;50 TC Pod handling fees: &quot;+fee+&quot; cr&quot;,9);
		this.$cp5HandlingCount++;
	}

	// conditionally take maintenance fee
	if (this.$cp5Pods&gt;0) this._cp5DoMaintenance();
	
	// prepare pod Account and Licence page
	if (this.$cp5Pods&gt;0) this._cp5PrepAcc(station);
	
	// prepare handling fee waiver request if ET or FESP is present
	if (this.$cp5Pods&gt;0) this._cp5PrepEx(station);
}



this.shipExitedWitchspace = function() {
	// set handling paid to &#39;no&#39;
	this.$cp5HandlingPaid = &quot;no&quot;;
	this.$cp5Runs ++;
}


/* Common helper functions */


// assess and take maintenance fee
this._cp5DoMaintenance = function() {
	var pc = player.consoleMessage;
	var runs = this.$cp5Runs;
	var intv = this.$cp5MaintenanceInterval;
	var mfee = this.$cp5MaintenanceFee;
	// take maintenance fee after y runs
	if ( (runs &gt; 0) &amp;&amp; ((runs % intv)==0) ) {
		// maintenance for x pods
		var fee = 0;
		for (var x=1; x&lt;= this.$cp5Pods; x++)
			fee += mfee;
		// maintenance fee tally &amp; debit
		this.$cp5MaintenanceFeeTotal += fee;
		player.credits -= fee;
		pc(&quot;50 TC Pod Maintenance fees: &quot;+fee+&quot; cr&quot;,9);
		// update Maintenance count
		this.$cp5MaintenanceCount++;
	}
}


/* F4 Interfaces */


// create F.E.S. &#39;Licence &amp; Account&#39; page 
this._cp5PrepAcc = function(station) {
	station.setInterface(&quot;cp5Acc&quot;,{
	title: &quot;Your FE Shipyards 50 TC Pod Class Licence&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;Your FE Shipyards 50 TC Pod account screen shows terms, fees paid, load, and other useful information.&quot;,
	callback: this._cp5ShowAcc.bind(this)
	});	
}


// show F.E.S. &#39;Licence &amp; Account&#39; page
this._cp5ShowAcc = function() {
	var hfc = this.$cp5HandlingCount;
	var mfc = this.$cp5MaintenanceCount;
	var mfi = this.$cp5MaintenanceInterval;
	var hft = this.$cp5HandlingFeeTotal;
	var mft = this.$cp5MaintenanceFeeTotal;
	var dft = this.$cp5DismantlingFeeTotal;
		
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	if (this.$cp5Pods&gt;0) 
		parameters.message +=&quot;Your Account and Licence for 50 TC Class Goods Pods x &quot;+this.$cp5Pods+&quot;: \n\n&quot;; 
	 else
		parameters.message +=&quot;You have no 50 TC Class Pods licensed with us at this time. \n\n&quot;;
	
	parameters.message +=&quot;Handling fees paid: &quot;+hft+&quot; cr (&quot;+hfc+&quot;) \n&quot;;
	parameters.message +=&quot;Maintenance fees paid: &quot;+mft+&quot; cr (&quot;+mfc+&quot;) \n&quot;;
	parameters.message +=&quot;Dismantling fees paid: &quot;+dft+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;Our pods are re-used many times per cycle, often many times per day. Maintaining them in clean and serviceable condition for their maximum useful lifetime is our prime concern at FE Shipyards, and we trust that you, our valued customer, understand the need for your own participation in this costly and ongoing process. \n\n&quot;;
	
	parameters.message += &quot;The handling charge (0.005 of cost) is levied upon docking, the maintenance fee (0.05 of cost) every &quot;+mfi+&quot; system-to-system trading runs. \n\n&quot;
	
	parameters.message += &quot;If you cancel your Pod account with us at any time, we must charge the dismantling fee (0.1 of cost) to re-modify and restore your vessel&#39;s pylon for weapons-use. \n&quot;;
	
	parameters.choicesKey = &quot;cp5Acknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}
}



// create F.E.S. handling fee waiver/restoration request  
this._cp5PrepEx = function(station) {
	station.setInterface(&quot;cp5Ex&quot;,{
	title: &quot;Your FE Shipyards Pod Handling Fee Waiver Request&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards grants Guilders and FE shipowners the privileged option to waive our handling and dismantling fees for the 50-ton pod class.&quot; ,
	callback: this._cp5ShowEx.bind(this)
	});	
}


// show F.E.S. handling &amp; dismantling fee waiver/restoration request
this._cp5ShowEx = function() {
	var priv = ((this.$cp5ET)||(this.$cp5FES));
	var privo = &quot;&quot;;
	if (this.$cp5FES) privo=&quot;FE shipowner&quot;;
	if (this.$cp5ET) privo=&quot;Guilder&quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;Re: your request to waive your 50 TC pod fees.\n\n&quot;
	
	parameters.message += &quot;The handling fee (0.005 of cost) is taken from your account upon docking, and is merely to cover our attachment/detachment &amp; loading/unloading services. The dismantling fee (0.1 of cost) is charged when re-modifying your pylons for weapons-use after Licence cancellation. \n\n&quot;;
	
	if (priv)
		parameters.message += &quot;FE Shipyards grants you, as a &quot;+privo+&quot;, the privileged option to waive our handling and dismantling fees, although you are free - and encouraged - to continue supporting our efforts to provide the efficient service you as an Elite Trader deserve. \n\n&quot;;
	else
		parameters.message += &quot;FE Shipyards regrets that we are unable at this time to grant you an exemption from fees, which is a privilege of Guilders and FE shipowners exclusively. \n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;cp5YesNoEx&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_AYE&quot;)  {
			if (priv) this.$cp5HFExempt = &quot;yes&quot;; else this.$cp5HFExempt = &quot;no&quot;;
		} else this.$cp5HFExempt = &quot;no&quot;;
		player.commsMessage(&quot;FE Shipyards thanks you for your attention.&quot;);
	}	
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/csr_conditions.js</td>
                    <td><pre>// conditions for award of Cargo Space Refit
&quot;use strict&quot;;
this.name = &quot;CSR Conditions&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	
	if (equipment == &quot;EQ_CARGO_REFIT&quot;) {
		var charges = 0, csc = 0;
		// if containers are fitted, this will include their capacity
		// so the refit should be ordered before fitting them
		var csc = ship.cargoSpaceCapacity;
		for (var i=1; i&lt;=csc; i++) charges += 500;
		if (player.credits&gt;=charges) return true;
			else return false;
	}
	return true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/csr_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Cargo Space Refit&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	if (equipment == &quot;EQ_CARGO_REFIT&quot;) {
		if (this.$csrFitted==&quot;no&quot;) {
			// increase space by ship&#39;s nominal capacity
			player.ship.cargoSpaceCapacity += this.$csrNominal;
			var pcc=player.ship.cargoSpaceCapacity;
			pc(&quot;Refitting ship to &quot;+pcc+&quot; TC capacity...&quot;,9);
			this.$csrSpace = pcc;
			// charge refit fee according to ship size
			for (var i=1; i&lt;= this.$csrNominal; i++)
				this.$csrCharges += 500;
			// debit customer&#39;s account
			// note: player.credits won&#39;t go into the red!
			player.credits -= this.$csrCharges;
			// reimburse deposit
			var pd = paid/10; // decicredits, so convert
			this.$csrDeposit = pd;
			player.credits += pd;
			pc(&quot;Total cost: &quot;+this.$csrCharges+&quot; cr&quot;,9);
			pc(&quot;F4 to check your invoice.&quot;,9);
			this.$csrFitted = &quot;yes&quot;;
			// prepare Invoice Interface
			var sta = player.ship.dockedStation;			
			this._csrPrepInv(sta);
		} else pc(&quot;Ship already refitted.&quot;,7);
	}	
}


this.equipmentRemoved = function(equipmentKey) {
    var pc=player.consoleMessage;
	if (equipmentKey == &quot;EQ_CARGO_REFIT&quot;) {
		pc(&quot;We cannot un-refit your ship!&quot;,7);
	}
}


this.playerBoughtNewShip = function(ship, price) {
	var pc = player.consoleMessage;
	// reset csr globals and note new capacity
	this.$csrNominal = ship.cargoSpaceCapacity;
	this.$csrSpace = 0;
	this.$csrFitted = &quot;no&quot;;
	this.$csrCharges = 0;
	this.$csrDeposit = 0;	
}


this.shipDockedWithStation = function(station) {
	// conditionally, prepare Invoice Interface
	if (this.$csrFitted==&quot;yes&quot;)	this._csrPrepInv(station);
}


this.startUpComplete = function () {
	var pc = player.consoleMessage;
	if (missionVariables.csrSpace != null) 
		player.ship.cargoSpaceCapacity += missionVariables.csrSpace;
	if (missionVariables.csrFitted != null) 
		this.$csrFitted = missionVariables.csrFitted;
	if (missionVariables.csrCharges != null) 
		this.$csrCharges = missionVariables.csrCharges;
	if (missionVariables.csrDeposit != null) 
		this.$csrDeposit = missionVariables.csrDeposit;
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	this.$csrSpace = 0;
	this.$csrFitted = &quot;no&quot;;
	// record nominal capacity in case Containers are present
	this.$csrNominal = player.ship.cargoSpaceCapacity;
	// initialize charges
	this.$csrCharges = 0;
	// initialize deposit
	this.$csrDeposit = 0;	
}


this.playerWillSaveGame = function(message) {
	missionVariables.csrSpace = this.$csrSpace;
	missionVariables.csrFitted = this.$csrFitted;
	missionVariables.csrCharges = this.$csrCharges;
	missionVariables.csrDeposit = this.$csrDeposit;
}


// create F.E.S. Cargo Space Invoice sheet  
this._csrPrepInv = function(station) {
	station.setInterface(&quot;csrInv&quot;,{
	title: &quot;Your FE Shipyards Invoice for CSR work&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards invites you to check your Invoice for the recent Cargo Space Refit undertaken on your behalf.&quot; ,
	callback: this._csrShowInv.bind(this)
	});	
}


// show F.E.S. Invoice for Cargo Space Refit
this._csrShowInv = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards Invoice for Cargo Space Refit&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;This constitutes your invoice for our successful cargo space refit recently undertaken on your &quot;+player.ship.name+&quot; with nominal capacity &quot;+this.$csrNominal+&quot;  TC.\n\n&quot;;
	
	parameters.message += &quot;Total Charges: &quot;+this.$csrCharges+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;The amount debited from your account includes your initial deposit of &quot;+ this.$csrDeposit + &quot; cr. \n\n&quot;;
	
	parameters.message += &quot;We count, as always, on your satisfaction with our service.\n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;csrAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)
			player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}	
}

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/et_equipment_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	//if (context != &quot;scripted&quot;) return false;
	
	if (equipment == &quot;EQ_ET_AUTODOCK&quot;) return true;
	if (equipment == &quot;EQ_CLOAKING_DEVICE&quot;) return true;
	if (equipment == &quot;EQ_HULL_SHROUD&quot;) return true;

	return true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/et_hull_shroud_device.js</td>
                    <td><pre>/*
FE Shipyards hull shroud
*/

&quot;use strict&quot;;

this.name = &quot;Hull Shroud&quot;;
this.author	= &quot;Reval&quot;;


this.activated = function()
{
	player.ship.isCloaked = !player.ship.isCloaked;
	
	var hs = player.ship.isCloaked;
	var pc = player.commsMessage;
	var ac = &quot;&quot;;
	if (hs) ac=&quot;ACTIVE&quot;; else ac=&quot;inactive&quot;;
	pc(&quot;Hull shroud &quot;+ac,9);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/et_script.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;Elite Trader&quot;;
this.author = &quot;Reval&quot;;
this.description = &quot;Already a meta-game, the Guild of Elite Traders subverts Galcop and turns everything toward Trade. Perks include anti-masslock, witchpoint refuel, a forever-clean record, constant ship-enhancement, bonuses, new ship, lodges, cloak, fast dock; and Market scores count toward Elite. Progress in Grade brings a further edge. But - do not kill!&quot;;
this.license = &quot;CC-BY-NC-SA 4.0&quot;;
this.version = &quot;1.19.2&quot;;


/* 

  Version 1.19.1
  --------------
  
  * A minor revision of the conditions for showing the &quot;noob Grocer&quot; text under G.E.T. Master Advisory. Previously dependent on the number of runs (6), now, once the Grocer has read and acknowleged the introductory text, G.E.T.&#39;s Master Advisory reverts to its true purpose of displaying the buy-prices of the system&#39;s primary commodities.
  
  
  Version 1.19
  ------------

 * Upon docking at a Lodge, G.E.T. will pay a &lt;b&gt;Boon of 100 cr&lt;/b&gt; in appreciation of your patronage of the system&#39;s principal Guild Home.
 * A new &lt;b&gt;F4 Interface&lt;/b&gt; exclusive to the Lodge: the &quot;&lt;u&gt;G.E.T. Guild Lodge Sales Advisory&lt;/u&gt;&quot;, showing sell prices for the two most traded goods at all stations insystem. Those above the Apprentice grade may go on availing themselves of the &lt;u&gt;Witchpoint Trade Advisory&lt;/u&gt; (giving only the single most-traded commodity prices), still a somewhat quicker option for the impatient trader.
 * NPC traffic will now be encountered going into and out of the Guild Lodge - assume most of these ships are Elite Traders!
 * Lodge Guardian Constrictor IIg craft will now respond to &lt;b&gt;S.O.S. signals&lt;/b&gt; from beleaguered vessels, along with any Galcop police present.
 * Lodge-tailored &lt;b&gt;welcome messages&lt;/b&gt; appear at the Guild Lodge after docking there.
 * G.E.T. has done away with Arrivals Screen refuel/repair/enhancement summaries in favour of &lt;u&gt;more succinct console messages&lt;/u&gt;, facilitating swifter passage to the Market. The Guilder is directed now to the &lt;b&gt;F4 Interfaces&lt;/b&gt; for fuller data on recent ship enhancements under &quot;&lt;u&gt;G.E.T. Ship Status Report&lt;/u&gt;&quot;.
 * Various persistent - and perhaps annoying - ET behavioural glitches have been remedied.
 * At every system&#39;s witchpoint you will find a &lt;b&gt;Guild Lodge&lt;/b&gt;. In keeping with G.E.T.&#39;s arcane and esoteric Order, these are small &lt;u&gt;pyramidal&lt;/u&gt; stations offering welcome, ceremonial, cameraderie, and a trading floor - but no shipyard. One of the Lodge&#39;s external faces sports Galcop insignia for obfuscatory purposes and to assure a small police presence. &lt;u&gt;Games may not be saved&lt;/u&gt; from inside a Lodge. The Guild Lodge flashes green and orange on your scanner.
 * An ancient Guild tradition is the deployment of &lt;b&gt;three guardian ships&lt;/b&gt;. Today, these are well-equipped Constrictor IIg models. A guardian will do nothing but patrol near the Lodge, unless disturbed. Guardians, in addition to the small (suborned) police presence which all Lodges attract, make a Guild Lodge&#39;s vicinity one of the safest - if not &lt;i&gt;the&lt;/i&gt; safest - in the entire system. Guardian ships flash blue and orange on your scanner.
 * The Guild accounts as a &lt;b&gt;gift&lt;/b&gt; the rescuing of any escape pod, be its occupant of the innocent or the guilty. Saving the helplessly adrift will gain a Guilder not only merit, but also, as befits a gift of this nature, a &lt;b&gt;5-point ship enhancement&lt;/b&gt; plus a real &lt;b&gt;Gift to the Guild of 1000 credits&lt;/b&gt; to further Grade advancement. This of course &lt;u&gt;on top of any bounty&lt;/u&gt; that Galcop deems you worthy of.
 * &quot;Cloaking technology&quot; - that &#39;Galcop advance&#39; much rumoured and whispered about - was, in fact, long ago an invention of the Guild. They called their device the &lt;b&gt;Hull Shroud&lt;/b&gt;. Needless to say, you, as a Guilder, can have it - at a price. Seek it at Stations with a high technological index.
 * The &lt;b&gt;Constrictor II&lt;/b&gt; - FE Shipyards&#39; &#39;black project&#39; - is no longer the restricted perk only of Grand Masters. You, as a lowly &#39;Master&#39; will now find it available, if you look hard. And it&#39;s not at all expensive! [nominal specs: thrust = 26; speed = 350; pylons = 4; capacity = 80 TC. Please note: this &lt;u&gt;exclusive ET ship&lt;/u&gt; is designed for parity with &lt;b&gt;FE Ships&lt;/b&gt;, not vanilla Oolite ships.]
 * G.E.T. will pay to all Guilders except Grocers a regular and periodic &lt;b&gt;Bonus&lt;/b&gt;. Guild bonuses are in gratitude for &quot;service, devotion, and fortitude.&quot; Bonuses are time-, Grade-, and performance-dependant: &lt;u&gt;the higher you are in Grade&lt;/u&gt; and the more &lt;u&gt;credits you have banked&lt;/u&gt;, the higher will be your Bonus.
 * G.E.T. owns to a new &lt;u&gt;sensitivity&lt;/u&gt; to their Guilders&#39; &lt;b&gt;species-gender&lt;/b&gt; - you can be addressed now as &quot;Sister&quot;, &quot;Brother&quot;, &quot;Sibling&quot; (bi-,&amp;nbsp;tri-&amp;nbsp;or null-sexed&amp;nbsp;persons), or just &#39;Guilder&#39; (the default).
 * As well as speedier Grade advancement, your &lt;b&gt;gifts&lt;/b&gt; to the Guild bring with them &lt;b&gt;3-point ship enhancements&lt;/b&gt;.
 * Practical &lt;b&gt;console advisories&lt;/b&gt; onstation for Grocers who have not yet made 4&amp;nbsp;runs.
 * G.E.T. begins to take account of &lt;b&gt;time&lt;/b&gt;...
 * &lt;b&gt;Time spent as a Good Guilder&lt;/b&gt; is recorded on your F5F5 Manifest in &lt;u&gt;Lave days&lt;/u&gt; (and Lave years).
 * &lt;b&gt;System-to-System Runs&lt;/b&gt; as a Good Guilder are numerically displayed on the F5F5 Manifest.
 * Main Station no longer mass-locks your ship on approach (so please take care you don&#39;t slam into it!) (Grade 1 and above)

   Version 1.18
   ------------
 * In spite of the addition of the new F4 page &#39;Gift to Guild&#39; (which speeds advancement in Grade), progression to the Elevated and Exalted Grades (10-22) has been made more arduous.
 * Donations are no longer limited to one per system: they are cumulative within the system.
 * &quot;Buber&#39;s Beats&quot; Milk Run guide for inductees on the F4 Interfaces screen.
 * &#39;Milk or Cream? - Buber&#39;s Beats&#39; - a comprehensive wiki section with solid guidance, a truncated version of which appears in-game.
 * Owing to a ballooning volume of Guild applications (blame TM!), the &#39;black box&#39; anti-Masslock device is now reserved for Probationary Grade 1 and above.
 * Buying and selling from and to multiple stations insystem is facilitated.
 * More data now appears on the G.E.T. F5 Mission screen.
 * Gifts and Last trade (with star, station, and goods) added to F5 Mission screen.
 * Since space allows it, a station&#39;s secondary legal commodity is now listed by the F4 Master Advisory along with the primary.
 * Much revision of the F4 Interfaces texts.
 * More immersive comms messages geared to Grocers.
 * Witchpoint Trade Advisory messages made more succinct.
 * A slight re-ordering and renaming of the G.E.T. Grades.
		
 (Please see https://wiki.alioth.net/index.php/Elite_Trader_OXZ)
		 
*/

	
this.playerSoldCargo = function(commodity, units, price) {
	var sale = 0, tp = &quot;&quot;, tm = &quot;&quot;, c=commodity,
	prec = ((c==&quot;gold&quot;)||(c==&quot;platinum&quot;)||(c==&quot;gem_stones&quot;));
	// Guild sales are conditional upon...
	var cond = ((this.$etLastPrice[c]&gt;0) &amp;&amp; (!prec));
	// selling preliminaries - update quantity and price
	if (cond) {
		sale = price * units;
		// this sale&#39;s profit &amp; total profit
		this.$etProfit = sale - this.$etLastBuy[c];
		// note the commodities sold
		if (this.$etProfit&gt;0) this.$etCommodities += c + &quot; &quot;;
		// allow for multiple station trades insystem (TEST!)
		//this.$etLastProfit = this.$etTotProfit;
		this.$etTotProfit += this.$etProfit;
		// allow for multiple station trades insystem (TEST!)
		this.$etLastProfit = this.$etTotProfit;
		// prepare trade messages
		tp=&quot;   ( &quot;+formatCredits(this.$etTotProfit/10,true,true)+&quot; )&quot;;
		tm=&quot;Trade (&quot;+c+&quot;): &quot;+formatCredits(this.$etProfit/10,true,true);
		/* max trade is calculated outside Market screen */
	}
	// see if we made a profit 
	this.$etMadeProfit = ((this.$etProfit&gt;0) &amp;&amp; (cond));

	// conditions for scoring
	this.$etOKtoScore = ((units &gt; 2) &amp;&amp; (!this.$etDone) &amp;&amp; (this.$etBoughtUnits&gt;0) &amp;&amp; (this.$etMadeProfit) &amp;&amp; (!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig) &amp;&amp; (!this.$etIsScooper));
	
	// decrement the manifest by # of units and price
	if (cond) {
		this.$etBoughtUnits -= units;
		this.$etBoughtPrice -= this.$etLastPrice[c] * units;
	}
	// display ship&#39;s cargo and its purchase value
	if ((price==this.$etLastPrice[c]) &amp;&amp; (!prec)) this._etPodsInHold(this.$etBoughtUnits);	

	var pm = player.consoleMessage;
	// credit a &quot;market killing&quot; on first profitable sell
	if (this.$etOKtoScore) {
		player.score++;
		this.$etPoints++;
		this.$etHasScored = true;
		pm(&quot;You made a killing!&quot;+tp);
		if (!this.$etMarketObserver) pm(tm);
		// for simplicity, only one score per station
		this.$etDone = true;
	// otherwise acknowledge a skillful trade if we&#39;re not just unloading
	} else if (this.$etMadeProfit &amp;&amp; (price!=this.$etLastPrice[c]) &amp;&amp; (this.$etStation!=this.$etLastStation)) {
		pm(&quot;Nice trade!&quot;+tp);
		if (!this.$etMarketObserver) pm(tm);
	}
}
	

this.playerBoughtCargo = function (commodity, units, price) {
	var c=commodity,
	prec = ((c==&quot;gold&quot;)||(c==&quot;platinum&quot;)||(c==&quot;gem_stones&quot;));
	// buying preliminaries - record quantity and price
	if (!prec) {
		this.$etBoughtUnits += units;
		this.$etBoughtPrice += price * units;
		this.$etLastBuy[c] = price * units;
		this.$etLastPrice[c] = price;
		// display ship&#39;s cargo and its purchase value
		this._etPodsInHold(this.$etBoughtUnits);
	}
}


this.guiScreenChanged = function(to, from) {
	var pm = player.consoleMessage;
	// update G.E.T. Status on Manifest screen
	if (from == &quot;GUI_SCREEN_MARKET&quot;) {
		// record last profit - for multiple station trades (TEST!)
		this.$etLastProfit=this.$etTotProfit;
		this._etGetMaxTrade();
		// deduct donation from player&#39;s credits
		if (this.$etProfit&gt;0) {
			this.$etDonation = this._etGetDonation(this.$etTotProfit);
			if (this.$etDonation&gt;0) {
				this.$etDonations += this.$etDonation;
				// donation is decicredits, so convert
				player.credits -= this.$etDonation/10; 
				pm(&quot;Your gift is accepted with appreciation.&quot;,5);
				pm(&quot;Advancement is secure!&quot;,5);
			}
		}
		// include donation in status report
		this._etShowStatus();
	} else
	if (to == &quot;GUI_SCREEN_MARKET&quot;) {
		// reset local individual profit
		if (!this.$etCheat) this.$etProfit=0;
		// a G.E.T. presence on the market floor
		pm(&quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;, 5);
		// show hold-status on entering Market
		var pods = this._etPodCount();
		this._etPodsInHold(pods);
		// advise player to unload and re-buy cargo after game-load w/ full hold
		if ((pods&gt;0) &amp;&amp; (this.$etBoughtPrice&lt;=0)) pm(&quot;Elite Trader: Please sell cargo and re-buy.&quot;,5); 
	} else
	if (to == &quot;GUI_SCREEN_MANIFEST&quot;) {
		// show best trade status on Manifest screen
		this._etShowStatus();
		// G.E.T. presence on the Manifest screen
		pm(&quot;Under the aegis of the &quot;+this.$etSystem+&quot; G.E.T&quot;, 10);
	} else 
	if (to == &quot;GUI_SCREEN_STATUS&quot;)
		if (!this.$etVowing) {
			if (this.$etIsWelcomed) {
				if (!this.$etMadeProfit)
					pm(&quot;We trust your stay at &quot;+this.$etSystem+&quot; proves profitable!&quot;, 10);
				else pm(this.$etSystem+&quot; is your lucky star!&quot;, 10);
			} else {
				// Welcome only said here!
				if (!this.$etIsWelcomed) this._etSayWelcome();
			} 
		} else this.$etVowing = false;
}


this.shipDockedWithStation = function(station) {
	this.$etLastStation = this.$etStation;
	this.$etStation = station;
	this.$etLastSystem = this.$etSystem;
	// clear flags and sold-quantities on docking
	this.$etDone = false;
	this.$etMadeProfit = false;
	this.$etHasScored = false;
	this.$etProfit = 0;
	// total profit is reset at WP exit
	this.$etCommodities = &quot;&quot;;
	// leave an identical ship at the shipyard
	// in case player wishes to reset its specs
	this._etCloneShip();
	var stan = player.ship.dockedStation.name;
	if (!this.$etBeenBellig) {
		// prep G.E.T. Advsory interface
		this._etPrepAdvisory(station);
		// prep G.E.T. Max Trade Resetter
		this._etPrepResetter(station);
		// prep G.E.T. Ship Status Report
		this._etPrepShipStatus(station);
		// prep G.E.T. Gift to Guild
		this._etPrepGift(station);
		// prep walkthrough
		this._etPrepBeats (station);
		// if at a Lodge, prep Sales Advisory
		if (stan==&quot;G.E.T. Guild Lodge&quot;)
			this._etPrepSales(station);
		// prep gender if not yet known
		if (!this.$etGendered)
			this._etPrepGender(station);
	} else this._etPrepVow(station);
	// generate G.E.T. contact name (Assessor)
	this.$etContact = randomName() + &quot; &quot; + randomName();
	// calculate monthly bonus (if any)
	var mb = this._etGetMBonus();
	var dy = this._etGetDays();
	var ld = this.$etLastBonusDay;
	if ((mb &gt; 0) &amp;&amp; (ld != dy)) {
		player.credits += mb;
		this.$etBonuses += mb;
		this.$etBonusCount ++;
		// prevent double bonus
		this.$etLastBonusDay = dy; 
	}
	// At least one Constrictor II customer model
	if (system.techLevel&gt;=10) this._etAddShip(&quot;FE_constrictor2-player&quot;, &quot;Constrictor II&quot;, 143000);
}


this.shipWillDockWithStation = function(station) {
	var pc = player.consoleMessage;
	// Boon for docking with a Guild Lodge
	if (station.name == &quot;G.E.T. Guild Lodge&quot;) { 
		if (!this.$etBooned) {
			player.credits+=100.0;
			pc(this.$etBro+&quot;, your Guild Boon has been given.&quot;);
			this.$etBooned = true;
		}
	}
	var p=player.ship;
	if ((!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig)) {
		// refuel a good Guilder&#39;s ship
		p.fuel = 7;
		// repair a good Guilder&#39;s ship
		p.serviceLevel = 100;
		pc(&quot;Ship refuelled and repaired...&quot;,9);
		// if the Brother&#39;s recent trades were satisfactory...
		if (this.$etHasScored) { 
			// incremental enhancements for the Guilder&#39;s ship
			this._etEnhanceShip(1);
			// report refuel, repair, and enhancement
			pc(&quot;Ship enhancements +1 - see F4 Interfaces.&quot;,9);
			pc(&quot; &quot;);
		}
	}
	// remove fast-docking equipment
	p.removeEquipment(&quot;EQ_ET_AUTODOCK&quot;);
	// reset station profit
	this.$etLastProfit=0;
}


this.shipWillLaunchFromStation = function(station) {
	// G.E.T. ensures the good Brother&#39;s record is always clean
	if ((!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig)) {
		player.ship.bounty = 0;
		// enable fast docking
		this._installAutoDock();
	}
	this.$etIsWelcomed = false;
}


this.shipLaunchedFromStation = function(stationLaunchedFrom) {
	if (!this.$etBeenBellig)
		player.commsMessage(&quot;The &quot;+this.$etSystem+&quot; G.E.T. Aegis wishes you clear lanes and a quiet passage. Return safe!&quot;, 6);
	// weapons offline is the G.E.T. approved setting
	//player.ship.weaponsOnline = false; // doesn&#39;t appear to be writable
}


this.playerStartedJumpCountdown = function(type, seconds) {
	if (!this.$etBeenBellig)
		player.commsMessage(&quot;Be careful out among the miscreants &quot;+this.$etBro+&quot;!&quot;,6);
	if ((!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig) &amp;&amp; (!this.$etIsScooper) &amp;&amp; (!player.ship.weaponsOnline)) player.ship.massLockable = this._etStrict();
}


this.shipEnteredStationAegis = function(station) {
	if (!this.$etBeenBellig)
		player.commsMessage(&quot;The Galactic Guild of Elite Traders welcomes you to &quot;+this.$etSystem+&quot; Aegis! We are at your disposal in the shipyard. Trade well!&quot;, 6);
	player.ship.massLockable = this._etStrict(); // true: no slamming into station
}


this.weaponsSystemsToggled = function(state) {
	// Strict mode for Grade 0, or not...
	if (this._etStrict()) {
		player.ship.massLockable = true;
		player.commsMessage(this.$etBro+&quot;, Grade 1 must be attained...&quot;,9);
		player.commsMessage(&quot;Please take care off-lane.&quot;,9);
	} else {
		// weapons online enables mass-locking
		player.ship.massLockable = state;
		if (state) var s=&quot;OFF&quot;; else var s=&quot;ON&quot;;
		player.commsMessage(&quot;Anti-masslock system &quot;+s);
	}
}


this.shipKilledOther = function(whom, damageType) {
	 // discount tins of SPAM and rocks
	 if ((whom.name!=&quot;SPAM&quot;) &amp;&amp; (whom.name!=&quot;Asteroid&quot;)) {
		pm = player.commsMessage;
		// G.E.T. disapproval
		pm(this.$etSystem+&quot; G.E.T. notes their Brother&#39;s lapse...&quot;);
		this.$etKillCount++;
		this.$etIsBellig = (this.$etKillCount&gt;0); // temporary
		// a single kill might be accidental, but 3? - unlikely!
		if (this.$etKillCount&gt;2) { 
			this.$etBeenBellig = true; // permanent - a blot on the record
			this._etFloorSpecs(); // ship specs back to nominal
			// refund donations
			player.credits += this.$etDonations/10;
			// and reset them
			this.$etDonations = 0.0;
			pm(&quot;Your gifts to the Guild have been returned.&quot;);
			pm(&quot;All G.E.T. privileges are rescinded.&quot;);
			pm(&quot;Vow to be a better Brother!&quot;);
		}
	}
}


this.shipScoopedOther = function(whom) {
     // G.E.T. disapproval
	player.commsMessage(this.$etSystem+&quot; G.E.T. notes their Brother&#39;s lapse...&quot;);
	this.$etIsScooper = true;
}


this.playerRescuedEscapePod = function(fee, reason, occupant) {
    pc=player.commsMessage;
	// G.E.T. accounts the saving of any miscreant a _gift_
	// the Guilder&#39;s selfless act does not go unrewarded
	player.credits += 1000.0;
	this._etEnhanceShip(5);
	pc(this.$etBro+&quot;, we account your saving of this miscreant a *gift*...&quot;,9);
	pc(&quot;Your selfless and noble act has not gone unrewarded!&quot;,9);
}


this.shipEnteredPlanetaryVicinity = function(planet) {
	player.commsMessage(&quot;Entering gravity of &quot;+this._etGetPlanetName(planet));
	// Weps will always masslock near planets
	if (player.ship.weaponsOnline) player.ship.massLockable = this._etStrict(); // no slamming into planet
}


this.shipExitedPlanetaryVicinity = function(planet) {
	player.commsMessage(&quot;Leaving gravity of &quot;+this._etGetPlanetName(planet));
	if ((!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig) &amp;&amp; (!this.$etIsScooper) &amp;&amp; (!player.ship.weaponsOnline)) player.ship.massLockable = this._etStrict();
}


this.shipExitedWitchspace = function() {
	// add Guild Lodge and 3 Guardians
	var adds = system.legacy_addShipsWithinRadius;
	adds(&quot;lodge&quot;, 1, &quot;wpu&quot;, [0, 0, 0], 6400);
	adds(&quot;guardian&quot;, 3, &quot;wpu&quot;, [0, 0, 0], 6400);
	// reset globals that require it
	this.$etSystem = System.systemNameForID(system.ID);
	this.$etIsWelcomed = false;
	if (this.$etKillCount&gt;0) this.$etKillCount--;
	this.$etIsBellig = (this.$etKillCount&gt;0);
	this.$etIsScooper = false;
	// total profit is for system
	this.$etTotProfit = 0;
	// (reset) for multiple station trades
	this.$etLastProfit = 0;
	this._etGetMaxTrade();
	// one donation and gift per system
	this.$etDonated = false;
	this.$etGifted = false;
	// no-skip in Grade check (reset for system)
	this.$etLastGrade = 0;
	// build G.E.T. status screen
	this._etShowStatus();
	// witchpoint fuelling for GBs past probation
	var p=player.ship, pc=player.commsMessage;
	if ((!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig) 
		&amp;&amp; (!p.weaponsOnline) &amp;&amp; (this._etGetGrade()&gt;1)) {
		p.fuel = 7;
		pc(&quot;&quot;); // LF
		pc(&quot;Witchpoint fuelling complete.&quot;);
		pc(this.$etSystem+&quot; G.E.T. wishes their &quot;+this.$etBro+&quot; a peaceful jump.&quot;);
		// witchpoint Trade Advisory (where to sell)
		this._etCommsTradeAdvisory();
	}
	// advice for Grocers
	if (this._etStrict()) pc(this.$etBro+&quot; Grocer, go off-lane... be safe!&quot;);
	// increment number of sys-to-sys runs
	this.$etRuns+=1;
	// Guild Boon once per system
	this.$etBooned = false;
	// report miscreants in system
	var mis = system.countShipsWithPrimaryRole(&quot;pirate&quot;);
	pc(&quot; &quot;);
	pc(&quot;Miscreants in system: &quot;+mis,9);
	pc(&quot; &quot;);
}


this.playerBoughtNewShip = function(ship, price) {
	// spec globals to ship&#39;s initial values
	this._etResetSpecs();
	this.$etShipChanged = true;
	this._etGetMaxTrade();
	this._etShowStatus();
}


this.playerWillSaveGame = function(message) {
	missionVariables.etSpeed = this.$etLastSpeed; 
	missionVariables.etThrust = this.$etLastThrust;
	missionVariables.etEnergy = this.$etLastEnergy;
	missionVariables.etShields = this.$etLastShields;
	missionVariables.etRecharge = this.$etLastRecharge;
	missionVariables.etERecharge = this.$etLastERecharge;
	missionVariables.etPoints = this.$etPoints;
	missionVariables.etKills = this.$etKillCount;
	missionVariables.etMaxTrade = this.$etMaxTrade;
	missionVariables.etMinTrade = this.$etMinTrade;
	missionVariables.etMaxTSystem = this.$etMaxTSystem;
	missionVariables.etMaxTGoods = this.$etMaxTGoods;
	missionVariables.etMaxTShip = this.$etMaxTShip;
	missionVariables.etMaxTShipName = this.$etMaxTShipName;
	missionVariables.etMaxTShipTC = this.$etMaxTShipTC;
	missionVariables.etVowCount = this.$etVowCount;
	missionVariables.etDonations = this.$etDonations;
	missionVariables.etGifts = this.$etGifts;
	missionVariables.etGiftCount = this.$etGiftCount;
	missionVariables.etGendered = this.$etGendered;
	missionVariables.etBro = this.$etBro; // gender!
	missionVariables.etRuns = this.$etRuns;
	missionVariables.etYears = this.$etYears;
	missionVariables.etDays = this.$etDays;
	missionVariables.etDaysStart = this.$etDaysStart; // set only once in script!
	missionVariables.etBonuses = this.$etBonuses;
	missionVariables.etBonusCount = this.$etBonusCount;
	missionVariables.etLastBonusDay= this.$etLastBonusDay;
	missionVariables.etNoob= this.$etNoob;
	// cannot save booleans as &quot;false/true&quot; - must convert
	// set only once at Guilder career start
	if (this.$etDaysStarted) var dstd=1; else var dstd=0;
	missionVariables.etDaysStarted = dstd;
	// cannot save booleans as &quot;false/true&quot; - must convert
	if (this.$etGendered) var gen=1; else var gen=0;
	missionVariables.etGendered = gen;
	// cannot save booleans as &quot;false/true&quot; - must convert
	if (this.$etStrict) var strct=1; else var strct=0;
	missionVariables.etStrict = strct;
	// cannot save booleans as &quot;false/true&quot; - must convert
	if (this.$etBeenBellig) var bb=1; else var bb=0;
	missionVariables.etBeenBellig = bb;
}


this.startUpComplete = function () {
	var p = player.ship;
	this.$etSystem = System.systemNameForID(system.ID);
	this._etResetSpecs();
	// default is current ship
	this.$etMaxTShip = p.shipClassName;
	this.$etMaxTShipName = p.shipUniqueName;
	this.$etMaxTShipTC = p.cargoSpaceCapacity;
	// Load saved globals, if present
	var spd = missionVariables.etSpeed;
	var thr = missionVariables.etThrust;
	var ene = missionVariables.etEnergy;
	var shi = missionVariables.etShields;
	var rec = missionVariables.etRecharge;
	var rece = missionVariables.etERecharge;
	
	if (spd&gt;=this.$etInitialSpeed) this.$etLastSpeed = spd;
	if (thr&gt;=this.$etInitialThrust) this.$etLastThrust = thr;
	if (ene&gt;=this.$etInitialEnergy) this.$etLastEnergy = ene;
	if (shi&gt;=this.$etInitialShields) this.$etLastShields = shi;
	if (rec&gt;=this.$etInitialRecharge) this.$etLastRecharge = rec;
	if (rece&gt;=this.$etInitialERecharge) this.$etLastERecharge = rece;
	
	if (spd&gt;=this.$etInitialSpeed) p.maxSpeed = spd;
	if (thr&gt;=this.$etInitialThrust) p.maxThrust = thr;
	if (ene&gt;=this.$etInitialEnergy) p.maxEnergy = ene;
	if (shi&gt;=this.$etInitialShields) p.maxForwardShield = shi;
	if (rec&gt;=this.$etInitialRecharge) p.forwardShieldRechargeRate = rec;
	if (rece&gt;=this.$etInitialERecharge) p.energyRechargeRate = rece;
	// load points here too
	var pts = missionVariables.etPoints; if (pts&gt;0) this.$etPoints = pts;
	var kil = missionVariables.etKills; if (kil&gt;0) this.$etKillCount = kil; 
	var maxt = missionVariables.etMaxTrade; this.$etMaxTrade = maxt;
	var mint = missionVariables.etMinTrade; this.$etMinTrade = mint;
	var maxts = missionVariables.etMaxTSystem; this.$etMaxTSystem = maxts;
	var maxtg = missionVariables.etMaxTGoods; this.$etMaxTGoods = maxtg;
	var maxts = missionVariables.etMaxTShip; if (maxts!=&quot;&quot;) this.$etMaxTShip = maxts;
	var maxtn = missionVariables.etMaxTShipName; if (maxtn!=&quot;&quot;) this.$etMaxTShipName = maxtn;
	var maxtt = missionVariables.etMaxTShipTC; if (maxtt!=0) this.$etMaxTShipTC = maxtt;
	var vc = missionVariables.etVowCount; if (vc!=null) this.$etVowCount = vc;
	var dons = missionVariables.etDonations; if (dons!=null) this.$etDonations = dons;
	var gifts = missionVariables.etGifts; if (gifts!=null) this.$etGifts = gifts;
	var gcount = missionVariables.etGiftCount; if (gcount!=null) this.$etGiftCount=gcount;
	var bro = missionVariables.etBro; if (bro!=null) this.$etBro = bro;
	var runs = missionVariables.etRuns; if (runs!=null) this.$etRuns = runs;
	var yrs = missionVariables.etYears; if (yrs!=null) this.$etYears = yrs;
	var days = missionVariables.etDays; if (days!=null) this.$etDays = days;
	var dayst = missionVariables.etDaysStart; if (dayst!=null) this.$etDaysStart = dayst;
	var bons = missionVariables.etBonuses; if (bons!=null) this.$etBonuses = bons;
	var bc = missionVariables.etBonusCount; if (bc!=null) this.$etBonusCount = bc;
	var lbd = missionVariables.etLastBonusDay; if (lbd!=null) this.$etLastBonusDay = lbd;
	var noo = missionVariables.etNoob; if (noo!=null) this.$etNoob = noo;
	// have we started the clock? - permanent and persistent
	if (missionVariables.etDaysStarted != null) {
		var dstd=missionVariables.etDaysStarted;
		this.$etDaysStarted = (dstd == 1);
	}
	// cannot load booleans as &quot;true/false&quot; - must convert
	if (missionVariables.etBeenBellig != null) {
		var bb=missionVariables.etBeenBellig;
		this.$etBeenBellig = (bb == 1);
		// floor ship specs if the Brother went bad
		if (this.$etBeenBellig) this._etFloorSpecs();
	}
	// waive or allow Grade 0 strictures
	if (missionVariables.etStrict != null) {
		var strct=missionVariables.etStrict;
		this.$etStrict = (strct == 1);
	}
	// Gender-check (persistent)
	if (missionVariables.etGendered != null) {
		var gen=missionVariables.etGendered;
		this.$etGendered = (gen == 1);
	}
	// loading globals complete.
	if (this._etHasFE()) log(this.name, &quot;finds FE Ships present (&quot;+p.shipClassName+&quot;)&quot;);
	// dock ship
	var sta = p.dockedStation;
	this.shipDockedWithStation(sta);
	// welcome revenant back to station
	var pc = player.consoleMessage, s=this.$etSystem;
	if (this.$etRuns&gt;0) pc(&quot;Delighted to have you back at &quot;+s+&quot;, &quot;+this.$etBro+&quot;!&quot;,9);
	this._etGetMaxTrade();
	this._etShowStatus();
	var stan = player.ship.dockedStation.name;
	if (!this.$etBeenBellig) {
		// prep G.E.T. Advisory interface
		this._etPrepAdvisory(sta);
		// prep G.E.T. Max Trade Resetter
		this._etPrepResetter(sta);
		// prep G.E.T. Ship Status Report
		this._etPrepShipStatus(sta);
		// prep Gift solicitation
		this._etPrepGift (sta);
		// prep walkthrough
		this._etPrepBeats (sta);
		// if at a Guild Lodge, prep Sales Advisory
		if (stan==&quot;G.E.T. Guild Lodge&quot;)
			this._etPrepSales(sta);
		// conditionally, prep gender request
		if (!this.$etGendered) this._etPrepGender(sta);
	} else this._etPrepVow(sta);
	// set Grade Advance divisor according to present Grade
	var grade=this._etGetGrade();
	this._etSetGradeAdvance(grade);
	// determine strictness (anti-masslock on or off)
	this.$etStrict = this._etStrict();
	// start the career clock if not already started
	if (!this.$etDaysStarted) { 
		this.$etDaysStart = clock.days;
		this.$etDaysStarted = true;
	}
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// declare &amp; initialize globals
	this.$etMarketObserver = false;
	if (worldScripts[&quot;market_observer3&quot;]) 
		this.$etMarketObserver = true;
	this.$etNoob = &quot;yes&quot;;
	this.$etIsWelcomed = false;
	this.$etDone = false;
	this.$etMadeProfit = false;
	this.$etOKtoScore = false;
	this.$etHasScored = false;
	this.$etIsWelcomed = false;
	this.$etShipChanged = false;
	this.$etIsScooper = false;
	this.$etIsBellig = false; // temporary
	this.$etBeenBellig = false; // permanent
	this.$etDonated = false;
	this.$etGifted = false;
	this.$etKillCount = 0; // ship-kills
	this.$etPoints = 0; // G.E.T. Elite-points scored
	this.$etVowCount = 0;
	this.$etVowing = false; // controls post-vow message
	this.$etBoughtPrice = 0;
	this.$etBoughtUnits = 0;
	this.$etProfit = 0;
	this.$etTotProfit = 0;
	this.$etLastProfit = 0; // for multiple station trades insystem
	this.$etMaxTrade = 0;
	this.$etMinTrade = 1000000;
	this.$etDonation = 0.0; // donation on station profit
	this.$etDonations = 0.0; // total &#39;donations&#39; to G.E.T.
	this.$etGift = 0.0; // &#39;gift&#39; (voluntary) of station profit
	this.$etGifts = 0.0; // total &#39;gifts&#39; to Guild coffers
	this.$etGiftCount= 0; // how many gifts we&#39;ve given
	this.$etStrict=true; // waive or allow Grade 0 stricture
	this.$etLastGrade=0; // for Grade no-skip check
	this.$etSystem = &quot;&quot;;
	this.$etLastSystem = &quot;&quot;;
	this.$etNextSystem = &quot;&quot;;
	this.$etContact = &quot;&quot;; // named station contact (Assessor)
	this.$etCommodities = &quot;&quot;; // commodities sold
	this.$etMaxTSystem = &quot;&quot;; // best trade&#39;s systen
	this.$etMaxTGoods = &quot;&quot;; // best trade&#39;s commodity
	this.$etMaxTShip = &quot;&quot;; // best trade&#39;s ship class
	this.$etMaxTShipName = &quot;&quot;; // best trade&#39;s ship name
	this.$etMaxTShipTC = 0; // best trade&#39;s ship tonnage
	this.$etStation = new Object(); // ??
	this.$etLastStation = new Object(); // ??
	this.$etLastPrice = new Array();
	for (var c=0; c&lt;20; c++) this.$etLastPrice[c]=0;
	this.$etLastBuy = new Array();
	for (c=0; c&lt;20; c++) this.$etLastBuy[c]=0;
	
	this.$etInitialSpeed = 0;
	this.$etInitialThrust = 0;
	this.$etInitialEnergy = 0;
	this.$etInitialShields = 0;
	this.$etInitialRecharge = 0.0; // shields recharge
	this.$etInitialERecharge = 0.0; // energy recharge

	this.$etLastSpeed = 0.0; 
	this.$etLastThrust = 0;
	this.$etLastEnergy = 0;
	this.$etLastShields = 0;
	this.$etLastRecharge = 0.0;
	this.$etLastERecharge = 0.0;
	
	// constants
	this.$etLimitSpeed = 512;
	this.$etLimitThrust = 256;
	this.$etLimitEnergy = 1024;
	this.$etLimitShields = 512;
	this.$etLimitRecharge = 16.0; // shield-R should be half energy-R
	this.$etLimitERecharge = 32.0; 
	
	this.$etGradeAdvance = 100000; // default 100000 (10,000 cr)
	
	// G.E.T. Grade Titles
	this.$etGETTitle = [
	&quot;Grocer&quot;,
	&quot;Entered Apprentice&quot;,
	&quot;Fellowcrafter&quot;,
	&quot;Master Trader&quot;,
	&quot;Master Traveller&quot;,
	&quot;Perfect Master&quot;,
	&quot;Master of the Brazen Serpent&quot;,
	&quot;Provost and Judge&quot;,
	&quot;Intendant of the Orbital&quot;,
	&quot;Master of the Guild House&quot;,
	&quot;Master Elect&quot;,
	&quot;Sublime Master Elected&quot;,
	&quot;Master of Mercy&quot;, 
	&quot;Master of the Ninth Arch&quot;,
	&quot;Grand Elect Master&quot;,
	&quot;Knight of the East&quot;,
	&quot;Knight of the East and West&quot;,
	&quot;Knight of the Rosy Star&quot;,
	&quot;Friend and Brother Eternal&quot;,
	&quot;Prince of Inera&quot;,
	&quot;Sublime Keeper of the Galactic Secret&quot;, 
	&quot;Grand Master Supreme, Serene and Sublime&quot;,
	&quot;Elite Grand Master Everlasting&quot;
	];
	// Roman numerals for planet nomenclature
	this.$etRoman = [&quot;&quot;,&quot;I&quot;,&quot;II&quot;,&quot;III&quot;,&quot;IV&quot;,&quot;V&quot;,&quot;VI&quot;,&quot;VII&quot;,&quot;VIII&quot;,&quot;IX&quot;,&quot;X&quot;];
	// Industrial and Agricultural products
	this.$etIGoods = [&quot;computers&quot;,&quot;firearms&quot;,&quot;machinery&quot;,&quot;luxuries&quot;,&quot;alloys&quot;];
	this.$etAGoods = [&quot;furs&quot;,&quot;liquor_wines&quot;,&quot;radioactives&quot;,&quot;slaves&quot;,&quot;minerals&quot;,&quot;textiles&quot;,&quot;food&quot;];
	this.$etCheat = false; // toggle &#39;hidden feature&#39; for testing - default OFF
	// Brother or Sister?
	this.$etBro = &quot;Guilder&quot;; // switchable to &quot;Sister&quot;, &quot;Brother&quot;, or &quot;Sibling&quot;
	this.$etGendered = false; // true once imparted
	// number of system-to-system runs
	this.$etRuns = 0;
	// number of years as a Guilder
	this.$etYears = 0.0; // years passed since induction
	// constant: days in Lave Year - can (should?) be adjusted up/down
	this.$etLaveYear = 365;
	// days as a Guilder
	this.$etDays = 0; // days passed since G.E.T. induction
	this.$etDaysStart = 2084004; // day(s) _at_ G.E.T. induction
	this.$etDaysStarted = false; // have we started the G.E.T. clock?
	// total time or runs bonuses paid by G.E.T.
	this.$etBonuses = 0.0;
	this.$etBonusCount = 0;
	this.$etLastBonusDay = 0;
	// Guild Boon paid once per system
	this.$etBooned = false;
}


// are we being strict? (grade-dependent)
this._etStrict = function() {
	var strict = (this._etGetGrade() &lt; 1);
	this.$etStrict = strict;
	return strict;
}


// obtain the G.E.T. numeric grade (from total donation)
this._etGetGrade = function() {
	var grade = 0;
	var lim=this.$etGETTitle.length-1;
	var don = this.$etDonations.toFixed(0); // use parseInt()?
	// set Grade Advance according to present grade
	grade = (don/this.$etGradeAdvance);
	grade = grade.toFixed(0); // use parseInt()?
	if (grade&gt;lim) grade=lim;
	return grade;
}


// set grade advance divisor according to present Grade
this._etSetGradeAdvance = function() {
	var grade = this._etGetGrade();
	if (grade&lt;6)  this.$etGradeAdvance = 100000; else
	if (grade&lt;13) this.$etGradeAdvance = 150000; else
	if (grade&lt;18) this.$etGradeAdvance = 200000; else
	if (grade&lt;20) this.$etGradeAdvance = 300000; else
	if (grade&lt;23) this.$etGradeAdvance = 400000; 
}


// # of cargo pods in ship&#39;s hold
this._etPodCount = function() {
	var result = 0, man=manifest.list;
	for (var i=0; i&lt;man.length; i++) {
		var q = man[i].quantity;
		if (q &gt; 0) result+= q;
	}	
	return result;
}


// is FE Ships Player installed?
this._etHasFE = function() {
	var str = player.ship.shipClassName;
	var n = str.search(&quot; FE&quot;);
	return (n&gt;-1);
}


// leave an identical ship at the shipyard
// in case player wishes to reset its specs
this._etCloneShip = function() {
	if (oolite.versionString&gt;&quot;1.88&quot;) {
		var pr = player.ship.price * 0.75;
		system.mainStation.addShipToShipyard({ 
			short_description: &quot;G.E.T. offers you this clone of your ship, to reset our augmented specs to nominal, should you desire a clean break.&quot;, 
			shipdata_key: player.ship.dataKey, 
			price: pr, 
			personality:0,
			extras:[&quot;&quot;]
		});
	}
}


// Brother&#39;s profit-donation to G.E.T
// * in decicredits *
this._etGetDonation = function(profit) {
	var donation = 0.0;
	if (!this.$etDonated) {
		if (profit&gt;100.0) // &gt; 10.0 cr
			// profit &gt; 100 cr = 1% donation
			if (profit&lt;=10000.0) { // &lt;= 1000.0 cr
			donation = profit * 0.01;
			// proft &gt; 1000 cr = 10% donation
			} else donation = profit * 0.1;
	}
	return donation;
}


// Brother&#39;s running max/min trades and commodities
this._etGetMaxTrade = function() {
	if (this.$etTotProfit&gt;this.$etMaxTrade) {
		this.$etMaxTrade=this.$etTotProfit;
		this.$etMaxTSystem=this.$etSystem;		
		this.$etMaxTGoods=this.$etCommodities;		
		// the ship we maxed it in
		var p = player.ship;
		this.$etMaxTShip = p.shipClassName;
		this.$etMaxTShipName = p.shipUniqueName;
		this.$etMaxTShipTC = p.cargoSpaceCapacity;
	}
	if (this.$etTotProfit&lt;this.$etMinTrade) this.$etMinTrade=this.$etTotProfit;
}


// Brother&#39;s standing, best trade, today&#39;s profit, donations etc --&gt; Manifest
this._etShowStatus = function() { 
	if (this.$etBeenBellig) var br = &quot;Bad&quot;; else
	if (this.$etIsBellig) var br = &quot;Errant&quot;; else
	if (this.$etVowCount&gt;0) var br = &quot;Reformed&quot;; else
		var br = &quot;Good&quot;; 
		var bro = this.$etBro; // gender!
	var pn = player.name;
	var statusBrother = br+&quot; &quot;+bro+&quot; &quot;+pn+&quot;, with &quot;+formatCredits(player.credits, true, true);
	// days or years as a Guilder
	var dg = this._etGetDays(); // this.$etDays-this.$etDaysStart; 
	var yg=this._etGetYears();
	var statusTime = &quot;Time as a &quot;+bro+&quot;: &quot;+dg+&quot; Lave days (&quot;+yg+&quot; LY)&quot;;
	// number of runs as a Guilder
	var runs=player.score;
	if (this.$etRuns&lt;=0) runs = player.score; 
		else runs=this.$etRuns; // (best guess or # of runs)  
	this.$etRuns = runs; // set here each time - belt&#39;n&#39;braces
	var statusRuns = &quot;System-to-System Runs: &quot;+runs; //this.$etRuns;
	// most profitable trade so far
	var statusTrade = &quot;Best trade: &quot; + formatCredits(this.$etMaxTrade/10, true, true ) + &quot; (&quot; + this.$etMaxTSystem + &quot; - &quot;+this.$etMaxTGoods+&quot;)&quot;;
	// ship + tonnage in which best trade was made
	var sn = this.$etMaxTShipName; 
	if ((sn==&quot;&quot;) || (sn==null)) sn = &quot;&quot;; else sn=&quot; &#39;&quot;+this.$etMaxTShipName+&quot;&#39;&quot;; 
	var statusShip = &quot;Ship: &quot;+this.$etMaxTShip+sn+&quot; (&quot;+this.$etMaxTShipTC+&quot; TC)&quot;;
	// present orbital (station)
	var ps=player.ship, po=&quot;none&quot;;
	if (ps.dockedStation!=null) po=ps.dockedStation.displayName; 
	var statusOrb = &quot;Orbit: &quot; + this.$etSystem +&quot; &quot;+po; 
	// last market trade
	var lp = this.$etLastProfit/10;
	var statusLastt = &quot;Last trade: &quot;+formatCredits(lp,true,true)+&quot; (&quot;+this.$etSystem+&quot; &quot;+po+&quot; - &quot;+this.$etCommodities+&quot;)&quot;;
	// total profit this system (so far)
	// allow for multiple market &amp; station trades insystem
	// (may not be the best method, but the simplest)
	if (this.$etLastProfit != this.$etTotProfit) this.$etTotProfit += this.$etLastProfit;
	var tp = this.$etTotProfit/10;
	var profitTotal = &quot;Profit here: &quot;+formatCredits(tp,true,true);
	// (monthly) time bonuses paid by G.E.T. to Guilder
	var mb = this.$etBonuses; var mbc = this.$etBonusCount;
	var statusBonus = &quot;Bonuses: &quot; + formatCredits(mb,true,true) + &quot; (&quot;+ mbc + &quot;)&quot;;
	// donation this station
	var don = this.$etDonation/10; 
	var statusDonation = &quot;Donation here: &quot;+formatCredits(don,true,true);
	// total donations as cr
	var dons = this.$etDonations/10;
	var statusDonations = &quot;Donations &amp; Gifts: &quot;+formatCredits(dons,true,true);
	// Gifts
	var gifts = this.$etGifts/10; 
	var gc=this.$etGiftCount;
	var statusGifts = &quot;Gifts: &quot;+formatCredits(gifts,true,true)+&quot; (&quot;+gc+&quot;)&quot;;
	// G.E.T. Grade and Title
	// set Grade Advance divisor according to present Grade
	this._etSetGradeAdvance();
	var grade = this._etGetGrade();
	var statusGrade = &quot;Grade &quot;+grade;
	var title = this.$etGETTitle[grade];
	statusGrade += &quot;: &quot;+title;
	// display the G.E.T. Status Report
	mission.setInstructions([&quot;G.E.T. Status:&quot;,statusBrother,statusTime,statusRuns,statusOrb,statusTrade,statusShip,statusLastt,profitTotal,statusBonus,statusDonation,statusDonations,statusGifts,statusGrade], this.name);
}


// add a specified ship to Main shipyard
this._etAddShip = function(id,name,pr) { 
	system.mainStation.addShipToShipyard({ 
		short_description: name+&quot;: standard customer model, price &quot;+formatCredits(pr,true,true)+&quot;.&quot;, 
		shipdata_key: id, 
		price: pr, 
		personality:0,
		extras:[&quot;&quot;]
	});
}


// enhance ship by &lt;points&gt; points
this._etEnhanceShip = function(points) {
	var p = player.ship;
	// incremental defensive enhancements for the Guilder&#39;s ship
	if (this.$etLastSpeed&lt;this.$etLimitSpeed) {
		// secure against possible O-drive corruption
		p.maxSpeed=this.$etLastSpeed+1.0;
		}
		if (this.$etLastThrust&lt;this.$etLimitThrust) {
			p.maxThrust+=points;
		}
		if (this.$etLastShields&lt;this.$etLimitShields) {
			p.maxForwardShield+=points;
			p.maxAftShield+=points;
		}
		if (this.$etLastEnergy&lt;this.$etLimitEnergy) {
			p.maxEnergy+=points;
		}
		if (this.$etLastRecharge&lt;this.$etLimitRecharge) {
			p.forwardShieldRechargeRate+=(points*0.05);
			p.aftShieldRechargeRate+=(points*0.05);
		}
		if (this.$etLastERecharge&lt;this.$etLimitERecharge) {
			p.energyRechargeRate+=(points*0.1);
		}
		// update last specs after increments
		this.$etLastSpeed=p.maxSpeed; 
		this.$etLastThrust=p.maxThrust;
		this.$etLastShields=p.maxForwardShield;
		this.$etLastEnergy=p.maxEnergy;
		this.$etLastRecharge=p.forwardShieldRechargeRate;
		this.$etLastERecharge=p.energyRechargeRate;
}


// nullify ship enhancements, setting specs to nominal
this._etFloorSpecs = function() {
	var p = player.ship;
	this.$etLastSpeed = this.$etInitialSpeed; 
	this.$etLastThrust = this.$etInitialThrust;
	this.$etLastShields = this.$etInitialShields;
	this.$etLastEnergy = this.$etInitialEnergy;
	this.$etLastRecharge = this.$etInitialRecharge;
	this.$etLastERecharge = this.$etInitialERecharge;

	p.maxSpeed = this.$etInitialSpeed;
	p.maxThrust = this.$etInitialThrust;
	p.maxForwardShield = this.$etInitialShields;
	p.maxAftShield = this.$etInitialShields;
	p.maxEnergy = this.$etInitialEnergy;
	p.forwardShieldRechargeRate = this.$etInitialRecharge;
	p.aftShieldRechargeRate = this.$etInitialRecharge;
	p.energyRechargeRate = this.$etInitialERecharge;
}


this._etResetSpecs = function() {
	var p = player.ship;
	this.$etLastSpeed = p.maxSpeed; 
	this.$etLastThrust = p.maxThrust;
	this.$etLastShields = p.maxForwardShield;
	this.$etLastEnergy = p.maxEnergy;
	this.$etLastRecharge = p.forwardShieldRechargeRate;
	this.$etLastERecharge = p.energyRechargeRate;
	// note ship&#39;s initial specs (for later comparisons)
	this.$etInitialSpeed = p.maxSpeed;
	this.$etInitialThrust = p.maxThrust;
	this.$etInitialShields = p.maxForwardShield;
	this.$etInitialEnergy = p.maxEnergy;
	this.$etInitialRecharge = p.forwardShieldRechargeRate;
	this.$etInitialERecharge = p.energyRechargeRate;
}


this._installAutoDock = function() {
	var p = player.ship;
	// give the non-straying Brother free fast-docking capability
	if (!this.$etIsBellig) {
		if (p.equipmentStatus(&quot;EQ_DOCK_COMP&quot;) != &quot;EQUIPMENT_OK&quot;) {
			p.awardEquipment(&quot;EQ_ET_AUTODOCK&quot;);
		}
	}
}


this._etSayWelcome = function() {
	var bro = this.$etBro;
	var pc = player.consoleMessage;
	var sta= player.ship.dockedStation;
	var isgl = (sta.name == &quot;G.E.T. Guild Lodge&quot;);
	// introductory welcome to newly inducted Grocers
	if (this.$etRuns&lt;1) {
		pc(&quot;The Galctic Guild of Elite Traders (G.E.T.)&quot;,9);
		pc(&quot;is highly pleased to bring you into our Order.&quot;,9);
		pc(&quot;We wish you great fortune and rapid advancement!&quot;,9);
		pc(&quot; &quot;);
	}
	// special messages on docking with a Guild Lodge
	if (isgl) {
		pc(&quot;Welcome, &quot;+bro+&quot;, to our humble &quot;+this.$etSystem+&quot; Guild Lodge!&quot;,9);
		pc(&quot;Receive our Boon and blessing...&quot;,9);
		pc(&quot;And do join us at our Ceremonial before you leave us!&quot;,9);
		pc(&quot; &quot;,9);
	} else {
		if (!this.$etBeenBellig)
			pc(&quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders welcomes you!&quot;, 5);
		if (!this.$etGendered)
			pc(&quot;Guilder, please hit F4 to impart your gender...&quot;, 9);
		if (this.$etRuns&lt;=4) {
			pc(&quot;Please check your F4 G.E.T. Interfaces often!&quot;,9);
			pc(&quot;Always check the F5-F5 Manifest on ending trading!&quot;,9);
			if (sta.isMainStation) {
				pc(&quot;Go to F4 Interface to register Name and Ship.&quot;,9);
				pc(&quot; &quot;);
			}
		}
	}
	// say welcome once only
	this.$etIsWelcomed = true;
}


// display ship&#39;s cargo and its purchase value
this._etPodsInHold = function(pods) {
	player.consoleMessage(&quot;In hold: &quot;+pods+&quot; pods ( &quot;+formatCredits(((this.$etBoughtPrice)/10),true,true)+&quot; )&quot;);
}


// planet name &amp; number by &#39;compare radius&#39; method
this._etGetPlanetName = function(plan) {
	var p=system.planets, name=&quot;&quot;,
	rad = plan.radius;
	if (rad!=null) {
		// run through planets in system...
		for (var i=0; i&lt;p.length; i++) {
			if (i&gt;0) {
				// if radii match, it&#39;s probably our planet
				if (rad===p[i].radius) name=p[i].name+&quot; &quot;+this.$etRoman[i+1];
			} else name=plan.name; // planet 0 is &#39;Prime&#39;
		}
	} else name = plan.name; // &#39;vanilla&#39; name
	return name;
}


this._etCommsTradeAdvisory = function() {
	// prices of system&#39;s key goods, plus quantity
	var ind = (system.economy&lt;4), s=system.stations,
	pm = player.commsMessage;
	pm(&quot;&quot;); // LF
	if (!ind) {
			for (var i=0; i&lt;s.length; i++) if (s[i].name!=&quot;Rock Hermit&quot;)
				pm(s[i].name + &quot;: Computers @ &quot; + this._etMarketPrice(s[i],&quot;computers&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;computers&quot;) + &quot;)&quot;,10);
		} else {
			for (var i=0; i&lt;s.length; i++) if (s[i].name!=&quot;Rock Hermit&quot;)
				pm(s[i].name + &quot;: Furs @ &quot; + this._etMarketPrice(s[i],&quot;furs&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;furs&quot;) + &quot;)&quot;,10);
		}
}


// number of days since first run
this._etGetDays = function() {
	var dys=0.0; 
	this.$etDaysStart=2084004.0;
	// output Lave days since induction
	this.$etDays = clock.days; // now
	dys=this.$etDays-this.$etDaysStart;
	dys=dys.toFixed(0);
	return dys;
}


// number of years since first run 
this._etGetYears = function() {
	var yrs=0.0;
	// compute Lave years since induction
	yrs=this._etGetDays();
	yrs=yrs/this.$etLaveYear;
	yrs=yrs.toFixed(3);
	return yrs;
}


// monthly bonus - grade- and credits-dependant 
this._etGetMBonus = function() {
	var bon = 0.0;
	var dys = this._etGetDays();
	// grade-dependant monthly bonus
	if ( (dys &gt; 0) &amp;&amp; ((dys % 30)==0) ) {
		var grd = this._etGetGrade();
		bon = (grd/22) * player.credits;
	}
	return bon;
}



// create G.E.T. Gift to Guild on the F4 Interfaces screen
this._etPrepGift = function(station) {
	station.setInterface(&quot;etGift&quot;,{
	title: &quot;G.E.T. Gift your Station Profit to the Guild&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Make a voluntary gift of your station profit to the Guild, to speed advancement and seal bonds.&quot;,
	callback: this._etShowGift.bind(this)
	});	
}


// Present the option to Gift Station profit to the Guild
this._etShowGift = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	parameters.message = &quot;The &quot;+this.$etSystem+&quot; Guild offers you the opportunity and privilege of advancing in Grade more speedily by magnanimously gifting to the G.E.T. coffers your entire profits gained here in our system - in this case &quot;+formatCredits(this.$etTotProfit/10, true, true)+&quot;. \n\n &quot;;

	parameters.message += this.$etBro+&quot; and friend, you will honour and distinguish both the Guild and yourself by rendering this further contribution to G.E.T. beneficence and hegemony... You will be assured of special welcome and expeditious service in every Guild House throughout the Eight Charts. Of this your Gift, Grand Master Exolon will learn.&quot;;
	
	parameters.choicesKey = &quot;etGiftChoices&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		var pc = player.commsMessage;
		var pcm= player.consoleMessage;
		if (choice === &quot;1_YES&quot;)  {
			if (!this.$etGifted) {
				if (this.$etTotProfit&gt;0) this.$etGiftCount+=1;
				this.$etGift = this.$etTotProfit;
				this.$etGifts+=this.$etGift;
				// note previous grade here
				//this.$etLastGrade=this._etGetGrade();
				this.$etDonations+=this.$etGift;
				this.$etGifted = true;
				// grant 3-point ship enhancement
				this._etEnhanceShip(3);
				// deduct gift from player&#39;s credits
				// donation is decicredits, so convert
				player.credits -= this.$etGift/10; 
				if (this.$etGift&gt;0) {
					pc(this.$etBro+&quot;, we thank you profusely for your munificence!&quot;,9);
					pc(&quot;Your speedy advancement is secure!&quot;,9);
					pcm(this.$etBro+&quot;, we grant you a 3-point ship enhancement.&quot;,9);
				} else pc(&quot;Blessings, &quot;+this.$etBro,9);
			} else pc(&quot;Please give to G.E.T. at your next port of call!&quot;,9);
			// update Manifest
			this._etShowStatus();
		}
	}
}


	
// create G.E.T. Best Trade Resetter on the F4 Interfaces screen
this._etPrepResetter = function(station) {
	station.setInterface(&quot;etResetter&quot;,{
	title: &quot;G.E.T. Best Trade Resetter&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Reset your Best Trade to the profit gained in this system.&quot;,
	callback: this._etShowResetter.bind(this)
	});	
}


// Present the option to reset Best Trade to the profit made here
this._etShowResetter = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	parameters.message = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders offers you the opportunity to reset your Best Trade, as displayed on your ship&#39;s Manifest screen, to the profit you have just gained here in our system - in this case &quot;+formatCredits(this.$etTotProfit/10, true, true)+&quot;. \n\n &quot;;

	parameters.message += &quot;In fact you would honour us by doing so...&quot;;
	
	parameters.choicesKey = &quot;etResetMaxTradeChoices&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  {
			this.$etMaxTrade=this.$etTotProfit;
			this.$etMaxTSystem=this.$etSystem;		
			this.$etMaxTGoods=this.$etCommodities;		
			// the ship we maxed it in
			var p=player.ship;
			this.$etMaxTShip = p.shipClassName;
			this.$etMaxTShipName = p.shipUniqueName;
			this.$etMaxTShipTC = p.cargoSpaceCapacity;
			player.commsMessage(&quot;Maximum Trade reset. Please check the Manifest.&quot;);
			// update Manifest
			this._etShowStatus();
		}
	}
}


// create G.E.T. Master Advisory on the F4 Interfaces screen
this._etPrepAdvisory = function(station) {
	station.setInterface(&quot;etAdvisory&quot;,{
	title: &quot;G.E.T. Master Advisory&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Salutation and advice from the Master of the &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;,
	callback: this._etShowAdvisory.bind(this)
	});	
}


// Salutation and advice from the station Guild Master
this._etShowAdvisory = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	var grade = this._etGetGrade(), title=this.$etGETTitle[grade], lim=this.$etGETTitle.length;
	var grovel =&quot;&quot;, pregrovel=&quot;&quot;;
	var greet = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders bids their &quot;+this.$etBro+&quot; &quot;+player.name+&quot; a hearty welcome to their Guild Home and trusts &quot;;
	if ((grade&gt;=5) &amp;&amp; (grade&lt;11)) { greet = title + &quot;, you honour our Guild Home by your visit! If only we had been better prepared for your arrival... &quot; + this.$etSystem + &quot; G.E.T. nevertheless hopes &quot;;
	grovel = &quot;Anything you might need, Master, they are here to serve you.&quot;; }
	if ((grade&gt;10)) { greet = title + &quot;! your worshipful presence humbles our poor and wretched Guild Home, yet your visit ennobles us! If only we had been informed that your Honour would be arriving... &quot; + this.$etSystem + &quot; G.E.T. nevertheless prays &quot;;
	grovel = &quot;Anything, anything you require, Exalted One, they are here to serve, as are we all.&quot;; }
	
	parameters.message = greet + &quot; this sojourn among us will be advantageous... Trade well! May the GETTING exceed the Taking! \n\n&quot;;
	
	// G.E.T. contact (Assessor)
	parameters.message += &quot;Master &quot; + this.$etContact + &quot; is your Assessor and contact for your stopover. &quot;+grovel+&quot; \n\n&quot;;
	
	// Planets with stations
	var plan = &quot;&quot;, p=system.planets, sta=&quot;&quot;, s=system.stations;
	var i = 0; // count the planets
	if ((p.length&gt;1) &amp;&amp; (this.$etNoob==&quot;no&quot;)) { 
		for (i=0; i&lt;p.length; i++) {
			if (i&gt;0) plan += p[i].name+&quot; &quot;+this.$etRoman[i+1]+&quot;  &quot;;
			else plan += p[i].name+&quot;  &quot;;
		}
		// don&#39;t say planets if too many stations (makes space!)
		if (i&lt;4)
			parameters.message += &quot;Our planets with stations are: &quot;+plan+&quot;\n\n&quot;; 
	
		/*for (i=0; i&lt;s.length; i++) if (s[i].name!=&quot;Rock Hermit&quot;) sta += s[i].name + &quot;  &quot;;
		parameters.message += &quot;Our stations are: &quot;+sta+&quot;\n\n&quot;;*/ 
	
		// prices of system&#39;s prime commodities, plus quantity
		var ind = (system.economy&lt;4);
		if (ind) {
			for (i=0; i&lt;s.length; i++) { 
				if (s[i].name!=&quot;Rock Hermit&quot;) { 
					parameters.message += &quot;Computers at our &quot;+ s[i].name + &quot; cost &quot; + this._etMarketPrice(s[i],&quot;computers&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;computers&quot;) + &quot;) \n&quot;;
					parameters.message += &quot;Luxuries at our &quot;+ s[i].name + &quot; cost &quot; + this._etMarketPrice(s[i],&quot;luxuries&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;luxuries&quot;) + &quot;) \n\n&quot;;
				}
			}
		} else {
			for (i=0; i&lt;s.length; i++) { 
				if (s[i].name!=&quot;Rock Hermit&quot;) {
					parameters.message += &quot;Furs at our &quot;+ s[i].name + &quot; cost &quot; + this._etMarketPrice(s[i],&quot;furs&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;furs&quot;) + &quot;) \n&quot;;
					parameters.message += &quot;Liquors at our &quot;+ s[i].name + &quot; cost &quot; + this._etMarketPrice(s[i],&quot;liquor_wines&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;liquor_wines&quot;) + &quot;) \n\n&quot;;
				}
			}
		}
		parameters.message += &quot;\n&quot;;
	}
	
	if (grade&lt;6)  parameters.message += &quot;To business, &quot;+this.$etBro+&quot;... &quot;; else
	if (grade&lt;11) parameters.message += &quot;To business, then, Friend and &quot;+this.$etBro+&quot;... &quot;; else
	if (grade&lt;lim) parameters.message += &quot;To business, then, o Perfected &quot;+this.$etBro+&quot; and - dare we hope? - Friend... &quot;;
	
	if (this.$etNoob==&quot;yes&quot;) {
		var p = player.ship;
		var sname = p.shipUniqueName; 
		var sclass = p.shipClassName;

		parameters.message += &quot;You may note with irony that G.E.T. cares little whether Galcop deems your goods illegal... We have small truck with that legislative body. With us, your record is always clean, and all trades legitimate in our eyes.  \n\n&quot;

		parameters.message += &quot;Words of advice are never amiss, you&#39;ll agree? &quot;;
		
		parameters.message += &quot;One abiding Rule governs our Order: Trade well, refrain from combat, aid your Brothers. Above all, do not kill. &quot;;
	
		parameters.message += &quot;Remember it - advance in Grade and wealth. Ignore it, and risk our silence. Then only Penance will bring you back. \n\n&quot;;
		
		if (this.$etStrict) var strctMsg = &quot;Above Grade 1, &quot;; else strctMsg=&quot;&quot;;
		parameters.message += &quot;Your craft has a &#39;weapons offline&#39; switch: &quot;+strctMsg+&quot;use it after witch and watch threats fly by with J-drive engaged. G.E.T. provides priority docking to all Brothers; in the shipyard, our Master mechs and techs are unrivalled. Your &quot;+sclass+&quot; will flourish! &quot;;
	} 
	else if (!this.$etMarketObserver) 
		parameters.message += &quot;As it forever has been, the Market Observer and Market Inquirer of Fra Spara are almost de rigueur. Do not exit a space-dock without these! Seek a Torus to Sun Drive and our Advanced Space Compass once you have your Large Cargo Bay and Goods Containers, obtaining which is now your prime concern. \n \n&quot;;

	parameters.choicesKey = &quot;etAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;) { 
			// we only need to read the noob text once!
			this.$etNoob = &quot;no&quot;;
			player.commsMessage(&quot;Luck in the Markets!&quot;);
		}
	}
}


// create G.E.T. Sales Advisory on the F4 Interfaces screen
this._etPrepSales = function(station) {
	station.setInterface(&quot;etSales&quot;,{
	title: &quot;G.E.T. Guild Lodge Sales Advisory&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Salutation and sales advice from the &quot;+this.$etSystem+&quot; Lodge Master&quot;,
	callback: this._etShowSales.bind(this)
	});	
}


// Sales advice from the Guild Lodge Master
this._etShowSales = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild Lodge&quot;;
	
	parameters.message = this.$etBro + &quot; &quot;+player.name+&quot;, we are honoured and delighted to welcome you to our humble Guild Lodge. As I&#39;m sure time presses on you, here without further ado are our system sell-prices for the most popular traded goods... \n\n&quot;;
	
	var plan = &quot;&quot;, p=system.planets, sta=&quot;&quot;, s=system.stations;
		// prices of system&#39;s prime commodities, plus quantity
		var ind = (system.economy&lt;4);
		if (ind) {
			for (var i=0; i&lt;s.length; i++) { 
				if (s[i].name!=&quot;Rock Hermit&quot;) { 
					parameters.message += &quot;Furs at our &quot;+ s[i].name + &quot; sell at &quot; + this._etMarketPrice(s[i],&quot;furs&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;furs&quot;) + &quot;) \n&quot;;
					parameters.message += &quot;Liquors at our &quot;+ s[i].name + &quot; sell at &quot; + this._etMarketPrice(s[i],&quot;liquor_wines&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;liquor_wines&quot;) + &quot;) \n\n&quot;;
				}
			}
		} else {
			for (var i=0; i&lt;s.length; i++) { 
				if (s[i].name!=&quot;Rock Hermit&quot;) {
					parameters.message += &quot;Computers at our &quot;+ s[i].name + &quot; sell at &quot; + this._etMarketPrice(s[i],&quot;computers&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;computers&quot;) + &quot;) \n&quot;;
					parameters.message += &quot;Luxuries at our &quot;+ s[i].name + &quot; sell at &quot; + this._etMarketPrice(s[i],&quot;luxuries&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;luxuries&quot;) + &quot;) \n\n&quot;;
				}
			}
		}
		parameters.message += &quot;\n&quot;;
	
	var grade=this._etGetGrade();
	if (grade&lt;6)  parameters.message += &quot;To business, &quot;+this.$etBro+&quot;... &quot;; else
	if (grade&lt;11) parameters.message += &quot;To business, then, Friend and &quot;+this.$etBro+&quot;... &quot;; else
	if (grade&lt;lim) parameters.message += &quot;To business, then, o Perfected &quot;+this.$etBro+&quot; and - dare we hope? - Friend... &quot;;
	

	parameters.choicesKey = &quot;etAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;Luck in the Markets!&quot;);
	}
}



// Vow of Good Brotherhood
this._etPrepVow = function(station) {
	station.setInterface(&quot;etVow&quot;,{
	title: &quot;G.E.T. Vow of Good Brotherhood&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Make a Vow of Good Brotherhood to the Master of the &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;,
	callback: this._etShowVow.bind(this)
	});	
}


// Present the option to make a Vow of Good Brotherhood
this._etShowVow = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	parameters.message = &quot;We observed with sadness your straying from the Path of Good Brotherhood. You have killed - not once, but multiple times. Yet we understand your urges and the weakness of the newly inducted. For this reason, the &quot;+this.$etSystem+&quot; Guild of Elite Traders offers you the opportunity to mend errant ways... \n\n &quot;;
	
	parameters.message += &quot;The Masters of the Guild are prepared to reinstate you as a full &quot;+this.$etBro+&quot; and restore all privileges of the G.E.T., indeed to forget your infractions, provided you demonstrate self-discipline and, above all, mercy in your future conduct on the space-lanes.\n\n &quot;;
	
	parameters.message += &quot;Remember the Rule: Do not kill. It is our only Rule. We do not ask why you broke it, but do demand that you respect and live by it. \n\n &quot;;
	
	parameters.message += &quot;Commander &quot;+player.name+&quot;, are you prepared now to renew your Vow of Good Brotherhood with the Guild? \n\n &quot;;

	this.$etVowing = true;
	parameters.choicesKey = &quot;etVowChoices&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  {
			// reinstate Brother&#39;s privileges
			this.$etIsBellig = false;
			this.$etBeenBellig = false;
			this.$etKillCount = 0;
			this.$etVowCount ++;
			player.ship.bounty = 0;
			player.consoleMessage(&quot;Then all is forgiven and we welcome you back.&quot;,5);
		} else player.consoleMessage(&quot;Then our backs must remain turned. Fare well.&quot;,5);
	}
}


// G.E.T. ship condition and status report
this._etPrepShipStatus = function(station) {
	station.setInterface(&quot;etShipStatus&quot;,{
	title: &quot;G.E.T. Ship Status Report&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;The current state of your G.E.T. ship enhancements.&quot;,
	callback: this._etShowShipStatus.bind(this)
	});	
}


// Display status of G.E.T. ship enhancements
this._etShowShipStatus = function() {
	var p = player.ship;
	var sname = p.shipUniqueName; 
	var sclass = p.shipClassName;
	
	if ((sname!=null) &amp;&amp; (sname!=&quot;&quot;)) sname = &quot; &#39;&quot;+sname+&quot;&#39; &quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; G.E.T. Shipyard&quot;;
	
	parameters.message = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders bids you welcome to our shipyard and hopes that our services to your fine &quot;+sclass+sname+&quot; meet with approval. Since your induction, technical enhancements to her systems have included: \n\n&quot;;

	parameters.message += &quot;Nominal speed: &quot;+this.$etInitialSpeed+&quot;  --&gt;&gt;  Current speed: &quot;+p.maxSpeed+&quot; \n\n&quot;;
	
	parameters.message += &quot;Nominal thrust: &quot;+this.$etInitialThrust+&quot;  --&gt;&gt;  Current thrust: &quot;+p.maxThrust+&quot; \n\n&quot;;
	
	parameters.message += &quot;Nominal shields: &quot;+this.$etInitialShields+&quot;  --&gt;&gt;  Current shields: &quot;+p.maxForwardShield+&quot; \n\n&quot;;
	
	parameters.message += &quot;Nominal energy: &quot;+this.$etInitialEnergy+&quot;  --&gt;&gt;  Current energy: &quot;+p.maxEnergy+&quot; \n\n&quot;;
		
	parameters.message += &quot;Nominal recharge: &quot;+this.$etInitialERecharge.toFixed(2)+&quot;  --&gt;&gt;  Current recharge: &quot;+p.energyRechargeRate.toFixed(2)+&quot; \n\n&quot;;

	parameters.choicesKey = &quot;etAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;Be safe in the Lane!&quot;);
	}
}


// price of a good at a given station, in cr
this._etMarketPrice = function(sta, good) {
	var price=0.0, mar=sta.market;
	price = mar[good].price/10;
	return price.toFixed(1);
}


// quantity of a good at a given station
this._etMarketQuantity = function(sta, good) {
	var quant=0, mar=sta.market;
	quant = mar[good].quantity;
	return quant;
}


/* Note: this helper function is from phkb&#39;s Equipment Storage OXP */
// returns the player&#39;s target system (1.80) or the next jump to their target system (1.82+)
this._TargetSystem = function _TargetSystem() {
	if (player.ship.hasOwnProperty(&quot;nextSystem&quot;)) return player.ship.nextSystem;

	var target = player.ship.targetSystem;

	if (oolite.compareVersion(&quot;1.81&quot;) &lt; 0 &amp;&amp; player.ship.hasEquipmentProviding(&quot;EQ_ADVANCED_NAVIGATIONAL_ARRAY&quot;) === true) {
		// in 1.81 or greater, the target system could be more than 7 ly away. It becomes, essentially, the final destination.
		// there could be multiple interim stop points between the current system and the target system.
		// the only way to get this info is to recreate a route using the same logic as entered on the ANA, and pick item 1
		// from the list. That should be the next destination in the list.
		if (system.ID === -1) {
			var myRoute = System.infoForSystem(galaxyNumber, this._lastSource).routeToSystem(System.infoForSystem(galaxyNumber, target), player.ship.routeMode);
		} else {
			var myRoute = System.infoForSystem(galaxyNumber, global.system.ID).routeToSystem(System.infoForSystem(galaxyNumber, target), player.ship.routeMode);
		}
		if (myRoute &amp;&amp; myRoute.route.length &gt;= 1) {
			target = myRoute.route[1];
		}
	}

	return target;
}



// create G.E.T. &#39;Buber&#39;s Beats&#39; page 
this._etPrepBeats = function(station) {
	station.setInterface(&quot;etBeats&quot;,{
	title: &quot;G.E.T. Milk or Cream? - Buber&#39;s Beats&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Solid examples and advice from a favoured Brother with our exalted Grand Master&#39;s endorsement.&quot;,
	callback: this._etShowBeats.bind(this)
	});	
}


// Buber&#39;s Beats - walkthrough and advice
this._etShowBeats = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	parameters.message = &quot;Your Friend and Brother, Master Traveller Fens Buber, offers you these creamy beats with our exalted Grand Master&#39;s approval: \n\n&quot;;

	parameters.message += &quot;Spaceway L1/L2, Sector One, Galaxy One \n&quot;;
	parameters.message += &quot;----------------------------------------------------------- \n\n&quot;;

	parameters.message += &quot;0. (Lave--&gt;Zaonce--&gt;Isinor--&gt;) \n&quot;;
	parameters.message += &quot;1. Qutiri--&gt;Isinor--&gt;Ensoreus--&gt;Ararus \n&quot;;
	parameters.message += &quot;2. Zarece--&gt;Isence \n&quot;;
	parameters.message += &quot;3. Tiinlebi--&gt;Anlama--&gt;Begeabi \n&quot;;
	parameters.message += &quot;4. Xexedi--&gt;Laenin--&gt;Lerelace \n&quot;;
	parameters.message += &quot;5. Razaar--&gt;Zadies--&gt;Anarlaqu--&gt;Vetitice \n&quot;;
	parameters.message += &quot;6. Zasoceat--&gt;Riantiat--&gt;Teraed--&gt;Bivea--&gt;Enzaer \n&quot;;
	parameters.message += &quot;7. Tianve/Anle--&gt;Teanrebi \n&quot;;
	parameters.message += &quot;8. Malama--&gt;Qudira--&gt;Inines--&gt;Qudira--&gt;Esbiza \n\n&quot;;

	parameters.message += &quot;Repeat and vary at will, or do the grand tour of these 29 systems. Buy Computers (+luxuries) in Rich Industrials and Furs (+liquor-wines) in Poor Agriculturals. \n\n&quot;;

	parameters.choicesKey = &quot;etAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;Trade well and wisely, &quot;+this.$etBro+&quot;!&quot;);
	}
}



// Prepare Gender request
this._etPrepGender = function(station) {
	station.setInterface(&quot;etGender&quot;,{
	title: &quot;G.E.T. Your gender, gentle Guilder?&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;The Guild Master requests to know whether you are female, male, or bi-gendered.&quot;,
	callback: this._etShowGender.bind(this)
	});	
}


// Present the option to impart your gender
this._etShowGender = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	parameters.message = &quot;Profuse and embarrassed apologies, but the Guild Master of &quot;+this.$etSystem+&quot; has been unable to determine your gender... Would you perhaps be willing to impart it to me, his assistant, so that no faux pas in future protocol will occur? \n\n &quot;;
	
	parameters.message += &quot;If female, we shall be pleased and honoured to call you &#39;Sister&#39;; if male - &#39;Brother&#39;; if bi-, tri-, or null-gendered - &#39;Sibling&#39;... or simply continue with &#39;Guilder&#39; if you prefer. \n &quot;;
	
	parameters.choicesKey = &quot;etGenderChoices&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_FEMALE&quot;) this.$etBro=&quot;Sister&quot;; else
		if (choice === &quot;2_MALE&quot;) this.$etBro=&quot;Brother&quot;; else
		if ((choice === &quot;3_BOTH&quot;) || (choice== &quot;4_NULL&quot;)) this.$etBro=&quot;Sibling&quot;; else
			this.$etBro = &quot;Guilder&quot;;
		if (this.$etBro===&quot;Sibling&quot;) player.consoleMessage(&quot;Thank you. Then you shall be our &#39;Sibling&#39;.&quot;,7); else player.consoleMessage(&quot;Thank you &quot;+this.$etBro+&quot;. We will remember it.&quot;,7);
		this.$etGendered=true;
	}
}


</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/fe-script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;script.js&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;


// make sure that these ships are always present at Lave
this.startUpComplete = function() {
	if (system.name == &quot;Lave&quot;) {
		// Adder
		this._feAddShip(&quot;adder-player&quot;, &quot;Adder FE&quot;, 73000);
		// Gecko
		this._feAddShip(&quot;gecko-player&quot;, &quot;Gecko FE&quot;, 66000);
		// Krait
		this._feAddShip(&quot;krait-player&quot;, &quot;Krait FE&quot;, 50000);
		// Sidewinder
		this._feAddShip(&quot;sidewinder-player&quot;, &quot;Sidewinder FE&quot;, 44000);
		// correct Oolite&#39;s mis-naming of the Cobra III in Normal start,
		// and also provide a Cobby III clone - because Lave Shipyard _can_
		// (the adventuresome player gets an extra 100 cr to play with too)
		if (player.ship.dataKey == &quot;cobra3-player&quot;) {
			player.ship.shipClassName = &quot;Cobra Mk 3 FE&quot;;
			this._feCloneShip();
		}
	}
}


this.shipDockedWithStation = function(station) {
	// counter the rarity of the Asp Explorer
	if (system.techLevel&gt;10) this._feAddShip(&quot;asp-player&quot;, &quot;Asp Explorer FE&quot;, 187000);
}


this._feAddShip = function(id,name,pr) { 
	system.mainStation.addShipToShipyard({ 
		short_description: name+&quot;: standard customer model, price &quot;+formatCredits(pr,true,true)+&quot;.&quot;, 
		shipdata_key: id, 
		price: pr, 
		personality:0,
		extras:[&quot;&quot;]
	});
}


// leave an identical ship at the shipyard
// in case player wishes to reset its specs
this._feCloneShip = function() {
	if (oolite.versionString&gt;&quot;1.88&quot;) {
		var pr = player.ship.price * 0.746;
		system.mainStation.addShipToShipyard({ 
			short_description: system.name +&quot; Shipyard offers you this clone of your ship, gratis. Why? - Because we _can_&quot;, 
			shipdata_key: player.ship.dataKey, 
			price: pr, 
			personality:0,
			extras:[&quot;&quot;]
		});
	}
}

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/gc1_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Goods Container 10 TC&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;2.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	// keep tally of pylon accessories bought
	this.$gc1Count++;
    // and don&#39;t let them exceed ship&#39;s pylon-capacity
	if ((equipment == &quot;EQ_GC1_MINE&quot;) &amp;&amp; (this.$gc1Count&lt;=this.$gc1MCap)) {
		player.ship.cargoSpaceCapacity += 10;
		this.$gc1Containers++;
		pc(&quot;Modifying pylon hardpoints for container clamping...&quot;,9);
		pc(&quot;Fitting 10 TC Class Container #&quot;+this.$gc1Containers+&quot;...&quot;,9);
		pc(&quot;F4 &#39;Your FE Shipyards&#39; to check your Licence.&quot;,9);
	} else
	// unmount &amp; sell cancels all container additions
	if (equipment == &quot;EQ_MISSILE_REMOVAL&quot;) {
		player.ship.cargoSpaceCapacity -= this.$gc1Containers*10;
		if (this.$gc1Containers&gt;0) {
			pc(&quot;Removing all 10 TC Class Containers...&quot;,9);
			pc(&quot;Restoring pylon hardpoints for weapons-use...&quot;,9);
		}
		if ((this.$gc1Containers&gt;0) &amp;&amp; (!this.$gc1HFExempt)) {
			// dismantling fee
			var dft = this.$gc1Containers*this.$gc1DismantlingFee;
			this.$gc1DismantlingFeeTotal += dft;
			player.credits -= dft;
			pc(&quot;Dismantling Fee: &quot;+dft+&quot; cr&quot;,9);
		}
		this.$gc1Count = 0;
		this.$gc1Containers = 0;
		// reset system-to-system runs w/containers
		this.$gc1Runs = 0;
		// reset fee totals
		this.$gc1HandlingFeeTotal = 0;
		this.$gc1MaintenanceFeeTotal = 0;
	}
}


this.playerBoughtNewShip = function(ship, price) {
	// missile capacity (not exceed)
	this.$gc1MCap = player.ship.missileCapacity;
	this.$gc1Count = 0;
	this.$gc1Containers = 0;
}


this.equipmentRemoved = function(equipmentKey) {
    if (equipmentKey == &quot;EQ_GC1_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 10;
		this.$gc1Containers--;	
		player.consoleMessage(&quot;10 TC Goods Container removed.&quot;,5);
	}
}


this.shipReleasedEquipment = function(mine) {
	this.$gc1Count--;
    if (mine == &quot;EQ_GC1_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 10;
		this.$gc1Containers--;
		player.commsMessage(&quot;10 TC Goods Container jettisoned.&quot;,5);
		// deduct container cost from credits
		player.credits -= 10000.0;
		player.commsMessage(&quot;Mishandling charge applied at cost.&quot;,9);
	}
}


this.shipFiredMissile = function(missile, target) {
	this.$gc1Count--;
    if (missile == &quot;EQ_GC1_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 10;
		this.$gc1Containers--;	
		player.commsMessage(&quot;10 TC Goods Container jettisoned.&quot;,5);
		// deduct container cost from credits
		player.credits -= 10000.0;
		player.commsMessage(&quot;Mishandling charge applied at cost.&quot;,9);
	}
}


this.startUpComplete = function () {
	var pc = player.consoleMessage;
	// missile capacity (not exceed)
	this.$gc1MCap = player.ship.missileCapacity;
	this.$gc1Count = player.ship.missiles.length;
	// Load cargo space, missile &amp; container counts if present
	if (missionVariables.gc1Cargo != null) 
		player.ship.cargoSpaceCapacity = missionVariables.gc1Cargo;
	if (missionVariables.gc1Count != null)
		this.$gc1Count = missionVariables.gc1Count;
	if (missionVariables.gc1Containers != null) 
		this.$gc1Containers = missionVariables.gc1Containers;
	// Load total fees taken
	if (missionVariables.gc1HandlingFeeTotal != null)
		this.$gc1HandlingFeeTotal = missionVariables.gc1HandlingFeeTotal;
	if (missionVariables.gc1HandlingPaid != null)
		this.$gc1HandlingPaid = missionVariables.gc1HandlingPaid;
	if (missionVariables.gc1MaintenanceFeeTotal != null)
		this.$gc1MaintenanceFeeTotal = missionVariables.gc1MaintenanceFeeTotal;
	if (missionVariables.gc1DismantlingFeeTotal != null)
		this.$gc1DismantlingFeeTotal = missionVariables.gc1DismantlingFeeTotal; 
    // Load system-to-system runs w/container
	if (missionVariables.gc1Runs != null)
		this.$gc1Runs = missionVariables.gc1Runs;
	// Load Handling fee count
	if (missionVariables.gc1HandlingCount != null)
		this.$gc1HandlingCount = missionVariables.gc1HandlingCount;
	// Load handling fee exemption status
	if (missionVariables.gc1HFExempt != null)
		this.$gc1HFExempt = missionVariables.gc1HFExempt;
	// Load Maintenance fee count
	if (missionVariables.gc1MaintenanceCount != null)
		this.$gc1MaintenanceCount = missionVariables.gc1MaintenanceCount;
	// CHECK
	log(this.name, this.name+&quot; startup complete.&quot;);
	// TEST
	var sta = player.ship.dockedStation;
	if ((this.$gc1Containers&lt;this.$gc1MCap) &amp;&amp; (system.techLevel&gt;=6))
		pc(&quot;Containers available in the Shipyard.&quot;);
	// prepare container Account screen
	if (this.$gc1Containers&gt;0) this._gc1PrepAcc(sta);
	// optionally, prepare handling fee waiver request
	if (this.$gc1Containers&gt;0) this._gc1PrepEx(sta);
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// check for G.E.T. presence
	this.$gc1ET = false;
	if (worldScripts[&quot;Elite Trader&quot;]) 
		this.$gc1ET = true;
	// TEST	
	if (this.$gc1ET) log(this.name, &quot;Finds Elite Trader present&quot;);
	// check for FE Ships Player
	this.$gc1FES = false;
	if (worldScripts[&quot;FE Ships Player&quot;]) 
		this.$gc1FES = true;
	// TEST	
	if (this.$gc1ET) log(this.name, &quot;Finds FE Ships Player present&quot;);
	// missile capacity (not exceed)
	this.$gc1MCap = 0;
	// pylon-use count
	this.$gc1Count = 0;
	// container count
	this.$gc1Containers = 0;
	// purchase cost of container in cr
	this.$gc1Cost = 10000;
	// handling fee
	this.$gc1HandlingFee = 0.005*this.$gc1Cost; // 0.005 of cost
	this.$gc1HandlingFeeTotal = 0;
	this.$gc1HandlingPaid = &quot;yes&quot;; // or &quot;no&quot; - easier than boolean
	this.$gc1HandlingCount = 0;
	this.$gc1HFExempt = &quot;no&quot;;
	// maintenance fee
	this.$gc1MaintenanceFee = 0.05*this.$gc1Cost; // 0.05 of cost
	this.$gc1MaintenanceFeeTotal = 0;
	this.$gc1MaintenancePaid = &quot;no&quot; // or &quot;yes&quot;
	this.$gc1MaintenanceInterval = 10; // in runs (according to cost)
	this.$gc1MaintenanceCount = 0;
	// dismantling fee
	this.$gc1DismantlingFee = 0.1*this.$gc1Cost; // 0.1 of cost
	this.$gc1DismantlingFeeTotal = 0.0;
	// system-to-system runs w/container
	this.$gc1Runs = 0;
}


this.playerWillSaveGame = function(message) {
	missionVariables.gc1Count = this.$gc1Count;
	missionVariables.gc1Cargo = player.ship.cargoSpaceCapacity;
	missionVariables.gc1Containers = this.$gc1Containers;
	// save total fees taken
	missionVariables.gc1HandlingFeeTotal = this.$gc1HandlingFeeTotal;
	missionVariables.gc1MaintenanceFeeTotal = this.$gc1MaintenanceFeeTotal;
	missionVariables.gc1DismantlingFeeTotal = this.$gc1DismantlingFeeTotal;
	missionVariables.gc1HandlingPaid = this.$gc1HandlingPaid;
	// system-to-system runs w/container
	missionVariables.gc1Runs =this.$gc1Runs;
	// handling fee count
	missionVariables.gc1HandlingCount = this.$gc1HandlingCount;
	// handling fee exemption (G.E.T.)
	missionVariables.gc1HFExempt = this.$gc1HFExempt;
	// maintenance fee count
	missionVariables.gc1MaintenanceCount = this.$gc1MaintenanceCount;
}


this.shipDockedWithStation = function(station) {
	// take handling fee (if not exempt)
	var pc = player.consoleMessage;
	var ex = this.$gc1HFExempt;
	// check we have containers, the fee is not paid, and we&#39;re not exempt
	if ((this.$gc1Containers&gt;0) &amp;&amp; (this.$gc1HandlingPaid===&quot;no&quot;) &amp;&amp; (ex===&quot;no&quot;)) {
		var fee = 0;
		for (var x=1; x&lt;= this.$gc1Containers; x++)
			fee += this.$gc1HandlingFee;
		// record fee and debit trader&#39;s account
		this.$gc1HandlingFeeTotal += fee;
		player.credits -= fee;
		this.$gc1HandlingPaid = &quot;yes&quot;;
		pc(&quot;10 TC Container handling fees: &quot;+fee+&quot; cr&quot;,9);
		this.$gc1HandlingCount++;
	}

	// conditionally take maintenance fee
	if (this.$gc1Containers&gt;0) this._gc1DoMaintenance();

	// TEST
	if ((this.$gc1Containers&lt;this.$gc1MCap) &amp;&amp; (system.techLevel&gt;=6))
		pc(&quot;Containers available in the Shipyard.&quot;);
	
	// prepare container Account and Licence page
	if (this.$gc1Containers&gt;0) this._gc1PrepAcc(station);
	
	// prepare handling fee waiver request if ET or FESP is present
	if (this.$gc1Containers&gt;0) this._gc1PrepEx(station);
}



this.shipExitedWitchspace = function() {
	// set handling paid to &#39;no&#39;
	this.$gc1HandlingPaid = &quot;no&quot;;
	this.$gc1Runs ++;
}


/* Common helper functions */


// assess and take maintenance fee
this._gc1DoMaintenance = function() {
	var pc = player.consoleMessage;
	var runs = this.$gc1Runs;
	var intv = this.$gc1MaintenanceInterval;
	var mfee = this.$gc1MaintenanceFee;
	// take maintenance fee after y runs
	if ( (runs &gt; 0) &amp;&amp; ((runs % intv)==0) ) {
		// maintenance for x containers
		var fee = 0;
		for (var x=1; x&lt;= this.$gc1Containers; x++)
			fee += mfee;
		// maintenance fee tally &amp; debit
		this.$gc1MaintenanceFeeTotal += fee;
		player.credits -= fee;
		pc(&quot;10 TC Container Maintenance fees: &quot;+fee+&quot; cr&quot;,9);
		// update Maintenance count
		this.$gc1MaintenanceCount++;
	}
}


/* F4 Interfaces */


// create F.E.S. &#39;Licence &amp; Account&#39; page 
this._gc1PrepAcc = function(station) {
	station.setInterface(&quot;gc1Acc&quot;,{
	title: &quot;Your FE Shipyards 10 TC Container Class Licence&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;Your FE Shipyards 10 TC Goods Container account screen shows terms, fees paid, load, and other useful information.&quot;,
	callback: this._gc1ShowAcc.bind(this)
	});	
}


// show F.E.S. &#39;Licence &amp; Account&#39; page
this._gc1ShowAcc = function() {
	var hfc = this.$gc1HandlingCount;
	var mfc = this.$gc1MaintenanceCount;
	var mfi = this.$gc1MaintenanceInterval;
	var hft = this.$gc1HandlingFeeTotal;
	var mft = this.$gc1MaintenanceFeeTotal;
	var dft = this.$gc1DismantlingFeeTotal;
		
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	if (this.$gc1Containers&gt;0) 
		parameters.message +=&quot;Your Account and Licence for 10 TC Class Goods Containers x &quot;+this.$gc1Containers+&quot;: \n\n&quot;; 
	 else
		parameters.message +=&quot;You have no 10 TC Class Containers licensed with us at this time. \n\n&quot;;
	
	parameters.message +=&quot;Handling fees paid: &quot;+hft+&quot; cr (&quot;+hfc+&quot;) \n&quot;;
	parameters.message +=&quot;Maintenance fees paid: &quot;+mft+&quot; cr (&quot;+mfc+&quot;) \n&quot;;
	parameters.message +=&quot;Dismantling fees paid: &quot;+dft+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;Our containers are re-used many times per cycle, often many times per day. Maintaining them in clean and serviceable condition for their maximum useful lifetime is our prime concern at FE Shipyards, and we trust that you, our valued customer, understand the need for your own participation in this costly and ongoing process. \n\n&quot;;
	
	parameters.message += &quot;The handling charge (0.005 of cost) is levied upon docking, the maintenance fee (0.05 of cost) every &quot;+mfi+&quot; system-to-system trading runs. \n\n&quot;
	
	parameters.message += &quot;If you cancel your Container account with us at any time, we must charge the dismantling fee (0.1 of cost) to re-modify and restore your vessel&#39;s pylons for weapons-use. \n&quot;;
	
	parameters.choicesKey = &quot;gc1Acknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}
}



// create F.E.S. handling fee waiver/restoration request  
this._gc1PrepEx = function(station) {
	station.setInterface(&quot;gc1Ex&quot;,{
	title: &quot;Your FE Shipyards Handling Fee Waiver Request&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards grants Guilders and FE shipowners the privileged option to waive our handling and dismantling fees for the 10-ton container class.&quot; ,
	callback: this._gc1ShowEx.bind(this)
	});	
}


// show F.E.S. handling &amp; dismantling fee waiver/restoration request
this._gc1ShowEx = function() {
	var priv = ((this.$gc1ET)||(this.$gc1FES));
	var privo = &quot;&quot;;
	if (this.$gc1FES) privo=&quot;FE shipowner&quot;;
	if (this.$gc1ET) privo=&quot;Guilder&quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;Re: your request to waive your 10 TC container fees.\n\n&quot;
	
	parameters.message += &quot;The handling fee (0.005 of cost) is taken from your account upon docking, and is merely to cover our attachment/detachment &amp; loading/unloading services. The dismantling fee (0.1 of cost) is charged when re-modifying your pylons for weapons-use after Licence cancellation. \n\n&quot;;
	
	if (priv)
		parameters.message += &quot;FE Shipyards grants you, as a &quot;+privo+&quot;, the privileged option to waive our handling and dismantling fees, although you are free - and encouraged - to continue supporting our efforts to provide the efficient service you as an Elite Trader deserve. \n\n&quot;;
	else
		parameters.message += &quot;FE Shipyards regrets that we are unable at this time to grant you an exemption from fees, which is a privilege of Guilders and FE shipowners exclusively. \n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;gc1YesNoEx&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_AYE&quot;)  {
			if (priv) this.$gc1HFExempt = &quot;yes&quot;; else this.$gc1HFExempt = &quot;no&quot;;
		} else this.$gc1HFExempt = &quot;no&quot;;
		player.commsMessage(&quot;FE Shipyards thanks you for your attention.&quot;);
	}	
}



</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/gc2_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Goods Container 20 TC&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;2.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	// keep tally of pylon accessories bought
	this.$gc2Count++;
    // and don&#39;t let them exceed ship&#39;s pylon-capacity
	if ((equipment == &quot;EQ_GC2_MINE&quot;) &amp;&amp; (this.$gc2Count&lt;=this.$gc2MCap)) {
		player.ship.cargoSpaceCapacity += 20;
		this.$gc2Containers++;
		pc(&quot;Modifying pylon hardpoints for container clamping...&quot;,9);
		pc(&quot;Fitting 20 TC Class Container #&quot;+this.$gc2Containers+&quot;...&quot;,9);
		pc(&quot;F4 &#39;Your FE Shipyards&#39; to check your Licence.&quot;,9);
	} else
	// unmount &amp; sell cancels all container additions
	if (equipment == &quot;EQ_MISSILE_REMOVAL&quot;) {
		player.ship.cargoSpaceCapacity -= this.$gc2Containers*20;
		if (this.$gc2Containers&gt;0) {
			pc(&quot;Removing all 20 TC Class Containers...&quot;,9);
			pc(&quot;Restoring pylon hardpoints for weapons-use...&quot;,9);
		}
		if ((this.$gc2Containers&gt;0) &amp;&amp; (!this.$gc2HFExempt)) {
			// dismantling fee
			var dft = this.$gc2Containers*this.$gc2DismantlingFee;
			this.$gc2DismantlingFeeTotal += dft;
			player.credits -= dft;
			pc(&quot;Dismantling Fee: &quot;+dft+&quot; cr&quot;,9);
		}
		this.$gc2Count = 0;
		this.$gc2Containers = 0;
		// reset system-to-system runs w/containers
		this.$gc2Runs = 0;
		// reset fee totals
		this.$gc2HandlingFeeTotal = 0;
		this.$gc2MaintenanceFeeTotal = 0;
	}
}


this.playerBoughtNewShip = function(ship, price) {
	// missile capacity (not exceed)
	this.$gc2MCap = player.ship.missileCapacity;
	this.$gc2Count = 0;
	this.$gc2Containers = 0;
}


this.equipmentRemoved = function(equipmentKey) {
    if (equipmentKey == &quot;EQ_GC2_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 20;
		this.$gc2Containers--;	
		player.consoleMessage(&quot;20 TC Goods Container removed.&quot;,5);
	}
}


this.shipReleasedEquipment = function(mine) {
	this.$gc2Count--;
    if (mine == &quot;EQ_GC2_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 20;
		this.$gc2Containers--;
		player.commsMessage(&quot;20 TC Goods Container jettisoned.&quot;,5);
		// deduct container cost from credits
		player.credits -= 20000.0;
		player.commsMessage(&quot;Mishandling charge applied at cost.&quot;,9);
	}
}


this.shipFiredMissile = function(missile, target) {
	this.$gc2Count--;
    if (missile == &quot;EQ_GC2_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 20;
		this.$gc2Containers--;	
		player.commsMessage(&quot;20 TC Goods Container jettisoned.&quot;,5);
		// deduct container cost from credits
		player.credits -= 20000.0;
		player.commsMessage(&quot;Mishandling charge applied at cost.&quot;,9);
	}
}


this.startUpComplete = function () {
	var pc = player.consoleMessage;
	// missile capacity (not exceed)
	this.$gc2MCap = player.ship.missileCapacity;
	this.$gc2Count = player.ship.missiles.length;
	// Load cargo space, missile &amp; container counts if present
	if (missionVariables.gc2Cargo != null) 
		player.ship.cargoSpaceCapacity = missionVariables.gc2Cargo;
	if (missionVariables.gc2Count != null)
		this.$gc2Count = missionVariables.gc2Count;
	if (missionVariables.gc2Containers != null) 
		this.$gc2Containers = missionVariables.gc2Containers;
	// Load total fees taken
	if (missionVariables.gc2HandlingFeeTotal != null)
		this.$gc2HandlingFeeTotal = missionVariables.gc2HandlingFeeTotal;
	if (missionVariables.gc2HandlingPaid != null)
		this.$gc2HandlingPaid = missionVariables.gc2HandlingPaid;
	if (missionVariables.gc2MaintenanceFeeTotal != null)
		this.$gc2MaintenanceFeeTotal = missionVariables.gc2MaintenanceFeeTotal;
	if (missionVariables.gc2DismantlingFeeTotal != null)
		this.$gc2DismantlingFeeTotal = missionVariables.gc2DismantlingFeeTotal; 
    // Load system-to-system runs w/container
	if (missionVariables.gc2Runs != null)
		this.$gc2Runs = missionVariables.gc2Runs;
	// Load Handling fee count
	if (missionVariables.gc2HandlingCount != null)
		this.$gc2HandlingCount = missionVariables.gc2HandlingCount;
	// Load handling fee exemption status
	if (missionVariables.gc2HFExempt != null)
		this.$gc2HFExempt = missionVariables.gc2HFExempt;
	// Load Maintenance fee count
	if (missionVariables.gc2MaintenanceCount != null)
		this.$gc2MaintenanceCount = missionVariables.gc2MaintenanceCount;
	// CHECK
	log(this.name, this.name+&quot; startup complete.&quot;);
	// TEST
	var sta = player.ship.dockedStation;
	if ((this.$gc2Containers&lt;this.$gc2MCap) &amp;&amp; (system.techLevel&gt;=6))
		pc(&quot;Containers available in the Shipyard.&quot;);
	// prepare container Account screen
	if (this.$gc2Containers&gt;0) this._gc2PrepAcc(sta);
	// optionally, prepare handling fee waiver request
	if (this.$gc2Containers&gt;0) this._gc2PrepEx(sta);
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// check for G.E.T. presence
	this.$gc2ET = false;
	if (worldScripts[&quot;Elite Trader&quot;]) 
		this.$gc2ET = true;
	// TEST	
	if (this.$gc2ET) log(this.name, &quot;Finds Elite Trader present&quot;);
	// check for FE Ships Player
	this.$gc2FES = false;
	if (worldScripts[&quot;FE Ships Player&quot;]) 
		this.$gc2FES = true;
	// TEST	
	if (this.$gc2ET) log(this.name, &quot;Finds FE Ships Player present&quot;);
	// missile capacity (not exceed)
	this.$gc2MCap = 0;
	// pylon-use count
	this.$gc2Count = 0;
	// container count
	this.$gc2Containers = 0;
	// purchase cost of container in cr
	this.$gc2Cost = 20000;
	// handling fee
	this.$gc2HandlingFee = 0.005*this.$gc2Cost; // 0.005 of cost
	this.$gc2HandlingFeeTotal = 0;
	this.$gc2HandlingPaid = &quot;yes&quot;; // or &quot;no&quot; - easier than boolean
	this.$gc2HandlingCount = 0;
	this.$gc2HFExempt = &quot;no&quot;;
	// maintenance fee
	this.$gc2MaintenanceFee = 0.05*this.$gc2Cost; // 0.05 of cost
	this.$gc2MaintenanceFeeTotal = 0;
	this.$gc2MaintenancePaid = &quot;no&quot; // or &quot;yes&quot;
	this.$gc2MaintenanceInterval = 20; // in runs (according to cost)
	this.$gc2MaintenanceCount = 0;
	// dismantling fee
	this.$gc2DismantlingFee = 0.1*this.$gc2Cost; // 0.1 of cost
	this.$gc2DismantlingFeeTotal = 0.0;
	// system-to-system runs w/container
	this.$gc2Runs = 0;
}


this.playerWillSaveGame = function(message) {
	missionVariables.gc2Count = this.$gc2Count;
	missionVariables.gc2Cargo = player.ship.cargoSpaceCapacity;
	missionVariables.gc2Containers = this.$gc2Containers;
	// save total fees taken
	missionVariables.gc2HandlingFeeTotal = this.$gc2HandlingFeeTotal;
	missionVariables.gc2MaintenanceFeeTotal = this.$gc2MaintenanceFeeTotal;
	missionVariables.gc2DismantlingFeeTotal = this.$gc2DismantlingFeeTotal;
	missionVariables.gc2HandlingPaid = this.$gc2HandlingPaid;
	// system-to-system runs w/container
	missionVariables.gc2Runs =this.$gc2Runs;
	// handling fee count
	missionVariables.gc2HandlingCount = this.$gc2HandlingCount;
	// handling fee exemption (G.E.T.)
	missionVariables.gc2HFExempt = this.$gc2HFExempt;
	// maintenance fee count
	missionVariables.gc2MaintenanceCount = this.$gc2MaintenanceCount;
}


this.shipDockedWithStation = function(station) {
	// take handling fee (if not exempt)
	var pc = player.consoleMessage;
	var ex = this.$gc2HFExempt;
	// check we have containers, the fee is not paid, and we&#39;re not exempt
	if ((this.$gc2Containers&gt;0) &amp;&amp; (this.$gc2HandlingPaid===&quot;no&quot;) &amp;&amp; (ex===&quot;no&quot;)) {
		var fee = 0;
		for (var x=1; x&lt;= this.$gc2Containers; x++)
			fee += this.$gc2HandlingFee;
		// record fee and debit trader&#39;s account
		this.$gc2HandlingFeeTotal += fee;
		player.credits -= fee;
		this.$gc2HandlingPaid = &quot;yes&quot;;
		pc(&quot;20 TC Container handling fees: &quot;+fee+&quot; cr&quot;,9);
		this.$gc2HandlingCount++;
	}

	// conditionally take maintenance fee
	if (this.$gc2Containers&gt;0) this._gc2DoMaintenance();

	// TEST
	if ((this.$gc2Containers&lt;this.$gc2MCap) &amp;&amp; (system.techLevel&gt;=6))
		pc(&quot;Containers available in the Shipyard.&quot;);
	
	// prepare container Account and Licence page
	if (this.$gc2Containers&gt;0) this._gc2PrepAcc(station);
	
	// prepare handling fee waiver request if ET or FESP is present
	if (this.$gc2Containers&gt;0) this._gc2PrepEx(station);
}



this.shipExitedWitchspace = function() {
	// set handling paid to &#39;no&#39;
	this.$gc2HandlingPaid = &quot;no&quot;;
	this.$gc2Runs ++;
}


/* Common helper functions */


// assess and take maintenance fee
this._gc2DoMaintenance = function() {
	var pc = player.consoleMessage;
	var runs = this.$gc2Runs;
	var intv = this.$gc2MaintenanceInterval;
	var mfee = this.$gc2MaintenanceFee;
	// take maintenance fee after y runs
	if ( (runs &gt; 0) &amp;&amp; ((runs % intv)==0) ) {
		// maintenance for x containers
		var fee = 0;
		for (var x=1; x&lt;= this.$gc2Containers; x++)
			fee += mfee;
		// maintenance fee tally &amp; debit
		this.$gc2MaintenanceFeeTotal += fee;
		player.credits -= fee;
		pc(&quot;20 TC Container Maintenance fees: &quot;+fee+&quot; cr&quot;,9);
		// update Maintenance count
		this.$gc2MaintenanceCount++;
	}
}


/* F4 Interfaces */


// create F.E.S. &#39;Licence &amp; Account&#39; page 
this._gc2PrepAcc = function(station) {
	station.setInterface(&quot;gc2Acc&quot;,{
	title: &quot;Your FE Shipyards 20 TC Container Class Licence&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;Your FE Shipyards 20 TC Goods Container account screen shows terms, fees paid, load, and other useful information.&quot;,
	callback: this._gc2ShowAcc.bind(this)
	});	
}


// show F.E.S. &#39;Licence &amp; Account&#39; page
this._gc2ShowAcc = function() {
	var hfc = this.$gc2HandlingCount;
	var mfc = this.$gc2MaintenanceCount;
	var mfi = this.$gc2MaintenanceInterval;
	var hft = this.$gc2HandlingFeeTotal;
	var mft = this.$gc2MaintenanceFeeTotal;
	var dft = this.$gc2DismantlingFeeTotal;
		
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	if (this.$gc2Containers&gt;0) 
		parameters.message +=&quot;Your Account and Licence for 20 TC Class Goods Containers x &quot;+this.$gc2Containers+&quot;: \n\n&quot;; 
	 else
		parameters.message +=&quot;You have no 20 TC Class Containers licensed with us at this time. \n\n&quot;;
	
	parameters.message +=&quot;Handling fees paid: &quot;+hft+&quot; cr (&quot;+hfc+&quot;) \n&quot;;
	parameters.message +=&quot;Maintenance fees paid: &quot;+mft+&quot; cr (&quot;+mfc+&quot;) \n&quot;;
	parameters.message +=&quot;Dismantling fees paid: &quot;+dft+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;Our containers are re-used many times per cycle, often many times per day. Maintaining them in clean and serviceable condition for their maximum useful lifetime is our prime concern at FE Shipyards, and we trust that you, our valued customer, understand the need for your own participation in this costly and ongoing process. \n\n&quot;;
	
	parameters.message += &quot;The handling charge (0.005 of cost) is levied upon docking, the maintenance fee (0.05 of cost) every &quot;+mfi+&quot; system-to-system trading runs. \n\n&quot;
	
	parameters.message += &quot;If you cancel your Container account with us at any time, we must charge the dismantling fee (0.1 of cost) to re-modify and restore your vessel&#39;s pylons for weapons-use. \n&quot;;
	
	parameters.choicesKey = &quot;gc2Acknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}
}



// create F.E.S. handling fee waiver/restoration request  
this._gc2PrepEx = function(station) {
	station.setInterface(&quot;gc2Ex&quot;,{
	title: &quot;Your FE Shipyards Handling Fee Waiver Request&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards grants Guilders and FE shipowners the privileged option to waive our handling and dismantling fees for the 20-ton container class.&quot; ,
	callback: this._gc2ShowEx.bind(this)
	});	
}


// show F.E.S. handling &amp; dismantling fee waiver/restoration request
this._gc2ShowEx = function() {
	var priv = ((this.$gc2ET)||(this.$gc2FES));
	var privo = &quot;&quot;;
	if (this.$gc2FES) privo=&quot;FE shipowner&quot;;
	if (this.$gc2ET) privo=&quot;Guilder&quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;Re: your request to waive your 20 TC container fees.\n\n&quot;
	
	parameters.message += &quot;The handling fee (0.005 of cost) is taken from your account upon docking, and is merely to cover our attachment/detachment &amp; loading/unloading services. The dismantling fee (0.1 of cost) is charged when re-modifying your pylons for weapons-use after Licence cancellation. \n\n&quot;;
	
	if (priv)
		parameters.message += &quot;FE Shipyards grants you, as a &quot;+privo+&quot;, the privileged option to waive our handling and dismantling fees, although you are free - and encouraged - to continue supporting our efforts to provide the efficient service you as an Elite Trader deserve. \n\n&quot;;
	else
		parameters.message += &quot;FE Shipyards regrets that we are unable at this time to grant you an exemption from fees, which is a privilege of Guilders and FE shipowners exclusively. \n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;gc2YesNoEx&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_AYE&quot;)  {
			if (priv) this.$gc2HFExempt = &quot;yes&quot;; else this.$gc2HFExempt = &quot;no&quot;;
		} else this.$gc2HFExempt = &quot;no&quot;;
		player.commsMessage(&quot;FE Shipyards thanks you for your attention.&quot;);
	}	
}



</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/gc3_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Goods Container 30 TC&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;2.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	// keep tally of pylon accessories bought
	this.$gc3Count++;
    // and don&#39;t let them exceed ship&#39;s pylon-capacity
	if ((equipment == &quot;EQ_GC3_MINE&quot;) &amp;&amp; (this.$gc3Count&lt;=this.$gc3MCap)) {
		player.ship.cargoSpaceCapacity += 30;
		this.$gc3Containers++;
		pc(&quot;Modifying pylon hardpoints for container clamping...&quot;,9);
		pc(&quot;Fitting 30 TC Class Container #&quot;+this.$gc3Containers+&quot;...&quot;,9);
		pc(&quot;F4 &#39;Your FE Shipyards&#39; to check your Licence.&quot;,9);
	} else
	// unmount &amp; sell cancels all container additions
	if (equipment == &quot;EQ_MISSILE_REMOVAL&quot;) {
		player.ship.cargoSpaceCapacity -= this.$gc3Containers*30;
		if (this.$gc3Containers&gt;0) {
			pc(&quot;Removing all 30 TC Class Containers...&quot;,9);
			pc(&quot;Restoring pylon hardpoints for weapons-use...&quot;,9);
		}
		if ((this.$gc3Containers&gt;0) &amp;&amp; (!this.$gc3HFExempt)) {
			// dismantling fee
			var dft = this.$gc3Containers*this.$gc3DismantlingFee;
			this.$gc3DismantlingFeeTotal += dft;
			player.credits -= dft;
			pc(&quot;Dismantling Fee: &quot;+dft+&quot; cr&quot;,9);
		}
		this.$gc3Count = 0;
		this.$gc3Containers = 0;
		// reset system-to-system runs w/containers
		this.$gc3Runs = 0;
		// reset fee totals
		this.$gc3HandlingFeeTotal = 0;
		this.$gc3MaintenanceFeeTotal = 0;
	}
}


this.playerBoughtNewShip = function(ship, price) {
	// missile capacity (not exceed)
	this.$gc3MCap = player.ship.missileCapacity;
	this.$gc3Count = 0;
	this.$gc3Containers = 0;
}


this.equipmentRemoved = function(equipmentKey) {
    if (equipmentKey == &quot;EQ_GC3_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 30;
		this.$gc3Containers--;	
		player.consoleMessage(&quot;30 TC Goods Container removed.&quot;,5);
	}
}


this.shipReleasedEquipment = function(mine) {
	this.$gc3Count--;
    if (mine == &quot;EQ_GC3_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 30;
		this.$gc3Containers--;
		player.commsMessage(&quot;30 TC Goods Container jettisoned.&quot;,5);
		// deduct container cost from credits
		player.credits -= 30000.0;
		player.commsMessage(&quot;Mishandling charge applied at cost.&quot;,9);
	}
}


this.shipFiredMissile = function(missile, target) {
	this.$gc3Count--;
    if (missile == &quot;EQ_GC3_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 30;
		this.$gc3Containers--;	
		player.commsMessage(&quot;30 TC Goods Container jettisoned.&quot;,5);
		// deduct container cost from credits
		player.credits -= 30000.0;
		player.commsMessage(&quot;Mishandling charge applied at cost.&quot;,9);
	}
}


this.startUpComplete = function () {
	var pc = player.consoleMessage;
	// missile capacity (not exceed)
	this.$gc3MCap = player.ship.missileCapacity;
	this.$gc3Count = player.ship.missiles.length;
	// Load cargo space, missile &amp; container counts if present
	if (missionVariables.gc3Cargo != null) 
		player.ship.cargoSpaceCapacity = missionVariables.gc3Cargo;
	if (missionVariables.gc3Count != null)
		this.$gc3Count = missionVariables.gc3Count;
	if (missionVariables.gc3Containers != null) 
		this.$gc3Containers = missionVariables.gc3Containers;
	// Load total fees taken
	if (missionVariables.gc3HandlingFeeTotal != null)
		this.$gc3HandlingFeeTotal = missionVariables.gc3HandlingFeeTotal;
	if (missionVariables.gc3HandlingPaid != null)
		this.$gc3HandlingPaid = missionVariables.gc3HandlingPaid;
	if (missionVariables.gc3MaintenanceFeeTotal != null)
		this.$gc3MaintenanceFeeTotal = missionVariables.gc3MaintenanceFeeTotal;
	if (missionVariables.gc3DismantlingFeeTotal != null)
		this.$gc3DismantlingFeeTotal = missionVariables.gc3DismantlingFeeTotal; 
    // Load system-to-system runs w/container
	if (missionVariables.gc3Runs != null)
		this.$gc3Runs = missionVariables.gc3Runs;
	// Load Handling fee count
	if (missionVariables.gc3HandlingCount != null)
		this.$gc3HandlingCount = missionVariables.gc3HandlingCount;
	// Load handling fee exemption status
	if (missionVariables.gc3HFExempt != null)
		this.$gc3HFExempt = missionVariables.gc3HFExempt;
	// Load Maintenance fee count
	if (missionVariables.gc3MaintenanceCount != null)
		this.$gc3MaintenanceCount = missionVariables.gc3MaintenanceCount;
	// CHECK
	log(this.name, this.name+&quot; startup complete.&quot;);
	// TEST
	var sta = player.ship.dockedStation;
	if ((this.$gc3Containers&lt;this.$gc3MCap) &amp;&amp; (system.techLevel&gt;=6))
		pc(&quot;Containers available in the Shipyard.&quot;);
	// prepare container Account screen
	if (this.$gc3Containers&gt;0) this._gc3PrepAcc(sta);
	// optionally, prepare handling fee waiver request
	if (this.$gc3Containers&gt;0) this._gc3PrepEx(sta);
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// check for G.E.T. presence
	this.$gc3ET = false;
	if (worldScripts[&quot;Elite Trader&quot;]) 
		this.$gc3ET = true;
	// TEST	
	if (this.$gc3ET) log(this.name, &quot;Finds Elite Trader present&quot;);
	// check for FE Ships Player
	this.$gc3FES = false;
	if (worldScripts[&quot;FE Ships Player&quot;]) 
		this.$gc3FES = true;
	// TEST	
	if (this.$gc3ET) log(this.name, &quot;Finds FE Ships Player present&quot;);
	// missile capacity (not exceed)
	this.$gc3MCap = 0;
	// pylon-use count
	this.$gc3Count = 0;
	// container count
	this.$gc3Containers = 0;
	// purchase cost of container in cr
	this.$gc3Cost = 30000;
	// handling fee
	this.$gc3HandlingFee = 0.005*this.$gc3Cost; // 0.005 of cost
	this.$gc3HandlingFeeTotal = 0;
	this.$gc3HandlingPaid = &quot;yes&quot;; // or &quot;no&quot; - easier than boolean
	this.$gc3HandlingCount = 0;
	this.$gc3HFExempt = &quot;no&quot;;
	// maintenance fee
	this.$gc3MaintenanceFee = 0.05*this.$gc3Cost; // 0.05 of cost
	this.$gc3MaintenanceFeeTotal = 0;
	this.$gc3MaintenancePaid = &quot;no&quot; // or &quot;yes&quot;
	this.$gc3MaintenanceInterval = 30; // in runs (according to cost)
	this.$gc3MaintenanceCount = 0;
	// dismantling fee
	this.$gc3DismantlingFee = 0.1*this.$gc3Cost; // 0.1 of cost
	this.$gc3DismantlingFeeTotal = 0.0;
	// system-to-system runs w/container
	this.$gc3Runs = 0;
}


this.playerWillSaveGame = function(message) {
	missionVariables.gc3Count = this.$gc3Count;
	missionVariables.gc3Cargo = player.ship.cargoSpaceCapacity;
	missionVariables.gc3Containers = this.$gc3Containers;
	// save total fees taken
	missionVariables.gc3HandlingFeeTotal = this.$gc3HandlingFeeTotal;
	missionVariables.gc3MaintenanceFeeTotal = this.$gc3MaintenanceFeeTotal;
	missionVariables.gc3DismantlingFeeTotal = this.$gc3DismantlingFeeTotal;
	missionVariables.gc3HandlingPaid = this.$gc3HandlingPaid;
	// system-to-system runs w/container
	missionVariables.gc3Runs =this.$gc3Runs;
	// handling fee count
	missionVariables.gc3HandlingCount = this.$gc3HandlingCount;
	// handling fee exemption (G.E.T.)
	missionVariables.gc3HFExempt = this.$gc3HFExempt;
	// maintenance fee count
	missionVariables.gc3MaintenanceCount = this.$gc3MaintenanceCount;
}


this.shipDockedWithStation = function(station) {
	// take handling fee (if not exempt)
	var pc = player.consoleMessage;
	var ex = this.$gc3HFExempt;
	// check we have containers, the fee is not paid, and we&#39;re not exempt
	if ((this.$gc3Containers&gt;0) &amp;&amp; (this.$gc3HandlingPaid===&quot;no&quot;) &amp;&amp; (ex===&quot;no&quot;)) {
		var fee = 0;
		for (var x=1; x&lt;= this.$gc3Containers; x++)
			fee += this.$gc3HandlingFee;
		// record fee and debit trader&#39;s account
		this.$gc3HandlingFeeTotal += fee;
		player.credits -= fee;
		this.$gc3HandlingPaid = &quot;yes&quot;;
		pc(&quot;30 TC Container handling fees: &quot;+fee+&quot; cr&quot;,9);
		this.$gc3HandlingCount++;
	}

	// conditionally take maintenance fee
	if (this.$gc3Containers&gt;0) this._gc3DoMaintenance();

	// TEST
	if ((this.$gc3Containers&lt;this.$gc3MCap) &amp;&amp; (system.techLevel&gt;=6))
		pc(&quot;Containers available in the Shipyard.&quot;);
	
	// prepare container Account and Licence page
	if (this.$gc3Containers&gt;0) this._gc3PrepAcc(station);
	
	// prepare handling fee waiver request if ET or FESP is present
	if (this.$gc3Containers&gt;0) this._gc3PrepEx(station);
}



this.shipExitedWitchspace = function() {
	// set handling paid to &#39;no&#39;
	this.$gc3HandlingPaid = &quot;no&quot;;
	this.$gc3Runs ++;
}


/* Common helper functions */


// assess and take maintenance fee
this._gc3DoMaintenance = function() {
	var pc = player.consoleMessage;
	var runs = this.$gc3Runs;
	var intv = this.$gc3MaintenanceInterval;
	var mfee = this.$gc3MaintenanceFee;
	// take maintenance fee after y runs
	if ( (runs &gt; 0) &amp;&amp; ((runs % intv)==0) ) {
		// maintenance for x containers
		var fee = 0;
		for (var x=1; x&lt;= this.$gc3Containers; x++)
			fee += mfee;
		// maintenance fee tally &amp; debit
		this.$gc3MaintenanceFeeTotal += fee;
		player.credits -= fee;
		pc(&quot;30 TC Container Maintenance fees: &quot;+fee+&quot; cr&quot;,9);
		// update Maintenance count
		this.$gc3MaintenanceCount++;
	}
}


/* F4 Interfaces */


// create F.E.S. &#39;Licence &amp; Account&#39; page 
this._gc3PrepAcc = function(station) {
	station.setInterface(&quot;gc3Acc&quot;,{
	title: &quot;Your FE Shipyards 30 TC Container Class Licence&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;Your FE Shipyards 30 TC Goods Container account screen shows terms, fees paid, load, and other useful information.&quot;,
	callback: this._gc3ShowAcc.bind(this)
	});	
}


// show F.E.S. &#39;Licence &amp; Account&#39; page
this._gc3ShowAcc = function() {
	var hfc = this.$gc3HandlingCount;
	var mfc = this.$gc3MaintenanceCount;
	var mfi = this.$gc3MaintenanceInterval;
	var hft = this.$gc3HandlingFeeTotal;
	var mft = this.$gc3MaintenanceFeeTotal;
	var dft = this.$gc3DismantlingFeeTotal;
		
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	if (this.$gc3Containers&gt;0) 
		parameters.message +=&quot;Your Account and Licence for 30 TC Class Goods Containers x &quot;+this.$gc3Containers+&quot;: \n\n&quot;; 
	 else
		parameters.message +=&quot;You have no 30 TC Class Containers licensed with us at this time. \n\n&quot;;
	
	parameters.message +=&quot;Handling fees paid: &quot;+hft+&quot; cr (&quot;+hfc+&quot;) \n&quot;;
	parameters.message +=&quot;Maintenance fees paid: &quot;+mft+&quot; cr (&quot;+mfc+&quot;) \n&quot;;
	parameters.message +=&quot;Dismantling fees paid: &quot;+dft+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;Our containers are re-used many times per cycle, often many times per day. Maintaining them in clean and serviceable condition for their maximum useful lifetime is our prime concern at FE Shipyards, and we trust that you, our valued customer, understand the need for your own participation in this costly and ongoing process. \n\n&quot;;
	
	parameters.message += &quot;The handling charge (0.005 of cost) is levied upon docking, the maintenance fee (0.05 of cost) every &quot;+mfi+&quot; system-to-system trading runs. \n\n&quot;
	
	parameters.message += &quot;If you cancel your Container account with us at any time, we must charge the dismantling fee (0.1 of cost) to re-modify and restore your vessel&#39;s pylons for weapons-use. \n&quot;;
	
	parameters.choicesKey = &quot;gc3Acknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}
}



// create F.E.S. handling fee waiver/restoration request  
this._gc3PrepEx = function(station) {
	station.setInterface(&quot;gc3Ex&quot;,{
	title: &quot;Your FE Shipyards Handling Fee Waiver Request&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards grants Guilders and FE shipowners the privileged option to waive our handling and dismantling fees for the 30-ton container class.&quot; ,
	callback: this._gc3ShowEx.bind(this)
	});	
}


// show F.E.S. handling &amp; dismantling fee waiver/restoration request
this._gc3ShowEx = function() {
	var priv = ((this.$gc3ET)||(this.$gc3FES));
	var privo = &quot;&quot;;
	if (this.$gc3FES) privo=&quot;FE shipowner&quot;;
	if (this.$gc3ET) privo=&quot;Guilder&quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;Re: your request to waive your 30 TC container fees.\n\n&quot;
	
	parameters.message += &quot;The handling fee (0.005 of cost) is taken from your account upon docking, and is merely to cover our attachment/detachment &amp; loading/unloading services. The dismantling fee (0.1 of cost) is charged when re-modifying your pylons for weapons-use after Licence cancellation. \n\n&quot;;
	
	if (priv)
		parameters.message += &quot;FE Shipyards grants you, as a &quot;+privo+&quot;, the privileged option to waive our handling and dismantling fees, although you are free - and encouraged - to continue supporting our efforts to provide the efficient service you as an Elite Trader deserve. \n\n&quot;;
	else
		parameters.message += &quot;FE Shipyards regrets that we are unable at this time to grant you an exemption from fees, which is a privilege of Guilders and FE shipowners exclusively. \n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;gc3YesNoEx&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_AYE&quot;)  {
			if (priv) this.$gc3HFExempt = &quot;yes&quot;; else this.$gc3HFExempt = &quot;no&quot;;
		} else this.$gc3HFExempt = &quot;no&quot;;
		player.commsMessage(&quot;FE Shipyards thanks you for your attention.&quot;);
	}	
}



</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/gc4_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Goods Container 40 TC&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;2.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	// keep tally of pylon accessories bought
	this.$gc4Count++;
    // and don&#39;t let them exceed ship&#39;s pylon-capacity
	if ((equipment == &quot;EQ_GC4_MINE&quot;) &amp;&amp; (this.$gc4Count&lt;=this.$gc4MCap)) {
		player.ship.cargoSpaceCapacity += 40;
		this.$gc4Containers++;
		pc(&quot;Modifying pylon hardpoints for container clamping...&quot;,9);
		pc(&quot;Fitting 40 TC Class Container #&quot;+this.$gc4Containers+&quot;...&quot;,9);
		pc(&quot;F4 &#39;Your FE Shipyards&#39; to check your Licence.&quot;,9);
	} else
	// unmount &amp; sell cancels all container additions
	if (equipment == &quot;EQ_MISSILE_REMOVAL&quot;) {
		player.ship.cargoSpaceCapacity -= this.$gc4Containers*40;
		if (this.$gc4Containers&gt;0) {
			pc(&quot;Removing all 40 TC Class Containers...&quot;,9);
			pc(&quot;Restoring pylon hardpoints for weapons-use...&quot;,9);
		}
		if ((this.$gc4Containers&gt;0) &amp;&amp; (!this.$gc4HFExempt)) {
			// dismantling fee
			var dft = this.$gc4Containers*this.$gc4DismantlingFee;
			this.$gc4DismantlingFeeTotal += dft;
			player.credits -= dft;
			pc(&quot;Dismantling Fee: &quot;+dft+&quot; cr&quot;,9);
		}
		this.$gc4Count = 0;
		this.$gc4Containers = 0;
		// reset system-to-system runs w/containers
		this.$gc4Runs = 0;
		// reset fee totals
		this.$gc4HandlingFeeTotal = 0;
		this.$gc4MaintenanceFeeTotal = 0;
	}
}


this.playerBoughtNewShip = function(ship, price) {
	// missile capacity (not exceed)
	this.$gc4MCap = player.ship.missileCapacity;
	this.$gc4Count = 0;
	this.$gc4Containers = 0;
}


this.equipmentRemoved = function(equipmentKey) {
    if (equipmentKey == &quot;EQ_GC4_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 40;
		this.$gc4Containers--;	
		player.consoleMessage(&quot;40 TC Goods Container removed.&quot;,5);
	}
}


this.shipReleasedEquipment = function(mine) {
	this.$gc4Count--;
    if (mine == &quot;EQ_GC4_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 40;
		this.$gc4Containers--;
		player.commsMessage(&quot;40 TC Goods Container jettisoned.&quot;,5);
		// deduct container cost from credits
		player.credits -= 40000.0;
		player.commsMessage(&quot;Mishandling charge applied at cost.&quot;,9);
	}
}


this.shipFiredMissile = function(missile, target) {
	this.$gc4Count--;
    if (missile == &quot;EQ_GC4_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 40;
		this.$gc4Containers--;	
		player.commsMessage(&quot;40 TC Goods Container jettisoned.&quot;,5);
		// deduct container cost from credits
		player.credits -= 40000.0;
		player.commsMessage(&quot;Mishandling charge applied at cost.&quot;,9);
	}
}


this.startUpComplete = function () {
	var pc = player.consoleMessage;
	// missile capacity (not exceed)
	this.$gc4MCap = player.ship.missileCapacity;
	this.$gc4Count = player.ship.missiles.length;
	// Load cargo space, missile &amp; container counts if present
	if (missionVariables.gc4Cargo != null) 
		player.ship.cargoSpaceCapacity = missionVariables.gc4Cargo;
	if (missionVariables.gc4Count != null)
		this.$gc4Count = missionVariables.gc4Count;
	if (missionVariables.gc4Containers != null) 
		this.$gc4Containers = missionVariables.gc4Containers;
	// Load total fees taken
	if (missionVariables.gc4HandlingFeeTotal != null)
		this.$gc4HandlingFeeTotal = missionVariables.gc4HandlingFeeTotal;
	if (missionVariables.gc4HandlingPaid != null)
		this.$gc4HandlingPaid = missionVariables.gc4HandlingPaid;
	if (missionVariables.gc4MaintenanceFeeTotal != null)
		this.$gc4MaintenanceFeeTotal = missionVariables.gc4MaintenanceFeeTotal;
	if (missionVariables.gc4DismantlingFeeTotal != null)
		this.$gc4DismantlingFeeTotal = missionVariables.gc4DismantlingFeeTotal; 
    // Load system-to-system runs w/container
	if (missionVariables.gc4Runs != null)
		this.$gc4Runs = missionVariables.gc4Runs;
	// Load Handling fee count
	if (missionVariables.gc4HandlingCount != null)
		this.$gc4HandlingCount = missionVariables.gc4HandlingCount;
	// Load handling fee exemption status
	if (missionVariables.gc4HFExempt != null)
		this.$gc4HFExempt = missionVariables.gc4HFExempt;
	// Load Maintenance fee count
	if (missionVariables.gc4MaintenanceCount != null)
		this.$gc4MaintenanceCount = missionVariables.gc4MaintenanceCount;
	// CHECK
	log(this.name, this.name+&quot; startup complete.&quot;);
	// TEST
	var sta = player.ship.dockedStation;
	if ((this.$gc4Containers&lt;this.$gc4MCap) &amp;&amp; (system.techLevel&gt;=6))
		pc(&quot;Containers available in the Shipyard.&quot;);
	// prepare container Account screen
	if (this.$gc4Containers&gt;0) this._gc4PrepAcc(sta);
	// optionally, prepare handling fee waiver request
	if (this.$gc4Containers&gt;0) this._gc4PrepEx(sta);
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// check for G.E.T. presence
	this.$gc4ET = false;
	if (worldScripts[&quot;Elite Trader&quot;]) 
		this.$gc4ET = true;
	// TEST	
	if (this.$gc4ET) log(this.name, &quot;Finds Elite Trader present&quot;);
	// check for FE Ships Player
	this.$gc4FES = false;
	if (worldScripts[&quot;FE Ships Player&quot;]) 
		this.$gc4FES = true;
	// TEST	
	if (this.$gc4ET) log(this.name, &quot;Finds FE Ships Player present&quot;);
	// missile capacity (not exceed)
	this.$gc4MCap = 0;
	// pylon-use count
	this.$gc4Count = 0;
	// container count
	this.$gc4Containers = 0;
	// purchase cost of container in cr
	this.$gc4Cost = 40000;
	// handling fee
	this.$gc4HandlingFee = 0.005*this.$gc4Cost; // 0.005 of cost
	this.$gc4HandlingFeeTotal = 0;
	this.$gc4HandlingPaid = &quot;yes&quot;; // or &quot;no&quot; - easier than boolean
	this.$gc4HandlingCount = 0;
	this.$gc4HFExempt = &quot;no&quot;;
	// maintenance fee
	this.$gc4MaintenanceFee = 0.05*this.$gc4Cost; // 0.05 of cost
	this.$gc4MaintenanceFeeTotal = 0;
	this.$gc4MaintenancePaid = &quot;no&quot; // or &quot;yes&quot;
	this.$gc4MaintenanceInterval = 40; // in runs (according to cost)
	this.$gc4MaintenanceCount = 0;
	// dismantling fee
	this.$gc4DismantlingFee = 0.1*this.$gc4Cost; // 0.1 of cost
	this.$gc4DismantlingFeeTotal = 0.0;
	// system-to-system runs w/container
	this.$gc4Runs = 0;
}


this.playerWillSaveGame = function(message) {
	missionVariables.gc4Count = this.$gc4Count;
	missionVariables.gc4Cargo = player.ship.cargoSpaceCapacity;
	missionVariables.gc4Containers = this.$gc4Containers;
	// save total fees taken
	missionVariables.gc4HandlingFeeTotal = this.$gc4HandlingFeeTotal;
	missionVariables.gc4MaintenanceFeeTotal = this.$gc4MaintenanceFeeTotal;
	missionVariables.gc4DismantlingFeeTotal = this.$gc4DismantlingFeeTotal;
	missionVariables.gc4HandlingPaid = this.$gc4HandlingPaid;
	// system-to-system runs w/container
	missionVariables.gc4Runs =this.$gc4Runs;
	// handling fee count
	missionVariables.gc4HandlingCount = this.$gc4HandlingCount;
	// handling fee exemption (G.E.T.)
	missionVariables.gc4HFExempt = this.$gc4HFExempt;
	// maintenance fee count
	missionVariables.gc4MaintenanceCount = this.$gc4MaintenanceCount;
}


this.shipDockedWithStation = function(station) {
	// take handling fee (if not exempt)
	var pc = player.consoleMessage;
	var ex = this.$gc4HFExempt;
	// check we have containers, the fee is not paid, and we&#39;re not exempt
	if ((this.$gc4Containers&gt;0) &amp;&amp; (this.$gc4HandlingPaid===&quot;no&quot;) &amp;&amp; (ex===&quot;no&quot;)) {
		var fee = 0;
		for (var x=1; x&lt;= this.$gc4Containers; x++)
			fee += this.$gc4HandlingFee;
		// record fee and debit trader&#39;s account
		this.$gc4HandlingFeeTotal += fee;
		player.credits -= fee;
		this.$gc4HandlingPaid = &quot;yes&quot;;
		pc(&quot;40 TC Container handling fees: &quot;+fee+&quot; cr&quot;,9);
		this.$gc4HandlingCount++;
	}

	// conditionally take maintenance fee
	if (this.$gc4Containers&gt;0) this._gc4DoMaintenance();

	// TEST
	if ((this.$gc4Containers&lt;this.$gc4MCap) &amp;&amp; (system.techLevel&gt;=6))
		pc(&quot;Containers available in the Shipyard.&quot;);
	
	// prepare container Account and Licence page
	if (this.$gc4Containers&gt;0) this._gc4PrepAcc(station);
	
	// prepare handling fee waiver request if ET or FESP is present
	if (this.$gc4Containers&gt;0) this._gc4PrepEx(station);
}



this.shipExitedWitchspace = function() {
	// set handling paid to &#39;no&#39;
	this.$gc4HandlingPaid = &quot;no&quot;;
	this.$gc4Runs ++;
}


/* Common helper functions */


// assess and take maintenance fee
this._gc4DoMaintenance = function() {
	var pc = player.consoleMessage;
	var runs = this.$gc4Runs;
	var intv = this.$gc4MaintenanceInterval;
	var mfee = this.$gc4MaintenanceFee;
	// take maintenance fee after y runs
	if ( (runs &gt; 0) &amp;&amp; ((runs % intv)==0) ) {
		// maintenance for x containers
		var fee = 0;
		for (var x=1; x&lt;= this.$gc4Containers; x++)
			fee += mfee;
		// maintenance fee tally &amp; debit
		this.$gc4MaintenanceFeeTotal += fee;
		player.credits -= fee;
		pc(&quot;40 TC Container Maintenance fees: &quot;+fee+&quot; cr&quot;,9);
		// update Maintenance count
		this.$gc4MaintenanceCount++;
	}
}


/* F4 Interfaces */


// create F.E.S. &#39;Licence &amp; Account&#39; page 
this._gc4PrepAcc = function(station) {
	station.setInterface(&quot;gc4Acc&quot;,{
	title: &quot;Your FE Shipyards 40 TC Container Class Licence&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;Your FE Shipyards 40 TC Goods Container account screen shows terms, fees paid, load, and other useful information.&quot;,
	callback: this._gc4ShowAcc.bind(this)
	});	
}


// show F.E.S. &#39;Licence &amp; Account&#39; page
this._gc4ShowAcc = function() {
	var hfc = this.$gc4HandlingCount;
	var mfc = this.$gc4MaintenanceCount;
	var mfi = this.$gc4MaintenanceInterval;
	var hft = this.$gc4HandlingFeeTotal;
	var mft = this.$gc4MaintenanceFeeTotal;
	var dft = this.$gc4DismantlingFeeTotal;
		
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	if (this.$gc4Containers&gt;0) 
		parameters.message +=&quot;Your Account and Licence for 40 TC Class Goods Containers x &quot;+this.$gc4Containers+&quot;: \n\n&quot;; 
	 else
		parameters.message +=&quot;You have no 40 TC Class Containers licensed with us at this time. \n\n&quot;;
	
	parameters.message +=&quot;Handling fees paid: &quot;+hft+&quot; cr (&quot;+hfc+&quot;) \n&quot;;
	parameters.message +=&quot;Maintenance fees paid: &quot;+mft+&quot; cr (&quot;+mfc+&quot;) \n&quot;;
	parameters.message +=&quot;Dismantling fees paid: &quot;+dft+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;Our containers are re-used many times per cycle, often many times per day. Maintaining them in clean and serviceable condition for their maximum useful lifetime is our prime concern at FE Shipyards, and we trust that you, our valued customer, understand the need for your own participation in this costly and ongoing process. \n\n&quot;;
	
	parameters.message += &quot;The handling charge (0.005 of cost) is levied upon docking, the maintenance fee (0.05 of cost) every &quot;+mfi+&quot; system-to-system trading runs. \n\n&quot;
	
	parameters.message += &quot;If you cancel your Container account with us at any time, we must charge the dismantling fee (0.1 of cost) to re-modify and restore your vessel&#39;s pylons for weapons-use. \n&quot;;
	
	parameters.choicesKey = &quot;gc4Acknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}
}



// create F.E.S. handling fee waiver/restoration request  
this._gc4PrepEx = function(station) {
	station.setInterface(&quot;gc4Ex&quot;,{
	title: &quot;Your FE Shipyards Handling Fee Waiver Request&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards grants Guilders and FE shipowners the privileged option to waive our handling and dismantling fees for the 40-ton container class.&quot; ,
	callback: this._gc4ShowEx.bind(this)
	});	
}


// show F.E.S. handling &amp; dismantling fee waiver/restoration request
this._gc4ShowEx = function() {
	var priv = ((this.$gc4ET)||(this.$gc4FES));
	var privo = &quot;&quot;;
	if (this.$gc4FES) privo=&quot;FE shipowner&quot;;
	if (this.$gc4ET) privo=&quot;Guilder&quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;Re: your request to waive your 40 TC container fees.\n\n&quot;
	
	parameters.message += &quot;The handling fee (0.005 of cost) is taken from your account upon docking, and is merely to cover our attachment/detachment &amp; loading/unloading services. The dismantling fee (0.1 of cost) is charged when re-modifying your pylons for weapons-use after Licence cancellation. \n\n&quot;;
	
	if (priv)
		parameters.message += &quot;FE Shipyards grants you, as a &quot;+privo+&quot;, the privileged option to waive our handling and dismantling fees, although you are free - and encouraged - to continue supporting our efforts to provide the efficient service you as an Elite Trader deserve. \n\n&quot;;
	else
		parameters.message += &quot;FE Shipyards regrets that we are unable at this time to grant you an exemption from fees, which is a privilege of Guilders and FE shipowners exclusively. \n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;gc4YesNoEx&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_AYE&quot;)  {
			if (priv) this.$gc4HFExempt = &quot;yes&quot;; else this.$gc4HFExempt = &quot;no&quot;;
		} else this.$gc4HFExempt = &quot;no&quot;;
		player.commsMessage(&quot;FE Shipyards thanks you for your attention.&quot;);
	}	
}



</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/gc5_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;Goods Container 50 TC&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;2.0&quot;;


this.playerBoughtEquipment = function(equipment, paid) {
	var pc = player.consoleMessage;
	// keep tally of pylon accessories bought
	this.$gc5Count++;
    // and don&#39;t let them exceed ship&#39;s pylon-capacity
	if ((equipment == &quot;EQ_GC5_MINE&quot;) &amp;&amp; (this.$gc5Count&lt;=this.$gc5MCap)) {
		player.ship.cargoSpaceCapacity += 50;
		this.$gc5Containers++;
		pc(&quot;Modifying pylon hardpoints for container clamping...&quot;,9);
		pc(&quot;Fitting 50 TC Class Container #&quot;+this.$gc5Containers+&quot;...&quot;,9);
		pc(&quot;F4 &#39;Your FE Shipyards&#39; to check your Licence.&quot;,9);
	} else
	// unmount &amp; sell cancels all container additions
	if (equipment == &quot;EQ_MISSILE_REMOVAL&quot;) {
		player.ship.cargoSpaceCapacity -= this.$gc5Containers*50;
		if (this.$gc5Containers&gt;0) {
			pc(&quot;Removing all 50 TC Class Containers...&quot;,9);
			pc(&quot;Restoring pylon hardpoints for weapons-use...&quot;,9);
		}
		if ((this.$gc5Containers&gt;0) &amp;&amp; (!this.$gc5HFExempt)) {
			// dismantling fee
			var dft = this.$gc5Containers*this.$gc5DismantlingFee;
			this.$gc5DismantlingFeeTotal += dft;
			player.credits -= dft;
			pc(&quot;Dismantling Fee: &quot;+dft+&quot; cr&quot;,9);
		}
		this.$gc5Count = 0;
		this.$gc5Containers = 0;
		// reset system-to-system runs w/containers
		this.$gc5Runs = 0;
		// reset fee totals
		this.$gc5HandlingFeeTotal = 0;
		this.$gc5MaintenanceFeeTotal = 0;
	}
}


this.playerBoughtNewShip = function(ship, price) {
	// missile capacity (not exceed)
	this.$gc5MCap = player.ship.missileCapacity;
	this.$gc5Count = 0;
	this.$gc5Containers = 0;
}


this.equipmentRemoved = function(equipmentKey) {
    if (equipmentKey == &quot;EQ_GC5_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 50;
		this.$gc5Containers--;	
		player.consoleMessage(&quot;50 TC Goods Container removed.&quot;,5);
	}
}


this.shipReleasedEquipment = function(mine) {
	this.$gc5Count--;
    if (mine == &quot;EQ_GC5_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 50;
		this.$gc5Containers--;
		player.commsMessage(&quot;50 TC Goods Container jettisoned.&quot;,5);
		// deduct container cost from credits
		player.credits -= 50000.0;
		player.commsMessage(&quot;Mishandling charge applied at cost.&quot;,9);
	}
}


this.shipFiredMissile = function(missile, target) {
	this.$gc5Count--;
    if (missile == &quot;EQ_GC5_MINE&quot;) {
		player.ship.cargoSpaceCapacity -= 50;
		this.$gc5Containers--;	
		player.commsMessage(&quot;50 TC Goods Container jettisoned.&quot;,5);
		// deduct container cost from credits
		player.credits -= 50000.0;
		player.commsMessage(&quot;Mishandling charge applied at cost.&quot;,9);
	}
}


this.startUpComplete = function () {
	var pc = player.consoleMessage;
	// missile capacity (not exceed)
	this.$gc5MCap = player.ship.missileCapacity;
	this.$gc5Count = player.ship.missiles.length;
	// Load cargo space, missile &amp; container counts if present
	if (missionVariables.gc5Cargo != null) 
		player.ship.cargoSpaceCapacity = missionVariables.gc5Cargo;
	if (missionVariables.gc5Count != null)
		this.$gc5Count = missionVariables.gc5Count;
	if (missionVariables.gc5Containers != null) 
		this.$gc5Containers = missionVariables.gc5Containers;
	// Load total fees taken
	if (missionVariables.gc5HandlingFeeTotal != null)
		this.$gc5HandlingFeeTotal = missionVariables.gc5HandlingFeeTotal;
	if (missionVariables.gc5HandlingPaid != null)
		this.$gc5HandlingPaid = missionVariables.gc5HandlingPaid;
	if (missionVariables.gc5MaintenanceFeeTotal != null)
		this.$gc5MaintenanceFeeTotal = missionVariables.gc5MaintenanceFeeTotal;
	if (missionVariables.gc5DismantlingFeeTotal != null)
		this.$gc5DismantlingFeeTotal = missionVariables.gc5DismantlingFeeTotal; 
    // Load system-to-system runs w/container
	if (missionVariables.gc5Runs != null)
		this.$gc5Runs = missionVariables.gc5Runs;
	// Load Handling fee count
	if (missionVariables.gc5HandlingCount != null)
		this.$gc5HandlingCount = missionVariables.gc5HandlingCount;
	// Load handling fee exemption status
	if (missionVariables.gc5HFExempt != null)
		this.$gc5HFExempt = missionVariables.gc5HFExempt;
	// Load Maintenance fee count
	if (missionVariables.gc5MaintenanceCount != null)
		this.$gc5MaintenanceCount = missionVariables.gc5MaintenanceCount;
	// CHECK
	log(this.name, this.name+&quot; startup complete.&quot;);
	// TEST
	var sta = player.ship.dockedStation;
	if ((this.$gc5Containers&lt;this.$gc5MCap) &amp;&amp; (system.techLevel&gt;=6))
		pc(&quot;Containers available in the Shipyard.&quot;);
	// prepare container Account screen
	if (this.$gc5Containers&gt;0) this._gc5PrepAcc(sta);
	// optionally, prepare handling fee waiver request
	if (this.$gc5Containers&gt;0) this._gc5PrepEx(sta);
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// check for G.E.T. presence
	this.$gc5ET = false;
	if (worldScripts[&quot;Elite Trader&quot;]) 
		this.$gc5ET = true;
	// TEST	
	if (this.$gc5ET) log(this.name, &quot;Finds Elite Trader present&quot;);
	// check for FE Ships Player
	this.$gc5FES = false;
	if (worldScripts[&quot;FE Ships Player&quot;]) 
		this.$gc5FES = true;
	// TEST	
	if (this.$gc5ET) log(this.name, &quot;Finds FE Ships Player present&quot;);
	// missile capacity (not exceed)
	this.$gc5MCap = 0;
	// pylon-use count
	this.$gc5Count = 0;
	// container count
	this.$gc5Containers = 0;
	// purchase cost of container in cr
	this.$gc5Cost = 50000;
	// handling fee
	this.$gc5HandlingFee = 0.005*this.$gc5Cost; // 0.005 of cost
	this.$gc5HandlingFeeTotal = 0;
	this.$gc5HandlingPaid = &quot;yes&quot;; // or &quot;no&quot; - easier than boolean
	this.$gc5HandlingCount = 0;
	this.$gc5HFExempt = &quot;no&quot;;
	// maintenance fee
	this.$gc5MaintenanceFee = 0.05*this.$gc5Cost; // 0.05 of cost
	this.$gc5MaintenanceFeeTotal = 0;
	this.$gc5MaintenancePaid = &quot;no&quot; // or &quot;yes&quot;
	this.$gc5MaintenanceInterval = 50; // in runs (according to cost)
	this.$gc5MaintenanceCount = 0;
	// dismantling fee
	this.$gc5DismantlingFee = 0.1*this.$gc5Cost; // 0.1 of cost
	this.$gc5DismantlingFeeTotal = 0.0;
	// system-to-system runs w/container
	this.$gc5Runs = 0;
}


this.playerWillSaveGame = function(message) {
	missionVariables.gc5Count = this.$gc5Count;
	missionVariables.gc5Cargo = player.ship.cargoSpaceCapacity;
	missionVariables.gc5Containers = this.$gc5Containers;
	// save total fees taken
	missionVariables.gc5HandlingFeeTotal = this.$gc5HandlingFeeTotal;
	missionVariables.gc5MaintenanceFeeTotal = this.$gc5MaintenanceFeeTotal;
	missionVariables.gc5DismantlingFeeTotal = this.$gc5DismantlingFeeTotal;
	missionVariables.gc5HandlingPaid = this.$gc5HandlingPaid;
	// system-to-system runs w/container
	missionVariables.gc5Runs =this.$gc5Runs;
	// handling fee count
	missionVariables.gc5HandlingCount = this.$gc5HandlingCount;
	// handling fee exemption (G.E.T.)
	missionVariables.gc5HFExempt = this.$gc5HFExempt;
	// maintenance fee count
	missionVariables.gc5MaintenanceCount = this.$gc5MaintenanceCount;
}


this.shipDockedWithStation = function(station) {
	// take handling fee (if not exempt)
	var pc = player.consoleMessage;
	var ex = this.$gc5HFExempt;
	// check we have containers, the fee is not paid, and we&#39;re not exempt
	if ((this.$gc5Containers&gt;0) &amp;&amp; (this.$gc5HandlingPaid===&quot;no&quot;) &amp;&amp; (ex===&quot;no&quot;)) {
		var fee = 0;
		for (var x=1; x&lt;= this.$gc5Containers; x++)
			fee += this.$gc5HandlingFee;
		// record fee and debit trader&#39;s account
		this.$gc5HandlingFeeTotal += fee;
		player.credits -= fee;
		this.$gc5HandlingPaid = &quot;yes&quot;;
		pc(&quot;50 TC Container handling fees: &quot;+fee+&quot; cr&quot;,9);
		this.$gc5HandlingCount++;
	}

	// conditionally take maintenance fee
	if (this.$gc5Containers&gt;0) this._gc5DoMaintenance();

	// TEST
	if ((this.$gc5Containers&lt;this.$gc5MCap) &amp;&amp; (system.techLevel&gt;=6))
		pc(&quot;Containers available in the Shipyard.&quot;);
	
	// prepare container Account and Licence page
	if (this.$gc5Containers&gt;0) this._gc5PrepAcc(station);
	
	// prepare handling fee waiver request if ET or FESP is present
	if (this.$gc5Containers&gt;0) this._gc5PrepEx(station);
}



this.shipExitedWitchspace = function() {
	// set handling paid to &#39;no&#39;
	this.$gc5HandlingPaid = &quot;no&quot;;
	this.$gc5Runs ++;
}


/* Common helper functions */


// assess and take maintenance fee
this._gc5DoMaintenance = function() {
	var pc = player.consoleMessage;
	var runs = this.$gc5Runs;
	var intv = this.$gc5MaintenanceInterval;
	var mfee = this.$gc5MaintenanceFee;
	// take maintenance fee after y runs
	if ( (runs &gt; 0) &amp;&amp; ((runs % intv)==0) ) {
		// maintenance for x containers
		var fee = 0;
		for (var x=1; x&lt;= this.$gc5Containers; x++)
			fee += mfee;
		// maintenance fee tally &amp; debit
		this.$gc5MaintenanceFeeTotal += fee;
		player.credits -= fee;
		pc(&quot;50 TC Container Maintenance fees: &quot;+fee+&quot; cr&quot;,9);
		// update Maintenance count
		this.$gc5MaintenanceCount++;
	}
}


/* F4 Interfaces */


// create F.E.S. &#39;Licence &amp; Account&#39; page 
this._gc5PrepAcc = function(station) {
	station.setInterface(&quot;gc5Acc&quot;,{
	title: &quot;Your FE Shipyards 50 TC Container Class Licence&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;Your FE Shipyards 50 TC Goods Container account screen shows terms, fees paid, load, and other useful information.&quot;,
	callback: this._gc5ShowAcc.bind(this)
	});	
}


// show F.E.S. &#39;Licence &amp; Account&#39; page
this._gc5ShowAcc = function() {
	var hfc = this.$gc5HandlingCount;
	var mfc = this.$gc5MaintenanceCount;
	var mfi = this.$gc5MaintenanceInterval;
	var hft = this.$gc5HandlingFeeTotal;
	var mft = this.$gc5MaintenanceFeeTotal;
	var dft = this.$gc5DismantlingFeeTotal;
		
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	if (this.$gc5Containers&gt;0) 
		parameters.message +=&quot;Your Account and Licence for 50 TC Class Goods Containers x &quot;+this.$gc5Containers+&quot;: \n\n&quot;; 
	 else
		parameters.message +=&quot;You have no 50 TC Class Containers licensed with us at this time. \n\n&quot;;
	
	parameters.message +=&quot;Handling fees paid: &quot;+hft+&quot; cr (&quot;+hfc+&quot;) \n&quot;;
	parameters.message +=&quot;Maintenance fees paid: &quot;+mft+&quot; cr (&quot;+mfc+&quot;) \n&quot;;
	parameters.message +=&quot;Dismantling fees paid: &quot;+dft+&quot; cr \n\n&quot;;
	
	parameters.message += &quot;Our containers are re-used many times per cycle, often many times per day. Maintaining them in clean and serviceable condition for their maximum useful lifetime is our prime concern at FE Shipyards, and we trust that you, our valued customer, understand the need for your own participation in this costly and ongoing process. \n\n&quot;;
	
	parameters.message += &quot;The handling charge (0.005 of cost) is levied upon docking, the maintenance fee (0.05 of cost) every &quot;+mfi+&quot; system-to-system trading runs. \n\n&quot;
	
	parameters.message += &quot;If you cancel your Container account with us at any time, we must charge the dismantling fee (0.1 of cost) to re-modify and restore your vessel&#39;s pylons for weapons-use. \n&quot;;
	
	parameters.choicesKey = &quot;gc5Acknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;FE Shipyards thanks you for your custom.&quot;);
	}
}



// create F.E.S. handling fee waiver/restoration request  
this._gc5PrepEx = function(station) {
	station.setInterface(&quot;gc5Ex&quot;,{
	title: &quot;Your FE Shipyards Handling Fee Waiver Request&quot;,
	category: &quot;Your FE Shipyards&quot;,
	summary: &quot;FE Shipyards grants Guilders and FE shipowners the privileged option to waive our handling and dismantling fees for the 50-ton container class.&quot; ,
	callback: this._gc5ShowEx.bind(this)
	});	
}


// show F.E.S. handling &amp; dismantling fee waiver/restoration request
this._gc5ShowEx = function() {
	var priv = ((this.$gc5ET)||(this.$gc5FES));
	var privo = &quot;&quot;;
	if (this.$gc5FES) privo=&quot;FE shipowner&quot;;
	if (this.$gc5ET) privo=&quot;Guilder&quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;FE Shipyards&quot;;
	
	parameters.message = &quot;Dear customer, \n\n&quot;;
	
	parameters.message += &quot;Re: your request to waive your 50 TC container fees.\n\n&quot;
	
	parameters.message += &quot;The handling fee (0.005 of cost) is taken from your account upon docking, and is merely to cover our attachment/detachment &amp; loading/unloading services. The dismantling fee (0.1 of cost) is charged when re-modifying your pylons for weapons-use after Licence cancellation. \n\n&quot;;
	
	if (priv)
		parameters.message += &quot;FE Shipyards grants you, as a &quot;+privo+&quot;, the privileged option to waive our handling and dismantling fees, although you are free - and encouraged - to continue supporting our efforts to provide the efficient service you as an Elite Trader deserve. \n\n&quot;;
	else
		parameters.message += &quot;FE Shipyards regrets that we are unable at this time to grant you an exemption from fees, which is a privilege of Guilders and FE shipowners exclusively. \n\n&quot;;
	
	parameters.message += &quot;Yours attentively,\n\n&quot;;
	
	parameters.message += &quot;Siri Chodrum, for Dor Reval (Technical Director)\n&quot;;
	

	parameters.choicesKey = &quot;gc5YesNoEx&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_AYE&quot;)  {
			if (priv) this.$gc5HFExempt = &quot;yes&quot;; else this.$gc5HFExempt = &quot;no&quot;;
		} else this.$gc5HFExempt = &quot;no&quot;;
		player.commsMessage(&quot;FE Shipyards thanks you for your attention.&quot;);
	}	
}



</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/gc_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	return true
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/gh_script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;GETter HUD&quot;;
this.author = &quot;Reval&quot;;
this.licence = &quot;CC BY-NC-SA 4.0&quot;;
this.version = &quot;1.3&quot;;


this.startUpComplete = function() {
	this._ghlistGoods();
	this._ghlistOwner();
	this._ghlistCap();
}


this.playerBoughtNewShip = function(ship, price) {
	this._ghlistGoods();
	this._ghlistOwner();
	this._ghlistCap();
}


this.playerBoughtEquipment = function(equipment, paid) {
	this._ghlistGoods();
	this._ghlistOwner();
	this._ghlistCap();
}


this.equipmentAdded = function(equipmentKey) {
	this._ghlistGoods();
	this._ghlistOwner();
	this._ghlistCap();
}


this.shipWillLaunchFromStation = function() {
	if(!this.$Timer) this.$Timer = new Timer(this,this._ghupdateSpeed.bind(this),0,0.25);
	if(!this.$Timer1) this.$Timer1 = new Timer(this,this._ghshowWeps.bind(this),0,0.25);
	this._ghlistGoods();
	this._ghlistOwner();
	this._ghlistCap();
}


this.guiScreenChanged = function(to, from) {
	if ((from==&quot;GUI_SCREEN_MARKET&quot;)||(from==&quot;GUI_SCREEN_MANIFEST&quot;)) {
		this._ghlistGoods();
		this._ghlistOwner();
		this._ghlistCap();
	}
}


this._ghcenteredText = function(txt, width) {
	var t = &quot;&quot;+txt; // force to string, else txt.length is undefined for numbers
	var w = width / 2;
	while( t &amp;&amp; t.length &lt; w ) { // for fixed width font in setCustomHUDDial
		t = &quot; &quot; + t;
	}
	return(t);
}


this._ghupdateSpeed = function () {
	var p = player.ship;
	if((!p) || (!p.isValid)) return; // player died

	var setd = p.setCustomHUDDial;
	if (setd) {
		var sp = p.speed;
		sp = this._ghcenteredText(sp.toFixed(1), 28); // default width
		setd(&quot;shipSpeed&quot;, sp);
	}
}


// output capList to HUD
this._ghlistCap = function() {
	var p = player.ship;
	if((!p) || (!p.isValid)) return; // player died

	var setd = p.setCustomHUDDial;
	if (setd) {
		var cap = this._ghcapList();
		setd(&quot;capList&quot;, cap);
	}
}


// show ship&#39;s TC capacity
this._ghcapList = function() {
	var result = &quot;&quot;;
	result += &quot;Capacity: &quot;;
	result += player.ship.cargoSpaceCapacity+&quot; TC&quot;;
	return result;
}


// output ownerList to HUD
this._ghlistOwner = function() {
	var p = player.ship;
	if((!p) || (!p.isValid)) return; // player died

	var setd = p.setCustomHUDDial;
	if (setd) {
		var owner = this._ghownerList();
		setd(&quot;ownerList&quot;, owner);
	}
}


// show ship, class, name, owner
this._ghownerList = function() {
	var result = &quot;&quot;;
	result += &quot;Cdr. &quot;;
	result += player.name + &quot;, &quot;;
	result += player.ship.displayName;
	return result;
}


// output goods list to HUD
this._ghlistGoods = function() {
	var p = player.ship;
	if((!p) || (!p.isValid)) return; // player died

	var setd = p.setCustomHUDDial;
	if (setd) {
		var goods = this._ghgoodsList();
		setd(&quot;goodsList&quot;, goods);
	}
}


// list commodities in ship&#39;s hold
this._ghgoodsList = function() {
	var result = &quot;&quot;;
	var m = manifest.list;
	for (var i=0; i&lt;m.length; i++) {
		var q = m[i].commodity;
		if (q) result += q + &quot; (&quot;+m[i].quantity+&quot;)  &quot;;
	}	
	if (result==&quot;&quot;) result = &quot;EMPTY&quot;;
	return result;
}


// weapons online indicator
this._ghshowWeps = function() {
	var p = player.ship;
	if((!p) || (!p.isValid)) return; // player died

	var setd = p.setCustomHUDDial;
	if (setd) {
		var weps = &quot;&quot;;
		if (p.weaponsOnline) weps=&quot;W&quot;;
		setd(&quot;showWeapons&quot;, weps);
	}
}


</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/gl_market.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;gl-market&quot;;
this.author = &quot;Reval&quot;;

/* Thanks to Spara for producing this code! */
this.updateLocalCommodityDefinition = function(goodDefinition, station) {

	var distance = station.position.distanceTo(system.mainStation);
	
	//scale max price difference with distance
	//1000 km -&gt; 0.05, 5000 km -&gt; 0.15
	var maxPriceDiff = 0.000000025 * distance + 0.025;
	var priceDiff = Math.random() * maxPriceDiff;
	
	//cheaper or more expensive?
	var coinToss = Math.round(Math.random());
	if (coinToss === 0)  var priceMultiplier = 1 - priceDiff;
	else var priceMultiplier = 1 + priceDiff;
	
	goodDefinition.price *= priceMultiplier;
	
	//scale quantity with random +/- 100 % scale
	
	var quantityDiff = Math.random();
	var coinToss = Math.round(Math.random());
	if (coinToss === 0) var quantityMultiplier = 1 - quantityDiff;
	else var quantityMultiplier = 1 + quantityDiff;
	
	goodDefinition.quantity = Math.round(quantityMultiplier * goodDefinition.quantity);

	return goodDefinition;
};
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
