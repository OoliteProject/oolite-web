<html>
    <head>
        <title>Expansion UsefulMFDs</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion UsefulMFDs</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER M)(&#39;[]&#39; vs &#39;[mfd]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Two MFDs: General Info (info on player and ship status) and  Market of Cargo (prices and quantities in main market for ship&#39;s cargo)</td>
                    <td>Two MFDs: General Info (info on player and ship status) and  Market of Cargo (prices and quantities in main market for ship&#39;s cargo)</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.zirael.UsefulMFDs</td>
                    <td>oolite.oxp.zirael.UsefulMFDs</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>UsefulMFDs</td>
                    <td>UsefulMFDs</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>HUDs</td>
                    <td>HUDs</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Zirael</td>
                    <td>Zirael</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.6</td>
                    <td>0.6</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>mfd</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://aegidian.org/bb/viewtopic.php?f=4&amp;t=16104">http://aegidian.org/bb/viewtopic.php?f=4&amp;t=16104</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/5/51/UsefulMFDs.0.6.oxz">https://wiki.alioth.net/img_auth.php/5/51/UsefulMFDs.0.6.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 3.0</td>
                    <td>CC BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1660000265</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/UsefulMFDs'>http://wiki.alioth.net/index.php/UsefulMFDs</a></p>
        <h3>Readme.txt</h3>
        <pre>Useful MFDs OXP
------------------------------------
v0.6, by Zirael

This OXP creates two MFDs:

General Info

Contains information on the ship, player, date, etc:

    Ship Name
    Service Level
    Mass
    Re-sale Price
    Next Revision Price
    Fuel
    Solar Wind (if Sun Gear OXP is installed)
    Credit Balance
    legal Status
    Rating
    Parcel Reputation
    Date


Market

Contains the price and avilability of the carried cargo at the Main Station:

    &lt;quantity carried&gt; &lt;commodity&gt; -&gt; &lt;quantity at Main Station&gt; at &lt;price at Main Station&gt;



License 
-------

CC BY-NC-SA 3.0 - Creative Commons Attribution-NonCommercial-ShareAlike 3.0 (https://creativecommons.org/licenses/by-nc-sa/3.0/)

Change log
----------

v0.6
* updates sun reference in timer function when exiting witchspace.

v0.5
* Deals with interstellar space in Market MFD.

v0.4
* Made Market and General Info as two separate MFDs.
* Re-designed the Market and Generral Info MFDs.
* Made compatible with HUD Selector.

</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name         = &quot;useful_MFDs&quot;;
this.author       = &quot;Zireael&quot;;
this.copyright    = &quot;2013 Zireael&quot;;
this.description  = &quot;Makes MFDs more useful by displaying some info&quot;;
this.version      = &quot;0.6&quot;;
this.licence      = &quot;CC BY-NC-SA 3.0&quot;;

this.$updateTimer;
this.$count = 0;

//-----------------------------------------------------------------------------------
this.startUpComplete = function() {
    this.$player = player;
    this.$ship = this.$player.ship;
    this.$sun = system.sun;
    this.$systemMarket = system.mainStation.market;
    this.$station = this.$ship.dockedStation;
    this.$stationName = this.$station.displayName;
    this.$registerHUDSelector();
    this.$updateMFDs();
}

//-----------------------------------------------------------------------------------
this.shipDockedWithStation = function(station) {
    this.$station = station;
    this.$stationName = this.$station.displayName;
}

//-----------------------------------------------------------------------------------
this.shipLaunchedFromStation = this.shipExitedWitchspace = function() {
    var _player = this.$player;
    this.$sun = system.sun;
    this.$count = 0;
    this.$station = null;
    this.$stationName = null;
    this.$showGeneralInfo.sun = this.$sun;
    this.$systemMarket = (system.mainStation ? system.mainStation.market : null);
    this.$showStationMarket();
    
    
    if (this.$updateTimer)
        this.$updateTimer.start();
    else
        this.$updateTimer = new Timer(this, this.$updateMFDs.bind(this), 0, 1);
}

//-----------------------------------------------------------------------------------
this.shipWillDockWithStation = this.shipWillEnterWitchspace = function() {
    if (this.$updateTimer &amp;&amp; this.$updateTimer.isRunning)
        this.$updateTimer.stop();
}

//-----------------------------------------------------------------------------------
this.playerBoughtNewShip = this.playerReplacedShip = function() {
    this.$ship = player.ship;
}




//-----------------------------------------------------------------------------------
this.$registerHUDSelector = function() {
    var ws = worldScripts.hudselector;
    if (!ws) return;
    ws.$HUDSelectorAddMFD(&quot;useful_MFDs&quot;, &quot;useful_MFD_general_info&quot;);
    ws.$HUDSelectorAddMFD(&quot;useful_MFDs&quot;, &quot;useful_MFD_market&quot;);
}

//-----------------------------------------------------------------------------------
this.$updateMFDs = function _usefulMFDs_updateMFDs() {
    this.$count += 1;
    this.$showGeneralInfo();
    if (this.$count % 5 === 0) {
        this.$showStationMarket();
    }
}

//-----------------------------------------------------------------------------------
this.$showGeneralInfo = function _usefulMFDs_showGeneralInfo() {
    var that = _usefulMFDs_showGeneralInfo;
    var wsAstroLib = (that.wsAstroLib = that.wsAtroLib || worldScripts.AstroLibrary);
    var _player = (that._player = that._player || player);
    var ship = (that._ship = that._ship || this.$ship);
    var sun = (that.sun = that.sun || this.$sun);
    var solarwind = (wsAstroLib ? wsAstroLib.$astroLib_SolarWind(ship.position.distanceTo(sun)) : null);

    var txt =  ship.displayName;
    txt += &quot;\nService Level: &quot; + ship.serviceLevel + &quot;%&quot;;
    txt += &quot;, Mass: &quot;+(ship.mass/1000).toFixed(1)+&quot;t&quot;;
    txt += &quot;\nRe-sale Price: &quot; + ship.price*0.75 + &quot; Cr&quot;;
    txt += &quot;\nNext Revision: &quot; + ship.renovationMultiplier*ship.renovationCost/10 + &quot; Cr&quot;;
    txt += &quot;\nFuel: &quot;+ship.fuel.toFixed(1)+&quot; LY&quot;;
    if (solarwind != null) txt += &quot;, Solar Wind: &quot;+solarwind.toFixed(3)+&quot; LY/min&quot;;
    txt += &quot;\nCredits: &quot; + _player.credits.toFixed(1) + &quot;â‚¢&quot;;
    txt += &quot;\nLegal Status : &quot; + _player.legalStatus + &quot; (&quot; + _player.bounty + &quot;)&quot;;
    txt += &quot;\nRating: &quot; + _player.rank + &quot; (&quot; + _player.score + &quot;)&quot;;
    txt += &quot;\nParcel Rep.: &quot;+_player.parcelReputationPrecise.toFixed(2);
    txt += &quot;\nCurrent date: &quot; + this.$setDateSince(3142, 2, 21);
    ship.setMultiFunctionText(&quot;useful_MFD_general_info&quot;, txt, true);
}

//-----------------------------------------------------------------------------------
this.$showStationMarket = function _usefulMFDs_showStationMarket() {
    var ship = this.$ship;
    var sysMarket = this.$systemMarket;
    var _manifest = ship.manifest.list;
    var z = _manifest.length;
    var msg = ((z &gt; 0) ? &quot;Market for the ship&#39;s cargo&quot; : &quot;No cargo&quot;);
    var m, c, qtt, price;
    while (z--) {
        m = _manifest[z];
        c = m.commodity;
        if (sysMarket) {
            qtt = sysMarket[c].quantity;
            price = sysMarket[c].price / 10;
        }
        if ( m.quantity &gt; 0) {
            msg += &quot;\n&quot;+m.quantity+m.unit+&quot; &quot;+m.displayName+&quot; -&gt; &quot;+(sysMarket ? qtt+m.unit+&quot; at &quot;+formatCredits(price,true,true) : &quot;No Main Station in range&quot;);
        }
    }
    ship.setMultiFunctionText(&quot;useful_MFD_market&quot;, msg, true);
}

//-----------------------------------------------------------------------------------
this.$setStartDate = function(year, month, day) {
   var startDate = new Date();
   startDate.setFullYear(year, month, day);
   return startDate.toLocaleString();
}

//-----------------------------------------------------------------------------------
this.$setDateSince = function(year, month, day) {
   var testDate = new Date();
   testDate.setFullYear(year, month, day);
   
   var secondsPassedTotal = clock.seconds - 2084004 * 86400.0;
   var hoursPassed = Math.floor(secondsPassedTotal / 3600);
   var minutesPassed = Math.floor((secondsPassedTotal % 3600) / 60);
   var secondsPassed = Math.floor(secondsPassedTotal % 60);
   
   testDate.setHours(hoursPassed);
   testDate.setMinutes(minutesPassed);
   testDate.setSeconds(secondsPassed);
   
   return testDate.toLocaleString();
}

//-----------------------------------------------------------------------------------
this.$killRate = function() {
  var days = clock.days - 2084004;
  var kills = player.score;

  return kills / days;
}

/*this.$showDamagedEquipment = function() {
    for (i = start; i &lt; eqptCount; i++)
        {
                info = [eqptList oo_arrayAtIndex:i];
                name = [info oo_stringAtIndex:0];
                if([name length] &gt; 42) name = [[name substringToIndex:40] stringByAppendingString:@&quot;...&quot;];
                
                damaged = ![info oo_boolAtIndex:1];
                if (damaged) glColor4f (1.0f, 0.5f, 0.0f, 1.0f); // Damaged items show up orange.
             //   else glColor4f (1.0f, 1.0f, 0.0f, 1.0f);
}*/
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
