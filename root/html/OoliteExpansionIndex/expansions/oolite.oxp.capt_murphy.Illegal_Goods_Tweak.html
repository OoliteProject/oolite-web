<html>
    <head>
        <title>Expansion Illegal Goods Tweak</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Illegal Goods Tweak</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">2 Equipment</a></li>
          <li><a href="#ships">1 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">6 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN CAPITAL LETTER M)(&#39;[]&#39; vs &#39;[Mechanics]&#39;)</li>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Introduces interaction with Galcop customs when docking at a main station with contraband in the hold.</td>
                    <td>Introduces interaction with Galcop customs when docking at a main station with contraband in the hold.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.capt_murphy.Illegal_Goods_Tweak</td>
                    <td>oolite.oxp.capt_murphy.Illegal_Goods_Tweak</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Illegal Goods Tweak</td>
                    <td>Illegal Goods Tweak</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Capt Murphy</td>
                    <td>Capt Murphy</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.2.6</td>
                    <td>2.2.6</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/8/82/Illegal_Goods_Tweak.oxz">https://wiki.alioth.net/img_auth.php/8/82/Illegal_Goods_Tweak.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873350</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Illegal%20Goods%20Tweak'>http://wiki.alioth.net/index.php/Illegal%20Goods%20Tweak</a></p>
        <h3>readme.txt</h3>
        <pre>Illegal Goods Tweak version 2.2.4 (22/02/2018)
By Capt Murphy 2012
Licence: CC BY-NC-SA 3.0
Requires Oolite version 1.80

Description
===========

This OXP introduces interaction with Galcop customs for players who dock at main stations (and some OXP stations if New Cargoes OXP is installed) with Narcotics, Firearms or Slaves in the hold. Players can ignore warnings, in which case a legal penalty is applied, but they can go on to sell the contraband on the open market. Alternatively they can voluntarily hand over contraband in which case a nominal reward is given; or attempt to bribe the customs officer to turn a blind eye (this could be risky - attempted bribery of a Galcop official can bring it&#39;s own legal penalties).

Slaves that are handed over to Galcop customs are rehabilitated by Amnesty Intergalactic before being released. There is a small chance that after handing over slaves the player may be contacted by an ex-slave who may offer an additional reward for their rescue. This will generally involve a trip to the ex-slave&#39;s home system to receive a financial reward, although there are a few surprises in the code. If you don&#39;t like surprises or are simply curious please see spoilers.txt included in this download for more info.

This OXP does not interfere with the treatment of scooped escape pods, although they do appear in the manifest as slaves. Oolite automatically removes slaves from scooped escape pods from the manifest, and pays appropriate bounty/insurance payments before this OXP runs. 

Compatibility Information
=========================

This release introduces compatibility with New Cargoes OXP (1.1.0 or above) and it&#39;s permit system. Contraband which is a New Cargoes Special Cargo is ignored by Illegal Goods Tweak if a valid New Cargoes permit is held. Otherwise it is treated in the same way as standard contraband. Also Illegal Goods Tweak will run on docking at certain OXP stations defined by New Cargoes OXP if installed (this option can be turned off).

Compatibility with HyperCargo OXP (1.07 or above) and Vortex OXP (1.23 or above) has also been updated to take into account New Cargoes and it&#39;s permit system. 

This release introduces optional OXPconfig compatibility(version 2.0.9 or above) as a method to set some options.

Options that can be set via OXPConfig are (line numbers given for those who just wish to edit the script &quot;illegal_goods_tweak.js&quot;):

alwaysDetect (default true) (line 9); If set to false a variable contraband detection rate is used, dependent on tech level and government type of the system. Low Tech Anarchies will have the lowest detection rate, High Tech Corporate States the highest. High Tech Anarchies and Low Tech Corporate States will fall somewhere in between. If not detected players carrying contraband still have an opportunity to voluntarily handover contraband for a small reward.

loggingEnabled (default false) (line 10) : if set to true enables some debug log messages.

ncOXPStations (default true) (line 11) : ignored unless New Cargoes OXP installed. If true customs are also active at certain OXP stations (defined via New Cargoes).

Why
===

Vanilla Oolite follows Elite in that by default penalties are only applied when launching from a main station with contraband in the hold. There is no penalty for docking with a main station with illegal commodities in the hold.

In the original game this had the effect of making trade in such commodities illegal as the only place they could be bought was main stations. Oolite on the other hand can have many OXP added dockable objects that are not main stations some of which sell illegal items cheaply, in bulk, and with no penalty attached to launching with them from that dockable object (e.g. Random Hit&#39;s Seedy Space Bars). 

This allows for some very lucrative trading opportunities in illegal commodities from OXP dockables to main stations with no impact on the players legal status. This OXP goes someway to redressing the balance and increasing the risks of this strategy.

Initially (with version 1 of this OXP) Galcop simply introduced penalties for docking with illegal substances. Following intense lobbying from Amnesty Intergalactic and various Bounty Hunter interest groups Galcop agreed to give pilots the opportunity to hand over the goods to avoid penalties and for a small reward.


Version history
===============
2.2.6
- Updated all commodity references to using post-1.82 naming conventions.

2.2.5
- Spelling corrections.

2.2.4 - 22/02/18
- Will use GNN oxp for news reporting (if installed). If both GNN and Snoopers are installed, GNN will be used in preference.

2.2.3 - 31/03/17
- Removed hard-coded scanner range value, and made compatible with Library for configuration options.

2.2.2 - 18/12/15
- Improved integration with Smugglers to correct sequencing issue. Upon docking with slaves, the IGT Amnesty screen will now always be displayed before the Smugglers screen.

2.2.1 - 8/10/15
- Further tweaks to the screens and email sent when handling over slaves, to make it more like an Amnesty Intergalactic interface and message.

2.2.0 - 7/10/15
- Made illegal goods check occur at any GalCop-aligned station, rather than just the main station. 
- Better integration with Smugglers OXP (v0.5.0) - the screen when docking with slaves now looks like an Amnesty Intergalactic screen, rather than a GalCop Customs screen. If the player doesn&#39;t want to hand over the slaves to AI, they can chose to work with GalCop directly, at which point the Smugglers OXP will deal with the importation of illegal goods (slaves), and the player can attempt to bribe the docking officials if they choose.

2.1.1 - 1/9/15
- Minor text changes only.

2.1.0 - 30/8/15
- Made compatible with the &#39;Smugglers&#39; OXP, by limiting the goods IGT deals with to just slaves when both are installed.

2.0.3 - 3/7/15
- Fixed issue with Slaverbase getting accidentally destroyed by asteroid collisions.

2.0.2 - 30/4/15
- Removed TL99 from equipment, added a condition script instead, for better 1.81 compatibility. 
- Added &quot;has_npc_traffic&quot; = no; to slaverbase, so it doesn&#39;t get NPC traffic

2.0.1 - 3/3/15
- Code improvements as suggested by Wildeblood. 
- Updated markSystem and unmarkSystem to use objects rather than system ID&#39;s only. 
- Fixed bug with link to email system.

2.0.0 - 28/2/15: Requires Oolite 1.80 (phkb) 
- Updated legacy code to use new functions and system populator, making Oolite 1.80 a requirement. 
- Updated slaver base shipdata.plist for 1.81 compatibility, added allegiance and markets, removed additional entry (because in 1.80 everything uses the cool griff models). 
- Turned off arrival reports on slaver base, so, when you dock to rescue slaves, and you have a scooped escape pod, the police don&#39;t &quot;magically&quot; turn up to haul the prisoner away. 
- Added interfaces to email system for general notifications (email system is not required, though), and added some data hooks for external referencing. 
- When the slaver base is destroyed, a GNN news item will be show (if Snoopers is installed). 
- Small bug fixes, spelling corrections and cosmetic code layout changes.

1.7.3 - 30/5/12
- Fixed minor bug introduced in last release. Thanks to Tricky for reporting.

1.7.2 - 25/5/12
- Update to maintain compatibilty with HyperCargo version 1.08 and above. Continues to work with HyperCargo v1.07. 
- Minor tweaks in preperation for Oolite 1.77. 
- Raised compatibility limit for new Cargoes to 1.1.0.
- Fixed non-critical typo in missions script (thanks Switeck).

1.7.1 - 28/4/12
- Raised compatibility limits for New Cargoes to 1.0.6 and HyperCargo to 1.07. 
- Fixed some bugs in the special slaves mission set-up. Thanks to richard.a.p.smith for reporting. 

1.7 19/4/12
- Added compatibility for New Cargoes 1.0.5 or above. 
- Updated Compatibility for HyperCargo 1.06 or above and Vortex 1.23 and above in light of changes to those OXPs for New Cargoes compatibility. 
- Vortex update includes bugfix that affected Maelstrom pilots only. 
- Added optional compatibility for OXPConfig (v2.09 or above). 
- Added detected contraband info to mission screens.

1.6 05/02/12: Requires Oolite 1.76. 
- Made JS strict mode compatible. 
- Made Save Anywhere OXP compatible. 
- Fixed bug in parsing of equipment.plist on mac systems. 
- Reduced unnecessary missionVariable storage. 
- Found and fixed several other minor bugs. 
- One of special missions now uses Griff model for station if installed.

1.5 07/08/11 
- Added code to check that target system for any missions offered after release of slaves is not post Nova. 
- Fixed minor bug that could rarely result in a cosmetic issue with the mission offer screens. 
- Fixed minor bug that could rarely result in mission target not being cleared correctly.

1.4 16/06/11
- General code tidy up with lessons learnt from making Escort Contracts OXP.
- Reduced max delay between releasing slaves and being offered mission. 
- Fixed a small bug on withupdating mission variables on intergalactic jump. 
- Updated Hypercargo compatibility code and Vortex compatibility code in light of a bug that showed up in Vortex version 1.11. This release compatible with Vortex 1.12.

1.3 - 11/4/11
- Added some simple missions which may be offered some time after slaves have been released.

1.2.1 - 5/4/11
- Fixed a bug with event handling on docking that could interfere with another OXP&#39;s mission screens. Thanks to Gimi for reporting and Eric Walch for advice on the fix.

1.2 - 03/4/11
- Made compatible with Thargoid&#39;s HyperCargo 1.04 and Vortex 1.11 OXP&#39;s. 
- Added option to attempt to bribe customs if detected. 
- Added option to make detection rate variable. 

1.1 - 26/3/11: Requires Oolite 1.75.1 
- Introduced interaction with customs and option to voluntarily handover contraband to avoid penalties and get a reward.

1.0 - 24/3/11
- Simply applies penalties if player docks at main station with contraband. No player interaction.

License
=======
This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/3.0/

Acknowledgements
================
Thanks to Thargoid for advice on the method to interact with another script/OXP&#39;s variables.
Thanks to Eric Walch for advice on avoiding conflicts with other OXP&#39;s, and Gimi for reporting the bug in version 1.2
Thanks to cim for making New Cargoes easy to interact with.
An additional acknowledgement can be found in spoilers.txt.
Thanks to all contributors to the thread on the Oolite BB for suggesting improvements to the original very basic idea.
Thanks to spara for developing the code to translate old commodity values into the new 1.81 format.
Thanks to wildeblood for his code improvement suggestions.</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_IG_INSURANCE.html">TianveDirect Ship Maintenance Insurance</a></td>
                    <td>yes</td>
                    <td align="right">1000</td>
                    <td align="center">1+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_IG_LEGAL_HACK.html">Legal-Record Backdoor Hack Chip</a></td>
                    <td>yes</td>
                    <td align="right">1000</td>
                    <td align="center">1+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/ig_slaver_base.html">Slaver Base</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/ig_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;IG_Equipment_Conditions&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2015 phkb&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	// ig equipment cannot be bought -- it will be given to the player after a mission
	if ((equipment == &quot;EQ_IG_INSURANCE&quot; || equipment == &quot;EQ_IG_LEGAL_HACK&quot;) &amp;&amp; context != &quot;scripted&quot;) {
		return false;
	}
	return true;
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/ig_legal_hack.js</td>
                    <td><pre>&quot;use strict&quot;;

this.activated = function() {
	if(player.bounty &gt; 0) {
		player.bounty = 0;
		player.ship.removeEquipment(&quot;EQ_IG_LEGAL_HACK&quot;);
		player.consoleMessage(&quot;Legal Status set to Clean. Hack chip removed.&quot;,5);
	} else {
		player.consoleMessage(&quot;You already have a clean record.&quot;,5);
	}
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/illegal_goods_missions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;illegal_goods_missions&quot;;
this.author      = &quot;capt murphy&quot;;
this.copyright   = &quot;2011 capt murphy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Missions worldscript for illegal_goods_tweak.&quot;;

// &quot;my son&quot; must always be in array position 1 for a particular mission
this._rescueeArray = [&quot;me&quot;, &quot;my son&quot;, &quot;my daughter&quot;, &quot;my partner&quot;, &quot;my spouse&quot;, &quot;my brother&quot;, &quot;my sister&quot;, &quot;my father&quot;, &quot;my mother&quot;];

//======================================================================================================================
// clears up missionVariables from previous versions,
this.startUp = function() {
	if (missionVariables.ig_pendingmission === &quot;no&quot;) {delete missionVariables.ig_pendingmission; delete missionVariables.ig_rescuetime; delete missionVariables.ig_missionlaunchtime; delete missionVariables.ig_rescuelocation;}
	if (missionVariables.ig_currentmission === &quot;no&quot;){this.$ig_cleanupmissionvariables();}
	delete missionVariables.ig_rescuelocation1;
	if (!worldScripts.snoopers &amp;&amp; !worldScripts.GNN) {
		delete this.shipExitedWitchSpace;
	}
}

//======================================================================================================================
// existing missions cleared on galactic jump
this.playerEnteredNewGalaxy = function() {
    delete missionVariables.ig_pendingmission;
	delete missionVariables.ig_rescuelocation;
	delete missionVariables.ig_rescuetime;
	delete missionVariables.ig_missionlaunchtime;
    this.$ig_cleanupmissionvariables();
	mission.setInstructionsKey (null, &quot;illegal_goods_missions&quot;);
}

//======================================================================================================================
// used at startUp to clean old missionVariables and at the end of a mission.
this.$ig_cleanupmissionvariables = function() {
	delete missionVariables.ig_currentmission;
	delete missionVariables.ig_contactname;
	delete missionVariables.ig_rescuee;
	delete missionVariables.ig_rescuedwhen;
	delete missionVariables.ig_missionsystem;
	delete missionVariables.ig_missionsystemname;
	delete missionVariables.ig_rescuelocationcurrent;
	delete missionVariables.ig_missionreward;
	delete missionVariables.ig_slaverbasedestroyed;
	delete missionVariables.ig_special5end;
	delete missionVariables.ig_special5slavecount;
}

//======================================================================================================================
this.missionScreenOpportunity = function() { // don&#39;t run if save anywhere scripted dock.
	if (player.ship.docked &amp;&amp; player.ship.dockedStation.isMainStation) {
		this.$igmissionsetup();
		this.$igmissionfinish();
		delete missionVariables.ig_special5end; // needed to allow mission screen to run after handing over slaves at end of this mission.
	}
}

// send a news item out after the slaver base is destroyed
this.shipExitedWitchspace = function() {
	if (missionVariables.ig_slaverbasenewsitem &amp;&amp; global.clock.seconds &gt; parseInt(missionVariables.ig_slaverbasenewsitem)) {
		var news = {ID:this.name,
			Message:expandMissionText(&quot;special5_newsitem&quot;),
			Agency:1,
			Priority:1
		};
		var g = worldScripts.GNN;
		if (g) g._insertNews(news);
		if (!g) {
			var w = worldScripts.snoopers;
			if (w) w.insertNews(news);
		}
		delete missionVariables.ig_slaverbasenewsitem;
		delete missionVariables.ig_slaverbasesystem;
	}
}

//======================================================================================================================
// if pending mission is true, mission launch time has passed and no current mission set up new mission,
this.$igmissionsetup = function() {
	if (missionVariables.ig_pendingmission &amp;&amp; !missionVariables.ig_currentmission &amp;&amp; clock.days &gt;= missionVariables.ig_missionlaunchtime) {
		if (Math.random() &lt; 0.4) {
			this.$igspecialmissionsetup(); // set up one of 4 special missions
		} else {
			this.$igstandardmissionsetup(); // set up standard mission.
		}
		if (missionVariables.ig_currentmission) { // possible that no mission results from set-up
			mission.runScreen({screenID: &quot;igt_aimission&quot;, title: &quot;Message from Amnesty Intergalactic&quot;, messageKey: &quot;offer_mission&quot;});
			if (missionVariables.ig_currentmission == &quot;standard&quot;) {
				// email system interface
				var w = worldScripts.EmailSystem;
				if (w) {
					w.$createEmail({sender:&quot;Amnesty Intergalactic&quot;,
						subject:&quot;Meeting request&quot;,
						date:global.clock.seconds,
						message:expandMissionText(&quot;offer_mission&quot;),
						isRead:true
					});
				}
			}
			delete missionVariables.ig_pendingmission;
			delete missionVariables.ig_missionlaunchtime;
			delete missionVariables.ig_rescuedwhen;
			delete missionVariables.ig_rescuetime;
			delete missionVariables.ig_rescuelocation;
		}
	}
}

//======================================================================================================================
// sets up standard mission.
this.$igstandardmissionsetup = function() {

	missionVariables.ig_contactname = (randomName() + &quot; &quot; + randomName());

	var rescuee = (Math.floor(Math.random() * this._rescueeArray.length));
	missionVariables.ig_rescuee = this._rescueeArray[rescuee];
	missionVariables.ig_rescuedwhen = (clock.days - missionVariables.ig_rescuetime);

	var targetsystemsID = new Array;
	var targetsystems = SystemInfo.systemsInRange(35);
	var potentialmissionsystem;

    if (targetsystems.length &gt; 0) {
		var counter = 0;
		for (counter = 0; counter &lt; targetsystems.length; counter++) {
			targetsystemsID[counter] = targetsystems[counter].systemID;
		}
		var thisGalaxy = system.info.galaxyID;
		var thisSystem = system.ID;
		// selects a system at random from systems within 35 light years of current system. If selected system is within 7 light years, or is post nova, or there is no possible route to the system will try and select another. If fails to find a suitable system within 100 iterations, mission is cancelled.
		counter = 0
		while (counter &lt; 100) {
			potentialmissionsystem = targetsystemsID[(Math.floor(Math.random() * targetsystemsID.length))];
			if (!System.infoForSystem(thisGalaxy, thisSystem).routeToSystem(System.infoForSystem(thisGalaxy, potentialmissionsystem)) ||
				System.infoForSystem(thisGalaxy, potentialmissionsystem).sun_gone_nova ||
				System.infoForSystem(thisGalaxy, thisSystem).distanceToSystem(System.infoForSystem(thisGalaxy, potentialmissionsystem)) &lt; 7) {
					potentialmissionsystem = -1;
			}
			counter++;
			if (potentialmissionsystem !== -1) {break;}
		}
	}

	if (potentialmissionsystem === -1) {return;}

	missionVariables.ig_missionsystem = potentialmissionsystem;
	missionVariables.ig_missionsystemname = System.infoForSystem(thisGalaxy, potentialmissionsystem).name;

	var distance = System.infoForSystem(thisGalaxy, thisSystem).routeToSystem(System.infoForSystem(system.info.galaxyID, potentialmissionsystem)).distance;

	missionVariables.ig_missionreward = (500 + (Math.floor(distance / 7) * 250));
	mission.markSystem({system:potentialmissionsystem, name:&quot;ig_mission&quot;});
	mission.setInstructionsKey (&quot;mission_summary&quot;, &quot;illegal_goods_missions&quot;);
	missionVariables.ig_currentmission = &quot;standard&quot;;
	missionVariables.ig_rescuelocationcurrent = missionVariables.ig_rescuelocation;
}

//======================================================================================================================
// sets up special mission - runs standard mission set-up then overwrites some missionvariables.
this.$igspecialmissionsetup = function() {
	this.$igstandardmissionsetup();
	if (!missionVariables.ig_currentmission) {return;}

	var ig_switchvar =  (Math.floor(Math.random() * 4));

	switch(ig_switchvar) {
		case 0:
			missionVariables.ig_currentmission = &quot;special1&quot;;
			missionVariables.ig_rescuee = this._rescueeArray[1];
			break;
		case 1:
			if (player.ship.equipmentStatus(&quot;EQ_IG_INSURANCE&quot;) !== &quot;EQUIPMENT_OK&quot;) {
				missionVariables.ig_currentmission = &quot;special2&quot;;
			}
			break;
		case 2:
			if (player.ship.equipmentStatus(&quot;EQ_IG_LEGAL_HACK&quot;) !== &quot;EQUIPMENT_OK&quot;) {
				missionVariables.ig_currentmission = &quot;special3&quot;;
			}
			break;
		case 3:
			missionVariables.ig_currentmission = &quot;special4&quot;;
	}
}

//======================================================================================================================
// checks for current mission and correct system before running mission success screens.
this.$igmissionfinish = function () {
	if (missionVariables.ig_currentmission &amp;&amp; system.info.systemID === missionVariables.ig_missionsystem) {
		switch (missionVariables.ig_currentmission) {
			case &quot;standard&quot;:
				player.credits += missionVariables.ig_missionreward;
				mission.unmarkSystem({system:system.info.systemID, name:&quot;ig_mission&quot;});
				mission.setInstructionsKey (null, &quot;illegal_goods_missions&quot;);
				var w = worldScripts.EmailSystem;
				if (!w) {
					mission.runScreen({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_noemail&quot;});
				} else {
					mission.runScreen({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_withemail&quot;});
					w.$createEmail({sender:missionVariables.ig_contactname,
						subject:&quot;Eternal Gratitude&quot;,
						date:global.clock.seconds,
						message:expandMissionText(&quot;end_mission_email&quot;)
					});
				}
				clock.addSeconds (43200);
				this.$ig_cleanupmissionvariables();
				break;
			case &quot;special1&quot;:
				mission.runScreen ({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_special1&quot;, choicesKey: &quot;ship_visit_agree&quot;}, this.$ig_shipvisitchoice);
				break;
			case &quot;special2&quot;:
				player.ship.awardEquipment(&quot;EQ_IG_INSURANCE&quot;);
				mission.setInstructionsKey (null, &quot;illegal_goods_missions&quot;);
				mission.unmarkSystem({system:system.info.systemID, name:&quot;ig_mission&quot;});
				mission.runScreen ({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_special2&quot;});
				this.$ig_cleanupmissionvariables();
				break;
			case &quot;special3&quot;:
				player.ship.awardEquipment(&quot;EQ_IG_LEGAL_HACK&quot;);
				mission.setInstructionsKey (null, &quot;illegal_goods_missions&quot;);
				mission.unmarkSystem({system:system.info.systemID, name:&quot;ig_mission&quot;});
				mission.runScreen ({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_special3&quot;});
				this.$ig_cleanupmissionvariables();
				break;
			case &quot;special4&quot;:
				player.credits += missionVariables.ig_missionreward;
				mission.runScreen ({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_special4&quot;, choicesKey: &quot;special4_mission_agree&quot;}, this.$ig_special4choice);
				break;
			case &quot;special5&quot;:
				if (missionVariables.ig_slaverbasedestroyed &amp;&amp; missionVariables.ig_special5end !== &quot;not yet&quot;) {
					mission.runScreen ({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_special5&quot;, choicesKey: &quot;special5_slaves_left&quot;}, this.$ig_special5choice);
				}
		}
	}
}

//======================================================================================================================
this.$ig_shipvisitchoice = function(choice) {
	if (choice === &quot;1_VISITAGREE&quot;) {
		player.credits += missionVariables.ig_missionreward;
		mission.setInstructionsKey (null, &quot;illegal_goods_missions&quot;);
		mission.unmarkSystem({system:system.info.systemID, name:&quot;ig_mission&quot;});
		clock.addSeconds (43200);
		mission.runScreen ({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_special1a&quot;});
		player.ship.awardEquipment(&quot;EQ_TRUMBLE&quot;);
	} else {
		missionVariables.ig_missionreward = (missionVariables.ig_missionreward / 2);
		player.credits += missionVariables.ig_missionreward;
		mission.setInstructionsKey (null, &quot;illegal_goods_missions&quot;);
		mission.unmarkSystem({system:system.info.systemID, name:&quot;ig_mission&quot;});
		mission.runScreen ({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_special1b&quot;});
	}
	this.$ig_cleanupmissionvariables();
}

//======================================================================================================================
this.$ig_special4choice = function(choice) {
	if (choice === &quot;1_AGREESPECIAL5&quot;) {
		missionVariables.ig_currentmission = &quot;special5&quot;
		mission.setInstructionsKey (&quot;special5_instructions&quot;, &quot;illegal_goods_missions&quot;);
		missionVariables.ig_special5slavecount = 0;
		mission.runScreen ({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_special4b&quot;});
	} else {
		mission.setInstructionsKey (null, &quot;illegal_goods_missions&quot;);
		mission.unmarkSystem({system:system.info.systemID, name:&quot;ig_mission&quot;});
		mission.runScreen ({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_special4a&quot;});
		this.$ig_cleanupmissionvariables();
	}
}

//======================================================================================================================
this.$ig_special5choice = function(choice) {
	if(choice === &quot;1_YESSLAVES&quot;) {
		missionVariables.ig_special5end = &quot;not yet&quot;;
		mission.runScreen ({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_special5b&quot;});
	} else {
		mission.setInstructionsKey (null, &quot;illegal_goods_missions&quot;);
		mission.unmarkSystem({system:system.info.systemID, name:&quot;ig_mission&quot;});
		missionVariables.ig_missionreward = (1000 + (missionVariables.ig_special5slavecount * 50));
		mission.runScreen ({screenID:&quot;igt_endmission&quot;, title: &quot;Eternal Gratitude.&quot;, messageKey: &quot;end_mission_special5a&quot;});
		player.credits += missionVariables.ig_missionreward;
		this.$ig_cleanupmissionvariables();
	}
}

//======================================================================================================================
// used in special5 mission
this.systemWillPopulate = function() {

	// we put the slaver base in regardless of whether the player chooses to access the mission
	// it&#39;s on the other side of the sun, so they are unlikely to find it without notification
	// if they do, well, that&#39;s just a bonus for the player
	if ((missionVariables.ig_currentmission === &quot;special4&quot; || missionVariables.ig_currentmission === &quot;special5&quot;) &amp;&amp;
		system.info.systemID === missionVariables.ig_missionsystem &amp;&amp;
		system.countShipsWithRole(&quot;slaver_base&quot;) === 0 &amp;&amp;
		!missionVariables.ig_slaverbasedestroyed) {

		// set the position of the base
		//log(this.name, &quot;Adding slaver base to system&quot;);
		var position = Vector3D(0, 0, 1.2 + Math.random() * 0.2).fromCoordinateSystem(&quot;psu&quot;);
		// add base with populator
		system.setPopulator(&quot;slaver base&quot;, {
			callback: function(pos) {
				//log(this.name, &quot;adding...&quot;);
				var sb = system.addShips(&quot;slaver_base&quot;, 1, pos);
				//log(this.name, &quot;result: &quot; + sb);
				// adjust properties of slaver base
				if (sb.length &gt; 0) sb[0].suppressArrivalReports = true;
				if (!sb || sb.length == 0) log(this.name, &quot;ERROR - slaser base not created!&quot;);
			}.bind(this),
			location:&quot;COORDINATES&quot;,
			coordinates:position});

		// add some asteroids around the base
		system.setPopulator(&quot;sb_asteroid&quot;, {
			callback: function(pos) {
				system.addShips(&quot;asteroid&quot;, 8, pos, player.ship.scannerRange);
			}.bind(this),
			location:&quot;COORDINATES&quot;,
			coordinates:position});

	}
}

//======================================================================================================================
// used for free maintenace equipment.
this.guiScreenChanged = function(to, from) {
	if(to === &quot;GUI_SCREEN_EQUIP_SHIP&quot; &amp;&amp; player.ship.equipmentStatus(&quot;EQ_IG_INSURANCE&quot;) === &quot;EQUIPMENT_OK&quot;) {
		this._ig_playercredits = player.credits;
	}
}

//======================================================================================================================
this.playerBoughtEquipment = function(equipment) {
	if(player.ship.equipmentStatus(&quot;EQ_IG_INSURANCE&quot;) === &quot;EQUIPMENT_OK&quot;) {
		if(equipment === &quot;EQ_RENOVATION&quot;) {
			player.credits = this._ig_playercredits;
			player.ship.removeEquipment(&quot;EQ_IG_INSURANCE&quot;);
			player.consoleMessage(&quot;TianveDirect Insurance Policy redeemed - No charge for Maintenance Overhaul&quot;,5);
		} else {
			this._ig_playercredits = player.credits;
		}
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/illegal_goods_tweak.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;illegal_goods_tweak&quot;;
this.author      = &quot;Capt. Murphy&quot;;
this.copyright   = &quot;2012 Capt. Murphy&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;
this.description = &quot;Introduces interaction with GalCop customs when docking at a main station with contraband in the hold.&quot;;

this._alwaysDetect = true;		// Change this to false if you want a chance that Galcop customs don&#39;t notice your Contraband.
this._loggingEnabled = false;	// enables log entries
this._ncOXPStations = true;		// if true and New Cargoes installed docking penalties will apply at some OXP stations (as defined by New Cargoes)
this._cargoNameArray = [&quot;food&quot;, &quot;textiles&quot;, &quot;radioactives&quot;, &quot;slaves&quot;, &quot;liquor_wines&quot;, &quot;luxuries&quot;, &quot;narcotics&quot;, &quot;computers&quot;, &quot;machinery&quot;, &quot;alloys&quot;, &quot;firearms&quot;, &quot;furs&quot;, &quot;minerals&quot;, &quot;alien_items&quot;]; // used by Hypercargo/Vortex code
this._cargoType = [&quot;food&quot;, &quot;textiles&quot;, &quot;radioactives&quot;, &quot;slaves&quot;, &quot;liquor_Wines&quot;, &quot;luxuries&quot;, &quot;narcotics&quot;, &quot;computers&quot;, &quot;machinery&quot;, &quot;alloys&quot;, &quot;firearms&quot;, &quot;furs&quot;, &quot;minerals&quot;, &quot;gold&quot;, &quot;platinum&quot;, &quot;gem_stones&quot;, &quot;alien_items&quot;]; // used by New Cargoes code.
this._smugglers = false;
this._runContrabandCheck = false;

//======================================================================================================================
// OXPConfig2 attributes
this.oxpcSettings =
{
	Info: {Name:&quot;illegal_goods_tweak&quot;,Display:&quot;Illegal Goods Tweak&quot;,Notify:false,InfoB:&quot;Note _ncOXPStations ignored if New Cargoes OXP is not installed. Default is main stations only.&quot;},
	Bool0: {Name:&quot;_alwaysDetect&quot;,Def:true,Desc:&quot;100% contraband detection rate.&quot;},
	Bool1: {Name:&quot;_loggingEnabled&quot;,Def:false,Desc:&quot;Enable Log Messages.&quot;},
	Bool2: {Name:&quot;_ncOXPStations&quot;,Def:true,Desc:&quot;Contraband checks at OXP stations.&quot;}
}

// configuration settings for use in Lib_Config
this._igtConfig = {Name:this.name, Alias:&quot;Illegal Goods Tweak&quot;, Display:&quot;Config&quot;, Alive:&quot;_igtConfig&quot;,
	Bool:{
		B0:{Name:&quot;_alwaysDetect&quot;, Def:true, Desc:&quot;100% detection rate&quot;},
		B1:{Name:&quot;_loggingEnabled&quot;, Def:false, Desc:&quot;Enable log messages&quot;},
		B2:{Name:&quot;_ncOXPStations&quot;, Def:true, Desc:&quot;Check at OXP stations&quot;},
		Info:&quot;0 - 100% contraband detection rate.\n1 - Output debug messages to the log.\n2 - Enable contraband check at OXP stations.&quot;},
};

//======================================================================================================================
this.startUp = function() { // clean up old missionVariable from previous versions.

	if (missionVariables.ig_always_detect){
		if (missionVariables.ig_always_detect === &quot;no&quot;){this._alwaysDetect = false;}
		delete missionVariables.ig_always_detect;
	}
	delete missionVariables.ig_amnestyreward;
	delete missionVariables.ig_bribe;
	// compatibility checks....
	if (worldScripts[&quot;CargoTypeExtension&quot;]) {
		this._compatibilityMessage = &quot;&quot;;
		var version = worldScripts[&quot;CargoTypeExtension&quot;].version;
		if (version.localeCompare(&quot;1.2.3&quot;) &lt; 0)	{this._compatibilityMessage += &quot;Illegal Goods Tweak is not compatible with New Cargoes version &quot;+version+&quot;. Please upgrade to New Cargoes verson 1.2.3 or later.\n\n&quot;;}
		if (worldScripts[&quot;HyperCargo&quot;]) {
			version = worldScripts[&quot;HyperCargo&quot;].version;
			if (Number(version) &lt; 1.07) {this._compatibilityMessage += &quot;Illegal Goods Tweak and New Cargoes not compatible with HyperCargo version &quot;+version+&quot;. Please upgrade to HyperCargo version 1.07 or later.\n\n&quot;;}
		}
		if (worldScripts[&quot;vortex_player.js&quot;]) {
			version = worldScripts[&quot;vortex_player.js&quot;].version;
			if (Number(version) &lt; 1.23) {this._compatibilityMessage += &quot;Illegal Goods Tweak and New Cargoes not compatible with Vortex version &quot;+version+&quot;. Please upgrade to Vortex version 1.23 or later.&quot;;}
		}
	}
	if (worldScripts.Smugglers_Illegal) this._smugglers = true;

	// register our settings, if Lib_Config is present
	if (worldScripts.Lib_Config) worldScripts.Lib_Config._registerSet(this._igtConfig);
}

//======================================================================================================================
this.shipDockedWithStation = function() { // will check for contraband if just docked
	this._runContrabandCheck = true;
}

//======================================================================================================================
this.missionScreenOpportunity = function() {
	if (this._compatibilityMessage) {
		mission.runScreen ({screenID:&quot;igt_compatibility&quot;, title: &quot;Warning&quot;});
		mission.addMessageText(this._compatibilityMessage);
		delete this._compatibilityMessage;
	}
	if (this._runContrabandCheck &amp;&amp; player.ship.docked &amp;&amp;
		(player.ship.dockedStation.allegiance == &quot;galcop&quot; || (this._ncOXPStations &amp;&amp; worldScripts[&quot;CargoTypeExtension&quot;] &amp;&amp; worldScripts[&quot;CargoTypeExtension&quot;].checkImports(player.ship.dockedStation)))) {
		delete this._runContrabandCheck;
		this.$contrabandCheck();
	}
}

//======================================================================================================================
this.$contrabandCheck = function () {
    //reset persistent variables.
	this._manNCSlavesIgnore = 0;
	this._manNCNarcsIgnore = 0;
	this._manNCArmsIgnore = 0;
	this._hcNCSlavesIgnore = 0;
	this._hcNCNarcsIgnore = 0;
	this._hcNCArmsIgnore = 0;
	this._mbNCSlavesIgnore = new Array;
	this._mbNCNarcsIgnore = new Array;
	this._mbNCArmsIgnore = new Array;
	this._mBSlavesIgnored = 0;
	this._mBNarcsIgnored = 0;
	this._mBArmsIgnored = 0;
	this._hcSlaves = 0;
	this._hcNarcs = 0;
	this._hcArms = 0;
	this._slavesNoPermit = new Array;
	this._narcsNoPermit = new Array;
	this._armsNoPermit = new Array;
	this._slavesTypeNoPermit = new Array;
	this._narcsTypeNoPermit = new Array;
	this._armsTypeNoPermit = new Array;

    // detect contraband in normal hold
	this._manSlaves = player.ship.manifest.slaves;
	this._manNarcs = player.ship.manifest.narcotics;
	this._manArms = player.ship.manifest.firearms;

	// check for special cargos and permits from New Cargoes OXP in manifest
	this._ncStatus = new Array;
	if (worldScripts[&quot;CargoTypeExtension&quot;]){this.$checkNC(&quot;manifest&quot;);}
	if (this._ncStatus.length &gt; 0) {this.$checkNCPermits(&quot;manifest&quot;,&quot;checkManifest&quot;);}
	if (this._smugglers == false) {
		var illegals = this._manSlaves - this._manNCSlavesIgnore + this._manNarcs - this._manNCNarcsIgnore + this._manArms - this._manNCArmsIgnore;
	} else {
		var illegals = this._manSlaves - this._manNCSlavesIgnore;
		this._manNarcs = 0;
		this._manNCNarcsIgnore = 0;
		this._manArms = 0;
		this._manNCArmsIgnore;
	}

	// detect contraband in hypercargo if fitted.
	if(player.ship.equipmentStatus(&quot;EQ_HYPERCARGO&quot;) === &quot;EQUIPMENT_OK&quot; &amp;&amp; worldScripts[&quot;HyperCargo&quot;]) {
		this._hcUsed = this.$checkHyperCargo();
		if (worldScripts[&quot;CargoTypeExtension&quot;] &amp;&amp; missionVariables.hyperCargoNewCargoes) {
			var tempCurrentManifest = worldScripts[&quot;CargoTypeExtension&quot;].suspendPlayerManifest();
			worldScripts[&quot;CargoTypeExtension&quot;].restorePlayerManifest(missionVariables.hyperCargoNewCargoes);
			this.$checkNC(&quot;hypercargo&quot;);
			if (this._ncStatus.length &gt; 0) {this.$checkNCPermits(&quot;hypercargo&quot;,&quot;checkHyperCargo&quot;);}
			missionVariables.hyperCargoNewCargoes = worldScripts[&quot;CargoTypeExtension&quot;].suspendPlayerManifest();
			worldScripts[&quot;CargoTypeExtension&quot;].restorePlayerManifest(tempCurrentManifest);
		}
		if (this._hcUsed) {
			if (this._smugglers == false) {
				var illegalsHC = this._hcSlaves - this._hcNCSlavesIgnore + this._hcNarcs - this._hcNCNarcsIgnore + this._hcArms - this._hcNCArmsIgnore;
			} else {
				var illegalsHC = this._hcSlaves - this._hcNCSlavesIgnore;
			}
			// if hypercargo is hacked, has contraband and no contraband in main hold go to slipped past customs.
			if (missionVariables.hyperCargoFailChance === 0.05 &amp;&amp; illegalsHC &gt; 0 &amp;&amp; illegals === 0){this.$slippedPastCustoms();}
			// other wise include hypercargo contraband in total count
			else if (missionVariables.hyperCargoFailChance !== 0.05){illegals += illegalsHC;}
		}
	}
	if (illegals &gt; 0) { // if contraband is present...
		if (!this._alwaysDetect) { // if false random chance of detection
			if((Math.floor(Math.random() * 100) + 1) &gt; ((system.techLevel + (system.government * 2) + 4)*3)){
				this.$slippedPastCustoms();
			} else {
				this.$warningScreen();
			}
		} else {
			this.$warningScreen();
		}
	} else {// if no illegals in main hold and no hypercargo check for vortex/maelstrom/multiBay and call multiBay code.
		if(player.ship.equipmentStatus(&quot;EQ_MULTIBAY&quot;) === &quot;EQUIPMENT_OK&quot;) {
			this._manNarcs = 0;
			this._manSlaves = 0;
			this._manArms = 0;
			if(player.ship.name === &quot;Maelstrom&quot;) {this._multiBayNo = 3;}
			if(player.ship.name === &quot;Vortex&quot;) {this._multiBayNo = 5;}
			this.$suspendCurrentManifest();
			var bayCounter;
			for (bayCounter = 0; bayCounter &lt; this._multiBayNo; bayCounter++) {
				if (bayCounter === missionVariables.multiBay_currentCargo) {continue;}
				this.$unloadMB(bayCounter);
				if (worldScripts[&quot;CargoTypeExtension&quot;]) {this.$checkNC(&quot;multibay&quot;+bayCounter);}
				if (this._ncStatus.length &gt; 0) {this.$checkNCPermits(&quot;multibay&quot;+bayCounter,&quot;checkMultiBay&quot;,bayCounter);}
				if (this._smugglers == false) {
					this._manNarcs += player.ship.manifest.narcotics;
					this._manArms +=player.ship.manifest.firearms;
					this._mBNarcsIgnored += this._mbNCNarcsIgnore[bayCounter];
					this._mBArmsIgnored += this._mbNCArmsIgnore[bayCounter];
				}
				this._manSlaves += player.ship.manifest.slaves;
				if (this._smugglers == false) {
					illegals += player.ship.manifest.narcotics + player.ship.manifest.slaves + player.ship.manifest.firearms - this._mbNCNarcsIgnore[bayCounter]- this._mbNCSlavesIgnore[bayCounter]- this._mbNCArmsIgnore[bayCounter];
				} else {
					illegals += player.ship.manifest.slaves - this._mbNCSlavesIgnore[bayCounter];
				}
				this._mBSlavesIgnored += this._mbNCSlavesIgnore[bayCounter];
				this.$loadMB(bayCounter);
			}
			this.$restoreCurrentManifest();
			if (illegals &gt; 0) {
				this._mbUsed = true;
				this.$slippedPastCustoms();
			}
		}
	}
}

//======================================================================================================================
// function to check if any contraband is a New Cargoes special cargo. Results are stored in this._ncStatus
this.$checkNC = function (location) {
	var counter;
	var arrayLength;
	var genericType;
	var quantity;
	var permitLevel;
	var tempArray = new Array;
	var index;
	var specificType;
	var specialCargoCarried = worldScripts[&quot;CargoTypeExtension&quot;].specialCargoesCarried();
	if (specialCargoCarried.length &gt; 0) {
		arrayLength = specialCargoCarried.length;
		for (counter = 0; counter &lt; arrayLength; counter++) {
			genericType = worldScripts[&quot;CargoTypeExtension&quot;].cargoDefinition(specialCargoCarried[counter],&quot;genericType&quot;);
			if (genericType !== &quot;slaves&quot; &amp;&amp; genericType !== &quot;narcotics&quot; &amp;&amp; genericType !== &quot;firearms&quot;) {continue;}

			specificType = worldScripts[&quot;CargoTypeExtension&quot;].cargoDefinition(specialCargoCarried[counter],&quot;specificType&quot;);
			quantity = worldScripts[&quot;CargoTypeExtension&quot;].hasSpecialCargo(specialCargoCarried[counter]);
			permitLevel = worldScripts[&quot;CargoTypeExtension&quot;].importPermitDetails(specialCargoCarried[counter],quantity);
			tempArray = [location,specialCargoCarried[counter],genericType,quantity,permitLevel,specificType];
			index = this._ncStatus.length;
			this._ncStatus[index] = tempArray;
			if (this._loggingEnabled) {log (this.name,&quot;checkNC output: &quot; + this._ncStatus);}
		}
	}
}

//======================================================================================================================
// function that checks this._ncStatus for contraband Special Cargo with a valid permit.
this.$checkNCPermits = function(location,context,bayCounter) {
	var counter;
	var arrayLength = this._ncStatus.length;
	var slaveCount = 0;
	var narcCount = 0;
	var armCount = 0;
	for (counter = 0; counter &lt; arrayLength; counter++) {
		if (this._ncStatus[counter][0] !== location) {continue;}
		if (this._ncStatus[counter][2] === &quot;slaves&quot;) {
			if (this._ncStatus[counter][4][0] !== 0 ||
				this._ncStatus[counter][4][1] !== 0 ||
				this._ncStatus[counter][4][2] !== 0) {
				slaveCount += this._ncStatus[counter][3];
				continue;
			} else {
				this._slavesNoPermit.push(this._ncStatus[counter][3]);
				this._slavesTypeNoPermit.push(this._ncStatus[counter][5]);
				continue;
			}
		}
		if (this._ncStatus[counter][2] === &quot;narcotics&quot;) {
			if (this._ncStatus[counter][4][0] !== 0 ||
				this._ncStatus[counter][4][1] !== 0 ||
				this._ncStatus[counter][4][2] !== 0) {
				narcCount += this._ncStatus[counter][3];
				continue;
			} else {
				this._narcsNoPermit.push(this._ncStatus[counter][3]);
				this._narcsTypeNoPermit.push(this._ncStatus[counter][5]);
				continue;
			}
		}
		if (this._ncStatus[counter][2] === &quot;firearms&quot;) {
			if (this._ncStatus[counter][4][0] !== 0 ||
				this._ncStatus[counter][4][1] !== 0 ||
				this._ncStatus[counter][4][2] !== 0) {
				armCount += this._ncStatus[counter][3];
			} else {
				this._armsNoPermit.push(this._ncStatus[counter][3]);
				this._armsTypeNoPermit.push(this._ncStatus[counter][5]);
				continue;
			}
		}
	}
	if (this._loggingEnabled) {log (this.name,&quot;checkNCPermits context: &quot;+context+&quot;, location: &quot;+location+&quot;, Slaves Ignored: &quot;+ slaveCount+ &quot;, Narcs Ignored: &quot;+narcCount+&quot;, Firearms ignored: &quot;+armCount);}
	if (context === &quot;checkManifest&quot;) {
		this._manNCSlavesIgnore = slaveCount;
		this._manNCNarcsIgnore = narcCount;
		this._manNCArmsIgnore = armCount;
		return;
	}
	if (context === &quot;checkHyperCargo&quot;) {
		this._hcNCSlavesIgnore= slaveCount;
		this._hcNCNarcsIgnore = narcCount;
		this._hcNCArmsIgnore = armCount;
		return;
	}
	if (context === &quot;checkMultiBay&quot;) {
		this._mbNCSlavesIgnore[bayCounter] = slaveCount;
		this._mbNCNarcsIgnore[bayCounter] = narcCount;
		this._mbNCArmsIgnore[bayCounter] = armCount;
		return;
	}
}

//======================================================================================================================
// function called when removing contraband to update New Cargoes records when necessary.
this.$updateNCStatus = function(location) {
  if (this._loggingEnabled) {log(this.name,&quot;updateNCStatus called with param.: &quot;+location);}
  var counter;
  var arrayLength = this._ncStatus.length;
  var iterations;
  for (counter = 0; counter &lt; arrayLength; counter++) {
	if (this._ncStatus[counter][0] !== location) {continue;}
	if (location === &quot;hypercargo&quot;) {
		var tempCurrentManifest = worldScripts[&quot;CargoTypeExtension&quot;].suspendPlayerManifest();
		worldScripts[&quot;CargoTypeExtension&quot;].restorePlayerManifest(missionVariables.hyperCargoNewCargoes);
	}
	if (this._ncStatus[counter][4][0] === 0 &amp;&amp; this._ncStatus[counter][4][1] === 0 &amp;&amp; this._ncStatus[counter][4][2] === 0) {
		iterations = this._ncStatus[counter][3];
		var counter1;
		for (counter1 = 0; counter1 &lt; iterations; counter1++) {
			worldScripts[&quot;CargoTypeExtension&quot;].removeSpecialCargo(this._ncStatus[counter][1])
		};
	}
	if (location === &quot;hypercargo&quot;) {
		missionVariables.hyperCargoNewCargoes = worldScripts[&quot;CargoTypeExtension&quot;].suspendPlayerManifest();
		worldScripts[&quot;CargoTypeExtension&quot;].restorePlayerManifest(tempCurrentManifest);
	}
	if (this._loggingEnabled) {log(this.name,&quot;tempCurrentmainifest: &quot;+tempCurrentManifest+&quot;missionVariables.hyperCargoNewCargoes: &quot; +missionVariables.hyperCargoNewCargoes);}
  }
}

//======================================================================================================================
this.$checkHyperCargo = function() {
	var returnFlag = false;
	if (missionVariables.hyperCargoMemory === &quot;EMPTY&quot;) {return returnFlag;}
	if (worldScripts[&quot;HyperCargo&quot;].storedArray[3] &gt; 0) {this._hcSlaves = worldScripts[&quot;HyperCargo&quot;].storedArray[3]; returnFlag = true;}
	if (worldScripts[&quot;HyperCargo&quot;].storedArray[6] &gt; 0) {this._hcNarcs = worldScripts[&quot;HyperCargo&quot;].storedArray[6]; returnFlag = true;}
	if (worldScripts[&quot;HyperCargo&quot;].storedArray[10] &gt; 0) {this._hcArms = worldScripts[&quot;HyperCargo&quot;].storedArray[10]; returnFlag = true;}
	return returnFlag;
}

//======================================================================================================================
this.$updateHyperCargo = function() {
	worldScripts[&quot;HyperCargo&quot;].storedArray[3] = this._hcNCSlavesIgnore;
	worldScripts[&quot;HyperCargo&quot;].storedArray[6] = this._hcNCNarcsIgnore;
	worldScripts[&quot;HyperCargo&quot;].storedArray[10] = this._hcNCArmsIgnore;
	var counter;
	var contents = 0;
	missionVariables.hyperCargoMemory = &quot;&quot;;
	for(counter = 0; counter &lt; 14; counter++) {
		contents += worldScripts[&quot;HyperCargo&quot;].storedArray[counter];
		missionVariables.hyperCargoMemory = missionVariables.hyperCargoMemory + worldScripts[&quot;HyperCargo&quot;].storedArray[counter] + &quot;:&quot;;
	}
	if (contents === 0) {missionVariables.hyperCargoMemory = &quot;EMPTY&quot;;}
}

//======================================================================================================================
this.$suspendCurrentManifest = function() {
    if (worldScripts[&quot;CargoTypeExtension&quot;]) {this._tempNCManifest = worldScripts[&quot;CargoTypeExtension&quot;].suspendPlayerManifest();}
	this._tempManifestArray = new Array(17);
	var counter;
    for (counter = 0; counter &lt; 17; counter++) {
		this._tempManifestArray[counter] = manifest[this._cargoType[counter]];
		manifest[this._cargoType[counter]] = 0;
	}
}

//======================================================================================================================
this.$restoreCurrentManifest = function() {
	var counter;
	for(counter = 0; counter &lt; 17; counter++) {
		manifest[this._cargoType[counter]] = this._tempManifestArray[counter];
	}
	delete this._tempManifestArray;
	if (worldScripts[&quot;CargoTypeExtension&quot;]) {worldScripts[&quot;CargoTypeExtension&quot;].restorePlayerManifest(this._tempNCManifest);}
}

//======================================================================================================================
this.$unloadMB = function(bay) {
	if (worldScripts[&quot;CargoTypeExtension&quot;] &amp;&amp; missionVariables[&quot;multiBay_ncBay&quot; + bay]) {
		worldScripts[&quot;CargoTypeExtension&quot;].restorePlayerManifest(missionVariables[&quot;multiBay_ncBay&quot; + bay]);
	}
	var tempArray = missionVariables[&quot;multiBay_cargoBay&quot; + bay].split(&quot;:&quot;);
	var cargoCounter;
	for (cargoCounter = 0; cargoCounter &lt; 14; cargoCounter++) {
		manifest[this._cargoNameArray[cargoCounter]] = tempArray[cargoCounter];
	}
}

//======================================================================================================================
this.$loadMB = function(bay) {
	var tempArray = new Array(14);
	var loadCounter;
	for(loadCounter = 0; loadCounter &lt; 14; loadCounter++) {
		tempArray[loadCounter] = manifest[this._cargoNameArray[loadCounter]];
		manifest[this._cargoNameArray[loadCounter]] = 0;
	}
	missionVariables[&quot;multiBay_cargoBay&quot; + bay] = tempArray.join(&quot;:&quot;);
	if(worldScripts[&quot;CargoTypeExtension&quot;]) {
		missionVariables[&quot;multiBay_ncBay&quot; + bay] = worldScripts[&quot;CargoTypeExtension&quot;].suspendPlayerManifest();
	}
}

//======================================================================================================================
this.$detectedChoice = function(choice) {
	if (choice === &quot;1_YES&quot;) {// handover contraband
		this.$commonHandover();
	}
	if (choice === &quot;2_NO&quot;) {// ignore warning
		this.$commonPenalty();
	}
	if (choice === &quot;4_NO&quot;) {// switch to smugglers
		worldScripts.Smugglers_Equipment._doCargoCheck = true;
	}
	if (choice === &quot;3_BRIBE&quot;) { // attempt bribe
		if((Math.floor(Math.random() * 100) + 1) &lt; (system.government + (7 - system.economy) + 5 * 5)) {
			missionVariables.ig_legalpenalty = 25;
			player.ship.setBounty(player.bounty + missionVariables.ig_legalpenalty, &quot;attempted bribe&quot;);
			mission.runScreen ({screenID:&quot;igt_bribe&quot;, title: &quot;Bribery Is An Offence!&quot;, messageKey: &quot;failed_bribe&quot;, model: &quot;police&quot;, choicesKey: &quot;failedbribe_handover_yesno&quot;}, this.$failedBribeChoice);
			// email system interface
			var w = worldScripts.EmailSystem;
			if (w) {
				var ga = worldScripts.GalCopAdminServices;
				w.$createEmail({sender:&quot;GalCop Customs&quot;,
					subject:&quot;Attempt to bribe official&quot;,
					date:global.clock.seconds,
					message:expandMissionText(&quot;failed_bribe_email&quot;, {stationname:player.ship.dockedStation.displayName, systemname:System.systemNameForID(global.system.ID)}),
					expiryDays:ga._defaultExpiryDays
				});
			}
			delete missionVariables.ig_legalpenalty;
		} else {
			missionVariables.ig_bribe = Math.round(((this._manArms - this._manNCArmsIgnore + this._hcArms - this._hcNCArmsIgnore) * (49.6 +(Math.random() * 39.2))) + ((this._manNarcs - this._manNCNarcsIgnore + this._hcNarcs - this._hcNCNarcsIgnore) * (0.4 +(Math.random() * 101.2))) + ((this._manSlaves - this._manNCSlavesIgnore + this._hcSlaves - this._hcNCSlavesIgnore) * (2 +(Math.random() * 26.4))));
			if(missionVariables.ig_bribe &gt; player.credits) {
				missionVariables.ig_bribe = player.credits;
			}
			mission.runScreen({screenID:&quot;igt_bribe&quot;, title: &quot;Interesting...&quot;, messageKey: &quot;offered_bribe&quot;, model: &quot;police&quot;, choicesKey: &quot;bribe_accept_yesno&quot;}, this.$bribeChoice);
		}
	}
}

//======================================================================================================================
this.$failedBribeChoice = function(choice) {
	if (choice === &quot;1_YES&quot;) { // handover after failed bribe attempt
		this.$commonHandover();
	} else { // ignore warnings
		this.$commonPenalty();
	}
}

//======================================================================================================================
this.$bribeChoice = function(choice) {
	if (choice === &quot;1_PAY&quot;) { // pay bribe
		player.credits -= missionVariables.ig_bribe;
		mission.runScreen ({screenID:&quot;igt_bribe&quot;, title: &quot;All Clear.&quot;, messageKey: &quot;paid_bribe&quot;, model: &quot;police&quot;});
		delete missionVariables.ig_bribe;
	}
	if (choice === &quot;2_NO&quot;) { // don&#39;t pay bribe and accept legal penalty
		delete missionVariables.ig_bribe;
		this.$commonPenalty();
	}
	if (choice === &quot;3_YES&quot;) { // don&#39;t pay bribe and handover contraband
	    delete missionVariables.ig_bribe;
		this.$commonHandover();
	}
}

//======================================================================================================================
this.$warningScreen = function() {
	if (this._smugglers == false) {
		mission.runScreen({
			screenID:&quot;igt_warning&quot;, 
			title: &quot;GalCop Customs Warning&quot;, 
			messageKey: &quot;contraband_warning&quot;, 
			model: &quot;police&quot;, 
			choicesKey: &quot;detected_yesnobribe&quot;}, 
		this.$detectedChoice);
	} else {
		mission.runScreen({
			screenID:&quot;igt_warning&quot;, 
			title: &quot;Amnesty Intergalactic&quot;, 
			messageKey: &quot;contraband_warning_alt&quot;, 
			overlay:{name:&quot;stgu-candle.png&quot;, height:546}, 
			choicesKey: &quot;detected_yesno&quot;}, 
		this.$detectedChoice);
	}
	this.$appendDetectedContraband();
}

//======================================================================================================================
this.$appendDetectedContraband = function() {
	mission.addMessageText(&quot;Contraband Detected:\n&quot;);
	var counter;
	this._detectedContraband = &quot;&quot;;

	var slavesDetected = this._manSlaves - this._manNCSlavesIgnore + this._hcSlaves - this._hcNCSlavesIgnore - this._mBSlavesIgnored;
	if (slavesDetected &gt; 0) {
		var slavesMessage = &quot;Slaves : &quot;+slavesDetected+&quot; units&quot;;
		if (this._slavesNoPermit.length &gt; 0) {
			slavesMessage += &quot; including &quot;;
			for (counter = 0; counter &lt; this._slavesNoPermit.length; counter++) {
				slavesMessage += this._slavesNoPermit[counter] + &quot; &quot;;
				if ((this._slavesNoPermit.length - counter) === 1){
					slavesMessage += this._slavesTypeNoPermit[counter]+&quot;.&quot;;
				} else {
					slavesMessage += this._slavesTypeNoPermit[counter]+&quot;, &quot;;
				}
			}
		} else {
			slavesMessage += &quot;.&quot;;
		}
		mission.addMessageText(slavesMessage);
		this._detectedContraband += slavesMessage + &quot;\n&quot;;
	}
	if (this._smugglers == false) {
		var narcsDetected = this._manNarcs - this._manNCNarcsIgnore + this._hcNarcs - this._hcNCNarcsIgnore - this._mBNarcsIgnored;
		if (narcsDetected &gt; 0) {
			var narcsMessage = &quot;Narcotics : &quot;+narcsDetected+&quot; tons&quot;;
			if (this._narcsNoPermit.length &gt; 0) {
				narcsMessage += &quot; including &quot;;
				for (counter = 0; counter &lt; this._narcsNoPermit.length; counter++) {
					narcsMessage += this._narcsNoPermit[counter]+&quot; &quot;;
					if ((this._narcsNoPermit.length - counter) === 1) {
						narcsMessage += this._narcsTypeNoPermit[counter]+&quot;.&quot;;
					} else {
						narcsMessage = narcsMessage +this._narcsTypeNoPermit[counter]+&quot;, &quot;;
					}
				}
			} else {
				narcsMessage += &quot;.&quot;;
			}
			mission.addMessageText(narcsMessage);
			this._detectedContraband += narcsMessage + &quot;\n&quot;;
		}
		var armsDetected = this._manArms - this._manNCArmsIgnore + this._hcArms - this._hcNCArmsIgnore - this._mBArmsIgnored;
		if (armsDetected &gt; 0) {
			var armsMessage = &quot;Firearms : &quot;+armsDetected+&quot; tons&quot;;
			if (this._armsNoPermit.length &gt; 0) {
				armsMessage += &quot; including &quot;;
				for (counter = 0; counter &lt; this._armsNoPermit.length; counter++) {
					armsMessage += this._armsNoPermit[counter]+&quot; &quot;;
					if ((this._armsNoPermit.length - counter) === 1) {
						armsMessage += this._armsTypeNoPermit[counter]+&quot;.&quot;;
					} else {
						armsMessage = armsMessage +this._armsTypeNoPermit[counter]+&quot;, &quot;;
					}
				}
			} else {
				armsMessage += &quot;.&quot;;
			}
			mission.addMessageText(armsMessage);
			this._detectedContraband += armsMessage + &quot;\n&quot;;
		}
	}
}

//======================================================================================================================
this.$slippedPastCustoms = function() {
	mission.runScreen ({screenID:&quot;igt_slipcustoms&quot;, title: &quot;You Slipped Past Customs.&quot;, messageKey: &quot;handover_voluntary&quot;, choicesKey: &quot;handover_vol_yesno&quot;}, this.$volHandoverChoice);
	this.$appendDetectedContraband();
}

//======================================================================================================================
this.$volHandoverChoice = function (choice) {
	if(choice === &quot;1_YES&quot;) { // if slipped past customs handover voluntarily.
		this.$commonHandover();
	} else {
		delete this._hcUsed;
		delete this._mbUsed;
	}
}

//======================================================================================================================
this.$commonHandover = function() {
	if (this._ncStatus.length &gt; 0) {this.$updateNCStatus(&quot;manifest&quot;);}
	player.ship.manifest.slaves = this._manNCSlavesIgnore;
	if (this._smugglers == false) {
		player.ship.manifest.narcotics = this._manNCNarcsIgnore;
		player.ship.manifest.firearms = this._manNCArmsIgnore;
	}
	if (this._hcUsed) {
		this.$updateHyperCargo();
		if (this._ncStatus.length &gt; 0){this.$updateNCStatus(&quot;hypercargo&quot;);}
		delete this._hcUsed;
	}
	if (this._mbUsed) {
		delete this._mbUsed;
		this.$suspendCurrentManifest();
		var bayCounter = 0;
		for (bayCounter = 0; bayCounter &lt; this._multiBayNo; bayCounter++) {
			if (bayCounter === missionVariables.multiBay_currentCargo) {continue;}
			this.$unloadMB(bayCounter);
			if (this._ncStatus.length &gt; 0) {this.$updateNCStatus(&quot;multibay&quot;+bayCounter);}
			player.ship.manifest.slaves = this._mbNCSlavesIgnore[bayCounter];
			if (this._smugglers == false) {
				player.ship.manifest.narcotics = this._mbNCNarcsIgnore[bayCounter];
				player.ship.manifest.firearms = this._mbNCArmsIgnore[bayCounter];
			}
			this.$loadMB(bayCounter);
		}
		this.$restoreCurrentManifest();
	}
	// keep track of how many slaves rescued, for use externally
	if ((this._manSlaves - this._manNCSlavesIgnore - this._mBSlavesIgnored + this._hcSlaves - this._hcNCSlavesIgnore) &gt; 0) {
		missionVariables.ig_rescued_slaves += (this._manSlaves - this._manNCSlavesIgnore - this._mBSlavesIgnored + this._hcSlaves - this._hcNCSlavesIgnore);
	}
	// set the reward amount
	if (this._smugglers == false) {
		missionVariables.ig_amnestyreward = this._manNarcs - this._manNCNarcsIgnore - this._mBNarcsIgnored + this._hcNarcs - this._hcNCNarcsIgnore + this._manArms - this._manNCArmsIgnore - this._mBArmsIgnored + this._hcArms - this._hcNCArmsIgnore + ((this._manSlaves - this._manNCSlavesIgnore - this._mBSlavesIgnored + this._hcSlaves - this._hcNCSlavesIgnore) * 5);
	} else {
		missionVariables.ig_amnestyreward = ((this._manSlaves - this._manNCSlavesIgnore - this._mBSlavesIgnored + this._hcSlaves - this._hcNCSlavesIgnore) * 5);
	}
	// add the reward to the player&#39;s account
	player.credits += missionVariables.ig_amnestyreward;
	// determine how to display the amount (either &quot;credits&quot; or &quot;credit&quot;)
	missionVariables.ig_credittype = &quot;credits&quot;;
	if (missionVariables.ig_amnestyreward == 1) missionVariables.ig_credittype = &quot;credit&quot;;
	// show the mission screen
	if (this._smugglers == false) {
		mission.runScreen ({screenID:&quot;igt_contraband&quot;, title: &quot;Contraband Removed&quot;, messageKey: &quot;amnesty_reward&quot;, model: &quot;police&quot;});
	} else {
		mission.runScreen ({screenID:&quot;igt_contraband&quot;, title: &quot;Slaves Rescued&quot;, messageKey: &quot;amnesty_reward_alt&quot;, overlay:{name:&quot;stgu-candle.png&quot;, height:546}});
		worldScripts.Smugglers_Equipment._doCargoCheck = true;
	}

	// email system interface
	var w = worldScripts.EmailSystem;
	if (w) {
		var ga = worldScripts.GalCopAdminServices;
		if (this._smugglers == false) {
			w.$createEmail({sender:&quot;GalCop Customs&quot;,
				subject:&quot;Contraband removal&quot;,
				date:global.clock.seconds,
				message:expandMissionText(&quot;amnesty_reward_email&quot;, {contraband:this._detectedContraband, stationname:player.ship.dockedStation.displayName, systemname:System.systemNameForID(global.system.ID)}),
				expiryDays:ga._defaultExpiryDays
			});
		} else {
			w.$createEmail({sender:&quot;Amnesty Intergalactic&quot;,
				subject:&quot;Slaves Rescued&quot;,
				date:global.clock.seconds,
				message:expandMissionText(&quot;amnesty_reward_email_alt&quot;, {contraband:this._detectedContraband, stationname:player.ship.dockedStation.displayName, systemname:System.systemNameForID(global.system.ID)}),
				expiryDays:ga._defaultExpiryDays
			});
		}
	}
	delete missionVariables.ig_credittype;
	delete missionVariables.ig_amnestyreward;
	if ((this._manSlaves - this._manNCSlavesIgnore - this._mBSlavesIgnored + this._hcSlaves - this._hcNCSlavesIgnore) &gt; 0) {
		this.$missionInitialise();
	}
}

//======================================================================================================================
this.$commonPenalty = function() {
	missionVariables.ig_legalpenalty = this._manArms - this._manNCArmsIgnore + this._hcArms - this._hcNCArmsIgnore + this._manSlaves - this._manNCSlavesIgnore + this._hcSlaves - this._hcNCSlavesIgnore + ((this._manNarcs - this._manNCNarcsIgnore + this._hcNarcs - this._hcNCNarcsIgnore) * 2);
	player.ship.setBounty(player.bounty + missionVariables.ig_legalpenalty, &quot;illegal imports&quot;);
	mission.runScreen ({screenID:&quot;igt_penalised&quot;, title: &quot;You Have Been Penalised!&quot;, messageKey: &quot;legal_penalty&quot;, model: &quot;police&quot;});
	// email system interface
	var w = worldScripts.EmailSystem;
	if (w) {
		var ga = worldScripts.GalCopAdminServices;
		w.$createEmail({sender:&quot;GalCop Customs&quot;,
			subject:&quot;Contraband Penalty&quot;,
			date:global.clock.seconds,
			message:expandMissionText(&quot;legal_penalty_email&quot;, {stationname:player.ship.dockedStation.displayName, systemname:System.systemNameForID(global.system.ID)}),
			expiryDays:ga._defaultExpiryDays
		});
	}
	delete missionVariables.ig_legalpenalty;
}

//======================================================================================================================
// if slaves are handed over sets up potential mini missions.
this.$missionInitialise = function() {
	if (!missionVariables.ig_pendingmission) {
		var tempCounter = 0;
		var iterations = this._manSlaves - this._manNCSlavesIgnore - this._mBSlavesIgnored + this._hcSlaves - this._hcNCSlavesIgnore;
		for(tempCounter =0;tempCounter&lt;iterations;tempCounter++) {
			if (Math.random() &lt; 0.1) {
				missionVariables.ig_pendingmission = true;
				missionVariables.ig_rescuelocation = (&quot;&quot; + system.name);
				missionVariables.ig_rescuetime = clock.days;
				missionVariables.ig_missionlaunchtime = (clock.days + 7 + Math.floor(Math.random()*8));
				break;
			}
		}
	}
	// tacked on here - if slaves are handed over at end of special5 mission increment counter for special reward.
	if (missionVariables.ig_currentmission === &quot;special5&quot; &amp;&amp; missionVariables.ig_missionsystem === system.info.systemID &amp;&amp; missionVariables.ig_slaverbasedestroyed) {
		missionVariables.ig_special5slavecount += this._manSlaves - this._manNCSlavesIgnore - this._mBSlavesIgnored + this._hcSlaves - this._hcNCSlavesIgnore;
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/slaverbase.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;Slaver Base&quot;;
this.author      = &quot;capt. murphy adapted from work by eric walch&quot;;
this.description = &quot;Script for the Slaver Base included in illegal goods tweak OXP.&quot;;

//======================================================================================================================
this.shipBeingAttacked = function(attacker) {
    if (attacker.owner &amp;&amp; attacker.owner === this.ship &amp;&amp; attacker.target &amp;&amp; attacker.target === this.ship)	{
		attacker.reactToAIMessage(&quot;TARGET_LOST&quot;);
	}
}

//======================================================================================================================
this.stationLaunchedShip = function(ship) {
    if (ship.primaryRole === &quot;defense_ship&quot;) ship.switchAI(&quot;slaverbaseSlaverAI.plist&quot;);
	if (ship.primaryRole === &quot;scavenger&quot; &amp;&amp; !ship.bounty) ship.bounty = Math.random() * 30;
}

//======================================================================================================================
this.shipDied = function(whom, cause) {
	missionVariables.ig_slaverbasedestroyed = true;
	// set up time for news item in 5 days time
	missionVariables.ig_slaverbasenewsitem = global.clock.seconds + (5 * 86400);
	missionVariables.ig_slaverbasesystem = system.name;
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/slavermarket.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;slaver-market&quot;;
this.author = &quot;spara&quot;;
this.copyright = &quot;2014 spara&quot;;
this.license     = &quot;CC BY-NC-SA 4.0&quot;;

this.$originalDefs = {
      &quot;food&quot; : [0, 0, 20, -1, 0, 0, 1, 0, 0],
      &quot;textiles&quot; : [0, 0, 20, -1, 0, 0, 3, 0, 0],
      &quot;radioactives&quot; : [0, 0, 42, -3, -3, 0, 7, 3, 0],
      &quot;slaves&quot; : [0, 0, 2, 1, 0, 20, 1, 0, 0],
      &quot;liquor_wines&quot; : [0, 0, 105, -5, 0, 0, 15, 0, 0],
      &quot;luxuries&quot; : [0, 0, 236, 8, 0, 0, 3, 0, 0],
      &quot;narcotics&quot; : [0, 0, 10, 1, 0, 20, 120, 0, 0],
      &quot;computers&quot; : [0, 0, 150, 14, 0, 0, 3, 0, 0],
      &quot;machinery&quot; : [0, 0, 120, 6, 0, 0, 7, 0, 0],
      &quot;alloys&quot; : [0, 0, 70, 1, 0, 0, 31, 2, 0],
      &quot;firearms&quot; : [0, 0, 50, 1, 0, 29, 7, 0, 0],
      &quot;furs&quot; : [0, 0, 160, -9, 0, 0, 63, 0, 0],
      &quot;minerals&quot; : [0, 0, 16, -1, -1, 85, 3, 3, 0],
      &quot;gold&quot; : [0, 0, 73, -1, -1, 5, 7, 3, 1],
      &quot;platinum&quot; : [0, 0, 145, -2, -2, 6, 31, 7, 1],
      &quot;gem_stones&quot; : [0, 0, 25, -1, -1, 250, 15, 15, 2],
      &quot;alien_items&quot; : [0, 0, 140, 1, 0, 0, 3, 0, 0]
};

this.updateLocalCommodityDefinition = function(goodDefinition) {
	var commodity = goodDefinition.key;
	var oldDefs = this.$originalDefs[commodity];
	//old style definition found for the good. calculate it the old way
	if (oldDefs) {
		var market_base_price = oldDefs[2];
		var market_eco_adjust_price = oldDefs[3];
		var market_eco_adjust_quantity = oldDefs[4];
		var market_base_quantity = oldDefs[5];
		var market_mask_price = oldDefs[6];
		var market_mask_quantity = oldDefs[7];
		var market_rnd = Math.floor(Math.random() * 256);

		var economy = system.economy;

		var price = (market_base_price + (market_rnd &amp; market_mask_price) + (economy * market_eco_adjust_price)) &amp; 255;
		price *= 0.4;

		var quantity = (market_base_quantity + (market_rnd &amp; market_mask_quantity) - (economy * market_eco_adjust_quantity)) &amp; 255;
		if (quantity &gt; 127) quantity = 0;
		quantity &amp;= 63;

		goodDefinition.price = price * 10;
		goodDefinition.quantity = quantity;
	}
	//no definition found. nullify the goods.
	else {
		goodDefinition.price = 0;
		goodDefinition.quantity = 0;
	}
	return goodDefinition;
};
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
