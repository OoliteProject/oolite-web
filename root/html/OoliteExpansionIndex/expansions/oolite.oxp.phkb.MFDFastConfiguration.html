<html>
    <head>
        <title>Expansion MFD Fast Config</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion MFD Fast Config</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">2 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>http://wiki.alioth.net/index.php/MFD%20Fast%20Config -&gt; 404 Not Found</li>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN CAPITAL LETTER M)(&#39;[]&#39; vs &#39;[MFD, HUDS]&#39;)</li>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Primable equipment that allows different sets of MFD to be quickly set up and activated.</td>
                    <td>Primable equipment that allows different sets of MFD to be quickly set up and activated.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.phkb.MFDFastConfiguration</td>
                    <td>oolite.oxp.phkb.MFDFastConfiguration</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>MFD Fast Config</td>
                    <td>MFD Fast Config</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>HUDs</td>
                    <td>HUDs</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>phkb</td>
                    <td>phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.2</td>
                    <td>2.2</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>MFD, HUDS</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/6/67/MFDFastConfiguration.oxz">https://wiki.alioth.net/img_auth.php/6/67/MFDFastConfiguration.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873324</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        
        <h3>readme.txt</h3>
        <pre>MFD Fast Configuration
By Nick Rogers

This OXP aims to add flexibility and control to the layout of MFD displays. MFD&#39;s can be useful, but they also take up screen space and can be distracting in certain conditions. This OXP gives you the ability to define different MFD &quot;sets&quot;, which can then be quickly activated when required.

Installation and Operation
==========================
After purchasing the MFD Fast Configuration device, and launching your ship, you will be able to prime the device by using the &quot;Shift-N&quot; key sequence. Once it is primed, you can change the mode by pressing the &quot;B&quot; key, and activating the mode by pressing the &quot;N&quot; key.

The available modes are:

- Set current config as set 1                   This sets the current MFD layout as &quot;Set 1&quot;.
- Set current config as set 2                   This sets the current MFD layout as &quot;Set 2&quot;.
- Set current config as set 3                   This sets the current MFD layout as &quot;Set 3&quot;.
- Set current config as Condition Green set     This sets the current MFD layout as the set to apply 
                                                when the alert condition changes to &quot;Green&quot;.
- Set current config as Condition Yellow set	This sets the current MFD layout as the set to apply 
                                                when the alert condition changes to &quot;Yellow&quot;.
- Set current config as Condition Red set       This sets the current MFD layout as the set to apply 
                                                when the alert condition changes to &quot;Red&quot;.
- Set current config as docking set             This sets the current MFD launch as the set to apply 
                                                when the docking process has begun.
- Make set 1 default                            This makes &quot;Set 1&quot; the default set (which will be activated 
                                                when docking and launching).
- Make set 2 default                            This makes &quot;Set 2&quot; the default set (which will be activated 
                                                when docking and launching).
- Make set 3 default                            This makes &quot;Set 3&quot; the default set (which will be activated 
                                                when docking and launching).
- Make Condition Green set default              This makes the &quot;Condition Green&quot; set the default set (which 
                                                will be activated when docking and launching).
- Make Condition Yellow set default             This makes the &quot;Condition Yellow&quot; set the default set (which 
                                                will be activated when docking and launching).
- Make Condition Red set default                This makes the &quot;Condition Red&quot; set the default set (which 
                                                will be activated when docking and launching).
- Delete set 1                                  This deletes &quot;Set 1&quot;.
- Delete set 2                                  This deletes &quot;Set 2&quot;.
- Delete set 3                                  This deletes &quot;Set 3&quot;.
- Delete Condition Green set                    This deletes the &quot;Condition Green&quot;.
- Delete Condition Yellow set                   This deletes the &quot;Condition Yellow&quot;.
- Delete Condition Red set                      This deletes the &quot;Condition Red&quot;.
- Delete docking set                            This deletes the docking set.
- Hide all setting functions from this list     This will hide all the above modes, leaving only the ones below. 
                                                Do this once you have defined all your sets.
- Activate default set                          This will activate whatever set is the default.
- Activate set 1                                This will activate &quot;Set 1&quot;.
- Activate set 2                                This will activate &quot;Set 2&quot;.
- Activate set 3                                This will activate &quot;Set 3&quot;.
- Activate Condition Green set                  This will activate the &quot;Condition Green&quot; set.
- Activate Condition Yellow set                 This will activate the &quot;Condition Yellow&quot; set.
- Activate Condition Red set                    This will activate the &quot;Condition Red&quot; set.
- Activate docking set                          This will activate the docking set.
- Disable/Enable auto-update mode               This will turn off or on the auto-update mode.
- Restore all setting functions to this list    This will restore all the above modes.

Once you have defined all your different sets, it is recommended you activate the &quot;Hide all setting functions from this list&quot; option. This will reduce the number of modes to only the activation modes, allowing for a more streamlined operation.

Once a set has been defined and is selected, it will be automatically updated to the current configuration whenever the alert condition changes (if there is an alert condition to change to), or when the player docks with a station. This can be turned on or off through the control interface with the &quot;Disable/Enable auto-update mode&quot; option.

License
=======
This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/

Version History
===============
2.2
- Added console message acknowledgements for all activation actions.
- If equipment is not installed, no changes will now take place.
- If auto-update mode is off, and the player has made changes to any of the MFD slots, those changes will remain even when another condition set is loaded. The overrides will be in place until the next dock.
- More consistent condition labelling.
- Added a setup guide (txt and pdf versions).

2.1
- Added ability to turn on/off the auto-storing facility.
- Fixed bug when removing the unit.
- Code refactoring.

2.0
- Automatic storing of MFD configurations now available. If the player makes a change to the current MFD configuration while a set is selected, it will be automatically stored if the alert condition changes, or when the player docks with a station. No need to manually store updated configuration.
- Fixed script error that could occur when player ejects.
- Hiding of setting functions was not being applied until the menu had been cycled once.
- Better integration with Station Dock Control&#39;s Launch Queue MFD.
- Better integration with the Damage Report MFD and the Bounty System&#39;s Warrant Scanner.

1.2
- Fixed Javascript error that can occur when player ship is destroyed.
 
1.1
- Fixed issue where deleting sets would fail, because the function name had a spelling mistake in it.
- Fixed issue where attempting to update an existing set fails.
- Removing equipment will now reset all configuration items.
- Fixed spelling mistake in mode list.
- Better MFD handling if HUD Selector is not installed.
- Moved the &quot;Restore all setting functions to the list&quot; item to end of the list of modes.
- Code refactoring.

1.0
- Initial release
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_MFD_FAST_CONFIG.html">MFD Fast Configuration</a></td>
                    <td>yes</td>
                    <td align="right">6000</td>
                    <td align="center">3+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_MFD_FAST_CONFIG_REMOVAL.html">Remove MFD Fast Configuration</a></td>
                    <td>no</td>
                    <td align="right">200</td>
                    <td align="center">1+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/mfdfastconfiguration.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;MFDFastConfiguration&quot;;
this.author      = &quot;phkb&quot;;
this.copyright   = &quot;2016 phkb&quot;;
this.description = &quot;Primable equipment that allows different sets of MFD&#39;s to be quickly shown.&quot;;
this.licence     = &quot;CC BY-NC-SA 3.0&quot;;

// need to test without HUD Selector installed

this._sets = [];			// our data array of different MFD sets
this._startpoint = 0;		// starting point for the mode, which will either be 0 or the altstart point
this._curr_mode = -1;		// current mode of the primable equipment
this._altstart = 21;		// alternate starting point when &quot;Hide all setting functions&quot; is enabled
this._default = &quot;&quot;;			// default MFD set, to be activated when docking so HUD Selector picks up the right MFD&#39;s
this._hudSelectorInstalled = false;
this._currentMFDSet = [];
this._activeMode = true;
this._currentSetName = &quot;&quot;;
this._lastSetName = &quot;&quot;;
this._playerIsDocking = false;			// flag to indicate the player has requested docking clearance
this._dockTimer = null;					// timer used when docking to determine if the player has exceeded the alotted time
this._trueValues = [&quot;yes&quot;, &quot;1&quot;, 1, &quot;true&quot;, true];
this._changing = [];

// list of different modes
this._modes = [
	&quot;Set current config as set 1&quot;,
	&quot;Set current config as set 2&quot;,
	&quot;Set current config as set 3&quot;,
	&quot;Set current config as Condition Green set&quot;,
	&quot;Set current config as Condition Yellow set&quot;,
	&quot;Set current config as Condition Red set&quot;,
	&quot;Set current config as docking set&quot;,
	&quot;Make set 1 default&quot;,
	&quot;Make set 2 default&quot;,
	&quot;Make set 3 default&quot;,
	&quot;Make Condition Green set default&quot;,
	&quot;Make Condition Yellow set default&quot;,
	&quot;Make Condition Red set default&quot;,
	&quot;Delete set 1&quot;,
	&quot;Delete set 2&quot;,
	&quot;Delete set 3&quot;,
	&quot;Delete Condition Green set&quot;,
	&quot;Delete Condition Yellow set&quot;,
	&quot;Delete Condition Red set&quot;,
	&quot;Delete docking set&quot;,
	&quot;Hide all setting functions from this list&quot;,
	&quot;Activate default set&quot;,
	&quot;Activate set 1&quot;,
	&quot;Activate set 2&quot;,
	&quot;Activate set 3&quot;,
	&quot;Activate Condition Green set&quot;,
	&quot;Activate Condition Yellow set&quot;,
	&quot;Activate Condition Red set&quot;,
	&quot;Activate docking set&quot;,
	&quot;Disable auto-update mode&quot;,
	&quot;Restore all setting functions to this list&quot;
];

//-------------------------------------------------------------------------------------------------------------
this.activated = function() {

	var w = worldScripts.MFDFastConfiguration;

	switch (w._curr_mode) {
		case 0:
			w.$storeMFDSet(&quot;set1&quot;, false);
			w._currentSetName = &quot;set1&quot;;
			player.consoleMessage(&quot;Current config saved as set 1&quot;);
			break;
		case 1:
			w.$storeMFDSet(&quot;set2&quot;, false);
			w._currentSetName = &quot;set2&quot;;
			player.consoleMessage(&quot;Current config saved as set 2&quot;);
			break;
		case 2:
			w.$storeMFDSet(&quot;set3&quot;, false);
			w._currentSetName = &quot;set3&quot;;
			player.consoleMessage(&quot;Current config saved as set 3&quot;);
			break;
		case 3:
			w.$storeMFDSet(&quot;setGreen&quot;, false);
			w._currentSetName = &quot;setGreen&quot;;
			player.consoleMessage(&quot;Current config saved as Condition Green set&quot;);
			break;
		case 4:
			w.$storeMFDSet(&quot;setYellow&quot;, false);
			w._currentSetName = &quot;setYellow&quot;;
			player.consoleMessage(&quot;Current config saved as Condition Yellow set&quot;);
			break;
		case 5:
			w.$storeMFDSet(&quot;setRed&quot;, false);
			w._currentSetName = &quot;setRed&quot;;
			player.consoleMessage(&quot;Current config saved as Condition Red set&quot;);
			break;
		case 6:
			w.$storeMFDSet(&quot;setDocking&quot;, false);
			w._currentSetName = &quot;setDocking&quot;;
			player.consoleMessage(&quot;Current config saved as Docking set&quot;);
			break;
		case 7:
			w._default = &quot;set1&quot;;
			player.consoleMessage(&quot;Default now Set 1&quot;);
			break;
		case 8:
			w._default = &quot;set2&quot;;
			player.consoleMessage(&quot;Default now Set 2&quot;);
			break;
		case 9:
			w._default = &quot;set3&quot;;
			player.consoleMessage(&quot;Default now Set 3&quot;);
			break;
		case 10:
			w._default = &quot;setGreen&quot;;
			player.consoleMessage(&quot;Default now Condition Green Set&quot;);
			break;
		case 11:
			w._default = &quot;setYellow&quot;;
			player.consoleMessage(&quot;Default now Condition Yellow Set&quot;);
			break;
		case 12:
			w._default = &quot;setRed&quot;;
			player.consoleMessage(&quot;Default now Condition Red Set&quot;);
			break;
		case 13:
			w.$deleteMFDSet(&quot;set1&quot;);
			break;
		case 14:
			w.$deleteMFDSet(&quot;set2&quot;);
			break;
		case 15:
			w.$deleteMFDSet(&quot;set3&quot;);
			break;
		case 16:
			w.$deleteMFDSet(&quot;setGreen&quot;);
			break;
		case 17:
			w.$deleteMFDSet(&quot;setYellow&quot;);
			break;
		case 18:
			w.$deleteMFDSet(&quot;setRed&quot;);
			break;
		case 19:
			w.$deleteMFDSet(&quot;setDocking&quot;);
			break;
		case 20:
			w._startpoint = this._altstart;
			player.consoleMessage(&quot;Setting functions now hidden&quot;);
			break;
		case 21:
			if (w._default != &quot;&quot;) w.$restoreMFDSet(w._default, false);
			break;
		case 22:
			//this.$updateCurrentSet();
			w.$restoreMFDSet(&quot;set1&quot;, false);
			break;
		case 23:
			this.$updateCurrentSet();
			w.$restoreMFDSet(&quot;set2&quot;, false);
			break;
		case 24:
			this.$updateCurrentSet();
			w.$restoreMFDSet(&quot;set3&quot;, false);
			break;
		case 25:
			this.$updateCurrentSet();
			w.$restoreMFDSet(&quot;setGreen&quot;, false);
			break;
		case 26:
			this.$updateCurrentSet();
			w.$restoreMFDSet(&quot;setYellow&quot;, false);
			break;
		case 27:
			this.$updateCurrentSet();
			w.$restoreMFDSet(&quot;setRed&quot;, false);
			break;
		case 28:
			this.$updateCurrentSet();
			w.$restoreMFDSet(&quot;setDocking&quot;, false);
			break;
		case 29:
			w._activeMode = !w._activeMode;
			if (w._activeMode === true) {
				w._modes[29] = &quot;Disable auto-update mode&quot;;
				player.consoleMessage(&quot;Auto-update mode enabled&quot;);
			}
			if (w._activeMode === false) {
				w._modes[29] = &quot;Enable auto-update mode&quot;;
				player.consoleMessage(&quot;Auto-update mode disabled&quot;);
			}
			break;
		case 30:
			w._startpoint = 0;
			w._curr_mode = -1;
			player.consoleMessage(&quot;Setting functions restored&quot;);
			break;
	}
}

//-------------------------------------------------------------------------------------------------------------
this.mode = function() {
	var w = worldScripts.MFDFastConfiguration;
	w._curr_mode += 1;
	// skip the last one (restore functions) if they&#39;re in the list already.
	if (w._curr_mode == w._modes.length - 1 &amp;&amp; w._startpoint === 0) w._curr_mode += 1;
	if (w._curr_mode == w._modes.length) w._curr_mode = w._startpoint;
	// tell the player what mode they&#39;re in
	player.consoleMessage(w._modes[w._curr_mode]);
}

//-------------------------------------------------------------------------------------------------------------
this.$deleteMFDSet = function(setName) {
	// see if the set is stored
	var idx = this.$setNameIndex(setName);
	if (idx &gt;= 0) {
		// found it! delete it and notify the player
		this._sets.splice(idx, 1);
		player.consoleMessage(&quot;MFD set deleted&quot;);
	} else {
		// notify the player that the set wasn&#39;t there to be deleted
		player.consoleMessage(&quot;MFD set not found&quot;);
	}
	if (this._currentSetName === setName) this._currentSetName = &quot;&quot;;
}

//-------------------------------------------------------------------------------------------------------------
this.$storeMFDSet = function(setName, suppressMessages, autoSave) {

	var p = player.ship;
	var config = {};

	// put all the settings in a dictionary object
	if (p &amp;&amp; p.multiFunctionDisplayList) {
		for (var i = 0; i &lt; p.multiFunctionDisplayList.length; i++) {
			var noadd = false;
			if (autoSave === true) {
				// these two MFDs autohide themselves, so don&#39;t add them to the config
				if (p.multiFunctionDisplayList[i] === &quot;DamageReportMFD&quot; &amp;&amp; worldScripts.DamageReportMFD &amp;&amp; worldScripts.DamageReportMFD._mode === 1) noadd = true;
				if (p.multiFunctionDisplayList[i] === &quot;BountySystem_WarrantScanner&quot; &amp;&amp; worldScripts.BountySystem_WarrantScanner) noadd = true;
			}
			if (noadd === false) config[&quot;MFD_&quot; + (i &lt; 10 ? &quot;0&quot; : &quot;&quot;) + i] = p.multiFunctionDisplayList[i];
		}
	}

	// see if this set is already stored (meaning we&#39;re doing an update)
	var idx = this.$setNameIndex(setName);
	if (idx &gt;= 0) {
		// ok, found it! reset the data here
		this._sets[idx].data = JSON.stringify(config);
	} else {
		// this must be a new one, so store a new set
		this._sets.push({name:setName, data:JSON.stringify(config)});
	}
	// notify the player
	if (suppressMessages == false) player.consoleMessage(&quot;MFD set stored&quot;);
}

//-------------------------------------------------------------------------------------------------------------
this.$restoreMFDSet = function(setName, suppressMessages) {

	var config = {};

	// see if we&#39;ve got this set stored
	var idx = this.$setNameIndex(setName);
	if (idx &gt;= 0) {
		config = JSON.parse(this._sets[idx].data);
	} else {
		// report back if not
		if (suppressMessages == false) {
			player.consoleMessage(&quot;Selected MFD set not defined&quot;);
		}
		return;
	}

	// restore the set
	var p = player.ship;
	if (p &amp;&amp; p.isValid &amp;&amp; p.multiFunctionDisplayList) {
		// check for the autohiding SDC MFD
		var bSDC = false;
		if (worldScripts.StationDockControl_MFD) {
			if (worldScripts.StationDockControl_MFD._mfdID &gt;= 0) {
				bSDC = true;
				worldScripts.StationDockControl_MFD._mfdID = -1;
			}
		}
		for (var i = 0; i &lt; p.multiFunctionDisplayList.length; i++) {
			var itm = config[&quot;MFD_&quot; + (i &lt; 10 ? &quot;0&quot; : &quot;&quot;) + i];
			try {
				p.setMultiFunctionDisplay(i, itm);
				if (itm === &quot;LaunchQueueMFD&quot; &amp;&amp; bSDC === true) {
					log(this.name, &quot;setting SDC &quot; + i);
					worldScripts.StationDockControl_MFD._mfdID = i;
				}
			}
			catch (err) {
				log(this.name, &quot;!!ERROR: Unable to set MFD &quot; + (i + 1) + &quot; to &quot; + itm);
			}
		}

		// notify the player
		if (suppressMessages == false) {
			player.consoleMessage(&quot;MFD set activated&quot;);
		}
		this._currentSetName = setName;

		// if the player has made changes outside of active mode, make sure they stay
		// only applies to automatic changes based on condition
		if (this._activeMode === false) {
			for (var i = 0; i &lt; this._changing.length; i++) {
				if (this._changing[i] != &quot;&quot; &amp;&amp; this._changing[i] != undefined) {
					p.setMultiFunctionDisplay(i, this._changing[i]);
				}
			}
		}
	}
	p = null;
}

//-------------------------------------------------------------------------------------------------------------
this.$setNameIndex = function(setName) {
	for (var i = 0; i &lt; this._sets.length; i++) {
		if (this._sets[i].name == setName) return i;
	}
	return -1;
}

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function() {
	if (missionVariables.MFDFastConfig_Data) {
		this._sets = JSON.parse(missionVariables.MFDFastConfig_Data);
		delete missionVariables.MFDFastConfig_Data;
	}
	if (missionVariables.MFDFastConfig_Default) {
		this._default = missionVariables.MFDFastConfig_Default;
		delete missionVariables.MFDFastConfig_Default;
	}
	if (missionVariables.MFDFastConfig_HideSettings) {
		if (missionVariables.MFDFastConfig_HideSettings == false) {
			this._startpoint = 0;
		} else {
			this._startpoint = this._altstart;
			this._curr_mode = this._startpoint;
		}
		delete missionVariables.MFDFastConfig_HideSettings;
	}
	if (missionVariables.MFDFastConfig_AutoUpdate) {
		this._activeMode = (this._trueValues.indexOf(missionVariables.MFDFastConfig_AutoUpdate) === -1 ? false : true);
		if (this._activeMode === true) this._modes[29] = &quot;Disable auto-update mode&quot;;
		if (this._activeMode === false) this._modes[29] = &quot;Enable auto-update mode&quot;;
	}
	if (worldScripts.hudselector) this._hudSelectorInstalled = true;
}

//-------------------------------------------------------------------------------------------------------------
this.alertConditionChanged = function(newCondition, oldCondition) {
	if (player.ship.equipmentStatus(&quot;EQ_MFD_FAST_CONFIG&quot;) != &quot;EQUIPMENT_OK&quot;) return;
	// note: I&#39;m spoofing an alert condition of &quot;4&quot;, meaning &quot;player is docking&quot;
	if (newCondition === 0) return;
	var idx = 0;
	var idxGr = this.$setNameIndex(&quot;setGreen&quot;);
	var idxYw = this.$setNameIndex(&quot;setYellow&quot;);
	var idxRd = this.$setNameIndex(&quot;setRed&quot;);
	var idxDk = this.$setNameIndex(&quot;setDocking&quot;);
	if ([&quot;set1&quot;,&quot;set2&quot;,&quot;set3&quot;,&quot;setGreen&quot;,&quot;setYellow&quot;,&quot;setRed&quot;,&quot;setDocking&quot;].indexOf(this._currentSetName) &gt;= 0) {
		this._lastSetName = this._currentSetName;
	}
	// auto store the old state before we switch to any alert-condition set (if there are any)
	// but only if we have an alert condition set to switch to
	if (this._activeMode === true &amp;&amp; ((newCondition === 1 &amp;&amp; idxGr &gt;= 0) || (newCondition === 2 &amp;&amp; idxYw &gt;= 0) || (newCondition === 3 &amp;&amp; idxRd &gt;= 0) || (newCondition === 4 &amp;&amp; idxDk &gt;= 0))) {
		this.$updateCurrentSet();
	}
	if (newCondition === 1) {
		if (idxGr &gt;= 0) this.$restoreMFDSet(&quot;setGreen&quot;, false);
	}
	if (newCondition === 2) {
		if (idxYw &gt;= 0) this.$restoreMFDSet(&quot;setYellow&quot;, false);
	}
	if (newCondition === 3) {
		if (idxRd &gt;= 0) this.$restoreMFDSet(&quot;setRed&quot;, false);
	}
	if (newCondition === 4) {
		if (idxDk &gt;= 0) this.$restoreMFDSet(&quot;setDocking&quot;, false);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$updateCurrentSet = function() {
	// auto store the old state before we switch to any alert-condition set (if there are any)
	if (this._activeMode === true) {
		// check for currently active set and update 
		if ([&quot;set1&quot;,&quot;set2&quot;,&quot;set3&quot;,&quot;setGreen&quot;,&quot;setYellow&quot;,&quot;setRed&quot;,&quot;setDocking&quot;].indexOf(this._currentSetName) &gt;= 0) {
			var idx = this.$setNameIndex(this._currentSetName);
			if (idx &gt;= 0) this.$storeMFDSet(this._currentSetName, true, true);
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
this.playerWillSaveGame = function() {
	// store all our data
	if (this._sets.length &gt; 0) {
		missionVariables.MFDFastConfig_Data = JSON.stringify(this._sets);
	}
	missionVariables.MFDFastConfig_Default = this._default;
	if (this._startpoint != 0) {
		missionVariables.MFDFastConfig_HideSettings = true;
	} else {
		missionVariables.MFDFastConfig_HideSettings = false;
	}
	missionVariables.MFDFastConfig_AutoUpdate = this._activeMode;
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillDockWithStation = function(station) {
	if (player.ship.equipmentStatus(&quot;EQ_MFD_FAST_CONFIG&quot;) != &quot;EQUIPMENT_OK&quot;) return;
	// auto store the old state before we switch to any alert-condition set (if there are any)
	this.$updateCurrentSet();
	this._changing.length = 0;

	// if we have a docking set, and there&#39;s a previous set in play, and we don&#39;t have a default 
	// switch to the previous set we had so it can be made the default
	// this is to avoid having the docking set pulled up on launch
	if (this._currentSetName === &quot;setDocking&quot; &amp;&amp; this._lastSetName !== &quot;&quot; &amp;&amp; this._default === &quot;&quot;) {
		this.$restoreMFDSet(this._lastSetName, false);
	}

	if (this._hudSelectorInstalled == false &amp;&amp; this._default == &quot;&quot;) {
		// save the current config so we can put it back on launch
		this.$storeMFDSet(&quot;current&quot;, true, true);
	} 
	if (this._default !== &quot;&quot;) {
		// restore the default so HUD Selector picks up the correct MFD&#39;s
		this.$restoreMFDSet(this._default, true);
	}
	this.$stopTimers();
}

//-------------------------------------------------------------------------------------------------------------
this.shipLaunchedFromStation = function(station) {
	if (player.ship.equipmentStatus(&quot;EQ_MFD_FAST_CONFIG&quot;) != &quot;EQUIPMENT_OK&quot;) return;
	this._playerIsDocking = false;
	// if HUD selector isn&#39;t installed, lets restore either the default set (if defined) or what we had when we docked.
	// if HUD selector is installed, it will handle restoring the MFD config for us.
	if (this._hudSelectorInstalled == false) {
		if (this._default != &quot;&quot;) {
			// restore the default MFD set
			this.$restoreMFDSet(this._default, true);
		} else {
			this.$restoreMFDSet(&quot;current&quot;, true);
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
this.playerBoughtEquipment = function(equipmentKey) {
	if (equipmentKey == &quot;EQ_MFD_FAST_CONFIG_REMOVAL&quot;) {
		// give the player their money back
		player.credits += 600;
		var p = player.ship;
		p.removeEquipment(equipmentKey);
		p.removeEquipment(&quot;EQ_MFD_FAST_CONFIG&quot;);
		this._sets = [];
		this._default = &quot;&quot;;
		this.startpoint = 0;
		player.consoleMessage(&quot;MFD Fast Configuration device removed.&quot;);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.mfdKeyChanged = function(index, key) {
	if (player.ship.equipmentStatus(&quot;EQ_MFD_FAST_CONFIG&quot;) != &quot;EQUIPMENT_OK&quot;) return;
	// are we in auto mode? don&#39;t do anything if we are
	if (this._activeMode === true) return;
	// if not, make a note of what we&#39;re changing
	if (this._changing.length === 0) this._changing = new Array(player.ship.multiFunctionDisplayList.length);
	this._changing[index] = player.ship.multiFunctionDisplayList[index];
}

//-------------------------------------------------------------------------------------------------------------
this.shipDied = function(whom, why) {
	this.$stopTimers();
}

//-------------------------------------------------------------------------------------------------------------
this.playerRequestedDockingClearance = function(message) {
	if (player.ship.equipmentStatus(&quot;EQ_MFD_FAST_CONFIG&quot;) != &quot;EQUIPMENT_OK&quot;) return;
	if (message === &quot;DOCKING_CLEARANCE_GRANTED&quot; || message === &quot;DOCKING_CLEARANCE_EXTENDED&quot; || message === &quot;DOCKING_CLEARANCE_DENIED_TRAFFIC_INBOUND&quot; || message === &quot;DOCKING_CLEARANCE_DENIED_TRAFFIC_OUTBOUND&quot;) {
		this._playerIsDocking = true;
		this.alertConditionChanged(4, player.alertCondition);
		if (message === &quot;DOCKING_CLEARANCE_GRANTED&quot; || message === &quot;DOCKING_CLEARANCE_EXTENDED&quot;) {
			// start a timer so we can track when the clearance expires
			if (this._dockTimer &amp;&amp; this._dockTimer.isRunning) this._dockTimer.stop();
			this._dockTimer = new Timer(this, this.$dockingExpired, 121, 0);
		}
	} else {
		this.alertConditionChanged(player.alertCondition, 4);
		this._playerIsDocking = false;
		if (this._dockTimer &amp;&amp; this._dockTimer.isRunning) this._dockTimer.stop();
	}
}

//-------------------------------------------------------------------------------------------------------------
this.playerDockingClearanceCancelled = function() {
	if (player.ship.equipmentStatus(&quot;EQ_MFD_FAST_CONFIG&quot;) != &quot;EQUIPMENT_OK&quot;) return;
	this.alertConditionChanged(player.alertCondition, 4);
	this._playerIsDocking = false;
	if (this._dockTimer &amp;&amp; this._dockTimer.isRunning) this._dockTimer.stop();
}

//-------------------------------------------------------------------------------------------------------------
// stops the dock timer
this.$stopTimers = function() {
	// stop the dock timer check timer if it&#39;s running
	if (this._dockTimer &amp;&amp; this._dockTimer.isRunning) this._dockTimer.stop();
}

//-------------------------------------------------------------------------------------------------------------
// checks for an expired docking request
this.$dockingExpired = function $dockingExpired() {
	if (this._playerIsDocking === true) {
		this.alertConditionChanged(player.alertCondition, 4);
		this._playerIsDocking = false;
	}
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
