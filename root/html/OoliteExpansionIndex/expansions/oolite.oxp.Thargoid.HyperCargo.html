<html>
    <head>
        <title>Expansion HyperCargo</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion HyperCargo</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">2 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER E)(&#39;[]&#39; vs &#39;[equipment]&#39;)</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Extended cargo handling system.</td>
                    <td>Extended cargo handling system.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.HyperCargo</td>
                    <td>oolite.oxp.Thargoid.HyperCargo</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>HyperCargo</td>
                    <td>HyperCargo</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.11</td>
                    <td>1.11</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>equipment</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/HyperCargo_OXP">http://wiki.alioth.net/index.php/HyperCargo_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/1/1b/HyperCargo_1.11.oxz">https://wiki.alioth.net/img_auth.php/1/1b/HyperCargo_1.11.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873243</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/HyperCargo'>http://wiki.alioth.net/index.php/HyperCargo</a></p>
        <h3>HyperCargo v1.11 ReadMe &amp; License.txt</h3>
        <pre>HyperCargo OXP by Thargoid.

The Ships Systems Department of the Aquarian Shipbuilding Corporation introduce their latest development - the HyperCargo system. This is a modernised and updated version of the cargo compression system famously used on larger ships like the Anaconda, now available for any ship (although fitting it to one without a cargo hold is fairly pointless).

Once fitted, it can be accessed by going to the manifest screen (F5 when docked, or F5-F5 when in flight) and then selecting the normal market screen (F8) from there. 

Alternatively (and only for Oolite v1.77 and above) it can be activated via the ship/station interface screen (F4) when docked. For stations with the Commodities Market upgrade, the F5-F8 route is de-activated and only the route via the interface screen can be used to reach the Hypercargo system.

This will allow hold-space cargo to be loaded into the system, and unloaded again back to the normal cargo bay (if sufficient space is available). Whilst running the system continually draws a small amount of energy from the ship, so the recharging of other systems such as shields may be affected.

The system is reliable, although on rare occasions it has been known that cargo stored in it can be lost if a malfunction occurs during unloading or during a witchspace jump. Also should the system become damaged, the stored cargo is invariably lost as the witchspace bubble in which it is stored collapses. It is an &quot;all or nothing&quot; system - the whole of the content of the cargo hold must be stored at once, and it is not possible to restore only part of a stored cargo manifest. As they are stored separately in the ship safe, valuables such as gold, platinum and gem stones are not affected by the HyperCargo system.

The maximum volume of cargo that can be stored depends on the size of the cargo hold of the ship to which the system is fitted, as it must be used as a staging post for loading and unloading the system. Also such cargo is non-transferrable between ships, and is not covered by escape pod insurance policies (as with normal cargo).

Also it should be noted that GalCop have insisted that all HyperCargo systems are scannable by them for illegal merchandise. Anyone caught leaving a GalCop station with illegal material stored in their HyperCargo system will be subject to the same penalties as if the items were stored in their regular cargo hold. It has been rumoured however that on occasions a software hack is available via the underworld on some of the higher-tech but less law abiding worlds which can mask this. Such modifications are deemed illegal by GalCop, and tend to make the systems run less reliably and malfunction more.

Requires v1.74 or later of Oolite. It will not run on older versions.

--------------------------------------------------------------

License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement. Basically if it&#39;s unique or would identify or overwrite anything in the original OXP, then you may not re-use it (for obvious compatibility reasons).
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* The license information (either as this file or merged into a larger one) must be included in the OXP.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)

--------------------------------------------------------------

Instructions:

Unzip the file, and then move the folder &quot;HyperCargo 1.10.oxp&quot; to the AddOns directory of your Oolite installation. Then start the game up and the ships should be added. 

--------------------------------------------------------------

Version history:

30/08/2010 - Version 1.00, initial release.
03/09/2010 - Version 1.01, added machinery to the list (oops!). Also added chance of failure on witchspace jumps.
05/09/2010 - Version 1.02, tweaked script to make firearms illegal rather than alloys.
13/02/2011 - Version 1.03, removal of upper limit, to allow running with 1.75
19/02/2011 - Version 1.04, script tweak to change Manifest[&quot;&quot;] to manifest[&quot;&quot;].
13/04/2012 - Version 1.05, update for compatibility with cim&#39;s New Cargoes OXP.
14/04/2012 - Version 1.06, minor script tweak to remove problem with NC start-up if HyperCargo is empty.
22/04/2012 - Version 1.07, update for permits in New Cargoes.
16/05/2012 - Version 1.08, adjustments ready for Oolite 1.77 to cope with equipment taking up cargo space.
25/05/2012 - Version 1.09, removal of a script bug causing special cargo duplication on launch.
25/11/2012 - Version 1.10, added access route via docked Interface (F4) screen to allow for clash with Commodities Marketplace OXP for Oolite 1.77
09/02/2020 - Version 1.11, commodity names for Liquor/Wines and Alien Items (that did&#39;t match the ones used in Manifest) corrected, some log messages added
--------------------------------------------------------------

Acknowledgements:

With thanks to Switeck for pointing out the machinery bug, and Okti for the manifest one!

And thanks to cim for preparing the APIs to allow making this OXP compatible with his so simple (and for the commodities calculation code), and Capt Murphy for the bug-report for v1.05/6 and for v1.09 (he&#39;s getting almost as good at spotting bugs in this OXP as I seem to be at writing them...).
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HYPERCARGO.html">HyperCargo System</a></td>
                    <td>yes</td>
                    <td align="right">120000</td>
                    <td align="center">13+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_HYPERCARGO_HACK.html">HyperCargo System Illicit Hack</a></td>
                    <td>yes</td>
                    <td align="right">60000</td>
                    <td align="center">9+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. This may be related to warnings.
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>this.name				= &quot;HyperCargo&quot;;
this.author				= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Cargo space compression&quot;;
this.version				= &quot;1.11&quot;;

this.startUp = function()
	{
	this.cargoNameArray = [&quot;food&quot;, &quot;textiles&quot;, &quot;radioactives&quot;, &quot;slaves&quot;, &quot;liquor_wines&quot;, &quot;luxuries&quot;, &quot;narcotics&quot;, &quot;computers&quot;, &quot;machinery&quot;, &quot;alloys&quot;, &quot;firearms&quot;, &quot;furs&quot;, &quot;minerals&quot;, &quot;alien_items&quot;];
	this.cargoDisplayNameArray = [&quot;Food&quot;, &quot;Textiles&quot;, &quot;Radioactives&quot;, &quot;Slaves&quot;, &quot;Liquor/Wines&quot;, &quot;Luxuries&quot;, &quot;Narcotics&quot;, &quot;Computers&quot;, &quot;Machinery&quot;, &quot;Alloys&quot;, &quot;Firearms&quot;, &quot;Furs&quot;, &quot;Minerals&quot;, &quot;Alien Items&quot;];
	this.storedArray = [0,0,0,0,0,0,0,0,0,0,0,0,0,0]; // the array of stored cargo amounts (don&#39;t store gold, platinum or gems)
	this.defaultCommodities = [         
		[ &quot;Food&quot;, 0, 0, 19, -2, -2, 6, 1, 1, 0 ],
		[ &quot;Textiles&quot;, 0, 0, 20, -1, -1, 10, 3, 3, 0 ],
		[ &quot;Radioactives&quot;, 0, 0, 65, -3, -3, 2, 7, 7, 0 ],
		[ &quot;Slaves&quot;, 0, 0, 40, -5, -5, 226, 31, 31, 0 ],
		[ &quot;Liquor/Wines&quot;, 0, 0, 83, -5, -5, 251, 15, 15, 0 ],
		[ &quot;Luxuries&quot;, 0, 0, 196, 8, 8, 54, 3, 3, 0 ],
		[ &quot;Narcotics&quot;, 0, 0, 235, 29, 29, 8, 120, 120, 0 ],
		[ &quot;Computers&quot;, 0, 0, 154, 14, 14, 56, 3, 3, 0 ],
		[ &quot;Machinery&quot;, 0, 0, 117, 6, 6, 40, 7, 7, 0 ],
		[ &quot;Alloys&quot;, 0, 0, 78, 1, 1, 17, 31, 31, 0 ],
		[ &quot;Firearms&quot;, 0, 0, 124, 13, 13, 29, 7, 7, 0 ],
		[ &quot;Furs&quot;, 0, 0, 176, -9, -9, 220, 63, 63, 0 ],
		[ &quot;Minerals&quot;, 0, 0, 32, -1, -1, 53, 3, 3, 0 ],
		[ &quot;Alien Items&quot;, 0, 0, 53, 15, 0, 0, 7, 0, 0 ]
	];
	this.warningSound = new SoundSource; 
	this.warningSound.sound = &quot;warning.ogg&quot;;
	this.warningSound.loop = false;
	
	this.shipDockedWithStation();
	
	if(!missionVariables.hyperCargoFailChance) {missionVariables.hyperCargoFailChance = 0.01;}

	this.ncCheckTimer = new Timer(this, this.checkNCVersion, 1); // check the existence and version of cim&#39;s New Cargoes OXP - 1s delay to ensure scripts are loaded if present.
	
	if(!missionVariables.hyperCargoMemory || missionVariables.hyperCargoMemory == &quot;EMPTY&quot;) 
		{ // if this is the first run of the OXP, or if there is nothing in storage from the last save game we don&#39;t need to restore anything
		log(this.name, &quot;HyperCargo System empty&quot;);
		missionVariables.hyperCargoMemory = &quot;EMPTY&quot;; 
		return;
		}
		
	this.storedArray = missionVariables.hyperCargoMemory.split(&quot;:&quot;);

	let setupCounter = 0 ; // reset the counter
	for(setupCounter = 0;setupCounter&lt;14;setupCounter++)
		{
		log(this.name, &quot;HyperCargo has &quot; + this.storedArray[setupCounter] + &quot;t of &quot; + this.cargoNameArray[setupCounter]);
		this.storedArray[setupCounter] *= 1;  // to swap value from string to number 	
		}
	}

this.checkNCVersion = function()
	{
	this.ncEnabled = false;
	if(!worldScripts.CargoTypeExtension) { return; }
	
	if(!worldScripts.CargoTypeExtension.mergePlayerManifest)
		{
		mission.runScreen({title:&quot;New Cargoes OXP Update Needed&quot;, messageKey:&quot;hyperCargo_updateNC&quot;});
		return; 
		}

	this.ncEnabled = true;
	if(!missionVariables.hyperCargoNewCargoes)
		{ missionVariables.hyperCargoNewCargoes = &quot;&quot;; }
			
	}
	
this.unloadCargo = function(suppress)
	{
	if(missionVariables.hyperCargoMemory == &quot;EMPTY&quot;)
		{
		player.consoleMessage(&quot;HyperCargo is empty&quot;, 4);
		return;
		}
	
	if(!suppress &amp;&amp; Math.random() &lt; missionVariables.hyperCargoFailChance)
		{
		player.ship.setEquipmentStatus(&quot;EQ_HYPERCARGO&quot;, &quot;EQUIPMENT_DAMAGED&quot;);
		return;
		}

	let cargoCounter = 0 ; // reset the counter
	for(cargoCounter = 0;cargoCounter&lt;14;cargoCounter++)
		{
		this.cargoItem = this.cargoNameArray[cargoCounter];
		log(this.name, &quot;unloading &quot;+String(this.storedArray[cargoCounter]) + &quot;t of &quot; + this.cargoItem);
		manifest[this.cargoItem] += this.storedArray[cargoCounter];
		this.storedArray[cargoCounter] = 0;
		}	

	if(this.ncEnabled &amp;&amp; missionVariables.hyperCargoNewCargoes)
		{ 
		worldScripts.CargoTypeExtension.mergePlayerManifest(missionVariables.hyperCargoNewCargoes);
		missionVariables.hyperCargoNewCargoes = null;		
		}
			
	this.stopTimer();
	if (!suppress) { player.consoleMessage(&quot;Cargo unloaded from HyperCargo&quot;, 4); }
	missionVariables.hyperCargoMemory = &quot;EMPTY&quot;;
	}
	
this.transferCargo = function()
	{
	this.subTotal = -50;
	let cargoCounter = 0 ; // reset the counter
	for(cargoCounter = 0;cargoCounter&lt;14;cargoCounter++)
		{
		var commodity = this.defaultCommodities[cargoCounter];
		var price = Math.floor(((commodity[3]+(Math.floor(256*system.scrambledPseudoRandomNumber(23))&amp;commodity[7])+(system.economy*commodity[4]))&amp;255) * 0.4);
		this.cargoItem = this.cargoNameArray[cargoCounter];
		this.subTotal += this.storedArray[cargoCounter] * price; 
		log(this.name, &quot;Transfering &quot;+ String(this.storedArray[cargoCounter]) + &quot;t of &quot; + this.cargoItem + &quot;for Cr&quot; + String(this.storedArray[cargoCounter] * price));
		this.storedArray[cargoCounter] = 0;		
		}	
	
	missionVariables.hyperCargoMemory = &quot;EMPTY&quot;;	
	this.stopTimer();	
	if(this.ncEnabled &amp;&amp; missionVariables.hyperCargoNewCargoes)
		{ missionVariables.hyperCargoNewCargoes	= null; }

	if((player.credits + this.subTotal) &lt; 0)
		{
		player.credits = 0;
		mission.runScreen({title:&quot;HyperCargo Transfer&quot;});
		mission.addMessageText(&quot;\nYour cargo transfer is completed.\n\nHowever even with the payment, your funds do not cover the 50₢ fee and the cargo master is not happy. In lieu of full payment, you are set to work cleaning up the trading floor and shifting the empty cargo pods.&quot;);
		clock.addSeconds(Math.random() * 86400);
		}
	else
		{
		player.credits = player.credits + this.subTotal;
		mission.runScreen({title:&quot;HyperCargo Transfer&quot;});
		mission.addMessageText(&quot;\nYour cargo transfer is completed.\n\nYour HyperCargo system has been emptied into the station market storage system, in return for a payment of &quot; + this.subTotal + &quot;₢ including fees and charges.&quot;);
		}
	}

	
this.loadCargo = function(suppress)
	{
	if(missionVariables.hyperCargoMemory != &quot;EMPTY&quot;)
		{
		player.consoleMessage(&quot;HyperCargo is already in use&quot;, 4);
		return;
		}
		
	missionVariables.hyperCargoMemory = &quot;&quot;;
	let loadCounter = 0 ; // reset the counter
	for(loadCounter = 0;loadCounter&lt;14;loadCounter++)
		{
		this.cargoItem = this.cargoNameArray[loadCounter];
		this.storedArray[loadCounter] = manifest[this.cargoItem];
		log(this.name, &quot;Loading &quot;+ String(manifest[this.cargoItem]) + &quot;t of &quot; + this.cargoItem);
		missionVariables.hyperCargoMemory = missionVariables.hyperCargoMemory + manifest[this.cargoItem] + &quot;:&quot;;
		manifest[this.cargoItem] = 0;
		}	

	if(this.ncEnabled)
		{ missionVariables.hyperCargoNewCargoes = worldScripts.CargoTypeExtension.suspendPlayerManifest(); }
		
	this.startTimer();
	if(!suppress) { player.consoleMessage(&quot;Cargo loaded to HyperCargo&quot;, 4); }
	}

this.guiScreenChanged = function(to, from)
	{
	if(to != &quot;GUI_SCREEN_MARKET&quot; || from != &quot;GUI_SCREEN_MANIFEST&quot; || player.ship.equipmentStatus(&quot;EQ_HYPERCARGO&quot;) != &quot;EQUIPMENT_OK&quot;)
		{ // access only from manifest to market if we have the equipment installed
		return;
		} 
	this.activateHC();	
	}

this.activateHC = function()	
	{
	if(missionVariables.hyperCargoMemory == &quot;EMPTY&quot;)
		{
		this.goldTons = Math.ceil((manifest[&quot;gold&quot;] - 499) / 1000);
		if(this.goldTons &lt; 0) {this.goldTons = 0;};

		this.platinumTons = Math.ceil((manifest[&quot;platinum&quot;] - 499) / 1000);
		if(this.platinumTons &lt; 0) {this.platinumTons = 0;};

		this.gemsTons = Math.ceil((manifest[&quot;gemStones&quot;] - 499999) / 1000000);
		if(this.gemsTons &lt; 0) {this.gemsTons = 0;};

		if(player.ship.cargoSpaceUsed - (this.goldTons + this.platinumTons + this.gemsTons) == 0)
			{ mission.runScreen({title:&quot;HyperCargo Readout&quot;, messageKey:&quot;hyperCargo_emptyNoLoad&quot;}); }
		else
			{ mission.runScreen({title:&quot;HyperCargo Readout&quot;, messageKey:&quot;hyperCargo_emptyLoad&quot;, choicesKey:&quot;hyperCargo_loadChoice&quot;}, this.choice); }
		return;
		}
	else
		{
		this.totalCargo = 0
		let unloadCounter = 0 ; // reset the counter
		for(unloadCounter = 0;unloadCounter&lt;14;unloadCounter++)
			{ this.totalCargo += this.storedArray[unloadCounter]; }
		
		if(this.totalCargo &gt; player.ship.cargoSpaceCapacity)
			{
			if(player.ship.docked &amp;&amp; player.ship.dockedStation.isMainStation)
				{
				mission.runScreen({title:&quot;HyperCargo Readout&quot;,choicesKey:&quot;hyperCargo_transferChoice&quot;}, this.choice);
				this.addList();
				mission.addMessageText(&quot;\nYour cargo hold is no longer large enough to deactivate the system.\nFor a fee of 50₢ the station market can accept and sell the load.\nDo you wish to proceed?&quot;);
				}
			else
				{
				mission.runScreen({title:&quot;HyperCargo Readout&quot;, messageKey:&quot;hyperCargo_unloadHeader&quot;});
				this.addList();
				mission.addMessageText(&quot;\nYour cargo hold is no longer large enough to deactivate the system.\nPlease visit the system main station for cargo sales assistance.&quot;);
				}
			return;	
			}						
			
		if(this.totalCargo &gt; player.ship.cargoSpaceAvailable)
			{
			mission.runScreen({title:&quot;HyperCargo Readout&quot;, messageKey:&quot;hyperCargo_unloadHeader&quot;});
			this.addList();
			mission.addMessageText(&quot;\nAt present your cargo hold has insufficient space to deactivate the system.&quot;);
			return;
			}						
		else
			{
			mission.runScreen({title:&quot;HyperCargo Readout&quot;, messageKey:&quot;hyperCargo_unloadHeader&quot;,choicesKey:&quot;hyperCargo_unloadChoice&quot;}, this.choice);
			this.addList();
			mission.addMessageText(&quot;\nDo you wish to deactivate the system?&quot;);
			return;
			}
		}
	}
	
this.addList = function()
	{
	let listCounter = 0 ; // reset the counter
	for(listCounter = 0;listCounter&lt;14;listCounter++)
		{
		this.cargoItem = this.cargoDisplayNameArray[listCounter];
		this.cargoAmount = this.storedArray[listCounter];
		this.messageText = this.cargoItem + &quot; : &quot; + this.cargoAmount + &quot;t.&quot;;
		mission.addMessageText(this.messageText);
		}
	}
	
this.choice = function(choice)
	{
	switch(choice)
		{
		case &quot;HYPERCARGO_1_LOAD_ACCEPT&quot;:
			{
			this.loadCargo(false);
			break;
			}
		case &quot;HYPERCARGO_1_UNLOAD_ACCEPT&quot;:
			{
			this.unloadCargo(false);
			break;
			}	
		case &quot;HYPERCARGO_1_TRANSFER_ACCEPT&quot;:
			{
			this.transferCargo();
			break;
			}
		}
	}
	
this.shipExitedWitchspace = function()
	{
	if(player.ship.equipmentStatus(&quot;EQ_HYPERCARGO&quot;) == &quot;EQUIPMENT_OK&quot; &amp;&amp; (Math.random() &lt; missionVariables.hyperCargoFailChance))
		{
		player.ship.setEquipmentStatus(&quot;EQ_HYPERCARGO&quot;, &quot;EQUIPMENT_DAMAGED&quot;);
		return;
		}
	}
	
this.equipmentDamaged = function(equipment)
	{
	if(equipment == &quot;EQ_HYPERCARGO&quot;)
		{
		if(missionVariables.hyperCargoMemory == &quot;EMPTY&quot;)
			{ player.consoleMessage(&quot;HyperCargo system malfunction detected&quot;, 6); }
		else
			{ player.consoleMessage(&quot;HyperCargo malfunction - stored cargo has been lost!&quot;, 6); }
		this.warningSound.play();
		this.resetCargo();	
		}
	}
	
this.playerBoughtNewShip = this.shipLaunchedEscapePod = this.resetCargo = function()
	{
	this.checkNCVersion();
	this.stopTimer();
	this.storedArray = [0,0,0,0,0,0,0,0,0,0,0,0,0,0];
	missionVariables.hyperCargoMemory = &quot;EMPTY&quot;;
	missionVariables.hyperCargoFailChance = 0.01;
	
	if(this.ncEnabled)
		{ 	missionVariables.hyperCargoNewCargoes = &quot;&quot;; }
	}

this.playerBoughtEquipment = function(equipment)
	{
	switch(equipment)
		{
		case &quot;EQ_HYPERCARGO&quot;:
			{
			this.resetCargo();
			break;
			}
		case &quot;EQ_HYPERCARGO_HACK&quot;:
			{
			missionVariables.hyperCargoFailChance = 0.05;
			player.ship.removeEquipment(&quot;EQ_HYPERCARGO_HACK&quot;);
			break;
			}
		}
	}
	
this.shipLaunchedFromStation = function(station)
	{
	if(player.ship.equipmentStatus(&quot;EQ_HYPERCARGO&quot;) == &quot;EQUIPMENT_OK&quot; &amp;&amp; missionVariables.hyperCargoMemory != &quot;EMPTY&quot;)
		{	
		this.startTimer();
		if(missionVariables.hyperCargoFailChance == 0.01 &amp;&amp; station.isMainStation)
			{ 
			if(this.ncEnabled)
				{ this.checkPermits(); }
			else
				{ player.bounty += this.storedArray[3] + (2 * this.storedArray[6]) + this.storedArray[10]; }
			}
		}
	}

this.checkPermits = function()
	{
	this.penalty = this.storedArray[3] + (2 * this.storedArray[6]) + this.storedArray[10];

	this.tempNC = worldScripts.CargoTypeExtension.suspendPlayerManifest();
	worldScripts.CargoTypeExtension.restorePlayerManifest(missionVariables.hyperCargoNewCargoes);
	
	this.specialCargoesCarried = worldScripts.CargoTypeExtension.specialCargoesCarried();
	if(this.specialCargoesCarried.length === 0)
		{ 
		worldScripts.CargoTypeExtension.restorePlayerManifest(this.tempNC)
		return;
		}

	let checkCounter = 0 ; // reset the counter
	for(checkCounter = 0;checkCounter&lt;this.specialCargoesCarried.length;checkCounter++)
		{
		this.checkCargo = worldScripts.CargoTypeExtension.cargoDefinition(this.specialCargoesCarried[checkCounter],&quot;genericType&quot;);
		if(this.checkCargo === &quot;slaves&quot; || this.checkCargo === &quot;narcotics&quot; || this.checkCargo === &quot;firearms&quot;)
			{
			this.penalty += worldScripts.CargoTypeExtension.hasSpecialCargo(this.specialCargoesCarried[checkCounter]) * worldScripts.CargoTypeExtension.exportPermitLevel(this.specialCargoesCarried[checkCounter], worldScripts.CargoTypeExtension.hasSpecialCargo(this.specialCargoesCarried[checkCounter]));
			}
		}

	worldScripts.CargoTypeExtension.restorePlayerManifest(this.tempNC)
	if(this.penalty &gt; 0) { player.bounty += this.penalty; }
	}
	
this.shipWillDockWithStation = this.stopTimer = function(station)
	{
	if(this.energyDrainTimer &amp;&amp; this.energyDrainTimer.isRunning)
		{ this.energyDrainTimer.stop(); }
	}

this.equipmentRepaired = function(equipment)
	{
	if(equipment &amp;&amp; equipment === &quot;EQ_HYPERCARGO&quot;)
		{ this.shipDockedWithStation(); }
	}	
	
this.shipDockedWithStation = function()
	{
	if (0 &gt;= oolite.compareVersion(&quot;1.77&quot;) &amp;&amp; player.ship.docked &amp;&amp; player.ship.equipmentStatus(&quot;EQ_HYPERCARGO&quot;) === &quot;EQUIPMENT_OK&quot;)
		{
		player.ship.dockedStation.setInterface(&quot;Hypercargo&quot;,
			{ title: &quot;Access Hypercargo&quot;,
			category: &quot;Ship&quot;,
			summary: &quot;Accesses the Hypercargo system.&quot;,
			callback: this.activateHC.bind(this) });
		}
	}	
	
this.startTimer = function()
	{
	if(player.ship.docked)
		{ return; }
	if(this.energyDrainTimer)
		{ this.energyDrainTimer.start() }
	else
		{ this.energyDrainTimer = new Timer(this, this.drainEnergy,0,0.5) }
	}
	
this.drainEnergy = function()
	{ player.ship.energy -= 0.5; }
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
