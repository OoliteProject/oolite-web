<html>
    <head>
        <title>Expansion Snoopers</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Snoopers</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">10 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds the galactic news network channels.</td>
                    <td>Adds the galactic news network channels.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Svengali.Snoopers</td>
                    <td>oolite.oxp.Svengali.Snoopers</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Snoopers</td>
                    <td>Snoopers</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Ambience</td>
                    <td>Ambience</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>DaddyHoggy, Disembodied, Drew, Svengali</td>
                    <td>DaddyHoggy, Disembodied, Drew, Svengali</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.5</td>
                    <td>2.5</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Snoopers">http://wiki.alioth.net/index.php/Snoopers</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/6/69/Snoopers_2.5.oxz">https://wiki.alioth.net/img_auth.php/6/69/Snoopers_2.5.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 3</td>
                    <td>CC BY-NC-SA 3</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873326</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Snoopers'>http://wiki.alioth.net/index.php/Snoopers</a></p>
        <h3>Snoopers2.5 Readme.rtf</h3>
        <pre>{\rtf1\ansi\ansicpg1252\deff0{\fonttbl{\f0\fnil\fcharset0 Helvetica;}{\f1\fswiss\fprq2\fcharset0 Helvetica;}{\f2\fnil\fcharset238 Helvetica;}}
{\colortbl ;\red128\green128\blue128;\red128\green0\blue128;\red0\green0\blue128;\red0\green0\blue0;}
{\*\generator Msftedit 5.41.15.1515;}\viewkind4\uc1\pard\lang1031\ul\b\f0\fs24 SNOOPERS v2.5\ulnone\b0\fs28  \fs24 for Oolite\f1\par
\cf1\f0\fs20 Copyright 2009-2013 DaddyHoggy, Disembodied, Drew and Svengali\par
License:CC-by-nc-sa-3.0\par
\cf0\par
\ul\fs22 STORY:\fs24\par
\cf2\ulnone\b\fs16 3130 MGMT \b0 - *\i\fs22 GalCop begins a programme of retrofitting some out of date space faring equipment to older vessels.\par
At the same time, satellite and comms buoys are upgrade\i0 &quot;.\par
\fs14 * source: Encyclopedia Galactica\par
\cf0\fs22\par
And communications companies popped up like mushrooms, offering dubious and sometimes very\par
expensive services, each trying to grab the biggest slice of this new market, swept up by a goldrush fever.\par
Only a handful of news agencies survived the ensuing &#39;War of Information&#39; - an orgy of mergers, acquisitions,\par
lawsuits and the occasional little bit of terrorism and sabotage - to create today&#39;s stable news market that we\par
know and love.\par
\par
And Snoopers brings them to you. Directly onto your screen, through your eyeballs and into your brain.\par
\ul\par
FEATURES:\ulnone\par
Snoopers gives players some nice and well-thought screens to learn a bit more about the Ooniverse\par
brought to you by all established news agencies. News can be accessed via the \cf3 Interface\cf0  (F4),\par
when any important news are available.\par
\par
- Four established news agencies with different images.\par
- Sound and Music.\par
- Designed screens.\par
- Useable for other OXPs.\par
- Selfconfiguring (or OXPConfig2, or editing).\par
\par
Snoopers checks the used modes for:\par
- reduced mode or wireframe mode, if used and news is internal a redux background image is enabled\par
  and no logo is displayed.\par
- music mode, if not enabled music and sounds are switched off.\par
- shader support, if not available the brigthness control is bypassed (may not work for oxp-injected models).\par
\par
\ul USAGE FOR OTHER OXPS:\ulnone\par
Snoopers has a inbuilt feature to implement news. This gives other worldScripts a platform to add\par
even more flavour and to integrate own stories.\par
\par
Documentation can be found -&gt; \cf2 http://wiki.alioth.net/index.php/Snoopers_Doc\cf0\par
\par
\ul\fs24 REQUIREMENTS:\par
\ulnone\fs22 - Oolite v1.77.\par
- Cabal_Common_Library1.7.\par
\par
\ul\fs24 PROBLEMS:\par
\ulnone\fs22 In case of problems, please report it: \cf2 http://aegidian.org/bb/viewtopic.php?f=4&amp;t=6937.\par
I\cf0 nclude the following infos:\par
- Oolites version (and if trunk or nightly is used the revision number)\par
- OS, Graphics card (and driver version)\par
- Fullscreen/Windowed mode\par
- Shader mode\par
- List of used OXPs (incl. versions)\par
\cf4\fs24 _________________________________________________________________________\par
\fs20\par
Thanks to:\par
  - \ul The development team\ulnone\par
  Giles Williams (aegidian), Jens Ayton (Ahruman), Nikos Barkas (another_commander), David Taylor (dajt),\par
  Chris Crowther (hikari), James (cmdrjames), Darren Salt (dsalt), Eddy Petri\f2\&#39;baor\f0  (\f2 eddyp\f0 ), \f2 Erich Ritz\f0  (\f2 eritz\f0 ),\par
  \f2 Konstantinos Sykas\f0  (\f2 getafix\f0 ),  K\f2 aks\f0 , \f2 Nic \f0 (\f2 nic_asdf\f0 ), \f2 Michael Werle\f0  (\f2 mwerle\f0 ), \f2 Dave Hughes\f0  (s\f2 elezen\f0 ),\par
  Eric Walch, \f2 Dylan Smith\f0  (\f2 winston\f0 ).\f2\par
\f0\par
Special thanks to:\par
  - Eric Walch for his thoughts and continued help,\par
  - Kaks for all these shiny new features,\par
  - PhantorGorth for the technobabble,\par
  - Fatleaf for his feedback\par
  - Dr.J R Stockton and Sean McManus for sharing some pretty useful snippets.\par
\fs24 _________________________________________________________________________\par
\fs20\par
- This OXP is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\par
 To view a copy of this license, visit \cf2 http://creativecommons.org/licenses/by-nc-sa/3.0/\cf4  or send a letter to\par
 Creative Commons, 444 Castro Street, Suite 900, Mountain View, California, 94041, USA.\par
\par
DISCLAIMER:\par
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY\par
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\par
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT\par
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\par
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT\par
OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)\par
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR\par
TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\par
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\par
\par
A SMALL PERCENTAGE OF USERS MAY EXPERIENCE EPILEPTIC SEIZURES WHEN EXPOSED TO\par
CERTAIN LIGHT PATTERNS OR BACKGROUNDS ON A COMPUTER SCREEN OR WHILE USING THIS OXP.\par
CERTAIN CONDITIONS MAY INDUCE PREVIOUSLY UNDETECTED EPILEPTIC SYMPTOMS EVEN IN USERS\par
WHO HAVE NO HISTORY OF PRIOR SEIZURES OR EPILEPSY. IF YOU, OR ANYONE IN YOUR FAMILY,\par
HAVE AN EPILEPTIC CONDITION, CONSULT YOUR PHYSICIAN PRIOR TO USING THIS OXP. IMMEDIATELY\par
DISCONTINUE USE OF THIS OXP AND CONSULT YOUR PHYSICIAN IF YOU EXPERIENCE ANY OF THE\par
FOLLOWING SYMPTOMS WHILE USING THIS OXP: DIZZINESS, ALTERED VISION, EYE OR MUSCLE\par
TWITCHES, LOSS OF AWARENESS, DISORIENTATION, ANY INVOLUNTARY MOVEMENT, OR CONVULSIONS.\par
\fs24 _________________________________________________________________________\par
\fs20\par
\par
\par
\par
}
 </pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. 
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/snoopers_gcnews.html">Snoopers Tionisla Chronicle</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/snoopers_gcnewsA1.html">Snoopers GNN</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/snoopers_gcnewsA2.html">Snoopers Rooters</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/snoopers_gcnewsA3.html">Snoopers Snoopers</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/snoopers_gcnews_b.html">Snoopers Tionisla Chronicle</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/snoopers_pf.html">Snoopers Snoopers</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/snoopers_solar.html">Snoopers Solar</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/snoopers_solar_halo.html">Snoopers Solar Halo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/snoopers_solar_ring.html">Snoopers Solar Ring</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/snoopers_solar_sun.html">Snoopers Solar Sun</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/snoopers.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;snoopers&quot;;
this.author = &quot;DaddyHoggy, Drew, Disembodied and Svengali&quot;;
this.copyright = &quot;(C)2009-2013, License:CC-by-nc-sa-3.0&quot;;
this.description = &quot;The Galactic News Network.&quot;;
this.version = &quot;2.5&quot;;

this.logging = false; // Extended logging on/off. Default false.
this.audio = true; // Audio for internal news on/off. Default true.
this.extraA = true; // Full mode for internal news on/off. Default true.
this.sliderA = 0x3; // Chance for newsflashes. Default 0x3 (#3).
this.sliderB = 0x19; // Max days between newsflashes. Default 0x19 (#25).
this.sliderC = 0x4; // Brightness for model. Default 0x4 (#4).
this.nextDate = 0;

this.startUp = function()
{
	delete this.startUp;
	if(!worldScripts.Cabal_Common_Functions || typeof(worldScripts.Cabal_Common_Functions.Cabal_Common)===&#39;undefined&#39;){this.killSelf(&quot; -&gt; Cabal_Common_Library is missing.&quot;); return;}
	this.helper = new worldScripts.Cabal_Common_Functions.Cabal_Common();
	if(this.helper.internalVersion&lt;15){this.killSelf(&quot; -&gt; Cabal_Common_Library is too old.&quot;); return;}
	this.snoopStation = true;
	this.shouldShow = false;
	this.peepDone = false;
	this.priorityMessages = false;
	this.fifoNews = [];
	this.unusedNews = [];
	this.CRCNews = [];
	this.galList = [1,2];
	this.specials = [];
	this.specialNews = [];
	this.hotNews = [];
	if(missionVariables.snoopers_allInfos){
		var snoopersInfos = JSON.parse(missionVariables.snoopers_allInfos),oxpID,snoopersUnused;
		if(missionVariables.snoopers_unusedInfos){
			snoopersUnused = JSON.parse(missionVariables.snoopers_unusedInfos);
			for(var i=0;i&lt;snoopersUnused.length;i++){
				oxpID = snoopersUnused[i].ID;
				if(worldScripts[oxpID]) this.fifoNews.push(snoopersUnused[i]);
				else this.unusedNews.push(snoopersUnused[i]);
			}
		}
		this.hotNews = snoopersInfos.hotNews;
		this.nextDate = snoopersInfos.nextDate;
		this.CRCNews = snoopersInfos.CRCNews;
		for(var i=0;i&lt;snoopersInfos.fifoNews.length;i++){
			oxpID = snoopersInfos.fifoNews[i].ID;
			if(worldScripts[oxpID]) this.fifoNews.push(snoopersInfos.fifoNews[i]);
			else this.unusedNews.push(snoopersInfos.fifoNews[i]);
		}
		if(this.fifoNews.length) this.resort = true;
		if(!this.unusedNews.length) delete this.unusedNews;
	} else this.nextDate = clock.days+2;
	if(oolite.gameSettings.wireframeGraphics) this.extraA = false;
	if(oolite.gameSettings.musicMode===&#39;MUSIC_OFF&#39;) this.audio = false;
	this.snoopersInit = true;
	this.clearMVs();
	delete this.killSelf;
};
this.killSelf = function(desc)
{
	if(desc!==1){
		player.consoleMessage(this.name+&quot; - Check your Latest.log.&quot;,10);
		log(this.name,this.name+&quot; - Shutting down.&quot;+desc);
	}
	for(var prop in this){if(prop!==&#39;name&#39; &amp;&amp; prop!==&#39;version&#39;) delete this[prop];}
	this.deactivated = true;
	this.insertNews = function(){return(27);}
	return;
};
this.playerWillSaveGame = function()
{
	var snoopersInfos = {};
	snoopersInfos.CRCNews = this.CRCNews;
	snoopersInfos.nextDate = this.nextDate;
	snoopersInfos.hotNews = this.hotNews;
	snoopersInfos.fifoNews = this.fifoNews;
	snoopersInfos.snoopVersion = this.version;
	missionVariables.snoopers_allInfos = JSON.stringify(snoopersInfos);
	if(this.unusedNews &amp;&amp; this.unusedNews.length) missionVariables.snoopers_unusedInfos = JSON.stringify(this.unusedNews);
	this.clearMVBit = true;
	return;
};
this.clearMVs = function()
{
	missionVariables.snoopers_allInfos = null;
	missionVariables.snoopers_unusedInfos = null;
	delete this.clearMVBit;
	return;
};
this.rndSubSet = function(iter,ln,sub)
{
	var aSet = [],j,k,n;
	if(iter&gt;ln) iter = ln;
	for(k=1;k&lt;=iter;k++){
		n = ln-iter+k;
		j = Math.floor(n*(Math.random()%1))+1;
		aSet[j]?(aSet[n]=n):(aSet[j]=j);
	}
	for(j=k=0;k&lt;aSet.length;k++) if(aSet[k]) aSet[j++] = aSet[k];
	aSet.length = j;
	if(!aSet.length) return 0;
	if(typeof(sub)===&#39;number&#39;){
		if(sub===1) return aSet[j-1];
		else return aSet[0];
	}
	return aSet;
};
this.calcNewDate = function()
{
	if(this.hotNews.length &amp;&amp; 0&gt;(clock.days-this.nextDate)) this.nextDate = clock.days+2;
	else {
		var limiter = Math.floor(Math.sqrt(this.fifoNews.length*4)+Math.sqrt(this.CRCNews.length)/4);
		var iterations = 10-limiter;
		var interval = (this.sliderB-limiter&gt;3?this.sliderB-limiter:3);
		this.nextDate = clock.days+this.rndSubSet(iterations,interval,1);
	}
	if(this.logging) log(this.name,this.name+&quot;: Date:&quot;+this.nextDate);
	return;
};
this.alertConditionChanged = this.missionScreenOpportunity = function()
{
	if(this.snoopersInit) this.guiScreenChanged();
	delete this.alertConditionChanged;
	if(player.ship.docked &amp;&amp; this.checkStored) this.showNewsScreen();
};
this.shipDockedWithStation = function(station)
{
	if(!player.ship.docked) return;
	if(this.resort) this.sortFIFO();
	else if(this.fifoNews.length){
		var fl = this.fifoNews.length;
		while(fl--) if(this.fifoNews[fl].Priority &amp;&amp; this.fifoNews[fl].Priority===1) this.priorityMessages = true;
	}
	if(station.isMainStation || station.scriptInfo.snoopersNews || station.hasNPCTraffic) this.snoopStation = true;
	else this.snoopStation = false;
	if(this.snoopStation &amp;&amp; this.checkStored) this.peepShow(1);
	this.checkSpecials();
};
this.checkSpecials = function()
{
	if(!this.specials.length) return;
	var i = this.specials.length,go=0,temp,c;
	while(i--){
		go=0;
		if(this.specials[i].hasOwnProperty(&#39;mV&#39;) &amp;&amp; missionVariables[this.specials[i].mV]===this.specials[i].value) go++;
		if(this.specials[i].hasOwnProperty(&#39;prop&#39;)){
			temp = this.specials[i].what,c = this.specials[i].prop;
			if(worldScripts[temp][c] &amp;&amp; worldScripts[temp][c]===this.specials[i].value) go++;
		}
		if(go){
			this.hotNews.push(this.specials[i]);
			if(0&gt;(clock.days-this.nextDate)) this.nextDate = clock.days+2;
			if(this.specials[i].hasOwnProperty(&#39;addMV&#39;)){
				var t = &#39;snoopers_&#39;+this.specials[i].mV;
				missionVariables[t] = system.name;
			}
		}
	}
};
this.guiScreenChanged = function()
{
	if(this.snoopersInit){
		var requires = [&#39;buoyRepair&#39;,&#39;1.3.2&#39;,&#39;AsteroidStorm&#39;,&#39;4.03&#39;,&#39;oolite-constrictor-hunt&#39;,&#39;1.77&#39;,&#39;oolite-nova&#39;,&#39;1.77&#39;,&#39;PlanetFall&#39;,&#39;1.51&#39;];
		var checked = this.helper.oxpVersionTest2Array(this.name,requires,1);
		for(var i=0;i&lt;checked.length;i++){
			if(checked[i]&gt;0){
				switch(i){
					case 0: this.specialNews.push(91); break;
					case 1: this.specials.push({what:requires[i*2],prop:&#39;badRockKiller&#39;,value:&#39;PLAYER&#39;,ht:2}); break;
					case 2: this.specials.push({what:requires[i*2],mV:&#39;conhunt&#39;,value:&#39;CONSTRICTOR_DESTROYED&#39;,ht:1}); break;
					case 3: this.specials.push({what:requires[i*2],mV:&#39;nova&#39;,value:&#39;TWO_HRS_TO_ZERO&#39;,ht:3,addMV:1}); break;
					case 4: this.specialNews.push(92); break;
				}
			}
		}
		delete this.snoopersInit;
	}
	if(this.clearMVBit) this.clearMVs();
	if(player.ship.docked){
		if(this.resort) this.sortFIFO();
		if(this.snoopStation &amp;&amp; !this.avoidSecond &amp;&amp; (this.shouldShow || (this.fifoNews.length &amp;&amp; Math.random()&lt;(this.sliderA+this.fifoNews.length*0.2)*0.02))) this.peepShow(1);
	}
};
this.peepShow = function(dck)
{
	this.shouldShow = true;
	if(dck &amp;&amp; this.shouldShow &amp;&amp; !this.avoidSecond){
		if(!this.peepDone) player.commsMessage(&quot;Special news report. Check your News Channel (F4).&quot;);
		var it = {title:&quot;The Galactic News Network.&quot;,category:&quot;News&quot;,summary:&quot;4 established news agencies are bringing you the latest news. Directly onto your screen, through your eyeballs and into your brain.&quot;,callback: worldScripts.snoopers.callbackShowNewsScreen}
		player.ship.dockedStation.setInterface(&quot;Snoopers&quot;,it);
	}
	if(this.audio &amp;&amp; !this.peepDone){
		var peep = new SoundSource();
		peep.sound = &#39;[snoopers_peep]&#39;;
		peep.play();
	}
	this.peepDone = true;
	return;
};
this.callbackShowNewsScreen = function(){worldScripts.snoopers.showNewsScreen(); return;};
this.showNewsScreen = function(obj)
{
	var scObj = {}, flagFIFO = false, rot, flagMV = false, special, e, t;
	if(this.checkStored) scObj = this.checkStored;
	else {
		if(obj) scObj = obj;
		else if(this.fifoNews.length &amp;&amp; (this.priorityMessages || Math.random()&gt;0.3) &amp;&amp; typeof(this.fifoNews[0])=== &#39;object&#39;){
			flagFIFO = true;
			scObj = this.fifoNews[0];
		} else {
			if(this.hotNews.length || (this.specialNews.length &amp;&amp; Math.random()&lt;0.03)){
				if(this.hotNews.length){
					t = this.hotNews[0].what;
					if(worldScripts[t]){
						e = this.hotNews[0].ht;
						if(this.hotNews[0].addMV) flagMV = this.hotNews[0].mV;
						special = 1;
					}
					this.hotNews.shift(); // unblock
				} else {
					e = this.specialNews[this.helper.randSpan(0,this.specialNews.length-1)];
					special = 1;
				}
			}
			if(special){
				switch(e){
					case 1: scObj = {Message:&#39;[SNOOPERS_SPECIALS_1]&#39;,Model:&#39;constrictor&#39;,Anim:[[1,&#39;rot&#39;,[0,-1,6.5,0,0.002,0,0,1,1]],[20,&#39;rot&#39;,[0,-1,3,0.002,0,0,0,1,1]],[28,&#39;zoom&#39;,[0,-1,2,0.998,1,0.3,0.3]],[30,&#39;face&#39;,[0,-1,3,-1,0,3,0,1]],[46,&#39;rot&#39;,[0,-1,10,0.002,0,0,0,1,1]],[70,&#39;zoom&#39;,[0,-1,2,1.005,1,0.3,0.3]],[451,0]]}; break;
					case 2: scObj = {Message:&#39;[SNOOPERS_SPECIALS_2]&#39;,Model:&#39;badrock&#39;,Ori:4,Anim:[[1,&#39;zoom&#39;,[0,-1,20,0.9996,1,0.3,0.3]],[2,&#39;rot&#39;,[0,-1,600,0,0.004,-0.004,0,1,1]],[601,0]]}; break;
					case 3: scObj = {Message:&#39;[SNOOPERS_SPECIALS_3]&#39;,Model:&#39;snoopers_solar&#39;,Ori:[0.68,0.73,0,0],Anim:[[1,&#39;turn&#39;,[0,0,600,0.001,0.001,0,0]],[4,&#39;zoom&#39;,[0,-1,12,1.001,0,0.3,0.3]],[601,0]]}; break;
					case 91: scObj = {Message:&#39;[SNOOPERS_SPECIALS_91]&#39;,Model:&#39;repaired-buoy-station&#39;,Anim:[[1,&#39;zoom&#39;,[0,-1,20,0.995,1,0.3,0.3]],[4,&#39;face&#39;,[0,-1,16,-1,0,3,3,1]],[81,&#39;rot&#39;,[0,-1,3.6,0.001,-0.008,0.001,0,1,1]],[82,&#39;zoom&#39;,[0,-1,8,1.003,1,0.3,0.3]],[282,&#39;zoom&#39;,[0,-1,12,1.005,1,0.3,0.3]],[290,&#39;prop&#39;,[0,-1,&#39;fuel&#39;,6,0,0,0]],[401,0]]}; break;
					case 92: scObj = {Message:&#39;[SNOOPERS_SPECIALS_92]&#39;,Model:&#39;snoopers_pf&#39;,Ori:1,Anim:[[5,0]]}; break;
				}
				scObj.Message = expandDescription(scObj.Message);
				scObj.ID = this.name;
				scObj.Pic = &#39;snoopers_gcnews_clean.png&#39;;
			} else {
				var a=&#39;&#39;, b=&#39;&#39;;
				scObj.ID = &#39;Internal&#39;;
				if(this.galList.length &amp;&amp; this.galList.indexOf(galaxyNumber)!==-1 &amp;&amp; Math.random()&gt;0.3){
					a = &#39;[SNOOPERS_&#39;+galaxyNumber+&#39;_G&#39;+system.government+&#39;]&#39;;
					b = &#39;[SNOOPERS_&#39;+galaxyNumber+&#39;_G&#39;+system.government+&#39;_&#39;;
				} else {
					a = &#39;[SNOOPERS_0_G&#39;+system.government+&#39;]&#39;;
					b = &#39;[SNOOPERS_0_G&#39;+system.government+&#39;_&#39;;
				}
				var ex = this.helper.randSpan(1,parseInt(expandDescription(a),null));
				var m = expandDescription(b+ex+&#39;]&#39;);
				if(m[0]===&#39;#&#39;){
					scObj.Agency = parseInt(m[1],null);
					m = m.substr(3);
				}
				scObj.Message = m;
			}
		}
	}
	if(!scObj.Agency) scObj.Agency = false;
	if(this.audio || flagFIFO){
		if(!scObj.Music) scObj.Music = &#39;snoopers_gcnews.ogg&#39;;
	} else scObj.Music = null;
	if(scObj.Agency){
		if(!isNaN(scObj.Agency) &amp;&amp; scObj.Agency&gt;0 &amp;&amp; scObj.Agency&lt;4){
			if(flagFIFO &amp;&amp; Math.random()&lt;0.5) scObj.Pic = &#39;snoopers_gcnewsA&#39;+scObj.Agency+&#39;1.png&#39;;
			else {
				scObj.Agency = parseInt(scObj.Agency,null);
				switch(scObj.Agency){
					case 1: scObj.Pic = &#39;snoopers_gcnewsA&#39;+scObj.Agency+&#39;&#39;+this.helper.randSpan(1,4)+&#39;.png&#39;; break;
					case 2: scObj.Pic = &#39;snoopers_gcnewsA&#39;+scObj.Agency+&#39;&#39;+this.helper.randSpan(1,4)+&#39;.png&#39;; break;
					case 3: scObj.Pic = &#39;snoopers_gcnewsA&#39;+scObj.Agency+&#39;&#39;+this.helper.randSpan(1,3)+&#39;.png&#39;; break;
				}
			}
			scObj.Model = &#39;snoopers_gcnewsA&#39;+scObj.Agency;
			scObj.Pos = null;
			scObj.Music = &#39;snoopers_gcnews.ogg&#39;;
		} else log(this.name,this.name+&#39;: Error. Agency not valid:&#39;+scObj.Agency+&#39;.&#39;);
	} else {
		if(!scObj.Pic) scObj.Pic = &#39;snoopers_gcnews&#39;+this.helper.randSpan(1,4)+&#39;.png&#39;;
		else {
			switch(scObj.Pic){
				case &#39;snoopers_gcnewsA1.png&#39;: scObj.Pic = &#39;snoopers_gcnewsA11.png&#39;; break;
				case &#39;snoopers_gcnewsA2.png&#39;: scObj.Pic = &#39;snoopers_gcnewsA21.png&#39;; break;
				case &#39;snoopers_gcnewsA3.png&#39;: scObj.Pic = &#39;snoopers_gcnewsA31.png&#39;; break;
			}
		}
		if(!scObj.Model){
			scObj.Model = &#39;snoopers_gcnews_b&#39;;
			scObj.Pos = null;
		}
	}
	this.sliderC &amp;= 7;
	if(scObj.Model &amp;&amp; scObj.Pos){
		if(typeof(scObj.Pos)===&#39;string&#39;){
			var ar = scObj.Pos.split(&#39;,&#39;);
			for(var cp=0;cp&lt;ar.length;cp++) ar[cp] = parseFloat(ar[cp]);
			scObj.Pos = ar;
		}
	}
	if(!scObj.Model) scObj.Model = &#39;cabal_common_modelview&#39;;
	mission.runScreen({title:&quot;News channel&quot;,screenID:&quot;snoopers&quot;,message:&quot;\n\n\n\n\n\n\n\n&quot;+scObj.Message,model:scObj.Model,music:scObj.Music,overlay:scObj.Pic,spinModel:false},this.choiceEval);
	if(mission.displayModel){
		var ori = [0,0,1,0],fx = 0.4,fy = 0.25,fz = 3;
		switch(mission.displayModel.primaryRole){
			case &#39;snoopers_gcnews&#39;: fz = 3; scObj.Pos = null; scObj.Ori = 4; rot = 1; break;
			case &#39;snoopers_gcnews_b&#39;: fx = 0.43; fz = 1.3; scObj.Pos = null; scObj.Ori = 1; break;
			case &#39;snoopers_gcnewsA1&#39;: fx = 0.43; fz = 1.5; scObj.Pos = null; scObj.Ori = 1; break;
			case &#39;snoopers_gcnewsA2&#39;: fx = 0.43; fz = 1; scObj.Pos = null; scObj.Ori = 1; break;
			case &#39;snoopers_gcnewsA3&#39;: fx = 0.43; fz = 1; scObj.Pos = null; scObj.Ori = 1; break;
			case &#39;snoopers_pf&#39;: fx = 0.42; fz = 1.6; scObj.Pos = null; scObj.Ori = 1; break;
			default: if(scObj.Rot &amp;&amp; !scObj.Anim) rot = scObj.Rot;
		}
		var r=this.helper.screenChecks(),z=mission.displayModel.position.z;
		if(!scObj.Pos){
			mission.displayModel.position=[(z/r[3])*(fx+((r[2]/r[0])*0.1)),(z/r[3])*(fy+((r[2]/r[0])*0.15)),z];
			mission.displayModel.position=mission.displayModel.position.multiply(fz);
		} else {
			scObj.Pos[0] += r[0]/1024/scObj.Pos[0];
			scObj.Pos[1] += (r[1]/768/scObj.Pos[1])*0.75;
			scObj.Pos[2] = (scObj.Pos[2]/(1024/768))*r[3];
			mission.displayModel.position = [scObj.Pos[0],scObj.Pos[1],scObj.Pos[2]];
		}
		switch(parseInt(scObj.Ori,null)){
			case 1: ori = [1,0,0,0]; break;
			case 2: ori = [1,0,0,1]; break;
			case 4: ori = [0,0,1,0]; break;
			case 8: ori = [1,1,0,0]; break;
			default:
				if(!scObj.Ori || typeof(scObj.Ori)===&#39;number&#39;) ori = [0,0,1,0];
				else ori = scObj.Ori;
		}
		mission.displayModel.orientation = ori;
		mission.displayModel.fuel = this.sliderC;
		if(scObj.Anim) rot=99;
	}
	if(!scObj.Direct){
		this.shouldShow = false;
		this.avoidSecond = true;
		if(player.ship.docked) player.ship.dockedStation.setInterface(&quot;Snoopers&quot;,null);
		if(flagFIFO){
			this.priorityMessages = false;
			this.fifoNews.shift();
		}
		if(this.CRCNews.length){
			if(this.CRCNews.length&gt;2){this.CRCNews.sort(function(){return Math.random()&lt;0.5?-1:1}); this.CRCNews.shift();}
			if(Math.random()&lt;0.6) this.CRCNews.shift();
		}
		this.calcNewDate();
	}
	if(rot){
		var ani;
		switch(rot){
			case 1: ani = [[1,&#39;rot&#39;,[0,-1,600,0,0.006,0,0,20,20]],[40,&#39;rot&#39;,[0,-1,40,0.004,0,0,0,20,20]],[601,0]]; break;
			case 2: ani = [[1,&#39;rot&#39;,[0,-1,600,0,0.008,0.004,0,20,20]],[601,0]]; break;
			case 99: ani = scObj.Anim; break;
		}
		if(ani) worldScripts.Cabal_Common_Briefing.startBriefing({capture:1,briefing:ani,repRelative:1});
	}
	if(flagMV){
		var mv = &#39;snoopers_&#39;+flagMV;
		missionVariables[mv] = null;
	}
	if(!this.checkStored || scObj.Recall){
		if(worldScripts[scObj.ID] &amp;&amp; worldScripts[scObj.ID].newsDisplayed) worldScripts[scObj.ID].newsDisplayed(scObj.Message.substr(0,20));
	}
	if(scObj.ID!==&#39;Internal&#39;) this.checkStored = scObj;
	this.snoopTimer = new Timer(this,this.doSnoopTimer,0.1);
	if(this.logging) log(this.name,this.name+&quot;: CRCs:&quot;+this.CRCNews+&quot; PriorityMessages:&quot;+this.priorityMessages);
	return;
};
this.doSnoopTimer = function()
{
	if(!player.ship.docked) this.logBoos();
	else if(!mission.screenID || mission.screenID!==&quot;snoopers&quot;) this.logBoos(2);
	delete this.snoopTimer;
};
this.logBoos = function(n)
{
	log(this.name,&quot;REPORT Snoopers: &quot;+JSON.stringify(this.checkStored));
	if(n) player.consoleMessage(&quot;This OXP screen has overriden a Snoopers screen. Please report it to the author.&quot;,10);
	else player.commsMessage(&quot;Oops. A Snoopers screen was killed by another OXP. This is a clash between OXPs - please report it.&quot;,10);
	return;
};
this.choiceEval = function(){worldScripts.snoopers.choiceEvaluation(); return;};
this.choiceEvaluation = function()
{
	delete this.checkStored;
};
/* Handle incoming messages from other OXPs. Snoopers stores up to 10 messages and 20 CRCs if .Direct is not used.

Parameters:		obj		- Object.
Returns:		n		- Number. Errorcode.

ID			- String. Required. worldScript Name.
Message		- String. Required. Message. Keynames will be expanded, mixtures are allowed, max length 900 chars, min length 10 chars.
Agency		- Number. Defines 1=GNN, 2=Rooters, 3=Snoopers. Disables custom pics and models.
Priority	- Number. 1=highest (bypasses CRC check and storing), used to sort the inserted news. Default 3.
Pic			- String. Overlay image, use tranparent areas if model should be used!!! Fileextension is required.
Music		- String. Music for Newsflash. Fileextension is required.
Model		- String. Model for Newsflash.
Pos			- Array. 3 valid numbers.
Ori			- Number/Array. Orientation of Model. If number: 1=[1,0,0,0], 2=[1,0,0,1], 4=[0,0,1,0], 8=[1,1,0,0]. Default 8. Otherwise Array with 4 valid numbers.
Recall		- Boolean. Resend callback in case other OXPs have overridden Snoopers screen and Replay got activated.
Direct		- Boolean. Display message directly without storing, CRC or other buffer checks. Requires to be docked.
Anim		- Array. Uses Cabal_Common_Briefing capture option. Ignored if .Direct is not used.

Errorcodes:
&lt;0 - Snoopers buffers are full, oxp already placed a newsflash or CRC is still stored.
 0 - Success.
&gt;0 - Error occured.
*/
this.insertNews = function(obj)
{
	var crc = 0, c = 0, i = 0, priflag = false;
	var desc=[{x:&quot;&quot;,y:0}], ca=&quot;&quot;, cb, flagP, loop, m;
	var cList = [&#39;ID&#39;,&#39;Agency&#39;,&#39;Priority&#39;,&#39;Message&#39;,&#39;Pic&#39;,&#39;Music&#39;,&#39;Model&#39;,&#39;Pos&#39;,&#39;Ori&#39;,&#39;Recall&#39;,&#39;Direct&#39;,&#39;Anim&#39;];
	if(!obj.ID || !obj.Message) return(1);
	for(var prop in obj){
		if(cList.indexOf(prop)===-1) return(2);
		++c;
	}
	if(!c || c&gt;cList.length) return(3);
	if(!worldScripts[obj.ID] || obj.ID===this.name) return(4);
	if(!obj.Direct){
		if(this.fifoNews.length&gt;9) return(-5);
		if(obj.Priority &amp;&amp; obj.Priority===1) priflag = true;
		if(!priflag){
			if(this.CRCNews.length&gt;20) return(-3);
			crc = this.helper.strGetCRC(obj.ID);
			if(this.CRCNews.length &amp;&amp; this.CRCNews.indexOf(crc)!==-1) return(-2);
		}
		obj.CRC = crc;
		if(this.fifoNews.length){
			i = this.fifoNews.length;
			while(i--) if(this.fifoNews[i].ID.indexOf(obj.ID)!==-1) return(-1);
		}
		delete obj.Anim;
		delete obj.Direct;
	}
	// Message handling
	m = obj.Message;
	if(typeof(m)!==&#39;string&#39;) return(5);
	if(m.length&lt;10 || m.length&gt;900) return(6);
	m = m.trim();
	// String Expansion
	for(var se=0;se&lt;m.length;se++){
		if(flagP){
			loop = 0;
			switch(m[se]){
				case &quot;H&quot;:
				case &quot;I&quot;:
				case &quot;R&quot;:
				case &quot;N&quot;: loop=1; break;
				case &quot;J&quot;: loop=5; break;
				default: desc[desc.length-1].y = 0; loop=1;
			}
			for(var q=0;q&lt;loop;q++) desc[desc.length-1].x += m[se+q];
			if(loop) se += loop-1;
			desc.push({x:&quot;&quot;,y:0});
			flagP=0;
		} else switch(m[se]){
			case &quot;[&quot;:
				desc.push({x:&quot;&quot;,y:1});
				break;
			case &quot;]&quot;:
				desc.push({x:&quot;&quot;,y:0});
				break;
			case &quot;%&quot;:
				desc.push({x:&quot;&quot;,y:2});
				flagP=1;
				break;
			default: desc[desc.length-1].x += m[se];
		}
	}
	for(var p=0;p&lt;desc.length;p++){
		if(desc[p].x){
			if(desc[p].y){
				cb = expandMissionText(desc[p].x);
				if(!cb){
					if(desc[p].y===2) cb = expandDescription(&quot;%&quot;+desc[p].x);
					else cb = expandDescription(&quot;[&quot;+desc[p].x+&quot;]&quot;);
				}
				ca += cb;
			} else ca += desc[p].x
		}
	}
	m = ca;
	if(!m || m===&#39;&#39;) return(8);
	// Overlengthy (words)
	if(m.length&gt;900) return(12);
	var overlength = m.split(&#39; &#39;);
	i = overlength.length;
	while(i--) if(overlength[i].length&gt;79) return(13);
	// Linebreaks
	var strs = m.split(&#39;\n&#39;);
	if(strs.length&gt;10) return(14);
	obj.Message = m;
	if(obj.Priority){
		c = parseInt(obj.Priority,null);
		if(isNaN(c) || c&lt;1 || c&gt;3) return(16);
	} else obj.Priority = 3;
	if(obj.Agency){
		c = parseInt(obj.Agency,null);
		if(isNaN(c) || c&lt;1 || c&gt;3) return(15);
		delete obj.Pic;
		delete obj.Music;
		delete obj.Model;
		delete obj.Pos;
	}
	if(obj.Pic){
		if(typeof(obj.Pic)!==&#39;string&#39;) return(17);
		if(!obj.Pic.match(&#39;.png&#39;)) return(18);
	}
	if(obj.Music){
		if(typeof(obj.Music)!==&#39;string&#39;) return(19);
		if(!obj.Music.match(&#39;.ogg&#39;)) return(20);
	}
	if(obj.Model){
		if(typeof(obj.Model)!==&#39;string&#39;) return(21);
		if(obj.Pos){
			if(typeof(obj.Pos)!==&#39;object&#39;) return(22);
			if(obj.Pos.length!==3) return(23);
			for(c=0;c&lt;3;c++) if(typeof(obj.Pos[c])!==&#39;number&#39;) return(24);
		}
		if(obj.Ori &amp;&amp; obj.Ori!==null){
			if(typeof(obj.Ori)!==&#39;number&#39;){
				if(obj.Ori.constructor.name!==&#39;Array&#39;) return(25);
				for(c=0;c&lt;4;c++) if(typeof(obj.Ori[c])!==&#39;number&#39;) return(24);
			} else if(obj.Ori&lt;1 || obj.Ori&gt;15) return(26);
		} else obj.Ori = 8;
	}
	if(obj.hasOwnProperty(&#39;Recall&#39;)){
		if(!obj.Recall) delete obj.Recall;
		else obj.Recall = 1;
	}
	if(!obj.Direct){
		this.fifoNews.push(obj);
		if(!priflag) this.CRCNews.push(crc);
		this.resort = true;
	} else {
		if(!player.ship.isValid) return(28);
		if(!player.ship.docked) return(29);
		if(guiScreen===&#39;GUI_SCREEN_MISSION&#39;) return(30);
		this.showNewsScreen(obj);
	}
	return(0);
};
this.sortFIFO = function()
{
	var fl = this.fifoNews.length;
	if(fl &amp;&amp; fl&gt;1) this.fifoNews = this.helper.arrSortByProperty(this.fifoNews,&#39;Priority&#39;);
	while(fl--) if(this.fifoNews[fl].Priority &amp;&amp; this.fifoNews[fl].Priority===1) this.priorityMessages = true;
	if(this.logging) log(this.name,this.name+&quot;: PriorityMessages:&quot;+this.priorityMessages);
	delete this.resort;
	this.oxpcNotifyOnChange(2);
	return;
};
this.shipEnteredStationAegis = function()
{
	var offset = clock.days-this.nextDate;
	if(offset&lt;0 &amp;&amp; !this.priorityMessages) return;
	var chance = 0.1*(offset?Math.abs(offset)*0.5:1)*Math.sqrt((this.sliderA?this.sliderA:1)*(this.fifoNews.length?this.fifoNews.length*3:1)*(this.CRCNews.length?this.CRCNews.length:1))*(this.priorityMessages?2:1);
	if(Math.random()&lt;chance){
		worldScripts.Cabal_Common_Overlay.ovAdd({cclov_png:&quot;ccl_ovi02.png&quot;,cclov_type:0,cclov_blend:5,cclov_id:&quot;Snoopers&quot;,cclov_autoremove:1});
		worldScripts.Cabal_Common_Overlay.ovSpeak(&quot;Snoopers&quot;,5,&quot;Special news report. Check your News Channel (F4) when docked.&quot;);
		this.peepShow();
	}
};
this.shipWillLaunchFromStation = function(station)
{
	if(this.checkStored) this.logBoos();
	if(this.snoopStation) station.setInterface(&quot;Snoopers&quot;,null);
	this.snoopStation = false;
	this.peepDone = false;
	if(this.logging) log(this.name,this.name+&quot;: Date:&quot;+this.nextDate);
};
this.shipWillEnterWitchspace = function()
{
	delete this.avoidSecond;
	this.shouldShow = false;
};
this.oxpcNotifyOnChange = function(a)
{
	if((a&amp;2) &amp;&amp; (this.nextDate-clock.days)&gt;this.sliderB){
		this.nextDate = parseInt(clock.days,null)+this.sliderB;
		if(this.logging) log(this.name,this.name+&quot;: New date: &quot;+this.nextDate);
	}
	return;
};
this.oxpcSettings = {
	Info: {Name:&quot;snoopers&quot;,Display:&quot;Snoopers&quot;,Notify:true,
		InfoB:&quot;4 established news agencies are bringing you the latest news. OXPs can insert newsflashes to be displayed via Snoopers.&quot;,
		InfoS:&quot;General chance for newsflashes (0=never)\nMax. pause in days between newsflashes (0=no pause, but tends to 1)\nBrightness for Logo (0 disabled) - Shaders required.&quot;},
	Bool0: {Name:&quot;logging&quot;,Def:false,Desc:&quot;Logging functions.&quot;},
	Bool1: {Name:&quot;audio&quot;,Def:true,Desc:&quot;Music and sound for internal news.&quot;},
	Bool2: {Name:&quot;extraA&quot;,Def:true,Desc:&quot;Full mode for internal news.&quot;},
	SInt0: {Name:&quot;sliderA&quot;,Def:0x3,Max:0xa,Desc:&quot;Chance.&quot;},
	SInt1: {Name:&quot;sliderB&quot;,Def:0x19,Max:0x20,Desc:&quot;Max days.&quot;},
	SInt2: {Name:&quot;sliderC&quot;,Def:0x4,Max:0x7,Desc:&quot;Brightness.&quot;},
	cleanUp:{
		mv:[&quot;snoopers_dateCheck&quot;,&quot;snoopers_usedSlots&quot;,&quot;snoopers_CRCNews&quot;,&quot;snoopers1&quot;,&quot;snoopers2&quot;,&quot;snoopers4&quot;,&quot;snoopers8&quot;,&quot;snoopers16&quot;,&quot;snoopers32&quot;,&quot;snoopers64&quot;,&quot;snoopers128&quot;]
	}
};
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
