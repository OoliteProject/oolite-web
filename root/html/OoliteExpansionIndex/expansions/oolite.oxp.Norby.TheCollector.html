<html>
    <head>
        <title>Expansion The Collector</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion The Collector</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">6 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Find the rich man who collect historical spaceships and do the jobs he offer. Choose wisely, your choices will form the story.</td>
                    <td>Find the rich man who collect historical spaceships and do the jobs he offer. Choose wisely, your choices will form the story.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Norby.TheCollector</td>
                    <td>oolite.oxp.Norby.TheCollector</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>The Collector</td>
                    <td>The Collector</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Missions</td>
                    <td>Missions</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>mossfoot, Norby</td>
                    <td>mossfoot, Norby</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>0.4</td>
                    <td>0.4</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/TheCollector">http://wiki.alioth.net/index.php/TheCollector</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/1/11/TheCollector.0.4.oxz">https://wiki.alioth.net/img_auth.php/1/11/TheCollector.0.4.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 4</td>
                    <td>CC BY-NC-SA 4</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873231</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/The%20Collector'>http://wiki.alioth.net/index.php/The%20Collector</a></p>
        <h3>TheCollector_readme.txt</h3>
        <pre>The Collector mission pack

Somewhere in the galaxy there is a rich man who love his collection of historical spaceships.

Your first mission is to find him, then do all the jobs what he offer from easy to hard and your reward will be higher than you think.

No more info here due to everything else is spoiler. You should not dig into the included files if you do not want to cheat but enjoy a great play within the game.


Instructions:

Do not unzip the .oxz file, just move into the AddOns folder of your Oolite installation.

License:

This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike License version 4.0.
If you are re-using any piece of this OXP, please let me know by sending an e-mail to norbylite@gmail.com.

The station is borrowed from Shady Sungs OXP by Christoph Schmucker (aka Sung Mehta) and Michael Francis (aka Ancient Dwarven Chaos Knight - ADCK). Shader files from neolites by Simon B.
The gate near the station comes from Ring Racer OXP by Thargoid.
The experimental Cobra is made by Paradox.
The backround of mission screens is use images from BGS OXP.

Changelog:
 2014.11.02. v0.4  Some help in finding the station.
 2014.09.03. v0.3  Galaxy-independent start.
 2014.09.02. v0.2  Stage 1-7 done.
 2014.08.16. v0.1  First text files.
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. 
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/thecollector_adck_arc-detail.html">Arc Detail</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/thecollector_adck_coriolis-station.html">The Collector&#39;s Station</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/thecollector_adck_dock-flat.html">Docking Slit (horizontal)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/thecollector_beacon.html">The Collector&#39;s target beacon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/thecollector_buoy.html">The Collector&#39;s Buoy</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/thecollector_gate.html">The Collector&#39;s Gate</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/thecollector.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name	= &quot;thecollector&quot;;
this.author	= &quot;mossfoot, Norby&quot;;
this.copyright	= &quot;2014 Norby&quot;;
this.description= &quot;Missions from The Collector&quot;;
this.version	= &quot;0.4&quot;;
this.licence	= &quot;CC BY-NC-SA 4.0&quot;;

this.$TheCollectorBuoyDistance = 20000; //distance between two buoys before the collector&#39;s station
this.$TheCollectorMinBuoys = 5; //minimum how many buoys created

//internal properties, should not touch
this.$TheCollectorMissionStage = 0; //Where the player stay in the missions
this.$TheCollectorMissionSub = null; //Where the player stay within a MissionStage
this.$TheCollectorMSO = true; //flag for the first missionScreenOpportunity after landing
this.$TheCollectorStation = null; //store the station to detect if spawned
this.$TheCollectorStationKey = &quot;thecollector_adck_coriolis-station&quot;; //dataKey of collector&#39;s station
this.$TheCollectorTimes = []; //When the stages started

//worldscript events
this.startUp = function() {
	this.$TheCollectorMissionStage = missionVariables.$TheCollectorMissionStage;
	if(!(this.$TheCollectorMissionStage)) this.$TheCollectorMissionStage = 0;
	if(this.$TheCollectorMissionStage &gt; 0) this.$TheCollectorInstructions(0); //set the F5F5 info only
	this.$TheCollectorTimes = JSON.parse(missionVariables.$TheCollectorTimes); //destringify
	if( !this.$TheCollectorTimes ) this.$TheCollectorTimes = []; //When the stages started

	this.$TheCollectorSound1 = new SoundSource;
	if( worldScripts[&quot;BGS-M&quot;] ) this.$TheCollectorSound1.sound = &quot;bgs-c_buy.ogg&quot;;
	else this.$TheCollectorSound1.sound = &quot;buy.ogg&quot;;
	this.$TheCollectorSound1.loop = false;
	this.$TheCollectorSound1.repeatCount = 1;
}

this.systemWillPopulate = function() { //for Oolite 1.79 and above
	this.$TheCollectorCreateStation(true);
}

this.missionScreenOpportunity = function() {
	var p = player.ship;
//	log(this.name, p.dockedStation);//debug
	if( p &amp;&amp; p.docked &amp;&amp; this.$TheCollectorMSO &amp;&amp; system ) {
		this.$TheCollectorMSO = false; //only in the first missionScreenOpportunity after landing

		if( this.$TheCollectorMissionStage &lt; 2 &amp;&amp; Math.random() &lt; 0.1 ) { //10% chance
			this.$TheCollectorInstructions( 1 ); //galaxy hint talk until stage 2
			return;
		} else if( galaxyNumber &gt; 0 ) return; //nothing more in other galaxies

		if( p.dockedStation == system.mainStation ) {
			if( system.ID == 119 &amp;&amp; this.$TheCollectorMissionStage &lt; 4 //Rarere
				&amp;&amp; p.dockedStation.dataKey != this.$TheCollectorStationKey ) {
				this.$TheCollectorInstructions( 3 ); //local rumor until stage 4
			} else if( system.ID == 160 &amp;&amp; ( this.$TheCollectorMissionStage == 5  //Leritean
				|| this.$TheCollectorMissionStage == 6 ) ) {
				var h = 0; //elapsed time in hours
				var s = this.$TheCollectorTimes[5];
				if( s &gt; 0 ) h = ( clock.seconds - s ) / 3600;
				var tt = Math.ceil( h * 10 ) / 10 + &quot; hours&quot;;
//				log(this.name, tct+&quot; &quot;+h+&quot; &quot;+s);//debug
				if( s &amp;&amp; h &lt; 63 ) { //arrived in time (63h)
					this.$TheCollectorInstructions( 7, tt );
				} else this.$TheCollectorInstructions( 6, tt ); //too late
			} else if( system.ID == 65 &amp;&amp; this.$TheCollectorMissionStage &lt; -1 ) { //Sori
				this.$TheCollectorInstructions( -1 ); //todo: a ship is delivered
			} else if( system.ID == 66 &amp;&amp; this.$TheCollectorMissionStage &lt; -1 ) { //Aate
				this.$TheCollectorInstructions( -1 ); //todo: a ship is delivered
			}
		} else if( p.dockedStation.dataKey == this.$TheCollectorStationKey ) {
			if( this.$TheCollectorMissionStage &lt; 5 ) { //offer Leritean mission
				this.$TheCollectorInstructions( 4 );
			} else if( this.$TheCollectorMissionStage == 6 ) { //Leritean mission failed
				this.$TheCollectorInstructions( 4 ); //back to stage 4
			} else if( this.$TheCollectorMissionStage == 7 ) { //Leritean mission done
				this.$TheCollectorInstructions( 8 );
			}
		}
	}
}

this.playerWillSaveGame = function( message ) {
	missionVariables.$TheCollectorMissionStage = this.$TheCollectorMissionStage;
	missionVariables.$TheCollectorTimes = JSON.stringify(this.$TheCollectorTimes);
}

this.shipWillDockWithStation = function( station ) {
	this.$TheCollectorMSO = true; //flag for the first missionScreenOpportunity after landing
}

this.shipWillEnterWitchspace = function() {
	this.$TheCollectorStation = null; //clear the station storage
}

this.shipWillExitWitchspace = function() { //use this event due to shipExitedWitchspace is not called for player ship
	this.$TheCollectorCreateStation();
	if( galaxyNumber == 0 &amp;&amp; system ) {
		if( this.$TheCollectorMissionStage &gt; 3 //trap setup after met Mr. Smith
			&amp;&amp; ( system.ID == 122 || system.ID == 181 ) ) { //in Bibe and Bioris
			var n = Math.floor( 1 + 3 * Math.random() ); //1-3 attackers
			var s = system.addShips(&quot;pirate&quot;, n, player.ship.position, 25000);
			if( s ) for(var i=0; i &lt; s.length; i++ ) {
				if( s[i] ) {
					s[i].setAI(&quot;thecollector_trapAI.plist&quot;);
					s[i].awardEquipment(&quot;EQ_FUEL_INJECTION&quot;);
					s[i].fuel = 7;
					s[i].target = player.ship;
				}
			}
		}
	}
}

this.shipWillLaunchFromStation = function( station ) {
	this.$TheCollectorCreateStation(false); //for Oolite v1.77
}

//TheCollector methods
this.$TheCollectorCreateStation = function( populator ) {
	if( galaxyNumber == 0 &amp;&amp; system &amp;&amp; system.ID == 119 &amp;&amp; !this.$TheCollectorStation ) {
		var dist = 1656000; //how far is the collector&#39;s station in the main station to sun lane
		var mpos = system.mainStation.position;
		var msvector = system.sun.position.subtract(mpos); //mainStation to current sun vector
		var mlen = (this.$TheCollectorMinBuoys+1) * this.$TheCollectorBuoyDistance; //min. length of the buoy line
		var apos = mpos.add( msvector.direction().multiply( dist - mlen ) ); //asteroids position
//		var p = system.sun.position; log(this.name, &quot;Sunpos:&quot;+p.x+&quot; &quot;+p.y+&quot; &quot;+p.z);//get orig. sunpos
//		var osp = Vector3D(-1679104.3673211336, -1513520.786781907, -43617.31031984091);//original sun
//		var movector = osp.subtract(mpos); //mainStation to original sun vector
//		var spos = mpos.add( movector.direction().multiply( dist ) ) //station position
//			.add( mpos.direction().multiply( 40000 ) );
//		log(this.name, &quot;spos:&quot;+spos.x+&quot; &quot;+spos.y+&quot; &quot;+spos.z);//get the following coordinates
		var spos = Vector3D(-1219441.8670473576, -1134372.290313594, 113154.84710425357); //fix for sure

		if(populator) { //for Oolite 1.79 and above
			system.setPopulator(&quot;thecollector_station&quot;, {
				callback: function(pos) {
					this.$TheCollectorCreateSGB( apos, spos );
				}.bind(this),
				location: &quot;COORDINATES&quot;,
				coordinates: spos,
				deterministic: true
			});
			system.setPopulator(&quot;thecollector_asteroids&quot;, {
				callback: function(pos) {
					this.$TheCollectorCreateAF( apos, spos );
				}.bind(this),
				location: &quot;COORDINATES&quot;,
				coordinates: spos
			});
		} else { //for Oolite v1.77
			this.$TheCollectorCreateSGB( apos, spos ); //create station, gate and buoys
			//create asteroid fields after(!) buoys to do not prevent an aseroid the creation of buoys
			this.$TheCollectorCreateAF( apos, spos );
		}
	}
}

this.$TheCollectorCreateAF = function( apos, spos ) {//create asteroid fields
	//call after buoys to do not prevent an aseroid the creation of a buoy
	system.addShips(&quot;asteroid&quot;, 32, apos, 30000);
	var v = apos.subtract(spos);
	system.addShips(&quot;asteroid&quot;, 64, spos.add(v.direction().multiply(v.magnitude()/2)), 40000);
	system.addShips(&quot;asteroid&quot;, 32, spos, 30000);
}

this.$TheCollectorCreateSGB = function( apos, spos ) { //create station, gate and buoys
	var s = system.addShips(&quot;[&quot; + this.$TheCollectorStationKey + &quot;]&quot;, 1, spos, 0);
	var v = apos.subtract(spos); //targetVector from the collector&#39;s station to the asteroids
	var bd = this.$TheCollectorBuoyDistance; //buoy distance
	var d = v.direction(); //targetVector from the collector&#39;s station to the asteroids
	if(s) this.$TheCollectorStation = s[0];
	if( this.$TheCollectorStation ) { //rotate to the asteroids
		var a = this.$TheCollectorStation.heading.angleTo(d); //angle
		var c = this.$TheCollectorStation.heading.cross(d).direction(); //cross
		this.$TheCollectorStation.orientation = this.$TheCollectorStation.orientation.rotate(c, -a);

		var gpos = spos.add( d.multiply( this.$TheCollectorBuoyDistance ) ); //gate position
		var r = system.addShips(&quot;thecollector_gate&quot;, 1, gpos, 0);
		if(r &amp;&amp; r[0]) r[0].orientation = this.$TheCollectorStation.orientation;
		else  log(this.name, &quot;Warning: The Collector&#39;s Gate is not created&quot;);
	} else log(this.name, &quot;Error: The Collector&#39;s Station is not created!&quot;);

	//the trick of the buoy line is if the sun is in an unortodox position then make a very long guide line
	var l = Math.round((v.magnitude())/this.$TheCollectorBuoyDistance); //length of the buoy line
	for( var i = 2; i &lt;= l; i++ ) { //create buoys along the line except the nearest to the station (the gate)
		var p = spos.add( d.multiply( this.$TheCollectorBuoyDistance * i ) ); //buoy position
		var b = system.addShips(&quot;thecollector_buoy&quot;, 1, p, 0);
		if(b &amp;&amp; b[0]) b[0].displayName += &quot; &quot;+(i-1);
		if( l &gt; 500 &amp;&amp; i == 496 ) i = l - 5; //do not make too much buoys
	}
	if( l &gt; 500 ) {
		if( r &amp;&amp; r[0] ) {
			r[0].beaconCode = r[0].name; //last resort: the gate is a beacon
			log(this.name, &quot;Warning: The Collector&#39;s Station is too far so the gate is the beacon&quot;);
		} else log(this.name, &quot;Error: The Collector&#39;s Station is too far and the gate is not created&quot;);
	}
}

this.$TheCollectorInstructions = function( stage, tt ) {
	var t = worldScripts.thecollector;
	if( stage &gt; 0 ) { //step to the new stage and display missionscreen
		t.$TheCollectorMissionStage = stage;
		t.$TheCollectorMissionSub = &quot;_&quot;; //start
		t.$TheCollectorMissionScreen(t, tt);
		if(msg) player.commsMessage(msg, 10);
	} //if stage is 0 then set the F5F5 message to the current missionstage and do not change it
	var msg = expandMissionText(t.name+t.$TheCollectorMissionStage);
	if( msg ) {
		mission.setInstructions( msg+&quot; (#&quot;+t.$TheCollectorMissionStage+&quot;)&quot;, t.name);//show in F5-F5 screen
		t.$TheCollectorTimes[t.$TheCollectorMissionStage] = clock.seconds; //save the start of the stage
	}
}

this.$TheCollectorMissionScreen = function( t, tt ) {
	var mt = t.$TheCollectorMissionStage+t.$TheCollectorMissionSub;
	var todo = expandMissionText(t.name+t.$TheCollectorMissionStage);
	var m = expandMissionText(t.name+mt, {thecollectortime: tt, thecollectortodo: todo});
	if( !m || !(m.length&gt;0) ) return;
	var c = [];
	var cr = 0;
	for( var j = 1; j &lt; 10; j++ ) {
		var mj = t.name+mt+j;
		var txt = null;
		cr = expandMissionText(mj+&quot;cr&quot;); //must pay for this choice?
		if( !cr || !(cr&gt;0) || player.credits &gt;= cr ) //do not show if not enough money
			txt = expandMissionText(mj);
		if( txt &amp;&amp; txt.length &gt; 0 ) c[ j ] = txt;
	}
	if( c.length &lt; 1 ) c[0] = &quot;OK&quot;; //default choice if none is defined
//	log(t.name, &quot;Stage #&quot;+mt+&quot; c.length: &quot;+c.length+&quot; &quot;+c[0]);//debug
	mission.runScreen({
			title: &quot;The Collector (#&quot;+t.$TheCollectorMissionStage+&quot;)&quot;,
			message: m,
			background: &quot;thecollector_background.png&quot;,
			exitScreen: &quot;GUI_SCREEN_MANIFEST&quot;,
			choices: { &quot;_0&quot; : c[0],
				&quot;_1&quot; : c[1],
				&quot;_2&quot; : c[2],
				&quot;_3&quot; : c[3],
				&quot;_4&quot; : c[4],
				&quot;_5&quot; : c[5],
				&quot;_6&quot; : c[6],
				&quot;_7&quot; : c[7],
				&quot;_8&quot; : c[8],
				&quot;_9&quot; : c[9]
			}
	},function( choice ) {
			var o = 0;
			if( choice ) o = choice.substr(1); //cut starting &quot;_&quot;
			var cr = expandMissionText(t.name+mt+o+&quot;cr&quot;); //must pay for this choice?
			var r = expandMissionText(t.name+mt+o+&quot;redir&quot;);
			var redir = false;
			if( r &amp;&amp; r.length &gt; 0 ) {
				redir = true;
				if( 1*r == r ) { //redir to a single number mean new stage
					t.$TheCollectorMissionStage = r;
					t.$TheCollectorInstructions(0);
					t.$TheCollectorMissionSub = &quot;_&quot;; //begin of a new stage
				} else if( r.indexOf(&quot;_&quot;) == 0 ) { //redir begin with underscore mean new sub within this stage
					t.$TheCollectorMissionSub = r + &quot;_&quot;;
				} else { //redir into a new stage lower than the first subpage
					var i = r.indexOf(&quot;_&quot;);
					t.$TheCollectorMissionStage = r.substr(0, i);
					t.$TheCollectorInstructions(0);
					t.$TheCollectorMissionSub = r.substr(i) + &quot;_&quot;;
//		   			log(t.name, r+&quot; &quot;+t.$TheCollectorMissionStage+&quot; &quot;+t.$TheCollectorMissionSub);//debug
				}
			}
   			log(t.name, &quot;Stage:&quot;+mt+&quot; choice:&quot;+o+&quot; &quot;+c[o]+&quot; cr:&quot;+cr+&quot; redir:&quot;+r);//debug
			if( o &gt; 0 ) {
				if( cr &gt; 0 ) { //must pay for this choice!
					player.credits -= cr;
					t.$TheCollectorSound1.play();
				}
				if( !redir ) t.$TheCollectorMissionSub += o + &quot;_&quot;;
				t.$TheCollectorMissionScreen(t); //recursive, so do not use too much level
			} else return; //exit
//			if( !isValidFrameCallback( h.$HUDSelectorFCB2 ) )
//				h.$HUDSelectorFCB2 = addFrameCallback( h.$HUDSelector_FCB2 );
 	});
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
