<html>
    <head>
        <title>Expansion Station Dock Control</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Station Dock Control</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">513 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">8 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds some realism and depth to the game by giving each station with NPC traffic its own list of docked ships that launch when their scheduled departure time lapses.</td>
                    <td>Adds some realism and depth to the game by giving each station with NPC traffic its own list of docked ships that launch when their scheduled departure time lapses.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.phkb.StationDockControl</td>
                    <td>oolite.oxp.phkb.StationDockControl</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Station Dock Control</td>
                    <td>Station Dock Control</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>phkb</td>
                    <td>phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.1.26</td>
                    <td>1.1.26</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Station_Dock_Control">http://wiki.alioth.net/index.php/Station_Dock_Control</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/d/dd/StationDockControl.oxz">https://wiki.alioth.net/img_auth.php/d/dd/StationDockControl.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1656885560</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Station%20Dock%20Control'>http://wiki.alioth.net/index.php/Station%20Dock%20Control</a></p>
        <h3>readme.txt</h3>
        <pre>Station Dock Control
By Nick Rogers

Special thanks go to:
cim, for all his coding help and patience with my incessant list of questions. I couldn&#39;t have done this without your help, cim!
Anonymissimus, Norby, Disembodied, another_commander, Wildeblood, Day and all other forum members who have sent me their suggestions and feedback, without whom this OXP would not have been anywhere near as good as it could be.
To all the devs of Oolite, who are committed to making Oolite such a great base from which experiments like this can be launched.

About this OXP
==============
This OXP attempts to add some realism and depth to the game by giving each station with NPC traffic its own list of docked ships that launch when their scheduled departure time lapses. (Note: this is different to, but not incompatible with, Thargoids &quot;Traffic Control OXP&quot;, which adds a &quot;Traffic Control&quot; comms voice to stations to aid with docking). I&#39;ve categorised this OXP as &quot;Mechanics&quot; as it does change the way Oolite works at a fundamental level. Instead of ships being launched from a station on a part-random/part-balancing logic, now ships are defined ahead of time, and will launch into the system regardless of the potential for &quot;unbalancing&quot; the system. 

What does this OXP do:
1. Maintains a detailed list of ships docked at stations that have NPC traffic. This includes ship types and equipment, pilot information, escort and group information, docking bays, destination systems, and arrival and departure times.
2. Launch ships that reach their departure time, and send them on their way to other systems. Perform regular assessments of each station dock, checking its congestion level, and potentially bumping departure times for all vessels to ease launch queue pressure.
3. Automatically dock ships at stations. Most ships that enter a station will end up on the dock list.
4. Move ships through a full range of docking statuses: Inbound, Docking, Unloading, Docked, Loading, awaiting departure, and Launching (see descriptions of each of these below).
5. Simulate real-world pilot activities: Occasionally adjust ships destination, or their departure time, to simulate real-world changes in plan. Some pilots will hide their destination from GalCop authorities, so it doesn&#39;t show up on the list.

What this OXP does not do:
This OXP does not fully implement a persistent universe, where things are just where you left them in galaxies far far away. There will undoubtedly be areas where there is inconsistency. Implementing a full, static universe where every ship is accounted for and persists between saves, and where the whole universe is impacted by a time jump, is beyond the scope of this OXP. 

While this OXP is trying to add some realism, it is also attempting to do so with the smallest gameplay impact as possible. If everything works correctly, it should be possible for a player to install this OXP and not notice anything significantly different.

The OXP works on both 1.80 and 1.82, but it works better on 1.82 and later. In 1.80, ships can look slightly different on launch to how they look in the dock, but new features in 1.82 fix this. Plus, there are some bugs in 1.80 relating to ship AI and hyperspace destination systems that are fixed in 1.82. 

This OXP will work with or without RandomShipNames. If you don&#39;t use RandomShipNames, the docked list will only show ship types.

Hopefully, the things this OXP does do contribute to a much richer experience for Oolite players. 

What&#39;s happening under the surface
----------------------------------
The main change this OXP makes to the core game is to adjust the core populator function. For ships jumping into the system from somewhere else, there is no change. That should still happen using the existing logic. What has changed is the outbound functions, and it&#39;s worth taking a moment to explain the logic that this OXP uses. Previously, the standard populator would randomly launch ships of various types, but some of that randomness was mitigated by some balancing functions. That is, if there was more than a certain number of ships with a particular role, no more of that role would be created. What that did was prevent a system from having more than 3 heavy hunter groups, or 4 medium pirate freighter groups. If there are 3 or more heavy hunter groups, the populator wouldn&#39;t create anything.

In this OXP, some of that balancing is gone, because all of the ships in the docking queues are defined in advance. For ships coming into the system the balancing factor is still present, but for ships launching at a station there could very well be 5 heavy hunter groups. 

Note: **Any OXP that changes the core Oolite populator function may potentially conflict with this OXP.** If you find an OXP that does conflict please contact the me via the Oolite bulletin board so I can work out the best approach for addressing the conflict.

Any OXP that forces a station to launch ships, particularly trading vessels, shuttles, pirates, hunters or assassins, will work with this OXP, however it should be noted that those launches will happen outside of the view of this OXP and therefore they won&#39;t appear on the launching list. 

Dockside operations
===================
When the player is docked at a station that has NPC traffic and allows the list to be shown, an item called &quot;Station traffic control&quot; will be available on the Interfaces (F4) page. The title of this will vary, based on the name of the station. For instance, at a main Coriolis station, the title will be &quot;Coriolis Station traffic control&quot;.

On opening the traffic control screen, a list of ships will be displayed. Beside each ship will be a scheduled departure time or current dock status (see below), and, if the ship has lodged a flight plan, what their destination system is. This list will refresh itself periodically, even while you&#39;re viewing it.

If you select a ship from the list a &quot;Ship Information&quot; page will be displayed. This page will outline some of the information the station has about the vessel, including the name, legal status, and whether the ship is part of a group or escort. Also, pilot information will be available, including their home system and species.

Please note that data on the list is subject to change. Ship captains can change their minds about when they want to leave, or what their destination will be.

Ship captains tend to keep destination information to themselves, unless there is some benefit to sharing the information, and they will only share the information with pilots who have a reputation they can trust. If a captain has determined to trust the player their destination will be visible in the dock list and they will permit the player to launch before or after their ships, in essence offering a token group membership to the player. When a pilot has permitted this, the options &quot;Launch before this ship&quot; and &quot;Launch after this ship&quot; will be visible in the menu. The availability of these options will be based on the reputation of the player, and the relative danger of the destination system. If the player has a reputation as a pirate hunter, then traders and couriers might value the player&#39;s presence. But if the player has the reputation of a pirate or assassin, traders are likely to be wary of the player.

You can&#39;t launch before or after any ship that is due to launch in less than 10 minutes. Station launch protocols require a minimum of 10 minutes lead time for a launch.

Occasionally, when you open the Traffic Control display, you will see this: &quot;Establishing communications link with station traffic control. Please stand by.&quot; This message indicates that the station&#39;s data network is experiencing bandwidth issues. The list will appear after a short delay.

Exemptions: 
1. Police vessels are not shown in the list of docked ships. All police vessels are docked separately to civilian vessels.
2. Miners, Scavengers and other Station-specific vessels: Some stations will have a miner, scavenger, or some other craft that launch and dock periodically. These are not listed in the station traffic control list, as they fall outside of the traffic controller&#39;s work policy guidelines.
Note: While the above vessels are not included on the dock list, they will still show up as &quot;Inbound&quot; when they are docking with the station. This is purely for information purposes. Once they enter the station they are controlled by other dockyard services and will not be displayed on the list.

Status descriptions explained
-----------------------------
Ships that appear in the traffic control list can have one of five different statuses. They are:
&quot;Inbound&quot;	This indicates the ship is just outside the station and has requested permission to dock.
&quot;Docking&quot;	This indicates the ship has entered the station and is being manoeuvred into a docking bay, umbilicals are being attached, ship manifests interfaced with station systems.
&quot;Unloading&quot;	This indicates the ship has docked in station and cargo, passengers or parcels, are being unloaded/delivered.
&quot;Docked&quot;	This indicates the ship is waiting for cargo and/or departure instructions.
&quot;Loading&quot;	This indicates the ship is currently loading cargo.
Time (hh:mm)	When a time is displayed, this is the time remaining until they will launch from the station.
&quot;Launching&quot;	This indicates the ship has requested a launch slot from Traffic Control. Once they are cleared (and it may take some time if there is heavy traffic), they will be manoeuvred into the launch tunnel.

Flight operations
=================
GalCop stations also provide a data stream that can be accessed through a multi-function display (MFD). To access this data stream, first target the station, then select a MFD slot using the Shift &quot;:&quot; keyboard sequence, and then cycle through the available MFD&#39;s using the &quot;;&quot; key until the Traffic Control list appears:

/-----------------------------------------\
|Ships docking: 2   In launch corridor: 2 |
|Cobra Mark III                   Inbound |
|Python                           Inbound |
|Cobra Mark I                   Launching |
|Adder                               0:05 |
|Boa Cruiser                         0:11 |
|Gecko                               0:11 |
|Krait                               0:11 |
|Anaconda                            0:15 |
|Cobra Mark I                        0:15 |
\-----------------------------------------/

The MFD is a &quot;lite&quot; version of the main Traffic Control screen. It shows, at the top, the number of ships attempting to dock at the station, and the number of ships that are currently in the launch queue. Then the first nine entries from the traffic control list will be displayed. 

Note: There is a difference between &quot;Launching&quot; and being in the launch corridor. A ship that is launching is still inside the station in their allocated docking bay. Ships in the launch queue are being launched by the station traffic controller and should be exiting the docking port shortly.

SDC Hack Chip
=============
In some Anarchy, Feudal and Multi-Government systems where the tech level is greater than or equal to 9, if you can find a Rock Hermit (Salvage Gangs and Hack Outposts are also possibilities if those OXPs are installed) you might be able to purchase an &quot;SDC Hack Chip&quot;. The hack chip bypasses the security protocols of the main station&#39;s dock list, giving you complete visibility of all ships destinations. When you view the details for a ship with the hack chip installed, you will have an additional option: &quot;Override launch authority&quot;. Selecting this option will give you the ability to launch before or after that ship.

Using the hack chip is risky, though. GalCop takes a dim view of security breaches, and if they catch you using it, be prepared for serious repercussions. GalCop monitor their networks carefully, and using a chip like this cannot go hidden for long. It may take only a few seconds for GalCop to trace the security breach to your ship.

Third Party OXP&#39;s
=================
Several methods are available to help third party OXP&#39;s add ships to a dock, and then be informed of events that take place to those ships. Please see the separate document &quot;developer notes.txt&quot; for all information about adding ships and monitoring status.

License
=======
This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/3.0/

Station image from http://www.iconshut.com
Lock image from http://simpleicon.com/lock-2.html
Unlock image from http://simpleicon.com/lock-3.html

Discussion
==========
This OXP is discussed at this forum link: http://aegidian.org/bb/viewtopic.php?f=4&amp;t=17468

Version History
===============
1.1.26
- Added missing pirate ships from phkb&#39;s Factory paint jobs packs.
- Added In System Trader AI to exceptions.

1.1.25
- Added ships from phkb&#39;s Factory Paint Jobs packs (for Boa, Boa Mk2 and Anaconda).

1.1.24
- Fix for the thargoidStrikes populator setting.
- Correctly set initialisation for main dataset.
- Added extra dock versions of ships.

1.1.23
- Code refactoring for potential speed and memory usage improvements.

1.1.22
- Added spaces to elements in the MFD.
- When viewing station model on dock list, size of station will now not change after viewing individual ships.

1.1.21
- Added flag (accessible via Library Config) to turn of RandomShipName&#39;s ship names in the Docking list MFD.
- Ensured stations in interstellar space do not get dock lists.
- Turned off some debug messages.
- Bug fixes.

1.1.20
- Turned off debug messages.
- Added dock version of ships from Sungs Shady Ships.

1.1.19
- Further tweaks to the populator routine to prevent gridlock and avoid stations with empty docks.
- Bug fixes.

1.1.18
- Additional checking types added to ship condition checking routine.
- Tweaks to timeslot calculation code to try and prevent gridlock conditions.
- Added dock version of ships from Equipment By Ship Class OXP.

1.1.17
- Prevented player ship from appearing twice on the MFD list.
- Removed extraneous &quot;:&quot; character from ship names on MFD when RandomShipNames OXP is not installed.

1.1.16
- Bug fixes.

1.1.15
- Fixed bug that was preventing late station analysis from populating docking lists.
- Added dock version of ships from Laser Cannons OXP.
- Added dock version of ships from Military Shields Ships OXP.
- Excluded carriers (from the Carriers OXP) from being added to a station during the population process.
- Incorrect default zoom factor was being applied to ship models in the dock view.
- Adjusted the model size for some specific ships.

1.1.14
- Improved handling of systems with no data.
- Moved Taxi Stations to low traffic list.

1.1.13
- Excluded Behemoth&#39;s from having any traffic.
- Fixed method of determining whether a ship can fit in a station&#39;s dock. Function was returning true when actual result should have been false.

1.1.12
- Added Taxi Galactica stations to list of controlled stations.
- Added Tionisla Orbital Graveyard to list of controlled stations.
- Bug fixes.

1.1.11
- Turned off repopulation routines when player starts a hyperspace countdown.
- Turned off some more debug messages.
- Code refactoring.

1.1.10
- Bug fixes.

1.1.9
- Removed debug message.
- Added additional station-specific ship exclusions.
- Added protection against an &quot;undefined&quot; randomshipname being returned.
- Fixed methodology for processing escorts defined in the new format and with &quot;[]&quot; indiciating a specific ship key.
- Excluded ships from Convoys and Freighter Convoys OXP&#39;s from being added to a station during the population process.

1.1.8
- Added additional option to external menus to limit their display by station.
- Fixed issue where assassin escorts were displaying the incorrect ship type.
- Fixed issue where displaying the station model on the dock list would create a bogus station entry and empty the dock list for the current station.

1.1.7
- Added code samples contributed by forum member &quot;Day&quot;.

1.1.6
- Further attempts to increase performance.

1.1.5
- Added more dock versions of ships from Hard Ships OXP.

1.1.4
- Added dock versions of ships from Hard Ships OXP.
- Added dock versions of ships from Sniper Gun OXP.
- Added dock versions of ships from Ionics OXP.
- Added dock versions of ships from Ferdelance 3G OXP.
- Corrected dock version entries of Classic Superpythons OXP.
- Some minor tweaks for increased performance.

1.1.3
- Added some additional dock versions of a variety of ships.
- Further attempts to increase performance.

1.1.2
- Further attempts to increase performance.

1.1.1
- Attempts to control the amount of pre-work required to check that ships can fit in docks before adding them.

1.1.0
- Major code refactoring for improved performance.
- Limited maximum number of ships in any dock to be 300 to improve performance.

1.0.6
- Fixed up the default zoom setting for viewing ships in dock. Somehow I&#39;d made it super small.
- Added Pitviper Mark I and Pitviper Mark II custom display sizes.
- Cleanup of some empty data elements.
- Added missing &quot;parameter&quot; element to the external interface function.
- Fixed bug in the $removeExternalInterface function.

1.0.5
- Turned off debug mode on interface screen.

1.0.4
- Removed hard-coded scanner range value.
- Added dock versions of ships from PAG Old Ships OXP.
- Bug fixes.

1.0.3
- Fixed compatibility issue with Lib_GUI and Xenon UI, where backgrounds were being reset when F4 interface page refreshed.
- Fixed issue with incorrect personality being used when displaying ship models in dock.

1.0.2
- Restored ship detail text when viewing ships in the dock.

1.0.1
- Fixed Javascript error when docked at a station in interstellar space.
- Added some AI script exceptions.
- Added extra condition properties when checking if a ship is available or not.
- Added dock versions of ships from &quot;Vector&quot; OXP.
- Added code to check whether a ship can physically dock at a station before putting one inside (v1.85ff required).

1.0.0
- Increased failsafe range for selecting departure timeslots from one to two hours to better cope with docking bottlenecks, and added an abort procedure for when it just can&#39;t find any slots.
- Changed display settings in Lib_Config are now restored when game is reloaded.
- Bug fixes.

0.13.8
- Added dock versions of some of Griff&#39;s ships.
- Added dock versions of some Random Hits ships.
- Added dock versions of some Rescue Stations ships.
- Improvements in the way escorts are attached to motherships, to cater for more situations.
- Reduced the number of debug messages that are generated if stations aren&#39;t present on reload.
- Added some configuration settings to Lib_Config (when present).
- Fixed issue with HUD not becoming visible again when launching while viewing the dock list.
- Fixed issue with the hack chip staying installed if you launch before removing it.
- Bug fixes.

0.13.7
- Turned off a debug tool I accidentally left on.

0.13.6
- Fixed bug that was causing docking ships to be docked in non-existent stations.

0.13.5
- Added routines to let third party OXP&#39;s provide details of script properties they want SDC to make a note of so they can be relaunched with the same settings.
- Added routines to let third party OXP&#39;s provide details of their custom Javascript AI files so ships can be relaunched with the same AI.
- Fixed issue with recognising and storing the correct AI type for bounty hunter leaders.
- Added dock version of hornet_alt_npc.
- Updated &quot;developer notes.txt&quot; to include information about docking exceptions (introduced in version 0.13.4) and the two new abilities noted above.

0.13.4
- Fixed issue where docking shuttles were not being given a valid intra-system destination for when they next launch.
- Fixed faulty looping logic where a failsafe was included. Hitting the failsafe number of interations of the loop was not causing the loop to end.
- Fixed issue where launching ships were not being bumped in high-congestion states.
- Added way of allow some non-core roles to dock and be shown in the dock list.
- Function optimisation for (hopefully) better performance.
- Changed &quot;==&quot; comparisons to &quot;===&quot; for performance improvements.
- Better handling of null conditions in some routines.
- Bug fixes and code cleanup.

0.13.3
- Added some additional zoom factors for various ship types.
- Fixed some issues with the MFD screen when the player ship is destroyed.

0.13.2
- Removed the sort function at the end of the populator routine to improve performance.
- Added some checks for null values.

0.13.1
- Fixed issue with population routine that was encountering a Javascript error in certain circumstances.

0.13.0
- Restructured the main dataset to improve performance.

0.12.5
- Better handling of when ship group name is null.
- Added dock versions of more ships from WildShips.
- Added dock versions of ships from Deepspace ships.
- Added dock versions of ships from Armoured Type Transport.
- Added flag to easily prevent the population of all station dock queues.
- Added a function, $emptyAllQueues, to remove all ships from all docks in the current system.

0.12.4
- Fixed issue with undeclared local variable error introduced in 0.12.3.
- Added some missing &quot;;&quot; characters.
- Fixed &quot;docks is undefined&quot; Javascript error.

0.12.3
- Moved &quot;Pirate Coves&quot; to the &quot;No Traffic&quot; list.
- Further attempts to fix issue with slow performance when new stations are added outside of the systemWillPopulate routine.
- Turned on traffic at FTZ&#39;s. Hopefully above fix will correct issue.
- Fixed edge case where some OXP stations can occasionally get a &quot;null&quot; value for allegiance.

0.12.2
- Turned off traffic at Free Trade Zones - due to the way FTZ&#39;s are created, there is too much processing required to populate and control their docks.
- Moved a slow performing function call out of the systemWillRepopulate routine.
- Added dock versions of ships from Smivs Classic Ships.
- Added dock versions of ships from Smivs Classic Variety Pack.
- Added dock versions of ships from Smivs SuperPythons.
- Added dock versions of ships from Smivs Clippers.
- Added dock versions of ships from Smivs Classic Variety Pack.
- Added dock versions of ships from Aegidian&#39;s X Ships.
- Added dock versions of ships from Neolite&#39;s Shipset.

0.12.1
- Added more third party interfaces for monitoring docking ships, and validated other interfaces. 
- Added &quot;developer notes.txt&quot; file that describes all the third party interfaces.
- Move beta notes to a separate text file to clean up main readme.txt file.
- Updated methods for attaching scripts to ships to (hopefully) make it completely compatible with all OXP&#39;s that might also set ship scripts.
- Fixed small bug when attempting to update the MFD after the player ship is destroyed.
- Added some overrides for the zoom factor when viewing docked ships, so that Anacondas, Boas, Pythons (plus a few others) look larger than an Adder.
- Report screens or mission screens that add extra time to the clock will now cause the dock list to be refreshed.
- Updated screenID&#39;s to enable BGS background sounds.
- Renamed background overlay images to prevent possibility of future duplication.
- Toned down overlay images.
- Added extra flag to allow the ship model to spin, rather than remain static. You&#39;ll need to edit &quot;stationdockcontrol_interface.js&quot; and change line 31 from &quot;this._spinModel = false;&quot; to &quot;this._spinModel = true;&quot;
- Code refactoring.

0.12.0
- Fixed issue where the pilot insurance was not being read correctly from docking ships.
- Fixed &quot;ship is null&quot; bug.
- Updated bounty changes to use &quot;setBounty&quot; rather than updating the bounty directly.
- Updated RandomShipNames code to use roleIsInCategory function.
- Fixed issue with Free Trade Zone, where no ships were showing in the dock list.
- Prevented station monkey patch from patching itself.
- Fixed issue where Java script error could occur when checking shuttle destinations.
- Moved more static text into descriptions.plist.
- Added callback routine to ship data array, so OXP&#39;s can add a ship and then be told when the ship was launched. 
- Added more dock versions of ships from Mimoriaty ships.
- Improved the process of adding escorts, so that escort definitions that specify a particular ship (eg &quot;[sidewinder-escort]&quot;) will now attach to the mothership correctly.
- Removed some duplicates in the controlled roles array.
- Code refactoring and cleanup.

0.11.2
- Tweaked what happens when ships dock with illegal cargo - bribe attempt will be for all goods, not each one.
- Removed redundant call to &quot;checkForLaunchedShips&quot; during an escape pod activation.
- Fixed issue where some escorts where not attaching to their mothership correctly.
- Fixed shipdata entry for one of the Mimoriaty ships.
- Added more dock versions of ships from Random Hits OXP.

0.11.1
- Fixed Java script bug in debug comments during departure time change routine.
- Added more dock versions of ships from Random Hits OXP.
- Added dock versions of ships from Mimoriaty&#39;s Radical Logistics ships.

0.11.0
- Added hack chip.
- Added possibility for lowly ranked players to get launch before/after opportunities.

0.10.0
- Added more dock versions of ships from Random Hits OXP.
- Ships that dock with goods illegal to import will sometimes get an increase to their bounty.
- Added extra routine to check for orphaned group members in the rescheduler.
- Divided up WildShip stations into different station lists to better match their individual roles.
- If a station doesn&#39;t exist anymore while data resides in the array, ship data will now be slowly removed.
- Added astrofactory from Dictators.oxp to station list.
- Dock list destinations only viewable by clean pilots.
- Dock list launch before/after request options only available to clean pilots.
- Dock list launch before/after request will be hidden if the ship destination is also hidden.
- The decision to hide ship destinations is now based on the player&#39;s role as perceived by NPC&#39;s and the danger level at their destinations.
- Adjusted destination viewing period to 12 hours.
- Changed the color of menu items so it&#39;s less yellow.
- Adjusted the skip factor for adding hunters, making them slightly more regular.
- Code refactoring.
- Bug fixes.

0.9.10
- Restricted MFD display to GalCop aligned stations only.
- Changed license.

0.9.9
- Added Monkey Patch when required to make this OXP compatible with other OXP&#39;s that use &quot;otherShipDocked&quot; on stations.
- Added dock versions of ships from the Wildships OXP.
- Added dock versions of ships from the Random Hits OXP.
- Added routines to check for an escort launching before the mothership.
- Added pirate coves to station list.
- Added all rock hermits and pirate coves to list of destinations excluded for shuttles.
- If a ship using a plist AI docks, they should now get that AI back on launch.
- Added an overlay background to the Station interface screen.
- Fixed bug in rescheduler that was preventing rescheduled ships from ever launching.

0.9.8
- Fixed issue where, very rarely, the docking process tries to remove the player ship.
- Fixed bug that was causing the dock list to be recreated after loading a saved game.

0.9.7
- Tweaks to the repopulation function.
- Added the Launch Queue MFD to the HUD Selector.
- Added routine to use 1.83/4 code to check for big GUI HUD&#39;s.
- Added rockhermit-chaotic and rockhermit-pirate to station list.
- Fixed issue where requesting a launch after a ship that isn&#39;t due to launch for a considerable time may cause the dock list to be inadequately populated.

0.9.6
- Removed some test debug comments.
- Hopefully fixed scenario where purchasing equipment results in an empty dock (although the jury is out on this one!).

0.9.5
- Added check for player ship when docking ships. In a fast-dock scenario the player ship will otherwise try to be docked like other ships.
- Removed the ability to view other station docks (accidentally left on during debugging).
- Reduced logging level to minimal.
- Added functionality to add custom menu items to a ship display.
- Added Generation ships to all exclusions.
- MFD will now auto-hide itself when the target station goes out of range, and reopen when another station is targeted, if the same MFD slot is still available.

0.9.0
- Further tweaks to what stations shuttles can be sent to.
- When a wide font is used, the number of ships docking displayed in the MFD is no longer hidden.
- Tweaked the title of the dock list so it stays within the normal window bounds with wide fonts.
- Fixed issue where cancelling a docking request was not removing the player ship from the MFD list.
- Fixed issue where an expired docking request was not removing the player ship from the MFD list.
- Put &quot;bigTrader&quot; ships into the &quot;no traffic&quot; list, because these ships are likely to disappear between saves, meaning all the dock data will error when attempting to launch.
- Put interface option text into description.plist file.
- Checks for the &quot;allow_big_gui&quot; option on HUD&#39;s.
- Added station roles from the Bank of the Black Monks OXP.
- Added station roles from the Jaguar Company OXP.
- Added station roles from the Collector OXP.
- Added station roles from the Aquatics OXP.
- Added station roles from the Resistance Commander OXP.
- Added station roles from the Lave Academy OXP.
- Added station roles from the Free Trade Zone OXP.
- Added station roles from the Planetfall OXP.
- Added dock versions of ships from the Aquatics OXP.
- Ships destinations will now only become visible when the ship&#39;s departure time is under 2 hours.

0.8.0
- Prevented shuttles from heading to otherwise hidden in-system destinations (Slaver bases, hacker outposts), plus some other locations.
- Shuttles will now occasionally hide their in-system destination.
- Balancing of shuttle destinations. Closer stations will have higher probability of being selected over distant ones.
- Added dock versions of ships from the UPS Courier OXP.
- Added station roles from UPS Courier OXP.
- Split out the debug mode on the interface screen, so &quot;this._debug&quot; controls output of comments to the log, while &quot;this._mode&quot; controls what functions are available to the player.
- Fixed bug with storing additional ship roles for escorts, where roles were being stored repeatedly, instead of just once.
- Converted some strings into arrays.
- Fixed issue with MFD occasionally showing &quot;NaN&quot; errors after jumping into a new system and before the populator function has run.

0.7.0
- Improvements to the way ships are added to the system when they are added directly, moving them further away from the stations&#39; launch corridor.
- Fixed potential problem with the MFD in the (very rare) situation of having two stations in range of the player at the one time. Last station targeted will now be displayed.
- Improved the chance of making adjustments during a time jump to again better smooth out launches.
- Auto-refreshing the station dock list now doesn&#39;t lose the Xenon UI background.
- Code refactoring.

0.6.1
- Turned off station image from main view (left on by mistake!)
- Put ellipsis on text contractions

0.6.0
- Fixed issue where occasionally all system docking data is dumped just after entering a system.
- Inbound items should not appear twice on the MFD any more.
- Better handling in the MFD of the scenario where data is being populated (eg immediately after arrival in a new system).
- Hide shuttle destinations when status is Docking, Unloading, Docked or Loading (ie. same as for other ships).
- Added some adjustment runs (where ships are moved from various statuses) during a time jump process to better smooth out launches.
- Added a check for new stations being added to a system after loading a saved game (ie. via a new OXP being installed). Docked entries will now be added immediately.
- Fixed incompatibility with Gallery OXP, which was causing ship images to be displayed incorrectly.
- Expanded some of the internal documentation.
- Code cleanup and refactoring.

0.5.0
- Removed possibility that a ship will change their destination on launch.
- Included the additional roles variable in the save game file.
- Added a launch script for escort motherships, so that, if there&#39;s a delay in an escort launching, they will still get attached when the mothership launches.
- Added check for the scenario where items in the launching array are for another system.
- Removed version numbers from all JS files so there is only one version number in the manifest to update.
- Attempt to get MFD &quot;Inbound&quot; list to match dock.dockingQueueLength.

0.4.0
- Better protection against null station error when checking for ships docking.
- Fixed bug with adding escorts directly to the system.
- Added shuttle destinations to view.
- Added the possibility that a ship will change their destination on launch.
- Added a method to track primary roles I haven&#39;t seen before (in escort ships at present) so that those ships can be docked.
- Stability improvements.

0.3.0
- Rebuilding ship data list in each system to allow for ship data conditions. This should fix the issue where some ship images weren&#39;t visible on the ship details view.
- Better processing of station index values. Previously, in some conditions, the indexes were being calculated too early, meaning that some stations didn&#39;t get an index.
- Now handles an escape pod sequence.
- Force an update to dock list after most time jumps now (ie when purchasing equipment or insta-docking), rather than waiting for a repopulate.
- Motherships and escorts added directly to the system should now pair up correctly using &quot;offerToEscort&quot;.
- Updates to code based on suggestions by Wildeblood.
- Added stations from Anarchies to various lists.
- Code cleanup.

0.2.0
- Better handling of when no ship keys exist for one of the controlled roles.
- Added &quot;Next ship&quot; and &quot;Previous ship&quot; menu options when viewing ship details, to make it easier to move through the dock list.
- Code cleanup.

0.1.0
- Initial release
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_SDC_HACK_CHIP.html">SDC Hack Chip</a></td>
                    <td>yes</td>
                    <td align="right">8250</td>
                    <td align="center">1+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/dock_Falcon-E.html">dock_Falcon-E</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_PAG_monitor.html">dock_PAG_monitor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_PAG_monitor2.html">dock_PAG_monitor2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_PAG_monitor2-player.html">dock_PAG_monitor2-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_adck_anaconda.html">dock_adck_anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_adck_boa.html">dock_adck_boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_adck_boa-mk2.html">dock_adck_boa-mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_adck_python-blackdog.html">dock_adck_python-blackdog</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_adck_python-trader.html">dock_adck_python-trader</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_anaconda.html">dock_anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_anaconda-civilian.html">dock_anaconda-civilian</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_anaconda-lasercannon.html">dock_anaconda-lasercannon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_anaconda-lasercannon2.html">dock_anaconda-lasercannon2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_anaconda-military.html">dock_anaconda-military</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_anaconda-mms.html">dock_anaconda-mms</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_anaconda-performance.html">dock_anaconda-performance</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_anaconda-pirate-lasercannon.html">dock_anaconda-pirate-lasercannon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_anaconda-pirate-lasercannon2.html">dock_anaconda-pirate-lasercannon2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_anaconda-service.html">dock_anaconda-service</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_anaconda_ptt.html">dock_anaconda_ptt</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_aquatics_conger.html">dock_aquatics_conger</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_aquatics_fugu.html">dock_aquatics_fugu</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_aquatics_manOWar.html">dock_aquatics_manOWar</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_arafura.html">dock_arafura</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_arafura_ind.html">dock_arafura_ind</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_arafura_s1.html">dock_arafura_s1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_arafura_s1b.html">dock_arafura_s1b</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_arafura_s5a.html">dock_arafura_s5a</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_att1.html">dock_att1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_b_neoship_python-cruiser.html">dock_b_neoship_python-cruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa.html">dock_boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-civilian.html">dock_boa-civilian</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-clipper.html">dock_boa-clipper</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-cruiser-mms.html">dock_boa-cruiser-mms</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-dualcannon-mms.html">dock_boa-dualcannon-mms</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-lasercannon.html">dock_boa-lasercannon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-military.html">dock_boa-military</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-militcannon-mms.html">dock_boa-militcannon-mms</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-mk2.html">dock_boa-mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-mk2-lasercannon.html">dock_boa-mk2-lasercannon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-mk2-pirate-lasercannon.html">dock_boa-mk2-pirate-lasercannon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-mk2-pirate-lasercannon2.html">dock_boa-mk2-pirate-lasercannon2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-mk2_ptt.html">dock_boa-mk2_ptt</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-mms.html">dock_boa-mms</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-performance.html">dock_boa-performance</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-pirate.html">dock_boa-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-pirate-lasercannon.html">dock_boa-pirate-lasercannon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-pirate-lasercannon2.html">dock_boa-pirate-lasercannon2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-service.html">dock_boa-service</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa-sg.html">dock_boa-sg</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa3_ptt.html">dock_boa3_ptt</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa4_ptt.html">dock_boa4_ptt</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boa_ptt.html">dock_boa_ptt</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boamk2-civilian.html">dock_boamk2-civilian</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boamk2-military.html">dock_boamk2-military</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boamk2-service.html">dock_boamk2-service</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_boamk2-transit.html">dock_boamk2-transit</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_anaconda.html">dock_classic_anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_anaconda-C.html">dock_classic_anaconda-C</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_anaconda-pirate.html">dock_classic_anaconda-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_boa.html">dock_classic_boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_boa-C.html">dock_classic_boa-C</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_boa-D.html">dock_classic_boa-D</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_boa-mk2.html">dock_classic_boa-mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_boa-mk2-C.html">dock_classic_boa-mk2-C</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_boa-mk2-pirate.html">dock_classic_boa-mk2-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_boa-pirate.html">dock_classic_boa-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_python.html">dock_classic_python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_python-E.html">dock_classic_python-E</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_python-blackdog.html">dock_classic_python-blackdog</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_python-cc.html">dock_classic_python-cc</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_python-cc_pirate.html">dock_classic_python-cc_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_python-et.html">dock_classic_python-et</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_python-et_pirate.html">dock_classic_python-et_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_python-trader.html">dock_classic_python-trader</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_classic_python_D.html">dock_classic_python_D</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_deepspace_anaconda.html">dock_deepspace_anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_deepspace_anaconda-pirate.html">dock_deepspace_anaconda-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_deepspace_boa.html">dock_deepspace_boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_deepspace_boa-mk2.html">dock_deepspace_boa-mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_deepspace_boa-mk2-pirate.html">dock_deepspace_boa-mk2-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_deepspace_boa-pirate.html">dock_deepspace_boa-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_deepspace_python.html">dock_deepspace_python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_deepspace_python-blackdog.html">dock_deepspace_python-blackdog</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_deepspace_python-trader.html">dock_deepspace_python-trader</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_dtt_atlas_cargo.html">dock_dtt_atlas_cargo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ferdelance3G_hardTrader3G+Escorted.html">dock_ferdelance3G_hardTrader3G+Escorted</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ferdelance3G_hardTrader3G+EscortedVariant.html">dock_ferdelance3G_hardTrader3G+EscortedVariant</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ferdelance3G_hardTraderEscorted.html">dock_ferdelance3G_hardTraderEscorted</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ferdelance3G_hardTraderEscortedVariant.html">dock_ferdelance3G_hardTraderEscortedVariant</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ferdelance3G_hardTraderEscortedVariant2.html">dock_ferdelance3G_hardTraderEscortedVariant2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ferdelance3G_hardestHunterEscorted.html">dock_ferdelance3G_hardestHunterEscorted</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ferdelance3G_pirateKing.html">dock_ferdelance3G_pirateKing</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_anaconda-NPC.html">dock_griff_anaconda-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_anaconda_alt-NPC.html">dock_griff_anaconda_alt-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_anaconda_alt2-NPC.html">dock_griff_anaconda_alt2-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_anaconda_pirate-NPC.html">dock_griff_anaconda_pirate-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_anaconda_pirate_alt-NPC.html">dock_griff_anaconda_pirate_alt-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_anaconda_pirate_alt2-NPC.html">dock_griff_anaconda_pirate_alt2-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa-NPC.html">dock_griff_boa-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_MK2-NPC.html">dock_griff_boa_MK2-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_MK2_alt-NPC.html">dock_griff_boa_MK2_alt-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_MK2_alt2-NPC.html">dock_griff_boa_MK2_alt2-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_MK2_alt3-NPC.html">dock_griff_boa_MK2_alt3-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_MK2_pirate-NPC.html">dock_griff_boa_MK2_pirate-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_MK2_pirate_alt-NPC.html">dock_griff_boa_MK2_pirate_alt-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_MK2_pirate_alt2-NPC.html">dock_griff_boa_MK2_pirate_alt2-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_alt-NPC.html">dock_griff_boa_alt-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_alt2-NPC.html">dock_griff_boa_alt2-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_alt3-NPC.html">dock_griff_boa_alt3-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_pirate-NPC.html">dock_griff_boa_pirate-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_pirate_alt-NPC.html">dock_griff_boa_pirate_alt-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_boa_pirate_alt2-NPC.html">dock_griff_boa_pirate_alt2-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_cobra_Mk1_alt-NPC.html">dock_griff_cobra_Mk1_alt-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_moray-NPC.html">dock_griff_moray-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_prototype_boa-NPC.html">dock_griff_prototype_boa-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_prototype_boa-NPC_Pirate.html">dock_griff_prototype_boa-NPC_Pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_python_alt-NPC.html">dock_griff_python_alt-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_python_blackdog-NPC.html">dock_griff_python_blackdog-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_python_blackdog_alt-NPC.html">dock_griff_python_blackdog_alt-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_python_blackdog_alt2-NPC.html">dock_griff_python_blackdog_alt2-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_python_blackdog_alt3-NPC.html">dock_griff_python_blackdog_alt3-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_python_trader-NPC.html">dock_griff_python_trader-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_python_trader_alt-NPC.html">dock_griff_python_trader_alt-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_python_trader_alt2-NPC.html">dock_griff_python_trader_alt2-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_python_trader_alt3-NPC.html">dock_griff_python_trader_alt3-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_griff_python_trader_alt4-NPC.html">dock_griff_python_trader_alt4-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_hard-anaconda.html">dock_hard-anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_hard-boa.html">dock_hard-boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_hard-boa2.html">dock_hard-boa2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_hardanacondax.html">dock_hardanacondax</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_hardanacondax-pirate.html">dock_hardanacondax-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_hardboa-pirate.html">dock_hardboa-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_hardboa2-pirate.html">dock_hardboa2-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_hardpython-pirate.html">dock_hardpython-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_himsn_boa_mk2.html">dock_himsn_boa_mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_hornet_alt_npc.html">dock_hornet_alt_npc</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ionics_redback-pirate.html">dock_ionics_redback-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ionics_redback-trader.html">dock_ionics_redback-trader</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ionics_redback_mission.html">dock_ionics_redback_mission</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ionics_rlf_leader.html">dock_ionics_rlf_leader</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_kirin-cv.html">dock_kirin-cv</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_kirin-hunter.html">dock_kirin-hunter</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_kirin-m.html">dock_kirin-m</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_kirin-xm.html">dock_kirin-xm</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_medical_anaconda.html">dock_medical_anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_neo_anaconda.html">dock_neo_anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_neo_boa.html">dock_neo_boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_neo_boa-mk2.html">dock_neo_boa-mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_neo_python-blackdog.html">dock_neo_python-blackdog</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_neo_python-trader.html">dock_neo_python-trader</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_noshaders_lira-trader_normal_clean.html">dock_noshaders_lira-trader_normal_clean</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_noshaders_lira-trader_normal_colonial.html">dock_noshaders_lira-trader_normal_colonial</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_noshaders_lira-trader_normal_green.html">dock_noshaders_lira-trader_normal_green</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_noshaders_lira-trader_normal_grey.html">dock_noshaders_lira-trader_normal_grey</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_oolite_template_anaconda.html">dock_oolite_template_anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_oolite_template_anaconda-pirate.html">dock_oolite_template_anaconda-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_oolite_template_asp-cloaked.html">dock_oolite_template_asp-cloaked</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_oolite_template_boa.html">dock_oolite_template_boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_oolite_template_boa-mk2.html">dock_oolite_template_boa-mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_oolite_template_boa-mk2-pirate.html">dock_oolite_template_boa-mk2-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_oolite_template_boa-pirate.html">dock_oolite_template_boa-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_oolite_template_python.html">dock_oolite_template_python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_oolite_template_python-blackdog.html">dock_oolite_template_python-blackdog</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_oolite_template_python-trader.html">dock_oolite_template_python-trader</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_1.html">dock_phkb_anaconda_1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_10.html">dock_phkb_anaconda_10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_10_pirate.html">dock_phkb_anaconda_10_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_11.html">dock_phkb_anaconda_11</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_11_pirate.html">dock_phkb_anaconda_11_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_12.html">dock_phkb_anaconda_12</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_12_pirate.html">dock_phkb_anaconda_12_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_13.html">dock_phkb_anaconda_13</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_13_pirate.html">dock_phkb_anaconda_13_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_14.html">dock_phkb_anaconda_14</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_14_pirate.html">dock_phkb_anaconda_14_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_15.html">dock_phkb_anaconda_15</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_15_pirate.html">dock_phkb_anaconda_15_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_16.html">dock_phkb_anaconda_16</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_16_pirate.html">dock_phkb_anaconda_16_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_17.html">dock_phkb_anaconda_17</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_17_pirate.html">dock_phkb_anaconda_17_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_18.html">dock_phkb_anaconda_18</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_18_pirate.html">dock_phkb_anaconda_18_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_19.html">dock_phkb_anaconda_19</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_19_pirate.html">dock_phkb_anaconda_19_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_1_pirate.html">dock_phkb_anaconda_1_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_2.html">dock_phkb_anaconda_2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_20.html">dock_phkb_anaconda_20</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_20_pirate.html">dock_phkb_anaconda_20_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_21.html">dock_phkb_anaconda_21</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_21_pirate.html">dock_phkb_anaconda_21_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_22.html">dock_phkb_anaconda_22</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_22_pirate.html">dock_phkb_anaconda_22_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_23.html">dock_phkb_anaconda_23</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_23_pirate.html">dock_phkb_anaconda_23_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_24.html">dock_phkb_anaconda_24</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_24_pirate.html">dock_phkb_anaconda_24_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_25.html">dock_phkb_anaconda_25</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_25_pirate.html">dock_phkb_anaconda_25_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_26.html">dock_phkb_anaconda_26</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_26_pirate.html">dock_phkb_anaconda_26_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_27.html">dock_phkb_anaconda_27</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_27_pirate.html">dock_phkb_anaconda_27_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_28.html">dock_phkb_anaconda_28</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_28_pirate.html">dock_phkb_anaconda_28_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_29.html">dock_phkb_anaconda_29</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_29_pirate.html">dock_phkb_anaconda_29_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_2_pirate.html">dock_phkb_anaconda_2_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_3.html">dock_phkb_anaconda_3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_30.html">dock_phkb_anaconda_30</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_30_pirate.html">dock_phkb_anaconda_30_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_31.html">dock_phkb_anaconda_31</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_31_pirate.html">dock_phkb_anaconda_31_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_32.html">dock_phkb_anaconda_32</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_32_pirate.html">dock_phkb_anaconda_32_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_33.html">dock_phkb_anaconda_33</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_33_pirate.html">dock_phkb_anaconda_33_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_34.html">dock_phkb_anaconda_34</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_34_pirate.html">dock_phkb_anaconda_34_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_35.html">dock_phkb_anaconda_35</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_35_pirate.html">dock_phkb_anaconda_35_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_36.html">dock_phkb_anaconda_36</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_36_pirate.html">dock_phkb_anaconda_36_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_3_pirate.html">dock_phkb_anaconda_3_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_4.html">dock_phkb_anaconda_4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_4_pirate.html">dock_phkb_anaconda_4_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_5.html">dock_phkb_anaconda_5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_5_pirate.html">dock_phkb_anaconda_5_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_6.html">dock_phkb_anaconda_6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_6_pirate.html">dock_phkb_anaconda_6_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_7.html">dock_phkb_anaconda_7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_7_pirate.html">dock_phkb_anaconda_7_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_8.html">dock_phkb_anaconda_8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_8_pirate.html">dock_phkb_anaconda_8_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_9.html">dock_phkb_anaconda_9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_anaconda_9_pirate.html">dock_phkb_anaconda_9_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_1.html">dock_phkb_boa-mk2_1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_10.html">dock_phkb_boa-mk2_10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_10_pirate.html">dock_phkb_boa-mk2_10_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_11.html">dock_phkb_boa-mk2_11</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_11_pirate.html">dock_phkb_boa-mk2_11_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_12.html">dock_phkb_boa-mk2_12</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_12_pirate.html">dock_phkb_boa-mk2_12_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_13.html">dock_phkb_boa-mk2_13</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_13_pirate.html">dock_phkb_boa-mk2_13_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_14.html">dock_phkb_boa-mk2_14</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_14_pirate.html">dock_phkb_boa-mk2_14_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_15.html">dock_phkb_boa-mk2_15</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_15_pirate.html">dock_phkb_boa-mk2_15_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_16.html">dock_phkb_boa-mk2_16</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_16_pirate.html">dock_phkb_boa-mk2_16_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_17.html">dock_phkb_boa-mk2_17</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_17_pirate.html">dock_phkb_boa-mk2_17_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_18.html">dock_phkb_boa-mk2_18</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_18_pirate.html">dock_phkb_boa-mk2_18_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_19.html">dock_phkb_boa-mk2_19</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_19_pirate.html">dock_phkb_boa-mk2_19_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_1_pirate.html">dock_phkb_boa-mk2_1_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_2.html">dock_phkb_boa-mk2_2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_20.html">dock_phkb_boa-mk2_20</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_20_pirate.html">dock_phkb_boa-mk2_20_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_21.html">dock_phkb_boa-mk2_21</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_21_pirate.html">dock_phkb_boa-mk2_21_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_22.html">dock_phkb_boa-mk2_22</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_22_pirate.html">dock_phkb_boa-mk2_22_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_23.html">dock_phkb_boa-mk2_23</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_23_pirate.html">dock_phkb_boa-mk2_23_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_24.html">dock_phkb_boa-mk2_24</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_24_pirate.html">dock_phkb_boa-mk2_24_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_25.html">dock_phkb_boa-mk2_25</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_25_pirate.html">dock_phkb_boa-mk2_25_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_26.html">dock_phkb_boa-mk2_26</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_26_pirate.html">dock_phkb_boa-mk2_26_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_27.html">dock_phkb_boa-mk2_27</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_27_pirate.html">dock_phkb_boa-mk2_27_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_28.html">dock_phkb_boa-mk2_28</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_28_pirate.html">dock_phkb_boa-mk2_28_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_29.html">dock_phkb_boa-mk2_29</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_29_pirate.html">dock_phkb_boa-mk2_29_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_2_pirate.html">dock_phkb_boa-mk2_2_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_3.html">dock_phkb_boa-mk2_3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_30.html">dock_phkb_boa-mk2_30</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_30_pirate.html">dock_phkb_boa-mk2_30_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_31.html">dock_phkb_boa-mk2_31</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_31_pirate.html">dock_phkb_boa-mk2_31_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_32.html">dock_phkb_boa-mk2_32</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_32_pirate.html">dock_phkb_boa-mk2_32_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_33.html">dock_phkb_boa-mk2_33</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_33_pirate.html">dock_phkb_boa-mk2_33_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_34.html">dock_phkb_boa-mk2_34</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_34_pirate.html">dock_phkb_boa-mk2_34_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_35.html">dock_phkb_boa-mk2_35</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_35_pirate.html">dock_phkb_boa-mk2_35_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_36.html">dock_phkb_boa-mk2_36</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_36_pirate.html">dock_phkb_boa-mk2_36_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_3_pirate.html">dock_phkb_boa-mk2_3_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_4.html">dock_phkb_boa-mk2_4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_4_pirate.html">dock_phkb_boa-mk2_4_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_5.html">dock_phkb_boa-mk2_5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_5_pirate.html">dock_phkb_boa-mk2_5_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_6.html">dock_phkb_boa-mk2_6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_6_pirate.html">dock_phkb_boa-mk2_6_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_7.html">dock_phkb_boa-mk2_7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_7_pirate.html">dock_phkb_boa-mk2_7_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_8.html">dock_phkb_boa-mk2_8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_8_pirate.html">dock_phkb_boa-mk2_8_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_9.html">dock_phkb_boa-mk2_9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa-mk2_9_pirate.html">dock_phkb_boa-mk2_9_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_1.html">dock_phkb_boa_1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_10.html">dock_phkb_boa_10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_10_pirate.html">dock_phkb_boa_10_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_11.html">dock_phkb_boa_11</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_11_pirate.html">dock_phkb_boa_11_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_12.html">dock_phkb_boa_12</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_12_pirate.html">dock_phkb_boa_12_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_13.html">dock_phkb_boa_13</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_13_pirate.html">dock_phkb_boa_13_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_14.html">dock_phkb_boa_14</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_14_pirate.html">dock_phkb_boa_14_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_15.html">dock_phkb_boa_15</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_15_pirate.html">dock_phkb_boa_15_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_16.html">dock_phkb_boa_16</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_16_pirate.html">dock_phkb_boa_16_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_17.html">dock_phkb_boa_17</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_17_pirate.html">dock_phkb_boa_17_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_18.html">dock_phkb_boa_18</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_18_pirate.html">dock_phkb_boa_18_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_19.html">dock_phkb_boa_19</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_19_pirate.html">dock_phkb_boa_19_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_1_pirate.html">dock_phkb_boa_1_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_2.html">dock_phkb_boa_2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_20.html">dock_phkb_boa_20</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_20_pirate.html">dock_phkb_boa_20_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_21.html">dock_phkb_boa_21</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_21_pirate.html">dock_phkb_boa_21_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_22.html">dock_phkb_boa_22</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_22_pirate.html">dock_phkb_boa_22_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_23.html">dock_phkb_boa_23</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_23_pirate.html">dock_phkb_boa_23_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_24.html">dock_phkb_boa_24</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_24_pirate.html">dock_phkb_boa_24_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_25.html">dock_phkb_boa_25</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_25_pirate.html">dock_phkb_boa_25_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_26.html">dock_phkb_boa_26</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_26_pirate.html">dock_phkb_boa_26_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_27.html">dock_phkb_boa_27</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_27_pirate.html">dock_phkb_boa_27_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_28.html">dock_phkb_boa_28</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_28_pirate.html">dock_phkb_boa_28_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_29.html">dock_phkb_boa_29</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_29_pirate.html">dock_phkb_boa_29_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_2_pirate.html">dock_phkb_boa_2_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_3.html">dock_phkb_boa_3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_30.html">dock_phkb_boa_30</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_30_pirate.html">dock_phkb_boa_30_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_31.html">dock_phkb_boa_31</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_31_pirate.html">dock_phkb_boa_31_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_32.html">dock_phkb_boa_32</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_32_pirate.html">dock_phkb_boa_32_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_33.html">dock_phkb_boa_33</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_33_pirate.html">dock_phkb_boa_33_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_34.html">dock_phkb_boa_34</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_34_pirate.html">dock_phkb_boa_34_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_35.html">dock_phkb_boa_35</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_35_pirate.html">dock_phkb_boa_35_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_36.html">dock_phkb_boa_36</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_36_pirate.html">dock_phkb_boa_36_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_3_pirate.html">dock_phkb_boa_3_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_4.html">dock_phkb_boa_4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_4_pirate.html">dock_phkb_boa_4_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_5.html">dock_phkb_boa_5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_5_pirate.html">dock_phkb_boa_5_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_6.html">dock_phkb_boa_6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_6_pirate.html">dock_phkb_boa_6_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_7.html">dock_phkb_boa_7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_7_pirate.html">dock_phkb_boa_7_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_8.html">dock_phkb_boa_8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_8_pirate.html">dock_phkb_boa_8_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_9.html">dock_phkb_boa_9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_phkb_boa_9_pirate.html">dock_phkb_boa_9_pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python.html">dock_python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-battlecruiser-mms.html">dock_python-battlecruiser-mms</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-blackdog.html">dock_python-blackdog</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-blackdog-lasercannon.html">dock_python-blackdog-lasercannon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-blackdog-lasercannon2.html">dock_python-blackdog-lasercannon2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-civilian.html">dock_python-civilian</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-clipper.html">dock_python-clipper</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-clipper-alternative.html">dock_python-clipper-alternative</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-lasercannon.html">dock_python-lasercannon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-military.html">dock_python-military</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-mms.html">dock_python-mms</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-service.html">dock_python-service</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-sg.html">dock_python-sg</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-sg-mms.html">dock_python-sg-mms</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-staer9-mms.html">dock_python-staer9-mms</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-trader.html">dock_python-trader</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-trader-lasercannon.html">dock_python-trader-lasercannon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-trader-lasercannon2.html">dock_python-trader-lasercannon2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python-transit.html">dock_python-transit</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python2_ptt.html">dock_python2_ptt</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python3_ptt.html">dock_python3_ptt</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python_ptt.html">dock_python_ptt</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python_red-mms.html">dock_python_red-mms</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_python_x.html">dock_python_x</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_big_boss_cobra4_spacelane.html">dock_random_hits_big_boss_cobra4_spacelane</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_big_boss_iguana_spacelane.html">dock_random_hits_big_boss_iguana_spacelane</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_big_boss_impcourier_spacelane.html">dock_random_hits_big_boss_impcourier_spacelane</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_big_boss_imptrader_spacelane.html">dock_random_hits_big_boss_imptrader_spacelane</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_big_boss_pitviper_spacelane.html">dock_random_hits_big_boss_pitviper_spacelane</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_big_boss_supercobra_spacelane.html">dock_random_hits_big_boss_supercobra_spacelane</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_big_boss_vamppurg_spacelane.html">dock_random_hits_big_boss_vamppurg_spacelane</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_big_boss_wolfmk2SE_spacelane.html">dock_random_hits_big_boss_wolfmk2SE_spacelane</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_anaconda.html">dock_random_hits_mark_anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_arachnid.html">dock_random_hits_mark_arachnid</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_asp.html">dock_random_hits_mark_asp</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_aspmk1.html">dock_random_hits_mark_aspmk1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_aspspec.html">dock_random_hits_mark_aspspec</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_boa.html">dock_random_hits_mark_boa</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_boa2.html">dock_random_hits_mark_boa2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_bushmaster.html">dock_random_hits_mark_bushmaster</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_cat.html">dock_random_hits_mark_cat</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_chameleon.html">dock_random_hits_mark_chameleon</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_cobra3.html">dock_random_hits_mark_cobra3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_cobra3courier.html">dock_random_hits_mark_cobra3courier</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_cobra3rapier.html">dock_random_hits_mark_cobra3rapier</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_cobra4.html">dock_random_hits_mark_cobra4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_cobras9.html">dock_random_hits_mark_cobras9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_cutlass.html">dock_random_hits_mark_cutlass</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_dttmk1.html">dock_random_hits_mark_dttmk1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_ferdelance.html">dock_random_hits_mark_ferdelance</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_galtech_escort_fighter.html">dock_random_hits_mark_galtech_escort_fighter</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_ghavial.html">dock_random_hits_mark_ghavial</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_gnat.html">dock_random_hits_mark_gnat</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_igu.html">dock_random_hits_mark_igu</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_imp.html">dock_random_hits_mark_imp</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_imptrader.html">dock_random_hits_mark_imptrader</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_monitor.html">dock_random_hits_mark_monitor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_monitor2.html">dock_random_hits_mark_monitor2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_mussurana.html">dock_random_hits_mark_mussurana</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_pcc.html">dock_random_hits_mark_pcc</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_phaze.html">dock_random_hits_mark_phaze</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_pitviper.html">dock_random_hits_mark_pitviper</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_python.html">dock_random_hits_mark_python</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_pythonet.html">dock_random_hits_mark_pythonet</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge1.html">dock_random_hits_mark_revenge1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge10.html">dock_random_hits_mark_revenge10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge11.html">dock_random_hits_mark_revenge11</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge13.html">dock_random_hits_mark_revenge13</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge14.html">dock_random_hits_mark_revenge14</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge15.html">dock_random_hits_mark_revenge15</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge2.html">dock_random_hits_mark_revenge2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge3.html">dock_random_hits_mark_revenge3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge4.html">dock_random_hits_mark_revenge4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge5.html">dock_random_hits_mark_revenge5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge6.html">dock_random_hits_mark_revenge6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge7.html">dock_random_hits_mark_revenge7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge8.html">dock_random_hits_mark_revenge8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_revenge9.html">dock_random_hits_mark_revenge9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_salamander.html">dock_random_hits_mark_salamander</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_supercobra.html">dock_random_hits_mark_supercobra</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_vamppurg.html">dock_random_hits_mark_vamppurg</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_random_hits_mark_wolf.html">dock_random_hits_mark_wolf</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_big_boss_cobra4_spacelane_shipset.html">dock_rhs_big_boss_cobra4_spacelane_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_big_boss_iguana_spacelane_shipset.html">dock_rhs_big_boss_iguana_spacelane_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_big_boss_impcourier_spacelane_shipset.html">dock_rhs_big_boss_impcourier_spacelane_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_big_boss_imptrader_spacelane_shipset.html">dock_rhs_big_boss_imptrader_spacelane_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_big_boss_pitviper_spacelane_shipset.html">dock_rhs_big_boss_pitviper_spacelane_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_big_boss_supercobra_spacelane_shipset.html">dock_rhs_big_boss_supercobra_spacelane_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_big_boss_vamppurg_spacelane_shipset.html">dock_rhs_big_boss_vamppurg_spacelane_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_big_boss_wolfmk2SE_spacelane_shipset.html">dock_rhs_big_boss_wolfmk2SE_spacelane_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_arachnid_shipset.html">dock_rhs_mark_arachnid_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_aspmk1_shipset.html">dock_rhs_mark_aspmk1_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_cobra3courier_shipset.html">dock_rhs_mark_cobra3courier_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_cobra3rapier_shipset.html">dock_rhs_mark_cobra3rapier_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_cobra4_shipset.html">dock_rhs_mark_cobra4_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_cobras9_shipset.html">dock_rhs_mark_cobras9_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_drake2_shipset.html">dock_rhs_mark_drake2_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_dttmk1_shipset.html">dock_rhs_mark_dttmk1_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_galtech_escort_fighter_shipset.html">dock_rhs_mark_galtech_escort_fighter_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_ghavial_shipset.html">dock_rhs_mark_ghavial_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_gnat_shipset.html">dock_rhs_mark_gnat_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_imp_shipset.html">dock_rhs_mark_imp_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_imptrader_shipset.html">dock_rhs_mark_imptrader_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_phaze_shipset.html">dock_rhs_mark_phaze_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_pitviper_shipset.html">dock_rhs_mark_pitviper_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_supercobra_shipset.html">dock_rhs_mark_supercobra_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_vamppurg_shipset.html">dock_rhs_mark_vamppurg_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_rhs_mark_wolf_shipset.html">dock_rhs_mark_wolf_shipset</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_sb_neoship_monitor.html">dock_sb_neoship_monitor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_sb_neoship_python-cruiser.html">dock_sb_neoship_python-cruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_staer9_monitor.html">dock_staer9_monitor</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_staer9_monitor-pirate.html">dock_staer9_monitor-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_staer9_monitor2.html">dock_staer9_monitor2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_staer9_monitor2-pirate.html">dock_staer9_monitor2-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_staer9_python-cruiser.html">dock_staer9_python-cruiser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_staer9_python-cruiser-pirate.html">dock_staer9_python-cruiser-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_staer9_python-x.html">dock_staer9_python-x</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_staer9_python-x-pirate.html">dock_staer9_python-x-pirate</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_taurockhopper.html">dock_taurockhopper</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ups-sun-anaconda.html">dock_ups-sun-anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ups-sun-boa-mk2.html">dock_ups-sun-boa-mk2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_ups-sun2-anaconda.html">dock_ups-sun2-anaconda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_vector.html">dock_vector</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_vector_benus.html">dock_vector_benus</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_vector_frood.html">dock_vector_frood</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_vector_geek.html">dock_vector_geek</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_vector_millionaire.html">dock_vector_millionaire</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_vortex-maelstrom-NPC.html">dock_vortex-maelstrom-NPC</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_wildShips_chatu.html">dock_wildShips_chatu</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_wildShips_chatu_trader.html">dock_wildShips_chatu_trader</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_wildShips_tembo.html">dock_wildShips_tembo</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/dock_wildShips_tribalChatu.html">dock_wildShips_tribalChatu</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/stationdockcontrol.js</td>
                    <td><pre>(function () {
	&quot;use strict&quot;;
	this.name = &quot;StationDockControl&quot;;
	this.author = &quot;phkb&quot;;
	this.copyright = &quot;2015 phkb&quot;;
	this.description = &quot;Displays list of ships docked at the current station, as well as controlling when ships launch.&quot;;
	this.licence = &quot;CC BY-NC-SA 3.0&quot;;

	/*
		This OXP attempts to provide a list of docked ships at most stations. Ships in this list will launch when their allocated 
		launch slot becomes current, and ships that dock at the station are added to the list. See the readme.txt file for 
		more information.

		Future ideas:
		- Having some traders head to other trade stations in system, rather than just jumping out
		- Change $clearLaunchedShips to move ships to their destination system instead of just removing them, possibly dropping a couple of 
			escorts or group members based on system danger level
		- if their destination system is the player&#39;s system, then create them as ships in system after the player arrives.
		- Look into ships entering wormholes, and decide how to process:
			- need to wait until ship becomes invalid (which isn&#39;t as soon as they enter the wormhole)
			- if the wormhole collapses, make a note of all the ships that entered and dock them at the destination station 
				(maybe drop a couple of escorts or group members based on system danger level)
			- if the wormhole destination is the same as the players, possibly add the ships to the system just before the player arrives, 
				but some distance along the wp-planet lane.
				- again need to check for invalid, as the core will do this itself if they&#39;re still valid when the player arrives
		- Make player ship move from Docking to Unloading to Docked
		- Announce arrivals via console messages (ie. &quot;Cobra Mark III: The Iconic has just docked in docking bay CX-123&quot;, 
			&quot;Anaconda (plus escorts) departing in 10 minutes&quot;)
		- Give player ability to log an alert when a ship changes their destination or departure time
		- Give player ability to make a note of a ship, and when it reaches 10 minutes to departure, alert the player
		- Change commodity levels based on docking/departing ships. Take cargo from docking ships and add to manifest screen, take cargo 
			from manifest screen when ships are in &quot;loading&quot; status. Adjust prices as well.
			- will need some sort of AI to decide how this works on non-main stations.

		Limitations:
		1. The method chosen to force Oolite to create a single ship (without any escorts) involves creating a shipdata.plist 
			entry for each ship that might have escorts.
			This means, if a ship that is unknown to this OXP is added to Oolite, there many be cases where ships are added to the 
			system that don&#39;t appear on the traffic control list.

		ISSUES:
		- Occasionally seeing launches that didn&#39;t come from the list (eg Hognose evangelists). 
			Where are they coming from, and can/should this be addressed?
		- Some shipdata.plist entries don&#39;t have a &quot;auto_ai&quot; value set at all - it&#39;s &quot;undefined&quot;. In these instances, I&#39;m making 
			the assumption that this means the ship can have an auto ai assigned to it.
		- Because we are creating ships based on data keys, not roles, we need to be a bit more explicit when it comes to AI settings. 
			So we are generally setting the AI for every ship we create, even standard traders, to ensure everything has an AI.
		- Lone escorts that dock with a station will be switched to &quot;trader&quot; if they have cargo space and a hyperdrive. If they 
			have no cargo but only a hyperdrive, they&#39;ll choose to become a &quot;trader-courier&quot;. Otherwise they&#39;ll dry-dock their ship 
			and get some R&amp;R (ship entry will be removed)

		TESTS:
		1. Station traffic at main stations in different systems is equivalent to original
		2. Traffic at non-main stations is equivalent
		3. Traffic at hasNPCTraffic = no is equivalent
		4. Balance of ships is not affected too much
		5. Test what happens to groups/escorts when they dock - does the system pick up all the group info correctly (leader, members 
			appear after leader, difference between escort and group)
		6. Memory footprint - how much memory is being used by the data requirements, how do you test memory usage in Oolite. Task Manager?

	*/
	this._disable = false; // quick way to disable the OXP without removing it.
	this._disableQueues = false; // flag to stop the population of all station dock queues
	this._systemDockingData = []; // main dataset
	this._stationAdjust = false; // flag to determine whether all system stations have had the new &quot;otherShipDocked&quot; function added to them
	this._rsnInstalled = false; // indicates whether randomshipnames OXP is installed
	this._launching = []; // subset of main array used for launching ships
	this._docking = []; // list of ships that are currently attempting to dock with the players docked station
	this._autoGenerationInProgress = false; // indicates that the process of auto-generating docked ships is in progress
	this._stationBayCodes = []; // holding array of station docking bay codes, used during an auto-generation process
	this._quickUpdateTimer = null;
	this._launchTimer = null; // timer to move ships to the launching array
	this._launchListUpdating = false; // flag to indicate the launching list is updating
	this._jumpStarted = false;
	this._randomShips = {}; // array of ship roles, types and data keys
	this._shipData = {};
	this._launchingGroups = []; // used to hold groups being launched at stations
	this._launchingEscorts = []; // used to hold escort leaders being launched at stations
	this._stationList = []; // list of stations and indexes for the current system
	this._shuttleDest = null; // list of in-system destinations (stations) shuttles can be sent to
	this._stationIndexesLoaded = false; // flag to indicate when the station indexes have been loaded
	this._stationIndexCount = 0;
	this._neighbours = null; // array of neighbouring systems
	this._populatorVars = null;
	this._repopulate = false; // flag to determine whether a repopulate process will take place (usually after a large time jump)
	this._running = false;
	this._repopulateFactor = 0; // determines how deep into the dock list ships will be added on repopulate
	this._repopulateStation = null; // object to hold new station which didn&#39;t exist before but now needs to be populated
	this._populateStation = [];
	this._populateTimer = null;
	this._adjustDepartureBands = 0; // counter to determine when to run the adjust departure routine
	this._escortCounter = 1; // internal reference counter for escorts
	this._groupCounter = 1; // internal reference counter for groups
	this._shipMonitor = 0; // variable to keep track of when to do a population count to the log file, and also assess station docks
	this._smuggling = false; // flag to indicate the smuggling OXP is in use
	this._lateStations = []; // array of stations created after systemWillPopulate to be processed by the dock populator
	this._limit = 0;
	//this._doShipDockDataGrab = {};
	//=============================================================================================================
	// user settings
	this._debug = false; // set to true to output various messages to the log, false will disable all logging messages
	this._logLaunchType = 0; // how to log launch events: 0 = not logged, 1 = minimal, 2 = full
	this._logDockingType = 0; // how to log docking events: 0 = not logged, 1 = minimal, 2 = full
	this._logAdjustmentType = 0; // how to log adjustments: 0 = not logged, 1 = type only, 2 = full
	this._logPopulatorType = 0; // how to log populator events: 0 = not logged, 1 = minimal, 2 = full, 3 = full + escort definition data
	// The following settings can be adjusted to effect the number of ships added to the docking list.
	// See the this.$populateStationList function for more information on what is happening with these numbers
	this._traderSkipVesselFactor = 0; // increase to reduce the number of times a potential new trader vessel will be skipped.
	//      0 = no chance of skipping vessels (disabled)
	//		1 = high chance of skipping vessels
	//		2
	//		3
	//		4
	//		... lower and lower chance of skipping vessels
	this._pirateSkipVesselFactor = 5; // increase to reduce the number of times a potential new pirate group will be skipped.
	this._hunterSkipVesselFactor = 8; // increase to reduce the number of times a potential new hunter group will be skipped.
	// these next 5 variables control the frequency and size of adjustments to the docking lists
	this._adjustDepartureChance = 0.3; // decimal between 0 and 1, higher number means more ships will move from &quot;docked&quot; to &quot;loading&quot; or from &quot;loading&quot; to departing
	this._adjustRuns = 2; // how many adjustment runs to do on each cycle (will reduce to 1 when in flight)
	this._adjustDepartureFreq = 0; // number greater than or equal to 0. determines the frequency of the adjust Departure routine.
	// 0 means every 20 seconds (after 1 systemWillRepopulate cycles, ie every time)
	// 1 means every 40 seconds (after 2 systemWillRepopulate cycles)
	// 2 means every 60 seconds (after 3 systemWillRepopulate cycles)
	this._maxAdjustments = 3; // maximum possible number of adjustments to do on any adjustment cycle
	this._noAdjustPeriod = 600; // the number of seconds that must elapse before a ship can be adjusted again (default is 600 = 10 minutes)
	// types of adjustment functions to select from:
	// 0 = do nothing,
	// 1 = docking to unloading, unloading to docked, docked to loading, loading to departing,
	// 2 = adjust departure time,
	// 3 = adjust destination
	this._adjustFunctions = [1, 0, 1, 1, 1, 2, 0, 2, 2, 0, 2, 2, 0, 2, 2, 3, 3];
	// these next items control the amount of traffic that will be generated at the different stations.
	// the default is &quot;High&quot;, and any station that doesn&#39;t fit any of the roles below will default to this.
	// note: if a station has the &quot;has_npc_traffic&quot; flag set to false, it will override whatever is in this list
	this._trafficMedium = [&quot;constore&quot;, &quot;random_hits_any_spacebar&quot;, &quot;sfep_station&quot;, &quot;wildShips_kiota2Disc&quot;, &quot;wildShips_kiota4Disc&quot;,
		&quot;wildShips_kiota4Sphere&quot;, &quot;wildShips_kiota2Sphere&quot;
	];
	this._trafficLow = [&quot;rrs_group_spacestation&quot;, &quot;rrs_astromine&quot;, &quot;rrs-mining-outpost&quot;, &quot;casinoship&quot;, &quot;comczgf&quot;, &quot;bigTrader&quot;,
		&quot;ups_dependance&quot;, &quot;ups_dependance2&quot;, &quot;blackmonk_monastery&quot;, &quot;aquatics_HQ&quot;, &quot;wildShips_kiota2Comms&quot;, &quot;wildShips_kiota4Comms&quot;,
		&quot;wildShips_kiota2Spur&quot;, &quot;wildShips_kiota4Solar&quot;, &quot;wildShips_kiota2Solar&quot;, &quot;astrofactory&quot;, &quot;free_trade_zone&quot;, &quot;togy_station&quot;, &quot;tgy_station&quot;,
		&quot;taxi_station&quot;
	];
	this._trafficVeryLow = [&quot;rockhermit&quot;, &quot;rockhermit-chaotic&quot;, &quot;rockhermit-pirate&quot;, &quot;repaired-buoy-station&quot;, &quot;anarchies_renegade_station&quot;,
		&quot;anarchies_salvage_gang&quot;, &quot;GW-rock-hermit&quot;
	];
	this._trafficNone = [&quot;slaver_base&quot;, &quot;rrs_slaverbase&quot;, &quot;anarchies_hacker_outpost&quot;, &quot;anarchies_sentinel_station&quot;, &quot;bigTrader&quot;,
		&quot;thecollector_adck_coriolis-station&quot;, &quot;jaguar_company_base&quot;, &quot;GW-fuel-processor&quot;, &quot;GW-comms-station&quot;, &quot;laveAcademy_academy&quot;,
		&quot;planetFall_surface&quot;, &quot;generationship&quot;, &quot;IST_genship carrier&quot;, &quot;behemoth&quot;
	];
	this._shuttleTrafficNone = [&quot;pirate-cove&quot;, &quot;slaver_base&quot;, &quot;rrs_slaverbase&quot;, &quot;anarchies_hacker_outpost&quot;, &quot;anarchies_sentinel_station&quot;,
		&quot;bigTrader&quot;, &quot;thecollector_adck_coriolis-station&quot;, &quot;jaguar_company_base&quot;, &quot;GW-fuel-processor&quot;, &quot;GW-comms-station&quot;, &quot;generationship&quot;,
		&quot;IST_genship carrier&quot;, &quot;rockhermit&quot;, &quot;rockhermit-chaotic&quot;, &quot;rockhermit-pirate&quot;
	];
	// this is the list of primary roles we will be looking after as part of this OXP
	// that is, we will create ships with these primary roles. Docking ships must have one of these primary roles for them to appear in the dock list after docking
	this._controlledRoles = [&quot;trader&quot;, &quot;trader-courier&quot;, &quot;trader-smuggler&quot;, &quot;shuttle&quot;,
		&quot;pirate&quot;, &quot;pirate-light-fighter&quot;, &quot;pirate-medium-fighter&quot;, &quot;pirate-heavy-fighter&quot;, &quot;pirate-interceptor&quot;,
		&quot;pirate-light-freighter&quot;, &quot;pirate-medium-freighter&quot;, &quot;pirate-heavy-freighter&quot;,
		&quot;hunter&quot;, &quot;hunter-medium&quot;, &quot;hunter-heavy&quot;, &quot;assassin-light&quot;, &quot;assassin-medium&quot;, &quot;assassin-heavy&quot;,
		&quot;escort&quot;, &quot;escort-medium&quot;, &quot;escort-heavy&quot; // removed escort-light
	];
	// ships with these roles will be included in all docking processes
	this._dockingRoleExceptions = [&quot;strelka&quot;, &quot;trident&quot;];
	// ships with these keys will not be created directly (although they may still dock)
	this._dockingKeyExclusions = [&quot;convoys-adder&quot;, &quot;convoys-anaconda&quot;, &quot;convoys-anaconda2&quot;, &quot;convoys-anaconda3&quot;, &quot;convoys-anaconda-admiral&quot;,
		&quot;convoys-anaconda-pirate&quot;, &quot;convoys-asp&quot;, &quot;convoys-asp-pirate&quot;, &quot;convoys-boa&quot;, &quot;convoys-boa-pirate&quot;, &quot;convoys-boa-mk2&quot;, &quot;convoys-boa-mk2-pirate&quot;,
		&quot;convoys-cobra3&quot;, &quot;convoys-cobra3-pirate&quot;, &quot;convoys-ferdelance&quot;, &quot;convoys-ferdelance-pirate&quot;, &quot;convoys-gecko-pirate&quot;, &quot;convoys-krait&quot;,
		&quot;convoys-krait-pirate&quot;, &quot;convoys-mamba&quot;, &quot;convoys-moray&quot;, &quot;convoys-moray-pirate&quot;, &quot;convoys-moray-morayMED&quot;, &quot;convoys-python&quot;, &quot;convoys-python-team&quot;,
		&quot;convoys-python-pirate&quot;, &quot;convoys-python-blackdog&quot;, &quot;convoys-shuttle&quot;, &quot;convoys-transporter&quot;, &quot;convoys-transporter-miner&quot;, &quot;convoys-worm&quot;,
		&quot;convoys-worm-miner&quot;, &quot;freighterconvoys-anaconda&quot;, &quot;freighterconvoys-anaconda2&quot;, &quot;freighterconvoys-anaconda3&quot;, &quot;freighterconvoys-anaconda4&quot;,
		&quot;freighterconvoys-boa&quot;, &quot;freighterconvoys-boa-mk2&quot;, &quot;freighterconvoys-cobra3&quot;, &quot;freighterconvoys-moray&quot;, &quot;freighterconvoys-morayMED&quot;,
		&quot;freighterconvoys-python&quot;, &quot;freighterconvoys-python-team&quot;, &quot;freighterconvoys-python-trader&quot;, &quot;freighterconvoys-shuttle&quot;, &quot;freighterconvoys-shuttle2&quot;,
		&quot;freighterconvoys-transporter&quot;, &quot;freighterconvoys-transporter-miner&quot;, &quot;freighterconvoys-worm&quot;, &quot;freighterconvoys-worm-miner&quot;, &quot;freighterconvoys-miner&quot;,
		&quot;anaconda-carrier-pirate&quot;, &quot;anaconda-carrier&quot;, &quot;empty-carrier-pirate&quot;, &quot;cobra3-carrier-pirate&quot;, &quot;cobra3-carrier&quot;,
		&quot;cobra1-carrier-pirate&quot;, &quot;cobra1-carrier&quot;, &quot;ferdelance-carrier&quot;, &quot;ferdelance-carrier-pirate&quot;
	];
	// these roles will switch any attached escorts into a ship group instead
	this._switchEscortsToGroup = [&quot;rhs_big_boss_cobra4_spacelane_shipset&quot;, &quot;rhs_big_boss_iguana_spacelane_shipset&quot;, &quot;rhs_big_boss_impcourier_spacelane_shipset&quot;,
		&quot;rhs_big_boss_imptrader_spacelane_shipset&quot;, &quot;rhs_big_boss_pitviper_spacelane_shipset&quot;, &quot;rhs_big_boss_supercobra_spacelane_shipset&quot;, &quot;rhs_big_boss_vamppurg_spacelane_shipset&quot;,
		&quot;rhs_big_boss_wolfmk2SE_spacelane_shipset&quot;, &quot;rhs_mark_arachnid_shipset&quot;, &quot;rhs_mark_aspmk1_shipset&quot;, &quot;rhs_mark_cobra3courier_shipset&quot;, &quot;rhs_mark_cobra3rapier_shipset&quot;,
		&quot;rhs_mark_cobra4_shipset&quot;, &quot;rhs_mark_cobras9_shipset&quot;, &quot;rhs_mark_drake2_shipset&quot;, &quot;rhs_mark_dttmk1_shipset&quot;, &quot;rhs_mark_galtech_escort_fighter_shipset&quot;,
		&quot;rhs_mark_ghavial_shipset&quot;, &quot;rhs_mark_gnat_shipset&quot;, &quot;rhs_mark_imp_shipset&quot;, &quot;rhs_mark_imptrader_shipset&quot;, &quot;rhs_mark_phaze_shipset&quot;, &quot;rhs_mark_pitviper_shipset&quot;,
		&quot;rhs_mark_supercobra_shipset&quot;, &quot;rhs_mark_vamppurg_shipset&quot;, &quot;rhs_mark_wolf_shipset&quot;
	];
	// these script properties will be maintained from dock to relaunch
	this._propertiesToKeep = [];
	this._AIScriptExceptions = {};

	// these are roles we don&#39;t control directly, but we might need to dock (eg special escort roles)
	// they will be added during play
	this._additionalRoles = [];
	this._ignoreEquip = [&quot;EQ_ILS&quot;];
	this._pendingDock = []; // array of data objects to search for when ships dock, so a third party OXP can be informed that a specific ship is now docked
	this._trueValues = [&quot;yes&quot;, &quot;1&quot;, 1, &quot;true&quot;, true];
	this._stationNullError = [];
	this._cleanUp = 0;
	this._cleanUpComplete = false;

	// mix of numbers to balance how many in each section
	// band 1 &lt; 3 minutes &gt;&gt; no longer used (creates too many launches)
	// band 2 3-15 minutes
	// band 3 15-30 mins
	// band 4 30-60 mins
	// band 5 1 - 2 hours
	// band 6 2 - 12 hours
	// band 7 12 - 16 hours (loading status)
	// band 8 16 - 20 hours (docked status)
	// band 9 20 - 23 hours (unloading status)
	// band 10 23 - 24 hours (docking status)
	this._bandSrc = {
		2: [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
			3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
			4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
			5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
			6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
			7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
			8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
			9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
			10, 10, 10
		],
		3: [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
			4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
			5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
			6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
			7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
			8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
			9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
			10, 10, 10
		],
		4: [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
			5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
			6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
			7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
			8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
			9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
			10, 10, 10
		],
		5: [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
			6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
			7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
			8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
			9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
			10, 10, 10
		],
		6: [6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
			7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
			8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
			9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
			10, 10, 10
		],
		7: [7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
			8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
			9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
			10, 10, 10
		],
		8: [8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
			9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
			10, 10, 10
		],
		9: [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
			10, 10, 10
		],
		10: [10, 10, 10],
	};
	this._bandRng = {
		1: {
			low: 1,
			high: 3
		},
		2: {
			low: 3,
			high: 15
		},
		3: {
			low: 15,
			high: 30
		},
		4: {
			low: 30,
			high: 60
		},
		5: {
			low: 60,
			high: 120
		},
		6: {
			low: 120,
			high: 720
		},
		7: {
			low: 720,
			high: 960
		},
		8: {
			low: 960,
			high: 1200
		},
		9: {
			low: 1200,
			high: 1380
		},
		10: {
			low: 1380,
			high: 1440
		},
		11: {
			low: 1440,
			high: 1680
		}
	};
	this._departureBands = [];

	// configuration settings for use in Lib_Config
	this._sdcConfig = {
		Name: this.name,
		Display: &quot;Debug Options&quot;,
		Alias: &quot;Station Dock Control&quot;,
		Alive: &quot;_sdcConfig&quot;,
		Bool: {
			B0: {
				Name: &quot;_debug&quot;,
				Def: false,
				Desc: &quot;Enable debug messages&quot;
			},
			Info: &quot;Turns on debug messages.&quot;
		},
		SInt: {
			S0: {
				Name: &quot;_logLaunchType&quot;,
				Def: 0,
				Desc: &quot;Debug: Launch info&quot;,
				Min: 0,
				Max: 2
			},
			S1: {
				Name: &quot;_logDockingType&quot;,
				Def: 0,
				Desc: &quot;Debug: Docking info&quot;,
				Min: 0,
				Max: 2
			},
			S2: {
				Name: &quot;_logAdjustmentType&quot;,
				Def: 0,
				Desc: &quot;Debug: Adjustments info&quot;,
				Min: 0,
				Max: 2
			},
			S3: {
				Name: &quot;_logPopulatorType&quot;,
				Def: 0,
				Desc: &quot;Debug: Populator info&quot;,
				Min: 0,
				Max: 3
			},
			Info: &quot;0 - Debug launch messages. 0 = none, 1 = min, 2 = full\n1 - Debug docking messages. 0 = none, 1 = min, 2 = full\n2 - Debug adjustment messages. 0 = none, 1 = min, 2 = full\n3 - Debug populator messages. 0 = none, 1 = min, 2 = full, 3 = full + escort info&quot;
		}
	};

	// dictionary of stationName/shipTypes with a boolean value indicating if the ship cannot dock at that station.
	// no value means ship can dock
	// this dictionary is being manually populated to increase performance
	this._shipFits = {
		&quot;A Seedy Space Bar|Andromeda&quot;: 0,
		&quot;Astromine Penal Colony|Andromeda&quot;: 0,
		&quot;Axtech Dodecahedron Station|Andromeda&quot;: 0,
		&quot;Capt Kev Dodecahedron Station|Andromeda&quot;: 0,
		&quot;Collective SLAPU|Andromeda&quot;: 0,
		&quot;Collective ZGF|Andromeda&quot;: 0,
		&quot;Constellation Icosahedron Station|Andromeda&quot;: 0,
		&quot;Coriolis Station|Andromeda&quot;: 0,
		&quot;Dodecahedron Station|Andromeda&quot;: 0,
		&quot;DS-A1 Coriolis Station|Andromeda&quot;: 0,
		&quot;DS-A1 Dodecahedron Station|Andromeda&quot;: 0,
		&quot;DS-A1 Icosahedron Station|Andromeda&quot;: 0,
		&quot;Free Trade Zone|Andromeda&quot;: 0,
		&quot;FrontierTech Worldranger Icosahedron Station|Andromeda&quot;: 0,
		&quot;GalaxyMart Con Store|Andromeda&quot;: 0,
		&quot;GASECBlue Dodecahedron Station|Andromeda&quot;: 0,
		&quot;Globe Station II|Andromeda&quot;: 0,
		&quot;Globe Station III|Andromeda&quot;: 0,
		&quot;Greenline Coriolis Station|Andromeda&quot;: 0,
		&quot;GRS Buoy Factory|Andromeda&quot;: 0,
		&quot;G-X1 Coriolis Station|Andromeda&quot;: 0,
		&quot;G-X1 Icosahedron Station|Andromeda&quot;: 0,
		&quot;G-Z1 Dodecahedron Station|Andromeda&quot;: 0,
		&quot;G-Z1 Icosahedron Station|Andromeda&quot;: 0,
		&quot;G-Z1 Octahedron Outpost|Andromeda&quot;: 0,
		&quot;G-Z1 Tetrahedron Depot|Andromeda&quot;: 0,
		&quot;G-Z2 Octahedron Outpost|Andromeda&quot;: 0,
		&quot;G-Z2 Tetrahedron Depot|Andromeda&quot;: 0,
		&quot;Habitat Mark II|Andromeda&quot;: 0,
		&quot;Icosahedron Station|Andromeda&quot;: 0,
		&quot;Imperial AstroFactory|Andromeda&quot;: 0,
		&quot;Imperial Dodecahedron Station|Andromeda&quot;: 0,
		&quot;Kiota Biosphere Station|Andromeda&quot;: 0,
		&quot;Kiota Habitat Station|Andromeda&quot;: 0,
		&quot;Kiota Manufacturing Station|Andromeda&quot;: 0,
		&quot;Kiota Mega Habitat Station|Andromeda&quot;: 0,
		&quot;Kiota Relay Station|Andromeda&quot;: 0,
		&quot;Kiota Research Station|Andromeda&quot;: 0,
		&quot;Kiota Solar Station|Andromeda&quot;: 0,
		&quot;Leesti High|Andromeda&quot;: 0,
		&quot;LX5 Dodecahedron Station|Andromeda&quot;: 0,
		&quot;Mall-Wart Con Store|Andromeda&quot;: 0,
		&quot;Mayan Dodecahedron Station|Andromeda&quot;: 0,
		&quot;Metaforce Coriolis Station|Andromeda&quot;: 0,
		&quot;M-G2 Globe Station|Andromeda&quot;: 0,
		&quot;M-G3 Globe Station|Andromeda&quot;: 0,
		&quot;Mining Outpost|Andromeda&quot;: 0,
		&quot;M-T1 Torus Station|Andromeda&quot;: 0,
		&quot;M-T2 Torus Station|Andromeda&quot;: 0,
		&quot;N-A1 Coriolis Station|Andromeda&quot;: 0,
		&quot;N-X1 Dodecahedron Station|Andromeda&quot;: 0,
		&quot;Octahedron Outpost|Andromeda&quot;: 0,
		&quot;Oodles Con Store|Andromeda&quot;: 0,
		&quot;Pi-42 Con Store|Andromeda&quot;: 0,
		&quot;Pirate Rock|Andromeda&quot;: 0,
		&quot;RaTech Gold Coriolis Station|Andromeda&quot;: 0,
		&quot;RedTec Coriolis Station|Andromeda&quot;: 0,
		&quot;Renegade Station|Andromeda&quot;: 0,
		&quot;Rock Hermit|Andromeda&quot;: 0,
		&quot;Sainsboory&#39;s Con Store|Andromeda&quot;: 0,
		&quot;Salvage Gang|Andromeda&quot;: 0,
		&quot;Sodalite Station|Andromeda&quot;: 0,
		&quot;SolarTec Coriolis Station|Andromeda&quot;: 0,
		&quot;Star Con Store|Andromeda&quot;: 0,
		&quot;Tescoo Con Store|Andromeda&quot;: 0,
		&quot;Tetrahedron Depot|Andromeda&quot;: 0,
		&quot;Torus Station|Andromeda&quot;: 0,
		&quot;Trade Outpost|Andromeda&quot;: 0,
		&quot;Trontech Vulcan Dodecahedron Station|Andromeda&quot;: 0,
		&quot;Waspline Coriolis Station|Andromeda&quot;: 0,
		&quot;Worldbuilders Icosahedron Station|Andromeda&quot;: 0,
		&quot;Imperial AstroFactory|Serpent Class Cruiser&quot;: 0,
		&quot;Imperial AstroFactory|Hornet&quot;: 0,
		&quot;Imperial AstroFactory|Anaconda&quot;: 0,
		&quot;Imperial AstroFactory|Boa Class Cruiser&quot;: 0,
		&quot;Imperial AstroFactory|Boa&quot;: 0,
		&quot;Imperial AstroFactory|Cobra Mark IV&quot;: 0,
	};

	//-------------------------------------------------------------------------------------------------------------
	// obj has following params:
	// 	shipName		name of ship to add menu item for (required if pilotname not specified)
	// 	shipType		ship type (required if pilotname not specified)
	// 	pilotName		name of pilot (optional, but required if shipname and shiptype are blank)
	// 	worldScript		worldScript name for the callback (required)
	// 	callback		worldScript function to call in the callback (required)
	// 	parameter		parameter to add to the function when called (optional)
	//  launchCallback	worldScript function to call when the ship launches after docking (optional)
	this.$awaitShipDocking = function $awaitShipDocking(obj) {
		if ((!obj.shipName || obj.shipName === &quot;&quot;) &amp;&amp; (!obj.pilotName || obj.pilotName === &quot;&quot;)) {
			throw &quot;Invalid settings: shipName or pilotName must be specified&quot;;
		}
		if ((!obj.shipType || obj.shipType === &quot;&quot;) &amp;&amp; (!obj.pilotName || obj.pilotName === &quot;&quot;)) {
			throw &quot;Invalid settings: shipType or pilotName must be specified&quot;;
		}
		if (!obj.worldScript || obj.worldScript === &quot;&quot;) {
			throw &quot;Invalid settings: worldScript (worldScript name) must be specified, and cannot be blank.&quot;;
		}
		if (!obj.callback || obj.callback === &quot;&quot;) {
			throw &quot;Invalid settings: callback (function name) must be specified, and cannot be blank.&quot;;
		}
		this._pendingDock.push({
			shipName: (obj.shipName ? obj.shipName : &quot;&quot;),
			shipType: (obj.shipType ? obj.shipType : &quot;&quot;),
			pilotName: (obj.pilotName ? obj.pilotName : &quot;&quot;),
			callback: obj.callback,
			worldScript: obj.worldScript,
			launchCallback: (obj.launchCallback ? obj.launchCallback : &quot;&quot;)
		});
	}

	//-------------------------------------------------------------------------------------------------------------
	// removes all ships from all docks in the current system
	this.$emptyAllQueues = function $emptyAllQueues() {
		this._systemDockingData[system.ID] = {};
		for (var i = this._launching.length - 1; i &gt;= 0; i--) {
			if (this._launching[i].system === system.ID) this._launching.splice(i, 1);
		}
	}

	//=============================================================================================================
	// system functions
	//-------------------------------------------------------------------------------------------------------------
	this.startUp = function () {
		if (this._disable === true) {
			// delete all the routines that would initiate/update data
			// that will effectively disable this OXP while leaving it in place.
			delete this.startUpComplete;
			delete this.shipDied;
			delete this.playerWillSaveGame;
			delete this.shipWillEnterWitchspace;
			delete this.shipExitedWitchspace;
			delete this.shipWillLaunchFromStation;
			delete this.shipWillDockWithStation;
			delete this.playerBoughtEquipment;
			delete this.playerBoughtNewShip;
			delete this.systemWillPopulate;
			delete this.systemWillRepopulate;
			delete this.startUp;
			return;
		}
		if (missionVariables.StationDockControl_ShipFits) {
			delete missionVariables.StationDockControl_ShipFits;
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	this.startUpComplete = function () {
		if (this._debug) {
			log(this.name, &quot;Logging levels:&quot;);
			log(this.name, &quot;Populator:   &quot; + this._logPopulatorType);
			log(this.name, &quot;Docking:     &quot; + this._logDockingType);
			log(this.name, &quot;Launching:   &quot; + this._logLaunchType);
			log(this.name, &quot;Adjustments: &quot; + this._logAdjustmentType);
			log(this.name, &quot;===================================================&quot;);
		}

		// register our settings, if Lib_Config is present
		if (worldScripts.Lib_Config) worldScripts.Lib_Config._registerSet(this._sdcConfig);

		// set a flag if smugglers is installed
		if (worldScripts.Smugglers_Illegal) this._smuggling = true;
		// set a flag if random ship names is installed
		if (worldScripts[&quot;randomshipnames&quot;]) this._rsnInstalled = true;

		// add some AI script exceptions
		if (worldScripts.spicy_hermits_relocator) {
			this._AIScriptExceptions[&quot;Spicy Grunt AI&quot;] = &quot;spicy_hermits-gruntAI.js&quot;;
			this._AIScriptExceptions[&quot;Spicy Pirate AI&quot;] = &quot;spicy_hermits-pirateAI.js&quot;;
			this._AIScriptExceptions[&quot;In-System Trader AI&quot;] = &quot;in-system-traderAI.js&quot;;
		}

		// output the populator outgoing factors
		if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) this.$logOolitePopulatorOutgoingFactors();

		this._repopulate = false;

		// restore saved data if any exists
		if (missionVariables.StationDockControl_Data) delete missionVariables.StationDockControl_Data;
		if (missionVariables.StationDockControl_Main) delete missionVariables.StationDockControl_Main;
		if (missionVariables.StationDockControl_Info) {
			if (this._debug) log(this.name, &quot;Loading stored data...&quot;);
			this._systemDockingData = JSON.parse(missionVariables.StationDockControl_Info);
			if (this._debug) log(this.name, &quot;Stored data loaded successfully.&quot;);
			delete missionVariables.StationDockControl_Info;

			this._escortCounter = missionVariables.StationDockControl_EscortCounter;
			this._groupCounter = missionVariables.StationDockControl_GroupCounter;
			// reset our escort/group counters if they reach a certain limit
			if (this._escortCounter &gt; 30000) this._escortCounter = 1;
			if (this._groupCounter &gt; 30000) this._groupCounter = 1;

			this._quickUpdateTimer = new Timer(this, this.$basicSetup, 2, 0);
		} else {
			// otherwise create it from scratch
			// create a timer to run the jumpstart routine
			// we do this from a timer to try and make sure all OXP stations are in place - some OXP&#39;s might not have finished setting up yet
			this._quickUpdateTimer = new Timer(this, this.$initialSetup, 2, 0);
		}

		// load the launching list, if there is one
		if (missionVariables.StationDockControl_Launching) {
			this._launching = JSON.parse(missionVariables.StationDockControl_Launching);
			delete missionVariables.StationDockControl_Launching;
		}

		// load up any additional roles we found last time
		if (missionVariables.StationDockControl_AdditionalRoles) {
			this._additionalRoles = JSON.parse(missionVariables.StationDockControl_AdditionalRoles);
			delete missionVariables.StationDockControl_AdditionalRoles;
			// fixes bug with storing items repeatedly
			this._additionalRoles = this.$compactArray(this._additionalRoles);
		}

		//this.$grabAllShipDockValues();

		// start a timer to move ships to the launching queue every 60 seconds
		this._launchTimer = new Timer(this, this.$updateLaunchingList, 60, 60);
		this._populateTimer = new Timer(this, this.$runPopulation, 1, 3);
	}

	//-------------------------------------------------------------------------------------------------------------
	// whenever we come into a new system, get a list of neighbouring systems
	this.systemWillPopulate = function () {
		if (system.ID === -1) return;

		if (this._disable === true) {
			delete this.systemWillPopulate;
			return;
		}

		this._launchingGroups.length = 0;
		this._launchingEscorts.length = 0;
		this._neighbours = System.infoForSystem(galaxyNumber, system.ID).systemsInRange();
		// remove ships that will have launched from array
		//this.$clearLaunchedShips();
		this._launching.length = 0;

		// build our list of random ship names/roles/data keys
		this.$loadShipNames();

		this._stationAdjust = true; // tell the repopulator to adjust the station.otherShipDocked events
		this._stationIndexesLoaded = false; // clear the setting that will load station indexes
		this._repopulate = true; // tell the system to repopulate on the next repopulate run
		this._repopulateFactor = 1440; // make the next repopulate run a complete one
		this._shuttleDest = null; // clear out the array so it can be rebuilt later
	}

	//-------------------------------------------------------------------------------------------------------------
	// add the docking script to all stations in system
	this.systemWillRepopulate = function () {
		if (system.ID === -1) return;

		if (this._disable === true) {
			delete this.systemWillRepopulate;
			return;
		}

		if (this._cleanUpComplete === false) this.$dataCleanup();

		this._shipMonitor = (this._shipMonitor + 1) % 6;
		// check our docking queue situation
		if (this._shipMonitor === 1 || this._shipMonitor === 4) this.$assessStationDocks();

		// monitor the total ship count in a system to see how it fluctuates.
		if (this._debug &amp;&amp; this._logPopulatorType &gt; 0) {
			if (this._shipMonitor === 1) {
				// only do this full count every 6 times
				log(this.name, &quot;Current ship count: &quot; + system.allShips.length + &quot;, system docked count: &quot; + this.$countSystemItems() + &quot;, main station count: &quot; + this.$countStationItems(system.mainStation));
			} else {
				log(this.name, &quot;Current ship count: &quot; + system.allShips.length);
			}
		}

		// some stations get created during launch or exit from witchspace (rather than through systemWillPopulate), so check here for a change to the number of stations
		if (this._stationAdjust === false &amp;&amp; system.stations.length &gt; this._stationIndexCount) {
			if (this.debug &amp;&amp; this._logPopulatorType &gt; 0) log(this.name, &quot;New stations found in repopulate routine!&quot;);
			this._stationAdjust = true;
			this._stationIndexesLoaded = false;
			this.$missingStationIndexes();
		}

		// adjust the station.otherShipDocked routines to use new version
		if (this._stationAdjust === true) {
			this._stationAdjust = false;

			// update list of station indexes for this system
			this.$stationIndexes();
			var stns = system.stations;
			stns.forEach(function (station) {
				if (station.hasNPCTraffic &amp;&amp; this.$checkStationRoleForNoTraffic(station) === false) {
					// check for and save any previous script in otherShipDocked
					if (station.script.otherShipDocked &amp;&amp; station.script.otherShipDocked !== this.$sdc_otherShipDocked) {
						if (this._debug) log(this.name, &quot;Monkey patch being applied to &quot; + station.name);
						station.script.$sdc_hold_otherShipDocked = station.script.otherShipDocked;
					}
					// attach our script to the otherShipDocked event
					station.script.otherShipDocked = this.$sdc_otherShipDocked;
				}
			}, this);
		}

		// check if the autoGeneration process failed (Javascript timed out before it completed)
		//if (this._autoGenerationInProgress === true) {
		//	this._autoCount += 1;
		//	if (this._autoCount === 3) {
		//		this._autoCount = 0;
		//		this.$populateStationList(this._repopulateFactor);
		//		this._repopulateFactor = 0;
		//	}
		//}

		// if we&#39;ve been asked to repopulate the station list, do it here.
		if (this._repopulate === true &amp;&amp; this._autoGenerationInProgress === false) {
			this._repopulate = false;
			this.$populateStationList(this._repopulateFactor);
			this._repopulateFactor = 0;
		} else {
			// have we got a late station to process?
			// if so, just do the repopulation process for one station at a time.
			if (this._lateStations.length &gt; 0) {
				//log(this.name, &quot;performing late station repopulate for &quot; + this._lateStations[0]);
				// get station at the top of the list and assign it to the repoulate station variable
				// this will force the repopulate function to just run for a single station
				this._repopulateStation = this._lateStations[0];
				// remove it from the list so this only happens once
				this._lateStations.splice(0, 1);
				// run the repopulate routine for the full 12 hours
				this.$populateStationList(1440);
				// reset the repopulate station variable
				this._repopulateStation = null;
			}
		}

		// repopulate outgoing traffic
		// look for any ships to launch and launch them
		this.$launchPendingShips();

		var adjruns = 1;
		// only do the adjustment stuff while the player is docked.
		if (player.ship.docked) {
			// keep track of which ships are currently trying to dock, so we can make sure they&#39;re added to the list
			this.$updateShipsDocking(player.ship.dockedStation);
			// if we&#39;re docked, do more runs per cycle
			adjruns = this._adjustRuns;
		}
		this._adjustDepartureBands = (this._adjustDepartureBands + 1) % (this._adjustDepartureFreq + 1);
		// only do this process when our counter hits the frequency
		if (this._adjustDepartureBands === this._adjustDepartureFreq) {
			if (this._debug &amp;&amp; this._logAdjustmentType &gt; 0) log(this.name, &quot;-------------------------------------------------&quot;);
			for (var i = 1; i &lt;= adjruns; i++) {
				// pick a random acjustment function from the array
				this.$adjustShipDepartureBands(this._adjustFunctions[this.$rand(this._adjustFunctions.length) - 1], 0);
			}
		}

		// check for any ships that have been moved into a &quot;rescheduled&quot; status
		if (this._populateStation.length === 0) this.$checkForRescheduledShips();

	}

	//-------------------------------------------------------------------------------------------------------------
	this.shipDied = function (whom, why) {
		// clean up any active timers
		if (this._launchTimer &amp;&amp; this._launchTimer.isRunning) this._launchTimer.stop();
		delete this._launchTimer;
		if (this._populateTimer &amp;&amp; this._populateTimer.isRunning) this._populateTimer.stop();
		delete this._populateTimer;
	}

	//-------------------------------------------------------------------------------------------------------------
	this.playerWillSaveGame = function () {
		// save docking info array
		missionVariables.StationDockControl_Info = JSON.stringify(this._systemDockingData);
		missionVariables.StationDockControl_EscortCounter = this._escortCounter;
		missionVariables.StationDockControl_GroupCounter = this._groupCounter;
		// if there&#39;s anything in the launching list, save that as well
		if (this._launching.length &gt; 0) missionVariables.StationDockControl_Launching = JSON.stringify(this._launching);
		// if there&#39;s anything in the additional roles list, save that too
		if (this._additionalRoles.length &gt; 0) missionVariables.StationDockControl_AdditionalRoles = JSON.stringify(this._additionalRoles);
	}

	//-------------------------------------------------------------------------------------------------------------
	this.playerStartedJumpCountdown = function (type, seconds) {
		this._jumpStarted = true;
	}

	//-------------------------------------------------------------------------------------------------------------
	this.playerCancelledJumpCountdown = this.playerJumpFailed = function () {
		this._jumpStarted = false;
	}

	//-------------------------------------------------------------------------------------------------------------
	this.shipWillEnterWitchspace = function (cause, destination) {
		this._populatorVars = null;
		this._populateStation.length = 0;
		this._autoGenerationInProgress = false;
		//this._doShipDockDataGrab = {};
		this._jumpStarted = false;
		this._lateStations.length = 0;
		this._launching.length = 0; // experimental - may need to remove
		// remove all but the current and destination datasets
		if (system.isInterstellarSpace === false) {
			if (cause != &quot;galactic jump&quot; &amp;&amp; destination) {
				this.$dataPurge(system.ID, destination);
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	this.shipExitedWitchspace = function () {
		// output the populator outgoing factors
		if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) this.$logOolitePopulatorOutgoingFactors();
		this._pendingDock.length = 0;
	}

	//-------------------------------------------------------------------------------------------------------------
	this.shipWillLaunchFromStation = function (station) {
		// cleanup
		if (missionVariables.StationDockControl_Data) delete missionVariables.StationDockControl_Data;
		if (missionVariables.StationDockControl_AdditionalRoles) delete missionVariables.StationDockControl_AdditionalRoles;

		this._docking.length = 0;
		// ** should not need to do this -- oolite should auto-dock these ships
		// dock any ship that is currently trying to dock
		//if (this._docking &amp;&amp; this._docking.length &gt; 0) {
		//	for (var i = 0; i &lt; this._docking.length; i++) {
		//		if (this._debug) log(this.name, &quot;forcing dock of ship &quot; + this._docking[i]);
		//		this.$logShipDocking(station, this._docking[i]);
		//	}
		// }

		// launch ships that are due in the next ten minutes
		this.$dockingQueueShipClearance(station, 10);
	}

	//-------------------------------------------------------------------------------------------------------------
	this.shipWillDockWithStation = function (station) {
		// for a normal dock (ie. without a dock comp), there is no time jump when docking, so this call should do nothing
		// for an insta-dock, the time jump is 20 miuntes
		// for an escape pod, the time jump could be up to 8 days
		this.$checkForLaunchedShips();
	}

	//-------------------------------------------------------------------------------------------------------------
	// large time jumps can occur here...
	this.playerBoughtEquipment = function (equipment) {
		this.$checkForLaunchedShips();
	}

	//-------------------------------------------------------------------------------------------------------------
	// ...and here
	this.playerBoughtNewShip = function (ship) {
		this.$checkForLaunchedShips();
	}

	//-------------------------------------------------------------------------------------------------------------
	// ...and here
	this.reportScreenEnded = this.missionScreenEnded = function () {
		this.$checkForLaunchedShips();
	}

	//-------------------------------------------------------------------------------------------------------------
	// launch (or remove) any ships that would have launched during a sudden jump in time
	this.$checkForLaunchedShips = function $checkForLaunchedShips() {
		// don&#39;t do the check if we&#39;re about to do a repopulate routine, or we&#39;re in the middle of one
		if (this._repopulate) return;

		// is a time jump happening (ie. seconds !== adjustedSeconds), and the difference is greater than 60 seconds
		if (clock.seconds !== clock.adjustedSeconds &amp;&amp; (clock.adjustedSeconds - clock.seconds) &gt; 60) {
			// work out how much the time jump is, in minutes
			var diff = parseInt((clock.adjustedSeconds - clock.seconds) / 60);
			if (this._debug &amp;&amp; this._logLaunchType &gt; 0) log(this.name, &quot;Checking for launched ships within period of &quot; + diff + &quot; minutes...&quot;);
			var stns = system.stations;
			// go through each station in the system
			stns.forEach(function (station) {
				if (station.hasNPCTraffic &amp;&amp; this.$checkStationRoleForNoTraffic(station) === false) {
					this.$dockingQueueShipClearance(station, diff);
				}
			}, this);

			// force docked certain ships, based on the timelapse
			this.$forceDockController(diff);

			// do some departure band adjustments, based on our time differential
			// for 10 minutes, do 3 adjustments, for 20 minutes do 6 adjustments etc
			if (diff &gt; 10 &amp;&amp; diff &lt; 960) {
				var adj = (diff / 10) * 3;
				if (this._debug &amp;&amp; this._logAdjustmentType &gt; 0) log(this.name, &quot;Bulk adjustments: &quot; + adj);
				this.$adjustShipDepartureBands(1, adj);
			}

			// set up the repopulation function
			if (diff &gt; 30) {
				// add the diff onto the current repopulate factor, just in case there is already one in play and the repopulate routine hasn&#39;t run yet
				// that&#39;s to cope with the situation where the player buys multiple things quickly
				this._repopulateFactor += diff;
				if (this._debug &amp;&amp; this._logPopulatorType &gt; 0) log(this.name, &quot;Repopulate factor = &quot; + this._repopulateFactor + &quot; (diff = &quot; + diff + &quot;)&quot;);
				// force the repopulator routine to run immediately
				this.$populateStationList(this._repopulateFactor);
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// populates the randomShips array with ship names (eg &quot;Cobra Mark III&quot;, &quot;Asp Mark II&quot; etc) and their associated role (eg &quot;trader&quot;)
	// because most of the time we will be working with a data array, and not an actual ship object, we need a way to link
	// roles to ship types and ship keys. this routine re-compiles the list of possibilties which we can then use throughout the code.
	// the result will be: each role and ship type will have one entry in the list, and the shipKeys element will have a list of
	// possible versions of that ship.
	this.$loadShipNames = function $loadShipNames() {
		//-------------------------------------------------------------------------------------------------------------
		// returns the role frequency out of a data string
		function getRoleFrequency(roleName, roleData) {
			var point1 = roleData.indexOf(roleName) + roleName.length;
			var freq = &quot;1&quot;; // default of 1 (ie there is no bracket value)
			if (roleData.charAt(point1) === &quot;(&quot;) {
				// extract the percentage
				var point2 = roleData.indexOf(&quot;)&quot;, point1);
				freq = roleData.substring(point1 + 1, point2);
			}
			return freq;
		}
		//-------------------------------------------------------------------------------------------------------------
		// checks to see if shipkey can be spawned in this system (ie are any conditions in place);
		function modelIsAllowed(shipkey) {
			var shipdata = Ship.shipDataForKey(shipkey);
			// are we allowed to include this data key in this system? check the conditions if there are some
			var include = true;
			if (shipdata.conditions) {
				var cond = shipdata.conditions.toString().split(&quot;,&quot;);
				//1,systemGovernment_number equal 4,systemGovernment_number,0,0,4,
				//1,systemEconomy_number notequal 4,systemEconomy_number,1,0,4
				//1,systemEconomy_number lessthan 4,systemEconomy_number,2,0,4
				//1,systemEconomy_number greaterthan 4,systemEconomy_number,3,0,4
				var offset = 0;
				var finish = false;
				var checking = -1;
				do {
					// get the value we&#39;re checking
					checking = -1;
					if (cond[offset + 2].substring(0, 6) === &quot;mission&quot;) {
						if (missionVariables[cond[offset + 2].replace(&quot;mission_&quot;, &quot;&quot;)]) {
							checking = missionVariables[cond[offset + 2].replace(&quot;mission_&quot;, &quot;&quot;)];
							log(this.name, &quot;field = &quot; + cond[offset + 2] + &quot;, value = &quot; + checking);
						} else {
							log(this.name, &quot;!!NOTE: Condition value mission variable not set: &quot; + cond[offset + 2]);
						}
					} else {
						switch (cond[offset + 2]) {
							case &quot;systemGovernment_number&quot;:
								checking = system.government;
								break;
							case &quot;systemEconomy_number&quot;:
								checking = system.economy;
								break;
							case &quot;systemTechLevel_number&quot;:
								checking = system.techLevel;
								break;
							case &quot;score_number&quot;:
								checking = player.score;
								break;
							case &quot;galaxy_number&quot;:
								checking = galaxyNumber;
								break;
							case &quot;planet_number&quot;:
								checking = system.ID;
								break;
							default:
								log(this.name, &quot;!!NOTE: Condition value not catered for: &quot; + cond[offset + 2]);
								break;
						}
					}
					// in case a mission variable is a text value of some sort
					if (isNaN(parseInt(checking)) &amp;&amp; isNaN(parseFloat(checking))) {
						switch (cond[offset + 3]) {
							case &quot;0&quot;: // equals
								if (checking != cond[offset + 5]) include = false;
								break;
							case &quot;1&quot;: // not equals
								if (checking == cond[offset + 5]) include = false;
								break;
							default:
								log(this.name, &quot;!!NOTE: Condition comparison not catered for: &quot; + cond[offset + 3]);
								break;
						}
					} else {
						if (checking &gt;= 0) {
							// work out the type of check, but in negative (or opposite)
							switch (cond[offset + 3]) {
								case &quot;0&quot;: // equals
									if (checking !== parseInt(cond[offset + 5])) include = false;
									break;
								case &quot;1&quot;: // not equals
									if (checking === parseInt(cond[offset + 5])) include = false;
									break;
								case &quot;2&quot;: // lessthan
									if (checking &gt;= parseInt(cond[offset + 5])) include = false;
									break;
								case &quot;3&quot;: // greaterthan
									if (checking &lt;= parseInt(cond[offset + 5])) include = false;
									break;
								default:
									log(this.name, &quot;!!NOTE: Condition comparison not catered for: &quot; + cond[offset + 3]);
									break;
									// others?
							}
						}
					}
					offset += 6;
					if (offset &gt;= cond.length - 1) finish = true;
				} while (finish === false);
			} else if (shipdata.condition_script) {
				// or the condition script
				// create a dummy object to attach the script to so it can be executed
				var temppos = system.sun.position.cross(system.mainPlanet.position).direction().multiply(4E9).subtract(system.mainPlanet.position);
				var tempalloy = system.addShips(&quot;alloy&quot;, 1, temppos, 0);
				tempalloy[0].setScript(shipdata.condition_script);
				include = tempalloy[0].script.allowSpawnShip(shipkey);
				tempalloy[0].remove(true);
			} else {
				// otherwise we&#39;re free to play
				include = true;
			}
			return include;
		}

		// compile a list of ships/roles
		this._randomShips = {};
		this._shipData = {};
		var indexInList = this.$indexInList;

		var excl = this._dockingKeyExclusions;
		var cr = this._controlledRoles;
		for (var i = 0; i &lt; cr.length; i++) {
			var ctrlRole = cr[i];
			var shipKeys = Ship.keysForRole(ctrlRole);
			var freq = &quot;&quot;;
			if (shipKeys) {
				for (var j = 0; j &lt; shipKeys.length; j++) {
					var key = shipKeys[j];
					// don&#39;t include any of these keys
					if (indexInList(key, excl) &gt;= 0) continue;

					var include = modelIsAllowed(key);

					if (include) {
						var shipdata = Ship.shipDataForKey(key);
						// populate our holding dictionary
						if (!this._shipData[key]) {
							this._shipData[key] = {
								&quot;auto_ai&quot;: shipdata[&quot;auto_ai&quot;],
								&quot;auto_weapons&quot;: shipdata[&quot;auto_weapons&quot;],
								&quot;name&quot;: shipdata.name,
								&quot;max_cargo&quot;: shipdata[&quot;max_cargo&quot;],
								&quot;hyperspace_motor&quot;: shipdata[&quot;hyperspace_motor&quot;],
								&quot;escorts&quot;: shipdata[&quot;escorts&quot;],
								&quot;escort_role&quot;: shipdata[&quot;escort_data&quot;],
								&quot;escort_ship&quot;: shipdata[&quot;escort_ship&quot;],
								&quot;escort_roles&quot;: shipdata[&quot;escort_roles&quot;],
								&quot;accuracy&quot;: shipdata[&quot;accuracy&quot;],
								&quot;heat_insulation&quot;: shipdata[&quot;heat_insulation&quot;],
							};
						}

						freq = getRoleFrequency(ctrlRole, shipdata.roles);
						// make sure we don&#39;t load our &quot;dock&quot; versions of ships
						if (key.indexOf(&quot;dock_&quot;) === -1 &amp;&amp; key.indexOf(&quot;bounty_&quot;) === -1) {
							if (!this._randomShips[ctrlRole]) {
								this._randomShips[ctrlRole] = {
									shipKeys: [key],
									frequency: [freq]
								};
							} else {
								this._randomShips[ctrlRole].shipKeys.push(key);
								this._randomShips[ctrlRole].frequency.push(freq);
							}
						}
					} else {
						if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) log(this.name, &quot;!!Note: Conditions not met to include &quot; + ctrlRole + &quot; -- &quot; + key);
					}
				}
			} else {
				log(this.name, &quot;!!NOTE: No ship keys found for role &quot; + ctrlRole);
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// this is a one-shot routine, called by a timer launched through startUpComplete
	// essentially this jump-starts the populator routine so players don&#39;t have to wait 20 seconds to see the list of ships
	this.$initialSetup = function $initialSetup() {
		this._repopulate = false;
		this.$stationIndexes();
		this.$populateStationList(1440);
		delete this._quickUpdateTimer;
	}

	//-------------------------------------------------------------------------------------------------------------
	// this is a one-shot routine, called by a timer launched through startUpComplete when data is restored from a savegame file
	// essentially this gets the station indexes populated early, so the player will be able to see data straight away
	this.$basicSetup = function $basicSetup() {
		this.$stationIndexes();
		// if a new station has been added to the system since the last save (eg via an OXP) and it needs traffic, make sure it gets some
		for (var i = 0; i &lt; this._stationList.length; i++) {
			var item = this._stationList[i];
			if (this.$countStationItems(item.station) === 0) {
				if (this._debug &amp;&amp; this._logPopulatorType &gt; 0) log(this.name, &quot;Adding station dock entries for new station: &quot; + item.name + &quot;(&quot; + item.index + &quot;)&quot;);
				this._repopulateStation = item.station;
				this.$populateStationList(1440);
				this._repopulateStation = null;
			}
		}
		delete this._quickUpdateTimer;
	}

	//-------------------------------------------------------------------------------------------------------------
	// build an array of stations with an index key, for when there is more than 1 of a particular station in a system
	this.$stationIndexes = function $stationIndexes() {
		if (this._stationIndexesLoaded) return;

		this._stationIndexesLoaded = true;

		var stns = system.stations;
		this._stationList.length = 0;
		this._stationIndexCount = system.stations.length;

		stns.forEach(function (station) {
			// only create an index for stations we have an interest in controlling
			if ((station.status === &quot;STATUS_ACTIVE&quot; || station.status === &quot;STATUS_IN_FLIGHT&quot;) &amp;&amp; station.hasNPCTraffic &amp;&amp; this.$checkStationRoleForNoTraffic(station) === false) {
				var idx = 1;
				for (var i = 0; i &lt; this._stationList.length; i++) {
					if (this._stationList[i].station.name === station.name) idx += 1;
				}
				this._stationList.push({
					station: station,
					name: station.name,
					index: idx
				});
				if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2)
					log(this.name, &quot;Creating stationList entry: &quot; + station.name + &quot; index = &quot; + idx);
			}
		}, this);
	}

	//-------------------------------------------------------------------------------------------------------------
	// adds any stations missed during the system population routines to the lateStations array (ie stations that get created via some other event)
	this.$missingStationIndexes = function $missingStationIndexes() {
		var stns = system.stations;
		stns.forEach(function (station) {
			var found = false;
			for (var i = 0; i &lt; this._stationList.length; i++) {
				if (this._stationList[i].station === station) found = true;
			}
			if (found === false &amp;&amp; this._lateStations.indexOf(station) === -1) {
				if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) log(this.name, &quot;Adding missing station: &quot; + station.name);
				this._lateStations.push(station);
			}
		}, this);
	}

	//-------------------------------------------------------------------------------------------------------------
	// function to process ship docking (based on station &quot;otherShipDocked&quot; function)
	this.$sdc_otherShipDocked = function $sdc_otherShipDocked(whom) {
		// if there was a previous script in place, run it here.
		if (this.ship.script.$sdc_hold_otherShipDocked) this.ship.script.$sdc_hold_otherShipDocked(whom);
		if (whom.isPlayer === false) {
			var w = worldScripts.StationDockControl;
			w.$logShipDocking(this.ship, whom);
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// adjusts the departure times or destinations of random ships
	// type 1 = change from docking to unloading, from unloading to docked, or from docked to loading
	// type 2 = change departure time
	// type 3 = change destination
	this.$adjustShipDepartureBands = function $adjustShipDepartureBands(adjustType, override_thistime) {

		if (this._debug &amp;&amp; this._logAdjustmentType &gt; 0) log(this.name, &quot;Running adjustment type &quot; + adjustType);

		// type 0 = do nothing
		if (adjustType === 0) return;

		var chance = this._adjustDepartureChance;
		var adjustCount = 0;
		// work out how many adjustments we&#39;ll do this time
		var thistime = this.$rand(this._maxAdjustments);
		if (override_thistime &gt; 0) {
			thistime = override_thistime;
			chance *= 2; // double the chance of making a change during a bulk update
		}

		if (this._systemDockingData[system.ID] == null) return;

		// move a ship with unknown departure time to a defined time
		// start from the bottom of the list
		var skeys = Object.keys(this._systemDockingData[system.ID]);
		for (var kc = 0; kc &lt; skeys.length; kc++) {
			var dta = this._systemDockingData[system.ID][skeys[kc]];
			if (dta &amp;&amp; dta.length &gt; 0) {
				for (var i = dta.length - 1; i &gt;= 0; i--) {
					var item = dta[i];
					var done = false;
					// if this record is for this system and we haven&#39;t changed it for over 10 minutes (this._noAdjustPeriod)
					// and it&#39;s either a group leader or not in a group at all, or it&#39;s an escort leader or not in an escort at all
					// this is so we only initiate a move for individual ships or leader ships
					if ((clock.adjustedSeconds - item.lastChange) &gt; this._noAdjustPeriod &amp;&amp;
						((item.groupName === &quot;&quot; &amp;&amp; item.escortName === &quot;&quot;) ||
							item.groupLeader === true || item.escortLeader === true) &amp;&amp;
						Math.random() &lt; chance) {

						// get the current departure time in minutes
						var depart = item.departureTime; //(item.departureTime - clock.adjustedSeconds) / 60;
						var newDepart = 0;
						var free = false;
						var tries = 0;

						// adjust from docking to unloading, unloading to docked, or docked to loading
						if (adjustType === 1) {
							// move from docking to unloading
							if (done === false &amp;&amp; depart &gt;= 1380 &amp;&amp; depart &lt; 1440) {
								// found one
								tries = 0;
								free = false;
								do {
									newDepart = (this.$rand(180) + 1380); // * 60 + clock.adjustedSeconds; // 20-23 hours
									tries += 1;
									free = this.$checkDepartureSlot(item.station, item.stationIndex, newDepart);
								} while (free === false &amp;&amp; tries &lt; 5);

								if (free === true) {
									// do loading function here
									// if (this._NPCTrading === true) {
									//	var td = worldScripts.StationDockInfo_NPCTrading;
									//	td.$processCargo_Unloading(item);
									// }
									done = true;
									if (this._debug &amp;&amp; this._logAdjustmentType === 2) log(this.name, &quot;Moving &quot; + item.shipType + (item.shipName !== &quot;&quot; ? &quot;: &quot; + item.shipName : &quot;&quot;) + &quot; to unloading status&quot;);
									item.departureTime = newDepart;
									item.lastChange = clock.adjustedSeconds;
									this.$updateGroupMemberData(skeys[kc], item.groupName, item.escortName, &quot;departureTime&quot;, newDepart);
								}
							}

							// move from unloading (1200-1380 minutes) to docked
							if (done === false &amp;&amp; depart &gt;= 1200 &amp;&amp; depart &lt; 1380) {
								// found one
								tries = 0;
								free = false;
								do {
									newDepart = (this.$rand(240) + 960); // * 60 + clock.adjustedSeconds; // 16-20 hours
									tries += 1;
									free = this.$checkDepartureSlot(item.station, item.stationIndex, newDepart);
								} while (free === false &amp;&amp; tries &lt; 5);

								if (free === true) {
									done = true;
									if (this._debug &amp;&amp; this._logAdjustmentType === 2) log(this.name, &quot;Moving &quot; + item.shipType + (item.shipName !== &quot;&quot; ? &quot;: &quot; + item.shipName : &quot;&quot;) + &quot; to docked status&quot;);
									item.departureTime = newDepart;
									item.lastChange = clock.adjustedSeconds;
									this.$updateGroupMemberData(skeys[kc], item.groupName, item.escortName, &quot;departureTime&quot;, newDepart);
								}
							}

							// move from docked to loading status
							if (done === false &amp;&amp; depart &gt;= 960 &amp;&amp; depart &lt; 1200) {
								// found one
								tries = 0;
								free = false;
								do {
									newDepart = (this.$rand(240) + 720); // * 60 + clock.adjustedSeconds; // 12-16 hours
									tries += 1;
									free = this.$checkDepartureSlot(item.station, item.stationIndex, newDepart);
								} while (free === false &amp;&amp; tries &lt; 5);

								if (free === true) {
									// do loading function here
									// if (this._NPCTrading === true) {
									//	var td = worldScripts.StationDockInfo_NPCTrading;
									// 	td.$processCargo_Loading(item);
									// }
									done = true;
									if (this._debug &amp;&amp; this._logAdjustmentType === 2) log(this.name, &quot;Moving &quot; + item.shipType + (item.shipName !== &quot;&quot; ? &quot;: &quot; + item.shipName : &quot;&quot;) + &quot; to loading status&quot;);
									item.departureTime = newDepart;
									item.lastChange = clock.adjustedSeconds;
									this.$updateGroupMemberData(skeys[kc], item.groupName, item.escortName, &quot;departureTime&quot;, newDepart);
								}
							} // if depart between 16 and 47

							// move from loading to departing
							if (done === false &amp;&amp; depart &gt;= 720 &amp;&amp; depart &lt; 960) {
								tries = 0;
								free = false;
								do {
									newDepart = (this.$rand(660) + 60); // * 60 + clock.adjustedSeconds; // 1-12 hours
									tries += 1;
									free = this.$checkDepartureSlot(item.station, item.stationIndex, newDepart);
								} while (free === false &amp;&amp; tries &lt; 5);

								if (free === true) {
									done = true;
									if (this._debug &amp;&amp; this._logAdjustmentType === 2) log(this.name, &quot;Moving &quot; + item.shipType + (item.shipName !== &quot;&quot; ? &quot;: &quot; + item.shipName : &quot;&quot;) + &quot; to departing status&quot;);
									item.departureTime = newDepart;
									item.lastChange = clock.adjustedSeconds;
									this.$updateGroupMemberData(skeys[kc], item.groupName, item.escortName, &quot;departureTime&quot;, newDepart);
								}
							} // if depart between 720 and 960
						} // if adjustType = 1

						// straight change of departure time
						if (adjustType === 2) {
							if (done === false &amp;&amp; depart &gt; 120 &amp;&amp; depart &lt; 660) {
								tries = 0;
								free = false;
								do {
									// pick a random time (2 minutes to 11:42 hours)
									newDepart = (this.$rand(700) + 2); // * 60 + clock.adjustedSeconds;
									tries += 1;
									free = this.$checkDepartureSlot(item.station, item.stationIndex, newDepart);
								} while (free === false &amp;&amp; tries &lt; 5);

								if (free === true) {
									done = true;
									if (this._debug &amp;&amp; this._logAdjustmentType === 2) log(this.name, &quot;Changing departure time for &quot; + item.shipType + (item.shipName !== &quot;&quot; ? &quot;: &quot; + item.shipName : &quot;&quot;));
									item.departureTime = newDepart;
									item.lastChange = clock.adjustedSeconds;
									this.$updateGroupMemberData(skeys[kc], item.groupName, item.escortName, &quot;departureTime&quot;, newDepart);
								}
							} // if depart
						} // if adjustType = 2

						// adjust destination
						if (adjustType === 3) {
							if (done === false &amp;&amp; depart &gt; 120 &amp;&amp; depart &lt; 660 &amp;&amp;
								item.destinationSystem !== system.ID &amp;&amp;
								item.destinationSystem &gt;= 0 &amp;&amp;
								item.destinationHidden === false) {

								var newDest = -1;
								var w = worldScripts[&quot;oolite-populator&quot;];
								switch (item.primaryRole) {
									case &quot;trader&quot;:
										newDest = w._weightedNearbyTradeSystem();
										break;
									case &quot;trader-courier&quot;:
										if (Math.random() &lt; 0.5) {
											newDest = this.$nearbySystem(7);
										} else {
											newDest = this.$nearbySystem(25);
										}
										break;
									case &quot;trader-smuggler&quot;:
										newDest = this.$nearbySystem(7);
										break;
									case &quot;pirate-light-freighter&quot;:
									case &quot;pirate-medium-freighter&quot;:
										newDest = w._nearbySafeSystem(system.info.government + 1);
										break;
									case &quot;hunter-medium&quot;:
										newDest = w._nearbyDangerousSystem(4);
										break;
									case &quot;hunter-heavy&quot;:
										newDest = w._nearbyDangerousSystem(1);
										break;
								}

								if (item.destinationSystem !== newDest &amp;&amp; newDest !== -1) {
									done = true;
									item.destinationSystem = newDest;
									item.lastChange = clock.adjustedSeconds;
									if (this._debug &amp;&amp; this._logAdjustmentType === 2) log(this.name, &quot;Updating destinationSystem for &quot; + item.shipType + (item.shipName !== &quot;&quot; ? &quot;: &quot; + item.shipName : &quot;&quot;) + &quot; to &quot; + newDest);
									this.$updateGroupMemberData(skeys[kc], item.groupName, item.escortName, &quot;destinationSystem&quot;, newDest);
								}
							}
						} // if adjustType === 3
					}

					// count the number of times we&#39;re adjusting a ship record
					if (done === true) adjustCount += 1;
					// stop once we hit the target for this round
					if (adjustCount === thistime) break;
				} // for i
			} // if dta
		} // for kc

	}

	//-------------------------------------------------------------------------------------------------------------
	// look for any ships in the launching queue that have been moved to &quot;Rescheduled&quot;
	// when found, give them a new departure slot
	// hopefully, with our station dock assessment routine, no ships will ever need to be rescheduled, but just in case...
	this.$checkForRescheduledShips = function $checkForRescheduledShips() {
		if (this._launching.length &gt; 0) {
			for (var i = 0; i &lt; this._launching.length; i++) {
				var launch = this._launching[i];
				var stationkey = launch.station + &quot;_&quot; + launch.stationIndex;
				// if the departure time is set for &quot;rescheduled&quot; and this is either the group/escort leader or not in a group/escort at all...
				if (Math.round(launch.departureTime) === -5) {
					if (((launch.groupName === &quot;&quot; &amp;&amp; launch.escortName === &quot;&quot;) || (launch.groupLeader || launch.escortLeader))) {
						// found one!
						var newDepart = 0;
						var tries = 0;
						var free = false;
						do {
							// pick a random time (2 minutes to 11:42 hours)
							newDepart = (this.$rand(700) + 2); // * 60 + clock.adjustedSeconds;
							tries += 1;
							free = this.$checkDepartureSlot(launch.station, launch.stationIndex, newDepart);
						} while (free === false &amp;&amp; tries &lt; 5);

						if (free === true) {
							if (this._debug &amp;&amp; this._logAdjustmentType &gt;= 1) log(this.name, &quot;Changing departure time for &quot; + launch.shipType + (launch.shipName !== &quot;&quot; ? &quot;: &quot; + launch.shipName : &quot;&quot;));
							launch.departureTime = newDepart;
							launch.lastChange = clock.adjustedSeconds;
							this.$updateGroupMemberLaunchingData(launch.groupName, launch.escortName, &quot;departureTime&quot;, newDepart);
						} else {
							if (this._debug &amp;&amp; this._logAdjustmentType &gt;= 1) log(this.name, &quot;Failed to find a new departure time for &quot; + launch.shipType + (launch.shipName !== &quot;&quot; ? &quot;: &quot; + launch.shipName : &quot;&quot;));
						}
					} else {
						// has the group leader launched?
						if (this.$isGroupLeaderDocked(stationkey, (launch.groupLeader !== &quot;&quot; ? launch.groupLeader : launch.escortLeader)) === false) {
							// get this ship launched ASAP!
							var newDepart = 0;
							var tries = 0;
							var free = false;
							do {
								// pick a random time (2 minutes to 11:42 hours)
								newDepart = this.$rand(3); // * 60 + clock.adjustedSeconds;
								tries += 1;
								free = this.$checkDepartureSlot(launch.station, launch.stationIndex, newDepart);
							} while (free === false &amp;&amp; tries &lt; 5);

							if (free === true) {
								if (this._debug &amp;&amp; this._logAdjustmentType &gt;= 1) log(this.name, &quot;Changing departure time for orphaned group/escort member &quot; + launch.shipType + (launch.shipName !== &quot;&quot; ? &quot;: &quot; + launch.shipName : &quot;&quot;));
								launch.departureTime = newDepart;
								launch.lastChange = clock.adjustedSeconds;
							} else {
								if (this._debug &amp;&amp; this._logAdjustmentType &gt;= 1) log(this.name, &quot;Failed to find a new departure time for orphaned group/escort member &quot; + launch.shipType + (launch.shipName !== &quot;&quot; ? &quot;: &quot; + launch.shipName : &quot;&quot;));
							}
						}
					}
				}

			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// update group/escort members data
	this.$updateGroupMemberData = function $updateGroupMemberData(stationkey, groupName, escortName, keyfield, newvalue) {
		var dta = this._systemDockingData[system.ID][stationkey];
		if (dta &amp;&amp; dta.length &gt; 0) {
			for (var i = dta.length - 1; i &gt;= 0; i--) {
				var item = dta[i];
				if (((escortName !== &quot;&quot; &amp;&amp; item.escortName === escortName &amp;&amp; item.escortLeader === false) ||
						(groupName !== &quot;&quot; &amp;&amp; item.groupName === groupName &amp;&amp; item.groupLeader === false))) {

					if (this._debug &amp;&amp; this._logAdjustmentType === 2) log(this.name, &quot;Updating &quot; + keyfield + &quot; of group/escort member &quot; + item.shipType + (item.shipName !== &quot;&quot; ? &quot;: &quot; + item.shipName : &quot;&quot;));
					// update the keyfield with the new value
					item[keyfield] = newvalue;
					item.lastChange = clock.adjustedSeconds;
				}
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// update group/escort members data in the launching list
	this.$updateGroupMemberLaunchingData = function $updateGroupMemberLaunchingData(groupName, escortName, keyfield, newvalue) {
		for (var i = this._launching.length - 1; i &gt;= 0; i--) {
			var launch = this._launching[i];
			if (launch.system === system.ID &amp;&amp;
				((escortName !== &quot;&quot; &amp;&amp; launch.escortName === escortName &amp;&amp; launch.escortLeader === false) ||
					(groupName !== &quot;&quot; &amp;&amp; launch.groupName === groupName &amp;&amp; launch.groupLeader === false))) {

				if (this._debug &amp;&amp; this._logAdjustmentType === 2) log(this.name, &quot;Updating &quot; + keyfield + &quot; of group/escort member &quot; + launch.shipType + (launch.shipName !== &quot;&quot; ? &quot;: &quot; + launch.shipName : &quot;&quot;));
				// update the keyfield with the new value
				launch[keyfield] = newvalue;
				launch.lastChange = clock.adjustedSeconds;
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// log a new ship docking
	// grab enough info to recreate a new ship later if needed, but don&#39;t keep a hold on the object so system resources are not consumed
	this.$logShipDocking = function $logShipDocking(station, ship) {
		// for some reason, we can occasionally end up with the station trying to dock itself here. So make sure we don&#39;t!
		// don&#39;t log info about police, thargoids, cargo or unpiloted ships
		// check that a station doesn&#39;t try to dock itself - bad things happen then!
		if (ship.isPolice || ship.isStation || ship.isThargoid || ship.isCargo || !ship.isPiloted || ship.isPlayer) return;
		// look for any ships with a primary role outside of the ones we are controlling (eg miner, scavenger)
		if (this.$roleIsAllowed(ship.primaryRole) === false &amp;&amp; this.$roleIsAllowedAdditional(ship.primaryRole) === false &amp;&amp; this._dockingRoleExceptions.indexOf(ship.primaryRole) === -1) {
			if (this._debug &amp;&amp; this._logDockingType &gt; 0) log(this.name, &quot;Ship with primary role &#39;&quot; + ship.primaryRole + &quot;&#39; docked -- no data will be added&quot;);
			return;
		}
		// make doubly sure the station isn&#39;t trying to dock itself!
		if (station === ship) return;

		// get the index of the station we&#39;re docking at
		var stnIndex = this.$getStationIndex(station);
		var stationkey = station.name + &quot;_&quot; + stnIndex;

		if (this._debug &amp;&amp; this._logDockingType &gt; 0) log(this.name, &quot;Docking ship at station &quot; + station.name + &quot;(&quot; + stnIndex + &quot;): &quot; + ship.displayName + &quot; -- &quot; + ship.dataKey);

		// set departure time to 23-24 hours by default (docking status) for all docking ships so that they follow through the statuses
		var depart = this.$calculateRandomDepartureTime(station, stnIndex, 10, false);
		var destSystem = -1;
		var destHidden = true;
		var isGroupLeader = false;

		var fuel = 7;
		// by default, it will be assumed that ships will refuel on docking
		// however, as player ships can&#39;t refuel at constores anymore, NPC ships will also be unable to as well
		// in that case, just set the fuel back to whatever they have
		if (station.hasRole(&quot;constore&quot;)) fuel = ship.fuel;

		// check if a ship from this group has already docked, and if so, get its departure time
		var sdc_pop = worldScripts.StationDockControl_Populator;
		var lookupgroup = &quot;&quot;;
		var leader;

		// is there a group still attached to the ship?
		if (ship.group &amp;&amp; ship.group.count &gt; 1) {
			lookupgroup = ship.group.name;
			leader = ship.group.leader;
			if (this._debug &amp;&amp; this._logDockingType === 2) log(this.name, &quot;Found group: &quot; + lookupgroup);
		}

		// if not, try looking up the group from our holding array
		if (lookupgroup === &quot;&quot;) {
			lookupgroup = sdc_pop.$getGroupName(ship);
			if (lookupgroup !== &quot;&quot;) {
				if (this._debug &amp;&amp; this._logDockingType === 2) log(this.name, &quot;Found original group: &quot; + lookupgroup);
				leader = sdc_pop.$getGroupLeader(lookupgroup);
			}
		}

		if (lookupgroup !== &quot;&quot;) {
			if (leader &amp;&amp; leader.isValid) {
				if (this._debug &amp;&amp; this._logDockingType === 2) log(this.name, &quot;Group leader: &quot; + leader.displayName + &quot; -- &quot; + leader);
				if (leader == ship) {
					isGroupLeader = true;
				}
			}
			// can we find the leader anywhere in space or in dock
			if ((!leader || leader.isValid === false) &amp;&amp; this.$isGroupLeaderDocked(stationkey, lookupgroup) === false) {
				// no leader
				// todo: work out different scenarios for non-escort group members (hunters in particular)
				if (this._debug &amp;&amp; this._logDockingType === 2) log(this.name, &quot;Leader no longer present - group is dissolved&quot;);
				lookupgroup = &quot;&quot;;
			}
		}

		var departSecs = 0;

		// do we still have a group? (We might have cleared it if it dissolved)
		if (lookupgroup !== &quot;&quot;) {
			var groupData = this.$getShipGroupInfo(stationkey, lookupgroup);

			if (groupData) {
				// if the leader didn&#39;t dock first, make sure their departure time will be before any group members
				if (groupData.depart !== 0) {
					if (isGroupLeader) {
						depart = groupData.depart;
						departSecs = 0;
						groupData.depart = 0;
					}
				}
				// assuming the leader docked first, all subsequent group member dockings will have a departure time be one second after their leader
				// so the ordering of ships is always leader first
				if (groupData.depart !== 0) {
					depart = groupData.depart;
					departSecs = 5;
				}
				// if groupDepart is 0, that means we haven&#39;t docked a member from this group before.
				// check the group leader, and set the flag if true
				//if (groupDepart === 0 &amp;&amp; lookupgroupleader) isGroupLeader = true;

				if (groupData.destination &gt;= 0) {
					destSystem = groupData.destination;
					destHidden = groupData.destinationHidden;
				}
			} else {
				// no existing docked records for this group
				// try this as an escort group
				var escortData = this.$getShipEscortInfo(stationkey, lookupgroup);
				if (escortData) {
					if (escortData.depart !== 0) {
						if (isGroupLeader) {
							depart = escortData.depart;
							departSecs = 0;
							escortData.depart = 0;
						}
					}
					if (escortData.depart !== 0) {
						depart = escortData.depart;
						departSecs = 0;
					}
					if (escortData.destination &gt;= 0) {
						destSystem = escortData.destination;
						destHidden = escortData.destinationHidden;
					}
				}
			}
		}

		// work out the current AI script name
		// there&#39;s probably an easier way of doing this...
		var aiName = &quot;&quot;;
		if (ship.autoAI &amp;&amp; ship.AIScript) {
			switch (ship.AIScript.name) {
				case &quot;Oolite Assassin AI&quot;:
					aiName = &quot;oolite-assassinAI.js&quot;;
					break;
				case &quot;Oolite Bounty Hunter AI&quot;:
					aiName = &quot;oolite-bountyHunterAI.js&quot;;
					break;
				case &quot;Oolite Bounty Hunter Leader AI&quot;:
					aiName = &quot;oolite-bountyHunterLeaderAI.js&quot;;
					break;
				case &quot;Oolite Constrictor AI&quot;:
					aiName = &quot;oolite-constrictorAI.js&quot;;
					break;
				case &quot;Oolite Defense Ship AI&quot;:
					aiName = &quot;oolite-defenceShipAI.js&quot;;
					break;
				case &quot;Oolite Escort AI&quot;:
					aiName = &quot;oolite-escortAI.js&quot;;
					break;
				case &quot;Oolite Pirate AI&quot;:
					aiName = &quot;oolite-pirateAI.js&quot;;
					break;
				case &quot;Oolite Pirate Fighter AI&quot;:
					aiName = &quot;oolite-pirateFighterAI.js&quot;;
					break;
				case &quot;Oolite Pirate Freighter AI&quot;:
					aiName = &quot;oolite-pirateFreighterAI.js&quot;;
					break;
				case &quot;Oolite Pirate Interceptor AI&quot;:
					aiName = &quot;oolite-pirateInterceptorAI.js&quot;;
					break;
				case &quot;Oolite Shuttle AI&quot;:
					aiName = &quot;oolite-shuttleAI.js&quot;;
					break;
				case &quot;Oolite Trader AI&quot;:
					aiName = &quot;oolite-traderAI.js&quot;;
					break;
				case &quot;Oolite Trader Opportunist AI&quot;:
					aiName = &quot;oolite-traderOpportunistAI.js&quot;;
					break;
				case &quot;Null AI&quot;:
					// pick up the plist version of the ai
					if (ship.AI !== &quot;nullAI.plist&quot;) {
						aiName = ship.AI;
					}
					break;
				default:
					if (this._AIScriptExceptions[ship.AIScript.name] &amp;&amp; this._AIScriptExceptions[ship.AIScript.name] !== &quot;&quot;) aiName = this._AIScriptExceptions[ship.AIScript.name];
					if (aiName === &quot;&quot;) log(this.name, &quot;!!ERROR: Unrecognised Auto AI Script: &quot; + ship.AIScript.name);
					break;
			}
		}

		var prim_role = ship.primaryRole;
		var isEscort = false;
		if (ship.primaryRole === &quot;escort&quot; || ship.primaryRole === &quot;escort-light&quot; || ship.primaryRole === &quot;escort-medium&quot; || ship.primaryRole === &quot;escort-heavy&quot;) {

			isEscort = true;

			// will we be turning this escort into something else?
			// if the ship is not attached to a group, it&#39;s time to switch
			if (lookupgroup === &quot;&quot;) {
				isEscort = false;
				if (ship.cargoSpaceCapacity &gt; 0 &amp;&amp; ship.hasHyperspaceMotor === true) {
					// if the ship has cargo space and a hyperdrive, make them a trader
					if (this._debug &amp;&amp; this._logDockingType === 2) log(this.name, &quot;Switching lone escort &quot; + ship.displayName + &quot; to trader&quot;);
					prim_role = &quot;trader&quot;;
					aiName = &quot;oolite-traderAI.js&quot;;
				} else {
					if (ship.hasHyperspaceMotor === true) {
						// if they just have a hyperdrive, there&#39;s a good chance they&#39;ll decide to be a courier
						if (this._debug &amp;&amp; this._logDockingType === 2) log(this.name, &quot;Switching lone escort &quot; + ship.displayName + &quot; to courier&quot;);
						prim_role = &quot;trader-courier&quot;;
						aiName = &quot;oolite-traderAI.js&quot;;
					} else {
						// otherwise this escort is going for some R&amp;R
						if (this._debug &amp;&amp; this._logDockingType === 2) log(this.name, &quot;Dropping lone escort &quot; + ship.displayName + &quot;...heading for R&amp;R&quot;);
						return;
					}
				}
				// reset the destination so a new one can be calculated
				destSystem = -1;
			} else {
				// make sure the leader has the escort group name attached
				// isGroupLeader should always be false for an escort ship, but just to be sure
				if (isGroupLeader === false) {
					this.$setGroupEscortLeader(stationkey, lookupgroup);
				}
			}
		}

		// work out what goods and destination this ship will have when it next launches
		var destLoc = &quot;&quot;;
		if (destSystem === -1) {
			var dest = this.$getDestinationByRole(prim_role, station);
			destSystem = dest.destination;
			destHidden = dest.destinationHidden;
			if (dest.location !== &quot;&quot;) destLoc = dest.location;
		}

		var goods = &quot;&quot;;
		switch (prim_role) {
			case &quot;trader&quot;:
				goods = &quot;PLENTIFUL_GOODS&quot;;
				//if (ship.shipClassName.toLowerCase().indexOf(&quot;medical&quot;) &gt;= 0) {
				if (ship.shipClassName.search(new RegExp(&quot;medical&quot;, &quot;i&quot;)) !== -1) {
					goods = &quot;MEDICAL_GOODS&quot;;
				} else {
					if (ship.bounty !== 0) {
						goods = &quot;PIRATE_GOODS&quot;;
					}
				}
				break;
			case &quot;trader-smuggler&quot;:
				goods = &quot;ILLEGAL_GOODS&quot;;
				break;
		}

		// make sure we&#39;re not putting cargo in a ship with no cargo space
		if (ship.cargoSpaceCapacity === 0) goods = &quot;&quot;;

		// process cargo
		var cargo = &quot;&quot;;
		// if (this._NPCTrading === true) {
		//	var td = worldScripts.StationDockInfo_NPCTrading;
		//	cargo = td.$processCargo_Docking(ship);
		// }

		// check for illegal imports and increase bounty as appropriate.
		if (ship.cargoSpaceCapacity &gt; 0 &amp;&amp; ship.cargoList.length &gt; 0) {
			var bribe_attempt = Math.random();
			for (var i = 0; i &lt; ship.cargoList.length; i++) {
				var itm = ship.cargoList[i];
				if (station.market[itm.commodity].legality_import &gt; 0) {
					var chance = 0.7;
					if (this._smuggling === true) {
						chance = worldScripts.Smugglers_DockMaster._bribeChance[system.ID];
					}
					if (bribe_attempt &lt; chance) {
						ship.bounty += itm.quantity * station.market[itm.commodity].legality_import;
						if (this._debug &amp;&amp; this._logDockingType &gt;= 1) {
							log(this.name, &quot;Ship was carrying illegal cargo (&quot; + itm.commodity + &quot;) - bounty increased by &quot; + itm.quantity * station.market[itm.commodity].legality_import);
						}
					} else {
						if (this._debug &amp;&amp; this._logDockingType &gt;= 1) {
							log(this.name, &quot;Ship was carrying illegal cargo (&quot; + itm.commodity + &quot;) - ship bribed dockmaster&quot;);
						}
					}
				}
			}
		}

		var pilot = {};
		pilot[&quot;name&quot;] = ship.crew[0].name;
		pilot[&quot;insurance&quot;] = ship.crew[0].insuranceCredits;
		pilot[&quot;description&quot;] = ship.crew[0].description;
		pilot[&quot;homeSystem&quot;] = ship.crew[0].homeSystem;
		pilot[&quot;legalStatus&quot;] = (ship.markedForFines ? 0 : ship.crew[0].legalStatus);
		pilot[&quot;species&quot;] = ship.crew[0].species;

		var equip = &quot;&quot;;
		// pick up all installed equipment
		var eq = ship.equipment;
		for (var i = 0; i &lt; eq.length; i++) {
			var eqItem = eq[i];
			if (this._ignoreEquip.indexOf(eqItem.equipmentKey) !== -1) equip += eqItem.equipmentKey + &quot;,&quot;;
		}
		// pick up the installed weapons;
		if (ship.forwardWeapon) equip += &quot;FORE:&quot; + ship.forwardWeapon.equipmentKey + &quot;,&quot;;
		if (ship.aftWeapon) equip += &quot;AFT:&quot; + ship.aftWeapon.equipmentKey + &quot;,&quot;;
		if (ship.portWeapon) equip += &quot;PORT:&quot; + ship.portWeapon.equipmentKey + &quot;,&quot;;
		if (ship.starboardWeapon) equip += &quot;STARBOARD:&quot; + ship.starboardWeapon.equipmentKey + &quot;,&quot;;

		var shipname = &quot;&quot;;
		shipname = ship.shipUniqueName;
		// occasionally the shipUniqueName returns &quot;&quot; even though it&#39;s really there. In that instance, pull the unique name out of the display name
		if (shipname === &quot;&quot;) shipname = this.$getShipUniqueName(ship.displayName, ship.shipClassName);

		// check to see if this ship has a callback for when it docks
		var launchCB = &quot;&quot;;
		var launchWS = &quot;&quot;;
		if (this._pendingDock.length &gt; 0) {
			for (var i = this._pendingDock.length - 1; i &gt;= 0; i--) {
				var item = this._pendingDock[i];
				if ((item.shipName === &quot;&quot; || item.shipName === shipname) &amp;&amp;
					(item.shipType === &quot;&quot; || item.shipType === ship.shipClassName) &amp;&amp;
					(item.pilotName === &quot;&quot; || item.pilotName === pilot.name)) {
					// we found a match, so execute the callback
					var w = worldScripts[item.worldScript];
					if (w) w[item.callback](station, item.parameter);
					if (item.launchCallback !== &quot;&quot;) {
						launchCB = item.launchCallback;
						launchWS = item.worldScript;
					}
					// remove the item from the array
					this._pendingDock.splice(i, 1);
				}
			}
		}

		var props = {};
		for (var i = 0; i &lt; this._propertiesToKeep.length; i++) {
			var prop = this._propertiesToKeep[i];
			if (ship.script.hasOwnProperty(prop) === true) {
				props[prop] = ship.script[prop];
			}
		}

		// store all the data in the array
		this.$addShipToArray({
			station: station,
			stationIndex: stnIndex,
			role: prim_role,
			shipType: ship.shipClassName,
			shipDataKey: ship.dataKey,
			shipName: shipname,
			personality: ship.entityPersonality,
			aiName: aiName,
			accuracy: ship.accuracy,
			equipment: equip,
			heatInsulation: ship.heatInsulation,
			fuel: fuel,
			homeSystem: ship.homeSystem,
			bounty: (ship.markedForFines ? 0 : ship.bounty),
			escortName: (isEscort === true ? lookupgroup : &quot;&quot;),
			escortLeader: isGroupLeader,
			groupName: (isEscort === true ? &quot;&quot; : lookupgroup),
			groupLeader: isGroupLeader,
			destinationSystem: destSystem,
			destinationHidden: destHidden,
			destination: destLoc,
			goods: goods,
			cargo: cargo,
			pilot: pilot,
			dockTime: clock.seconds,
			departureTime: depart,
			departureSeconds: departSecs,
			autoLog: 2,
			lastChange: clock.adjustedSeconds,
			launchCallback: launchCB,
			worldScript: launchWS,
			properties: props
		});

		if (this._debug &amp;&amp; this._logDockingType === 2 &amp;&amp; ship.markedForFines) log(this.name, &quot;Ship was marked for fines and has been had their bounty cleared&quot;);

		// remove the ship from the group data
		sdc_pop.$removeShip(ship);
	}

	//-------------------------------------------------------------------------------------------------------------
	// launch any ships whose departure time has expired
	this.$launchPendingShips = function $launchPendingShips() {
		function compare(a, b) {
			return ((a.departureTime * 10 + a.departureSeconds) - (b.departureTime * 10 + b.departureSeconds));
		}
		//-------------------------------------------------------------------------------------------------------------
		// returns the number of docked ships in the same group as the passed record
		function countShipsInGroup(dockingData, shipdata) {
			var items = 1;
			if (shipdata.escortName === &quot;&quot; || shipdata.groupName === &quot;&quot;) return 1;
			var dta = dockingData[shipdata.station + &quot;_&quot; + shipdata.stationIndex];
			if (dta &amp;&amp; dta.length &gt; 0) {
				for (var i = 0; i &lt; dta.length; i++) {
					var item = dta[i];
					if (item.groupName === shipdata.groupName || item.escortName === shipdata.escortName) items += 1;
				}
			}
			return items;
		}

		// don&#39;t launch ships in the middle of an update to the array
		if (this._launchListUpdating === true) return;

		if (this._launching.length &gt; 0) {
			if (this._debug &amp;&amp; this._logLaunchType &gt; 0) log(this.name, &quot;Launching pending ships &quot; + this._launching.length);

			var clearlist = [];

			this._launching.sort(compare);

			for (var i = 0; i &lt; this._launching.length; i++) {
				// launch it
				// add the ship to the launch queue
				// will this ship be part of a group?
				var shp = this._launching[i];

				if (shp.system === system.ID) {
					var station = this.$getStationFromName(shp.station, shp.stationIndex);
					if (station == null) {
						// only output to the log the station is null error once for each station
						if (this.$indexInList(shp.station + &quot;_&quot; + shp.stationIndex, this._stationNullError) === -1) {
							log(this.name, &quot;!!ERROR: Station is null (OXP removed?): Removing &quot; + shp.shipName + &quot; -- &quot; + shp.station + &quot; (&quot; + shp.stationIndex + &quot;)&quot;);
							this._stationNullError.push(shp.station + &quot;_&quot; + shp.stationIndex);
						}
						// remove the ship if the station doesn&#39;t exist anymore
						clearlist.push(i);
					}

					// make sure we have a valid station before trying to launch
					// to catch the case when a station OXP was removed
					if (station &amp;&amp; Math.round(shp.departureTime) !== -5) {
						// work out how many ships are going to be launching at the same time
						var shipcount = countShipsInGroup(shp, this._systemDockingData[system.ID]);
						// is there any space in the launch queue for this group of ships
						// so, if there&#39;s only 1 slot, and there&#39;s 5 ships in this group, don&#39;t launch any of them
						if (this.$launchAvailable(station, shipcount) === true) {

							var shpKey = shp.shipDataKey;
							// make sure a single ship is launched (ie without escorts)
							if (this.$dockVersionExists(shpKey)) shpKey = &quot;dock_&quot; + shpKey;

							if (this._debug &amp;&amp; this._logLaunchType &gt; 0) this.$writeDataToLog(shp, &quot;Launching ship through &quot; + shp.station + &quot; (&quot; + shp.stationIndex + &quot;)&quot;);
							var ship = station.launchShipWithRole(&quot;[&quot; + shpKey + &quot;]&quot;);

							if (!ship) {
								// Oops! no ship returned!
								// skip it this time and maybe next time it will launch
								if (this._debug &amp;&amp; this._logLaunchType &gt; 0) log(this.name, &quot;!!NOTE: Did not create ship of type &#39;&quot; + shpKey + &quot;&#39; - launchShipWithRole returned null&quot;);
								continue;
							}

							// make a note of the item to clear from the array
							clearlist.push(i);

							// update details of launched ship
							this.$updateLaunchedShip(ship, shp);

							// if there is an attached callback, call it now.
							if (shp.launchCallback &amp;&amp; shp.worldScript) {
								var w = worldScripts[shp.worldScript];
								if (w) w[shp.launchCallback](&quot;launching&quot;, ship);
							}
						} else {
							// when launch is not available
							// options are: (1) try again on the next cycle &gt; do nothing
							// 				(2) schedule ship (group) for a new time
							if (Math.random() &lt; 0.4) {
								if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, &quot;Ship &quot; + shp.shipName + &quot; being moved to &#39;rescheduled&#39; status!&quot;);
								shp.departureTime = -5;
								shp.lastChange = clock.adjustedSeconds;
								// move any escort/group members to -5, plus 0.1 so they can be sorted correctly
								this.$updateGroupMemberLaunchingData(shp.groupName, shp.escortName, &quot;departureTime&quot;, -5);
							}
						}
					} // if station
				} else {
					// if there are launching items from another system, just purge them
					if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, &quot;Ship &quot; + shp.shipName + &quot; was to be launched in system &quot; + shp.system + &quot; - purging&quot;);
					clearlist.push(i);
				}
			} // for

			// clear the array of all ships we launched
			var i = clearlist.length;
			while (i--) {
				this._launching.splice(clearlist[i], 1);
			}
			if (this._launching.length &gt; 0) {
				if (this._debug &amp;&amp; this._logLaunchType === 2) {
					log(this.name, &quot;Launching queue length: &quot; + this._launching.length);
					if (this._shipMonitor === 1) {
						log(this.name, &quot;=====Current launching queue data=====&quot;);
						for (var i = 0; i &lt; this._launching.length; i++) {
							this.$writeDataToLog(this._launching[i], &quot;Launching queue item &quot; + i);
						}
					}
				}
			}
		} // if
	}

	//-------------------------------------------------------------------------------------------------------------
	// populates the docked vessels in each station in the system
	this.$populateStationList = function $populateStationList(timeRange) {
		// don&#39;t create anything if the system is nova or going nova
		if (system.sun &amp;&amp; (system.sun.isGoingNova || system.sun.hasGoneNova)) {
			return;
		}

		this._autoGenerationInProgress = true;

		// has the station indexes function been run?
		if (this.$getStationIndex(system.mainStation) === 0) {
			this.$stationIndexes();
		}

		// work out the min value to send to the calculateRandomDepartureTime routine
		var slots = this.$calculateSlots(timeRange);

		if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) log(this.name, &quot;timeRange = &quot; + timeRange + &quot;, slot = &quot; + slots);

		// go through all stations in the system
		var stns = system.stations;
		// make sure the player&#39;s station goes in first
		if (player.ship.dockedStation &amp;&amp; this._repopulateStation == null) this.$applyTimeRange(player.ship.dockedStation, slots, timeRange);
		stns.forEach(function (station) {
			if (station.hasNPCTraffic &amp;&amp; this.$checkStationRoleForNoTraffic(station) === false &amp;&amp; (this._repopulateStation == null || station === this._repopulateStation)) {
				this.$applyTimeRange(station, slots, timeRange)
			}
		}, this);
	}

	//-------------------------------------------------------------------------------------------------------------
	this.$getPopulatorVars = function $getPopulatorVars() {
		// What follows is an attempt to recreate the oolite-populator functions for outgoing ships.
		// The idea is to put the ships into the docking queue of any stations in the system.
		// Then, on each call of the systemWillRepopulate function, the new function will look for any ships
		// that are due to launch and launch them, based on the template stored in _systemDockingData array.
		// The goal is to have a similar spread of ships launching from stations as would happen with the
		// original script. The only part of the original script I couldn&#39;t do was to check the count of
		// various ship types in system, and then launch extras as required. This would maintain a reasonable
		// balance of different ship types. But because this system assumes the ships have to be in a station
		// somewhere, that balancing aspect is gone. Hopefully the deeper sense of realism counteracts this
		// to some degree.

		// This function will be called each time a player enters a new system to populate the docks of all
		// stations in system.

		// the logic here is to use the default populator chance values in ranges:
		// eg for the traders: from 0 - 0.09 is treder freighters, 0.09 to 0.095 is couriers, 0.095 to 0.10 is smugglers, 0.10 to 0.11 is assassins, 0.11 to 0.12 is shuttles
		// finally, we add on the possibility of skipping a vessel.
		// then, a random number is selected from the total range, between 0 and the max value
		// that will hopefully return a similar spread of vessels as the original code.

		var w = worldScripts[&quot;oolite-populator&quot;];
		// set up all the ranges for data selection
		var base = 0;
		this._populatorVars = {};
		this._populatorVars[&quot;rangeTradeFreight&quot;] = [0, w.$repopulatorFrequencyOutgoing.traderFreighters];
		base += w.$repopulatorFrequencyOutgoing.traderFreighters;
		this._populatorVars[&quot;rangeTradeCourier&quot;] = [base, base + w.$repopulatorFrequencyOutgoing.traderCouriers];
		base += w.$repopulatorFrequencyOutgoing.traderCouriers;
		this._populatorVars[&quot;rangeTradeSmuggl&quot;] = [base, base + w.$repopulatorFrequencyOutgoing.traderSmugglers];
		base += w.$repopulatorFrequencyOutgoing.traderSmugglers;
		this._populatorVars[&quot;rangeAssassin&quot;] = [base, base + w.$repopulatorFrequencyOutgoing.assassins];
		base += w.$repopulatorFrequencyOutgoing.assassins;
		this._populatorVars[&quot;rangeShuttle&quot;] = [base, base + (0.005 * system.info.techlevel)];
		base += (0.005 * system.info.techlevel);
		// set the max for this data set, including a skip vessel factor, if required
		this._populatorVars[&quot;traderMax&quot;] = base + (this._traderSkipVesselFactor &gt; 0 ? ((5 - base) / this._traderSkipVesselFactor) : 0);

		base = 0;
		this._populatorVars[&quot;rangePirateInd&quot;] = [0, w.$repopulatorFrequencyOutgoing.pirateIndependents];
		base += w.$repopulatorFrequencyOutgoing.pirateIndependents;
		this._populatorVars[&quot;rangePirateLight&quot;] = [base, base + w.$repopulatorFrequencyOutgoing.pirateLightPacks];
		base += w.$repopulatorFrequencyOutgoing.pirateLightPacks;
		this._populatorVars[&quot;rangePirateMedium&quot;] = [base, base + w.$repopulatorFrequencyOutgoing.pirateMediumPacks];
		base += w.$repopulatorFrequencyOutgoing.pirateMediumPacks;
		this._populatorVars[&quot;rangePirateHeavy&quot;] = [base, base + w.$repopulatorFrequencyOutgoing.pirateHeavyPacks];
		base += w.$repopulatorFrequencyOutgoing.pirateHeavyPacks;
		// set the max for this data set, including a skip vessel factor, if required
		this._populatorVars[&quot;pirateMax&quot;] = base + (this._pirateSkipVesselFactor &gt; 0 ? ((4 - base) / this._pirateSkipVesselFactor) : 0);

		base = 0;
		this._populatorVars[&quot;rangeHunterLight&quot;] = [0, w.$repopulatorFrequencyOutgoing.hunterLightPacks];
		base += w.$repopulatorFrequencyOutgoing.hunterLightPacks;
		this._populatorVars[&quot;rangeHunterMedium&quot;] = [base, base + w.$repopulatorFrequencyOutgoing.hunterMediumPacks];
		base += w.$repopulatorFrequencyOutgoing.hunterMediumPacks;
		this._populatorVars[&quot;rangeHunterHeavy&quot;] = [base, base + w.$repopulatorFrequencyOutgoing.hunterHeavyPacks];
		base += w.$repopulatorFrequencyOutgoing.hunterHeavyPacks;
		// set the max for this data set, including a skip vessel factor, if required
		this._populatorVars[&quot;hunterMax&quot;] = base + (this._hunterSkipVesselFactor &gt; 0 ? ((3 - base) / this._hunterSkipVesselFactor) : 0);
	}

	//-------------------------------------------------------------------------------------------------------------
	this.$stationIsRepopulating = function $stationIsRepopulating(station) {
		if (this._populateStation.length === 0) return false;
		for (var i = 0; i &lt; this._populateStation.length; i++) {
			if (this._populateStation[i].stn.displayName === station.displayName) return true;
		}
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------
	this.$applyTimeRange = function $applyTimeRange(station, slots, timeRange) {
		// go through all stations in the system
		var stns = system.stations;
		if (slots === 0) slots = this.$calculateSlots(timeRange);
		// make sure the player&#39;s station goes in first
		if (this.$stationIsRepopulating(station) === false) {
			this._populateStation.push({
				stn: station,
				slots: slots,
				timeRange: timeRange
			});
		} else {
			for (var i = 0; i &lt; this._populateStation.length; i++) {
				var item = this._populateStation[i];
				if (item.stn === station) {
					if (item.timeRange &lt; timeRange) {
						item.slots = slots;
						item.timeRange = timeRange;
					}
					break;
				}
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	this.$calculateSlots = function $calculateSlots(timeRange) {
		var slots = 0;
		if (timeRange &lt; 10) slots = 10;
		//if (10 &lt;= timeRange &amp;&amp; timeRange &lt; 60) slots = 10;
		//if (60 &lt;= timeRange &amp;&amp; timeRange &lt; 180) slots = 9;
		//if (180 &lt;= timeRange &amp;&amp; timeRange &lt; 420) slots = 8;
		//if (420 &lt;= timeRange &amp;&amp; timeRange &lt; 660) slots = 7;
		//if (660 &lt;= timeRange &amp;&amp; timeRange &lt; 1260) slots = 6;
		//if (1260 &lt;= timeRange &amp;&amp; timeRange &lt; 1320) slots = 5;
		//if (1320 &lt;= timeRange &amp;&amp; timeRange &lt; 1350) slots = 4;
		//if (1350 &lt;= timeRange &amp;&amp; timeRange &lt; 1435) slots = 3;
		//if (1435 &lt;= timeRange) slots = 2; // full refresh from this point
		if (10 &lt;= timeRange &amp;&amp; timeRange &lt; 60) slots = 10;
		if (60 &lt;= timeRange &amp;&amp; timeRange &lt; 180) slots = 8;
		if (180 &lt;= timeRange &amp;&amp; timeRange &lt; 420) slots = 6;
		if (420 &lt;= timeRange &amp;&amp; timeRange &lt; 660) slots = 4;
		if (660 &lt;= timeRange) slots = 2; // full refresh from this point
		return slots;
	}

	//-------------------------------------------------------------------------------------------------------------
	this.$runPopulation = function $runPopulation() {
		// is there anything in our processing array?
		if (this._populateStation.length === 0) return;

		// check for being in space and red alert - skip doing anything to prevent any glitches
		if (player.ship.isInSpace &amp;&amp; player.alertCondition === 3) return;

		// have we done a pre-population of the ship dock values yet?
		// if not, run the process now
		/*if (!this._doShipDockDataGrab[this._populateStation[0].stn.shipClassName]) {
			this.$grabAllShipDockValues(this._populateStation[0].stn);
			this._doShipDockDataGrab[this._populateStation[0].stn.shipClassName] = true;
		}*/

		if (system.isInterstellarSpace) {
			// remove all interstellar stations from the array
			this._populateStation.splice(0, 1);
			return;
		}

		// make sure we don&#39;t trip over ourselves
		if (this._running === true) return;
		if (this._jumpStarted === true) return;
		this._running = true;
		var trueValues = this._trueValues;
		var logging = 0;
		if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) logging = 1;

		if (!this._populatorVars) this.$getPopulatorVars();
		var popVars = this._populatorVars;

		var station = this._populateStation[0].stn;
		var slots = this._populateStation[0].slots;
		var random = Math.random;
		var randomInt = this.$rand;
		var indexInList = this.$indexInList;
		var calcIns = this.$calcInsurance;
		var shipDataRef = this._shipData;

		// &amp;&amp; &quot;galcop neutral chaotic pirate hunter&quot;.indexOf(station.allegiance) &gt;= 0
		if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) {
			var startDate = new Date();
			log(this.name, &quot;==============================================================================&quot;);
			log(this.name, &quot;station === &quot; + station);
		}
		// get the index for this station
		var stnIndex = this.$getStationIndex(station);
		var stationkey = station.name + &quot;_&quot; + stnIndex;

		var countTraderFreighter = 0;
		var countTraderCourier = 0;
		var countTraderSmuggler = 0;
		var countAssassin = 0;
		var countShuttle = 0;
		var countPirateInd = 0;
		var countPirateLight = 0;
		var countPirateMedium = 0;
		var countPirateHeavy = 0;
		var countHunterLight = 0;
		var countHunterMedium = 0;
		var countHunterHeavy = 0;

		// create some random data if our array is empty
		// work out number of ships to add to array
		var calctype = 0; // type 0 = original calculation seeds, type 1 = beo&#39;s version

		switch (calctype) {
			case 0:
				var factor = 0;
				// hour many trading partners does this system have
				factor += this._neighbours.length * 5;
				// more stable governments mean more ships in system
				factor += system.government;
				// more advanced systems mean more ships in system
				factor += system.techLevel;
				// how many ships are already in dock
				var curr = this.$countStationItems(station);
				// work out the max and min values
				var max = factor * 6;
				var min = factor * 2;
				break;
			case 1: // variation suggested by forum member beo
				var factor = 1;
				// hour many trading partners does this system have
				factor += this._neighbours.length * 3;
				// more stable governments mean more ships in system
				factor += Math.round(system.government / 4);
				// more advanced systems mean more ships in system
				factor += Math.round(system.techLevel / 7);
				// how many ships are already in dock
				var curr = this.$countStationItems(station);
				// work out the max and min values
				var max = factor * 5;
				var min = factor * 2;
				break;
		}

		// work out high/medium/low traffic variations:
		if (this.$checkStationRoleForMediumTraffic(station)) {
			max = parseInt(max / 1.8);
			min = parseInt(min / 1.8);
			//if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) 
				//log(this.name, station.name + &quot; selected for medium traffic (F:&quot; + factor + &quot;, Max:&quot; + max + &quot;, Min:&quot; + min + &quot;)&quot;);
		} else if (this.$checkStationRoleForLowTraffic(station)) {
			max = parseInt(max / 4);
			min = parseInt(min / 4);
			//if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) 
				//log(this.name, station.name + &quot; selected for low traffic (F:&quot; + factor + &quot;, Max:&quot; + max + &quot;, Min:&quot; + min + &quot;)&quot;);
		} else if (this.$checkStationRoleForVeryLowTraffic(station)) {
			max = parseInt(max / 10);
			min = parseInt(min / 10);
			//if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) 
				//log(this.name, station.name + &quot; selected for very low traffic (F:&quot; + factor + &quot;, Max:&quot; + max + &quot;, Min:&quot; + min + &quot;)&quot;);
		} else {
			//if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) 
				//log(this.name, station.name + &quot; selected for normal traffic (F:&quot; + factor + &quot;, Max:&quot; + max + &quot;, Min:&quot; + min + &quot;)&quot;);
		}

		// calculate a random number in our range
		var ships = (randomInt(max - min) + min) - curr;
		if (ships &gt; 300) ships = 300; // upper limit

		//if (this._debug &amp;&amp; this._logPopulatorType &gt; 0) log(this.name, &quot;Initial estimate of &quot; + ships + &quot; for &quot; + station.name + &quot;(&quot; + stnIndex + &quot;) (&quot; + station.primaryRole + &quot;)&quot;);

		if (ships &gt; 0) {
			// work out which ship roles to add to the station
			if (this._debug) log(this.name, &quot;Estimated ship count = &quot; + ships);
			// create the departure slots array for this station
			this.$createDepartureSlots();
			// if we have existing items in this station, remove their slots from the array
			if (this.$countStationItems(station) !== 0) {
				this.$removeExistingSlots(station);
			}

			var actualCount = 0;

			var i = ships;
			while (i--) {
				var shpType = &quot;&quot;;
				var shpDataKey = &quot;&quot;;
				var shpName = &quot;&quot;;
				var role = &quot;&quot;;

				var selection = 0;

				var selPirate = random();
				var selHunter = random();

				var depart = 0;
				var pilot = {};
				var bounty = 0;
				var home = 0;
				var species = &quot;&quot;;
				var shipDockTime = 0;
				var insurance = 0;
				var destSystem = -1;
				var destHidden = false;
				var aiName = &quot;&quot;;
				var skill = 0;
				var weapons = 0;
				var heat = 0;
				var groupName = &quot;&quot;;
				var isLeader = false;
				var equip = &quot;&quot;;
				var escortGroupName = &quot;&quot;;
				var goods = &quot;&quot;;
				var escorts = [];
				var groupData = [];
				var autoAI = &quot;&quot;;

				var choose = 0;

				depart = this.$calculateRandomDepartureTime(station, stnIndex, slots, true);
				if (depart === -1) continue;

				shipDockTime = (depart * 60 + clock.adjustedSeconds) - (randomInt(720) * 60); // arrival time was up to 12 hours prior to their scheduled departure time

				// work out what type of ship we are going to add
				// some of this will be based on what station type we are currently looking at
				// note: some OXP stations can end up with &quot;null&quot; for station allegiance - in this instance assume &quot;neutral&quot;;
				var alleg = station.allegiance;
				if (alleg == null) alleg = &quot;neutral&quot;;

				if (alleg === &quot;neutral&quot; || (alleg === &quot;galcop&quot; &amp;&amp; selHunter &lt; 0.5) || (alleg === &quot;chaotic&quot; &amp;&amp; selPirate &lt; 0.5)) {
					choose = random() * popVars.traderMax;
					if (choose &gt;= popVars.rangeTradeFreight[0] &amp;&amp; choose &lt; popVars.rangeTradeFreight[1]) selection = 1;
					if (choose &gt;= popVars.rangeTradeCourier[0] &amp;&amp; choose &lt; popVars.rangeTradeCourier[1]) selection = 2;
					if (choose &gt;= popVars.rangeTradeSmuggl[0] &amp;&amp; choose &lt; popVars.rangeTradeSmuggl[1]) selection = 3;
					if (choose &gt;= popVars.rangeAssassin[0] &amp;&amp; choose &lt; popVars.rangeAssassin[1]) selection = 4;
					if (choose &gt;= popVars.rangeShuttle[0] &amp;&amp; choose &lt; popVars.rangeShuttle[1]) selection = 5;
				}

				if (alleg === &quot;pirate&quot; || (alleg === &quot;chaotic&quot; &amp;&amp; selPirate &gt;= 0.5)) {
					choose = random() * popVars.pirateMax;
					if (choose &gt;= popVars.rangePirateInd[0] &amp;&amp; choose &lt; popVars.rangePirateInd[1]) selection = 6;
					if (choose &gt;= popVars.rangePirateLight[0] &amp;&amp; choose &lt; popVars.rangePirateLight[1]) selection = 7;
					if (choose &gt;= popVars.rangePirateMedium[0] &amp;&amp; choose &lt; popVars.rangePirateMedium[1]) selection = 8;
					if (choose &gt;= popVars.rangePirateHeavy[0] &amp;&amp; choose &lt; popVars.rangePirateHeavy[1]) selection = 9;
				}

				if (alleg === &quot;hunter&quot; || (alleg === &quot;galcop&quot; &amp;&amp; selHunter &gt;= 0.5)) {
					choose = random() * popVars.hunterMax;
					if (choose &gt;= popVars.rangeHunterLight[0] &amp;&amp; choose &lt; popVars.rangeHunterLight[1]) selection = 10;
					if (choose &gt;= popVars.rangeHunterMedium[0] &amp;&amp; choose &lt; popVars.rangeHunterMedium[1]) selection = 11;
					if (choose &gt;= popVars.rangeHunterHeavy[0] &amp;&amp; choose &lt; popVars.rangeHunterHeavy[1]) selection = 12;
				}

				if (selection &gt; 0) actualCount += 1;

				switch (selection) {
					case 1: // trader
						countTraderFreighter += 1;
						role = &quot;trader&quot;;
						shpDataKey = this.$getRandomShipKeyWithDockCheck(role, station);
						shpName = this.$getRandomShipName(role);
						autoAI = shipDataRef[shpDataKey][&quot;auto_ai&quot;];
						shpType = shipDataRef[shpDataKey].name;

						home = system.ID;
						var dest = this.$getDestinationByRole(role, station);
						destSystem = dest.destination;
						destHidden = dest.destinationHidden;

						// occasionally make the home system the same as the dest system so not every ship in dock calls this system home
						if (random() &lt; 0.3) home = this.$nearbySystem(7);

						var hasAutoAI = (indexInList(autoAI, trueValues) &gt;= 0);
						// not sure if the destination will stick for ships with a specific AI, so just hide the destination so there&#39;s no confusion
						if (destHidden === false &amp;&amp; hasAutoAI === false) destHidden = true;

						goods = &quot;PLENTIFUL_GOODS&quot;;

						if (typeof autoAI === &quot;undefined&quot; || hasAutoAI === true) aiName = &quot;oolite-traderAI.js&quot;;

						if (shpType.search(new RegExp(&quot;medical&quot;, &quot;i&quot;)) !== -1) {
							goods = &quot;MEDICAL_GOODS&quot;;
							bounty = 0;
						} else {
							if (random() &lt; 0.05) {
								bounty = Math.ceil(random() * 20);
								if (random() &lt; 0.5 &amp;&amp; hasAutoAI === true) {
									aiName = &quot;oolite-traderOpportunistAI.js&quot;;
									if (indexInList(shipDataRef[shpDataKey][&quot;auto_weapons&quot;], trueValues) &gt;= 0) {
										skill = 2;
										weapons = 2.5;
									}
									goods = &quot;PIRATE_GOODS&quot;;
								}
							} else {
								bounty = 0;
							}
						}

						pilot = this.$createPilot((random() &lt; 0.5 ? home : destSystem), bounty, calcIns(bounty));

						if (indexInList(shpDataKey, this._switchEscortsToGroup) &gt;= 0) {
							var groupInfo = this.$processTraderEscorts(shpDataKey);
							groupData = groupInfo.escortData;
							isLeader = groupInfo.leader;
							if (isLeader === true) {
								groupName = &quot;shipgroup-&quot; + this._groupCounter;
								this._groupCounter += 1;
							}
						} else {
							var escortInfo = this.$processTraderEscorts(shpDataKey);
							escorts = escortInfo.escortData;
							isLeader = escortInfo.leader;
							escortGroupName = escortInfo.name;
						}

						this.$addShipToArray({
							station: station,
							stationIndex: stnIndex,
							role: role,
							shipType: shpType,
							shipDataKey: shpDataKey,
							shipName: shpName,
							aiName: aiName,
							accuracy: this.$setAccuracy(shpDataKey, skill),
							equipment: this.$setWeapons(shpDataKey, weapons),
							heatInsulation: this.$setHeatInsulation(shpDataKey, 0),
							homeSystem: home,
							bounty: bounty,
							escortName: escortGroupName,
							escortLeader: (escortGroupName != &quot;&quot; ? isLeader : false),
							groupName: groupName,
							groupLeader: (groupName != &quot;&quot; ? isLeader : false),
							destinationSystem: destSystem,
							destinationHidden: destHidden,
							goods: goods,
							pilot: pilot,
							dockTime: shipDockTime,
							departureTime: depart,
							departureSeconds: 0,
							autoLog: logging
						});

						break;

					case 2: // courier
						countTraderCourier += 1;
						role = &quot;trader-courier&quot;;
						if (this.$roleExists(role) === false) role = &quot;trader&quot;;
						shpDataKey = this.$getRandomShipKeyWithDockCheck(role, station);
						shpName = this.$getRandomShipName(role);
						autoAI = shipDataRef[shpDataKey][&quot;auto_ai&quot;];
						shpType = shipDataRef[shpDataKey].name;

						var hasAutoAI = (indexInList(autoAI, trueValues) &gt;= 0);
						if (typeof autoAI === &quot;undefined&quot; || hasAutoAI === true) aiName = &quot;oolite-traderAI.js&quot;;

						bounty = 0;
						heat = 6;
						home = system.ID;
						// occasionally make the home system the same as the dest system so not every ship in dock calls this system home
						if (random() &lt; 0.3) home = this.$nearbySystem(7);

						var dest = this.$getDestinationByRole(role, station);
						destSystem = dest.destination;
						destHidden = dest.destinationHidden;

						// not sure if the destination will stick for ships with a specific AI, so just hide the destination so there&#39;s no confusion
						if (destHidden === false &amp;&amp; hasAutoAI === false) destHidden = true;

						pilot = this.$createPilot((random() &lt; 0.5 ? home : destSystem), bounty, calcIns(bounty));
						goods = &quot;PLENTIFUL_GOODS&quot;;

						if (indexInList(shpDataKey, this._switchEscortsToGroup) &gt;= 0) {
							var groupInfo = this.$processTraderEscorts(shpDataKey);
							groupData = groupInfo.escortData;
							isLeader = groupInfo.leader;
							if (isLeader === true) {
								groupName = &quot;shipgroup-&quot; + this._groupCounter;
								this._groupCounter += 1;
							}
						} else {
							var escortInfo = this.$processTraderEscorts(shpDataKey);
							escorts = escortInfo.escortData;
							isLeader = escortInfo.leader;
							escortGroupName = escortInfo.name;
						}

						this.$addShipToArray({
							station: station,
							stationIndex: stnIndex,
							role: role,
							shipType: shpType,
							shipDataKey: shpDataKey,
							shipName: shpName,
							aiName: aiName,
							accuracy: this.$setAccuracy(shpDataKey, skill),
							equipment: this.$setWeapons(shpDataKey, weapons),
							heatInsulation: heat,
							homeSystem: home,
							bounty: bounty,
							escortName: escortGroupName,
							escortLeader: (escortGroupName != &quot;&quot; ? isLeader : false),
							groupName: groupName,
							groupLeader: (groupName != &quot;&quot; ? isLeader : false),
							destinationSystem: destSystem,
							destinationHidden: destHidden,
							goods: goods,
							pilot: pilot,
							dockTime: shipDockTime,
							departureTime: depart,
							departureSeconds: 0,
							autoLog: logging
						});

						break;

					case 3: // smuggler
						countTraderSmuggler += 1;
						role = &quot;trader-smuggler&quot;;
						if (this.$roleExists(role) === false) role = &quot;trader&quot;;
						shpDataKey = this.$getRandomShipKeyWithDockCheck(role, station);
						shpName = this.$getRandomShipName(role);
						autoAI = shipDataRef[shpDataKey][&quot;auto_ai&quot;];
						shpType = shipDataRef[shpDataKey].name;

						var hasAutoAI = (indexInList(autoAI, trueValues) &gt;= 0);
						if (typeof autoAI === &quot;undefined&quot; || hasAutoAI === true) aiName = &quot;oolite-traderAI.js&quot;;

						bounty = Math.ceil(random() * 20);
						weapons = 1.2;
						home = system.ID;
						// occasionally make the home system the same as the dest system so not every ship in dock calls this system home
						if (random() &lt; 0.3) home = this.$nearbySystem(7);
						var dest = this.$getDestinationByRole(role, station);
						destSystem = dest.destination;
						destHidden = dest.destinationHidden;

						// not sure if the destination will stick for ships with a specific AI, so just hide the destination so there&#39;s no confusion
						if (destHidden === false &amp;&amp; hasAutoAI === false) destHidden = true;

						var maxcargo = parseInt(shipDataRef[shpDataKey][&quot;max_cargo&quot;]);
						if (bounty &gt; maxcargo * 2) bounty = maxcargo * 2;

						goods = &quot;ILLEGAL_GOODS&quot;;

						if (indexInList(shpDataKey, this._switchEscortsToGroup) &gt;= 0) {
							var groupInfo = this.$processTraderEscorts(shpDataKey);
							groupData = groupInfo.escortData;
							isLeader = groupInfo.leader;
							if (isLeader === true) {
								groupName = &quot;shipgroup-&quot; + this._groupCounter;
								this._groupCounter += 1;
							}
						} else {
							var escortInfo = this.$processTraderEscorts(shpDataKey);
							escorts = escortInfo.escortData;
							isLeader = escortInfo.leader;
							escortGroupName = escortInfo.name;
						}

						equip = this.$setWeapons(shpDataKey, weapons);

						if (indexInList(shipDataRef[shpDataKey][&quot;auto_weapons&quot;], trueValues) &gt;= 0) equip += &quot;EQ_FUEL_INJECTION,&quot;; // smugglers always have injectors

						pilot = this.$createPilot((random() &lt; 0.5 ? home : destSystem), bounty, calcIns(bounty));

						this.$addShipToArray({
							station: station,
							stationIndex: stnIndex,
							role: role,
							shipType: shpType,
							shipDataKey: shpDataKey,
							shipName: shpName,
							aiName: aiName,
							accuracy: this.$setAccuracy(shpDataKey, skill),
							equipment: equip,
							heatInsulation: this.$setHeatInsulation(shpDataKey, 0),
							homeSystem: home,
							bounty: bounty,
							escortName: escortGroupName,
							escortLeader: (escortGroupName != &quot;&quot; ? isLeader : false),
							groupName: groupName,
							groupLeader: (groupName != &quot;&quot; ? isLeader : false),
							destinationSystem: destSystem,
							destinationHidden: destHidden,
							goods: goods,
							pilot: pilot,
							dockTime: shipDockTime,
							departureTime: depart,
							departureSeconds: 0,
							autoLog: logging
						});

						break;

					case 4: // assassin
						countAssassin += 1;
						role = &quot;assassin-light&quot;;
						var g = system.info.government + 2;
						skill = 0;
						weapons = 2;
						if (random() &gt; g / 10) {
							role = &quot;assassin-medium&quot;;
							skill = 1;
							weapons = 2.5;
							if (random() &gt; g / 5) {
								role = &quot;assassin-heavy&quot;;
								weapons = 2.8;
							}
						}
						if (this.$roleExists(role) === false) break; // if there are no assassin roles defined, don&#39;t try to create one.

						shpDataKey = this.$getRandomShipKeyWithDockCheck(role, station);
						shpName = this.$getRandomShipName(role);
						autoAI = shipDataRef[shpDataKey][&quot;auto_ai&quot;];
						shpType = shipDataRef[shpDataKey].name;

						home = system.ID;
						// occasionally make the home system the same as the dest system so not every ship in dock calls this system home
						if (random() &lt; 0.3) home = this.$nearbySystem(7);
						var dest = this.$getDestinationByRole(role, station);
						destSystem = dest.destination;;
						destHidden = dest.destinationHidden;

						equip = this.$setWeapons(shpDataKey, weapons);
						if (indexInList(shipDataRef[shpDataKey][&quot;auto_weapons&quot;], trueValues) &gt;= 0) {
							equip += &quot;EQ_FUEL_INJECTION,&quot;;
							equip += &quot;EQ_ECM,&quot;;
							if (2 + random() &lt; weapons) {
								equip += &quot;EQ_SHIELD_BOOSTER,&quot;;
							}
							// assassins don&#39;t respect escape pods and won&#39;t expect anyone
							// else to either.
							equip += &quot;X:EQ_ESCAPE_POD,&quot;;
						}

						if (skill &gt; 0) {
							groupName = &quot;shipgroup-&quot; + this._groupCounter;
							this._groupCounter += 1;
							isLeader = true;
						}
						var hasAutoAI = (indexInList(autoAI, trueValues) &gt;= 0);
						// this should be set by the role, but just in case
						if (typeof autoAI === &quot;undefined&quot; || hasAutoAI === true) aiName = &quot;oolite-assassinAI.js&quot;;
						// not sure if the destination will stick for ships with a specific AI, so just hide the destination so there&#39;s no confusion
						if (destHidden === false &amp;&amp; hasAutoAI === false) destHidden = true;

						pilot = this.$createPilot(system.ID, 0, calcIns(0));
						this.$addShipToArray({
							station: station,
							stationIndex: stnIndex,
							role: role,
							shipType: shpType,
							shipDataKey: shpDataKey,
							shipName: shpName,
							aiName: aiName,
							accuracy: this.$setAccuracy(shpDataKey, skill),
							equipment: equip,
							heatInsulation: this.$setHeatInsulation(shpDataKey, 1),
							homeSystem: home,
							bounty: 0,
							escortName: &quot;&quot;,
							escortLeader: false,
							groupName: groupName,
							groupLeader: isLeader,
							destinationSystem: destSystem,
							destinationHidden: destHidden,
							goods: &quot;&quot;,
							pilot: pilot,
							dockTime: shipDockTime,
							departureTime: depart,
							departureSeconds: 0,
							autoLog: logging
						});

						if (skill &gt; 0) {
							var numext = Math.floor(random() * 3) + 1;
							var ext_role = &quot;&quot;;
							var ext_shpType = &quot;&quot;;
							var ext_shpDataKey = &quot;&quot;;
							var ext_shpName = &quot;&quot;;
							var ext_pilot = [];
							var ext_equip = &quot;&quot;;

							for (var j = 0; j &lt; numext; j++) {
								countAssassin += 1;
								if (role === &quot;assassin-heavy&quot;) {
									ext_role = &quot;assassin-medium&quot;;
								} else {
									ext_role = &quot;assassin-light&quot;;
								}
								ext_shpDataKey = this.$getRandomShipKey(ext_role);
								ext_shpName = this.$getRandomShipName(ext_role);
								ext_shpType = shipDataRef[ext_shpDataKey].name;

								ext_equip = this.$setWeapons(ext_shpDataKey, 1.8);
								if (indexInList(shipDataRef[ext_shpDataKey][&quot;auto_weapons&quot;], trueValues) &gt;= 0) {
									ext_equip += &quot;EQ_FUEL_INJECTION,&quot;;
									ext_equip += &quot;X:EQ_ESCAPE_POD,&quot;;
								}

								aiName = &quot;&quot;;
								// this should be set by the role, but just in case
								if (typeof shipDataRef[ext_shpDataKey][&quot;auto_ai&quot;] === &quot;undefined&quot; || indexInList(shipDataRef[ext_shpDataKey][&quot;auto_ai&quot;], trueValues) &gt;= 0) aiName = &quot;oolite-assassinAI.js&quot;;

								ext_pilot = this.$createPilot(this.$nearbySystem(7), 0, calcIns(0));

								this.$addShipToArray({
									station: station,
									stationIndex: stnIndex,
									role: ext_role,
									shipType: ext_shpType,
									shipDataKey: ext_shpDataKey,
									shipName: ext_shpName,
									aiName: aiName,
									accuracy: this.$setAccuracy(ext_shpDataKey, 0),
									equipment: ext_equip,
									heatInsulation: this.$setHeatInsulation(shpDataKey, 1),
									homeSystem: home,
									bounty: 0,
									escortName: &quot;&quot;,
									escortLeader: false,
									groupName: groupName,
									groupLeader: false,
									destinationSystem: destSystem,
									destinationHidden: destHidden,
									goods: &quot;&quot;,
									pilot: ext_pilot,
									dockTime: shipDockTime,
									departureTime: depart,
									departureSeconds: 5,
									autoLog: logging
								});

							}
						}

						break;

					case 5: // shuttle
						countShuttle += 1;
						role = &quot;shuttle&quot;;
						if (this.$roleExists(role) === false) break; // if there are no shuttles defined, don&#39;t try to create one.
						shpDataKey = this.$getRandomShipKey(role);
						shpName = this.$getRandomShipName(role);
						autoAI = shipDataRef[shpDataKey][&quot;auto_ai&quot;];
						shpType = shipDataRef[shpDataKey].name;

						// this should be set by the role, but just in case
						aiName = &quot;&quot;;
						var hasAutoAI = (indexInList(autoAI, trueValues) &gt;= 0);
						// some of griffs have auto_ai = &quot;undefined&quot; which I&#39;m assuming means &quot;yes&quot;
						if (typeof autoAI === &quot;undefined&quot; || hasAutoAI === true) aiName = &quot;oolite-shuttleAI.js&quot;;

						home = system.ID;
						var dest = this.$getDestinationByRole(role, station);
						destSystem = dest.destination;
						destHidden = dest.destinationHidden;
						var destLoc = dest.location;

						// even shuttles will hide their destination
						//if (random() &lt; 0.3) destHidden = true;
						// hide their destination if they have a custom AI - we don&#39;t know what they&#39;ll do!
						if (aiName === &quot;&quot;) destHidden = true;

						pilot = this.$createPilot(home, 0, calcIns(0));

						this.$addShipToArray({
							station: station,
							stationIndex: stnIndex,
							role: role,
							shipType: shpType,
							shipDataKey: shpDataKey,
							shipName: shpName,
							aiName: aiName,
							accuracy: this.$setAccuracy(shpDataKey, 1),
							equipment: this.$setWeapons(shpDataKey, 0),
							heatInsulation: this.$setHeatInsulation(shpDataKey, 1),
							homeSystem: home,
							bounty: 0,
							escortName: &quot;&quot;,
							escortLeader: false,
							groupName: &quot;&quot;,
							groupLeader: false,
							destinationSystem: destSystem,
							destination: destLoc,
							destinationHidden: destHidden,
							goods: &quot;&quot;,
							pilot: pilot,
							dockTime: shipDockTime,
							departureTime: depart,
							departureSeconds: 0,
							autoLog: logging
						});

						break;

					case 6: // pirate independant
						countPirateInd += 1;
						role = &quot;pirate&quot;;
						var groupSize = 0;
						groupName = &quot;shipgroup-&quot; + this._groupCounter;
						this._groupCounter += 1;

						goods = &quot;&quot;; // pirates launching from station will have empty holds so they can scoop some
						home = system.ID;
						// occasionally make the home system the same as the dest system so not every ship in dock calls this system home
						if (random() &lt; 0.3) home = this.$nearbySystem(7);
						var dest = this.$getDestinationByRole(role, station);
						destSystem = dest.destination;
						destHidden = dest.destinationHidden;

						// same logic as orginal for calculating group size
						groupSize = Math.floor(random() * 3) + Math.floor(random() * 3) + 2;
						if (groupSize &gt; 8 - system.info.government) {
							// in the safer systems may have lost some ships already, though
							groupSize = 1 + Math.floor(random() * groupSize);
						}

						isLeader = true;

						escorts.length = 0;

						for (var j = 0; j &lt; groupSize; j++) {
							countPirateInd += 1;
							shpDataKey = this.$getRandomShipKeyWithDockCheck(role, station);
							shpName = this.$getRandomShipName(role);
							autoAI = shipDataRef[shpDataKey][&quot;auto_ai&quot;];
							shpType = shipDataRef[shpDataKey].name;

							bounty = 20 + system.info.government + groupSize + Math.floor(random() * 8);
							if (indexInList(shipDataRef[shpDataKey][&quot;hyperspace_motor&quot;], trueValues) &gt;= 0) {
								weapons = 1.75;
							} else {
								weapons = 1.3;
							}

							aiName = &quot;&quot;;
							if (typeof autoAI === &quot;undefined&quot; || indexInList(autoAI, trueValues) &gt;= 0) aiName = &quot;oolite-pirateAI.js&quot;;

							pilot = this.$createPilot(this.$nearbySystem(7), bounty, calcIns(bounty));

							this.$addShipToArray({
								station: station,
								stationIndex: stnIndex,
								role: role,
								shipType: shpType,
								shipDataKey: shpDataKey,
								shipName: shpName,
								aiName: aiName,
								accuracy: this.$setAccuracy(shpDataKey, 4 - system.info.government),
								equipment: this.$setWeapons(shpDataKey, 1.75),
								heatInsulation: this.$setHeatInsulation(shpDataKey, 0),
								homeSystem: home,
								bounty: bounty,
								escortName: &quot;&quot;,
								escortLeader: false,
								groupName: groupName,
								groupLeader: isLeader,
								destinationSystem: destSystem,
								destinationHidden: destHidden,
								goods: goods,
								pilot: pilot,
								dockTime: shipDockTime,
								departureTime: depart,
								departureSeconds: (isLeader ? 0 : 5),
								autoLog: logging
							});

							// only the first ship is the leader
							isLeader = false;
						}

						break;

					case 7: // light pirate group
						countPirateLight += 1;
						role = &quot;pirate-light-freighter&quot;;
						if (this.$roleExists(role) === false) role = &quot;pirate&quot;;

						groupName = &quot;shipgroup-&quot; + this._groupCounter;
						this._groupCounter += 1;

						var leader = this.$addPirateLeader(station, stnIndex, 0.83, role, groupName, shipDockTime, depart);
						// add the rest of the group
						this.$addPirateGroup(station, stnIndex, groupName, leader.homeSystem, leader.destination, leader.destinationHidden, 2, 1, -1, 0, shipDockTime, depart);

						home = leader.homeSystem;
						destSystem = leader.destination;
						destHidden = leader.destinationHidden;

						if (indexInList(leader.dataKey, this._switchEscortsToGroup) &gt;= 0) {
							groupData = this.$processPirateEscorts(stationkey, leader, groupName);
						} else {
							escorts = this.$processPirateEscorts(stationkey, leader, &quot;&quot;);
						}
						break;

					case 8: // medium pirate group
						countPirateMedium += 1;
						role = &quot;pirate-medium-freighter&quot;;
						if (this.$roleExists(role) === false) role = &quot;pirate&quot;;

						groupName = &quot;shipgroup-&quot; + this._groupCounter;
						this._groupCounter += 1;

						var leader = this.$addPirateLeader(station, stnIndex, 0.5, role, groupName, shipDockTime, depart);
						// add the rest of the group
						this.$addPirateGroup(station, stnIndex, groupName, leader.homeSystem, leader.destination, leader.destinationHidden, 3, 2, 0, 1, shipDockTime, depart);

						home = leader.homeSystem;
						destSystem = leader.destination;
						destHidden = leader.destinationHidden;

						if (indexInList(leader.dataKey, this._switchEscortsToGroup) &gt;= 0) {
							groupData = this.$processPirateEscorts(stationkey, leader, groupName);
						} else {
							escorts = this.$processPirateEscorts(stationkey, leader, &quot;&quot;);
						}
						break;

					case 9: // heavy pirate group
						countPirateHeavy += 1;
						role = &quot;pirate-medium-freighter&quot;;
						if (this.$roleExists(role) === false) role = &quot;pirate&quot;;

						groupName = &quot;shipgroup-&quot; + this._groupCounter;
						this._groupCounter += 1;

						var leader = this.$addPirateLeader(station, stnIndex, 0.5, role, groupName, shipDockTime, depart);
						// add the rest of the group
						this.$addPirateGroup(station, stnIndex, groupName, leader.homeSystem, leader.destination, leader.destinationHidden, 4, 4, 2, 2, shipDockTime, depart);

						home = leader.homeSystem;
						destSystem = leader.destination;
						destHidden = leader.destinationHidden;

						if (indexInList(leader.dataKey, this._switchEscortsToGroup) &gt;= 0) {
							groupData = this.$processPirateEscorts(stationkey, leader, groupName);
						} else {
							escorts = this.$processPirateEscorts(stationkey, leader, &quot;&quot;);
						}
						break;

					case 10: // light hunter group
						countHunterLight += 1;
						role = &quot;hunter&quot;;

						groupName = &quot;shipgroup-&quot; + this._groupCounter;
						this._groupCounter += 1;
						groupSize = Math.floor(random() * 2) + Math.floor(random() * 2) + 2;

						home = system.ID;
						var dest = this.$getDestinationByRole(role, station);
						destSystem = dest.destination;
						destHidden = dest.destinationHidden;

						weapons = 1.5;
						skill = -1;
						isLeader = true;

						for (var j = 0; j &lt; groupSize; j++) {
							shpDataKey = this.$getRandomShipKeyWithDockCheck(role, station);
							shpName = this.$getRandomShipName(role);
							autoAI = shipDataRef[shpDataKey][&quot;auto_ai&quot;];
							shpType = shipDataRef[shpDataKey].name;

							aiName = &quot;&quot;;
							// this should normally be set by the role, but just in case...
							if (typeof autoAI === &quot;undefined&quot; || indexInList(autoAI, trueValues) &gt;= 0) aiName = &quot;oolite-bountyHunterAI.js&quot;;

							pilot = this.$createPilot(home, 0, calcIns(0));

							this.$addShipToArray({
								station: station,
								stationIndex: stnIndex,
								role: role,
								shipType: shpType,
								shipDataKey: shpDataKey,
								shipName: shpName,
								aiName: aiName,
								accuracy: this.$setAccuracy(shpDataKey, 0),
								equipment: this.$setWeapons(shpDataKey, weapons),
								heatInsulation: this.$setHeatInsulation(shpDataKey, 0),
								homeSystem: home,
								bounty: 0,
								escortName: &quot;&quot;,
								escortLeader: false,
								groupName: groupName,
								groupLeader: isLeader,
								destinationSystem: destSystem,
								destinationHidden: destHidden,
								goods: &quot;&quot;,
								pilot: pilot,
								dockTime: shipDockTime,
								departureTime: depart,
								departureSeconds: (isLeader ? 0 : 5),
								autoLog: logging
							});

							// only the first ship is the leader
							isLeader = false;
						}

						break;

					case 11: // medium hunter group
						countHunterMedium += 1;
						role = &quot;hunter-medium&quot;;

						if (this.$roleExists(role) === false) role = &quot;hunter&quot;;

						home = system.ID;
						var dest = this.$getDestinationByRole(role, station);
						destSystem = dest.destination;
						destHidden = dest.destinationHidden;

						groupName = &quot;shipgroup-&quot; + this._groupCounter;
						this._groupCounter += 1;

						this.$addHunterLeader(station, stnIndex, role, groupName, destSystem, destHidden, shipDockTime, depart);
						this.$addHunterGroup(station, stnIndex, groupName, destSystem, destHidden, shipDockTime, depart);

						break;

					case 12: // heavy hunter group
						countHunterHeavy += 1;
						role = &quot;hunter-heavy&quot;;

						if (this.$roleExists(role) === false) role = &quot;hunter&quot;;

						home = system.ID;
						var dest = this.$getDestinationByRole(role, station);
						destSystem = dest.destination;
						destHidden = dest.destinationHidden;

						groupName = &quot;shipgroup-&quot; + this._groupCounter;
						this._groupCounter += 1;

						this.$addHunterLeader(station, stnIndex, role, groupName, destSystem, destHidden, shipDockTime, depart);
						this.$addHunterGroup(station, stnIndex, groupName, destSystem, destHidden, shipDockTime, depart);

						break;

				} // switch

				// add any escorts that were defined
				if ((escorts &amp;&amp; escorts.length &gt; 0) || (groupData &amp;&amp; groupData.length &gt; 0)) {
					var dta = escorts;
					if (groupData) dta = groupData;
					for (var j = 0; j &lt; dta.length; j++) {
						var esc_role = dta[j].role;
						var esc_key = dta[j].shipKey;
						var esc_bounty = 0;
						var esc_name = this.$getRandomShipName(esc_role);
						// make sure the key is in the dictionary
						if (!shipDataRef[esc_key]) {
							log(this.name, &quot;!NOTE: Escort ship key not in core dictionary - &quot; + esc_role + &quot;/&quot; + esc_key);
							shipDataRef[esc_key] = Ship.shipDataForKey(esc_key);
						}
						var esc_autoAI = shipDataRef[esc_key][&quot;auto_ai&quot;];
						if (shipDataRef[esc_key]) {
							var esc_type = shipDataRef[esc_key].name;
							if (bounty !== 0) esc_bounty = 3 + Math.floor(random() * 12);
							var esc_pilot = this.$createPilot(this.$nearbySystem(7), esc_bounty, calcIns(esc_bounty));
							aiName = &quot;&quot;;
							if (typeof esc_autoAI === &quot;undefined&quot; || indexInList(esc_autoAI, trueValues) &gt;= 0) aiName = &quot;oolite-escortAI.js&quot;;

							if (indexInList(shipDataRef[esc_key][&quot;auto_weapons&quot;], trueValues) &gt;= 0) {
								if (esc_role === &quot;escort&quot; || esc_role === &quot;pirate-light-fighter&quot;) {
									weapons = 1.3; // usually lightly armed as escorts
								} else if (esc_role === &quot;escort-medium&quot; || esc_role === &quot;pirate-medium-fighter&quot;) {
									weapons = 1.8; // usually heavily armed as escorts
								} else if (esc_role === &quot;escort-heavy&quot; || esc_role === &quot;pirate-heavy-fighter&quot;) {
									weapons = 2.05; // rarely have an aft laser
								}
							}
							// note: add 0.5 seconds to the escort members so they will always come after the leader in any sorted list
							this.$addShipToArray({
								station: station,
								stationIndex: stnIndex,
								role: esc_role,
								shipType: esc_type,
								shipDataKey: esc_key,
								shipName: esc_name,
								aiName: aiName,
								accuracy: this.$setAccuracy(esc_key, skill),
								equipment: this.$setWeapons(esc_key, weapons),
								heatInsulation: this.$setHeatInsulation(esc_key, heat),
								homeSystem: home,
								bounty: esc_bounty,
								escortName: (dta === escorts ? escortGroupName : &quot;&quot;),
								escortLeader: false,
								groupName: (dta === groupData ? groupName : &quot;&quot;),
								groupLeader: false,
								destinationSystem: destSystem,
								destinationHidden: destHidden,
								goods: &quot;&quot;,
								pilot: esc_pilot,
								dockTime: shipDockTime,
								departureTime: depart,
								departureSeconds: 5,
								autoLog: logging
							});

						} else {
							log(this.name, &quot;!!NOTE: No ship data returned for ship data key &quot; + dta[j].shipKey);
						}
					} // for j
				} // if escorts/groupdata
			} // while i--
			/*if (this._debug &amp;&amp; this._logPopulatorType &gt; 0) {
				log(this.name, &quot;Actual ships created: &quot; + actualCount + &quot;, difference of &quot; + (ships - actualCount));
				log(this.name, &quot;Traders added:        &quot; + countTraderFreighter);
				log(this.name, &quot;Couriers added:       &quot; + countTraderCourier);
				log(this.name, &quot;Smugglers added:      &quot; + countTraderSmuggler);
				log(this.name, &quot;Assassins added:      &quot; + countAssassin);
				log(this.name, &quot;Shuttles added:       &quot; + countShuttle);
				log(this.name, &quot;Pirate Ind added:     &quot; + countPirateInd);
				log(this.name, &quot;Pirate Light groups:  &quot; + countPirateLight);
				log(this.name, &quot;Pirate Medium groups: &quot; + countPirateMedium);
				log(this.name, &quot;Pirate Heavy groups:  &quot; + countPirateHeavy);
				log(this.name, &quot;Hunter Light groups:  &quot; + countHunterLight);
				log(this.name, &quot;Hunter Medium groups: &quot; + countHunterMedium);
				log(this.name, &quot;Hunter Heavy groups:  &quot; + countHunterHeavy);
			}*/
			this._departureBands.length = 0;
		} // if ships

		// set up process for adding docking bay codes
		this.$addBayCodes(station);

		// remove this station from the array
		this._populateStation.splice(0, 1);
		// check if the array is empty - if so, turn off the auto generation flag
		if (this._populateStation.length === 0) {
			this._autoGenerationInProgress = false;
		}

		this._running = false;
		if (this._debug &amp;&amp; this._logPopulatorType &gt; 0)
			log(this.name, &quot;Populator run complete in ms: &quot; + (new Date().getTime() - startDate.getTime()));
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns a pilot object
	this.$createPilot = function $createPilot(home, legal, insurance) {

		var pilot = {};

		// create the pilot
		pilot[&quot;name&quot;] = expandDescription(&quot;%N [nom]&quot;);
		pilot[&quot;description&quot;] = &quot;a &quot; + System.infoForSystem(galaxyNumber, home).inhabitant.toLowerCase() + &quot; from &quot; + System.systemNameForID(home); // check
		pilot[&quot;homeSystem&quot;] = home;
		pilot[&quot;legalStatus&quot;] = legal;
		pilot[&quot;insurance&quot;] = (!insurance == null ? insurance : 0);
		pilot[&quot;species&quot;] = System.infoForSystem(galaxyNumber, home).inhabitant.toLowerCase();

		return pilot;
	}

	//-------------------------------------------------------------------------------------------------------------
	// adds a ship to the stations docked list
	// used by the populator function
	this.$addShipToArray = function $addShipToArray(dockObj) {

		// work out any defaults
		var stnIndex = (dockObj.hasOwnProperty(&quot;stationIndex&quot;) ? dockObj.stationIndex : this.$getStationIndex(dockObj.station));
		var bay = ((this._autoGenerationInProgress === true) ? &quot;&quot; : this.$getDockingBayCode(dockObj.station, stnIndex));
		var hide = (dockObj.hasOwnProperty(&quot;destinationHidden&quot;) &amp;&amp; dockObj.destinationHidden === true ? true : false);
		var pers = (dockObj.hasOwnProperty(&quot;personality&quot;) ? dockObj.personality : (this.$rand(32768) - 1));
		var fuel = (dockObj.hasOwnProperty(&quot;fuel&quot;) ? dockObj.fuel : 7);
		var lastChange = (dockObj.hasOwnProperty(&quot;lastChange&quot;) ? dockObj.lastChange : clock.adjustedSeconds);
		var cargo = (dockObj.hasOwnProperty(&quot;cargo&quot;) ? dockObj.cargo : &quot;&quot;);
		var tradeComplete = (dockObj.hasOwnProperty(&quot;tradeComplete&quot;) ? dockObj.tradeComplete : 0);
		var dest = (dockObj.hasOwnProperty(&quot;destination&quot;) &amp;&amp; dockObj.destination !== &quot;&quot; ? dockObj.destination : &quot;&quot;);

		if (this._systemDockingData[system.ID] == null) {
			this._systemDockingData[system.ID] = {};
		}
		if (this._systemDockingData[system.ID][dockObj.station.name + &quot;_&quot; + stnIndex] == null) {
			this._systemDockingData[system.ID][dockObj.station.name + &quot;_&quot; + stnIndex] = [];
		}
		this._systemDockingData[system.ID][dockObj.station.name + &quot;_&quot; + stnIndex].push({
			system: system.ID,
			station: dockObj.station.name,
			stationIndex: stnIndex,
			shipName: dockObj.shipName,
			shipType: dockObj.shipType,
			shipDataKey: dockObj.shipDataKey,
			personality: pers,
			primaryRole: dockObj.role,
			shipAI: dockObj.aiName,
			accuracy: dockObj.accuracy,
			equipment: dockObj.equipment,
			heatInsulation: dockObj.heatInsulation,
			fuel: fuel,
			homeSystem: dockObj.homeSystem,
			bounty: dockObj.bounty,
			escortName: dockObj.escortName,
			escortLeader: dockObj.escortLeader,
			groupName: dockObj.groupName,
			groupLeader: dockObj.groupLeader,
			destinationSystem: dockObj.destinationSystem,
			destination: dest,
			destinationHidden: hide,
			goods: dockObj.goods,
			cargo: cargo,
			tradeComplete: tradeComplete,
			pilotDescription: dockObj.pilot.description,
			pilotName: dockObj.pilot.name,
			pilotHomeSystem: dockObj.pilot.homeSystem,
			pilotLegalStatus: dockObj.pilot.legalStatus,
			pilotInsurance: dockObj.pilot.insurance,
			pilotSpecies: dockObj.pilot.species,
			isPlayer: false,
			dockTime: dockObj.dockTime,
			dockingBay: bay,
			departureTime: dockObj.departureTime,
			departureSeconds: dockObj.departureSeconds,
			lastChange: lastChange,
			launchCallback: (dockObj.hasOwnProperty(&quot;launchCallback&quot;) &amp;&amp; dockObj.launchCallback !== &quot;&quot; ? dockObj.launchCallback : null),
			worldScript: (dockObj.hasOwnProperty(&quot;worldScript&quot;) &amp;&amp; dockObj.worldScript !== &quot;&quot; ? dockObj.worldScript : null),
			additionalProperties: (dockObj.hasOwnProperty(&quot;properties&quot;) &amp;&amp; dockObj.properties !== &quot;&quot; ? dockObj.properties : &quot;&quot;)
		});

		if (dockObj.autoLog === 2) {
			this.$writeDataToLog(this._systemDockingData[system.ID][dockObj.station.name + &quot;_&quot; + stnIndex][this._systemDockingData[system.ID][dockObj.station.name + &quot;_&quot; + stnIndex].length - 1], &quot;Docking ship at station &quot; + dockObj.station.name + &quot;(&quot; + stnIndex + &quot;)&quot;);
		} else if (dockObj.autoLog === 1) {
			this.$writeShortDataToLog(this._systemDockingData[system.ID][dockObj.station.name + &quot;_&quot; + stnIndex][this._systemDockingData[system.ID][dockObj.station.name + &quot;_&quot; + stnIndex].length - 1]);
		}

	}

	//-------------------------------------------------------------------------------------------------------------
	// adds a pirate leader and returns the ship data key
	this.$addPirateLeader = function $addPirateLeader(station, stnIndex, localFactor, role, groupName, dockTime, depart) {

		var bounty = 60 + system.government + Math.floor(Math.random() * 8);
		var home = system.ID;
		var destSystem;
		var destHidden = true;
		var aiName = &quot;&quot;;
		var trueValues = this._trueValues;

		// occasionally make the home system the same as the dest system so not every ship in dock calls this system home
		if (Math.random() &lt; 0.3) home = this.$nearbySystem(7);
		if (Math.random() &lt; localFactor) {
			destSystem = system.ID;
		} else {
			var dest = this.$getDestinationByRole(role, station);
			destSystem = dest.destination;
			destHidden = dest.destinationHidden;
		}

		var shpDataKey = this.$getRandomShipKeyWithDockCheck(role, station);
		var shpName = this.$getRandomShipName(role);
		var autoAI = this._shipData[shpDataKey][&quot;auto_ai&quot;];
		var shpType = this._shipData[shpDataKey].name;

		if (typeof autoAI === &quot;undefined&quot; || this.$indexInList(autoAI, trueValues) &gt;= 0) aiName = &quot;oolite-pirateFreighterAI.js&quot;;

		var pilot = this.$createPilot(this.$nearbySystem(7), bounty, this.$calcInsurance(bounty));

		var equip = this.$setWeapons(shpDataKey, 2.8);
		if (this.$indexInList(this._shipData[shpDataKey][&quot;auto_weapons&quot;], trueValues) &gt;= 0) {
			equip += &quot;EQ_SHIELD_BOOSTER,&quot;;
			equip += &quot;EQ_ECM,&quot;;
		}

		// add the leader
		this.$addShipToArray({
			station: station,
			stationIndex: stnIndex,
			role: role,
			shipType: shpType,
			shipDataKey: shpDataKey,
			shipName: shpName,
			aiName: aiName,
			accuracy: this.$setAccuracy(shpDataKey, 3),
			equipment: equip,
			heatInsualtion: this.$setHeatInsulation(shpDataKey, 0),
			homeSystem: home,
			bounty: bounty,
			escortName: &quot;&quot;,
			escortLeader: false,
			groupName: groupName,
			groupLeader: true,
			destinationSystem: destSystem,
			destinationHidden: destHidden,
			goods: &quot;&quot;,
			pilot: pilot,
			dockTime: dockTime,
			dockingBay: &quot;&quot;,
			departureTime: depart,
			departureSeconds: 0,
			autoLog: (this._debug &amp;&amp; this._logPopulatorType &gt;= 2 ? 1 : 0)
		});

		return {
			dataKey: shpDataKey,
			name: shpName,
			type: shpType,
			homeSystem: home,
			destination: destSystem,
			destinationHidden: destHidden
		};
	}

	//-------------------------------------------------------------------------------------------------------------
	// adds members of a pirate group
	this.$addPirateGroup = function $addPirateGroup(station, stnIndex, groupName, home, dest, destHidden, lf, mf, hf, thug, dockTime, depart) {

		for (var i = Math.floor(lf + (0.5 + Math.random() - Math.random())); i &gt; 0; i--) {
			this.$addPirateAssistant(&quot;pirate-light-fighter&quot;, station, stnIndex, groupName, home, dest, destHidden, dockTime, depart);
		}
		for (var i = Math.floor(mf + (0.5 + Math.random() - Math.random())); i &gt; 0; i--) {
			this.$addPirateAssistant(&quot;pirate-medium-fighter&quot;, station, stnIndex, groupName, home, dest, destHidden, dockTime, depart);
		}
		for (var i = Math.floor(hf + (0.5 + Math.random() - Math.random())); i &gt; 0; i--) {
			this.$addPirateAssistant(&quot;pirate-heavy-fighter&quot;, station, stnIndex, groupName, home, dest, destHidden, dockTime, depart);
		}
		for (var i = Math.floor(thug + (0.5 + Math.random() - Math.random())); i &gt; 0; i--) {
			this.$addPirateAssistant(&quot;pirate-interceptor&quot;, station, stnIndex, groupName, home, dest, destHidden, dockTime, depart);
		}

	}

	//-------------------------------------------------------------------------------------------------------------
	// adds the individual member of a pirate group
	this.$addPirateAssistant = function $addPirateAssistant(role, station, stnIndex, groupName, home, dest, destHidden, dockTime, depart) {

		if (this.$roleExists(role) === false) role = &quot;pirate&quot;;

		var shpDataKey = this.$getRandomShipKey(role);
		var shpName = this.$getRandomShipName(role);
		var shpType = this._shipData[shpDataKey].name;
		var trueValues = this._trueValues;

		var bounty = 0;
		var equip = &quot;&quot;;
		var aiName = &quot;&quot;;
		var autoAI = this._shipData[shpDataKey][&quot;auto_ai&quot;];
		var autoWeapons = this._shipData[shpDataKey][&quot;auto_weapons&quot;];
		var hasAutoAI = (this.$indexInList(autoAI, trueValues) &gt;= 0);

		if (typeof autoAI === &quot;undefined&quot; || hasAutoAI === true) aiName = &quot;oolite-pirateFighterAI.js&quot;;

		if (role === &quot;pirate-interceptor&quot;) {
			if (typeof autoAI === &quot;undefined&quot; || hasAutoAI === true) aiName = &quot;oolite-pirateInterceptorAI.js&quot;;

			equip += this.$setWeapons(shpDataKey, 2.3);
			if (this.$indexInList(autoWeapons, trueValues) &gt;= 0) equip += &quot;EQ_FUEL_INJECTION,&quot;;

			bounty = 50 + system.government + Math.floor(Math.random() * 36);
		} else {
			bounty = 20 + system.government + Math.floor(Math.random() * 12);
			if (role === &quot;pirate-light-fighter&quot;) {
				equip += this.$setWeapons(shpDataKey, 1.2); // basic fighters
			} else if (role === &quot;pirate-medium-fighter&quot;) {
				equip += this.$setWeapons(shpDataKey, 1.8); // often beam weapons
			} else if (role === &quot;pirate-heavy-fighter&quot;) {
				equip += this.$setWeapons(shpDataKey, 2.05); // very rarely aft lasers
			}
		}

		var pilot = this.$createPilot(this.$nearbySystem(7), bounty, this.$calcInsurance(bounty));

		this.$addShipToArray({
			station: station,
			stationIndex: stnIndex,
			role: role,
			shipType: shpType,
			shipDataKey: shpDataKey,
			shipName: shpName,
			aiName: aiName,
			accuracy: this.$setAccuracy(shpDataKey, 0),
			equipment: equip,
			heatInsulation: this.$setHeatInsulation(shpDataKey, 0),
			homeSystem: home,
			bounty: bounty,
			escortName: &quot;&quot;,
			escortLeader: false,
			groupName: groupName,
			groupLeader: false,
			destinationSystem: dest,
			destinationHidden: destHidden,
			goods: &quot;&quot;,
			pilot: pilot,
			dockTime: dockTime,
			dockingBay: &quot;&quot;,
			departureTime: depart,
			departureSeconds: 5,
			autoLog: (this._debug &amp;&amp; this._logPopulatorType &gt;= 2 ? 1 : 0)
		});
	}

	//-------------------------------------------------------------------------------------------------------------
	// process pirate escort data for a given leader object
	this.$processPirateEscorts = function $processPirateEscorts(stationkey, leader, groupName) {

		if (typeof leader === &quot;undefined&quot; || typeof groupName === &quot;undefined&quot;) return null;

		var escorts = this.$getEscortData(leader.dataKey);
		if (escorts &amp;&amp; escorts.length &gt; 0) {
			if (groupName === &quot;&quot;) {
				this._escortCounter += 1;
				var escortGroupName = &quot;escortgroup-&quot; + this._escortCounter;
			} else {
				this._groupCounter += 1;
			}
			// find leader in data and update escort info
			// should be last entry, so start from the end
			var dta = this._systemDockingData[system.ID][stationkey];
			if (dta &amp;&amp; dta.length &gt; 0) {
				var i = dta.length;
				while (i--) {
					var item = dta[i];
					if (item.shipDataKey === leader.dataKey &amp;&amp; item.shipType === leader.type &amp;&amp; item.shipName === leader.name) {
						if (groupName === &quot;&quot;) {
							item.escortName = escortGroupName;
							item.escortLeader = true;
						} else {
							item.groupName = groupName;
							item.groupLeader = true;
						}
						break;
					}
				}
			}
		}
		return escorts;
	}

	//-------------------------------------------------------------------------------------------------------------
	// process escort info for a given ship data key
	this.$processTraderEscorts = function $processTraderEscorts(shipDataKey) {

		var escorts = this.$getEscortData(shipDataKey);
		var isLeader = false;
		var escortName = &quot;&quot;;

		if (escorts &amp;&amp; escorts.length &gt; 0) {
			this._escortCounter += 1;
			escortName = &quot;escortgroup-&quot; + this._escortCounter;
			isLeader = true;
		}

		return {
			escortData: escorts,
			leader: isLeader,
			name: escortName
		};
	}

	//-------------------------------------------------------------------------------------------------------------
	// adds a hunter leader
	this.$addHunterLeader = function $addHunterLeader(station, stnIndex, role, groupName, destSystem, destHidden, dockTime, depart) {

		var shpDataKey = this.$getRandomShipKeyWithDockCheck(role, station);
		var shpName = this.$getRandomShipName(role);
		var autoAI = this._shipData[shpDataKey][&quot;auto_ai&quot;];
		var shpType = this._shipData[shpDataKey].name;

		var equip = &quot;&quot;;
		if (role === &quot;hunter-heavy&quot;) {
			// occasionally give heavy hunters aft lasers
			equip += this.$setWeapons(shpDataKey, 2.2);
		} else {
			// usually ensure medium hunters have beam lasers
			equip += this.$setWeapons(shpDataKey, 1.9);
		}
		var skill = 3; // likely to be good pilot

		var aiName = &quot;&quot;;
		// auto AI will normally get this already but not if the hunter
		// addition used fallback roles
		if (typeof autoAI === &quot;undefined&quot; || this.$indexInList(autoAI, this._trueValues) &gt;= 0) aiName = &quot;oolite-bountyHunterLeaderAI.js&quot;;

		var pilot = this.$createPilot(system.ID, 0, this.$calcInsurance(0));

		this.$addShipToArray({
			station: station,
			stationIndex: stnIndex,
			role: role,
			shipType: shpType,
			shipDataKey: shpDataKey,
			shipName: shpName,
			aiName: aiName,
			accuracy: this.$setAccuracy(shpDataKey, skill),
			equipment: equip,
			heatInsulation: this.$setHeatInsulation(shpDataKey, 1),
			homeSystem: system.ID,
			bounty: 0,
			escortName: &quot;&quot;,
			escortLeader: false,
			groupName: groupName,
			groupLeader: true,
			destinationSystem: destSystem,
			destinationHidden: destHidden,
			goods: &quot;&quot;,
			pilot: pilot,
			dockTime: dockTime,
			dockingBay: &quot;&quot;,
			departureTime: depart,
			departureSeconds: 0,
			autoLog: (this._debug &amp;&amp; this._logPopulatorType &gt;= 2 ? 1 : 0)
		});
	}

	//-------------------------------------------------------------------------------------------------------------
	// adds the members of a hunter group
	this.$addHunterGroup = function $addHunterGroup(station, stnIndex, groupName, destSystem, destHidden, dockTime, depart) {

		var role = &quot;hunter&quot;;

		var groupSize = 1 + Math.floor(Math.random() * 4) + Math.floor(Math.random() * 4);

		for (var i = 0; i &lt; groupSize; i++) {
			var shpDataKey = this.$getRandomShipKey(role);
			var shpName = this.$getRandomShipName(role);
			var autoAI = this._shipData[shpDataKey][&quot;auto_ai&quot;];
			var shpType = this._shipData[shpDataKey].name;

			var equip = this.$setWeapons(shpDataKey, 1.5);
			var pilot = this.$createPilot(this.$nearbySystem(7), 0, this.$calcInsurance(0));
			var aiName = &quot;&quot;;
			// this should normally be set by the role, but just in case...
			if (typeof autoAI === &quot;undefined&quot; || this.$indexInList(autoAI, this._trueValues) &gt;= 0) aiName = &quot;oolite-bountyHunterAI.js&quot;;

			this.$addShipToArray({
				station: station,
				stationIndex: stnIndex,
				role: role,
				shipType: shpType,
				shipDataKey: shpDataKey,
				shipName: shpName,
				aiName: aiName,
				accuracy: this.$setAccuracy(shpDataKey, 0),
				equipment: equip,
				heatInsulation: this.$setHeatInsulation(shpDataKey, 1),
				homeSystem: system.ID,
				bounty: 0,
				escortName: &quot;&quot;,
				escortLeader: false,
				groupName: groupName,
				groupLeader: false,
				destinationSystem: destSystem,
				destinationHidden: destHidden,
				goods: &quot;&quot;,
				pilot: pilot,
				dockTime: dockTime,
				dockingBay: &quot;&quot;,
				departureTime: depart,
				departureSeconds: 5,
				autoLog: (this._debug &amp;&amp; this._logPopulatorType &gt;= 2 ? 1 : 0)
			});
		}

	}

	//=============================================================================================================
	// helper functions

	//-------------------------------------------------------------------------------------------------------------
	// return a random number between 1 and max
	this.$rand_old = function $rand_old(max) {
		return Math.floor((Math.random() * max) + 1);
	}
	// contributed by Day
	this.$rand = function $rand(max) {
		var that = $rand;
		var floor = (that.floor = that.floor || Math.floor);
		var random = (that.random = that.random || Math.random);
		return floor((random() * max) + 1);
	}

	//-------------------------------------------------------------------------------------------------------------
	// gets a subset of vessels for viewing
	this.$getViewingList = function $getViewingList(station, mfd) {

		var stationList = [];
		var idx = this.$getStationIndex(station);

		if (station != null &amp;&amp; idx &gt; 0) {
			// add entries from the main data repository
			var dta = this._systemDockingData[system.ID][station.name + &quot;_&quot; + idx];
			if (dta &amp;&amp; dta.length &gt; 0) {
				for (var i = 0; i &lt; dta.length; i++) {
					var item = dta[i];
					if (item.departureTime &gt; 0) {
						stationList.push(item);
					}
				}
			}
			// add any ships on the launching queue to the list
			if (this._launching.length &gt; 0) {
				for (var i = 0; i &lt; this._launching.length; i++) {
					var item = this._launching[i];
					if (item.system === system.ID &amp;&amp; item.station === station.name &amp;&amp; item.stationIndex === idx) {
						stationList.push(item);
					}
				}
			}
			// add any docking ships to the list, if this isn&#39;t an MFD call
			if (mfd === false) this.$addShipsDockingToList(station, stationList);
		}

		return stationList;
	}

	//-------------------------------------------------------------------------------------------------------------
	this.$addShipsDockingToList = function $addShipsDockingToList(station, viewlist) {
		var shipname = &quot;&quot;;

		if (this._docking &amp;&amp; this._docking.length &gt; 0) {
			for (var i = 0; i &lt; this._docking.length; i++) {
				var shp = this._docking[i];
				if (shp.isValid) {
					shipname = shp.shipUniqueName;
					// occasionally the shipUniqueName returns &quot;&quot; even though it&#39;s really there. In that instance, pull the unique name out of the display name
					if (shipname === &quot;&quot;) shipname = this.$getShipUniqueName(shp.displayName, shp.shipClassName);

					var escortlead = (shp.escortGroup &amp;&amp; shp.escortGroup.leader === shp ? true : false);
					var grouplead = (shp.group &amp;&amp; shp.group.leader === shp ? true : false);
					// add just enough info to the list, rather than all the details
					viewlist.push({
						system: system.ID,
						station: station.name,
						shipName: shipname,
						shipType: shp.shipClassName,
						shipDataKey: shp.dataKey,
						personality: shp.entityPersonality,
						primaryRole: shp.primaryRole,
						bounty: shp.bounty,
						destinationSystem: -1,
						escortName: ((shp.escortGroup) ? shp.escortGroup.name : &quot;&quot;),
						escortLeader: (escortlead ? true : false),
						groupName: ((shp.group) ? shp.group.name : &quot;&quot;),
						groupLeader: (grouplead ? true : false),
						pilotDescription: (shp.crew ? shp.crew[0].description : &quot;&quot;),
						pilotName: (shp.crew ? shp.crew[0].name : &quot;&quot;),
						pilotHomeSystem: (shp.crew ? shp.crew[0].homeSystem : -1),
						pilotLegalStatus: (shp.crew ? shp.crew[0].legalStatus : 0),
						pilotSpecies: (shp.crew ? shp.crew[0].species : &quot;&quot;),
						isPlayer: false,
						dockTime: -1,
						departureTime: -10,
						departureSeconds: (escortlead || grouplead ? 5 : 0)
					});
				}
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns the number of docked ships at a given station
	this.$countStationItems = function $countStationItems(station) {
		var items = 0;
		var idx = this.$getStationIndex(station);
		if (this._systemDockingData[system.ID] != null) {
			var dta = this._systemDockingData[system.ID][station.name + &quot;_&quot; + idx];
			if (dta &amp;&amp; dta.length &gt; 0) {
				for (var i = 0; i &lt; dta.length; i++) {
					if (dta[i].departureTime &gt; -5) items += 1;
				}
			}
		}
		return items;
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns the number of docked ships in the system
	this.$countSystemItems = function $countSystemItems() {
		var items = 0;
		if (!this._systemDockingData[system.ID]) return 0;
		var skeys = Object.keys(this._systemDockingData[system.ID]);
		for (var kc = 0; kc &lt; skeys.length; kc++) {
			var dta = this._systemDockingData[system.ID][skeys[kc]];
			if (dta &amp;&amp; dta.length &gt; 0) items += dta.length;
		}
		return items;
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns data for a particular group
	this.$getShipGroupInfo = function $getShipGroupInfo(stationkey, groupName) {
		var groupData = null;

		var dta = this._systemDockingData[system.ID][stationkey];
		if (dta &amp;&amp; dta.length &gt; 0) {
			for (var i = 0; i &lt; dta.length; i++) {
				var item = dta[i];
				if (item.groupName === groupName &amp;&amp; item.groupLeader === true) {
					// if we find the leader of the group, return their departure time immediately
					return {
						depart: item.departureTime,
						departSecs: item.departureSeconds,
						destination: item.destinationSystem,
						destinationHidden: item.destinationHidden
					};
				}
				if (item.groupName === groupName &amp;&amp; item.groupLeader === false) {
					// if we just find a group member, hold the departure value, in case the leader is stored later in the array
					groupData = {
						depart: item.departureTime,
						departSecs: item.departureSeconds,
						destination: item.destinationSystem,
						destinationHidden: item.destinationHidden
					};
				}
			}
		}
		return groupData;
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns data for a particular escort group
	this.$getShipEscortInfo = function $getShipEscortInfo(stationkey, escortName) {
		var escortData = null;

		var dta = this._systemDockingData[system.ID][stationkey];
		if (dta &amp;&amp; dta.length &gt; 0) {
			for (var i = 0; i &lt; dta.length; i++) {
				var item = dta[i];
				if (item.escortName === escortName &amp;&amp; item.escortLeader === true) {
					// if we find the leader of the group, return their departure time immediately
					return {
						depart: item.departureTime,
						departSecs: item.departureSeconds,
						destination: item.destinationSystem,
						destinationHidden: item.destinationHidden
					};
				}
				if (item.system === system.ID &amp;&amp; item.escortName === escortName &amp;&amp; item.escortLeader === false) {
					// if we just find a group member, hold the departure value, in case the leader is stored later in the array
					escortData = {
						depart: item.departureTime,
						departSecs: item.departureSeconds,
						destination: item.destinationSystem,
						destinationHidden: item.destinationHidden
					};
				}
			}
		}
		return escortData;
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns true if the leader of a particular group is docked, otherwise false
	this.$isGroupLeaderDocked = function $isGroupLeaderDocked(stationkey, groupName) {
		var dta = this._systemDockingData[system.ID][stationkey];
		if (dta &amp;&amp; dta.length &gt; 0) {
			for (var i = 0; i &lt; dta.length; i++) {
				var item = dta[i];
				if ((item.groupName === groupName &amp;&amp; item.groupLeader === true) ||
					(item.escortName === groupName &amp;&amp; item.escortLeader === true)) {
					return true;
				}
			}
		}
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------
	// updates the leader of an escort with an escort group name
	// we need to do this because, when the leader docks, we may not know whether their group is for an escort or a normal group
	// when a ship with an escort role docks and links up to the leader, we need to update the leader record
	this.$setGroupEscortLeader = function $setGroupEscortLeader(stationkey, escortName) {
		var dta = this._systemDockingData[system.ID][stationkey];
		if (dta &amp;&amp; dta.length &gt; 0) {
			for (var i = 0; i &lt; dta.length; i++) {
				var item = dta[i];
				if (item.groupName === escortName &amp;&amp; item.escortLeader === true) {
					if (this._debug &amp;&amp; this._logDockingType &gt; 0) log(this.name, &quot;Updating escort name of group leader &quot; + item.shipType + (item.shipName !== &quot;&quot; ? &quot;: &quot; + item.shipName : &quot;&quot;));
					item.escortName = escortName;
					item.groupName = &quot;&quot;;
					item.groupLeader = false;
					break;
				}
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// clears any ships that would have launched after player exits witchspace, regardless of system
	// note: not called any longer, as a shorter method is in place
	this.$clearLaunchedShips = function $clearLaunchedShips() {

		// clear the launching list
		this._launching.length = 0;

		var remove = false;

		// compile short list of neighbouring systems
		var neighbour_list = [];
		for (var i = 0; i &lt; this._neighbours.length; i++) {
			neighbour_list.push(this._neighbours[i].systemID);
		}

		var syslist = Object.keys(this._systemDockingData);
		for (var sl = 0; sl &lt; syslist.length; sl++) {
			var skeys = Object.keys(this._systemDockingData[syslist[sl]]);
			for (var kc = 0; kc &lt; skeys.length; kc++) {
				var dta = this._systemDockingData[syslist[sl]][skeys[kc]];
				if (dta &amp;&amp; dta.length &gt; 0) {
					for (var i = dta.length - 1; i &gt;= 0; i--) {
						var item = dta[i];
						remove = false;
						// remove all ships that are outside the list of neighbours
						if (this.$indexInList(syslist[sl], neighbour_list) === -1) remove = true;
						// remove all ships that would have launched, regardless of system
						if (remove === false &amp;&amp; (item.departureTime * 60 + item.lastChange) &lt;= clock.adjustedSeconds) remove = true;

						if (remove) dta.splice(i, 1);
					}
				}
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// moves items from the main dataset into the launching array so the repopulator doesn&#39;t have to work so hard
	this.$updateLaunchingList = function $updateLaunchingList() {

		// don&#39;t do the check if we&#39;re about to do a repopulate routine, or we&#39;re in the middle of one
		if (this._repopulate || this._autoGenerationInProgress) return;

		this._launchListUpdating = true;

		if (this._systemDockingData[system.ID]) {
			var skeys = Object.keys(this._systemDockingData[system.ID]);
			for (var kc = 0; kc &lt; skeys.length; kc++) {
				var dta = this._systemDockingData[system.ID][skeys[kc]];
				if (dta &amp;&amp; dta.length &gt; 0) {
					for (var i = dta.length - 1; i &gt;= 0; i--) {
						var item = dta[i];
						var lt = (item.departureTime * 60) + item.lastChange;
						if (lt &lt;= clock.adjustedSeconds) {
							// move it do the launching array (if it&#39;s within 4 minutes of the adjusted seconds, regardless of the state of the dock
							if ((clock.adjustedSeconds - lt) / 60 &lt;= 4) {
								if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, item.station + &quot; adding launching item &quot; + i + &quot; - &quot; + item.shipType + (item.shipName !== &quot;&quot; ? &quot;: &quot; + item.shipName : &quot;&quot;));
								this._launching.push(item);
							} else {
								if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, item.station + &quot; removing expired item &quot; + i + &quot; - &quot; + item.shipType + (item.shipName !== &quot;&quot; ? &quot;: &quot; + item.shipName : &quot;&quot;));
							}
							// remove it from the main array
							dta.splice(i, 1);
						} else {
							item.departureTime -= 1;
							if (item.departureTime &lt; 0) item.departureTime = 0;
							item.lastChange = clock.adjustedSeconds;
						}
					}
				}
			}
		}
		this._launchListUpdating = false;

	}

	//-------------------------------------------------------------------------------------------------------------
	// this is used when the player launches from a station to launch any ships that would have been in the queue ahead of them
	this.$dockingQueueShipClearance = function $dockingQueueShipClearance(station, timeLapse) {
		function compare(a, b) {
			return (a.departureTime * 10 + a.departureSeconds) - (b.departureTime * 10 + b.departureSeconds);
		}
		
		//log(this.name, station.displayName + &quot; - &quot; + timeLapse);
		var forceLaunch = [];
		var idx = this.$getStationIndex(station);
		var stationkey = station.name + &quot;_&quot; + idx;
		if (this._systemDockingData[system.ID] == null) return;
		var dta = this._systemDockingData[system.ID][stationkey];
		if (dta &amp;&amp; dta.length &gt; 0) {
			var i = dta.length;
			while (i--) {
				var item = dta[i];
				if (((item.departureTime * 60) + item.lastChange) &lt;= clock.adjustedSeconds) {
					// move it do the launching array
					forceLaunch.push(item);
					// remove it from the main array
					dta.splice(i, 1);
				} else {
					item.departureTime -= timeLapse;
					item.lastChange = clock.adjustedSeconds;
				}
			}
		}
		// do the same with the launching list
		if (this._launching.length &gt; 0) {
			var i = this._launching.length;
			while (i--) {
				var item = this._launching[i];
				// only do it if the departure time is still current (ie it hasn&#39;t been moved to &quot;Rescheduled&quot;)
				if (item.station === station.name &amp;&amp; item.stationIndex === idx &amp;&amp; Math.round(item.departureTime) !== -5) {
					if (((item.departureTime * 60) + item.lastChange) &lt;= clock.adjustedSeconds) {
						// move it do the launching array
						forceLaunch.push(item);
						// remove it from the array
						this._launching.splice(i, 1);
					} else {
						if (item.departureTime - timeLapse &gt; 0) {
							item.departureTime -= timeLapse;
							item.lastChange = clock.adjustedSeconds;
						}
					}
				}
			}
		}

		forceLaunch.sort(compare);

		// push the ships out with the addShips function
		if (this._debug &amp;&amp; this._logLaunchType &gt; 0) log(this.name, &quot;Clearing pending ships:&quot; + forceLaunch.length + &quot; -- timeLapse:&quot; + timeLapse);

		var dock = null;
		var dockpos = null;
		// find the dock object of the station so we can position launched ships
		for (var i = 0; i &lt; station.subEntities.length; i++) {
			var subent = station.subEntities[i];
			if (subent.isDock) {
				dock = subent;
				dockpos = station.position.add( //better formula for non-centered docks
					Vector3D(
						station.heading.direction().multiply(dock.position.z),
						station.vectorUp.direction().multiply(dock.position.y),
						station.vectorRight.direction().multiply(dock.position.x)
					)
				);
				break;
			}
		}

		var launchperiod = 4; // this defines the time for which ships will be created. If the difference in minutes between the departure time and the adjusted seconds is
		// less than or equal to this value, the ship will be created. Anything more than this and it will be assumed the ship jumped after launch.
		// the larger this number, the more crowded it will be around the station after launch
		var spread = 0;
		var dist = 2000;

		var last_pos = null;
		var last_group = &quot;&quot;;
		var last_escort = &quot;&quot;;

		if (forceLaunch.length &gt; 0) {
			for (var i = 0; i &lt; forceLaunch.length; i++) {
				var shp = forceLaunch[i];
				var lt = (shp.departureTime * 60) + shp.lastChange;
				// if their departure time is &gt; 4 minutes and their destination is somewhere else, don&#39;t create them.
				// group members and escorts should still fall into this logic, as the destination system is added to each group/escort member, regardless of whether
				// they have a hyperdrive motor or not, and their departure time should be (almost) the same as their leader
				if ((clock.adjustedSeconds - lt) / 60 &lt;= launchperiod) {
					// launch it
					var timediff = Math.abs(clock.adjustedSeconds - lt) / 60;
					timediff += 1; // make sure we never have a zero value

					// if it&#39;s a group or escort member, use the last position
					if ((shp.escortName !== &quot;&quot; &amp;&amp; shp.escortName === last_escort) || (shp.groupName !== &quot;&quot; &amp;&amp; shp.groupName === last_group) &amp;&amp; last_pos !== null) {
						var pos = last_pos;
						spread = 1000;
					} else {
						// work out the position of this launch
						// the first items in the array will need to be further away, as they would have launched first
						var side = this.$rand(8);
						// move away from dock in straight line first...
						var pos = dockpos.add(station.vectorForward.multiply(timediff * dist));
						//var pos = dockpos.add(station.heading.direction().multiply(dist + timediff * dist));
						// based on which side was picked, move the ship in that direction
						switch (side) {
							case 1: // right
								pos = pos.add(station.vectorRight.multiply(timediff * dist));
								break;
							case 2: // up
								pos = pos.add(station.vectorUp.multiply(timediff * dist));
								break;
							case 3: // left
								pos = pos.add(station.vectorRight.multiply(timediff * dist * -1));
								break;
							case 4: // down
								pos = pos.add(station.vectorUp.multiply(timediff * dist * -1));
								break;
							case 5: // up and right
								pos = pos.add(station.vectorRight.multiply(timediff * dist));
								pos = pos.add(station.vectorUp.multiply(timediff * dist));
								break;
							case 6: // up and left
								pos = pos.add(station.vectorRight.multiply(timediff * dist * -1));
								pos = pos.add(station.vectorUp.multiply(timediff * dist));
								break;
							case 7: // down and left
								pos = pos.add(station.vectorRight.multiply(timediff * dist * -1));
								pos = pos.add(station.vectorUp.multiply(timediff * dist * -1));
								break;
							case 8: // down and right
								pos = pos.add(station.vectorRight.multiply(timediff * dist));
								pos = pos.add(station.vectorUp.multiply(timediff * dist * -1));
								break;
						}
						spread = 50;
					}

					// add ship to system
					var shpKey = shp.shipDataKey;
					// make sure a single version is launched (ie without escorts)
					if (this.$dockVersionExists(shpKey)) shpKey = &quot;dock_&quot; + shpKey;

					if (this._debug &amp;&amp; this._logLaunchType === 2) this.$writeDataToLog(shp, &quot;Adding ship to system from &quot; + shp.station);
					var ship = system.addShips(&quot;[&quot; + shpKey + &quot;]&quot;, 1, pos, spread);

					if (!ship || !ship[0]) {
						// Oops! no ship returned!
						// skip it this time and maybe next time it will launch
						log(this.name, &quot;!!ERROR: No ship created&quot;);
						continue;
					}
					if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, &quot;Added ship: &quot; + ship[0]);

					// update ship details
					this.$updateLaunchedShip(ship[0], shp);
					// if there is an attached callback, call it now.
					if (shp.launchCallback &amp;&amp; shp.worldScript) {
						log(this.name, &quot;callback &quot; + shp.worldScript + &quot;.&quot; + shp.launchCallback);
						var w = worldScripts[shp.worldScript];
						if (w) w[shp.launchCallback](&quot;launched&quot;, ship[0]);
					}
					last_pos = pos;
					last_group = shp.groupName;
					last_escort = shp.escortName;
				} else { // if
					// if there is an attached callback, call it now.
					if (shp.launchCallback &amp;&amp; shp.worldScript) {
						log(this.name, &quot;callback &quot; + shp.worldScript + &quot;.&quot; + shp.launchCallback);
						var w = worldScripts[shp.worldScript];
						if (w) w[shp.launchCallback](&quot;cleared&quot;, shp);
					}
					// logic here to add ships to destination system directly (ie. add to _systemDockingData)
					//if (this._debug) this.$writeDataToLog(shp, &quot;Removing ship from data - assumed jump to other system or reached destination&quot;);
				}
			} // for
		} // if
	}

	//-------------------------------------------------------------------------------------------------------------
	// pushes details from the data array onto a launched ship
	this.$updateLaunchedShip = function $updateLaunchedShip(ship, shipData) {

		// push all the stored data onto the ship;
		if (oolite.compareVersion(&quot;1.80&quot;) &lt; 0) {
			ship.entityPersonality = shipData.personality; // can only do this in Oolite 1.81 or greater
		}
		ship.primaryRole = shipData.primaryRole;
		ship.accuracy = shipData.accuracy;
		ship.heatInsulation = shipData.heatInsulation;
		ship.setBounty(shipData.bounty, &quot;setup actions&quot;);
		ship.shipUniqueName = shipData.shipName;
		ship.homeSystem = shipData.homeSystem;

		// this is the &quot;lying&quot; option - essentially doing a bait-n-switch on the player.
		// but because there&#39;s no visible clue that this is happening it&#39;s kind of unfair.
		// one option would be to send some sort of comms message saying &quot;Changing destination now&quot;, but that feels out of place to me.
		// anyway, for the moment this code is disabled

		// if this ship hasn&#39;t been hiding their destination, and they&#39;re not a shuttle, and either an independant ship or a group/escort leader, then....
		//if (shipData.destinationHidden === false &amp;&amp; ship.primaryRole !== &quot;shuttle&quot; &amp;&amp; ((shipData.groupName === &quot;&quot; &amp;&amp; shipData.escortName === &quot;&quot;) || (shipData.groupLeader === true || shipData.escortLeader === true))) {
		//	// there&#39;s a chance they&#39;re going to change their destination
		//	if (Math.random() &lt; 0.2) {
		//		var newDest = this.$getDestinationByRole(shipData.primaryRole);
		//		if (newDest !== shipData.destinationSystem) {
		//			log(this.name, &quot;!!ALERT: Ship &quot; + ship.displayName + &quot; is changing their destination on launch from &quot; + shipData.destinationSystem + &quot; to &quot; + newDest);
		//		}
		//		shipData.destinationSystem = newDest;
		//	}
		// }

		ship.destinationSystem = shipData.destinationSystem;
		ship.fuel = shipData.fuel;

		// set the seed values so that the pilot&#39;s species can be defined by their home system
		var seed = &quot;0 0 0 0 &quot; + shipData.pilotHomeSystem.toString() + &quot; 2&quot;;

		// todo: check what happens to &quot;species&quot;
		if (shipData.pilotDescription !== &quot;&quot;) {
			ship.setCrew({
				name: shipData.pilotName,
				origin: shipData.pilotHomeSystem,
				insurance: shipData.pilotInsurance,
				bounty: shipData.pilotLegalStatus,
				short_description: shipData.pilotDescription,
				random_seed: seed
			});
		} else {
			ship.setCrew({
				name: shipData.pilotName,
				origin: shipData.pilotHomeSystem,
				insurance: shipData.pilotInsurance,
				bounty: shipData.pilotLegalStatus,
				random_seed: seed
			});
		}

		// if we have goods defined (but not &#39;cargo&#39;)
		if (shipData.goods !== &quot;&quot; &amp;&amp; (!shipData.cargo || shipData.cargo === &quot;&quot;)) {
			// put some cargo in the hold
			ship.setCargoType(shipData.goods);
		}
		// process any cargo data we have stored
		//if (this._NPCTrading === true &amp;&amp; shipData.cargo !== &quot;&quot;) {
		//	var td = worldScripts.StationDockInfo_NPCTrading;
		//	td.$processCargo_Launching(ship, shipData.cargo);
		// }

		if (shipData.equipment !== &quot;&quot;) {
			// process all the equipment additions
			var items = shipData.equipment.split(&quot;,&quot;);
			for (var j = 0; j &lt; items.length; j++) {
				var eq = items[j];
				if (eq.indexOf(&quot;:&quot;) &gt;= 0) {
					var subitems = eq.split(&quot;:&quot;);
					switch (subitems[0]) {
						case &quot;X&quot;:
							ship.removeEquipment(subitems[1]);
							break;
						case &quot;FORE&quot;:
							ship.forwardWeapon = subitems[1];
							break;
						case &quot;AFT&quot;:
							ship.aftWeapon = subitems[1];
							break;
						case &quot;PORT&quot;:
							ship.portWeapon = subitems[1];
							break;
						case &quot;STARBOARD&quot;:
							ship.starboardWeapon = subitems[1];
							break;
					}
				} else {
					if (eq !== &quot;&quot;) {
						ship.awardEquipment(eq);
					}
				}
			}
		}

		// set the ai of the ship (if required)
		if (shipData.shipAI !== &quot;&quot;) ship.switchAI(shipData.shipAI);

		// if a intra-system destination is set, set the destination to its position
		if (shipData.destination &amp;&amp; shipData.destination !== &quot;&quot;) {
			if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, &quot;Shuttle &quot; + ship.displayName + &quot; - attaching launch script&quot;);
			var w = worldScripts.StationDockControl_ShuttleLaunch;
			ship.script.$initialise = w.$initialise;
			ship.script.$setDestination = w.$setDestination;
			if (!ship.script.$sdc_hold_shipDied &amp;&amp; ship.script.shipDied) ship.script.$sdc_hold_shipDied = ship.script.shipDied;
			ship.script.shipDied = w.npc_shipDied;
			if (!ship.script.$sdc_hold_shipWillEnterWormhole &amp;&amp; ship.script.shipWillEnterWormhole) ship.script.$sdc_hold_shipWillEnterWormhole = ship.script.shipWillEnterWormhole;
			ship.script.shipWillEnterWormhole = w.npc_shipWillEnterWormhole;
			// set the mothership in that script
			ship.script._dest = shipData.destination;
			ship.script.$initialise();
		}

		// add any additional properties to the launching ship
		if (shipData.hasOwnProperty(&quot;additionalProperties&quot;) === true &amp;&amp; shipData.additionalProperties !== &quot;&quot;) {
			var keys = Object.keys(shipData.additionalProperties);
			for (var i = 0; i &lt; keys.length; i++) {
				var key = keys[i];
				ship.script[key] = shipData.additionalProperties[key];
			}
		}

		// is this ship part of a group or escort?
		if (shipData.groupName !== &quot;&quot;) {
			var stdGroup = null;
			// look for an existing group
			if (this._launchingGroups.length &gt; 0) {
				for (var j = 0; j &lt; this._launchingGroups.length; j++) {
					if (this._launchingGroups[j].name === shipData.groupName) {
						stdGroup = this._launchingGroups[j];
						break;
					}
				}
			}

			// if we didn&#39;t find a group, create a new one
			if (!stdGroup) {
				// is this ship the leader
				if (shipData.groupLeader) {
					// create a group with the ship as the leader
					stdGroup = new ShipGroup(shipData.groupName, ship);
					ship.group = stdGroup;
					if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, &quot;Creating new group with leader: &quot; + ship.displayName + &quot;, &quot; + shipData.groupName + &quot;, &quot; + ship.scanClass);
				} else {
					// otherwise just create the group and add the ship individually
					stdGroup = new ShipGroup(shipData.groupName);
					ship.group = stdGroup;
					stdGroup.addShip(ship);
					if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, &quot;Creating new group: &quot; + ship.displayName + &quot;, &quot; + shipData.groupName + &quot;, &quot; + ship.scanClass);
				}
				this._launchingGroups.push(stdGroup);
			} else {
				// if we found a group, and this is a standard group, just add the ship
				ship.group = stdGroup;
				stdGroup.addShip(ship);
				if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, &quot;Adding to existing group: &quot; + ship.displayName + &quot;, &quot; + shipData.groupName + &quot;, &quot; + ship.scanClass);
				// is the ship the leader
				if (shipData.groupLeader) {
					// add the ship as the leader
					stdGroup.leader = ship;
				} else {
					ship.performEscort();
				}
			}
		}

		if (shipData.escortName !== &quot;&quot;) {
			// process this as an escort
			if (shipData.escortLeader) {
				// for the leader, add the ship to the escort list
				if (this.$leaderIsInArray(shipData.escortName, ship) === false) {
					this._launchingEscorts.push({
						escortName: shipData.escortName,
						leader: ship
					});
				}
				if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, &quot;Escort leader details: &quot; + ship.displayName + &quot;, &quot; + shipData.escortName + &quot;, &quot; + ship.scanClass);
				// monkey patch the ship, but only if we haven&#39;t already done so.
				if (!ship.script.$sdc_hold_shipLaunchedFromStation &amp;&amp; ship.script.shipLaunchedFromStation) {
					ship.script.$sdc_hold_shipLaunchedFromStation = ship.script.shipLaunchedFromStation;
				}
				if (!ship.script.$sdc_hold_shipDied &amp;&amp; ship.script.shipDied) {
					ship.script.$sdc_hold_shipDied = ship.script.shipDied;
				}
				if (!ship.script.$sdc_hold_shipWillEnterWormhole &amp;&amp; ship.script.shipWillEnterWormhole) {
					ship.script.$sdc_hold_shipWillEnterWormhole = ship.script.shipWillEnterWormhole;
				}
				if (!ship.script.$addEscort) {
					var esc = worldScripts.StationDockControl_EscortLaunch;
					ship.script.$addEscort = esc.$addEscort;
					ship.script.$removeEscort = esc.$removeEscort;
					ship.script.$attachEscort = esc.$attachEscort;

					ship.script.shipLaunchedFromStation = esc.npc_shipLaunchedFromStation;
					ship.script.shipDied = esc.npc_shipDied;
					ship.script.shipWillEnterWormhole = esc.npc_shipWillEnterWormhole;
					ship.script._done = false;
				}
			} else {
				// for an escort, find the leader, and offer to escort them
				if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, &quot;Escort member details: &quot; + ship.displayName + &quot;, &quot; + shipData.escortName + &quot;, &quot; + ship.scanClass);
				for (var i = 0; i &lt; this._launchingEscorts.length; i++) {
					if (this._launchingEscorts[i].escortName === shipData.escortName) {
						var mShip = this._launchingEscorts[i].leader;
						if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, &quot;Found leader (&quot; + mShip.displayName + &quot;) - attaching launch script&quot;);
						// if the mothership is already in space, we can do the offer to escort here
						if (mShip.status === &quot;STATUS_IN_FLIGHT&quot; &amp;&amp; ship.status === &quot;STATUS_IN_FLIGHT&quot;) {
							var ret = ship.offerToEscort(mShip);
							if (ret) {
								if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, ship.displayName + &quot;: found leader (&quot; + mShip.displayName + &quot;) - offer to escort: &quot; + ret);
							} else {
								if (!mShip) log(this.name, &quot;!!ERROR: Mothership is null&quot;);
								if (mShip &amp;&amp; mShip.isValid === false) log(this.name, &quot;!!ERROR: Mothership is invalid&quot;);
								log(this.name, &quot;!!ERROR: Ship launch script failed to escort mothership! &quot; + (mShip &amp;&amp; mShip.isValid ? &quot;(Mthr: &quot; + mShip.displayName + &quot; (&quot; + mShip.status + &quot;), &quot; : &quot;&quot;) + &quot;Ship: &quot; + ship.displayName + &quot; (&quot; + ship.status + &quot;)&quot;);
							}
						} else {
							// otherwise, attach the escort launch script
							if (!ship.script.$sdc_hold_shipLaunchedFromStation) {
								if (ship.script.shipLaunchedFromStation) ship.script.$sdc_hold_shipLaunchedFromStation = ship.script.shipLaunchedFromStation;
							}
							if (!ship.script.$sdc_hold_shipDied &amp;&amp; ship.script.shipDied) {
								ship.script.$sdc_hold_shipDied = ship.script.shipDied;
							}
							if (!ship.script.$sdc_hold_shipWillEnterWormhole &amp;&amp; ship.script.shipWillEnterWormhole) {
								ship.script.$sdc_hold_shipWillEnterWormhole = ship.script.shipWillEnterWormhole;
							}
							var esc = worldScripts.StationDockControl_EscortLaunch;
							ship.script.$addEscort = esc.$addEscort;
							ship.script.$removeEscort = esc.$removeEscort;
							ship.script.$attachEscort = esc.$attachEscort;
							ship.script._done = false;
							ship.script.shipLaunchedFromStation = esc.npc_shipLaunchedFromStation;
							ship.script.shipDied = esc.npc_shipDied;
							ship.script.shipWillEnterWormhole = esc.npc_shipWillEnterWormhole;
							// set the mothership in that script
							ship.script._mothership = mShip;
							// add escort to mothership script
							if (!mShip.script.$addEscort) {
								if (!mShip.script.$sdc_hold_shipLaunchedFromStation &amp;&amp; mShip.script.shipLaunchedFromStation) {
									mShip.script.$sdc_hold_shipLaunchedFromStation = mship.script.shipLaunchedFromStation;
								}
								if (!mShip.script.$sdc_hold_shipDied &amp;&amp; mShip.script.shipDied) {
									mShip.script.$sdc_hold_shipDied = mShip.script.shipDied;
								}
								if (!mShip.script.$sdc_hold_shipWillEnterWormhole &amp;&amp; mShip.script.shipWillEnterWormhole) {
									mShip.script.$sdc_hold_shipWillEnterWormhole = mShip.script.shipWillEnterWormhole;
								}
								mShip.script.$addEscort = esc.$addEscort;
								mShip.script.$removeEscort = esc.$removeEscort;
								mShip.script.$attachEscort = esc.$attachEscort;
								mShip.script.shipLaunchedFromStation = esc.npc_shipLaunchedFromStation;
								mShip.script.shipDied = esc.npc_shipDied;
								mShip.script.shipWillEnterWormhole = esc.npc_shipWillEnterWormhole;
								mShip.script._done = false;
							}
							mShip.script.$addEscort(ship);
						}
					}
				}
			}
		} // if
	}

	//-------------------------------------------------------------------------------------------------------------
	// checks if the escort leader is already in the launching array in the given escort group
	this.$leaderIsInArray = function $leaderIsInArray(escortName, leader) {
		for (var i = 0; i &lt; this._launchingEscorts.length; i++) {
			var item = this._launchingEscorts[i];
			if (item.escortName === escortName &amp;&amp; item.leader === leader) return true;
		}
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------
	// return a random departure time, based on a number of different slots
	// returned time is in seconds, and should refer to a time in the future
	this.$calculateRandomDepartureTime = function $calculateRandomDepartureTime(station, idx, slots, allowAbort) {

		// work out min value, based on timeFrame
		var depart = 0;

		// pick a departure band
		if (slots &lt; 2) slots = 2;
		if (slots &gt; 10) slots = 10;
		var band = this._bandSrc[slots];

		var free = false;
		var band_num = 0;
		var tries = 0;
		var secondAttempt = 0;

		do {
			band_num = band[this.$rand(band.length) - 1];
			switch (band_num) {
				//case 1:
				//	depart = this.$rand(5) + 1;
				//	break;
				case 2: // 3-15 minutes
					depart = this.$rand(12) + 3;
					break;
				case 3: // 15-30 minutes
					depart = this.$rand(15) + 15;
					break;
				case 4: // 30-60 minutes
					depart = this.$rand(30) + 30;
					break;
				case 5: // 60-120 minutes (1-2 hours)
					depart = this.$rand(60) + 60;
					break;
				case 6: // 120-720 minutes (2-12 hours)
					depart = this.$rand(600) + 120;
					break;
				case 7: // 720-960 minutes (12-16 hours) loading
					depart = this.$rand(240) + 720;
					break;
				case 8: // 960-1200 minutes (16-20 hours) docked
					depart = this.$rand(240) + 960;
					break;
				case 9: // 1200-1380 minutes (20-23 hours) unloading
					depart = this.$rand(180) + 1200;
					break;
				case 10: // 1380-1440 minutes (23-24 hours) docking
					depart = this.$rand(60) + 1380;
					break;
				case 11: // 1440-1680 minutes (24-28 hours) docking (failsafe)
					depart = this.$rand(240) + 1440;
					break;
			}
			// check this launch slot for free positions
			free = true;
			if (this._departureBands.length &gt; 0) {
				var check = this._departureBands[depart];
				if (check === 1) {
					this._departureBands[depart] = 0;
				} else {
					free = false;
				}
			} else {
				free = this.$checkDepartureSlot(station.name, idx, depart);
			}
			if (free === false) tries++;
			// if we&#39;ve tried 7 (formerly 10) times to find a slot, jump into the failsafe zone
			if (tries === 7) {
				if (this.$indexInList(11, band) &gt;= 0 &amp;&amp; allowAbort === true) {
					log(this.name, &quot;!!NOTE: Search for free launch time failed - &quot; + station.name + &quot; (&quot; + idx + &quot;) &quot; + slots);
					return -1;
				}
				// make a note of when we hit the retry limit
				log(this.name, &quot;!!NOTE: Search for free launch time hit limit - &quot; + station.name + &quot; (&quot; + idx + &quot;) &quot; + slots);
				this._limit++;
				if (this._limit &gt;= 30) {
					this.$displayDetails(station.name, idx);
					this._limit = 0;
				}
				// have a really good go at the slot period
				//if (secondAttempt === 0) {
				//	band = new Array(30).join(slots);
				//	secondAttempt += 1;
				//} else 
				if (secondAttempt === 0) {
					// do a slot search the hard way
					var slow_val = this.$nextFreeDepartureSlot(station.name, idx, band_num);
					if (slow_val !== -1) {
						free = true;
						depart = slow_val;
					}
					secondAttempt += 1;
				} else {
					// then try anywhere
					band = [3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 9, 9, 9, 9, 10, 10, 10, 10, 11, 11];
				}
				tries = 0;
			}
		} while (free === false);

		return depart;
	}

	//-------------------------------------------------------------------------------------------------------------
	// checks a departure slot to see if it&#39;s free at a particular station
	this.$checkDepartureSlot = function $checkDepartureSlot(stationName, stnIndex, departureTime) {
		if (!this._systemDockingData[system.ID]) return false;
		var dta = this._systemDockingData[system.ID][stationName + &quot;_&quot; + stnIndex];
		if (dta &amp;&amp; dta.length &gt; 0) {
			var i = dta.length;
			while (i--) {
				// if the time difference is less than 60 seconds...
				if (dta[i].departureTime == departureTime) return false;
			}
		}
		return true;
	}

	//-------------------------------------------------------------------------------------------------------------
	// find a free departure slot in a particular time band the hard way
	this.$nextFreeDepartureSlot = function $nextFreeDepartureSlot(stationName, stnIndex, band) {
		function compareDeparture(a, b) {
			if ((a.departureTime * 10 + a.departureSeconds) &lt; (b.departureTime * 10 + b.departureSeconds)) return (worldScripts.StationDockControl_Interface._sortDir * -1);
			if ((a.departureTime * 10 + a.departureSeconds) &gt; (b.departureTime * 10 + b.departureSeconds)) return (worldScripts.StationDockControl_Interface._sortDir);
			return 0;
		}
		if (this._debug) log(this.name, &quot;Hit slow slot selection process on &quot; + stationName + &quot; (&quot; + stnIndex + &quot;) - band &quot; + band);

		if (!this._systemDockingData[system.ID]) {
			log(this.name, &quot;!ERROR - No docking data found for system &quot; + system.ID);
			return -1;
		}

		var rng = this._bandRng[band];
		if (!rng) {
			log(this.name, &quot;!ERROR - No docking band data found for band &quot; + band);
			return -1
		}

		if (this._departureBands.length === 0) {
			// during a std population (non-full)
			var dta = this._systemDockingData[system.ID][stationName + &quot;_&quot; + stnIndex];
			dta.sort(compareDeparture);

			var point = startPoint;
			if (dta &amp;&amp; dta.length &gt; 0) {
				for (var i = 0; i &lt; dta.length; i++) {
					var item = dta[i];
					if (item.departureTime &gt;= rng.low &amp;&amp; item.departureTime &lt; rng.high) {
						if (item.departureTime != point) {
							if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) log(this.name, &quot;found slot &quot; + point);
							return point;
						}
						point += 1;
					}
					if (point &gt; item.departureTime) break;
				}
			}
		} else {
			// during a full repop, when the _departureBands array is available
			for (var i = rng.low; i &lt;= rng.high; i++) {
				if (this._departureBands[i] === 1) {
					if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) log(this.name, &quot;found quick slot &quot; + i);
					this._departureBands[i] = 0;
					return i;
				}
			}
		}
		log(this.name, &quot;Failed!&quot;)
		return -1;
	}

	//-------------------------------------------------------------------------------------------------------------
	this.$displayDetails = function $displayDetails(stationName, stnIndex) {
		function compareDeparture(a, b) {
			if ((a.departureTime * 10 + a.departureSeconds) &lt; (b.departureTime * 10 + b.departureSeconds)) return (worldScripts.StationDockControl_Interface._sortDir * -1);
			if ((a.departureTime * 10 + a.departureSeconds) &gt; (b.departureTime * 10 + b.departureSeconds)) return (worldScripts.StationDockControl_Interface._sortDir);
			return 0;
		}

		if (!this._systemDockingData[system.ID]) return;
		var dta = this._systemDockingData[system.ID][stationName + &quot;_&quot; + stnIndex];
		dta.sort(compareDeparture);
		for (var i = 0; i &lt; dta.length; i++) {
			log(this.name, dta[i].departureTime + &quot;: &quot; + dta[i].shipName);
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// put all available slots into an array for easy checking
	this.$createDepartureSlots = function $createDepartureSlots() {
		// create 1 minute departure slots for the current station, up to 25 hours (buffer for potential time slot overruns)
		this._departureBands.length = 0;
		for (var i = 1; i &lt;= 1500; i++) {
			this._departureBands.push(1);
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// remove any slots already taken by currently docked ships
	this.$removeExistingSlots = function $removeExistingSlots(station) {
		// get list of ships at this station
		var docklist = this.$getViewingList(station, true);
		// for each item, work out the number of minutes till launch
		for (var i = 0; i &lt; docklist.length; i++) {
			//var mins = parseInt(((docklist.departureTime * 60 + docklist.lastChange) - clock.adjustedSeconds) / 60);
			var mins = docklist[i].departureTime;
			this._departureBands[mins] = 0;
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// checks if the role exists in our array of ships
	this.$roleExists = function $roleExists(role) {
		return (this._randomShips[role] ? true : false);
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns a system ID of a system in a particular range
	// borrowed from oolite-populator.js
	this.$nearbySystem = function $nearbySystem(range) {
		if (range !== 7) {
			var poss = system.info.systemsInRange(range);
		} else {
			var poss = this._neighbours;
		}
		if (poss.length === 0) return system.ID;
		return poss[Math.floor(Math.random() * poss.length)].systemID;
	}

	//-------------------------------------------------------------------------------------------------------------
	// select a random ship type key (eg &quot;noshaders_z_groovy_cobra1_india_npc&quot;) for a particular the role (eg &quot;trader&quot;)
	this.$getRandomShipKey_old = function $getRandomShipKey_old(role) {
		var items = null;
		var freq = null;
		if (this._randomShips[role]) {
			items = this._randomShips[role].shipKeys;
			freq = this._randomShips[role].frequency;
		}
		if (!items) {
			// should never happen...
			return &quot;&quot;;
		}
		var choice = -1;
		do {
			choice = this.$rand(items.length) - 1;
			// will we keep this choice or reset it?
			if (Math.random() &gt; parseFloat(freq[choice])) choice = -1;
		} while (choice === -1);
		var result = items[choice];
		return result;
	}
	// contributed by Day
	this.$getRandomShipKey = function $getRandomShipKey(role) {
		var items = null;
		var freq = null;
		if (this._randomShips[role]) {
			items = this._randomShips[role].shipKeys;
			freq = this._randomShips[role].frequency;
		}
		if (!items) {
			// should never happen...
			return &quot;&quot;;
		}
		var choice = -1;
		var that = $getRandomShipKey;
		var random = (that.random = that.random || Math.random);
		do {
			choice = this.$rand(items.length) - 1;
			// will we keep this choice or reset it?
			if (random() &gt; parseFloat(freq[choice])) choice = -1;
		} while (choice === -1);
		var result = items[choice];
		return result;
	}

	//-------------------------------------------------------------------------------------------------------------
	// runs the &quot;getRandomShipKey&quot; function, but also checks whether the ship will actually fit in the stations dock
	this.$getRandomShipKeyWithDockCheck = function $getRandomShipKeyWithDockCheck(role, station) {
		// checks if a ship will fit in the dock of a station, just ensuring we don&#39;t put a ship inside a station that could never have fitted
		function checkShipCanDock(shipType, station, shipFits) {
			var lookup = station.shipClassName + &quot;|&quot; + shipType;
			if (shipFits[lookup] != undefined) return (shipFits[lookup] === 1 ? true : false);
			return true;
		}

		var loopCount = 0;
		var result = &quot;&quot;;
		var finished = false;
		do {
			result = $getRandomShipKey(role);
			var shiptype = this._shipData[result].name;
			if (checkShipCanDock(shiptype, station, this._shipFits) === true) finished = true;
			loopCount += 1;
		} while (finished === false &amp;&amp; loopCount &lt; 5);
		return result;
	}

	//-------------------------------------------------------------------------------------------------------------
	// use randomshipnames OXP to generate ship names (if installed) - otherwise just return a blank string (no name)
	this.$getRandomShipName = function $getRandomShipName(role) {
		var randomShipName = &quot;&quot;;
		if (this._rsnInstalled) {
			if (player.ship) {
				try {
					if (Ship.roleIsInCategory(role, &quot;oolite-bounty-hunter&quot;) || Ship.roleIsInCategory(role, &quot;oolite-assassin&quot;))
						randomShipName = worldScripts[&quot;randomshipnames&quot;].$randomHunterName(player.ship);
					else if (Ship.roleIsInCategory(role, &quot;oolite-pirate&quot;))
						randomShipName = worldScripts[&quot;randomshipnames&quot;].$randomPirateName(player.ship);
					// catch everything else as a trader
					if (randomShipName === &quot;&quot;)
						randomShipName = worldScripts[&quot;randomshipnames&quot;].$randomTraderName(player.ship);
				} catch (err) {
					log(this.name, &quot;!!ERROR: Unable to get ship name from RSN: &quot; + err);
				}
			}
		}
		if (randomShipName === undefined) randomShipName = &quot;&quot;;
		return randomShipName;
	}

	//-------------------------------------------------------------------------------------------------------------
	// create list of escort ships to be included with parent ship
	// escort data keys are accessed directly, not from our data array
	this.$getEscortData = function $getEscortData(shipKey) {

		var escorts = this._shipData[shipKey][&quot;escorts&quot;]; // number
		var escort_role = this._shipData[shipKey][&quot;escort_role&quot;]; // eg &quot;asp-pirate&quot;
		var escort_shipKey = this._shipData[shipKey][&quot;escort_ship&quot;]; // eg &quot;cobra3-alternate&quot;
		var escort_roles = this._shipData[shipKey][&quot;escort_roles&quot;]; // dict
		var escort_type = &quot;&quot;;

		var ships = [];
		var count = 0;

		if (escort_roles &amp;&amp; escort_roles.length &gt; 0 &amp;&amp; escorts &amp;&amp; parseInt(escorts) &gt; 0) {
			if (this._debug) log(this.name, &quot;!!NOTE: Ship key &#39;&quot; + shipKey + &quot;&#39; has both types of escort definitions - new type will be used&quot;);
		}

		if ((!escort_roles || escort_roles.length === 0) &amp;&amp; escorts &amp;&amp; parseInt(escorts) &gt; 0) {
			if (this.$dockVersionExists(shipKey) === false) {
				log(this.name, &quot;!!NOTE: Escorts required for &#39;&quot; + shipKey + &quot;&#39; (Escorts: &quot; + escorts + &quot;) but no &#39;dock&#39; version of the shipdata exists&quot;);
				// in this case, don&#39;t try to create any - it will only conflict with the automatically generated ones. Just return
				return;
			}
			// old style
			// this will need adjusting for better matching of Oolite weighting
			if (!escort_role || escort_role === &quot;&quot;) escort_role = &quot;escort&quot;;
			var allowed = this.$roleIsAllowed(escort_role);
			var i = this.$rand(parseInt(escorts));
			while (i--) {
				// is this role one of ours? then get a ship key from our array
				if (allowed) {
					escort_shipKey = this.$getRandomShipKey(escort_role);
				} else {
					// otherwise, this mothership has a custom escort role defined, so use that instead
					var keys = Ship.keysForRole(escort_role);
					escort_shipKey = keys[this.$rand(keys.length) - 1];
					if (escort_shipKey === undefined) escort_shipKey = this.$getRandomShipKey(escort_role);
					// check if we have this in the additional roles array
					if (this.$indexInList(escort_role, this._additionalRoles) === -1) this._additionalRoles.push(escort_role);
				}
				ships.push({
					role: (escort_role.indexOf(&quot;[&quot;) === 0 ? &quot;escort&quot; : escort_role),
					shipKey: escort_shipKey
				});
				count += 1;
				if (count === 16) break;
			}
			if (count &gt; 0) {
				if (this._debug &amp;&amp; this._logPopulatorType &gt; 2) log(this.name, &quot;Processing role:&quot; + escort_role + &quot;, max:&quot; + escorts + &quot;, result:&quot; + count);
			}
		} else if (escort_roles &amp;&amp; escort_roles.length &gt; 0) {
			if (this.$dockVersionExists(shipKey) === false) {
				log(this.name, &quot;!!NOTE: Escorts required for &#39;&quot; + shipKey + &quot;&#39; (Types: &quot; + escort_roles.length + &quot;, first:&quot; + escort_roles[0].role + &quot;, max:&quot; + escort_roles[0].max + &quot;, min:&quot; + escort_roles[0].min + &quot;) but no &#39;dock&#39; version of the shipdata exists&quot;);
				// in this case, don&#39;t try to create any - it will only conflict with the automatically generated ones. Just return
				return;
			}
			// new style
			var i = escort_roles.length;
			while (i--) {
				var item = escort_roles[i];
				var role = item.role;
				var min = parseInt(item.min);
				var max = parseInt(item.max);

				// this will need adjusting for better matching of Oolite weighting
				if (role !== &quot;&quot;) {
					var inc = this.$rand(max - min) + min;
					if (this._debug &amp;&amp; this._logPopulatorType &gt; 2) log(this.name, &quot;Processing role:&quot; + role + &quot;, min:&quot; + min + &quot;, max:&quot; + max + &quot;, result:&quot; + inc);
					if (inc &gt; 0) {
						var allowed = this.$roleIsAllowed(role);
						var j = inc;
						//for (var j = 0; j &lt; inc; j++) {
						while (j--) {
							if (count &lt; 16) {
								// is this role one of ours? then get a ship key from our array
								if (allowed) {
									escort_shipKey = this.$getRandomShipKey(role);
								} else {
									// otherwise, this mothership has a custom escort role defined, so use that instead
									if (role.indexOf(&quot;[&quot;) === 0 &amp;&amp; role.indexOf(&quot;]&quot;) &gt; 0) {
										escort_shipKey = role.substring(1, role.length - 1);
									} else {
										var keys = Ship.keysForRole(role);
										if (!keys) {
											log(this.name, &quot;!!ERROR: requested &quot; + role + &quot; for escorts, but no data keys found - no escorts created&quot;);
											return;
										}
										escort_shipKey = keys[this.$rand(keys.length) - 1];
										// check if we have this in the additional roles array
										if (this.$indexInList(escort_role, this._additionalRoles) === -1) this._additionalRoles.push(escort_role);
									}
								}
								// in the case where a specific ship has been specified in the role (eg &quot;[sidewinder-escort]&quot;), output &quot;escort&quot; instead of the actual role
								ships.push({
									role: (role.indexOf(&quot;[&quot;) === 0 ? &quot;escort&quot; : role),
									shipKey: escort_shipKey
								});
								count += 1;
							}
							// max of 16 escorts
							if (count === 16) break;
						}
					}
				}
				// max of 16 escorts
				if (count === 16) break;
			}
		}
		return ships;
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns true if a &quot;dock_shipkey&quot; entry exists in the shipdata.plist file. Otherwise false
	// used when launching/adding ships to the system to ensure that only 1 ship is created, without escorts
	// escorts are created manually
	this.$dockVersionExists = function $dockVersionExists(shipKey) {
		var shipdata = Ship.shipDataForKey(&quot;dock_&quot; + shipKey);
		if (shipdata) {
			return true;
		} else {
			return false;
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// sets up the weapon info for a particular ship key
	this.$setWeapons = function $setWeapons(shpDataKey, level) {
		var autoWeapons = true;
		if (this._shipData[shpDataKey]) {
			var def = this._shipData[shpDataKey][&quot;auto_weapons&quot;];
			if (this.$indexInList(def, this._trueValues) === -1) autoWeapons = false;
		}
		if (autoWeapons === false) {
			// default is not to change anything
			return &quot;&quot;;
		}
		var equip = &quot;&quot;;
		var choice = Math.floor(level);
		if (level - Math.floor(level) &gt; Math.random()) {
			choice++;
		}
		if (choice &lt;= 1) {
			equip += &quot;FORE:EQ_WEAPON_PULSE_LASER,&quot;;
		} else if (choice === 2) {
			equip += &quot;FORE:EQ_WEAPON_BEAM_LASER,&quot;;
		} else if (choice === 3) {
			equip += &quot;FORE:EQ_WEAPON_BEAM_LASER,&quot;;
			equip += &quot;AFT:EQ_WEAPON_BEAM_LASER,&quot;;
		} else if (choice === 4) {
			equip += &quot;FORE:EQ_WEAPON_MILITARY_LASER,&quot;;
			equip += &quot;ALT:EQ_WEAPON_BEAM_LASER,&quot;;
		} else if (choice &gt;= 5) {
			equip += &quot;FORE:EQ_WEAPON_MILITARY_LASER,&quot;;
			equip += &quot;AFT:EQ_WEAPON_MILITARY_LASER,&quot;;
		}
		return equip;
	}

	//-------------------------------------------------------------------------------------------------------------
	// sets up the accuracy of a particular ship key
	this.$setAccuracy = function $setAccuracy(shpDataKey, skill) {
		// set an initial accuracy value, based on the shipdata value
		var init = this.$rand(10) - 5;
		var autoWeapons = true;

		if (this._shipData[shpDataKey]) {
			if (this._shipData[shpDataKey][&quot;accuracy&quot;] != undefined) init = this._shipData[shpDataKey][&quot;accuracy&quot;];
			var def = this._shipData[shpDataKey][&quot;auto_weapons&quot;];
			if (this.$indexInList(def, this._trueValues) === -1) autoWeapons = false;
		}
		if (autoWeapons === true &amp;&amp; init &lt; 5 &amp;&amp; skill !== 0) {
			// shift skill towards end of accuracy range
			var target = 4.99;
			if (skill &lt; 0) target = -5;

			var acc = init;
			for (var i = Math.abs(skill); i &gt; 0; i--) {
				acc += (target - acc) * Math.random();
			}
			return acc;
		} else {
			return init;
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns a destination system based on a primary role
	this.$getDestinationByRole = function $getDestinationByRole(primaryRole, dockedStation) {
		//-------------------------------------------------------------------------------------------------------------
		// returns true if player has a role similar to roletype, otherwise false
		// if abortType1 or abortType2 is not blank and found, will force an automatic false response
		var $checkPlayerRoles = function (cycles, roleType, abortType1, abortType2) {
			var result = false;
			var prw = player.roleWeights;

			for (var i = 1; i &lt;= cycles; i++) {
				var checkrole = prw[parseInt(Math.random() * prw.length)];

				if (checkrole.indexOf(roleType) &gt;= 0) result = true;
				if (abortType1 !== &quot;&quot; &amp;&amp; checkrole.indexOf(abortType1) &gt;= 0) return false;
				if (abortType2 !== &quot;&quot; &amp;&amp; checkrole.indexOf(abortType2) &gt;= 0) return false;
			}
			return result;
		}

		var wpop = worldScripts[&quot;oolite-populator&quot;];
		var destSystem = -1;
		var destHidden = true;
		var destLoc = &quot;&quot;;
		// the number in each of these calls basically says how hard do we look for the role. 1 = try once, 4 = try four times
		var playerIsTrader = $checkPlayerRoles(1, &quot;trader&quot;, &quot;pirate&quot;, &quot;&quot;);
		var playerIsSmuggler = $checkPlayerRoles(2, &quot;smuggler&quot;, &quot;pirate&quot;, &quot;&quot;);
		var playerIsCourier = $checkPlayerRoles(1, &quot;courier&quot;, &quot;assassin&quot;, &quot;pirate&quot;);
		var playerIsHunter = $checkPlayerRoles(3, &quot;hunter&quot;, &quot;assassin&quot;, &quot;pirate&quot;);
		var playerIsPirate = $checkPlayerRoles(4, &quot;pirate&quot;, &quot;hunter&quot;, &quot;&quot;);
		var playerIsAssassin = $checkPlayerRoles(4, &quot;assassin&quot;, &quot;hunter&quot;, &quot;&quot;);

		switch (primaryRole) {
			case &quot;trader&quot;:
				destSystem = wpop._weightedNearbyTradeSystem();
				// if the player is a trader and not a pirate and the danger level of the destination system is high, they will probably want some company.
				if ((playerIsTrader || (playerIsHunter &amp;&amp; player.score &gt;= 256)) &amp;&amp; !playerIsPirate &amp;&amp; ((4 - System.infoForSystem(galaxyNumber, destSystem).government) / 5) &gt; Math.random())
					destHidden = false;
				// sometimes let an inexperienced player have some launch before/after slot
				if (!playerIsHunter &amp;&amp; !playerIsCourier &amp;&amp; !playerIsSmuggler &amp;&amp; !playerIsPirate &amp;&amp; !playerIsAssassin &amp;&amp; System.infoForSystem(galaxyNumber, destSystem).government &gt; 5 &amp;&amp; Math.random() &gt; (0.8 + (player.score / 64)))
					destHidden = false;
				break;
			case &quot;trader-courier&quot;:
				if (Math.random() &lt; 0.5) {
					destSystem = this.$nearbySystem(7);
				} else {
					destSystem = this.$nearbySystem(25);
				}
				// if the player is a courier and not a pirate or assassin and the danger level of the destination system is high, they will probably want some company.
				if (((playerIsCourier &amp;&amp; (player.passengerReputation + player.parcelReputation) &gt;= 3) || (playerIsHunter &amp;&amp; player.score &gt;= 512)) &amp;&amp;
					!playerIsPirate &amp;&amp;
					!playerIsAssassin &amp;&amp;
					((3 - System.infoForSystem(galaxyNumber, destSystem).government) / 5) &gt; Math.random())
					destHidden = false;
				break;
			case &quot;trader-smuggler&quot;:
				destSystem = this.$nearbySystem(7);
				// if the player is a trader and not a pirate and the danger level of the destination system is high, they will probably want some company.
				if ((playerIsTrader || playerIsSmuggler || (playerIsHunter &amp;&amp; player.score &gt;= 512)) &amp;&amp; !playerIsPirate &amp;&amp; ((3 - System.infoForSystem(galaxyNumber, destSystem).government) / 5) &gt; Math.random())
					destHidden = false;
				break;
			case &quot;assassin-light&quot;:
			case &quot;assassin-medium&quot;:
			case &quot;assassin-heavy&quot;:
				destSystem = system.ID;
				/* Note: this routine doesn&#39;t work yet. Assassins default AI won&#39;t jump to a target system, and there is no guarantee they&#39;ll see the player as their target.
				// will this assassin try to lure the player?
				if ((playerIsHunter || playerIsCourier) &amp;&amp; !playerIsAssassin &amp;&amp; Math.random() &gt; 0.1) {
					destSystem = wpop._nearbySafeSystem(4);
					log(this.name, &quot;got here with &quot; + destSystem + &quot;, curr system &quot; + system.ID);
					if (destSystem !== system.ID) {
						destHidden = false;
						if (this._debug &amp;&amp; this._logPopulatorType &gt;= 1) log(this.name, &quot;Assassin trap set - destination &quot; + System.infoForSystem(galaxyNumber, destSystem).name);
					}
				}
				*/
				break;
			case &quot;hunter&quot;:
				destSystem = system.ID;
				break;
			case &quot;hunter-medium&quot;:
				destSystem = wpop._nearbyDangerousSystem(4);
				// if the player is a pirate and not a hunter and the danger level of the destination system is high, they will probably want some company.
				if (playerIsHunter &amp;&amp; !playerIsPirate &amp;&amp; !playerIsAssassin &amp;&amp; player.score &gt;= 256 &amp;&amp; ((4 - System.infoForSystem(galaxyNumber, destSystem).government) / 5) &gt; Math.random())
					destHidden = false;
				break;
			case &quot;hunter-heavy&quot;:
				destSystem = wpop._nearbyDangerousSystem(1);
				// if the player is a pirate and not a hunter and the danger level of the destination system is high, they will probably want some company.
				if (playerIsHunter &amp;&amp; !playerIsPirate &amp;&amp; !playerIsAssassin &amp;&amp; player.score &gt;= 512 &amp;&amp; ((4 - System.infoForSystem(galaxyNumber, destSystem).government) / 5) &gt; Math.random())
					destHidden = false;
				break;
			case &quot;shuttle&quot;:
				destSystem = system.ID;
				destLoc = this.$getRandomSystemLocation(dockedStation);
				// if the player is a trader and not a pirate and the danger level of the destination system is high, they will probably want some company.
				if ((playerIsTrader || playerIsCourier) &amp;&amp; !playerIsPirate &amp;&amp; ((3 - system.info.government) / 5) &gt; Math.random())
					destHidden = false;
				break;
			case &quot;pirate&quot;:
				destSystem = system.ID;
				// if the player is a pirate and not a hunter and the danger level of the destination system is high, they will probably want some company.
				if (playerIsPirate &amp;&amp; !playerIsHunter &amp;&amp; player.score &gt;= 256 &amp;&amp; ((4 - System.infoForSystem(galaxyNumber, destSystem).government) / 5) &gt; Math.random())
					destHidden = false;
				break;
			case &quot;pirate-light-freighter&quot;:
			case &quot;pirate-medium-freighter&quot;:
			case &quot;pirate-heavy-freighter&quot;:
				destSystem = wpop._nearbySafeSystem(system.info.government + 1);
				if (playerIsPirate &amp;&amp; !playerIsHunter &amp;&amp; player.score &gt;= 512 &amp;&amp; ((4 - System.infoForSystem(galaxyNumber, destSystem).government) / 5) &gt; Math.random()) destHidden = false;
				break;
		}
		return {
			destination: destSystem,
			destinationHidden: destHidden,
			location: destLoc
		};
	}

	//-------------------------------------------------------------------------------------------------------------
	// gets the station obbect from a given station name and index
	this.$getStationFromName = function $getStationFromName(stationName, stationIndex) {
		for (var i = 0; i &lt; this._stationList.length; i++) {
			var item = this._stationList[i];
			if (item.name === stationName &amp;&amp; item.index === stationIndex) return item.station;
		}
		return null;
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns the index of a particular station
	this.$getStationIndex = function $getStationIndex(station) {
		for (var i = 0; i &lt; this._stationList.length; i++) {
			if (this._stationList[i].station === station) return this._stationList[i].index;
		}
		return 0;
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns true if station has a role in the list of roles for medium traffic stations
	this.$checkStationRoleForMediumTraffic = function $checkStationRoleForMediumTraffic(station) {
		if (station.roles) {
			for (var i = 0; i &lt; station.roles.length; i++) {
				if (this.$indexInList(station.roles[i], this._trafficMedium) &gt;= 0) return true;
			}
		}
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns true if station has a role in the list of roles for low traffic stations
	this.$checkStationRoleForLowTraffic = function $checkStationRoleForLowTraffic(station) {
		if (station.roles) {
			for (var i = 0; i &lt; station.roles.length; i++) {
				if (this.$indexInList(station.roles[i], this._trafficLow) &gt;= 0) return true;
			}
		}
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns true if station has a role in the list of roles for low traffic stations
	this.$checkStationRoleForVeryLowTraffic = function $checkStationRoleForVeryLowTraffic(station) {
		if (station.roles) {
			for (var i = 0; i &lt; station.roles.length; i++) {
				if (this.$indexInList(station.roles[i], this._trafficVeryLow) &gt;= 0) return true;
			}
		}
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns true if station has a role in the list of roles for no traffic stations
	this.$checkStationRoleForNoTraffic = function $checkStationRoleForNoTraffic(station) {
		if (station.roles) {
			for (var i = 0; i &lt; station.roles.length; i++) {
				if (this.$indexInList(station.roles[i], this._trafficNone) &gt;= 0) return true;
			}
		}
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns true if the station has a role in the list of roles for no shuttle traffic
	this.$checkShuttleDestForNoTraffic = function $checkShuttleDestForNoTraffic(station) {
		if (station.roles) {
			for (var i = 0; i &lt; station.roles.length; i++) {
				if (this.$indexInList(station.roles[i], this._shuttleTrafficNone) &gt;= 0) return true;
			}
		}
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------
	// sets up the heat insulation for a particular ship key
	this.$setHeatInsulation = function $setHeatInsulation(shpDataKey, initial) {
		var shipHeat = 1;
		if (this._shipData[shpDataKey] &amp;&amp; this._shipData[shpDataKey].hasOwnProperty(&quot;heat_insulation&quot;) === true) shipHeat = parseInt(this._shipData[shpDataKey][&quot;heat_insulation&quot;]);
		if (initial !== 0) shipHeat = initial;
		return shipHeat;
	}

	//-------------------------------------------------------------------------------------------------------------
	// calculates a random insurance amount for a new pilot
	this.$calcInsurance = function $calcInsurance(bounty) {
		var result = 0;
		if (bounty === 0) {
			if (Math.random() &gt; 0.9) {
				result = parseInt(Math.random() * 100) + 100;
			} else if (Math.random() &gt; 0.6) {
				result = parseInt(Math.random() * 50) + 50;
			} else {
				result = parseInt(Math.random() * 20) + 10;
			}
		}
		return result;
	}

	//-------------------------------------------------------------------------------------------------------------
	// determines whether there is room to launch a certain number of ships
	this.$launchAvailable = function $launchAvailable(station, ships) {
		if (station) {
			var subent = station.subEntities;
			var space = 0;
			var queued = 0;
			if (subent) {
				for (var i = 0; i &lt; subent.length; i++) {
					var ent = subent[i];
					if (ent.isDock) {
						space += 16 - ent.launchingQueueLength;
						queued += ent.launchingQueueLength;
					}
				}
			} else {
				if (this._debug) log(this.name, &quot;!NOTE: $launchAvailable -- subent is null (no subentities on station), could not find dock, returning false&quot;);
			}
			if (queued === 0 &amp;&amp; space === 0 &amp;&amp; this._debug) log(this.name, &quot;!NOTE: $launchAvailable -- no queued ships but space is 0 - no docks found?&quot;);
			return (space &gt;= ships);
		} else {
			if (this._debug) log(this.name, &quot;!ERROR: $launchAvailable -- station is null, defaulting to false&quot;);
			return false;
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// returns an array of ships currently attempting to dock at the station
	this.$getShipsDocking = function $getShipsDocking(station) {
		function $isDocking(entity) {
			return entity.isShip &amp;&amp; entity.isValid &amp;&amp; entity.isPiloted &amp;&amp; !entity.isStation &amp;&amp; entity.dockingInstructions &amp;&amp; entity.dockingInstructions.station === station;
		}
		return system.filteredEntities(this, $isDocking, station, station.scannerRange);
	}

	//-------------------------------------------------------------------------------------------------------------
	// forces a specific ship to dock at a specific station
	this.$forceShipToDock = function $forceShipToDock(station, ship) {
		var died = false;
		// if this is an individual ship, or not the leader of a group/escort, then decide if they &quot;make it&quot;
		// note: this code should never get used, as we aren&#39;t forcing docked ships that aren&#39;t trying to dock anymore
		if (ship.position.distanceTo(station) &gt; (station.scannerRange * 1.4)) {
			var chance = (system.government + 1) / 8;
			// three strike policy
			if (Math.random() &gt; chance &amp;&amp; Math.random() &gt; chance &amp;&amp; Math.random() &gt; chance) died = true;
			if (this._debug &amp;&amp; this._logDockingType === 2 &amp;&amp; died) log(this.name, &quot;Ship reckoned as destroyed: &quot; + ship);
		}
		// dock the ship
		if (died === false) {
			if (this._debug &amp;&amp; this._logDockingType === 2) log(this.name, &quot;Forcing ship to dock...&quot; + ship);
			this.$logShipDocking(station, ship);
		}
		// remove the ship from the system
		ship.remove(false);
	}

	//-------------------------------------------------------------------------------------------------------------
	// controller to look after the force-dock of ships in a given time lapse
	this.$forceDockController = function $forceDockController(timeLapse) {
		var stns = system.stations;
		// any ships currently trying to dock? if the time lapse is 10 minutes or greater, dock them
		if (timeLapse &gt;= 10) {
			stns.forEach(function (station) {
				var docking = this.$getShipsDocking(station);
				if (docking &amp;&amp; docking.length &gt; 0) {
					for (var i = 0; i &lt; docking.length; i++) {
						var dock = docking[i];
						if (dock.isValid &amp;&amp; dock.isStation === false &amp;&amp; dock.isPlayer === false) {
							var group = [];
							var escort = [];
							if (dock.group) {
								for (var j = 0; j &lt; dock.group.ships.length; j++) {
									group.push(dock.group.ships[j]);
								}
							}
							if (dock.escortGroup) {
								for (var j = 0; j &lt; dock.escortGroup.ships.length; j++) {
									escort.push(dock.escortGroup.ships[j]);
								}
							}
							this.$forceShipToDock(station, dock);
							// dock all his mates as well
							if (group.length &gt; 0) {
								for (var j = 0; j &lt; group.length; j++) {
									var grp = group[j];
									if (grp.isValid &amp;&amp; grp.isStation === false) {
										this.$forceShipToDock(station, grp);
									}
								}
							}
							if (escort.length &gt; 0) {
								for (var j = 0; j &lt; escort.length; j++) {
									var esc = escort[j];
									if (esc.isValid &amp;&amp; esc.isStation === false) {
										this.$forceShipToDock(station, esc);
									}
								}
							}
						} // if docking is valid
					} // for i (loop on docking ships)
				} // if docking and length &gt; 0
				docking.length = 0;
			}, this); // stns.foreach
		} // if timelapse
	}

	//-------------------------------------------------------------------------------------------------------------
	// these docking bay number functions are only used when docking a single ship
	// the checking function is too slow when running in a full population routine

	//-------------------------------------------------------------------------------------------------------------
	// gets a new docking back code
	this.$getDockingBayCode = function $getDockingBayCode(station, stationIndex) {
		if (!this._systemDockingData[system.ID]) return &quot;&quot;;
		var stnmax = parseInt(station.mass / 800000);
		var baynum = &quot;&quot;;
		var exclude = 0;

		// if this is the players docked station, pull up the docking bay code allocated to the player
		if (player.ship.docked) {
			if (player.ship.dockedStation === station) exclude = worldScripts.StationDockControl_Interface._playerDockingBay
		}

		do {
			// get a random docking bay code that isn&#39;t the players
			do {
				baynum = this.$rand(stnmax);
			} while (exclude &gt; 0 &amp;&amp; baynum === exclude);
			// check to make sure this bay is clear of any other ships
		} while (this.$checkForClearBay(baynum, station, stationIndex) === false);

		return baynum;
	}

	//-------------------------------------------------------------------------------------------------------------
	// check if this docking bay number has been used at this station
	this.$checkForClearBay = function $checkForClearBay(baynum, station, stationIndex) {
		var dta = this._systemDockingData[system.ID][station.name + &quot;_&quot; + stationIndex];
		if (dta &amp;&amp; dta.length &gt; 0) {
			for (var i = 0; i &lt; dta.length; i++) {
				if (dta[i].dockingBay === baynum) return false;
			}
		}
		return true;
	}

	//-------------------------------------------------------------------------------------------------------------
	// these docking bay code functions are used in isolation, after the main populator has added all the docked ships
	// this is to prevent timeout issues during the main populator routine.

	//-------------------------------------------------------------------------------------------------------------
	// add missing docking bay codes to docked ships
	this.$addBayCodes = function $addBayCodes(station) {
		if (this._debug &amp;&amp; this._logPopulatorType &gt; 0) log(this.name, &quot;Adding docking bay codes&quot;);
		var idx = this.$getStationIndex(station);
		// check station has traffic and for which we will be possibly showing docked ship info...
		if (station.hasNPCTraffic &amp;&amp; worldScripts.StationDockControl_Interface.$checkStationRoleForView(station)) {
			// create the list of available docking bay codes for this station
			if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) log(this.name, &quot;Prepopulating docking bay codes for &quot; + station.name + &quot; (index &quot; + idx + &quot;)&quot;);
			this.$populateStationBayCodes(station);

			// add a docking bay code to each vessel
			if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) log(this.name, &quot;Applying docking bay codes to data&quot;);
			this.$applyCodesToStation(station, idx);
		}
		if (this._debug &amp;&amp; this._logPopulatorType &gt;= 2) log(this.name, &quot;Adding docking bay codes complete&quot;);
	}

	//-------------------------------------------------------------------------------------------------------------
	// adds docking bay codes to station data in bulk
	this.$applyCodesToStation = function $applyCodesToStation(station, stnIndex) {
		var bay = 0;
		if (!this._systemDockingData[system.ID]) return;
		var dta = this._systemDockingData[system.ID][station.name + &quot;_&quot; + stnIndex];
		if (dta &amp;&amp; dta.length &gt; 0) {
			for (var j = 0; j &lt; dta.length; j++) {
				var item = dta[j];
				if (item.dockingBay === &quot;&quot;) {

					var found = false;
					do {
						bay += 1;
						if (this._stationBayCodes[bay] !== &quot;&quot;) {
							item.dockingBay = this._stationBayCodes[bay];
							found = true;
						}
					} while (found === false);
				}
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// we&#39;re doing this for performance reasons - it&#39;s faster to have all the codes pre-entered, and then cross them off
	// than to check each one every time
	this.$populateStationBayCodes = function $populateStationBayCodes(station) {
		var stnmax = parseInt(station.mass / 800000);
		this._stationBayCodes = new Array(stnmax);
		for (var i = 0; i &lt; stnmax; i++) {
			this._stationBayCodes[i] = i + 1;
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// updates the _docking array with the list of currently docking ships
	this.$updateShipsDocking = function $updateShipsDocking(station) {
		function compare(a, b) {
			if (a.shipClassName &lt; b.shipClassName) return -1;
			if (a.shipClassName &gt; b.shipClassName) return 1;
			return 0;
		}
		this._docking.length = 0;
		this._docking = this.$getShipsDocking(station);
		// we going to sort the list by classname, as we don&#39;t know (and can&#39;t know) the order ships will dock,
		// so sorting by class is as good a sort as any
		this._docking.sort(compare);
	}

	//-------------------------------------------------------------------------------------------------------------
	// occasionally the shipUniqueName returns &quot;&quot; even though it&#39;s really there. In that instance, pull the unique name out of the display name
	this.$getShipUniqueName = function $getShipUniqueName(displayName, shipClassName) {
		return displayName.replace(shipClassName + &quot;: &quot;, &quot;&quot;);
	}

	//-------------------------------------------------------------------------------------------------------------
	// checks that the primary role of a ship is in our list of controlled roles.
	this.$roleIsAllowed = function $roleIsAllowed(primaryRole) {
		if (this._controlledRoles.indexOf(primaryRole) !== -1) return true;
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------
	// checks the additional array for any extra roles we might have come across
	this.$roleIsAllowedAdditional = function $roleIsAllowedAdditional(primaryRole) {
		if (this._additionalRoles.indexOf(primaryRole) !== -1) return true;
		return false;
	}

	//-------------------------------------------------------------------------------------------------------------
	// assesses the current state of the station dock. Logic is:
	// If 1 or more ships are trying to dock, and there&#39;s either more than 4 ships in the launch queue already, or theres more than 4 ships trying to dock,
	// and there are ships within 3 minutes of departure,
	// bump all station traffic back 90 seconds.
	this.$assessStationDocks = function $assessStationDocks() {
		if (this._stationIndexesLoaded === false) return; // no point doing the assessment if the indexes aren&#39;t loaded
		if (this._debug &amp;&amp; this._logLaunchType &gt; 0) log(this.name, &quot;Assessing station docks&quot;);
		if (this._systemDockingData[system.ID] == null) {
			log(this.name, &quot;!!NOTE: No data for system found! Unable to assess docks. Resetting data entry for system.&quot;);
			this._systemDockingData[system.ID] = {};
			//return;
		}
		var stns = system.stations;
		stns.forEach(function (station) {
			if (station.hasNPCTraffic &amp;&amp; this.$checkStationRoleForNoTraffic(station) === false) {
				var docking = 0;
				var queue = 0;
				// how many ships are already in the launch queue?
				for (var i = 0; i &lt; station.subEntities.length; i++) {
					var subent = station.subEntities[i];
					if (subent.isDock) {
						docking += subent.dockingQueueLength;
						queue += subent.launchingQueueLength;
					}
				}
				// if there&#39;s more than 4, check the number of ships about to launch
				if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, station.name + &quot; inbound length: &quot; + docking);
				if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, station.name + &quot; launch queue length: &quot; + queue);
				if (docking &gt;= 1 &amp;&amp; (queue &gt;= 4 || docking &gt; 4)) {
					var idx = this.$getStationIndex(station);
					var dta = this._systemDockingData[system.ID][station.name + &quot;_&quot; + idx];
					var found = false;
					if (dta &amp;&amp; dta.length &gt; 0) {
						// count ships less then 3 minutes from departure
						for (var i = 0; i &lt; dta.length; i++) {
							//if (dta[i].departureTime - clock.adjustedSeconds &lt;= 180) {
							if (dta[i].departureTime &lt;= 3) {
								found = true;
								break;
							}
						}
					}
					if (!dta &amp;&amp; this._lateStations.indexOf(station) === -1) {
						// no data? add this station to the late station list so it can be repopulated
						this._lateStations.push(station);
						//log(this.name, &quot;adding last station &quot; + station);
					}
					if (this._debug &amp;&amp; this._logLaunchType === 2) log(this.name, station.name + &quot;(&quot; + idx + &quot;) pending launch found: &quot; + found);
					if (found) this.$bumpStationTraffic(station, idx);
				} // if docking &gt;= 1 &amp;&amp; queue &gt;= 4
			} // if station has NPC traffic...
		}, this);
	}

	//-------------------------------------------------------------------------------------------------------------
	// adds 90 seconds to all the ships at a particular station
	this.$bumpStationTraffic = function $bumpStationTraffic(station, stnIndex) {
		if (this._debug &amp;&amp; this._logLaunchType &gt; 0) log(this.name, &quot;** Bumping traffic at &quot; + station.name + &quot;(&quot; + stnIndex + &quot;) **&quot;);
		var dta = this._systemDockingData[system.ID][station.name + &quot;_&quot; + stnIndex];
		if (dta &amp;&amp; dta.length &gt; 0) {
			for (var i = 0; i &lt; dta.length; i++) {
				var item = dta[i];
				if (item.departureTime &gt; 0) {
					item.departureTime += 2;
					item.lastChange = clock.adjustedSeconds;
				}
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// writes the Oolite populator outgoing factors to the log
	this.$logOolitePopulatorOutgoingFactors = function $logOolitePopulatorOutgoingFactors() {
		var w = worldScripts[&quot;oolite-populator&quot;];
		log(this.name, &quot;Populator outgoing frequency values for &quot; + system.name + &quot; (&quot; + system.ID + &quot;):&quot;);
		log(this.name, &quot;trader-freighters: &quot; + w.$repopulatorFrequencyOutgoing.traderFreighters);
		log(this.name, &quot;trader-couriers:   &quot; + w.$repopulatorFrequencyOutgoing.traderCouriers);
		log(this.name, &quot;trader-smugglers:  &quot; + w.$repopulatorFrequencyOutgoing.traderSmugglers);
		log(this.name, &quot;assassin:          &quot; + w.$repopulatorFrequencyOutgoing.assassins);
		log(this.name, &quot;shuttle:           &quot; + (0.005 * system.info.techlevel));
		log(this.name, &quot;pirate-ind:        &quot; + w.$repopulatorFrequencyOutgoing.pirateIndependents);
		log(this.name, &quot;pirate-light:      &quot; + w.$repopulatorFrequencyOutgoing.pirateLightPacks);
		log(this.name, &quot;pirate-medium:     &quot; + w.$repopulatorFrequencyOutgoing.pirateMediumPacks);
		log(this.name, &quot;pirate-heavy:      &quot; + w.$repopulatorFrequencyOutgoing.pirateHeavyPacks);
		log(this.name, &quot;hunter-light:      &quot; + w.$repopulatorFrequencyOutgoing.hunterLightPacks);
		log(this.name, &quot;hunter-medium:     &quot; + w.$repopulatorFrequencyOutgoing.hunterMediumPacks);
		log(this.name, &quot;hunter-heavy:      &quot; + w.$repopulatorFrequencyOutgoing.hunterHeavyPacks);
	}

	//-------------------------------------------------------------------------------------------------------------
	// writes the details of the selected record to the log
	this.$writeDataToLog = function $writeDataToLog(record, reason) {
		if (typeof record === &quot;undefined&quot;) return;

		if (reason.indexOf(&quot;Docking ship&quot;) &gt;= 0) {
			if (this._logDockingType === 0) return;
		}
		if (reason.indexOf(&quot;Launching ship&quot;) &gt;= 0) {
			if (this._logLaunchType === 0) return;
		}

		log(this.name, &quot;=========================================================&quot;);
		log(this.name, reason + &quot;:&quot;);
		log(this.name, &quot;---------------------------------------------------------&quot;);

		log(this.name, &quot;System:             &quot; + record.system);
		log(this.name, &quot;Station:            &quot; + record.station);
		log(this.name, &quot;Station index:      &quot; + record.stationIndex);
		log(this.name, &quot;Ship name:          &quot; + record.shipName);
		log(this.name, &quot;Ship type:          &quot; + record.shipType);
		log(this.name, &quot;Ship DataKey:       &quot; + record.shipDataKey);
		log(this.name, &quot;Ship personality:   &quot; + record.personality);
		log(this.name, &quot;Primary role:       &quot; + record.primaryRole);

		if (reason.indexOf(&quot;Docking ship&quot;) &gt;= 0) {
			if (this._logDockingType === 1) return;
		}
		if (reason.indexOf(&quot;Launching ship&quot;) &gt;= 0) {
			if (this._logLaunchType === 1) return;
		}

		log(this.name, &quot;AI Name:            &quot; + record.shipAI);
		log(this.name, &quot;Accuracy:           &quot; + record.accuracy);
		log(this.name, &quot;Equipment:          &quot; + record.equipment);
		log(this.name, &quot;Heat insulation:    &quot; + record.heatInsulation);
		log(this.name, &quot;Home system:        &quot; + record.homeSystem);
		log(this.name, &quot;Bounty:             &quot; + record.bounty);
		log(this.name, &quot;Escort name:        &quot; + record.escortName);
		log(this.name, &quot;Is escort leader:   &quot; + record.escortLeader);
		log(this.name, &quot;Group name:         &quot; + record.groupName);
		log(this.name, &quot;Is group leader:    &quot; + record.groupLeader);
		log(this.name, &quot;Destination:        &quot; + record.destinationSystem);
		log(this.name, &quot;Intra-system dest:  &quot; + (record.destination ? record.destination : &quot;&quot;));
		log(this.name, &quot;Destination hidden: &quot; + record.destinationHidden);
		log(this.name, &quot;Goods:              &quot; + record.goods);
		log(this.name, &quot;Dock time:          &quot; + record.dockTime);
		log(this.name, &quot;Docking bay:        &quot; + record.dockingBay);
		log(this.name, &quot;Departure time:     &quot; + record.departureTime);
		log(this.name, &quot;Departure seconds:  &quot; + record.departureSeconds);
		log(this.name, &quot;Pilot name:         &quot; + record.pilotName);
		log(this.name, &quot;Pilot description:  &quot; + record.pilotDescription);
		log(this.name, &quot;Pilot home system:  &quot; + record.pilotHomeSystem);
		log(this.name, &quot;Pilot species:      &quot; + record.pilotSpecies);
		log(this.name, &quot;Pilot legal status: &quot; + record.pilotLegalStatus);
		log(this.name, &quot;Pilot insurance:    &quot; + record.pilotInsurance);
		log(this.name, &quot;Last change:        &quot; + record.lastChange);
	}

	//-------------------------------------------------------------------------------------------------------------
	// writes a short version of the data record to the log
	this.$writeShortDataToLog = function $writeShortDataToLog(record) {
		log(this.name, &quot;Ship details: &quot; + record.shipType + (record.shipName !== &quot;&quot; ? &quot;: &quot; + record.shipName : &quot;&quot;) + &quot; (&quot; + record.shipDataKey + &quot;) -- &quot; + record.primaryRole);
	}

	//-------------------------------------------------------------------------------------------------------------
	// get a random station from one of the ones in the system, excluding the origin station
	this.$getRandomSystemLocation = function $getRandomSystemLocation(originStation) {
		// pick the planet as the destination
		if (Math.random() &lt; 0.2) return &quot;Planet|0&quot;;

		if (this._shuttleDest == null) this._shuttleDest = this.$getShuttleDestinations();

		var sel = -1;
		var max_dist = 0;
		var min_dist = -1;
		var max_id = -1;
		var min_id = -1;
		var dist = 0;

		// only do the distance checks if there are more than two stations in system
		if (this._shuttleDest.length &gt; 2) {
			for (var i = 0; i &lt; this._shuttleDest.length; i++) {
				var dest = this._shuttleDest[i];
				if (dest.position) {
					dist = originStation.position.distanceTo(dest);
					if (dist &gt; max_dist) {
						max_dist = dist;
						max_id = i;
					}
					if ((min_dist !== -1 &amp;&amp; dist &lt; min_dist) || min_dist === -1) {
						min_dist = dist;
						min_id = i;
					}
				}
			}
		}
		var count = 0;

		do {
			sel = this.$rand(this._shuttleDest.length) - 1;
			if (this._shuttleDest[sel] === originStation) sel = -1;
			// if this is the most distance place in the region, make it less likely as a destination
			if (sel &gt;= 0 &amp;&amp; sel === max_id &amp;&amp; Math.random() &lt; 0.9) sel = -1;
			// if it&#39;s not the closest or the furthest, reduce the chance, to increase the chance that the closest stations get more traffic
			if (sel &gt;= 0 &amp;&amp; sel !== min_id &amp;&amp; Math.random() &lt; 0.4) sel = -1;

			// keep track over home many times we go through this loop
			count += 1;
			// if we hit the limit, default to the planet
			if (count &gt;= 10) return &quot;Planet|0&quot;;
		} while (sel === -1);

		var idx = this.$getStationIndex(this._shuttleDest[sel]);
		return this._shuttleDest[sel].name + &quot;|&quot; + idx;
	}

	//-------------------------------------------------------------------------------------------------------------
	// convert a &quot;station|index&quot; value into the actual station location
	this.$convertSystemLocationToPosition = function $convertSystemLocationToPosition(location) {
		var items = location.split(&quot;|&quot;);
		var stnName = items(0);
		var idx = parseInt(items(1));

		if (stnName !== &quot;Planet&quot;) {
			dest = this.$getStationFromName(shpName, idx);
			if (dest) {
				return dest.position;
			} else {
				// station mustn&#39;t exist anymore -- return null
				return null;
			}
		} else {
			// return the planetary coordinates
			return null;
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// compiles list of stations we can send shuttles to
	this.$getShuttleDestinations = function $getShuttleDestinations() {
		var stns = system.stations;
		var dest = [];
		// only add stations not in the &quot;trafficNone&quot; list and aren&#39;t police ships
		for (var i = 0; i &lt; stns.length; i++) {
			var stn = stns[i];
			if (this.$checkShuttleDestForNoTraffic(stn) === false &amp;&amp; !stn.isPolice) {
				dest.push(stn);
			}
		}
		return dest;
	}

	//-------------------------------------------------------------------------------------------------------------
	// reduces the size of an array by removing duplicates
	this.$compactArray = function $compactArray(array) {
		// get a distinct list of items
		var items = [];
		for (var i = 0; i &lt; array.length; i++) {
			var item = array[i];
			if (item != null &amp;&amp; item !== &quot;&quot; &amp;&amp; typeof item != &quot;undefined&quot;) {
				if (items.indexOf(item) === -1) items.push(item);
			}
		}
		// return the new array
		return items;
	}

	//-------------------------------------------------------------------------------------------------------------
	// removes empty data elements from the main dataset
	this.$dataCleanup = function $dataCleanup() {
		// look for empty data for a system, but only in small batches so we don&#39;t cause any slowdowns
		for (var i = this._cleanUp; i &lt; (this._cleanUp + 5); i++) {
			if (i &gt;= 256) {
				if (this._debug) log(this.name, &quot;cleanup complete!&quot;);
				this._cleanUpComplete = true;
				break;
			}
			if (i !== system.ID &amp;&amp; this._systemDockingData[i]) {
				var dta = JSON.stringify(this._systemDockingData[i]);
				// if there&#39;s no mention of &quot;system&quot;, there is no docking data for that system, so delete the entire entry
				if (dta &amp;&amp; dta.indexOf(&quot;system:&quot;) === -1) {
					if (this._debug) log(this.name, &quot;cleaning up system &quot; + i);
					delete this._systemDockingData[i];
				}
			}
		}
		if (this._cleanUpComplete === false) this._cleanUp += 5;
	}

	//-------------------------------------------------------------------------------------------------------------
	// removes all but the data for systems 1 and 2
	this.$dataPurge = function $dataPurge(id1, id2) {
		var keys = Object.keys(this._systemDockingData);
		for (var i = 0; i &lt; keys.length; i++) {
			if (parseInt(keys[i]) != id1 &amp;&amp; parseInt(keys[i]) != id2) {
				delete this._systemDockingData[keys[i]];
			}
		}
	}

	//-------------------------------------------------------------------------------------------------------------
	// by cag for speed improvements instead of using &quot;indexOf&quot;
	this.$indexInList = function $indexInList(item, list) { // for arrays only
		var k = list.length;
		while (k--) {
			if (list[k] === item) return k;
		}
		return -1;
	}

}).call(this);</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/stationdockcontrol_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;StationDockControl_Conditions&quot;;
this.author = &quot;phkb&quot;;
this.copyright = &quot;2015 phkb&quot;;
this.description = &quot;Condition script for determining whether the SDFC Hack Chip can be purchased&quot;;
this.licence = &quot;CC BY-NC-SA 3.0&quot;;

this._includeRoles = [&quot;rockhermit&quot;, &quot;rockhermit-chaotic&quot;, &quot;rockhermit-pirate&quot;, &quot;anarchies_salvage_gang&quot;, &quot;anarchies_hacker_outpost&quot;];

//-------------------------------------------------------------------------------------------------------------
this.allowAwardEquipment = function (equipment, ship, context) {

	// always return true for scripted install
	if (context === &quot;scripted&quot;) return true;

	if (context != &quot;purchase&quot;) return false;
	// check the techlevel of the system
	if (system.info.techlevel &lt; 8) return false;
	// check the government type: all anarchies, most feudals, some multi-govs.
	if ((2 - system.info.government) / 2 &lt; system.scrambledPseudoRandomNumber(system.ID)) return false;

	var p = player.ship;
	var stn = p.dockedStation;
	var found = false;

	// check the station type
	for (var i = 0; i &lt; this._includeRoles.length; i++) {
		if (stn.hasRole(this._includeRoles[i])) found = true;
	}
	// if we get here, it&#39;s ok to buy
	return found;
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/stationdockcontrol_escortlaunch.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;StationDockControl_EscortLaunch&quot;;
this.author = &quot;phkb&quot;;
this.copyright = &quot;2015 phkb&quot;;
this.description = &quot;Script to attach to a ship after launch to get it to escort a mothership&quot;;
this.licence = &quot;CC BY-NC-SA 3.0&quot;;

/*
	This script is attached to the mothership and escort ships. occasionally a mothership will launch well ahead of some of its escorts
	(due to docking queue pressure). When that happens, a mothership can enter hyperspace before an escort even launches.
	This script will attach escorts to the mothership in one of two ways:
	1. If the mothership launches ahead of the escort, the mothership will use the &quot;this._escorts&quot; array to attach the escorts
	2. As a backup, the escort itself will attempt to attach itself after launch
	Hopefully this will cover all scenarios for escort launches and ensure no escort is left behind
*/

//-------------------------------------------------------------------------------------------------------------
// add an escort to the list
this.$addEscort = function $addEscort(escortShip) {
	if (this.ship.script._done) return false;
	if (!this.ship.script._escorts) this.ship.script._escorts = [];
	this.ship.script._escorts.push(escortShip);
	return true;
}

//-------------------------------------------------------------------------------------------------------------
this.$removeEscort = function $removeEscort(escortShip) {
	if (!this.ship.script._escorts) this.ship.script._escorts = [];
	for (var i = this.ship.script._escorts.length - 1; i &gt;= 0; i--) {
		if (this.ship.script._escorts[i] === escortShip) {
			this.ship.script._escorts.splice(i, 1);
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
this.npc_shipDied = function npc_shipDied(whom, why) {
	if (this.ship.script.$sdc_hold_shipDied) this.ship.script.$sdc_hold_shipDied(whom, why);
	if (this.ship.script._timer &amp;&amp; this.ship.script._timer.isRunning) this.ship.script._timer.stop();
}

//-------------------------------------------------------------------------------------------------------------
this.npc_shipWillEnterWormhole = function npc_shipWillEnterWormhole() {
	if (this.ship.script.$sdc_hold_shipWillEnterWormhole) this.ship.script.$sdc_hold_shipWillEnterWormhole();
	if (this.ship.script._timer &amp;&amp; this.ship.script._timer.isRunning) this.ship.script._timer.stop();
}

//-------------------------------------------------------------------------------------------------------------
// used for mothership and escort ship launches. One of these should fire and cancel the other out.
this.npc_shipLaunchedFromStation = function npc_shipLaunchedFromStation(station) {
	var s = this.ship;
	if (s.script.$sdc_hold_shipLaunchedFromStation) s.script.$sdc_hold_shipLaunchedFromStation(station);

	var ret = false;
	// pull down the debug settings from the master function
	var w = worldScripts.StationDockControl;
	var debug = w._debug;
	var l_debug = w._logLaunchType;

	if (s.script._mothership &amp;&amp; s.script._done === false) {
		// type 1 - escort launch
		if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, s.displayName + &quot;: escort launch successful&quot;);

		// offer to escort the mothership
		if (s.script._mothership &amp;&amp; s.script._mothership.isValid &amp;&amp; s.script._mothership.status === &quot;STATUS_IN_FLIGHT&quot;) {
			ret = s.offerToEscort(s.script._mothership);
			if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, s.displayName + &quot;: found leader (&quot; + s.script._mothership.displayName + &quot;) - offer to escort: &quot; + ret);
		}

		// remove this ship from the mothership launch array if it was successfully added
		if (ret === true) {
			if (s.script._mothership.script.$removeEscort) s.script._mothership.script.$removeEscort(s);
		}

		// report on any errors
		if (ret === false) {
			if (!s.script._mothership) log(this.name, &quot;!!ERROR: Mothership is null&quot;);
			if (s.script._mothership &amp;&amp; s.script._mothership.isValid === false) log(this.name, &quot;!!ERROR: Mothership is invalid&quot;);
			if (s.script._mothership &amp;&amp; s.script._mothership.isValid &amp;&amp; s.script._mothership.status !== &quot;STATUS_IN_FLIGHT&quot;) {
				if (s.script._mothership.status !== &quot;STATUS_LAUNCHING&quot;) log(this.name, &quot;!!ERROR: Mothership is not in flight: &quot; + s.script._mothership.status);
				if (s.script._mothership.status === &quot;STATUS_LAUNCHING&quot;) {
					if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, &quot;!!NOTE: Mothership is launching -- setting timer to await launch&quot;);
					if (s.script._timer &amp;&amp; s.script._timer.isRunning) s.script._timer.stop();
					s.script._timer = new Timer(this, s.script.$attachEscort, 2, 0);
					return;
				}
			}
			if (s.status === &quot;STATUS_IN_FLIGHT&quot; &amp;&amp; s.script._mothership &amp;&amp; s.script._mothership.isValid &amp;&amp; s.script._mothership.status === &quot;STATUS_IN_FLIGHT&quot;) {
				if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, &quot;!!NOTE: Escort and mothership are in flight -- setting timer to try again&quot;);
				if (s.script._timer &amp;&amp; s.script._timer.isRunning) s.script._timer.stop();
				s.script._timer = new Timer(this, s.script.$attachEscort, 2, 0);
				return;
			}

			log(this.name, &quot;!!ERROR: Ship launch script failed to escort mothership! &quot; + (s.script._mothership &amp;&amp; s.script._mothership.isValid ? &quot;(Mthr: &quot; + s.script._mothership.displayName + &quot; (&quot; + s.script._mothership.status + &quot;), &quot; : &quot;&quot;) + &quot;This: &quot; + s.displayName + &quot; (&quot; + s.status + &quot;)&quot;);
		}

	} else if (s.script._escorts &amp;&amp; s.script._escorts.length &gt; 0 &amp;&amp; s.script._done === false) {
		// type 2 - mothership launch
		if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, s.displayName + &quot;: mothership launch successful&quot;);

		if (s.isValid &amp;&amp; s.status === &quot;STATUS_IN_FLIGHT&quot;) {
			if (!s.script._escorts) s.script._escorts = [];
			for (var i = 0; i &lt; s.script._escorts.length; i++) {
				ret = s.script._escorts[i].offerToEscort(s);
				if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, s.script._escorts[i].displayName + &quot;: found leader (&quot; + s.displayName + &quot;) - offer to escort: &quot; + ret);
				// turn off the escorts&#39;s individual launch script
				if (ret === true) {
					s.script._escorts[i].script._done = true;
				}
				// report on any errors
				if (ret === false) {
					if (s &amp;&amp; s.status === &quot;STATUS_LAUNCHING&quot;) {
						if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, &quot;!!NOTE: Mothership is still launching -- setting timer to try again&quot;);
						if (s.script._timer &amp;&amp; s.script._timer.isRunning) s.script._timer.stop();
						s.script._timer = new Timer(this, s.script.$attachEscort, 2, 0);
						return;
					}
					if (s &amp;&amp; s.isValid &amp;&amp; s.status !== &quot;STATUS_IN_FLIGHT&quot;) log(this.name, &quot;!!ERROR: Mothership is not in flight: &quot; + s.status);
					log(this.name, &quot;!!ERROR: Mothership launch script failed to add escort! &quot; + s.displayName + &quot; (&quot; + s.status + &quot;, &quot; + s.script._escorts.length + &quot;), Escort: &quot; + s.script._escorts[i].displayName + &quot; (&quot; + s.script._escorts[i].status + &quot;)&quot;);
				}
			}
		}
	}

	s.script._done = true;

	// cleanup
	s.script._mothership = null;
	if (s.script._escorts) s.script._escorts.length = 0;
	delete s.script._timer;
	delete s.shipLaunchedFromStation;
	if (s.script.$sdc_hold_shipLaunchedFromStation) s.script.shipLaunchedFromStation = $sdc_hold_shipLaunchedFromStation;
}

//-------------------------------------------------------------------------------------------------------------
this.$attachEscort = function $attachEscort() {
	var s = this.ship;
	var ret = false;
	var w = worldScripts.StationDockControl;
	var debug = w._debug;
	var l_debug = w._logLaunchType;

	if (!s || s.isValid === false) return;
	if (s.script._done === true) return;

	if (s.script._mothership &amp;&amp; s.script._mothership.isValid &amp;&amp; s.script._mothership.status === &quot;STATUS_IN_FLIGHT&quot;) {
		ret = s.offerToEscort(s.script._mothership);
		if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, s.displayName + &quot;: (timer) found leader (&quot; + s.script._mothership.displayName + &quot;) - offer to escort: &quot; + ret);
	}
	if (s.script._escorts &amp;&amp; s.script._escorts.length &gt; 0 &amp;&amp; s.status === &quot;STATUS_IN_FLIGHT&quot;) {
		for (var i = 0; i &lt; s.script._escorts.length; i++) {
			ret = s.script._escorts[i].offerToEscort(s);
			if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, s.script._escorts[i].displayName + &quot;: (timer) found leader (&quot; + s.displayName + &quot;) - offer to escort: &quot; + ret);
			// turn off the escorts&#39;s individual launch script
			if (ret === true) {
				s.script._escorts[i].script._done = true;
			}
			// report on any errors
			if (ret === false) {
				if (s &amp;&amp; s.status === &quot;STATUS_LAUNCHING&quot;) {
					if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, &quot;!!NOTE: Escorts still launching -- setting timer to try again&quot;);
					if (s.script._timer &amp;&amp; s.script._timer.isRunning) s.script._timer.stop();
					s.script._timer = new Timer(this, s.script.$attachEscort, 2, 0);
				}
				if (s &amp;&amp; s.isValid &amp;&amp; s.status !== &quot;STATUS_IN_FLIGHT&quot;) log(this.name, &quot;!!ERROR: Mothership is not in flight: &quot; + s.status);
				//log(this.name, &quot;!!ERROR: Mothership launch script failed to add escort! &quot; + s.displayName + &quot; (&quot; + s.status + &quot;, &quot; + s.script._escorts.length + &quot;), Escort: &quot; + s.script._escorts[i].displayName + &quot; (&quot; + s.script._escorts[i].status + &quot;)&quot;);
			}
		}
	}

	if (ret === false) {
		if (!s.script._timerCount) s.script._timerCount = 0;
		s.script._timerCount += 1;
		if (s.script._timerCount &lt; 10) {
			delete s.script._timer;
			s.script._timer = new Timer(this, s.script.$attachEscort, 2, 0);
		}
		if (s.script._mothership) {
			if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, s.displayName + &quot;: (timer) awaiting mothership launch - try &quot; + s.script._timerCount);
		} else {
			if (debug &amp;&amp; l_debug &gt;= 2) log(this.name, s.displayName + &quot;: (timer) awaiting mothership/escorts launch - try &quot; + s.script._timerCount);
		}
	} else {
		s.script._done = true;
		// cleanup
		s.script._mothership = null;
		if (s.script._escorts) s.script._escorts.length = 0;
	}
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/stationdockcontrol_hackchip.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;StationDockControl_HackChip&quot;;
this.author = &quot;phkb&quot;;
this.copyright = &quot;2015 phkb&quot;;
this.description = &quot;Script to control the use of the SDC Hack Chip&quot;;
this.licence = &quot;CC BY-NC-SA 3.0&quot;;

this._chipInstalled = false;
this._installTimer = null;
this._installCount = 0;
this._installStation = null;
this._confiscate = false;
this._debug = false;

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function () {
	if (missionVariables.StationDockControl_HackChipCount) this._installCount = missionVariables.StationDockControl_HackChipCount;
	this.$initInterface(player.ship.dockedStation);

	// remove the hack chip from any maintenance emails
	var w = worldScripts.GalCopAdminServices;
	if (w) w._maint_ignore_equip.push(&quot;EQ_SDC_HACK_CHIP&quot;);
}

//-------------------------------------------------------------------------------------------------------------
this.shipDockedWithStation = function (station) {
	if (this._confiscate === true &amp;&amp; station.allegiance === &quot;galcop&quot;) {
		player.ship.removeEquipment(&quot;EQ_SDC_HACK_CHIP&quot;);
		// send an email
		var w = worldScripts.EmailSystem;
		if (w) {
			w.$createEmail({
				sender: &quot;GalCop Security&quot;,
				subject: &quot;Computer systems security breach&quot;,
				date: global.clock.seconds,
				message: &quot;Commander &quot; + player.name + &quot;,\n\nGalCop network specialists had detected the use of an illegal security device while your ship was previously docked in this system. &quot; +
					&quot; This device has now been appropriated.&quot; +
					&quot;\n\nGalCop takes the security of it&#39;s network seriously and it would be prudent to do the same yourself.\n\nGood day, Commander.\n\n&quot; +
					expandDescription(&quot;%N [nom]&quot;) + &quot;\nGalCop Security Officer&quot;
			});
		}
	}
	this.$initInterface(station);
}

//-------------------------------------------------------------------------------------------------------------
this.shipExitedWitchspace = function () {
	// reset the install counter
	this._installCount = 0;
	this._confiscate = false;
}

//-------------------------------------------------------------------------------------------------------------
this.playerBoughtEquipment = function (equipmentKey) {
	if (equipmentKey === &quot;EQ_SDC_HACK_CHIP&quot;) {
		this.$initInterface(player.ship.dockedStation);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.playerWillSaveGame = function () {
	missionVariables.StationDockControl_HackChipCount = this._installCount;
	/* Note: We&#39;re not storing the state of the hack chip. This means, if the player installs the hack chip and then saves the game, when they
	restore the game the chip won&#39;t be installed. However, the number of times they have installed the chip is captured.
	This is probably the easier way of limiting any save game abuse, without having to store the state of the timer.
	*/
}

//-------------------------------------------------------------------------------------------------------------
this.shipLaunchedFromStation = function (station) {
	if (this._chipInstalled === true) {
		// there&#39;s a couple of options here, based on how the hack chip would actually be installed
		// if the hack ship is installed inside your ship, then launching would simplky uninstalled it
		// if the hack chip is installed at a computer port outside your ship, then launching would leave it behind
		// for the moment i&#39;m going with the second option
		this._chipInstalled = false;
		player.ship.removeEquipment(&quot;EQ_SDC_HACK_CHIP&quot;);
		this._installTimer.stop();
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$initInterface = function $initInterface(station) {
	if (player.ship.equipmentStatus(&quot;EQ_SDC_HACK_CHIP&quot;) === &quot;EQUIPMENT_OK&quot; &amp;&amp; (station.allegiance === &quot;galcop&quot; || this._debug === true)) {
		station.setInterface(this.name, {
			title: &quot;Install SDC hack chip&quot;,
			category: &quot;Ship Systems&quot;,
			summary: &quot;Installs the SDC hack chip into the GalCop ship systems interface terminal.&quot;,
			callback: this.$installHackChip.bind(this)
		});
	} else {
		this.$removeInterface(station);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$removeInterface = function $removeInterface(station) {
	station.setInterface(this.name, null);
}

//-------------------------------------------------------------------------------------------------------------
this.$installHackChip = function $installHackChip() {
	this._chipInstalled = true;
	// switch the interface display
	player.ship.dockedStation.setInterface(this.name, {
		title: &quot;Remove SDC hack chip&quot;,
		category: &quot;Ship Systems&quot;,
		summary: &quot;Removes the SDC hack chip from the GalCop ship systems interface terminal.&quot;,
		callback: this.$removeHackChip.bind(this)
	});
	// start a timer
	// calc how long the player has
	var secs = (25 - (this._installCount * 10)) - system.info.techlevel;
	if (secs &lt; 5) secs = 5;

	this._installCount += 1;
	this._installStation = player.ship.dockedStation;

	mission.runScreen({
		screenID: &quot;oolite-sdc-hackchip-summary&quot;,
		title: &quot;SDC Hack Chip&quot;,
		overlay: {
			name: &quot;sdc-unlock.png&quot;,
			height: 546
		},
		message: &quot;The SDC Hack Chip has been installed successfully&quot;,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;
	});

	if (this._installTimer &amp;&amp; this._installTimer.isRunning) this._installTimer.stop();
	this._installTimer = new Timer(this, this.$installTimer, secs, 0);
}

//-------------------------------------------------------------------------------------------------------------
this.$installTimer = function $installTimer() {
	// caught!!
	this._chipInstalled = false;
	this._installTimer = null;
	// remove the hack chip (if we&#39;re still docked)
	if (player.alertCondition === 0) {
		player.ship.removeEquipment(&quot;EQ_SDC_HACK_CHIP&quot;);
		this.$removeInterface(this._installStation);
	}
	// fine the player
	player.ship.setBounty(player.bounty + 30, &quot;illegal activity&quot;);
	var fine_amount = 5000;
	if (player.credits &gt; fine_amount) {
		player.credits -= fine_amount;
	} else {
		fine_amount = player.credits;
		player.credits = 0;
	}
	var w = worldScripts.EmailSystem;
	if (player.alertCondition !== 0) {
		// confiscate the chip if the play docks in the same system
		this._confiscate = true;
		this._installStation.commsMessage(&quot;GalCop security breach detected! You have been fined and your bounty increased!&quot;, player.ship);
		if (w) {
			w.$createEmail({
				sender: &quot;GalCop Security&quot;,
				subject: &quot;Computer systems security breach&quot;,
				date: global.clock.seconds,
				message: &quot;Commander &quot; + player.name + &quot;,\n\nGalCop network specialists detected a security breach and traced the packet data to an &quot; +
					&quot;illegal device attached to a computer terminal in your vessel while you docked in &quot; + system.info.name + &quot;. You have been given a bounty and fined &quot; + formatCredits(fine_amount, true, true) +
					&quot;.\n\nGalCop takes the security of it&#39;s network seriously and it would be prudent to do the same yourself.\n\nGood day, Commander.\n\n&quot; +
					expandDescription(&quot;%N [nom]&quot;) + &quot;\nGalCop Security Officer&quot;
			});
		}
	} else {
		player.consoleMessage(&quot;GalCop security breach detected! You have been fined, your bounty has been increased, and the device confiscated!&quot;);
		// send an email, if installed
		if (w) {
			w.$createEmail({
				sender: &quot;GalCop Security&quot;,
				subject: &quot;Computer systems security breach&quot;,
				date: global.clock.seconds,
				message: &quot;Commander &quot; + player.name + &quot;,\n\nGalCop network specialists detected a security breach and traced the packet data to an &quot; +
					&quot;illegal device attached to a computer terminal in your vessel. This device has been appropriated, and you have been given a bounty and fined &quot; + formatCredits(fine_amount, true, true) +
					&quot;.\n\nGalCop takes the security of it&#39;s network seriously and it would be prudent to do the same yourself.\n\nGood day, Commander.\n\n&quot; +
					expandDescription(&quot;%N [nom]&quot;) + &quot;\nGalCop Security Officer&quot;
			});
		}
	}

}

//-------------------------------------------------------------------------------------------------------------
this.$removeHackChip = function $removeHackChip() {
	this._installTimer.stop();
	this._chipInstalled = false;
	this.$initInterface(player.ship.dockedStation);
	mission.runScreen({
		screenID: &quot;oolite-sdc-hackchip-summary&quot;,
		title: &quot;SDC Hack Chip&quot;,
		overlay: {
			name: &quot;sdc-lock.png&quot;,
			height: 546
		},
		message: &quot;The SDC Hack Chip has been removed successfully&quot;,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;
	});
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/stationdockcontrol_interface.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;StationDockControl_Interface&quot;;
this.author = &quot;phkb&quot;;
this.copyright = &quot;2015 phkb&quot;;
this.description = &quot;Controls the Interfaces (F4) traffic control screen.&quot;;
this.licence = &quot;CC BY-NC-SA 3.0&quot;;

this._maxpage = 0; // total number of pages available for display
this._curpage = 1; // the current page being displayed
this._msRows = 16; // rows to display on the mission screen
this._msCols = 32; // columns to display on the mission screen
this._showAll = false; // flag that controls whether the short or long list of ships is shown
this._displayMode = 0; // controls the type of display on the Traffic Control screen (0 = dock list, 1 = individual ship)
this._selectedItem = {}; // item selected on the Traffic Control screen
this._selectedIndex = 0; // the array index of the selected item
this._sortCol = &quot;departureTime&quot;; // default sort column
this._sortDir = 1; // default sort direction
this._rsnInstalled = false; // indicates whether randomshipnames OXP is installed
this._playerDockingBay = &quot;&quot;; // stores the docking bay assigned to the player
this._playerDockTime = 0; // stores the time the player docked at the station
this._initialPageLimit = 3; // sets the initial number of pages that will be shown when the list is first opened
this._refreshPageTime = 20; // number of seconds between page refreshes, when the view is open
this._rsnInMFD = true;

this._viewing = []; // subset of main array used for viewing docked vessels on the interface screen
this._SDC = null; // link to the main station dock control worldscript
this._debug = false; // controls output of information to the log. Slaved to StationDockControl._debug
this._selectedStation = null; // the station whose dock list is being viewed. When not in debug mode, this will always be the players docked station.
this._refresh = null; // link to a timer that refreshes the dock list
this._stationModel = false; // controls whether a model of the station is included on the station traffic contorl screen
this._shipModel = true; // controls whether a model of the selected ship is included on the ship information screen
this._spinModel = false; // controls whether the ship model will be spinning or not
this._showDataKey = false; // include the ship&#39;s datakey and personality info on the ship details page
this._showEquipment = false; // include an option to view ship equipment
this._mode = 1; // display mode: 0 = full debug, 1 = standard operations
this._itemColor = &quot;yellowColor&quot;;
this._menuColor = &quot;orangeColor&quot;;
this._exitColor = &quot;yellowColor&quot;;
this._disabledColor = &quot;darkGrayColor&quot;;
this._defaultZoomFactor = 3.6;
this._destViewingRange = 12; // the number of hours until departure time that the destination will be viewable

this._externalMenu = [];

this._sdciConfig = {
	Name: this.name,
	Display: &quot;Interface Options&quot;,
	Alias: &quot;Station Dock Control&quot;,
	Alive: &quot;_sdciConfig&quot;,
	Bool: {
		B0: {
			Name: &quot;_shipModel&quot;,
			Def: true,
			Desc: &quot;Show ship model&quot;
		},
		B1: {
			Name: &quot;_spinModel&quot;,
			Def: false,
			Desc: &quot;Spin ship model&quot;
		},
		B2: {
			Name: &quot;_showDataKey&quot;,
			Def: false,
			Desc: &quot;Show data key&quot;
		},
		B3: {
			Name: &quot;_stationModel&quot;,
			Def: false,
			Desc: &quot;Show station model&quot;
		},
		B4: {
			Name: &quot;_rsnInMFD&quot;,
			Def: true,
			Desc: &quot;Show RSN name in MFD&quot;
		},
	Info: &quot;0 - Shows the ship model when viewing entries.\n1 - Ship models will spin when viewed.\n2 - Displays the shipDataKey when viewing entries.\n3 - Shows the station model when viewing main list.\n4 - Shows RSN ship name in docking MFD&quot;
	},
	SInt: {
		S0: {
			Name: &quot;_mode&quot;,
			Def: 1,
			Min: 0,
			Max: 1,
			Desc: &quot;Display mode&quot;
		},
		Info: &quot;SDC interface display mode. 0 = full debug, 1 = standard (default)&quot;
	},
};

// note: if a station has the &quot;has_npc_traffic&quot; flag set to false, it will override whatever is in this list
// this item controls which station roles will *not* have the &quot;Traffic Control&quot; interface
this._noDockView = [&quot;slaver_base&quot;, &quot;rrs_slaverbase&quot;, &quot;rrs_group_spacestation&quot;, &quot;rrs_astromine&quot;, &quot;rrs-mining-outpost&quot;, &quot;liners_liner&quot;, &quot;navystat&quot;,
	&quot;casinoship&quot;, &quot;astromine&quot;, &quot;random_hits_any_spacebar&quot;, &quot;comczgf&quot;, &quot;thecollector_adck_coriolis-station&quot;, &quot;jaguar_company_base&quot;, &quot;GW-fuel-processor&quot;, &quot;GW-comms-station&quot;,
	&quot;laveAcademy_academy&quot;, &quot;planetFall_surface&quot;, &quot;generationship&quot;, &quot;IST_genship carrier&quot;, &quot;pirate-cove&quot;
];

// default zoom is 3.6
// these values make ships look bigger or smaller, as appropriate
this._zoomOverride = {
	&quot;Adder&quot;: 4.6,
	&quot;Adder (transit)&quot;: 4.6,
	&quot;Adder (civilian)&quot;: 4.6,
	&quot;Adder (military)&quot;: 4.6,
	&quot;Adder (performance)&quot;: 4.6,
	&quot;Anaconda&quot;: 2.3,
	&quot;Anaconda MMS&quot;: 2.3,
	&quot;Anaconda (service)&quot;: 2.3,
	&quot;Anaconda (civilian)&quot;: 2.3,
	&quot;Anaconda (military)&quot;: 2.3,
	&quot;Anaconda (performance)&quot;: 2.3,
	&quot;Aphid&quot;: 3.2,
	&quot;Arafura&quot;: 3,
	&quot;Boa Class Cruiser&quot;: 2.5,
	&quot;Boa Class Cruiser MMS&quot;: 2.5,
	&quot;Boa MkII (transit)&quot;: 2.5,
	&quot;Boa MkII (civilian)&quot;: 2.5,
	&quot;Boa MkII (military)&quot;: 2.5,
	&quot;Boa MkII (service)&quot;: 2.5,
	&quot;Boa&quot;: 2.5,
	&quot;Boa MMS&quot;: 2.5,
	&quot;Boa MkI (service)&quot;: 2.5,
	&quot;Boa MkI (civilian)&quot;: 2.5,
	&quot;Boa MkI (military)&quot;: 2.5,
	&quot;Boa MkI (performance)&quot;: 2.5,
	&quot;Bug&quot;: 4.4,
	&quot;Chameleon&quot;: 3.3,
	&quot;Chopped Cobra&quot;: 3,
	&quot;Cobra Mark I&quot;: 4.6,
	&quot;Cobra MkI (transit)&quot;: 4.6,
	&quot;Cobra MkI (civilian)&quot;: 4.6,
	&quot;Cobra MkI (military)&quot;: 4.6,
	&quot;Cobra MkI (performance)&quot;: 4.6,
	&quot;Cobra Mark II-X&quot;: 4,
	&quot;Cobra Mark III&quot;: 3,
	&quot;Cobra Mark III MMS&quot;: 3,
	&quot;Cobra MkIII (transit)&quot;: 3,
	&quot;Cobra MkIII (civilian)&quot;: 3,
	&quot;Cobra MkIII (military)&quot;: 3,
	&quot;Cobra MkIII (service)&quot;: 3,
	&quot;Cobra Mark III-XT&quot;: 3,
	&quot;Cobra Mark IV&quot;: 2.9,
	&quot;Cobra Mark IV MMS&quot;: 2.9,
	&quot;Cobra Rapier&quot;: 3,
	&quot;Copperhead Mk2&quot;: 3,
	&quot;Cruzer&quot;: 3,
	&quot;D.T.T. Atlas&quot;: 2.5,
	&quot;D.T.T. Cyclops&quot;: 2.5,
	&quot;D.T.T. Kraken&quot;: 2.8,
	&quot;D.T.T. MK-1&quot;: 3.4,
	&quot;D.T.T. Snake Charmer&quot;: 2.7,
	&quot;D.T.T. War Lance&quot;: 3.3,
	&quot;Fer-de-Lance&quot;: 3.3,
	&quot;Fer de Lance (transit)&quot;: 3.3,
	&quot;Fer de Lance (service)&quot;: 3.3,
	&quot;Fer de Lance (military)&quot;: 3.3,
	&quot;Fer de Lance (performance)&quot;: 3.3,
	&quot;Gecko&quot;: 4.2,
	&quot;Gecko (transit)&quot;: 4.2,
	&quot;Gecko (service)&quot;: 4.2,
	&quot;Gecko (military)&quot;: 4.2,
	&quot;Gecko (performance)&quot;: 4.2,
	&quot;Griffin Mk I&quot;: 3.3,
	&quot;Griff Boa Prototype&quot;: 2.5,
	&quot;Hognose&quot;: 4.3,
	&quot;Iguana&quot;: 3.2,
	&quot;Krait&quot;: 4.2,
	&quot;Krait (transit)&quot;: 4.2,
	&quot;Krait (service)&quot;: 4.2,
	&quot;Krait (military)&quot;: 4.2,
	&quot;Krait (performance)&quot;: 4.2,
	&quot;Lira&quot;: 1.9,
	&quot;Mamba Escort&quot;: 4.2,
	&quot;Mamba&quot;: 4.2,
	&quot;Mamba (transit)&quot;: 4.2,
	&quot;Mamba (service)&quot;: 4.2,
	&quot;Mamba (military)&quot;: 4.2,
	&quot;Mamba (performance)&quot;: 4.2,
	&quot;Miner Cobra Mark III&quot;: 3,
	&quot;Mining Transporter&quot;: 4.6,
	&quot;Monitor Mark II&quot;: 3,
	&quot;Monitor&quot;: 3,
	&quot;Moray Medical Boat&quot;: 4.2,
	&quot;Moray (service)&quot;: 4.2,
	&quot;Moray Star Boat&quot;: 4.2,
	&quot;Moray (civilian)&quot;: 4.2,
	&quot;Moray (military)&quot;: 4.2,
	&quot;Mussurana&quot;: 3,
	&quot;Night Adder&quot;: 4.2,
	&quot;Ophidian&quot;: 3,
	&quot;Orbital Shuttle&quot;: 4.6,
	&quot;Pitviper&quot;: 3.4,
	&quot;Pitviper (Vindicator)&quot;: 3.4,
	&quot;Pitviper (Buccaneer)&quot;: 3.4,
	&quot;Pitviper (Bountyhunter)&quot;: 3.4,
	&quot;Pitviper S.E. Beast&quot;: 3.4,
	&quot;Pitviper Mark II&quot;: 3,
	&quot;Python Class Cruiser&quot;: 2.5,
	&quot;Python ET Special&quot;: 2.6,
	&quot;Python ET Special MMS&quot;: 2.6,
	&quot;Python&quot;: 2.5,
	&quot;Python MMS&quot;: 2.5,
	&quot;Python (transit)&quot;: 2.5,
	&quot;Python (civilian)&quot;: 2.5,
	&quot;Python (military)&quot;: 2.5,
	&quot;Python (performance)&quot;: 2.5,
	&quot;Python SG&quot;: 2.5,
	&quot;Python SG-MMS&quot;: 2.5,
	&quot;Python BattleCruiser MMS&quot;: 2.5,
	&quot;Serpent Class Cruiser&quot;: 2.5,
	&quot;Sidewinder Scout Ship&quot;: 4.5,
	&quot;Sidewinder (transit)&quot;: 4.5,
	&quot;Sidewinder (service)&quot;: 4.5,
	&quot;Sidewinder (civilian)&quot;: 4.5,
	&quot;Sidewinder (performance)&quot;: 4.5,
	&quot;Sidewinder Special&quot;: 4.3,
	&quot;Skat&quot;: 3.4,
	&quot;Taxi Cab&quot;: 4.6,
	&quot;Tembo&quot;: 2.2,
	&quot;Transporter&quot;: 4.6,
	&quot;Transporter (civilian)&quot;: 4.6,
	&quot;Transporter (service)&quot;: 4.6,
	&quot;Transporter (military)&quot;: 4.6,
	&quot;Transporter (performance)&quot;: 4.6,
	&quot;Worm&quot;: 4.6,
	&quot;Worm (transit)&quot;: 4.6,
	&quot;Worm (service)&quot;: 4.6,
	&quot;Worm (military)&quot;: 4.6,
	&quot;Worm (performance)&quot;: 4.6,
	&quot;Yasen-N&quot;: 3.2,
	&quot;Yasen-N &#39;Advanced&#39; variant 1&quot;: 3.2,
	&quot;Yasen-N &#39;Advanced&#39; variant 2&quot;: 3.2,
	&quot;Yasen-N &#39;Advanced&#39; variant 3&quot;: 3.2,
	&quot;YellOo Cab&quot;: 4.4,
};

this._trueValues = [&quot;yes&quot;, &quot;1&quot;, 1, &quot;true&quot;, true];

//=============================================================================================================
// system functions
//-------------------------------------------------------------------------------------------------------------
this.startUp = function () {
	this._hudHidden = false;
	this._dockListOpen = false;
}

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function () {
	// register our settings, if Lib_Config is present
	if (worldScripts.Lib_Config) worldScripts.Lib_Config._registerSet(this._sdciConfig);

	if (missionVariables.StationDockControl_ShipModel) this._shipModel = (this._trueValues.indexOf(missionVariables.StationDockControl_ShipModel) &gt;= 0 ? true : false);
	if (missionVariables.StationDockControl_SpinModel) this._spinModel = (this._trueValues.indexOf(missionVariables.StationDockControl_SpinModel) &gt;= 0 ? true : false);
	if (missionVariables.StationDockControl_DataKey) this._showDataKey = (this._trueValues.indexOf(missionVariables.StationDockControl_ShowDataKey) &gt;= 0 ? true : false);
	if (missionVariables.StationDockControl_StationModel) this._stationModel = (this._trueValues.indexOf(missionVariables.StationDockControl_StationModel) &gt;= 0 ? true : false);
	if (missionVariables.StationDockControl_RSNinMFD) this._rsnInMFD = (this._trueValues.indexOf(missionVariables.StationDockControl_RSNinMFD) &gt;= 0 ? true : false);

	this._SDC = worldScripts.StationDockControl;

	if (this._SDC._disable === true) {
		delete this.shipDied;
		delete this.guiScreenChanged;
		delete this.shipDockedWithStation;
		delete this.shipWillLaunchFromStation;
		delete this.startUpComplete;
		return;
	}

	this._debug = this._SDC._debug;

	// is randomship names installed?
	if (worldScripts[&quot;randomshipnames&quot;]) this._rsnInstalled = true;
	// if it isn&#39;t, we will have one extra display row on the interface screen.
	if (this._rsnInstalled === false) this._msRows += 1;

	if (missionVariables.StationDockControl_PlayerDockingBay) {
		this._playerDockingBay = missionVariables.StationDockControl_PlayerDockingBay;
	}
	if (missionVariables.StationDockControl_PlayerDockTime) {
		this._playerDockTime = missionVariables.StationDockControl_PlayerDockTime;
	} else {
		// if we don&#39;t have a saved dock time, default to 5 minutes ago
		this._playerDockTime = global.clock.adjustedSeconds - (5 * 60);
	}

	// set up the interface screen, if required
	var p = player.ship;
	if (p.dockedStation) {
		if (p.dockedStation.hasNPCTraffic &amp;&amp; this.$checkStationRoleForView(p.dockedStation)) {
			this._selectedStation = p.dockedStation;
			this.$initInterface(p.dockedStation);
		}
	}

	// if there are external menu items in the save game, restore them here
	if (missionVariables.StationDockControl_ExternalMenu) {
		this._externalMenu = JSON.parse(missionVariables.StationDockControl_ExternalMenu);
		delete missionVariables.StationDockControl_ExternalMenu;
	}
}

//-------------------------------------------------------------------------------------------------------------
this.shipDied = function (whom, why) {
	// clean up any active timers
	if (this._refresh &amp;&amp; this._refresh.isRunning) this._refresh.stop();
}

//-------------------------------------------------------------------------------------------------------------
this.guiScreenChanged = function (to, from) {
	if (from === &quot;GUI_SCREEN_MISSION&quot; &amp;&amp; this._dockListOpen) {
		this._dockListOpen = false;
		if (this._hudHidden === false &amp;&amp; player.ship.hudHidden === true) {
			player.ship.hudHidden = false;
		}
		if (this._refresh &amp;&amp; this._refresh.isRunning) this._refresh.stop();
	}
}

//-------------------------------------------------------------------------------------------------------------
this.shipDockedWithStation = function (station) {
	// set up the interface screen, if required
	this._playerDockTime = global.clock.adjustedSeconds;
	if (system.ID != -1 &amp;&amp; station.hasNPCTraffic &amp;&amp; this.$checkStationRoleForView(station)) {
		this._selectedStation = station;
		this.$initInterface(station);
	}
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillLaunchFromStation = function (station) {
	this._playerDockingBay = &quot;&quot;;
}

//-------------------------------------------------------------------------------------------------------------
this.playerWillSaveGame = function () {
	if (this._playerDockingBay !== &quot;&quot;) {
		missionVariables.StationDockControl_PlayerDockingBay = this._playerDockingBay;
	} else {
		delete missionVariables.StationDockControl_PlayerDockingBay;
	}
	missionVariables.StationDockControl_PlayerDockTime = this._playerDockTime;

	// save any external menu items
	if (this._externalMenu.length &gt; 0) {
		missionVariables.StationDockControl_ExternalMenu = JSON.stringify(this._externalMenu);
	}
	missionVariables.StationDockControl_ShipModel = this._shipModel;
	missionVariables.StationDockControl_SpinModel = this._spinModel;
	missionVariables.StationDockControl_ShowDataKey = this._showDataKey;
	missionVariables.StationDockControl_StationModel = this._stationModel;
	missionVariables.StationDockControl_RSNinMFD = this._rsnInMFD;
}

//=============================================================================================================
// external interfaces

//-------------------------------------------------------------------------------------------------------------
// add a custom menu to the ship display, with a callback
// obj has following params:
// 	shipName		name of ship to add menu item for (required if pilotname not specified)
// 	shipType		ship type (required if pilotname not specified)
// 	pilotName		name of pilot (optional, but required if shipname and shiptype are blank)
// 	menuText		text to display in the menu (required)
// 	worldScript		worldScript name for the callback (required)
// 	callback		worldScript function to call in the callback (required)
// 	parameter		parameter to add to the function when called (optional)
this.$externalInterface = function $externalInterface(obj) {
	if ((!obj.shipName || obj.shipName === &quot;&quot;) &amp;&amp; (!obj.pilotName || obj.pilotName === &quot;&quot;)) {
		throw &quot;Invalid settings: shipName or pilotName must be specified&quot;;
	}
	if ((!obj.shipType || obj.shipType === &quot;&quot;) &amp;&amp; (!obj.pilotName || obj.pilotName === &quot;&quot;)) {
		throw &quot;Invalid settings: shipType or pilotName must be specified&quot;;
	}
	if (!obj.menuText || obj.menuText === &quot;&quot;) {
		throw &quot;Invalid settings: menuText must be specified, and cannot be blank.&quot;;
	}
	if (!obj.worldScript || obj.worldScript === &quot;&quot;) {
		throw &quot;Invalid settings: worldScript (worldScript name) must be specified, and cannot be blank.&quot;;
	}
	if (!obj.callback || obj.callback === &quot;&quot;) {
		throw &quot;Invalid settings: callback (function name) must be specified, and cannot be blank.&quot;;
	}
	var stnName = &quot;&quot;;
	var stnIndex = 0;
	if (obj.station) {
		stnIndex = this._SDC.$getStationIndex(obj.station);
		stnName = obj.name;
	}

	this._externalMenu.push({
		shipName: (obj.shipName ? obj.shipName : &quot;&quot;),
		shipType: (obj.shipType ? obj.shipType : &quot;&quot;),
		pilotName: (obj.pilotName ? obj.pilotName : &quot;&quot;),
		stationName: stnName,
		stationIndex: stnIndex,
		menuText: obj.menuText,
		callback: obj.callback,
		worldScript: obj.worldScript,
		parameter: (obj.hasOwnProperty(&quot;parameter&quot;) ? obj.parameter : &quot;&quot;)
	});
}

//-------------------------------------------------------------------------------------------------------------
// removes a custom menu from the list
// obj has following params:
// 	shipName		name of ship to remove the menu item for. optional
// 	shipType		ship type. optional
// 	pilotName		name of pilot. optional.
// 	menuText		text displayed in the menu. required
// 	worldScript		worldScript name. required.
this.$removeExternalInterface = function $removeExternalInterface(obj) {
	for (var i = this._externalMenu.length - 1; i &gt;= 0; i--) {
		if ((!obj.shipName || (this._externalMenu[i].shipName === obj.shipName)) &amp;&amp;
			(!obj.shipType || (this._externalMenu[i].shipType === obj.shipType)) &amp;&amp;
			(!obj.pilotName || (this._externalMenu[i].pilotName === obj.pilotName)) &amp;&amp;
			this._externalMenu[i].menuText === obj.menuText &amp;&amp;
			this._externalMenu[i].worldScript === obj.worldScript) {
			this._externalMenu.splice(i, 1);
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
// returns true if an external menu item exists for the ship/pilot &amp; menu/ws combination
// obj has following params:
// 	shipName		name of ship to remove the menu item for. optional
// 	shipType		ship type. optional
// 	pilotName		name of pilot. optional.
// 	menuText		text displayed in the menu. required
// 	worldScript		worldScript name. required.
this.$externalInterfaceExists = function $externalInterfaceExists(obj) {
	for (var i = this._externalMenu.length - 1; i &gt;= 0; i--) {
		if ((!obj.shipName || (this._externalMenu[i].shipName === obj.shipName)) &amp;&amp;
			(!obj.shipType || (this._externalMenu[i].shipType === obj.shipType)) &amp;&amp;
			(!obj.pilotName || (this._externalMenu[i].pilotName === obj.pilotName)) &amp;&amp;
			this._externalMenu[i].menuText === obj.menuText &amp;&amp;
			this._externalMenu[i].worldScript === obj.worldScript) {
			return true;
		}
	}
	return false;
}

//=============================================================================================================
// screen interfaces

//-------------------------------------------------------------------------------------------------------------
// initialise the F4 screen entries
this.$initInterface = function $initInterface(station) {
	station.setInterface(this.name, {
		title: this._selectedStation.name + &quot; &quot; + expandDescription(&quot;[sdc_title]&quot;),
		category: expandDescription(&quot;[sdc_category]&quot;),
		summary: expandDescription(&quot;[sdc_summary]&quot;),
		callback: this.$showDockedList.bind(this)
	});
	// set up interface for switching the dock view to another station in system
	if (this._mode === 0) {
		station.setInterface(this.name + &quot;_dv&quot;, {
			title: &quot;Select station dock view&quot;,
			category: expandDescription(&quot;[sdc_category]&quot;),
			summary: &quot;Switch the dock view to another station in system&quot;,
			callback: this.$selectStationList.bind(this)
		});
	}
}

//-------------------------------------------------------------------------------------------------------------
// show the station selection list
this.$selectStationList = function $selectStationList() {
	var curChoices = {};
	var stns = system.stations;
	for (var i = 0; i &lt; stns.length; i++) {
		if (stns[i].hasNPCTraffic) {
			curChoices[&quot;01_STN~&quot; + stns[i].displayName] = {
				text: stns[i].displayName,
				color: &quot;yellowColor&quot;
			};
		}
	}

	curChoices[&quot;99_EXIT&quot;] = {
		text: &quot;Exit&quot;,
		color: &quot;yellowColor&quot;
	};
	var opts = {
		screenID: &quot;oolite-sdc-switch-map&quot;,
		title: &quot;Select Station Traffic Control&quot;,
		allowInterrupt: true,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
		choices: curChoices,
		initialChoicesKey: &quot;99_EXIT&quot;,
		message: &quot;Select a station whose traffic control you wish to monitor\n\nCurrently viewing: &quot; + this._selectedStation.displayName +
			&quot;\n\nNote: This function is for testing purposes only. It will not be in the official release of this OXP.&quot;
	};
	mission.runScreen(opts, this.$selectStationHandler, this);
}

//-------------------------------------------------------------------------------------------------------------
// handles UI responses from the station selection list
this.$selectStationHandler = function $selectStationHandler(choice) {
	if (choice.indexOf(&quot;01_STN&quot;) &gt;= 0) {
		var nam = choice.substring(7);
		var stns = system.stations;
		for (var i = 0; i &lt; stns.length; i++) {
			if (stns[i].displayName === nam) {
				this._selectedStation = stns[i];
				break;
			}
		}
		this.$initInterface(player.ship.dockedStation);
	}
	if (choice !== &quot;99_EXIT&quot;) {
		this.$selectStationList();
	}
}

//-------------------------------------------------------------------------------------------------------------
// initialise and open the dock list
this.$showDockedList = function $showDockedList() {
	if (this._SDC.$stationIsRepopulating(this._selectedStation) === false) {
		this._SDC.$updateShipsDocking(this._selectedStation);
		this._viewing = this._SDC.$getViewingList(this._selectedStation, false);
		if (this._selectedStation === player.ship.dockedStation) {
			this.$addPlayerToArray(this._viewing);
		}
	}
	this._curpage = 0;
	this._displayMode = 0;
	this._showAll = false;
	this.$showPage();
}

//-------------------------------------------------------------------------------------------------------------
// auto-refresh of page
this.$refreshPage = function $refreshPage() {
	// launched ships should be removed from the array elsewhere, so all we need to do is refresh the page
	if (this._dockListOpen === true) {
		if (this._SDC.$stationIsRepopulating(this._selectedStation) === false) {
			this._SDC.$updateShipsDocking(this._selectedStation);
			this._viewing = this._SDC.$getViewingList(this._selectedStation, false);
			// add the player to the dock list if the docked station is the selected station
			if (this._selectedStation === player.ship.dockedStation) this.$addPlayerToArray(this._viewing);
		}
		this.$showPage();
	}
}

//-------------------------------------------------------------------------------------------------------------
// show the dock list
this.$showPage = function $showPage() {
	function compareDeparture(a, b) {
		if ((a.departureTime * 10 + a.departureSeconds) &lt; (b.departureTime * 10 + b.departureSeconds)) return (worldScripts.StationDockControl_Interface._sortDir * -1);
		if ((a.departureTime * 10 + a.departureSeconds) &gt; (b.departureTime * 10 + b.departureSeconds)) return (worldScripts.StationDockControl_Interface._sortDir);
		return 0;
	}

	function compareShipName(a, b) {
		if (a.shipName &lt; b.shipName) return (worldScripts.StationDockControl_Interface._sortDir * -1);
		if (a.shipName &gt; b.shipName) return (worldScripts.StationDockControl_Interface._sortDir);
		return 0;
	}

	function compareShipType(a, b) {
		if (a.shipType &lt; b.shipType) return (worldScripts.StationDockControl_Interface._sortDir * -1);
		if (a.shipType &gt; b.shipType) return (worldScripts.StationDockControl_Interface._sortDir);
		return 0;
	}

	this._hudHidden = player.ship.hudHidden;
	if (this.$isBigGuiActive() === false) {
		player.ship.hudHidden = true;
	}
	this._dockListOpen = true;

	var p = player.ship;
	var curChoices = {};
	var text = &quot;&quot;;
	var def = &quot;99_EXIT&quot;;

	var hackchip = worldScripts.StationDockControl_HackChip._chipInstalled;

	// stop the timer if it&#39;s running
	if (this._refresh &amp;&amp; this._refresh.isRunning) this._refresh.stop();

	if (this._displayMode === 0) {
		// start a timer to refresh the screen
		this._refresh = new Timer(this, this.$refreshPage, this._refreshPageTime, 0);

		switch (this._sortCol) {
			case &quot;departureTime&quot;:
				this._viewing.sort(compareDeparture);
				break;
			case &quot;shipType&quot;:
				this._viewing.sort(compareShipType);
				break;
			case &quot;shipName&quot;:
				this._viewing.sort(compareShipName);
				break;
		}

		// calculate the max number of pages
		this._maxpage = Math.ceil(this._viewing.length / this._msRows);
		if (this._showAll === false &amp;&amp; this._maxpage &gt; this._initialPageLimit) this._maxpage = this._initialPageLimit;

		// if we only have 1 page, add some extra lines to the page and hide the next/prev page options
		var extra = 0;
		if (this._maxpage &lt;= 1) extra = 2;

		var col1 = 21;
		var col2 = 4.5;
		var col3 = 6.5;

		// build the header
		text += this.$padTextRight(&quot; Ship&quot;, col1);
		text += this.$padTextRight(&quot; Status&quot;, col2);
		text += this.$padTextRight(&quot; Destination&quot;, col3);

		var disable_screen = false;

		if (this._SDC._repopulate === true || this._SDC.$stationIsRepopulating(this._selectedStation) === true) {
			// if the data is about to be changed in the next repopulate loop, don&#39;t show anything
			text += &quot;\n&quot; + this.$duplicate(&quot;-&quot;, 32) + expandDescription(&quot;[sdc-data-loading]&quot;) + this.$duplicate(&quot;-&quot;, 32) + &quot;\n&quot;;
			this._maxpage = 0;
			this._curpage = 0;
			disable_screen = true;
		} else {

			var items = 0;
			var start = this._curpage * (this._msRows + extra);
			var end = (this._curpage * (this._msRows + extra)) + (this._msRows + extra);
			var shipItem = &quot;&quot;;
			var shipRef = 0;
			for (var i = 0; i &lt; this._viewing.length; i++) {
				items += 1;
				if ((items - 1) &gt;= start &amp;&amp; (items - 1) &lt; end) {
					shipRef += 1;
					if (shipRef === (this._msRows + extra) &amp;&amp; this._curpage === (this._initialPageLimit - 1) &amp;&amp; this._showAll === false) {
						curChoices[&quot;01_99_EXPAND&quot;] = {
							text: expandDescription(&quot;[showall]&quot;),
							color: this._menuColor,
							alignment: &quot;LEFT&quot;
						};
					} else {
						switch (this._sortCol) {
							case &quot;departureTime&quot;:
							case &quot;shipType&quot;:
								shipItem = this.$padTextRight(this._viewing[i].shipType +
										((this._viewing[i].shipName &amp;&amp; this._viewing[i].shipName.length &gt; 1) ? &quot;: &quot; + this._viewing[i].shipName : &quot;&quot;), col1) +
									this.$padTextRight(this.$departureTimeFormat(this._viewing[i].departureTime), col2) +
									this.$padTextRight((hackchip || this.$viewDestination(this._viewing[i]) ? this.$outputDestination(this._viewing[i]) : &quot;&quot;), col3);
								break;
							case &quot;shipName&quot;:
								shipItem = this.$padTextRight(((this._viewing[i].shipName &amp;&amp; this._viewing[i].shipName.length &gt; 1) ? this._viewing[i].shipName + &quot; - &quot; : &quot;&quot;) + this._viewing[i].shipType, col1) +
									this.$padTextRight(this.$departureTimeFormat(this._viewing[i].departureTime), col2) +
									this.$padTextRight((hackchip || this.$viewDestination(this._viewing[i]) ? this.$outputDestination(this._viewing[i]) : &quot;&quot;), col3);
								break;
						}

						curChoices[&quot;01_&quot; + (shipRef &lt; 10 ? &quot;0&quot; : &quot;&quot;) + shipRef + &quot;_SHIPITEM_&quot; + i] = {
							text: shipItem,
							color: this._itemColor,
							alignment: &quot;LEFT&quot;
						};
					}
				}
				if ((items - 1) &gt;= end) break;
			}

			for (var i = 0; i &lt; ((this._msRows + extra) + 1) - shipRef; i++) {
				curChoices[&quot;02_SPACER_&quot; + i.toString()] = &quot;&quot;;
			}
		}

		if (this._maxpage &gt; 1) {
			if (this._curpage &lt; this._maxpage - 1) {
				curChoices[&quot;10_GOTONEXT&quot;] = {
					text: &quot;[option_nextpage]&quot;,
					color: this._menuColor
				};
			} else {
				curChoices[&quot;10_GOTONEXT&quot;] = {
					text: &quot;[option_nextpage]&quot;,
					color: this._disabledColor,
					unselectable: true
				};
			}
			if (this._curpage &gt; 0) {
				curChoices[&quot;11_GOTOPREV&quot;] = {
					text: &quot;[option_prevpage]&quot;,
					color: this._menuColor
				};
			} else {
				curChoices[&quot;11_GOTOPREV&quot;] = {
					text: &quot;[option_prevpage]&quot;,
					color: this._disabledColor,
					unselectable: true
				};
			}
		}
		if (this._sortCol === &quot;shipType&quot; || disable_screen === true) {
			curChoices[&quot;30_SORTBY_SHIPTYPE&quot;] = {
				text: &quot;[option_sortshiptype]&quot;,
				color: this._disabledColor,
				unselectable: true
			};
		} else {
			curChoices[&quot;30_SORTBY_SHIPTYPE&quot;] = {
				text: &quot;[option_sortshiptype]&quot;,
				color: this._menuColor
			};
		}
		if (this._rsnInstalled === true) {
			if (this._sortCol === &quot;shipName&quot; || disable_screen === true) {
				curChoices[&quot;31_SORTBY_SHIPNAME&quot;] = {
					text: &quot;[option_sortshipname]&quot;,
					color: this._disabledColor,
					unselectable: true
				};
			} else {
				curChoices[&quot;31_SORTBY_SHIPNAME&quot;] = {
					text: &quot;[option_sortshipname]&quot;,
					color: this._menuColor
				};
			}
		}
		if (this._sortCol === &quot;departureTime&quot; || disable_screen === true) {
			curChoices[&quot;32_SORTBY_DEPART&quot;] = {
				text: &quot;[option_sortstatus]&quot;,
				color: this._disabledColor,
				unselectable: true
			};
		} else {
			curChoices[&quot;32_SORTBY_DEPART&quot;] = {
				text: &quot;[option_sortstatus]&quot;,
				color: this._menuColor
			};
		}

		if (this._sortDir === 1 || disable_screen === true) {
			curChoices[&quot;35_SORT_ASC&quot;] = {
				text: &quot;[option_sortasc]&quot;,
				color: this._disabledColor,
				unselectable: true
			};
		} else {
			curChoices[&quot;35_SORT_ASC&quot;] = {
				text: &quot;[option_sortasc]&quot;,
				color: this._menuColor
			};
		}
		if (this._sortDir === -1 || disable_screen === true) {
			curChoices[&quot;36_SORT_DESC&quot;] = {
				text: &quot;[option_sortdesc]&quot;,
				color: this._disabledColor,
				unselectable: true
			};
		} else {
			curChoices[&quot;36_SORT_DESC&quot;] = {
				text: &quot;[option_sortdesc]&quot;,
				color: this._menuColor
			};
		}
		curChoices[&quot;99_EXIT&quot;] = {
			text: &quot;[option_exit]&quot;,
			color: this._exitColor
		};

		var pgtitle = this._selectedStation.name + &quot; &quot; + expandDescription(&quot;[sdc_title_proper]&quot;) + (disable_screen === true || this._maxpage &lt;= 1 ? &quot;&quot; : &quot; - Page &quot; + (this._curpage + 1) + &quot; of &quot; + ((this._maxpage &gt; 3 &amp;&amp; this._showAll === false) ? this._initialPageLimit : this._maxpage));
		if (defaultFont.measureString(pgtitle) &gt; 17) {
			pgtitle = expandDescription(&quot;[sdc_title_proper]&quot;) + (disable_screen === true || this._maxpage &lt;= 1 ? &quot;&quot; : &quot; - Page &quot; + (this._curpage + 1) + &quot; of &quot; + ((this._maxpage &gt; 3 &amp;&amp; this._showAll === false) ? this._initialPageLimit : this._maxpage));
		}
		var opts = {
			screenID: &quot;oolite-sdc-main-map&quot;,
			title: pgtitle,
			allowInterrupt: true,
			exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
			choices: curChoices,
			initialChoicesKey: this._lastchoice ? this._lastchoice : def,
			message: text
		};
		if (this._stationModel === true) {
			opts[&quot;model&quot;] = &quot;[&quot; + this._selectedStation.dataKey + &quot;]&quot;;
			opts[&quot;modelPersonality&quot;] = this._selectedStation.entityPersonality;
			opts[&quot;spinModel&quot;] = this._spinModel;
		} else {
			opts[&quot;overlay&quot;] = {
				name: &quot;sdc-station.png&quot;,
				height: 546
			};
		}
	}

	// displaying details of an individual ship
	if (this._displayMode === 1) {
		var depart = this.$departureTimeFormat(this._selectedItem.departureTime);
		var column = 11;

		// ship name/type
		text += ((this._selectedItem.shipName &amp;&amp; this._selectedItem.shipName.length &gt; 1) ? this.$padTextRight(expandDescription(&quot;[shipdetails-shipname]&quot;), column) + this._selectedItem.shipName + &quot;\n&quot; : &quot;&quot;) +
			this.$padTextRight(expandDescription(&quot;[shipdetails-shiptype]&quot;), column) + this._selectedItem.shipType + ((this._mode === 0) ? &quot; (&quot; + this._selectedItem.primaryRole + &quot;)&quot; : &quot;&quot;) + &quot;\n&quot;;

		if (this._showDataKey) {
			text += this.$padTextRight(expandDescription(&quot;[shipdetails-datakey]&quot;), column) + this._selectedItem.shipDataKey + &quot; (&quot; + this._selectedItem.personality + &quot;)\n&quot;;
			//log(this.name, &quot;player ent person = &quot; + player.ship.entityPersonality);
		}

		// legal status
		if (p.equipmentStatus(&quot;EQ_SCANNER_SHOW_MISSILE_TARGET&quot;) === &quot;EQUIPMENT_OK&quot;) {
			text += this.$padTextRight(expandDescription(&quot;[shipdetails-legal]&quot;), column) +
				(this._selectedItem.bounty === 0 ? &quot;Clean&quot; : (this._selectedItem.bounty &gt; 0 &amp;&amp; this._selectedItem.bounty &lt;= 50 ? &quot;Offender&quot; : &quot;Fugitive&quot;)) + &quot;\n&quot;;
		}
		// docking bay/dock time
		if (depart !== &quot;Inbound&quot;) {
			if (this._selectedItem.dockingBay !== &quot;&quot;) {
				var pref = this.$getDockingBayPrefix(p.dockedStation);
				text += this.$padTextRight(expandDescription(&quot;[shipdetails-dockingbay]&quot;), column) + pref + this._selectedItem.dockingBay + &quot;\n&quot;;
			}
			text += this.$padTextRight(expandDescription(&quot;[shipdetails-docktime]&quot;), column) + global.clock.clockStringForTime(this._selectedItem.dockTime) + &quot;\n&quot;;
		}

		// departure time/status
		var lt = (this._selectedItem.departureTime * 60 + this._selectedItem.lastChange);
		text += this.$padTextRight(((lt &gt; (global.clock.adjustedSeconds + 60) &amp;&amp;
			lt &lt; (global.clock.adjustedSeconds + (12 * 60 * 60))) ? expandDescription(&quot;[shipdetails-departtime]&quot;) : expandDescription(&quot;[shipdetails-status]&quot;)), column) + depart + &quot;\n&quot;;

		// destination
		switch (depart) {
			// for these items hide the destination - the ship hasn&#39;t loaded yet, so no decision on destination has been made
			case &quot;Inbound&quot;:
			case &quot;Docking&quot;:
			case &quot;Unloading&quot;:
			case &quot;Docked&quot;:
				break;
			default:
				if (hackchip || this.$viewDestination(this._selectedItem) === true) {
					text += this.$padTextRight(expandDescription(&quot;[shipdetails-destinationsystem]&quot;), column) + System.systemNameForID(this._selectedItem.destinationSystem) + &quot;\n&quot;;
				}
				if (this._selectedItem.destination &amp;&amp; this._selectedItem.destination !== &quot;&quot;) {
					text += this.$padTextRight(expandDescription(&quot;[shipdetails-destination]&quot;), column) + this.$viewLocation(this._selectedItem.destination) + &quot;\n&quot;;
				}
				break;
		}

		// ship groups
		if (this._selectedItem.groupName !== &quot;&quot; &amp;&amp; depart !== &quot;Inbound&quot;) {
			text += &quot;\n&quot;;
			var group = this.$getGroupMembers(this._selectedItem.groupName, this._selectedItem);
			if (group.length &gt; 0) {
				if (this._selectedItem.groupLeader === true) {
					text += this.$padTextRight(expandDescription(&quot;[shipdetails-groupleader]&quot;), column) + &quot;Yes\n&quot;;
				} else {
					text += this.$padTextRight(expandDescription(&quot;[shipdetails-groupmemberleader]&quot;), column) + this.$padTextRight(this.$getGroupLeader(this._selectedItem.groupName), 32 - column) + &quot;\n&quot;;
				}
				for (var i = 0; i &lt; group.length; i++) {
					if (i === 0) {
						text += this.$padTextRight(expandDescription(&quot;[shipdetails-groupmembers]&quot;), column);
					} else {
						text += this.$padTextRight(&quot;&quot;, column);
					}
					text += this.$padTextRight(group[i].shipType + (group[i].shipName.length &gt; 1 ? &quot;: &quot; + group[i].shipName : &quot;&quot;), 32 - column) + &quot;\n&quot;;
				}
			}
		}
		// ship escorts
		if (this._selectedItem.escortName !== &quot;&quot; &amp;&amp; depart !== &quot;Inbound&quot;) {
			if (this._selectedItem.groupName === &quot;&quot;) text += &quot;\n&quot;;
			var escort = this.$getEscortMembers(this._selectedItem.escortName, this._selectedItem);
			if (escort.length &gt; 0) {
				if (this._selectedItem.escortLeader === true) {
					text += this.$padTextRight(expandDescription(&quot;[shipdetails-escortleader]&quot;), column) + &quot;Yes\n&quot;;
				} else {
					text += this.$padTextRight(expandDescription(&quot;[shipdetails-escortmemberleader]&quot;), column) + this.$padTextRight(this.$getEscortLeader(this._selectedItem.escortName), 32 - column) + &quot;\n&quot;;
				}
				for (var i = 0; i &lt; escort.length; i++) {
					if (i === 0) {
						text += this.$padTextRight(expandDescription(&quot;[shipdetails-escortmembers]&quot;), column);
					} else {
						text += this.$padTextRight(&quot;&quot;, column);
					}
					text += this.$padTextRight(escort[i].shipType + (escort[i].shipName.length &gt; 1 ? &quot;: &quot; + escort[i].shipName : &quot;&quot;), 32 - column) + &quot;\n&quot;;
				}
			}
		}

		// pilot info (if we have it)
		if (this._selectedItem.pilotName !== &quot;&quot;) {
			text += &quot;\n&quot;;
			text += this.$padTextRight(expandDescription(&quot;[shipdetails-pilotname]&quot;), column);
			var colText = this.$columnText((this._selectedItem.isPlayer ? &quot;Commander &quot; : &quot;&quot;) + this._selectedItem.pilotName + (this._selectedItem.pilotDescription !== &quot;&quot; ? &quot;, &quot; + this._selectedItem.pilotDescription : &quot;&quot;), 31 - column);
			for (var i = 0; i &lt; colText.length; i++) {
				if (i !== 0) text += this.$padTextRight(&quot;&quot;, column);
				text += colText[i] + &quot;\n&quot;;
			}
			if (this._selectedItem.pilotDescription === &quot;&quot;) {
				if (this._selectedItem.pilotSpecies !== &quot;&quot;) text += this.$padTextRight(expandDescription(&quot;[shipdetails-pilotspecies]&quot;), column) + this.$toProperCase(this._selectedItem.pilotSpecies) + &quot;\n&quot;;
				if (this._selectedItem.pilotHomeSystem !== -1) text += this.$padTextRight(expandDescription(&quot;[shipdetails-pilothomesystem]&quot;), column) + System.systemNameForID(this._selectedItem.pilotHomeSystem) + &quot;\n&quot;;
			}
		}

		if (this._selectedIndex === this._viewing.length - 1) {
			curChoices[&quot;90_NEXTSHIP&quot;] = {
				text: &quot;[option_nextship]&quot;,
				color: this._disabledColor,
				unselectable: true
			};
		} else {
			curChoices[&quot;90_NEXTSHIP&quot;] = {
				text: &quot;[option_nextship]&quot;,
				color: this._menuColor
			};
		}
		if (this._selectedIndex === 0) {
			curChoices[&quot;91_PREVSHIP&quot;] = {
				text: &quot;[option_prevship]&quot;,
				color: this._disabledColor,
				unselectable: true
			};
		} else {
			curChoices[&quot;91_PREVSHIP&quot;] = {
				text: &quot;[option_prevship]&quot;,
				color: this._menuColor
			};
		}
		if (this._showEquipment === true) curChoices[&quot;93_EQUIPMENT&quot;] = {
			text: &quot;[option_equipment]&quot;,
			color: this._menuColor
		};

		// only offer a launch before/after if the ship has a scheduled departure time visible
		if (p.dockedStation === this._selectedStation) {
			if (depart.indexOf(&quot;:&quot;) &gt;= 0 &amp;&amp; ((player.bounty === 0 &amp;&amp; this._selectedItem.destinationHidden === false) || this._mode === 0)) {
				// and they&#39;re not due in the 10 minutes or less
				if (lt &gt; (global.clock.adjustedSeconds + (10 * 60)) &amp;&amp; depart !== &quot;00:10&quot;) {
					curChoices[&quot;95_LAUNCH_BEFORE&quot;] = {
						text: &quot;[option_requestbefore]&quot;,
						color: this._menuColor
					};
				}
				if (lt &gt;= (global.clock.adjustedSeconds + (10 * 60))) {
					curChoices[&quot;96_LAUNCH_AFTER&quot;] = {
						text: &quot;[option_requestafter]&quot;,
						color: this._menuColor
					};
				}
			}
		}
		if (hackchip &amp;&amp; depart.indexOf(&quot;:&quot;) &gt;= 0 &amp;&amp; this._selectedItem.destinationHidden === true &amp;&amp; lt &gt;= (global.clock.adjustedSeconds + (10 * 60))) {
			curChoices[&quot;97_HACKCHIP&quot;] = {
				text: &quot;[hackchip-override]&quot;,
				color: this._menuColor
			};
		}

		// add the custom menu items here, if any
		for (var i = 0; i &lt; this._externalMenu.length; i++) {
			// don&#39;t add menus to ships that are inbound
			if (depart !== &quot;Inbound&quot;) {
				// is this menu limited to a specific station?
				var stnName = this._externalMenu[i].stationName;
				var stnIndex = parseInt(this._externalMenu[i].stationIndex);
				var stn = null;
				if (stnName !== &quot;&quot;) stn = this._SDC.$getStationFromName(stnName, stnIndex);
				// if the specific station is not the current player station, just continue.
				if (stn !== null &amp;&amp; stn !== player.ship.dockedStation) continue;
				// match based on shipname/type or pilot name
				if (this._externalMenu[i].shipName === &quot;*&quot; ||
					(this._externalMenu[i].shipName === this._selectedItem.shipName &amp;&amp; this._externalMenu[i].shipType === this._selectedItem.shipType) ||
					(this._externalMenu[i].pilotName === this._selectedItem.pilotName)) {
					curChoices[&quot;80_EXT:&quot; + (i &lt; 10 ? &quot;0&quot; : &quot;&quot;) + i.toString()] = {
						text: this._externalMenu[i].menuText,
						color: this._menuColor
					};
				}
			}
		}

		if (this._mode === 0) curChoices[&quot;97_LOG&quot;] = {
			text: &quot;[option_log]&quot;,
			color: this._menuColor
		};
		curChoices[&quot;98_CLOSE&quot;] = {
			text: &quot;[option_close]&quot;,
			color: this._exitColor
		};
		def = &quot;98_CLOSE&quot;;
		var opts = {
			screenID: &quot;oolite-sdc-ship-map&quot;,
			title: expandDescription(&quot;[ship_details_title]&quot;),
			allowInterrupt: true,
			exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
			choices: curChoices,
			initialChoicesKey: this._shiplastchoice ? this._shiplastchoice : def,
			message: text,
		};
		if (this._shipModel === true) {
			opts[&quot;model&quot;] = &quot;[&quot; + this._selectedItem.shipDataKey + &quot;]&quot;;
			opts[&quot;modelPersonality&quot;] = this._selectedItem.personality;
			opts[&quot;spinModel&quot;] = this._spinModel;
		}
	}

	if (this._displayMode === 2) {
		var column = 11;

		// ship name/type
		text += ((this._selectedItem.shipName &amp;&amp; this._selectedItem.shipName.length &gt; 1) ? this.$padTextRight(expandDescription(&quot;[shipdetails-shipname]&quot;), column) + this._selectedItem.shipName + &quot;\n&quot; : &quot;&quot;) +
			this.$padTextRight(expandDescription(&quot;[shipdetails-shiptype]&quot;), column) + this._selectedItem.shipType + ((this._mode === 0) ? &quot; (&quot; + this._selectedItem.primaryRole + &quot;)&quot; : &quot;&quot;) + &quot;\n\n&quot;;

		var eqlist = this.$equipmentListDisplay(this._selectedItem);
		if (eqlist.length &gt; 0) {
			for (var i = 0; i &lt; eqlist.length; i++) {
				text += this.$padTextRight((i === 0 ? &quot;Equipment:&quot; : &quot;&quot;), column) + eqlist[i] + &quot;\n&quot;;
			}
		}
		curChoices[&quot;97_CLOSE&quot;] = {
			text: &quot;[option_close]&quot;,
			color: this._exitColor
		};
		def = &quot;97_CLOSE&quot;;

		var opts = {
			screenID: &quot;oolite-sdc-ship-map&quot;,
			title: expandDescription(&quot;[ship_equipment_title]&quot;),
			allowInterrupt: true,
			exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;,
			choices: curChoices,
			initialChoicesKey: def,
			message: text
		};

		if (this._shipModel === true) {
			opts[&quot;model&quot;] = &quot;[&quot; + this._selectedItem.shipDataKey + &quot;]&quot;;
			opts[&quot;modelPersonality&quot;] = this._selectedItem.personality;
			opts[&quot;spinModel&quot;] = this._spinModel;
		}
	}

	mission.runScreen(opts, this.$screenHandler, this);

	var m = mission.displayModel;
	// rotate model for a better view
	if (m) {
		// if gallery has been loaded and used, remove the frame callback
		var w = worldScripts.gallery;
		if (w &amp;&amp; isValidFrameCallback(w.$GalleryFCB)) removeFrameCallback(w.$GalleryFCB);

		var zoom_factor = this._defaultZoomFactor;
		if (this._displayMode === 1 &amp;&amp; this._shipModel &amp;&amp; this._spinModel === false) {
			if (this._zoomOverride[this._selectedItem.shipType]) zoom_factor = this._zoomOverride[this._selectedItem.shipType];
		}
		// zoom and rotate the image
		m.position = Vector3D(0, 0, m.collisionRadius * zoom_factor);
		m.orientation = m.orientation.rotate([0, 0, 0]);
		m.orientation = m.orientation.rotateZ(Math.PI * 1.2);
		m.orientation = m.orientation.rotateX(-1.1);
	}

	// refreshing the page would lose the XenonUI background, so force a reload here.
	if (!worldScripts.Lib_GUI) {
		if (worldScripts.XenonUI) worldScripts.XenonUI.guiScreenChanged(&quot;&quot;, &quot;&quot;);
		if (worldScripts.XenonReduxUI) worldScripts.XenonReduxUI.guiScreenChanged(&quot;&quot;, &quot;&quot;);
	} else {
		worldScripts.Lib_GUI.guiScreenChanged();
	}
}

//-------------------------------------------------------------------------------------------------------------
// handles UI responses on the dock list screen
this.$screenHandler = function $screenHandler(choice) {
	delete this._lastchoice;
	delete this._shiplastchoice;
	var newChoice = &quot;&quot;;

	if (!choice) {
		return; // launched while reading?
	} else if (choice.indexOf(&quot;SHIPITEM&quot;) &gt;= 0) {
		// get the selected item
		// use the index attached to the end of the choice
		this._selectedIndex = parseInt(choice.substring(choice.indexOf(&quot;SHIPITEM&quot;) + 9));
		this._selectedItem = this._viewing[this._selectedIndex];
		this._displayMode = 1;
		this._savedChoice = choice;
	} else if (choice.indexOf(&quot;80_EXT:&quot;) &gt;= 0) {
		// call the external function
		var idx = parseInt(choice.substring(choice.indexOf(&quot;:&quot;) + 1));
		var w = worldScripts[this._externalMenu[idx].worldScript];
		var result = false;
		if (w) {
			result = w[this._externalMenu[idx].callback](this._selectedIndex, this._externalMenu[idx].parameter);
		}
		if (result === false) return;

	} else if (choice === &quot;01_99_EXPAND&quot;) {
		this._showAll = true;
		newChoice = &quot;10_GOTONEXT&quot;;
	} else if (choice === &quot;11_GOTOPREV&quot;) {
		this._curpage -= 1;
		if (this._curpage === 0) {
			newChoice = &quot;10_GOTONEXT&quot;;
		}
	} else if (choice === &quot;10_GOTONEXT&quot;) {
		this._curpage += 1;
		if (this._curpage === this._maxpage - 1) {
			newChoice = &quot;11_GOTOPREV&quot;;
		}
	} else if (choice === &quot;31_SORTBY_SHIPNAME&quot;) {
		this._sortCol = &quot;shipName&quot;;
		this._sortDir = 1;
		newChoice = &quot;32_SORTBY_DEPART&quot;;
	} else if (choice === &quot;30_SORTBY_SHIPTYPE&quot;) {
		this._sortCol = &quot;shipType&quot;;
		this._sortDir = 1;
		newChoice = &quot;31_SORTBY_SHIPNAME&quot;;
		if (this._rsnInstalled === false) newChoice = &quot;32_SORTBY_DEPART&quot;;
	} else if (choice === &quot;32_SORTBY_DEPART&quot;) {
		this._sortCol = &quot;departureTime&quot;;
		this._sortDir = 1;
		newChoice = &quot;31_SORTBY_SHIPNAME&quot;;
		if (this._rsnInstalled === false) newChoice = &quot;30_SORTBY_SHIPTYPE&quot;;
	} else if (choice === &quot;35_SORT_ASC&quot;) {
		this._sortDir = 1;
		newChoice = &quot;36_SORT_DESC&quot;;
	} else if (choice === &quot;36_SORT_DESC&quot;) {
		this._sortDir = -1;
		newChoice = &quot;35_SORT_ASC&quot;;
	} else if (choice === &quot;90_NEXTSHIP&quot;) {
		this._selectedIndex += 1;
		this._selectedItem = this._viewing[this._selectedIndex];
		this._shiplastchoice = choice;
		if (this._selectedIndex === this._viewing.length - 1) {
			this._shiplastchoice = &quot;91_PREVSHIP&quot;;
		}
	} else if (choice === &quot;91_PREVSHIP&quot;) {
		this._selectedIndex -= 1;
		this._selectedItem = this._viewing[this._selectedIndex];
		this._shiplastchoice = choice;
		if (this._selectedIndex === 0) {
			this._shiplastchoice = &quot;90_NEXTSHIP&quot;;
		}
	} else if (choice === &quot;93_EQUIPMENT&quot;) {
		this._displayMode = 2;

	} else if (choice === &quot;95_LAUNCH_BEFORE&quot;) {
		// check if the ship will accept the request
		//if (this.$checkPermission(this._selectedItem) === false) {
		//	player.consoleMessage(&quot;Your request to launch before this ship was denied by the pilot.&quot;);
		// } else {
		// advance time to 11 minutes before selected ship departs
		var lt = (this._selectedItem.departureTime * 60 + this._selectedItem.lastChange);
		this.$advanceAndLaunch((lt - (10.5 * 60 + 30)) - global.clock.adjustedSeconds);
		choice = &quot;99_EXIT&quot;;
		// }

	} else if (choice === &quot;96_LAUNCH_AFTER&quot;) {
		// check if the ship will accept the request
		//if (this.$checkPermission(this._selectedItem) === false) {
		//	player.consoleMessage(&quot;Your request to launch after this ship was denied by the pilot.&quot;);
		// } else {
		// advance time to to 9 minutes before selected ship departs
		var lt = (this._selectedItem.departureTime * 60 + this._selectedItem.lastChange);
		this.$advanceAndLaunch((lt - (9 * 60 + 30)) - global.clock.adjustedSeconds);
		choice = &quot;99_EXIT&quot;;
		// }
	} else if (choice === &quot;97_HACKCHIP&quot;) {
		this._selectedItem.destinationHidden = false;
	} else if (choice === &quot;97_LOG&quot;) {
		this._SDC.$writeDataToLog(this._selectedItem, &quot;Logging data for ship record&quot;);
	} else if (choice === &quot;97_CLOSE&quot;) {
		this._displayMode = 1;
	} else if (choice === &quot;98_CLOSE&quot;) {
		this._displayMode = 0;
		this._selectedItem = {};
		newChoice = this._savedChoice;
		delete this._savedChoice;
	}

	this._lastchoice = choice;
	if (newChoice !== &quot;&quot;) {
		this._lastchoice = newChoice;
	}

	if (choice !== &quot;99_EXIT&quot;) {
		this.$showPage();
	}
}

//=============================================================================================================
// helper functions

//-------------------------------------------------------------------------------------------------------------
// function to return current state of repopulate control
this.$repopulateInProgress = function $repopulateInProgress() {
	return this._SDC._repopulate;
}

//-------------------------------------------------------------------------------------------------------------
// used by MFD to get list of ships in dock
this.$getStationDockList = function $getStationDockList(station) {
	function compare(a, b) {
		if ((a.departureTime * 10 + a.departureSeconds) &lt; (b.departureTime * 10 + b.departureSeconds)) return -1;
		if ((a.departureTime * 10 + a.departureSeconds) &gt; (b.departureTime * 10 + b.departureSeconds)) return 1;
		return 0;
	}

	if (this._SDC._repopulate === true) {
		this._viewing = [];
	} else {
		this._viewing = this._SDC.$getViewingList(station, true);
	}
	this._viewing.sort(compare);
	return this._viewing;
}

//-------------------------------------------------------------------------------------------------------------
// returns the shipname of the leader of a particular group
this.$getGroupLeader = function $getGroupLeader(groupName) {
	var leader = &quot;&quot;;
	for (var i = 0; i &lt; this._viewing.length; i++) {
		if (this._viewing[i].groupName === groupName &amp;&amp; this._viewing[i].groupLeader === true) {
			leader = this._viewing[i].shipType + (this._viewing[i].shipName.length &gt; 1 ? &quot;: &quot; + this._viewing[i].shipName : &quot;&quot;);
			break;
		}
	}
	if (leader === &quot;&quot;) leader = &quot;(undocked vessel)&quot;;
	return leader;
}

//-------------------------------------------------------------------------------------------------------------
// returns the shipname of the leader of a particular escort
this.$getEscortLeader = function $getEscortLeader(escortName) {
	var leader = &quot;&quot;;
	for (var i = 0; i &lt; this._viewing.length; i++) {
		if (this._viewing[i].escortName === escortName &amp;&amp; this._viewing[i].escortLeader === true) {
			leader = this._viewing[i].shipType + (this._viewing[i].shipName.length &gt; 1 ? &quot;: &quot; + this._viewing[i].shipName : &quot;&quot;);
			break;
		}
	}
	if (leader === &quot;&quot;) leader = &quot;(undocked vessel)&quot;;
	return leader;
}

//-------------------------------------------------------------------------------------------------------------
// returns the members of a particular group as a list of data records. &quot;Exclude&quot; is a record that will be left off
this.$getGroupMembers = function $getGroupMembers(groupName, exclude) {
	var shiplist = [];
	for (var i = 0; i &lt; this._viewing.length; i++) {
		if (this._viewing[i].groupName === groupName &amp;&amp; this._viewing[i].groupLeader === false &amp;&amp; this._viewing[i] !== exclude) {
			shiplist.push(this._viewing[i]);
		}
	}
	return shiplist;
}

//-------------------------------------------------------------------------------------------------------------
// returns the members of a particular escort as a list of data records. &quot;Exclude&quot; is a record that will be left off
this.$getEscortMembers = function $getEscortMembers(escortName, exclude) {
	var shiplist = [];
	for (var i = 0; i &lt; this._viewing.length; i++) {
		if (this._viewing[i].escortName === escortName &amp;&amp; this._viewing[i].escortLeader === false &amp;&amp; this._viewing[i] !== exclude) {
			shiplist.push(this._viewing[i]);
		}
	}
	return shiplist;
}

//-------------------------------------------------------------------------------------------------------------
// occasionally the shipUniqueName returns &quot;&quot; even though it&#39;s really there. In that instance, pull the unique name out of the display name
this.$getShipUniqueName = function $getShipUniqueName(displayName, shipClassName) {
	return displayName.replace(shipClassName + &quot;: &quot;, &quot;&quot;);
}

//-------------------------------------------------------------------------------------------------------------
// return text as &quot;Proper Case&quot;
this.$toProperCase = function $toProperCase(text) {
	return text.replace(/\w\S*/g, function (txt) {
		return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
	});
}

//-------------------------------------------------------------------------------------------------------------
// returns the leader item of a particular group
this.$getGroupLeaderItem = function $getGroupLeaderItem(groupName) {
	for (var i = 0; i &lt; this._viewing.length; i++) {
		if (this._viewing[i].groupName === groupName &amp;&amp; this._viewing[i].groupLeader === true) {
			return this._viewing[i];
		}
	}
	return null;
}

//-------------------------------------------------------------------------------------------------------------
// returns the leader item of a particular escort
this.$getEscortLeaderItem = function $getEscortLeaderItem(escortName) {
	for (var i = 0; i &lt; this._viewing.length; i++) {
		if (this._viewing[i].escortName === escortName &amp;&amp; this._viewing[i].escortLeader === true) {
			return this._viewing[i];
		}
	}
	return null;
}

//-------------------------------------------------------------------------------------------------------------
// appends space to currentText to the specified length in &#39;em&#39;
this.$padTextRight = function $padTextRight(currentText, desiredLength) {
	if (currentText == null) currentText = &quot;&quot;;
	var hairSpace = String.fromCharCode(31);
	var ellip = &quot;…&quot;;
	var currentLength = defaultFont.measureString(currentText);
	var hairSpaceLength = defaultFont.measureString(hairSpace);
	// calculate number needed to fill remaining length
	var padsNeeded = Math.floor((desiredLength - currentLength) / hairSpaceLength);
	if (padsNeeded &lt; 1) {
		// text is too long for column, so start pulling characters off
		var tmp = currentText;
		do {
			tmp = tmp.substring(0, tmp.length - 2) + ellip;
			if (tmp === ellip) break;
		} while (defaultFont.measureString(tmp) &gt; desiredLength);
		currentLength = defaultFont.measureString(tmp);
		padsNeeded = Math.floor((desiredLength - currentLength) / hairSpaceLength);
		currentText = tmp;
	}
	// quick way of generating a repeated string of that number
	return currentText + new Array(padsNeeded).join(hairSpace);
}

//-------------------------------------------------------------------------------------------------------------
// arranges text into a array of strings with a particular column width
this.$columnText = function $columnText(originalText, columnWidth) {
	var returnText = [];
	if (defaultFont.measureString(originalText) &gt; columnWidth) {
		var hold = originalText;
		do {
			var newline = &quot;&quot;;
			var remain = &quot;&quot;;
			var point = hold.length;
			do {
				point = hold.lastIndexOf(&quot; &quot;, point - 1);
				newline = hold.substring(0, point).trim();
				remain = hold.substring(point + 1).trim();
			} while (defaultFont.measureString(newline) &gt; columnWidth);
			returnText.push(newline);
			if (remain !== &quot;&quot;) {
				if (defaultFont.measureString(remain) &lt;= columnWidth) {
					returnText.push(remain);
					hold = &quot;&quot;;
				} else {
					hold = remain;
				}
			} else {
				hold = &quot;&quot;;
			}
		} while (hold !== &quot;&quot;);
	} else {
		returnText.push(originalText);
	}
	return returnText;
}

//-------------------------------------------------------------------------------------------------------------
// duplicates text until it is just less than the desired length;
this.$duplicate = function $duplicate(text, desiredLength) {
	var res = &quot;&quot;;

	do {
		res += text;
	} while (defaultFont.measureString(res) &lt; desiredLength);

	res = res.substring(1, res.length);

	return res;
}

//-------------------------------------------------------------------------------------------------------------
// returns the docking bay prefix for the selected station
this.$getDockingBayPrefix = function $getDockingBayPrefix(station) {
	if (!station) return &quot;&quot;;
	var pref = station.name.toString().substring(0, 1) + String.fromCharCode(65 + (system.ID % 26)) + &quot;-&quot;;

	if (station.mass &lt; 50000000) {
		// some smaller stations won&#39;t have a prefix
		switch (system.ID % 5) {
			case 0:
			case 2:
				pref = &quot;&quot;;
				break;
		}
	} else {
		switch (system.ID % 5) {
			case 0:
				pref += &quot;P-&quot;;
				break;
			case 1:
				pref += &quot;T-&quot;;
				break;
			case 2:
				pref += &quot;S-&quot;;
				break;
			case 3:
				pref += &quot;L-&quot;;
				break;
			case 4:
				pref += &quot;G-&quot;;
				break;
		}
	}

	return pref;
}

//-------------------------------------------------------------------------------------------------------------
// adds the player to the stations docked list
this.$addPlayerToArray = function $addPlayerToArray(stationList) {
	var p = player.ship;
	if (this._playerDockingBay === &quot;&quot;) {
		this._playerDockingBay = this._SDC.$getDockingBayCode(p.dockedStation);
	}

	stationList.push({
		system: system.ID,
		station: p.dockedStation.name,
		shipName: p.shipUniqueName,
		shipType: p.shipClassName,
		shipDataKey: p.dataKey,
		personality: p.entityPersonality,
		primaryRole: p.primaryRole,
		shipAI: &quot;&quot;,
		accuracy: 0,
		equipment: &quot;&quot;,
		heatInsulation: 0,
		homeSystem: -1,
		bounty: p.bounty,
		escortName: &quot;&quot;,
		escortLeader: false,
		groupName: &quot;&quot;,
		groupLeader: false,
		destinationSystem: p.targetSystem,
		destinationHidden: false,
		goods: &quot;&quot;,
		pilotDescription: &quot;&quot;,
		pilotName: player.name,
		pilotHomeSystem: -1,
		pilotLegalStatus: p.bounty,
		pilotInsurance: 0,
		pilotSpecies: &quot;&quot;,
		isPlayer: true,
		dockTime: this._playerDockTime,
		dockingBay: this._playerDockingBay,
		departureTime: (20 * 60),
		departureSeconds: 0
	});
}

//-------------------------------------------------------------------------------------------------------------
// returns a formatted version of a departure time (hh:mm)
this.$departureTimeFormat = function $departureTimeFormat(depart) {
	// get hours, minutes from depart
	//var sec_num = depart - global.clock.adjustedSeconds;

	if (depart === -10) {
		return &quot;Inbound&quot;;
	} else if (Math.round(depart) === -5) {
		return &quot;Rescheduled&quot;;
	} else if (depart &lt; 1) {
		return &quot;Launching&quot;;
	} else {
		var hours = Math.floor(depart / 60);
		var minutes = Math.floor(depart - (hours * 60));

		// determine status based on time range
		if (hours &gt;= 23) return &quot;Docking&quot;;
		if (hours &gt;= 20 &amp;&amp; hours &lt; 23) return &quot;Unloading&quot;;
		if (hours &gt;= 16 &amp;&amp; hours &lt; 20) return &quot;Docked&quot;;
		if (hours &gt;= 12 &amp;&amp; hours &lt; 16) return &quot;Loading&quot;;

		return (hours &lt; 10 ? &quot;0&quot; : &quot;&quot;) + hours + &quot;:&quot; + (minutes &lt; 10 ? &quot;0&quot; : &quot;&quot;) + minutes;
	}
}

//-------------------------------------------------------------------------------------------------------------
// reurns false if station has a role in the list of roles where no view is allowed. Otherwise true
this.$checkStationRoleForView = function $checkStationRoleForView(station) {
	for (var i = 0; i &lt; station.roles.length; i++) {
		if (this._noDockView.indexOf(station.roles[i]) &gt;= 0) return false;
	}
	return true;
}

//-------------------------------------------------------------------------------------------------------------
// interprets the data of a particular entry and determines whether the destination is viewable or not
this.$viewDestination = function $viewDestination(item) {
	// if the destination is set (not equal to -1)
	//  and player.bounty equals 0
	// 	and not equal to the current system.ID,
	//  and the destinationHidden flag is not set,
	//  and the departure time is within the viewable period
	// then return true (ie the destination is viewable), otherwise false
	var lt = (item.departureTime * 60 + item.lastChange)
	if (item.destinationSystem !== -1 &amp;&amp; player.bounty === 0 &amp;&amp;
		(item.destinationSystem !== system.ID || (item.destination &amp;&amp; item.destination !== &quot;&quot;)) &amp;&amp;
		item.destinationHidden === false &amp;&amp;
		lt &lt; (global.clock.adjustedSeconds + (this._destViewingRange * 60 * 60))) return true;
	return false;
}

//-------------------------------------------------------------------------------------------------------------
this.$viewLocation = function $viewLocation(item) {
	if (item) {
		var items = item.split(&quot;|&quot;);
		return items[0];
	} else {
		return &quot;&quot;;
	}
}

//-------------------------------------------------------------------------------------------------------------
this.$outputDestination = function $outputDestination(item) {
	if (item.destination &amp;&amp; item.destination !== &quot;&quot;) {
		return this.$viewLocation(item.destination);
	} else {
		return System.systemNameForID(item.destinationSystem);
	}
}

//-------------------------------------------------------------------------------------------------------------
// work out if the ship will allow the player to launch with them
// returns true if allowed, otherwise false
this.$checkPermission = function $checkPermission(item) {
	var retVal = true;
	var checking = item;
	// get the parent item if this is an escort
	if (item.escortName !== &quot;&quot; &amp;&amp; item.escortLeader === false) {
		checking = this.$getEscortLeaderItem(item.escortName);
	}
	if (item.groupName !== &quot;&quot; &amp;&amp; item.groupLeader === false) {
		checking = this.$getGroupLeaderItem(item.groupName);
	}
	var checkrole = player.roleWeights[parseInt(system.scrambledPseudoRandomNumber(checking.personality) * player.roleWeights.length)];
	switch (checking.primaryRole) {
		case &quot;shuttle&quot;:
		case &quot;trader&quot;:
		case &quot;trader-courier&quot;:
		case &quot;trader-smuggler&quot;:
			if (checkrole.indexOf(&quot;pirate&quot;) &gt;= 0 || checkrole.indexOf(&quot;assassin&quot;) &gt;= 0) retVal = false;
			break;
		case &quot;pirate&quot;:
		case &quot;pirate-light-freighter&quot;:
		case &quot;pirate-medium-freighter&quot;:
			if (checkrole.indexOf(&quot;hunter&quot;) &gt;= 0 || checkrole.indexOf(&quot;assassin&quot;) &gt;= 0) retVal = false;
			break;
		case &quot;assassin-light&quot;:
		case &quot;assassin-medium&quot;:
		case &quot;assassin-heavy&quot;:
			if (checkrole.indexOf(&quot;assassin&quot;) &gt;= 0) retVal = false;
			break;
		case &quot;hunter&quot;:
		case &quot;hunter-medium&quot;:
		case &quot;hunter-heavy&quot;:
			if (checkrole.indexOf(&quot;pirate&quot;) &gt;= 0 || checkrole.indexOf(&quot;assassin&quot;) &gt;= 0) retVal = false;
			break;
	}
	if (this._debug) log(this.name, &quot;Checking permission for &quot; + checking.primaryRole + &quot; against player role &quot; + checkrole + &quot;: result &quot; + retVal);
	return retVal;
}

//-------------------------------------------------------------------------------------------------------------
// advance a given amount of time and launch the player
this.$advanceAndLaunch = function $advanceAndLaunch(advanceTime) {

	var p = player.ship;
	if (this._debug) log(this.name, &quot;Advancing time &quot; + advanceTime + &quot; seconds&quot;);
	global.clock.addSeconds(advanceTime);
	var sdc = worldScripts.StationDockControl;
	if (sdc &amp;&amp; sdc._disable === false) sdc.$checkForLaunchedShips();

	// launch player
	if (this._debug) log(this.name, &quot;Launching the player&quot;);
	if (this.$isBigGuiActive() === false) {
		p.hudHidden = false;
	}
	p.launch();
	this._hudHidden = false;
}

//-------------------------------------------------------------------------------------------------------------
// returns true if a HUD with allowBigGUI is enabled, otherwise false
this.$isBigGuiActive = function $isBigGuiActive() {
	if (oolite.compareVersion(&quot;1.83&quot;) &lt;= 0) {
		return player.ship.hudAllowsBigGui;
	} else {
		var bigGuiHUD = [&quot;XenonHUD.plist&quot;, &quot;coluber_hud_ch01-dock.plist&quot;]; // until there is a property we can check, I&#39;ll be listing HUD&#39;s that have the allow_big_gui property set here
		if (bigGuiHUD.indexOf(player.ship.hud) &gt;= 0) {
			return true;
		} else {
			return false;
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
// returns array of equipment item descriptions for the specified ship item
this.$equipmentListDisplay = function $equipmentListDisplay(item) {
	var eqList = [];
	if (item.equipment !== &quot;&quot;) {
		var list = item.equipment.split(&quot;,&quot;);
		for (var i = 0; i &lt; list.length; i++) {
			var eq = list[i];
			var def = &quot;&quot;;
			var extra = &quot;&quot;;
			if (list[i].indexOf(&quot;:&quot;) &gt;= 0) {
				var subs = list[i].split(&quot;:&quot;);
				def = subs[0];
				eq = subs[1];
			}
			if (def !== &quot;X&quot;) {
				switch (def) {
					case &quot;FORE&quot;:
						extra = &quot;Forward laser: &quot;;
						break;
					case &quot;AFT&quot;:
						extra = &quot;Aft laser: &quot;;
						break;
					case &quot;PORT&quot;:
						extra = &quot;Port laser: &quot;;
						break;
					case &quot;STARBOARD&quot;:
						extra = &quot;Starboard laser: &quot;;
						break;
				}
			}
			if (eq !== &quot;&quot;) {
				var eqDef = EquipmentInfo.infoForKey(eq);
				if (eqDef) eqList.push(extra + eqDef.name);
			}
		}
	} else {
		var ship = Ship.shipDataForKey(item.shipDataKey);
		var weapon = this.$translateWeaponInfo(ship.forward_weapon_type);
		if (weapon !== &quot;&quot;) eqList.push(&quot;Forward laser: &quot; + weapon);
		weapon = this.$translateWeaponInfo(ship.aft_weapon_type);
		if (weapon !== &quot;&quot;) eqList.push(&quot;Aft laser: &quot; + weapon);
		weapon = this.$translateWeaponInfo(ship.port_weapon_type);
		if (weapon !== &quot;&quot;) eqList.push(&quot;Port laser: &quot; + weapon);
		weapon = this.$translateWeaponInfo(ship.starboard_weapon_type);
		if (weapon !== &quot;&quot;) eqList.push(&quot;Starboard laser: &quot; + weapon);
		if (this.$checkValue(ship.has_cloaking_device) === true) eqList.push(&quot;Cloaking Device&quot;);
		if (this.$checkValue(ship.has_ecm) === true) eqList.push(&quot;E.C.M. System&quot;);
		if (this.$checkValue(ship.has_escape_pod) === true) eqList.push(&quot;Escape Pod&quot;);
		if (this.$checkValue(ship.has_fuel_injection) === true) eqList.push(&quot;Witchdrive Fuel Injectors&quot;);
		if (this.$checkValue(ship.has_scoop) === true) eqList.push(&quot;Fuel Scoops&quot;);
		if (this.$checkValue(ship.has_shield_booster) === true) eqList.push(&quot;Shield Boosters&quot;);
		if (this.$checkValue(ship.has_shield_enhancer) === true) eqList.push(&quot;Military Shield Enhancement&quot;);
	}
	return eqList;
}

//-------------------------------------------------------------------------------------------------------------
// translates the weapon info into an actual name
this.$translateWeaponInfo = function $translateWeaponInfo(dta) {
	var result = &quot;&quot;;
	if (!dta == null &amp;&amp; dta !== &quot;WEAPON_NONE&quot;) {
		var wpn = &quot;EQ_&quot; + dta;
		var eq = EquipmentInfo.infoForKey(wpn);
		result = eq.name;
	}
	return result;
}

//-------------------------------------------------------------------------------------------------------------
// checks a value for true or false
this.$checkValue = function $checkValue(dta) {
	if (!dta == null) {
		if (dta === &quot;yes&quot; || dta === &quot;true&quot; || dta === &quot;1&quot; || parseInt(dta) &gt; 1) {
			return true;
		} else {
			return false;
		}
	} else {
		return false;
	}
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/stationdockcontrol_mfd.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;StationDockControl_MFD&quot;;
this.author = &quot;phkb&quot;;
this.copyright = &quot;2015 phkb&quot;;
this.description = &quot;Displays the list of ships docked at the current station in an MFD.&quot;;
this.licence = &quot;CC BY-NC-SA 3.0&quot;;

this._mfdLineLength = 14.2; // horizontal measure of the max width of a line in the MFD (15 is the width of an MFD, minus some margin)
this._mfdMaxLines = 10; // maximum number of lines visible in the MFD (10 - 1 for the header line)
this._shipSpace = 13; // column width for ship name (remaining space will be departure time)
this._update = null; // object to hold timer that will refresh the MFD
this._refreshMFDTime = 11; // number of seconds between MFD view refreshes
this._stationTarget = null; // the current target for the MFD
this._playerIsDocking = false; // flag to indicate the player has requested docking clearance
this._dockTimer = null;
this._mfdID = -1;
this._debug = false;

//=============================================================================================================
// system functions

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function () {
	// if the OXP is disabled, then delete the relevant functions here
	if (worldScripts.StationDockControl._disable === true) {
		delete this.shipTargetAcquired;
		delete this.playerRequestedDockingClearance;
		delete this.shipWillLaunchFromStation;
		delete this.shipExitedWitchspace;
		delete this.startUpComplete;
		delete this.shipDockedWithStation;
		delete this.playerWillEnterWithspace;
		delete this.playerStartedAutoPilot;
		delete this.playerCancelledAutoPilot;
	} else {
		this._debug = worldScripts.StationDockControl._debug;

		var h = worldScripts.hudselector;
		if (h) h.$HUDSelectorAddMFD(this.name, &quot;LaunchQueueMFD&quot;);
	}
}

//-------------------------------------------------------------------------------------------------------------
// turn on mfd when a station is targeted
this.shipTargetAcquired = function (target) {
	if (target.isStation) {
		// if the control is enabled and we don&#39;t have a station target set yet...
		//if (!this._stationTarget) { // removed this condition, to cater for the (very rare) situation of having two stations in range of the player.
		// if the station has NPC traffic and is publishing a view of docked ships...
		//if (target.hasNPCTraffic &amp;&amp; worldScripts.StationDockControl_Interface.$checkStationRoleForView(target)) {
		// only show the MFD for galcop aligned stations
		if (target.hasNPCTraffic &amp;&amp; target.allegiance === &quot;galcop&quot;) {
			// set the target station and start running the update timer
			this._stationTarget = target;
			if (!this._update || this._update.isRunning === false) {
				this._update = new Timer(this, this.$mfd_updateview, 1, this._refreshMFDTime);
			}
		}
		// }
	}
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillLaunchFromStation = function (station) {
	this._playerIsDocking = false;
	this.$mfd_updateview();
}

//-------------------------------------------------------------------------------------------------------------
this.playerRequestedDockingClearance = function (message) {
	if (this._debug) log(this.name, &quot;Player docking request message: &quot; + message);
	if (this._stationTarget) {
		if (message === &quot;DOCKING_CLEARANCE_GRANTED&quot; || message === &quot;DOCKING_CLEARANCE_EXTENDED&quot; || message === &quot;DOCKING_CLEARANCE_DENIED_TRAFFIC_INBOUND&quot; || message === &quot;DOCKING_CLEARANCE_DENIED_TRAFFIC_OUTBOUND&quot;) {
			this._playerIsDocking = true;
			if (message === &quot;DOCKING_CLEARANCE_GRANTED&quot; || message === &quot;DOCKING_CLEARANCE_EXTENDED&quot;) {
				// start a timer so we can track when the clearance expires
				this.$stopTimers();
				this._dockTimer = new Timer(this, this.$dockingExpired, 121, 0);
			}
		} else {
			this._playerIsDocking = false;
			this.$stopTimers();
		}
		this.$mfd_updateview();
	}
}

//-------------------------------------------------------------------------------------------------------------
this.playerStartedAutoPilot = function () {
	this._playerIsDocking = true;
	this.$mfd_updateview();
}

//-------------------------------------------------------------------------------------------------------------
this.playerCancelledAutoPilot = function () {
	this._playerIsDocking = false;
	this.$mfd_updateview();
}

//-------------------------------------------------------------------------------------------------------------
this.shipDockedWithStation = function (station) {
	this.$stopTimers();
}

//-------------------------------------------------------------------------------------------------------------
this.playerWillEnterWitchspace = function () {
	this.$stopTimers();
}

//-------------------------------------------------------------------------------------------------------------
this.shipExitedWitchspace = function () {
	this._stationTarget = null;
	this.$mfd_updateview();
}

//=============================================================================================================
// mfd functions

//-------------------------------------------------------------------------------------------------------------
// stops the dock timer
this.$stopTimers = function $stopTimers() {
	if (this._dockTimer &amp;&amp; this._dockTimer.isRunning) {
		this._dockTimer.stop();
		delete this._dockTimer;
	}
}

//-------------------------------------------------------------------------------------------------------------
// checks for an expired docking request
this.$dockingExpired = function $dockingExpired() {
	if (this._playerIsDocking === true) {
		this._playerIsDocking = false;
		this.$mfd_updateview();
	}
}

//-------------------------------------------------------------------------------------------------------------
// updates the text in the MFD
this.$mfd_updateview = function $mfd_updateview() {
	var p = player.ship;
	if (p.isValid === false) return;

	this.$findMFDID();

	if (this._stationTarget &amp;&amp; this._stationTarget.isValid &amp;&amp; p.position.distanceTo(this._stationTarget) &lt; p.scannerRange) {
		if (p.isInSpace) {
			var w = worldScripts.StationDockControl_Interface;
			var sdc = worldScripts.StationDockControl;
			var output = &quot;&quot;;
			var lineCount = 1; // header line
			// if a repopulate is in progress, don&#39;t try and show data
			if (sdc.$stationIsRepopulating(this._stationTarget) === false) {
				var docklist = w.$getStationDockList(this._stationTarget);
				// find dock for station
				if (this._stationTarget.subEntities) {
					for (var i = 0; i &lt; this._stationTarget.subEntities.length; i++) {
						if (this._stationTarget.subEntities[i].isDock) {
							// get count on number of ships docking
							// note: this seems to get out of sync with the count of ships returned by the $getDockingShips function.
							// Need to find out why
							var docking = 0;
							docking = this._stationTarget.subEntities[i].dockingQueueLength;
							// the player is not counted in dockingQueueLength, so add them in here, if they&#39;re docking
							if (this._playerIsDocking) docking += 1;
							// start building the output
							var pt1 = &quot;Ships docking: &quot; + docking;
							var pt2 = &quot;In launch corridor: &quot; + this._stationTarget.subEntities[i].launchingQueueLength;
							// build the top line so part 1 is on the left and part 2 is on the right, with all the extra space in between
							if (defaultFont.measureString(pt1 + pt2) &lt; this._mfdLineLength) {
								output = w.$padTextRight(pt2 + pt1, this._mfdLineLength);
								output = output.substring(pt2.length) + pt2 + &quot;\n&quot;;
							} else {
								// if it&#39;s already too wide width any spacing, just concat the text and let the MFD handle the squashing
								output = pt1 + &quot; &quot; + pt2 + &quot;\n&quot;;
							}

							// if there&#39;s ships docking, get the details here
							if (docking &gt; 0) {
								var data = this.$getDockingShips(this._stationTarget);
								output += data.text;
								lineCount += data.lines;
							}
							break;
						}
					}
				}
				// if we haven&#39;t filled up the MFD with inbound ships, then fill the rest with docked ships
				var rsn = sdc._rsnInstalled;
				if (rsn === true &amp;&amp; w._rsnInMFD === false) rsn = false;
				if (lineCount &lt;= this._mfdMaxLines) {
					for (var i = 0; i &lt; docklist.length; i++) {
						var offset = 0;
						if (docklist[i].departureTime &lt; 1) offset = 2;

						output += w.$padTextRight(docklist[i].shipType + (rsn === true ? &quot;: &quot; + docklist[i].shipName : &quot;&quot;), this._shipSpace - offset) + &quot; &quot; + w.$departureTimeFormat(docklist[i].departureTime) + &quot;\n&quot;;
						lineCount += 1;
						// break out once we reach the limit
						if (lineCount === this._mfdMaxLines) break;
					}
				}
			} else {
				output += &quot;Establishing communications link\n&quot;;
				output += &quot;with station traffic control.\n&quot;;
				output += &quot;Please stand by.&quot;;
			}
			// set the text in the MFD
			p.setMultiFunctionText(&quot;LaunchQueueMFD&quot;, output, false);
			// check if the last place to have the launch queue mfd is blank (that is, unset), and if so, set it back to be the launch queue mfd
			if (this._mfdID &gt;= 0 &amp;&amp; p.multiFunctionDisplayList[this._mfdID] === &quot;&quot;) {
				p.setMultiFunctionDisplay(this._mfdID, &quot;LaunchQueueMFD&quot;);
			}
		}
	} else {
		// out of range, so display some appropriate text
		p.setMultiFunctionText(&quot;LaunchQueueMFD&quot;, &quot;Traffic Control\n\nNo station in range&quot;, false);
		if (this._mfdID &gt;= 0) p.setMultiFunctionDisplay(this._mfdID, &quot;&quot;);

		if (this._update &amp;&amp; this._update.isRunning) this._update.stop();
		delete this._update;
		this._stationTarget = null;
	}
}

//-------------------------------------------------------------------------------------------------------------
// gets list of ships who are currently trying to dock with the station and returns formatted output for mfd
this.$getDockingShips = function $getDockingShips(station) {
	function $isDocking(entity) {
		return entity.isShip &amp;&amp; !entity.isPlayer &amp;&amp; entity.isValid &amp;&amp; entity.isPiloted &amp;&amp; !entity.isStation &amp;&amp; entity.dockingInstructions &amp;&amp; entity.dockingInstructions.station === station;
	}
	function compare(a, b) {
		if (a.shipClassName &lt; b.shipClassName) return -1;
		if (a.shipClassName &gt; b.shipClassName) return 1;
		return 0;
	}

	var ships = system.filteredEntities(this, $isDocking, station, station.scannerRange);
	var output = &quot;&quot;;
	var w = worldScripts.StationDockControl_Interface;
	var sdc = worldScripts.StationDockControl;
	var rsn = sdc._rsnInstalled;
	if (!w._rsnInMFD) rsn = false;
	var lineCount = 0;

	// if the player is trying to dock, put them first on the list, so they will always be visible
	if (this._playerIsDocking) {
		ships.push(player.ship);
	}

	// sort the list by ship class name. We don&#39;t know (and can&#39;t know) the order in which ships dock, so a classname sort order will do
	ships.sort(compare);

	// build the output
	for (var i = 0; i &lt; ships.length; i++) {
		output += w.$padTextRight((rsn == false ? ships[i].shipClassName : ships[i].displayName), this._shipSpace) + &quot; Inbound\n&quot;;
		lineCount += 1;
		if (lineCount === this._mfdMaxLines) break;
	}

	return {
		text: output,
		lines: lineCount
	};
}

//-------------------------------------------------------------------------------------------------------------
// records the index of the MFD that currently holds the traffic control mfd
this.$findMFDID = function $findMFDID() {
	var p = player.ship;
	if (p &amp;&amp; p.multiFunctionDisplayList) {
		for (var i = 0; i &lt; p.multiFunctionDisplayList.length; i++) {
			if (p.multiFunctionDisplayList[i] === &quot;LaunchQueueMFD&quot;) this._mfdID = i;
		}
	}
}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/stationdockcontrol_populator.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;StationDockControl_Populator&quot;;
this.author = &quot;phkb&quot;;
this.copyright = &quot;2015 phkb&quot;;
this.description = &quot;Overrides the systemWillRepopulate with a new one that allows the station dock control to launch ships from stations.&quot;;
this.licence = &quot;CC BY-NC-SA 3.0&quot;;

this._groupContent = []; // array of ships and groups so we can keep track of group info when ships dock
this._groupCount = 1; // a counter to get added to group names for uniqueness
this._SDC = null; // object ref to main SDC system
this._debug = false; // controls output of information to the log. Slaved to StationDockControl._debug
this._logPopulator = 0; // controls level of information output to log. Slaved to StationDockControl._logPopulatorType

/*
	This script file replaces the &quot;systemWillRepopulate&quot; function of the standard built in populator.
	Essentially, all the &quot;outbound&quot; routines are removed for traders, shuttles, pirates, assassins and hunters.
	Police launches and Aegis raiders are unaffected.
	All outbound launches are controlled via the stationdockcontrol worldscript.

	We also make a list of all groups and group members here. The reason for this is that when ships dock with a station, generally all group
	information is dropped or missing from the ships at the point of docking, which means we can&#39;t tell what group they&#39;re in when they dock.
	So, we need to keep track of groups and group members outside of the ship group mechanism so we can reapply ship groups to the docking array.
*/

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function () {

	this._SDC = worldScripts.StationDockControl;
	this._debug = this._SDC._debug;
	this._logPopulator = this._SDC._logPopulatorType;

	if (this._SDC._disable === false) {
		// replace the original repopulating function with our new one.
		worldScripts[&quot;oolite-populator&quot;].systemWillRepopulate = this.$stationdockcontrol_systemWillRepopulate;
	} else {
		delete this.shipSpawned;
		delete this.shipDied;
		delete this.shipWillEnterWitchspace;
	}

	delete this.startUpComplete;
}

//-------------------------------------------------------------------------------------------------------------
// this handles the process of updating group names to make them unique
// this enables the dock controller to see the whole group when docked
this.shipSpawned = function (ship) {
	if (ship.group) {
		if (!ship.isPolice &amp;&amp; !ship.isStation &amp;&amp; !ship.isThargoid &amp;&amp; ship.isPiloted) {
			if (ship.group.name &amp;&amp; ship.group.name.indexOf(&quot;-&quot;) === -1) {
				ship.group.name = ship.group.name + &quot;-&quot; + this._groupCount;
				this._groupCount += 1;
			}
			if (!ship.group.name) {
				ship.group.name = &quot;unknown group-&quot; + this._groupCount;
				this._groupCount += 1;
			}
			if (ship.group.count &gt; 1) {
				if (this._debug &amp;&amp; this._logPopulator &gt;= 2) log(this.name, &quot;Group &#39;&quot; + ship.group.name + &quot;&#39;, ship: &quot; + ship.displayName);
				this.$logShipGroup(ship.group.name, ship, (ship.group.leader === ship ? true : false));
			}
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
this.shipWillEnterWitchspace = function (cause, destination) {
	// clear out the array
	this._groupContent.length = 0;
}

//-------------------------------------------------------------------------------------------------------------
// adds a ship group and leader combination to the array
this.$logShipGroup = function $logShipGroup(groupName, ship, leader) {
	for (var i = 0; i &lt; this._groupContent.length; i++) {
		if (this._groupContent[i].groupName === groupName &amp;&amp; this._groupContent[i].ship === ship) return;
	}
	this._groupContent.push({
		groupName: groupName,
		ship: ship,
		leader: leader
	});
}

//-------------------------------------------------------------------------------------------------------------
// removes a ship from the data
this.$removeShip = function $removeShip(ship) {
	if (this._debug &amp;&amp; this._logPopulator &gt;= 2) log(this.name, &quot;Removing ship: &quot; + ship.displayName);
	for (var i = this._groupContent.length - 1; i &gt;= 0; i--) {
		if (this._groupContent[i].ship === ship) {
			// remove the item from the array
			this._groupContent.splice(i, 1);
		}
	}
}

//-------------------------------------------------------------------------------------------------------------
// gets the group leader for a particular group
this.$getGroupLeader = function $getGroupLeader(groupName) {
	for (var i = 0; i &lt; this._groupContent.length; i++) {
		if (this._groupContent[i].groupName === groupName &amp;&amp; this._groupContent[i].leader === true) return this._groupContent[i].ship;
	}
	return null;
}

//-------------------------------------------------------------------------------------------------------------
// get the group name attached to a particular ship
this.$getGroupName = function $getGroupName(ship) {
	for (var i = 0; i &lt; this._groupContent.length; i++) {
		if (this._groupContent[i].ship === ship) return this._groupContent[i].groupName;
	}
	return &quot;&quot;;
}

//-------------------------------------------------------------------------------------------------------------
// function responsible for replenishing system contents
this.$stationdockcontrol_systemWillRepopulate = function $stationdockcontrol_systemWillRepopulate() {

	// if main station or planet is missing, something odd has
	// happened, so stop repopulation
	if (system.sun.isGoingNova || !system.mainStation || !system.mainPlanet) {
		return;
	}
	/* repopulate incoming traffic */

	// traders
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.traderFreighters) {
		this._debugR(&quot;Incoming freighter&quot;);
		this._addFreighter(this._wormholePos());
	}
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.traderCouriers) {
		this._debugR(&quot;Incoming courier&quot;);
		if (Math.random() &lt; 0.5) {
			this._addCourierShort(this._wormholePos());
		} else {
			this._addCourierLong(this._wormholePos());
		}
	}
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.traderSmugglers) {
		this._debugR(&quot;Incoming smuggler&quot;);
		this._addSmuggler(this._wormholePos());
	}

	// pirates
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.pirateLightPacks) {
		if (system.countShipsWithPrimaryRole(&quot;pirate-light-freighter&quot;) &lt; 6) {
			this._debugR(&quot;Incoming light pirate&quot;);
			this._addLightPirateRemote(this._wormholePos());
		}
	}
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.pirateLightPacksReturn) {
		if (system.countShipsWithPrimaryRole(&quot;pirate-light-freighter&quot;) &lt; 6) {
			this._debugR(&quot;Returning light pirate&quot;);
			this._addLightPirateReturn(this._wormholePos());
		}
	}
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.pirateMediumPacks) {
		if (system.countShipsWithPrimaryRole(&quot;pirate-medium-freighter&quot;) &lt; 4) {
			this._debugR(&quot;Incoming medium pirate&quot;);
			this._addMediumPirateRemote(this._wormholePos());
		}
	}
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.pirateMediumPacksReturn) {
		if (system.countShipsWithPrimaryRole(&quot;pirate-medium-freighter&quot;) &lt; 4) {
			this._debugR(&quot;Returning medium pirate&quot;);
			this._addMediumPirateReturn(this._wormholePos());
		}
	}
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.pirateHeavyPacks) {
		if (system.countShipsWithPrimaryRole(&quot;pirate-heavy-freighter&quot;) &lt; 2) {
			this._debugR(&quot;Incoming heavy pirate&quot;);
			this._addHeavyPirateRemote(this._wormholePos());
		}
	}
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.pirateHeavyPacksReturn) {
		if (system.countShipsWithPrimaryRole(&quot;pirate-heavy-freighter&quot;) &lt; 2) {
			this._debugR(&quot;Returning heavy pirate&quot;);
			this._addHeavyPirateReturn(this._wormholePos());
		}
	}

	// hunters
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.hunterMediumPacks) {
		if (system.countShipsWithPrimaryRole(&quot;hunter-medium&quot;) &lt; 5) {
			this._debugR(&quot;Incoming medium hunter&quot;);
			this._addMediumHunterRemote(this._wormholePos());
		}
	}
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.hunterMediumPacksReturn) {
		if (system.countShipsWithPrimaryRole(&quot;hunter-medium&quot;) &lt; 5) {
			this._debugR(&quot;Returning medium hunter&quot;);
			this._addMediumHunterReturn(this._wormholePos());
		}
	}
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.hunterHeavyPacks) {
		if (system.countShipsWithPrimaryRole(&quot;hunter-heavy&quot;) &lt; 3) {
			this._debugR(&quot;Incoming heavy hunter&quot;);
			this._addHeavyHunterRemote(this._wormholePos());
		}
	}
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.hunterHeavyPacksReturn) {
		if (system.countShipsWithPrimaryRole(&quot;hunter-heavy&quot;) &lt; 3) {
			this._debugR(&quot;Returning heavy hunter&quot;);
			this._addHeavyHunterReturn(this._wormholePos());
		}
	}

	// thargoids (do not appear at normal witchpoint)
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.thargoidScouts) {
		this._debugR(&quot;Incoming thargoid scout&quot;);
		this._addThargoidScout(system.locationFromCode(&quot;TRIANGLE&quot;));
	}
	if (Math.random() &lt; this.$repopulatorFrequencyIncoming.thargoidStrikes) {
		this._debugR(&quot;Incoming thargoid strike force&quot;);
		this._addThargoidStrike(system.locationFromCode(&quot;TRIANGLE&quot;));
	}

	if (Math.random() &lt; this.$repopulatorFrequencyOutgoing.pirateAegisRaiders) {
		this._addAegisRaiders();
	}

	// police
	if (Math.random() &lt; this.$repopulatorFrequencyOutgoing.policePacks) {
		if (system.countShipsWithPrimaryRole(&quot;police&quot;) &lt; 30) {
			this._debugR(&quot;Launching police patrol&quot;);
			this._addPolicePatrol(this._policeLaunch());
		}
	}
	if (Math.random() &lt; this.$repopulatorFrequencyOutgoing.policeInterceptors) {
		if (system.countShipsWithPrimaryRole(&quot;police-witchpoint-patrol&quot;) &lt; 30) {
			this._debugR(&quot;Launching police interception patrol&quot;);
			this._addInterceptors(this._policeLaunch());
		}
	}

}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/stationdockcontrol_shuttlelaunch.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name = &quot;StationDockControl_ShuttleLaunch&quot;;
this.author = &quot;phkb&quot;;
this.copyright = &quot;2015 phkb&quot;;
this.description = &quot;Script to attach to a shuttle after launch to set its target&quot;;
this.licence = &quot;CC BY-NC-SA 3.0&quot;;

/*
	This script is designed to force a particular in-system destination on a shuttle.
	Because the priority AI controller takes a few moments to start up, we need to wait for it to be active before we can redirect the shuttle.
	So a timer is used. The timer is a one-shot, but it will be restarted if the controller isn&#39;t active.
*/

//-------------------------------------------------------------------------------------------------------------
this.$initialise = function $initialise() {
	// run a timer so the ai controller has a chance to startup besofe we try and set the destination
	this.ship.script._retryCounter = 0;
	//log(this.name, &quot;setting timer for shuttle destination - &quot; + this.ship.displayName);
	this.ship.script._setDest = new Timer(this, this.ship.script.$setDestination, 2, 0);
}

//-------------------------------------------------------------------------------------------------------------
this.$setDestination = function $setDestination() {
	// do we have a ai controller yet?
	if (!this.ship.AIScript.oolite_priorityai) {
		// start counting after ship is in flight
		if (this.ship.status !== &quot;STATUS_IN_FLIGHT&quot;) {
			this.ship.script._retryCounter += 1;
		}
		// give up after ten tries
		if (this.ship.script._retryCounter === 10) {
			//log(this.name, &quot;giving up trying to set shuttle destination for &quot; + this.ship.displayName);
			return;
		}

		// otherwise, reset the timer and try again later
		delete this.ship.script._setDest;

		//log(this.name, &quot;resetting timer for shuttle destination - &quot; + this.ship.displayName);
		this.ship.script._setDest = new Timer(this, this.ship.script.$setDestination, 2, 0);
		return;
	}

	var w = worldScripts.StationDockControl;
	var debug = w._debug;
	var l_debug = w._logLaunchType;

	var items = this._dest.split(&quot;|&quot;);
	if (items[0] !== &quot;Planet&quot;) {
		var stnLoc = w.$getStationFromName(items[0], parseInt(items[1]));
		// check if we got an actual ship location returned
		if (stnLoc) {
			this.ship.AIScript.oolite_priorityai.setParameter(&quot;oolite_selectedPlanet&quot;, null);
			this.ship.AIScript.oolite_priorityai.setParameter(&quot;oolite_selectedStation&quot;, stnLoc);
			if (debug &amp;&amp; l_debug === 2) log(this.name, &quot;Setting &quot; + this.ship.displayName + &quot; destination location to &quot; + stnLoc);
		}
	} else {
		this.ship.AIScript.oolite_priorityai.setParameter(&quot;oolite_selectedStation&quot;, null);
		this.ship.AIScript.oolite_priorityai.setParameter(&quot;oolite_selectedPlanet&quot;, system.mainPlanet);
		if (debug &amp;&amp; l_debug === 2) log(this.name, &quot;Setting &quot; + this.ship.displayName + &quot; destination location to main planet&quot;);
	}
	this.ship.AIScript.oolite_priorityai.reconsiderNow();

	delete this.ship.script._setDest;
}

//-------------------------------------------------------------------------------------------------------------
this.npc_shipDied = function npc_shipDied(whom, why) {
	if (this.ship.script.$sdc_hold_shipDied) this.ship.script.$sdc_hold_shipDied(whom, why);
	if (this.ship.script._setDest &amp;&amp; this.ship.script._setDest.isRunning) this.ship.script._setDest.stop();
}

//-------------------------------------------------------------------------------------------------------------
this.npc_shipWillEnterWormhole = function npc_shipWillEnterWormhole() {
	if (this.ship.script.$sdc_hold_shipWillEnterWormhole) this.ship.script.$sdc_hold_shipWillEnterWormhole();
	if (this.ship.script._setDest &amp;&amp; this.ship.script._setDest.isRunning) this.ship.script._setDest.stop();
}</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
