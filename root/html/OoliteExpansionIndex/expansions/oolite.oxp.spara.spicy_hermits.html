<html>
    <head>
        <title>Expansion Spicy hermits</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Spicy hermits</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">7 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">5 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>http://wiki.alioth.net/index.php/Spicy%20hermits -&gt; 404 Not Found</li>
                <li>Information URL mismatch between OXP Manifest and Expansion Manager string length at character position 0</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Spices rock hermits to better fit their core roles by modifying their behavior and markets. Adds abandoned hermits to the game.</td>
                    <td>Spices rock hermits to better fit their core roles by modifying their behavior and markets. Adds abandoned hermits to the game.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.spara.spicy_hermits</td>
                    <td>oolite.oxp.spara.spicy_hermits</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Spicy hermits</td>
                    <td>Spicy hermits</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Mika Spara</td>
                    <td>Mika Spara</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.0.3</td>
                    <td>1.0.3</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href=""></a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/5/58/Spicy_hermits_1.0.3.oxz">https://wiki.alioth.net/img_auth.php/5/58/Spicy_hermits_1.0.3.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873302</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        
        <h3>readme.txt</h3>
        <pre>Spicy Hermits OXP ver 1.0.3 (28.01.2016)

Author: spara (Mika Sp√•ra)

_Overview_

The core hermits might be considered to be a bit bland. This oxp spices them up a bit.

_Permanency_

The core hermits are practically permanent. You can destroy one, but when you re-enter the system, it&#39;s back. This oxp changes that. If a hermit gets destructed, it won&#39;t reappear again in a same place.

_Abandoned hermits_

Sometimes hermits are abandoned. Lights are turned off, the dock is sealed and they are just left out there rotating alone orbiting the planet. Often these have been used as pirate/smuggler caches and sometimes stuff is just left behind. Find them, destroy them and see if something has been left for you to salvage.

_Characterization_

Three types of hermit exist in the core game with different allegiances and slightly different markets. This oxp emphasizes that characterization by altering markets and hermit behavior to better match the following roles:

Mining bases

* Small scale mining operations happen here. Mining products for sale and it&#39;s possible to do some mining around the hermit and sell extracted minerals to the hermit. Fuel and basic missiles for sale. 

Smugglers&#39; dens

* Small scale mining operations and small scale unofficial trading happen here. A small market with no legal restrictions. Some mining products and restricted goods usually for sale. The station is protected by a couple of hired goons that patrol the hermit. Goons only react, if the hermit or themselves are provoked. Be vary, the visitors of this place are from both sides of the law. Fuel and basic missiles for sale.

Pirate havens

* This hermit has been overrun by pirates, that now hang around the station and keep it as their base. Be ready to defend yourself, if you dare to approach this station. Offers high tech ship maintenance and a selection of high level equipment popular amongst pirates for sale at premium prices. A small market is filled with fruits of piracy. This is a rare hermit type, that can only be found from the most unstable systems.

_Credits_

* Big thank you to Cody, Fritz and others who helped by testing and providing invaluable comments and suggestions.

------

This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/
</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/spicy_hermits_abandoned.html">Abandoned Rock Hermit</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/spicy_hermits_abandoned_dock.html">spicy_hermits_abandoned_dock</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/spicy_hermits_abandoned_dock_griff.html">spicy_hermits_abandoned_dock_griff</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/spicy_hermits_abandoned_door.html">spicy_hermits_abandoned_door</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/spicy_hermits_abandoned_griff.html">Abandoned Rock Hermit</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/spicy_hermits_abandoned_tunnel_extras.html">spicy_hermits_abandoned_tunnel_extras</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/spicy_hermits_abandoned_tunnel_extras_griff.html">spicy_hermits_abandoned_tunnel_extras_griff</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/spicy_hermits_abandoned.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name           = &quot;spicy_hermits_abandoned&quot;;
this.description    = &quot;abandoned hermit populator&quot;;

this.startUp = function() {
	//check for griffs hermits
	if (!Ship.keysForRole(&quot;griff_hermit_subentity&quot;)) {
		this.$role = &quot;spicy_hermits_abandoned&quot;;
	}
	else this.$role = &quot;spicy_hermits_abandoned_griff&quot;;
}

this.systemWillPopulate  = function() {
	var count = 1 + Math.round(Math.random() * 2); //1-3 hermits. weighted at 2.
	//var regions = [&quot;PLANET_ORBIT_HIGH&quot;, &quot;STAR_ORBIT_HIGH&quot;, &quot;OUTER_SYSTEM_OFFPLANE&quot;, &quot;INNER_SYSTEM_OFFPLANE&quot;];
	for (var i = 0; i &lt; count; i++) {
		//var region = regions[Math.floor(Math.random() * regions.length)];
		system.setPopulator(&quot;spicy_hermits_abandoned&quot; + i, {
			callback: function(pos) {
				var hermit = system.addShips(this.$role, 1, pos)[0];
				//spawn 2-5 asteroids to help finding
				system.addShips(&quot;asteroid&quot;, 2 + Math.floor(Math.random() * 4), pos, 25E3);
			}.bind(this),
			location: &quot;PLANET_ORBIT_HIGH&quot;/*region*/
		})
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/spicy_hermits_abandoned_ship.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name           = &quot;spicy_hermits_abandoned_ship&quot;;
this.description    = &quot;ship script for abandoned hermits&quot;;

this.shipSpawned = function() {
	ship.primaryRole = &quot;asteroid&quot;;
}

this.shipDied = function() {
	//create 1 - 15 random cargo pods biasing average
	var count = 1 + Math.floor(5 * (Math.random() + Math.random() + Math.random()));
	var pods = system.addShips(&quot;cargopod&quot;, count, ship.position);
	//give the pods some velocity
	for (var i = 0; i &lt; pods.length; i++) {
		var pod = pods[i];
		var velocity = pod.position.subtract(ship.position).direction().multiply(100);
		pod.velocity = velocity;
	}
	//create 2 - 4 boulders
	var count = 2 + Math.floor(Math.random() * 3);
	ship.spawn(&quot;boulder&quot;, count);
	//rarely boobytrapped
	for (var i = 0; i &lt; 2; i++) {
		if (Math.random() &lt; 0.05) {
			var qbomb = ship.spawnOne(&quot;energy-bomb&quot;);
			qbomb.AIScript.shipWasDumped();
		}
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/spicy_hermits_relocator.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;spicy_hermits_relocator&quot;;

this.startUp = function() {
	if (missionVariables[&quot;spicy_hermits&quot;]) {
		this.$movedHermits = JSON.parse(missionVariables[&quot;spicy_hermits&quot;]);
	}
	else this.$movedHermits = new Object();
}

//save relocated hermits
this.playerWillSaveGame = function() {
	if (this.$movedHermits) {
		missionVariables[&quot;spicy_hermits&quot;] = JSON.stringify(this.$movedHermits);
	}
}

this.systemWillPopulate  = function() {
	var currentSystem = this._getCurrentSystemData();
	if (currentSystem) {
		//create as many populators as needed.
		for (var i = 0; i &lt; currentSystem.length; i++) {
			system.setPopulator(&quot;spicy_hermits&quot; + i, {
				callback: function(pos) {

					//i like to move it, move it
					var origPosition = this._toVect(this._getCurrentSystemData()[this.$hermitPointer][0]);
					var offset = pos.subtract(origPosition);
					
					//since we only know the position and we need an entity to focus on, let&#39;s create a dummy one.
					var positionEntity = system.addVisualEffect(&quot;spicy_hermits_dummy&quot;, origPosition);
					var hermitage = system.entitiesWithScanClass(&quot;CLASS_ROCK&quot;, positionEntity, 1E3);
					for (var i = 0; i &lt; hermitage.length; i++) {						
						//identify, move  and tag the hermit
						if (hermitage[i].isStation) {
							var hermit = hermitage[i];
							hermit.position = hermit.position.add(offset);
							hermit.spicy_hermits_original_position = origPosition;
							//add an asteroid field, using core rule
							var size = 1 + Math.floor(system.scrambledPseudoRandomNumber(Math.floor(pos.x)) * 11);
							var rocks = system.addShips(&quot;asteroid&quot;, size, hermit.position, 25E3);
						}
					}
					
					//remove the position marker and advance the hermit pointer
					positionEntity.remove();
					this.$hermitPointer++;
					
				}.bind(this),
				location: &quot;LANE_WPS&quot;,
				locationSeed: currentSystem[i][1]
			})
		}
	}
	this.$hermitPointer = 0;
}

//public function for hermit AIs to report death.
this._reportDeath = function(origPosition) {
	
	//create a new location seed
	var newSeed = 10000 + Math.floor(Math.random() * 90000);
	var dataElement = [origPosition, newSeed];
	
	//get and if needed init current system stored data
	var currentSystemData = this._getAndInitCurrentSystemData();
	
	//see if there&#39;s already an entry for this hermit
	//if yes, update entry
	var newHermit = true;
	for (var i = 0; i &lt; currentSystemData.length; i++) {
		if (this._toVect(currentSystemData[i][0]).subtract(origPosition).magnitude() === 0) {
			currentSystemData[i] = dataElement;
			newHermit = false;
			break;
		}
	}
	//if not, create a new entry
	if (newHermit) currentSystemData.push(dataElement);
	
}

//it seems that position vector gets converted to a generic object on save/load. this converts it back to vector.
this._toVect = function(storedObj) {
	var vect = new Vector3D();
	vect.x = storedObj.x;
	vect.y = storedObj.y;
	vect.z = storedObj.z;
	return vect;
}

//get current system stored data
this._getCurrentSystemData = function() {
	if (!this.$movedHermits[galaxyNumber]) return([]);
	if (!this.$movedHermits[galaxyNumber][system.ID]) return([]);
	return this.$movedHermits[galaxyNumber][system.ID];
}

//get current system stored data and init new entries
this._getAndInitCurrentSystemData = function() {
	if (!this.$movedHermits[galaxyNumber]) {
		 this.$movedHermits[galaxyNumber] = new Object();
	}
	if (!this.$movedHermits[galaxyNumber][system.ID]) {
		this.$movedHermits[galaxyNumber][system.ID] = new Array();
	}
	return this.$movedHermits[galaxyNumber][system.ID];
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/spicy_hermits_ship_script.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;spicy_hermits_ship_script&quot;;

this.shipSpawned = function() {
	this.$locatorWS = worldScripts[&quot;spicy_hermits_relocator&quot;];
	
	//spawn a couple of grunts around the smuggler version
	if (ship.primaryRole === &quot;rockhermit-chaotic&quot;) {		
		var count = 1 + Math.floor(Math.random() * 3);
		var patrol = system.addShips(&quot;pirate&quot;, count, ship.position, 25E3);
		for (var i = 0; i &lt; patrol.length; i++) {
			ship.group.addShip(patrol[i]);
			patrol[i].group = ship.group;
			patrol[i].switchAI(&quot;spicy_hermits-gruntAI.js&quot;);
			//these are some small time criminals with small bounties on their heads
			patrol[i].bounty = 5 + Math.round(Math.random() * 10);
			//upgrade weapon, if needed.
			if (patrol[i].forwardWeapon === &quot;EQ_WEAPON_PULSE_LASER&quot;) {
				patrol[i].forwardWeapon = &quot;EQ_WEAPON_BEAM_LASER&quot;;
			}
		}
	}	

	//spawn a leader and a few pirates around the pirate version
	if (ship.primaryRole === &quot;rockhermit-pirate&quot;) {
		var leader = system.addShips(&quot;pirate-heavy-fighter&quot;, 1, ship.position, 25E3)[0];
		//upgrade weapon, if needed.
		if (leader.forwardWeapon === &quot;EQ_WEAPON_PULSE_LASER&quot;) {
			leader.forwardWeapon = &quot;EQ_WEAPON_BEAM_LASER&quot;;
		}
		ship.group.addShip(leader);
		leader.group = ship.group;
		ship.group.leader = leader;
		leader.switchAI(&quot;spicy_hermits-pirateAI.js&quot;);
		
		var count = 3 + Math.floor(Math.random() * 2);
		var patrol = system.addShips(&quot;pirate&quot;, count, ship.position, 25E3);
		for (var i = 0; i &lt; patrol.length; i++) {
			//upgrade weapon, if needed.
			if (patrol[i].forwardWeapon === &quot;EQ_WEAPON_PULSE_LASER&quot;) {
				patrol[i].forwardWeapon = &quot;EQ_WEAPON_BEAM_LASER&quot;;
			}
			ship.group.addShip(patrol[i]);
			patrol[i].group = ship.group;
			patrol[i].switchAI(&quot;spicy_hermits-pirateAI.js&quot;);
		}
		
	}
}

this.shipDied = function() {
	//relocator hook
	if (this.$locatorWS) {
		if (ship.spicy_hermits_original_position) {
			this.$locatorWS._reportDeath(ship.spicy_hermits_original_position);
		}
		else {
			this.$locatorWS._reportDeath(ship.position);
		}
	}
	
	//create 1 - 5 random cargo pods upon death
	var count = 1 + Math.floor(Math.random() * 6);
	var pods = ship.spawn(&quot;cargopod&quot;, count);
	
	//destruct pods with non-suitable content.
	if (ship.primaryRole === &quot;rockhermit&quot;) {
		var suitableContents = [&quot;radioactives&quot;, &quot;minerals&quot;, &quot;gold&quot;, &quot;platinum&quot;, &quot;gem_stones&quot;];
	}
	else if (ship.primaryRole === &quot;rockhermit-chaotic&quot;) {
		var suitableContents = [&quot;radioactives&quot;, &quot;minerals&quot;, &quot;gold&quot;, &quot;platinum&quot;, &quot;gem_stones&quot;, &quot;narcotics&quot;, &quot;firearms&quot;, &quot;slaves&quot;];
	}
	else var suitableContents = null;
	if (suitableContents) {
		for (var i = 0; i &lt; pods.length; i++) {
			if (suitableContents.indexOf(pods[i].commodity) === -1) {
				pods[i].explode();
			}
		}
	}
	
	//pirate hermits are sometimes boobytrapped
	if (ship.primaryRole === &quot;rockhermit-pirate&quot; &amp;&amp; Math.random() &lt; 0.1) {
		var qbomb = ship.spawnOne(&quot;energy-bomb&quot;);
		qbomb.AIScript.shipWasDumped();
	}
}

this.shipBeingAttacked = function(whom) {
	//order those hardheaded morons to stop firing at the base. On top of being lousy aimers, they also have wax in their ears, hence 33.4 % chance of not hearing the order.
	if (whom.isPirate &amp;&amp; Math.random() &lt; 0.666) {
		whom.performFlyToRangeFromDestination();
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/spicy_hermits_star-jellies.js</td>
                    <td><pre>//Star-jellies from star-jellies OXP are spawned as asteroids and as such occasionally spawn close to hermits. Destruction of a star-jelly produces a cascading quirium explosion that takes care of the possible close by hermit too. This script pushes star-jellies, that are spawned in scanner range of a hermit, 25 km farther.

&quot;use strict&quot;;

this.name = &quot;spicy_hermits_star-jellies&quot;;

this.startUp = function() {
	
	//check for star-jelly oxp
	if (!Ship.keysForRole(&quot;star-jelly1&quot;)) {
		delete this.startUpComplete;
		delete this.shipExitedWitchspace;
	}
}

//push star-jellies farther from hermits right after the populator.
this.startUpComplete = this.shipWillExitWitchspace = function() {
	
	//find hermits
	var hermitRoles = [&quot;rockhermit&quot;, &quot;rockhermit-chaotic&quot;, &quot;rockhermit-pirate&quot;];
	var hermits = new Array();
	for (var i = 0; i &lt; hermitRoles.length; i++) {
		hermits = hermits.concat(system.shipsWithRole(hermitRoles[i]));
	}
	
	//find jellies close to hermits and move them farther
	var jellyRoles = [&quot;star-jelly1&quot;, &quot;star-jelly2&quot;, &quot;star-jelly-egg&quot;, &quot;star-jelly-larva&quot;];
	for (var i = 0; i &lt; hermits.length; i++) {
		var hermit = hermits[i];
		var jellies = new Array();
		for (var j = 0; j &lt; jellyRoles.length; j++) {
			jellies = jellies.concat(system.shipsWithRole(jellyRoles[j], hermit, 25E3));
		}
		var hermitPosition = hermit.position;
		for (var j = 0; j &lt; jellies.length; j++) {
			var jelly = jellies[j];
			var hjUnit = jelly.position.subtract(hermitPosition).direction();
			jelly.position = hermitPosition.add(hjUnit.multiply(25E3));
		}
	}
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
