<html>
    <head>
        <title>Expansion Glare Filter</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Glare Filter</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">2 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Paint your ship with electroactive polymer solution that filters sun glare. Three levels of filtering are possible by conducting electricity to the hull of the ship. When used, the coating gradually degrades and needs to be replaced.</td>
                    <td>Paint your ship with electroactive polymer solution that filters sun glare. Three levels of filtering are possible by conducting electricity to the hull of the ship. When used, the coating gradually degrades and needs to be replaced.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.spara.glare_filter</td>
                    <td>oolite.oxp.spara.glare_filter</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Glare Filter</td>
                    <td>Glare Filter</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>spara</td>
                    <td>spara</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.0</td>
                    <td>1.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://aegidian.org/bb/viewtopic.php?f=4&amp;t=16533">http://aegidian.org/bb/viewtopic.php?f=4&amp;t=16533</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/2/27/Glare_filter_1.0.oxz">https://wiki.alioth.net/img_auth.php/2/27/Glare_filter_1.0.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 3.0</td>
                    <td>CC-BY-NC-SA 3.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873255</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Glare%20Filter'>http://wiki.alioth.net/index.php/Glare%20Filter</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_GLARE_FILTER.html">Glare Filter</a></td>
                    <td>yes</td>
                    <td align="right">300</td>
                    <td align="center">2+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_GLARE_FILTER_REPLACE.html">Glare Filter</a></td>
                    <td>yes</td>
                    <td align="right">300</td>
                    <td align="center">2+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. 
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>this.name           = &quot;glare_filter&quot;;
this.author         = &quot;spara&quot;;
this.copyright      = &quot;2014 Mika Sp√•ra&quot;;
this.description    = &quot;Filter to diminish sun glare&quot;;
this.version        = &quot;1.0&quot;;
this.licence    	= &quot;CC BY-NC-SA 3.0&quot;;

//filter burns 2 * filter level in one second.
//0.6 -&gt; 120 seconds (2 mins)
//0.4 -&gt; 180 seconds (3 mins)
//0.2 -&gt; 300 seconds (5 mins)
//duration in seconds at 0.5 level
this.$fullFilterDuration = 144;

this.startUpComplete = function() {
	//set up timer
	if (player.ship.equipmentStatus(&quot;EQ_GLARE_FILTER&quot;) === &quot;EQUIPMENT_OK&quot;) {
		this.$initFilter();
		if (missionVariables.glareFilter)
			this.$filterDuration = missionVariables.glareFilter;
	}
	//three levels of filtering
	this.$filterLevels = [0.2, 0.4, 0.6];
	//current filter level
	this.$filterPointer = 1;
	//state of the equipment
	this.$filterOn = false;
}

this.playerBoughtEquipment = function(equipment) {
	if (equipment === &quot;EQ_GLARE_FILTER&quot;) {
		this.$initFilter();
	}
	if (equipment === &quot;EQ_GLARE_FILTER_REPLACE&quot;) {
		player.ship.awardEquipment(&quot;EQ_GLARE_FILTER&quot;);
		player.ship.removeEquipment(&quot;EQ_GLARE_FILTER_REPLACE&quot;);
		this.$initFilter();
	}
}

this.playerBoughtNewShip = function() {
	player.ship.removeEquipment(&quot;EQ_GLARE_FILTER&quot;);
}

this.playerWillSaveGame = function() {
	if (player.ship.equipmentStatus(&quot;EQ_GLARE_FILTER&quot;) === &quot;EQUIPMENT_OK&quot;)
		missionVariables.glareFilter = this.$filterDuration;
}

//turn the filter off when docking or witchspacing
this.shipWillDockWithStation = this.shipWillEnterWitchSpace = function() {
	if (this.$filterOn) this.$toggleOnOff();
}

this.$toggleOnOff = function() {
	if (this.$filterOn) {
		this.$filterTimer.stop();
		this.$filterOn = false;
		player.ship.sunGlareFilter = 0;
		player.consoleMessage(&quot;Glare Filter: Off.&quot;);
	}
	else {
		player.consoleMessage(&quot;Glare Filter: On.&quot;);
		this.$filterOn = true;
		player.ship.sunGlareFilter = this.$filterLevels[this.$filterPointer];
		this.$filterTimer.start();
	}
}

this.$adjustFilter = function() {
	//change filter level first locally
	var filterPointer = this.$filterPointer + 1;
	//over the top
	if (filterPointer &gt; 2) filterPointer = 0;
	
	//for console
	var filterLevels = [&quot;Low&quot;, &quot;Medium&quot;, &quot;High&quot;];
	
	//set the filter
	if (this.$filterOn)
		player.ship.sunGlareFilter = this.$filterLevels[filterPointer];
	//print out the message
	player.consoleMessage(&quot;Glare Filter: &quot; + filterLevels[filterPointer]+&quot;.&quot;);

	//update the global filter level pointer
	this.$filterPointer = filterPointer;	
}

//start the timer and reset the duration counter
this.$initFilter = function() {
	if (!this.$filterTimer)
		this.$filterTimer = new Timer(this, this.$burnFilter, 1, 1);
	this.$filterTimer.stop();
	this.$filterDuration = this.$fullFilterDuration;
}

//the actual burning function
this.$burnFilter = function() {
	//there&#39;s filter left and filter is active.
	if (this.$filterDuration &gt; 0 &amp;&amp; this.$filterOn) {
		//burn filter.
		this.$filterDuration = this.$filterDuration - player.ship.sunGlareFilter * 2;
		var percentageLeft = Math.round((this.$filterDuration / this.$fullFilterDuration) * 100);
		//print messages at 10, 20, ..., 90 %
		if (percentageLeft % 10 === 0 &amp;&amp; percentageLeft !== 100 &amp;&amp; percentageLeft !== 0)
			player.consoleMessage(&quot;Glare Filter: &quot; + percentageLeft + &quot; % left.&quot;);
		return;
	}
	//filter burned out
	if (this.$filterDuration &lt;= 0){
		player.ship.removeEquipment(&quot;EQ_GLARE_FILTER&quot;);
		player.consoleMessage(&quot;Glare Filter: Burned out.&quot;);
		player.ship.sunGlareFilter = 0;
		this.$filterOn = false;
		this.$filterTimer.stop();
	}
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/glare_filter.js</td>
                    <td><pre>this.name           = &quot;glare_filter_equipment&quot;;
this.author         = &quot;spara&quot;;
this.copyright      = &quot;2014 Mika Sp√•ra&quot;;
this.description    = &quot;Filter equipment&quot;;
this.version        = &quot;1.0&quot;;
this.licence    	= &quot;CC BY-NC-SA 3.0&quot;;

//equipment activation n
this.activated = function() {
	worldScripts.glare_filter.$toggleOnOff();
};

//equipment activation b
this.mode = function() {
	worldScripts.glare_filter.$adjustFilter();
};

//equipment can only be added by script
this.allowAwardEquipment = function(eqKey, ship, context) {
	if (worldScripts.glare_filter.$filterDuration === worldScripts.glare_filter.$fullFilterDuration) return false;
	return true;
};
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
