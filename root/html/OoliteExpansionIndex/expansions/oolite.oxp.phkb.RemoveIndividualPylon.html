<html>
    <head>
        <title>Expansion Remove Individual Pylon</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Remove Individual Pylon</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">1 Equipment</a></li>
          <li><a href="#ships">0 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">1 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Allows an individual pylon-mounted weapon to be removed.</td>
                    <td>Allows an individual pylon-mounted weapon to be removed.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.phkb.RemoveIndividualPylon</td>
                    <td>oolite.oxp.phkb.RemoveIndividualPylon</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Remove Individual Pylon</td>
                    <td>Remove Individual Pylon</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Equipment</td>
                    <td>Equipment</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>phkb</td>
                    <td>phkb</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.0</td>
                    <td>1.0</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Remove_Individual_Pylon_OXP">http://wiki.alioth.net/index.php/Remove_Individual_Pylon_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/7/7e/RemoveIndividualPylon.oxz">https://wiki.alioth.net/img_auth.php/7/7e/RemoveIndividualPylon.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC BY-NC-SA 4.0</td>
                    <td>CC BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1627014844</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Remove%20Individual%20Pylon'>http://wiki.alioth.net/index.php/Remove%20Individual%20Pylon</a></p>
        <h3>readme.txt</h3>
        <pre>Remove Individual Pylon
By Nick Rogers

Overview
========
This OXP allows individual pylon mounted weapons to be removed and sold.

Operations
==========
From the F3 Equip Ship screen, select the &quot;Unmount and sell single pylon mounted weapon&quot; item. This will display a screen where each of the currently mounted pylon weapons will be listed. Select the item you wish to remove and press enter. The item will be removed, and the full cost of the item will be refunded to you.

License
=======
This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 4.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/

Version History
===============
1.0
- Initial release.

</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_IND_MISSILE_REMOVAL.html">Unmount and sell single pylon mounted weapon</a></td>
                    <td>yes</td>
                    <td align="right">0</td>
                    <td align="center">2+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            This expansion declares no ships. 
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Config/script.js</td>
                    <td><pre>&quot;use strict&quot;;
this.author = &quot;phkb&quot;;
this.copyright = &quot;Â© 2021 phkb.&quot;;
this.licence = &quot;CC-BY-NC-SA 4.0&quot;;
this.name = &quot;RemoveIndividualPylon&quot;;
this.description = &quot;Script for removing an individual pylon-mounted weapon&quot;;

this._lastChoice = &quot;&quot;;

//-------------------------------------------------------------------------------------------------------------
this.startUpComplete = function() {
    if (worldScripts.EmailSystem) {
        worldScripts.GalCopAdminServices._purchase_ignore_equip.push(&quot;EQ_IND_MISSILE_REMOVAL&quot;);
    }
}

//-------------------------------------------------------------------------------------------------------------
this.playerBoughtEquipment = function (equipmentKey) {
    if (equipmentKey == &quot;EQ_IND_MISSILE_REMOVAL&quot;) {
        player.ship.removeEquipment(&quot;EQ_IND_MISSILE_REMOVAL&quot;);
        this.$showMissileRemovalScreen();
    }
}

//-------------------------------------------------------------------------------------------------------------
this.$showMissileRemovalScreen = function $showMissileRemovalScreen() {
    var curChoices = {};
	var itemcount = 0;
    var p = player.ship;
    var text = &quot;Select the pylon mounted weapon you want to sell and remove:&quot;;
	var pagesize = 17;
	if (this.$isBigGuiActive() === true) pagesize = 23;

    // any missiles?
    if (p.missileCapacity &gt; 0) {
        var flag = false;
        try {
            var miss = p.missiles;
            for (var i = 0; i &lt; miss.length; i++) {
                curChoices[&quot;01_MISSILE_&quot; + (i &lt; 10 ? &quot;0&quot; : &quot;&quot;) + i + &quot;~&quot; + i] = {text:&quot; -- &quot; + EquipmentInfo.infoForKey(miss[i].equipmentKey).name, alignment:&quot;LEFT&quot;};
                itemcount += 1;
            }
            if (itemcount == 0) text += &quot;\n\nNo pylon mounted weapons found.&quot;;
            flag = true;
        } catch (err) {
            text += &quot;\n\nComputer system malfunction - unable to access pylons!&quot;;
            if (this._debug) log(this.name, &quot;!!ERROR: &quot; + err);
        }
        if (flag === true) {

        }
    } else {
        text += &quot;\n\nShip has no pylons.&quot;;
    }

    for (var i = 0; i &lt; ((pagesize + 1) - itemcount); i++) {
        curChoices[&quot;90_SPACER_&quot; + i] = &quot;&quot;;
    }

    var def = &quot;99_EXIT&quot;;
    if (this._lastChoice != &quot;&quot;) def = this._lastChoice;
    curChoices[&quot;99_EXIT&quot;] = {text: &quot;Return&quot;};
    
    var opts = {
        screenID: &quot;oolite-sellpylon-map&quot;,
        title: &quot;Sell Pylon Mounted Weapon&quot;,
        exitScreen: &quot;GUI_SCREEN_EQUIP_SHIP&quot;,
        choices: curChoices,
        initialChoicesKey: def,
        message: text
    };

    mission.runScreen(opts, this.$screenHandler, this);
}

//-------------------------------------------------------------------------------------------------------------
this.$screenHandler = function $screenHandler(choice) {
    if (!choice) return;

    if (choice.indexOf(&quot;01_MISSILE&quot;) &gt;= 0) {
        var idx = parseInt(choice.substring(choice.indexOf(&quot;~&quot;) + 1));
        var eq = player.ship.missiles[idx].equipmentKey;
        var info = EquipmentInfo.infoForKey(eq);
        player.ship.removeEquipment(eq);
        player.credits += parseInt(info.price / 10);
        player.consoleMessage(&quot;You have been refunded &quot; + formatCredits(parseInt(info.price / 10), false, true));

        // reset the last choice so we auto-select the next missile, if there is one to select
        if (player.ship.missiles.length = idx) idx -= 1;
        if (player.ship.missiles.length = 0) {
            this._lastChoice = &quot;&quot;;
        } else {
            this._lastChoice = &quot;01_MISSILE_&quot; + (idx &lt; 10 ? &quot;0&quot; : &quot;&quot;) + idx + &quot;~&quot; + idx;
        }
    }

    if (choice != &quot;99_EXIT&quot;) this.$showMissileRemovalScreen();
}

//-------------------------------------------------------------------------------------------------------------
// returns true if a HUD with allowBigGUI is enabled, otherwise false
this.$isBigGuiActive = function $isBigGuiActive() {
	if (oolite.compareVersion(&quot;1.83&quot;) &lt;= 0) {
		return player.ship.hudAllowsBigGui;
	} else {
		var bigGuiHUD = [&quot;XenonHUD.plist&quot;, &quot;coluber_hud_ch01-dock.plist&quot;]; // until there is a property we can check, I&#39;ll be listing HUD&#39;s that have the allow_big_gui property set here
		if (bigGuiHUD.indexOf(player.ship.hud) &gt;= 0) {
			return true;
		} else {
			return false;
		}
	}
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
