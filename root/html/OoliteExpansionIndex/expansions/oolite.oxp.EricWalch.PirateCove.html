<html>
    <head>
        <title>Expansion Pirate Cove</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Pirate Cove</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">1 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">2 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>License not specified</li>
                <li>XML Manifest found</li>
                <li>Unknown key &#39;licence&#39; in XML manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Adds pirate bases to te system that are situated in rock hermits.</td>
                    <td>Adds pirate bases to te system that are situated in rock hermits.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.EricWalch.PirateCove</td>
                    <td>oolite.oxp.EricWalch.PirateCove</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Pirate Cove</td>
                    <td>Pirate Cove</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Ambience</td>
                    <td>Ambience</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Lazy Gun &amp; Eric Walch</td>
                    <td>Lazy Gun &amp; Eric Walch</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.4.2</td>
                    <td>1.4.2</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Pirate_Coves_OXP">http://wiki.alioth.net/index.php/Pirate_Coves_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/1/13/Pirate_Coves_1.4.2.oxz">https://wiki.alioth.net/img_auth.php/1/13/Pirate_Coves_1.4.2.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873237</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Pirate%20Cove'>http://wiki.alioth.net/index.php/Pirate%20Cove</a></p>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/pirate-cove.html">pirate-cove</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/pirateCove.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;Pirate_Coves&quot;; 
this.author      = &quot;lazygun (JS adaption by EW)&quot;; 
this.copyright   = &quot;lazygun&quot;; 
this.description = &quot;Adds pirate coves to the system.&quot;; 
this.version     = &quot;1.4.2&quot;; 


this.startUp = function ()
{
    // restore the systems were a pirate cove is missing
    if (missionVariables.pirate_cove_systems)
    {
            this.pirateCoveSystems = JSON.parse(missionVariables.pirate_cove_systems);
    }
    else
    {
            this.pirateCoveSystems = new Array(256);
    }
    
    this.resetTimer = new Timer(this, this.shipExitedWitchspace, 0.1); // already add station before first launch
    this.basicDefenders = Math.round(Math.log(1 + player.score));
};

this.playerWillSaveGame = function()
{
    // encode the systems were a pirate cove is missing
    missionVariables.pirate_cove_systems = JSON.stringify(this.pirateCoveSystems);
}

this.playerEnteredNewGalaxy = function ()
{
    // reset the systems
    this.pirateCoveSystems = new Array(256);
}

this.shipExitedWitchspace = function ()
{
    // Test for [System.countShipsWithRole(&quot;pirate-cove&quot;) == 0] because the populater might already have added them as rock hermit replacement.
    if (!system.isInterstellarSpace &amp;&amp; system.countShipsWithRole(&quot;pirate-cove&quot;) === 0 &amp;&amp; !system.sun.hasGoneNova)
    {
		var isDead = this.pirateCoveSystems[system.ID];

		if (isDead == undefined || (isDead &amp;&amp; (isDead + 20 &lt; clock.days)))
		{
			this.$initialiseSystem();
        }
		
		if (!this.pirateCoveSystems[system.ID])
		{
			this.$addRockHermit();
		}
	}
};

this.$initialiseSystem = function ()
{
    // initialise
    if (system.countShipsWithPrimaryRole(&quot;pirate&quot;) &gt; 9)
    {
        this.pirateCoveSystems[system.ID] = false; // allow stations untill killed.
    }
    else
    {
        this.pirateCoveSystems[system.ID] = clock.days; // don&#39;t allow a station for the next 20 days.
    }
}


this.$addRockHermit = function ()
{
    var random = this.$random(); // use a &#39;fixed&#39; random to make it predictable by system.
    var coordinateSystem =  (random&lt; 0.1) ? &quot;ps&quot; : &quot;wp&quot;;
    var station = system.addShipsToRoute(&quot;rockhermit&quot;, 1, 0.10+random*0.3, coordinateSystem)[0];
    station.orientation = [1,0,0,0]; // orientate it along the z-axis like oolite hermits.
    var asteroidCount = Math.ceil(3 + random*8);
    system.addShips(&quot;asteroid&quot;, asteroidCount, station.position, 15000);
    if (station.scanClass == &quot;CLASS_POLICE&quot;) return; // e.g. the astromine from commies.oxp, that should not be changed.
    station.setAI(&quot;pirateCoveAI.plist&quot;);
    station.setScript(&quot;pirateCoveRock.js&quot;);
    station.hasNPCTraffic = false; // we don&#39;t want trader launches. Happens otherwise by default on rotating hermits.
    station.script.defenderCount = this.basicDefenders + Math.floor(Math.random()*3);
    if (station.scanClass == &quot;CLASS_NEUTRAL&quot;)
    {
    	// not all hermits have a scanclass defined.
    	if (0 &gt;= oolite.compareVersion(&quot;1.77&quot;))
    	{
    		station.scanClass = &quot;CLASS_ROCK&quot;;
    	}
    	else
    	{
    		// scanClass is read-only in older Oolite versions.
    		station.scannerDisplayColor1 = &quot;whiteColor&quot;; 
    	}
    }
};

this.$random = function ()
{
    // return mostly the same value, but change over time.
    var salt = (clock.days &amp; 0xE0) + 15; // change once every 32 days
    return system.scrambledPseudoRandomNumber(salt);
};</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/pirateCoveRock.js</td>
                    <td><pre>&quot;use strict&quot;;
this.name        = &quot;Pirate Cove Rock&quot;; 
this.author      = &quot;eric walch&quot;; 
this.description = &quot;Script for the Pirate_Cove Rock by Lazy Gun&quot;; 
this.version     = &quot;1.4.2&quot;; 


this.defenderCount = 6;  // defenderCount is redefined by the main script.

this.shipSpawned = function ()
{
    this.ship.primaryRole = &quot;pirate-cove&quot;; // needed to set the market correct.
    this.maxAirbornDefenders = 3 + Math.floor(Math.random() * 4);
    if (player.score &gt; 512) this.maxAirbornDefenders++;
    if (player.score &gt; 6400) this.maxAirbornDefenders++;
}

// Correct clean hits.
this.shipBeingAttacked = function (attacker)
{
    if (attacker &amp;&amp; attacker.owner === this.ship &amp;&amp; attacker.target === this.ship)
	{
		attacker.reactToAIMessage(&quot;TARGET_LOST&quot;);
		log(this.name, &quot;Pirate cove was friendly hit by: &quot; + attacker.displayName);
	}
}


this.stationLaunchedShip = function (ship)
{
    if (ship.primaryRole === &quot;defense_ship&quot;) ship.switchAI(&quot;pirateCovePirateAI.plist&quot;);
	if (ship.primaryRole === &quot;scavenger&quot;  &amp;&amp; !ship.bounty) ship.bounty = 5 + Math.random() * 25;
	if (ship.primaryRole === &quot;escort&quot;  &amp;&amp; !ship.bounty) ship.bounty = 5 + Math.random() * 15;
}

this.otherShipDocked = function (ship)
{
    if (ship.isPlayer) this.ship.displayName = &quot;Pirate Cove&quot;; // we are spotted!
    if (ship.primaryRole == &quot;pirate&quot;) this.defenderCount++;
}

/*
In addition to the below launched pirates, the AI can also launch pirates as defense ships
when directly attacked.
*/
this.$launchDefender = function ()
{
    if (this.defenderCount &gt; 0 &amp;&amp; this.ship.target
             &amp;&amp; this.ship.position.distanceTo(this.ship.target.position) &lt; 15000
             &amp;&amp; this.ship.group.count &lt; this.maxAirbornDefenders)
    {
        var defender = this.ship.launchShipWithRole(&quot;pirate&quot;);
        if (defender)
        {
            defender.switchAI(&quot;pirateCovePirateAI.plist&quot;);
            defender.target = this.ship.target;
            this.ship.group.addShip(defender);
            defender.group = this.ship.group;
            if (!this.ship.bounty &amp;&amp; this.ship.target.isPlayer)
            {
            	 this.ship.bounty = (this.ship.scanClass == &quot;CLASS_NEUTRAL&quot;) ? 100: 1000; // the cove is no longer clean now.
            }
            this.defenderCount--;
        }
    }
};

this.shipDied = function ()
{
	// store the time of death
	worldScripts.Pirate_Coves.pirateCoveSystems[system.ID] = clock.days;	
};</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
