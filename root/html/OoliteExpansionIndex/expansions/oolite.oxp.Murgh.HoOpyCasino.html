<html>
    <head>
        <title>Expansion HoOpy Casino</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:48 PM</small></td>
            </tr>
        </table>

        <h1>Expansion HoOpy Casino</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">0 Equipment</a></li>
          <li><a href="#ships">82 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">6 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>License not specified</li>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN CAPITAL LETTER C)(&#39;[]&#39; vs &#39;[Casino, Gambling]&#39;)</li>
                <li>Unknown key &#39;licence&#39; at https://wiki.alioth.net/img_auth.php/6/6f/HOopyCasino1.3.5.oxz!manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Commanders who chose to dock with a HoOpy Casino are quickly ushered into the vast gaming halls, here to be offered the opportunity to win or lose credits in games of chance.</td>
                    <td>Commanders who chose to dock with a HoOpy Casino are quickly ushered into the vast gaming halls, here to be offered the opportunity to win or lose credits in games of chance.</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Murgh.HoOpyCasino</td>
                    <td>oolite.oxp.Murgh.HoOpyCasino</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>HoOpy Casino</td>
                    <td>HoOpy Casino</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Dockables</td>
                    <td>Dockables</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Eric Walch, Murgh, CaptSolo, spara</td>
                    <td>Eric Walch, Murgh, CaptSolo, spara</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.3.5</td>
                    <td>1.3.5</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>Casino, Gambling</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/HoOpy_Casino">http://wiki.alioth.net/index.php/HoOpy_Casino</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/6/6f/HOopyCasino1.3.5.oxz">https://wiki.alioth.net/img_auth.php/6/6f/HOopyCasino1.3.5.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873331</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/HoOpy%20Casino'>http://wiki.alioth.net/index.php/HoOpy%20Casino</a></p>
        <h3>ReadMe.rtf</h3>
        <pre>{\rtf1\ansi\deff3\adeflang1025
{\fonttbl{\f0\froman\fprq2\fcharset0 Times New Roman;}{\f1\froman\fprq2\fcharset2 Symbol;}{\f2\fswiss\fprq2\fcharset0 Arial;}{\f3\froman\fprq2\fcharset0 Liberation Serif{\*\falt Times New Roman};}{\f4\froman\fprq2\fcharset0 Liberation Sans{\*\falt Arial};}{\f5\froman\fprq2\fcharset0 Helvetica{\*\falt Arial};}{\f6\fnil\fprq2\fcharset0 FreeSans;}{\f7\fnil\fprq2\fcharset0 Liberation Serif{\*\falt Times New Roman};}}
{\colortbl;\red0\green0\blue0;\red0\green0\blue255;\red0\green255\blue255;\red0\green255\blue0;\red255\green0\blue255;\red255\green0\blue0;\red255\green255\blue0;\red255\green255\blue255;\red0\green0\blue128;\red0\green128\blue128;\red0\green128\blue0;\red128\green0\blue128;\red128\green0\blue0;\red128\green128\blue0;\red128\green128\blue128;\red192\green192\blue192;}
{\stylesheet{\s0\snext0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057 Normal;}
{\s15\sbasedon0\snext16\ql\nowidctlpar\sb240\sa120\keepn\ltrpar\cf1\kerning1\dbch\af6\langfe1081\dbch\af7\afs24\loch\f4\fs28\lang2057 Heading;}
{\s16\sbasedon0\snext16\sl288\slmult1\ql\nowidctlpar\sb0\sa140\ltrpar\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\loch\f3\fs24\lang2057 Text Body;}
{\s17\sbasedon16\snext17\sl288\slmult1\ql\nowidctlpar\sb0\sa140\ltrpar\cf1\kerning1\dbch\af6\langfe1081\dbch\af7\afs24\loch\f3\fs24\lang2057 List;}
{\s18\sbasedon0\snext18\ql\nowidctlpar\sb120\sa120\ltrpar\cf1\i\kerning1\dbch\af6\langfe1081\dbch\af7\afs24\loch\f3\fs24\lang2057 Caption;}
{\s19\sbasedon0\snext19\ql\nowidctlpar\ltrpar\cf1\kerning1\dbch\af6\langfe1081\dbch\af7\afs24\loch\f3\fs24\lang2057 Index;}
}{\*\generator LibreOffice/5.2.0.4$Linux_X86_64 LibreOffice_project/20m0$Build-4}{\info{\creatim\yr0\mo0\dy0\hr0\min0}{\revtim\yr2016\mo8\dy29\hr18\min46}{\printim\yr0\mo0\dy0\hr0\min0}}{\*\userprops}\deftab720
\viewscale110
{\*\pgdsctbl
{\pgdsc0\pgdscuse451\pgwsxn11906\pghsxn16838\marglsxn1440\margrsxn1440\margtsxn1440\margbsxn1440\pgdscnxt0 Default Style;}}
\formshade{\*\pgdscno0}\paperh16838\paperw11906\margl1440\margr1440\margt1440\margb1440\sectd\sbknone\sectunlocked1\pgndec\pgwsxn11906\pghsxn16838\marglsxn1440\margrsxn1440\margtsxn1440\margbsxn1440\ftnbj\ftnstart1\ftnrstcont\ftnnar\aenddoc\aftnrstcont\aftnstart1\aftnnrlc
{\*\ftnsep}\pgndec\pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b\dbch\af6\rtlch \ltrch\loch\fs34\loch\f5
Hoopy Casino}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\fs28\loch\f5
By Murg}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar\b0\dbch\af6\rtlch \ltrch\loch\fs28\loch\f5

\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\fs28\loch\f5
Version 1.3.2}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\fs22\loch\f5
(Requires Oolite 1.80 or newer.)}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar\b\dbch\af6\rtlch \ltrch\loch\fs34\loch\f5

\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b\dbch\af6\rtlch \ltrch\loch\fs34\loch\f5
Overview}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
Multi-billionaire and FurCorp heiress Magda DeMug first dabbled in commercial enterprises founding CoachWhip Inc. Her fleet of CoachWhip luxury liners provide a first class transport service to well-healed business executives, VIPs and anyone else who can afford the 5,000 Cr ticket price. Having established a profitable enterprise fleecing the idle rich, the heiress turned her acute feline business mind to the question of sucking credits from the pockets of the proletariat.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
The basic hull of the CoachWhip liner was completely stripped, removing the cargo bay, hyperspace drive and inter-system drive. A docking port was added and the internal structure re-fitted as a luxurious Casino. The platforms were then deployed in geo-stationary orbit near the main GalCop Station in technologically advanced systems throughout the eight galaxies. Thus was the Chain of HoOpy Casinos born. These dens of inequity are found in all systems with a Tech Level of 11 or more. In such a system, setting an Advanced Space Compass to C will locate the nearest HoOpy Casino.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar\b0\dbch\af6\rtlch \ltrch\loch\loch\f5

\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar\b0\dbch\af6\rtlch \ltrch\loch\loch\f5

\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b\dbch\af6\rtlch \ltrch\loch\fs34\loch\f5
The HoOpy Casino Chain}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
Commanders who chose to dock with a HoOpy Casino are quickly ushered into the vast gaming halls, here to be offered the opportunity to win or lose credits in games of chance.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
Some Commanders never leave the casino area of the station, claiming that they have a system to \u8216\&#39;91beat the hoops\u8217\&#39;92. These doomed lost souls can often be seen wagering their Credits, ship, left kidney or spouse on just one more throw of the hoops.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
Commanders of a more level-headed nature visit HoOpy Casinos for the purpose of trading. Those who can resist the charms of the complementary drinks and scantily clad croupiers available in the main casino area of the orbital platform may engage in trading on the Station\u8217\&#39;92s commodity market. The Casinos often have a surplus or deficient of certain goods and thus a canny trader can sometimes make more profit by off-loading or purchasing his cargo at the Casino rather than the system\u8217\&#39;92s GalCop station.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
The Casino is protected by a reasonably strong shield, although it carries no weapons. The Casino Managment rely on the fact that the casino closely orbits the GalCop Station, which will launch Vipers to defend the orbital platform from attack. Additionally a small fleet of Security Sidewinders in HoOpy livery are stationed aboard to defend the Casino if need be.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar\b0\dbch\af6\rtlch \ltrch\loch\loch\f5

\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
(Background story by Little Bear)}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar\b0\dbch\af6\rtlch \ltrch\loch\loch\f5

\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
(Original JS scripting by Paul Wilkins &amp; Eric Walch)}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar\dbch\af6\rtlch \ltrch\loch

\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
Update (1.3) for Oolite 1.80 by CaptSolo &amp; spara.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* New and retouched textures and flashy shader effects by CaptSolo. Shader by Griff, Neon sign model Arexic_Heretic. Docking bay by Griff.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* BGS docking tunnel texture by spara}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* Sidewinder defenders updated to Griff&#39;s model.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* Script restructured and updated to spawn with 1.80 populator by spara.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* Station welcome screen is removed and games are moved to station interfaces (F4).}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* Station AI tweaked to be more aggressive against attacking. Code borrowed from YAH.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* Two new gambling games: Smuggler&#39;s Run dice game and Video Poker. Scripting by spara. Card model and textures by CaptSolo. Sound effects are borrowed from Oolite. Dice game graphics by spara with two screenshots by Cody and Redspear.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar\rtlch \ltrch\loch

\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
Update (1.3.1)}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* New gambling game: Blackjack.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* Backgrounds added to the gard games.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar\rtlch \ltrch\loch

\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{{\*\bkmkstart __DdeLink__38_506304518}{\*\bkmkend __DdeLink__38_506304518}\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
Update (1.3.2)}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* New gambling game: hOopy Hold&#39;em. }
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* Market stripped to gems, gold and platinum. In 1.80 prices follow the main station rules. In 1.81 prices are 10% below main station. In other words market is solely meant for exchanging valuables to play credits, with 10% commission.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* AI rewitten to JS. Casino now cruises around the main station at the edge of the Aegis.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar\rtlch \ltrch\loch

\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
Update (1.3.3)}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{{\*\bkmkstart __DdeLink__45_986228504}{\*\bkmkend __DdeLink__45_986228504}\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* AI finished.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar\rtlch \ltrch\loch

\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
Update (1.3.4)}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* No shader neonsign added.}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\hyphpar0\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
Update (1.3.}{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
5}{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
)}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\hyphpar0\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* Holdem }{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
bugfixed}
\par \pard\plain \s0\ql\nowidctlpar\ltrpar\hyphpar0\cf1\kerning1\dbch\af7\langfe1081\dbch\af7\afs24\alang1081\loch\f3\fs24\lang2057\ql\nowidctlpar\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\hyphpar0\ltrpar{\b0\dbch\af6\rtlch \ltrch\loch\loch\f5
* Shiny cards}
\par }</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            This expansion declares no equipment. This may be related to warnings.
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/casinoship.html">CoachWhip hOopy Casino</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/casinoship_dockingbay.html">casinoship_dockingbay</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/casinoship_neonsign.html">Neon Sign</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_back.html">hoopy_blackjack_card_back</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos1.html">Video Poker Card</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos10.html">hoopy_blackjack_card_pos10</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos11.html">hoopy_blackjack_card_pos11</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos12.html">hoopy_blackjack_card_pos12</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos13.html">hoopy_blackjack_card_pos13</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos14.html">hoopy_blackjack_card_pos14</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos15.html">hoopy_blackjack_card_pos15</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos16.html">hoopy_blackjack_card_pos16</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos17.html">hoopy_blackjack_card_pos17</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos18.html">hoopy_blackjack_card_pos18</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos19.html">hoopy_blackjack_card_pos19</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos2.html">hoopy_blackjack_card_pos2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos20.html">hoopy_blackjack_card_pos20</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos21.html">hoopy_blackjack_card_pos21</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos22.html">hoopy_blackjack_card_pos22</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos23.html">hoopy_blackjack_card_pos23</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos24.html">hoopy_blackjack_card_pos24</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos25.html">hoopy_blackjack_card_pos25</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos26.html">hoopy_blackjack_card_pos26</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos27.html">hoopy_blackjack_card_pos27</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos28.html">hoopy_blackjack_card_pos28</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos29.html">hoopy_blackjack_card_pos29</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos3.html">hoopy_blackjack_card_pos3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos30.html">hoopy_blackjack_card_pos30</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos31.html">hoopy_blackjack_card_pos31</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos32.html">hoopy_blackjack_card_pos32</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos33.html">hoopy_blackjack_card_pos33</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos34.html">hoopy_blackjack_card_pos34</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos35.html">hoopy_blackjack_card_pos35</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos36.html">hoopy_blackjack_card_pos36</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos37.html">hoopy_blackjack_card_pos37</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos38.html">hoopy_blackjack_card_pos38</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos39.html">hoopy_blackjack_card_pos39</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos4.html">hoopy_blackjack_card_pos4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos40.html">hoopy_blackjack_card_pos40</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos41.html">hoopy_blackjack_card_pos41</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos42.html">hoopy_blackjack_card_pos42</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos43.html">hoopy_blackjack_card_pos43</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos44.html">hoopy_blackjack_card_pos44</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos45.html">hoopy_blackjack_card_pos45</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos46.html">hoopy_blackjack_card_pos46</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos47.html">hoopy_blackjack_card_pos47</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos48.html">hoopy_blackjack_card_pos48</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos49.html">hoopy_blackjack_card_pos49</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos5.html">hoopy_blackjack_card_pos5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos50.html">hoopy_blackjack_card_pos50</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos51.html">hoopy_blackjack_card_pos51</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos52.html">hoopy_blackjack_card_pos52</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos53.html">hoopy_blackjack_card_pos53</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos54.html">hoopy_blackjack_card_pos54</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos55.html">hoopy_blackjack_card_pos55</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos6.html">hoopy_blackjack_card_pos6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos7.html">hoopy_blackjack_card_pos7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos8.html">hoopy_blackjack_card_pos8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_blackjack_card_pos9.html">hoopy_blackjack_card_pos9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_casino_blackjack_card.html">Video Blackjack Card</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_casino_blackjack_intro.html">hoopy_casino_blackjack_intro</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_casino_holdem_card.html">Video Poker Card</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_casino_holdem_intro.html">hoopy_casino_holdem_intro</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_casino_poker_card.html">Video Poker Card</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_casino_poker_card_spin.html">hoopy_casino_poker_card_spin</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_holdem_card_back.html">hoopy_holdem_card_back</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_holdem_card_pos1.html">Video Hold&#39;em Card</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_holdem_card_pos2.html">hoopy_holdem_card_pos2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_holdem_card_pos3.html">hoopy_holdem_card_pos3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_holdem_card_pos4.html">hoopy_holdem_card_pos4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_holdem_card_pos5.html">hoopy_holdem_card_pos5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_holdem_card_pos6.html">hoopy_holdem_card_pos6</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_holdem_card_pos7.html">hoopy_holdem_card_pos7</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_holdem_card_pos8.html">hoopy_holdem_card_pos8</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_holdem_card_pos9.html">hoopy_holdem_card_pos9</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_poker_card_back.html">hoopy_poker_card_back</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_poker_card_pos1.html">Video Poker Card</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_poker_card_pos2.html">hoopy_poker_card_pos2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_poker_card_pos3.html">hoopy_poker_card_pos3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_poker_card_pos4.html">hoopy_poker_card_pos4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/hoopy_poker_card_pos5.html">hoopy_poker_card_pos5</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/sidewinder-casinodefender.html">Sidewinder Casino Security</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/hoopy_blackjack.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;hoopy_blackjack&quot;;
this.author = &quot;spara&quot;;
this.copyright = &quot;2014 spara&quot;;
this.license     = &quot;CC BY-NC-SA 4.0&quot;; 

//add interface
this.startUpComplete = this.shipExitedWitchspace = function() {
	var casinos = system.shipsWithPrimaryRole(&quot;casinoship&quot;);
	if (casinos.length &gt; 0) {
		for (var i = 0; i &lt; casinos.length; i++) {
			casinos[i].setInterface(&quot;hoopy-blackjack&quot;,{
				title: &quot;Blackjack&quot;,
				category: expandMissionText(&quot;hoopy-gambling-category&quot;),
				summary: expandMissionText(&quot;hoopy-blackjack-summary&quot;),
				callback: this.$intro.bind(this)
			});
		}
	}
}

//init a new deck
this.$virginDeck = function() {
	var deck = new Array();
	var suits = [&quot;triangle&quot;, &quot;crescent&quot;, &quot;square&quot;, &quot;star&quot;];
	for (var i = 0; i &lt; 4; i++) {
		for (var j = 1; j &lt; 14; j++) {
			var card = new Object();
			card.suit = suits[i];
			card.rank = j;
			card.double = 0; 
			card.hide = 0;
			if (j &gt; 10) card.value = 10;
			else if (j === 1) card.value = 11;
			else card.value = card.rank;
			deck.push(card);
		}
	}
	return deck;
}

//calculate the value of a hand
this.$calculateHandValue = function(cards) {
	var finished = false;
	while (!finished) {
		var sum = 0;
		for (var i = 0; i &lt; cards.length; i++) {
			sum += cards[i].value;
		}
		if (sum &gt; 21) {
			//change aces&#39; value from 11 to 1
			for (var i = 0; i &lt; cards.length; i++) {
				if (cards[i].value === 11) {
					cards[i].value = 1;
					break;
				}
			}
			//all aces have been changed, sum stands.
			if (i === cards.length)
				finished = true;
		}
		else finished = true;
	}
	return sum;
}

//intro screen
this.$intro = function() {

	var credits = &quot;\n&quot; + expandMissionText(&quot;hoopy-credits&quot;)+formatCredits(player.credits, true, true);

	//gambling choices
	var options = {
		&quot;1_EXIT&quot; : &quot;Exit&quot;
	};
	if (player.credits &gt;= 10)
		options[&quot;2_10&quot;] = &quot;Bet &quot; + formatCredits(10, true, true);
	else credits += expandMissionText(&quot;hoopy-no-credit&quot;);
	if (player.credits &gt;= 100)
		options[&quot;3_50&quot;] = &quot;Bet &quot; + formatCredits(50, true, true);
	if (player.credits &gt;= 500)
		options[&quot;4_100&quot;] = &quot;Bet &quot; + formatCredits(100, true, true);	
	
	mission.runScreen({
		titleKey: &quot;hoopy-blackjack-title&quot;,
		message: expandMissionText(&quot;hoopy-blackjack-intro-story&quot;) + credits,
		model: &quot;hoopy_casino_blackjack_card_intro&quot;,
		background: &quot;hoopy_table_bg.png&quot;,
		choices: options,
		allowInterrupt: true,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;
	},
	function (choice) {
		if (choice === &quot;2_10&quot;) this.$playGame(10);
		else if (choice === &quot;3_50&quot;) this.$playGame(50);
		else if (choice === &quot;4_100&quot;) this.$playGame(100);
	});
}

//first pay, then deal
this.$playGame = function(bet) {
	
	//pay up first
	player.credits -= bet;
	this.$bet = bet;//initial bet
	this.$totalBet = bet;//sum of all bets in round
	
	//init a new deck
	this.$playDeck = this.$virginDeck();
	
	//dealer initial hand
	var dealerHand = new Object();
	dealerHand.cards = [this.$drawCard(), this.$drawCard()];
	dealerHand.cards[1].hide = 1;
	this.$dealerHands = [dealerHand];
	
	//player initial hand
	var playerHand = new Object();
	playerHand.cards = [this.$drawCard(), this.$drawCard()];
	playerHand.bet = bet;
	this.$playerHands = [playerHand];

	//lets play some blackjack
	this.$deal(0);
}

this.$updateHandProps = function(hand, hands) {
	hand.value = this.$calculateHandValue(hand.cards);
	if (hand.value === 21) {
		if (hands.length === 1 &amp;&amp; hand.cards.length === 2) {
			hand.status = &quot;blackjack&quot;;
		}
		else hand.status = &quot;21&quot;;
	}
	else if (hand.value &gt; 21) hand.status = &quot;busted&quot;;
	else if (hand.status !== &quot;stand&quot;) hand.status = &quot;hit&quot;;
}

//Deal
this.$deal = function() {
	
	//rotate till playable hand
	for (var hand = 0; hand &lt; this.$playerHands.length; hand++) {
		var playerHand = this.$playerHands[hand];
		this.$updateHandProps(playerHand, this.$playerHands);
		if (playerHand.value &lt; 21 &amp;&amp; playerHand.status !== &quot;stand&quot;)
			break;
	}
	
	//dealer&#39;s turn?
	if (hand === this.$playerHands.length) {
		this.$resolve();
		return;
	}
	
	//choices
	var options = {};
	if (playerHand.status === &quot;hit&quot;) {
		options[&quot;1_HIT&quot;] = &quot;Hit&quot;;
		options[&quot;2_STAND&quot;] = &quot;Stand&quot;;
	}
	if (playerHand.cards.length === 2 &amp;&amp; playerHand.status === &quot;hit&quot; &amp;&amp; player.credits &gt;= this.$bet) {
		options[&quot;3_DOUBLE&quot;] = &quot;Double Down (&quot;+formatCredits(this.$bet, true, true)+&quot;)&quot;;
	}
	if (playerHand.cards.length === 2 &amp;&amp; (playerHand.cards[0].value === playerHand.cards[1].value || playerHand.cards[0].rank === playerHand.cards[1].rank) &amp;&amp; this.$playerHands.length &lt; 4) {
		options[&quot;4_SPLIT&quot;] = &quot;Split (&quot;+formatCredits(this.$bet, true, true)+&quot;)&quot;;
	}
	if (playerHand.cards.length === 2 &amp;&amp; this.$playerHands.length === 1) {
		options[&quot;5_SURRENDER&quot;] = &quot;Surrender&quot;;
	}

	//status message
	var message = &quot;Player hand: &quot; + playerHand.value + &quot;\n\n&quot;;
	message += &quot;Total bet: &quot; + formatCredits(this.$totalBet, true, true);
	message += &quot;\nCredits: &quot; + formatCredits(player.credits, true, true);

	mission.runScreen({
		titleKey: &quot;hoopy-blackjack-title&quot;,
		model: &quot;hoopy_casino_blackjack_card_base&quot;,
		background: &quot;hoopy_table_bg.png&quot;,
		message: message,
		spinModel: false,
		choices: options,
	},
	function (choice) {
		if (choice === &quot;1_HIT&quot;) {
			playerHand.cards.push(this.$drawCard());
			this.$deal();
			return;
		}
		else if (choice === &quot;2_STAND&quot;) {
			playerHand.status = &quot;stand&quot;;
			this.$deal();
			return;
		}
		else if (choice === &quot;3_DOUBLE&quot;) {
			playerHand.cards.push(this.$drawCard());
			this.$updateHandProps(playerHand, this.$playerHands);
			if (playerHand.value &lt; 21) playerHand.status = &quot;stand&quot;;
			player.credits -= this.$bet;
			this.$totalBet += this.$bet;
			playerHand.bet = 2 * playerHand.bet;
			this.$deal();
			return;
		}
		else if (choice === &quot;4_SPLIT&quot;) {
			
			//limit to one card after splitting aces!!!!!!!
			if (playerHand.cards[0].rank === 1) {
				playerHand.cards[0].value = 11;
				playerHand.cards[1].value = 11;
			}
			player.credits -= this.$bet;
			this.$totalBet += this.$bet;
			var newHand = new Object();
			newHand.cards = [playerHand.cards.pop(), this.$drawCard()];
			newHand.bet = this.$bet;
			this.$playerHands.push(newHand);
			playerHand.cards.push(this.$drawCard());
			this.$deal();
			return;
		}
		else if (choice === &quot;5_SURRENDER&quot;) {
			playerHand.status = &quot;surrender&quot;;
			this.$resolve();
			return;
		}
		else {
			this.$intro();
			return;
		}
	}
	);
	
	this.$updateScreen();
	
	//update flasher markers
	//while playing: yellow - current hand, red - busted hand
	for (var i = 0; i &lt; this.$playerHands.length; i++) {
		var status = this.$playerHands[i].status;
		if (i === hand)
			mission.displayModel.flashers[i].color = &quot;yellowColor&quot;;
		else if (status === &quot;busted&quot;)
			mission.displayModel.flashers[i].color = &quot;redColor&quot;;
		else {
			mission.displayModel.flashers[i].position = [0, 0, 50];
		}
	}
	for (var j = i; j &lt; 4; j++)
		mission.displayModel.flashers[j].position = [0, 0, 50];
}

this.$resolve = function() {

	var dealerHand = this.$dealerHands[0];
	this.$updateHandProps(dealerHand, this.$dealerHands);
	dealerHand.cards[1].hide = false;

	//check player for non-busted hands
	var busted = true;
	for (var i = 0; i &lt; this.$playerHands.length; i++) {
		if (this.$playerHands[i].status !== &quot;busted&quot;) {
			busted = false;
			break;
		}
	}

	//if all player cards are busted, dealer automatically wins
	if (busted || this.$playerHands[i].status === &quot;surrender&quot;) {
		for (var i = 0; i &lt; this.$playerHands.length; i++) {
			this.$playerHands[i].result = &quot;loss&quot;;
		}
	}
	else {
		//start drawing cards until we go over 16.
		while (dealerHand.value &lt; 17) {
			dealerHand.cards.push(this.$drawCard());
			this.$updateHandProps(dealerHand, this.$dealerHands);
		}
		//compare player hands to the dealer hand
		for (var i = 0; i &lt; this.$playerHands.length; i++) {
			var playerHand = this.$playerHands[i];
			//if the player has not busted, we&#39;ll compare
			if (playerHand.status !== &quot;busted&quot;) {
				//blackjack
				if (playerHand.status === &quot;blackjack&quot;) {
					if (dealerHand.status === &quot;blackjack&quot;)
						playerHand.result = &quot;push&quot;;
					else playerHand.result = &quot;win&quot;;
				}
				//push
				else if (dealerHand.value === playerHand.value)
					playerHand.result = &quot;push&quot;;
				//win
				else if (dealerHand.value &gt; 21 || (21 - playerHand.value &lt; 21 - dealerHand.value))
					playerHand.result = &quot;win&quot;;
				//loss
				else playerHand.result = &quot;loss&quot;;
			}
			//if the player has busted, it&#39;s a loss
			else playerHand.result = &quot;loss&quot;;
		}
	}

	//calculate the winnings
	var win = 0;
	for (var i = 0; i &lt; this.$playerHands.length; i++) {
		var playerHand = this.$playerHands[i];
		if (playerHand.result === &quot;win&quot;) {
			if (playerHand.status === &quot;blackjack&quot;)
				win += 2.5 * playerHand.bet;
			else win += 2 * playerHand.bet;
		}
		else if (playerHand.result === &quot;push&quot;)
			win += playerHand.bet;
		else if (playerHand.status === &quot;surrender&quot; &amp;&amp; dealerHand.status !== &quot;blackjack&quot;)
			win += playerHand.bet / 2;
	}
	player.credits += win;
	
	//status message
	var resultMessage = &quot;&quot;;
	
	//player
	for (var i = 0; i &lt; this.$playerHands.length; i++) {
		var playerHand = this.$playerHands[i]
		resultMessage += &quot;Player hand: &quot;;
		if (playerHand.status === &quot;blackjack&quot;)
			resultMessage += &quot;Blackjack\n&quot;;
		else if (playerHand.status === &quot;busted&quot;)
			resultMessage += &quot;Busted\n&quot;;
		else if (playerHand.result === &quot;push&quot;)
			resultMessage += &quot;Push\n&quot;;
		else if (playerHand.status === &quot;surrender&quot;)
			resultMessage += &quot;Surrender\n&quot;;
		else resultMessage += playerHand.value + &quot;\n&quot;;
	}
	
	//dealer
	if (dealerHand.status === &quot;blackjack&quot;)
		resultMessage += &quot;Dealer hand: Blackjack\n\n&quot;
	else if (dealerHand.status === &quot;busted&quot;)
		resultMessage += &quot;Dealer hand: Busted\n\n&quot;
	else resultMessage += &quot;Dealer hand: &quot; + dealerHand.value + &quot;\n\n&quot;;

	//winnings
	if (win - this.$totalBet&gt; 0)
		resultMessage += &quot;You win &quot; + formatCredits(win -  this.$totalBet, true, true) + &quot;\n&quot;;
	else if (win - this.$totalBet&lt; 0)
		resultMessage += &quot;You lose &quot; + formatCredits(this.$totalBet - win, true, true) + &quot;\n&quot;;
	else resultMessage += &quot;You get even\n&quot;
	
	resultMessage += &quot;\nCredits: &quot; + formatCredits(player.credits, true, true);
	
	var options = {
		&quot;2_REBET&quot; : &quot;Change bet&quot;,
		&quot;3_EXIT&quot; : &quot;Exit&quot;
	};
	if (player.credits &gt;= this.$bet)
		options[&quot;1_AGAIN&quot;] = &quot;Deal again (&quot;+formatCredits(this.$bet, true, true)+&quot;)&quot;;

	mission.runScreen({
		titleKey: &quot;hoopy-blackjack-title&quot;,
		model: &quot;hoopy_casino_blackjack_card_base&quot;,
		message: resultMessage,
		spinModel: false,
		background: &quot;hoopy_table_bg.png&quot;,
		choices: options,
		allowInterrupt: true,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;
	},
	function (choice) {
		if (choice === &quot;1_AGAIN&quot;) {
			this.$playGame(this.$bet);
			return;
		}
		else if (choice === &quot;2_REBET&quot;) {
			this.$intro();
			return;
		}
	});
	
	this.$updateScreen(-1);
	
	//red: lose
	//green: win
	//yellow: push
	for (var i = 0; i &lt; this.$playerHands.length; i++) {
		var result = this.$playerHands[i].result;
		if (result === &quot;win&quot;)
			mission.displayModel.flashers[i].color = &quot;greenColor&quot;;
		else if (result === &quot;loss&quot;)
			mission.displayModel.flashers[i].color = &quot;redColor&quot;;
		else mission.displayModel.flashers[i].color = &quot;yellowColor&quot;;
	}
	for (var j = i; j &lt; 4; j++)
		mission.displayModel.flashers[j].position = [0, 0, 50];
}

//draws a card from the current deck in play
this.$drawCard = function() {
	return this.$playDeck.splice(Math.floor(this.$playDeck.length * Math.random()),1)[0];
}

//update textures and positions for cards
this.$updateScreen = function() {
	//player cards subents 0-10, 11-21, 22 -32, 33-43
	//dealer cards subents 44-54

	//player cards
	for (var i = 0; i &lt; this.$playerHands.length; i++) {
		//show player hand
		var playerHand = this.$playerHands[i];
		for (var j = 0; j &lt; playerHand.cards.length; j++) {
			var card = playerHand.cards[j];
			var fileName = &quot;hoopy_card_&quot; + card.suit + &quot;_&quot; + card.rank + &quot;.png&quot;;
			var place = i * 11 + j;
			mission.displayModel.subEntities[place].setMaterials({&quot;casino_poker_card_diffuse.png&quot;: {diffuse_map: fileName, emission_map: fileName, emission_modulate_color: &quot;darkGrayColor&quot;}});
		}
		//double down
		if (playerHand.bet === 2 * this.$bet) {
			mission.displayModel.subEntities[place].orientation = [0.5, 0.5, 0.5, 0.5];
		}
		//hide non used player subents from view
		for (var k = j; k &lt; 11; k++) this.$hideCard(i * 11 + k);
	}
	//hide non used player subents from view
	for (var k = i * 11; k &lt; 44; k++) this.$hideCard(k);
	
	//dealer cards
	var dealerHand = this.$dealerHands[0];
	for (var j = 0; j &lt; dealerHand.cards.length; j++) {
		var card = dealerHand.cards[j];
		if (card.hide)
			var fileName = &quot;casino_blackjack_card_diffuse.png&quot;;
		else
			var fileName = &quot;hoopy_card_&quot; + card.suit + &quot;_&quot; + card.rank + &quot;.png&quot;;
		mission.displayModel.subEntities[4 * 11 + j].setMaterials({&quot;casino_poker_card_diffuse.png&quot;: {diffuse_map: fileName, emission_map: fileName, emission_modulate_color: &quot;darkGrayColor&quot;}});
	}
	//hide non used dealer subents from view
	for (var k = 4 * 11 + j; k &lt; 54; k++) this.$hideCard(k);
}

//moves the cards to the centerline and turns them out of view
this.$hideCard = function(place) {
	var position = mission.displayModel.subEntities[place].position;
	position[2] = 0;
	mission.displayModel.subEntities[place].position = position;
	var orientation = [0, 0, 0, 1];
	mission.displayModel.subEntities[place].orientation = orientation;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/hoopy_dice.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;hoopy_dice&quot;;
this.author = &quot;spara&quot;;
this.copyright = &quot;2014 spara&quot;;
this.license     = &quot;CC BY-NC-SA 3.0&quot;;

//game track with bet multipliers
this.$track = [0, 0, 0, 4, 0, 8, 0, 17, 0, 35];

//add interface
this.startUpComplete = this.shipExitedWitchspace = function() {
var casinos = system.shipsWithPrimaryRole(&quot;casinoship&quot;);
	if (casinos.length &gt; 0) {
		for (var i = 0; i &lt; casinos.length; i++) {
			casinos[i].setInterface(&quot;hoopy-dice&quot;,{
				title: &quot;Smuggler&#39;s run&quot;,
				category: expandMissionText(&quot;hoopy-gambling-category&quot;),
				summary: expandMissionText(&quot;hoopy-dice-summary&quot;),
				callback: this.$intro.bind(this)
			});
		}
	}
}

//helper function for tabulating text on screen
this.$tabulate = function(line, width) {
	var hairSpace = String.fromCharCode(31);
	var space = defaultFont.measureString(&quot; &quot;);
	while (defaultFont.measureString(line) &lt; width - space)
		line += &quot; &quot;;
	while (defaultFont.measureString(line) &lt; width)
		line += hairSpace;
	return line;
}

//intro screen
this.$intro = function() {
	var bets = [10, 50, 100];
	//build and format the payoff table for screen
	var payoffMessage = &quot;Correct&quot;;
	for (var i = 0; i &lt; 3; i++) {
		payoffMessage = this.$tabulate(payoffMessage, 5 * (i + 1));
		payoffMessage += formatCredits(bets[i], true, true);
	}
	payoffMessage = &quot;\n\n&quot; + payoffMessage + &quot;\n\n&quot;;
	for (i = this.$track.length - 1; i &gt; 0; i--) {
		if (this.$track[i] !== 0) {
			var line = i + 1;
			for (var j = 0; j &lt; 3; j++) {
				line = this.$tabulate(line, 5 * (j + 1));
				line += this.$track[i] * bets[j];
			}
			payoffMessage += line+&quot;\n&quot;;
		}
	}
	
	//format player credits for screen
	var credits = expandMissionText(&quot;hoopy-credits&quot;)+formatCredits(player.credits, true, true);
	
	var options = {
		&quot;1_EXIT&quot; : &quot;Exit&quot;
	};
	if (player.credits &gt;= 10)
		options[&quot;2_10&quot;] = &quot;Bet 10&quot;;
	else credits += expandMissionText(&quot;hoopy-no-credit&quot;);
	if (player.credits &gt;= 50)
		options[&quot;3_50&quot;] = &quot;Bet 50&quot;;
	if (player.credits &gt;= 100)
		options[&quot;4_100&quot;] = &quot;Bet 100&quot;;
	mission.runScreen({
		titleKey: &quot;hoopy-dice-title&quot;,
		message: expandMissionText(&quot;hoopy-dice-intro-story&quot;)  + payoffMessage + credits,
		choices: options,
		background: &quot;hoopy_dice_bg-intro.png&quot;
	},
	function (choice) {
		if (choice === &quot;2_10&quot;) this.$playGame(10);
		else if (choice === &quot;3_50&quot;) this.$playGame(50);
		else if (choice === &quot;4_100&quot;) this.$playGame(100);
	}
	);
}

//da game
this.$playGame = function(bet, prevSum, round, track, select) {
	//init the game
	if (typeof round === &#39;undefined&#39;) {
		var round = 0;
		var track = &quot;&quot;;
		player.credits -= bet;
	}
	
	//roll the dice
	var die1 = Math.ceil(6 * Math.random());
	var die2 = Math.ceil(6 * Math.random());
	var sum = die1 + die2;

	//check the guess
	var pass = true;
	if (typeof prevSum !== &#39;undefined&#39;) {
		if (select === &quot;high_same&quot;) {
			if (sum &lt; prevSum) 
				pass = false;
		}
		else if (select === &quot;high&quot;) {
			if (sum &lt;= prevSum) 
				pass = false;
		}
		else if (select === &quot;low_same&quot;) {
			if (sum &gt; prevSum) 
				pass = false;
		}
		else if (select === &quot;low&quot;) {
			if (sum &gt;= prevSum)
				pass = false;
		}
	}

//debug	
//pass = true; 

	//build the track display
	track += sum;
	if (round &lt;= this.$track.length - 1)
		track += &quot; &gt; &quot;;
	var messageTrack = track;
	for (var i = round; i &lt; this.$track.length; i++) {
		if (this.$track[i] !== 0)
			messageTrack += formatCredits(bet * this.$track[i], false, true);
		else messageTrack += &quot;?&quot;;
		if (i &lt; this.$track.length - 1 )
			messageTrack += &quot; &gt; &quot;;
	}
	
	//correct guess
	if (pass) {
		var options = {};
		//cash out
		if (round &gt; 0 &amp;&amp; this.$track[round-1] !== 0) {
			var cash_out = formatCredits(bet * this.$track[round-1], false, true);
			options[&quot;1_CASH&quot;] = &quot;Cash out &quot; + cash_out;
			var message = expandMissionText(&quot;hoopy-dice-track-cash&quot;);
			var background = &quot;hoopy_dice_bg-cash.png&quot;;
		}
		else { 
			var message = expandMissionText(&quot;hoopy-dice-track-basic&quot;);
			var background = &quot;hoopy_dice_bg-basic.png&quot;;
		}
		//guess choices
		if (round !== this.$track.length) {
			if (sum &gt;= 7)
				options[&quot;2_HIGH_SAME&quot;] = &quot;Higher or same&quot;;
			else
				options[&quot;3_HIGH&quot;] = &quot;Higher&quot;;
			if (sum &lt;= 7)
				options[&quot;4_LOW_SAME&quot;] = &quot;Lower or same&quot;;
			else
				options[&quot;5_LOW&quot;] = &quot;Lower&quot;;
		}
		else 
			var message = expandMissionText(&quot;hoopy-dice-track-final&quot;);
		mission.runScreen({
			titleKey: &quot;hoopy-dice-title&quot;,
			overlay: &quot;hoopy_dice_&quot;+die1+&quot;-&quot;+die2+&quot;.png&quot;,
			message: messageTrack + message,
			choices: options,
			background: background
		}, 
		function (choice) {
			if (choice === &quot;1_CASH&quot;) {
				this.$cashOut(bet, round);
				return;
			}
			else if (choice === &quot;2_HIGH_SAME&quot;) {
				this.$playGame(bet, sum, round + 1, track, &quot;high_same&quot;);
				return;
			}
			else if (choice === &quot;3_HIGH&quot;) {
				this.$playGame(bet, sum, round + 1, track, &quot;high&quot;);
				return;
			}
			else if (choice === &quot;4_LOW_SAME&quot;) {
				this.$playGame(bet, sum, round + 1, track, &quot;low_same&quot;);
				return;
			}
			else if (choice === &quot;5_LOW&quot;) {
				this.$playGame(bet, sum, round + 1, track, &quot;low&quot;);
				return;
			}
		}
		);
	}
	else {
		var options = {
			&quot;1_EXIT&quot; : &quot;Exit&quot;,
			&quot;2_AGAIN&quot; : &quot;Play again&quot;
		};
		mission.runScreen({
			titleKey: &quot;hoopy-dice-title&quot;,
			overlay: &quot;hoopy_dice_&quot;+die1+&quot;-&quot;+die2+&quot;.png&quot;,
			message: messageTrack +expandMissionText(&quot;hoopy-dice-track-fail&quot;),
			choices: options,
			background: &quot;hoopy_dice_bg-fail.png&quot;
		},
		function (choice) {
			if (choice === &quot;2_AGAIN&quot;) {
				this.$intro();
				return;
			}
		}
		);
	}
}

this.$cashOut = function(bet, round) {
	var win = this.$track[round-1] * bet
	player.credits += win;
	var options = {
		&quot;1_EXIT&quot; : &quot;Exit&quot;,
		&quot;2_AGAIN&quot; : &quot;Play again&quot;
	};
	mission.runScreen({
		titleKey: &quot;hoopy-dice-title&quot;,
		message: formatCredits(win, false, true)+ expandMissionText(&quot;hoopy-dice-track-win&quot;),
		choices: options,
		background: &quot;hoopy_dice_bg-win.png&quot;
	},
	function (choice) {
		if (choice === &quot;2_AGAIN&quot;) {
			this.$intro();
			return;
		}
	}
	);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/hoopy_holdem.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;hoopy_holdem&quot;;
this.author = &quot;spara&quot;;
this.copyright = &quot;2014 spara&quot;;
this.license     = &quot;CC BY-NC-SA 4.0&quot;; 

this.$highNames = [&quot;Seven&quot;, &quot;Eight&quot;, &quot;Nine&quot;, &quot;Ten&quot;, &quot;Jack&quot;, &quot;Queen&quot;, &quot;King&quot;, &quot;Ace&quot;];
this.$handRanks = [&quot;High&quot;, &quot;Pair&quot;,&quot;Two Pair&quot;,&quot;Three of a Kind&quot;,&quot;Straight&quot;,&quot;Flush&quot;,&quot;Full House&quot;,&quot;Four of a Kind&quot;,&quot;Straight Flush&quot;,&quot;Royal Flush&quot;];

this.startUpComplete = this.shipExitedWitchspace = function() {
	var casinos = system.shipsWithPrimaryRole(&quot;casinoship&quot;);
	if (casinos.length &gt; 0) {
		for (var i = 0; i &lt; casinos.length; i++) {
			casinos[i].setInterface(&quot;hoopy-holdem&quot;,{
				title: &quot;hOopy hold&#39;em&quot;,
				category: expandMissionText(&quot;hoopy-gambling-category&quot;),
				summary: expandMissionText(&quot;hoopy-holdem-summary&quot;),
				callback: this.$intro.bind(this)
			});
		}
	}
	/*
	system.mainStation.setInterface(&quot;hoopy-holdem&quot;,{
		title: &quot;Hoopy hold&#39;em&quot;,
		category: expandMissionText(&quot;hoopy-gambling-category&quot;),
		summary: expandMissionText(&quot;hoopy-holdem-summary&quot;),
		callback: this.$intro.bind(this)
	});
	*/
	
}

//init a new deck
this.$virginDeck = function() {
	var deck = new Array();
	var suits = [&quot;triangle&quot;, &quot;crescent&quot;, &quot;square&quot;, &quot;star&quot;];
	for (var i = 0; i &lt; 4; i++) {
		for (var j = 1; j &lt; 14; j++) {
			var card = new Object();
			card.suit = suits[i];
			card.rank = j;
			card.show = false;
			deck.push(card);
		}
	}
	return deck;
}

//draws a card from the current deck in play
this.$drawCard = function() {
	return this.$playDeck.splice(Math.floor(this.$playDeck.length * Math.random()),1)[0];
}

this.$intro = function() {
	var credits = expandMissionText(&quot;hoopy-credits&quot;) + formatCredits(player.credits, true, true);
	var options = {};
	options[&quot;1_EXIT&quot;] = &quot;Exit&quot;;
	if (player.credits &gt;= 30)
		options[&quot;2_10&quot;] = &quot;Bet &quot; + formatCredits(10, true, true);
	else credits += expandMissionText(&quot;hoopy-no-credit&quot;);
	if (player.credits &gt;= 150)
		options[&quot;3_50&quot;] = &quot;Bet &quot; + formatCredits(50, true, true);
	if (player.credits &gt;= 300)
		options[&quot;4_100&quot;] = &quot;Bet &quot; + formatCredits(100, true, true);
	
	mission.runScreen({
		titleKey: &quot;hoopy-holdem-title&quot;,
		message: expandMissionText(&quot;hoopy-holdem-intro-story&quot;) + credits,
		model: &quot;hoopy_casino_holdem_intro&quot;,
		background: &quot;hoopy_table_bg.png&quot;,
		choices: options,
		allowInterrupt: true,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;
	},
	function (choice) {
		if (choice === &quot;2_10&quot;) this.$play(10);
		else if (choice === &quot;3_50&quot;) this.$play(50);
		else if (choice === &quot;4_100&quot;) this.$play(100);
	}	
	);
}

//first pay, then deal
this.$play = function(bet) {
	player.credits -= bet;
	this.$ante = bet;
	this.$bets = 0;
	this.$playDeck = this.$virginDeck();
	this.$cards = new Array();
	for (var i = 0; i &lt; 9; i++) this.$cards.push(this.$drawCard());
	this.$deal(&quot;deal&quot;);
}

this.$deal = function(phase) {
	var message = &quot;Ante: &quot; + formatCredits(this.$ante, true, true);
	if (this.$bets &gt; 0)
		message += &quot;\nBets: &quot; + formatCredits(this.$bets, true, true);
	message += &quot;\n\nCredits: &quot; + formatCredits(player.credits, true, true);
	var options = {};
	switch(phase) {
		case &quot;deal&quot; :	this.$cards[7].show = true; 
						this.$cards[8].show = true;
						options[&quot;1_FLOP&quot;] = &quot;Play (&quot; + formatCredits(this.$ante * 2, true, true) + &quot;)&quot;;
						options[&quot;2_FOLD&quot;] = &quot;Fold&quot;;
						break;
		case &quot;flop&quot; :	this.$cards[2].show = true; 
						this.$cards[3].show = true;
						this.$cards[4].show = true;
						options[&quot;3_CHECK_TURN&quot;] = &quot;Check&quot;;
						if (player.credits &gt;= this.$ante)
							options[&quot;4_BET_TURN&quot;] = &quot;Bet (&quot; + formatCredits(this.$ante, true, true) + &quot;)&quot;;
						break;
		case &quot;turn&quot; :	this.$cards[5].show = true; 
						options[&quot;5_CHECK_RIVER&quot;] = &quot;Check&quot;;
						if (player.credits &gt;= this.$ante)
							options[&quot;6_BET_RIVER&quot;] = &quot;Bet (&quot; + formatCredits(this.$ante, true, true) + &quot;)&quot;;
						break;
	};
	mission.runScreen({
		titleKey: &quot;hoopy-holdem-title&quot;,
		model: &quot;hoopy_casino_holdem_base&quot;,
		message: message,
		background: &quot;hoopy_table_bg.png&quot;,
		spinModel: false,
		choices: options
	},
	function(choice) {
		switch(choice) {
			case &quot;1_FLOP&quot; : player.credits -= 2 * this.$ante;
							this.$bets += 2 * this.$ante;
							this.$deal(&quot;flop&quot;);
							return;
			case &quot;2_FOLD&quot; : this.$showDown(true);
							return;
			case &quot;3_CHECK_TURN&quot; : 	this.$deal(&quot;turn&quot;);
									return;
			case &quot;4_BET_TURN&quot; : player.credits -= this.$ante;
								this.$bets += this.$ante;
								this.$deal(&quot;turn&quot;);
								return;
			case &quot;5_CHECK_RIVER&quot; : 	this.$showDown(false);
									return;
			case &quot;6_BET_RIVER&quot; : 	player.credits -= this.$ante;
									this.$bets += this.$ante;
									this.$showDown(false);
									return;
		}
	});
	this.$updateCards();
}

this.$handName = function(value, high) {
	if (value &gt; 0)
		return this.$handRanks[value];
	else
		return this.$highNames[high - 7] + &quot; &quot; + this.$handRanks[0];
}

this.$formatHand = function(hand) {
	var formatted = &quot;(&quot;;
	for (var i = 0; i &lt; 5; i++) {
		var value = hand[0][i].value;
		if (value === 11) value = &quot;J&quot;;
		else if (value === 12) value = &quot;Q&quot;;
		else if (value === 13) value = &quot;K&quot;;
		else if (value === 14 || value === 1) value = &quot;A&quot;;
		formatted += value;
		if (i &lt; 4) formatted += &quot;, &quot;;
		else formatted += &quot;)&quot;;
	}
	return formatted;
}

this.$showDown = function(fold) {
	for (var i = 0; i &lt; 9; i++) this.$cards[i].show = true;
	var playerHand = this.$bestHand(2);
	var dealerHand = this.$bestHand(0);
	var playerValues = &quot;\n&quot; + this.$formatHand(playerHand) + &quot;\n\n&quot;;
	var dealerValues = &quot;\n&quot; + this.$formatHand(dealerHand) + &quot;\n\n&quot;;
	var message = &quot;Player: &quot; + this.$handName(playerHand[1], playerHand[0][0].value) + playerValues;
	message += &quot;Dealer: &quot; + this.$handName(dealerHand[1], dealerHand[0][0].value) + dealerValues;
	
	if (fold) var result = &quot;fold&quot;;
	else {
		var result = &quot;push&quot;;
		if (dealerHand[1] &gt; playerHand[1])
			result = &quot;loss&quot;;
		else if (dealerHand[1] &lt; playerHand[1]) {
			result = &quot;win&quot;;
		}
		else {
			for (var i = 0; i &lt; 5; i++) {
				if (playerHand[0][i].value &gt; dealerHand[0][i].value) {
					result = &quot;win&quot;;
					break;
				}
				else if (playerHand[0][i].value &lt; dealerHand[0][i].value) {
					result = &quot;loss&quot;;
					break;
				}
			}
		}
	}
	switch (result) {
		case &quot;win&quot; : 	if (playerHand[1] &gt; 3) 
							var win = 2 * (this.$bets + this.$ante);
						else var win = this.$ante + 2 * (this.$bets);
						message += &quot;You win &quot; + formatCredits(win - this.$bets - this.$ante, true, true);
						player.credits += win;
						break;
		case &quot;loss&quot; : 	message += &quot;Dealer wins, you lose &quot; + formatCredits(this.$bets + this.$ante, true, true);
						break;
		case &quot;push&quot; : 	message += &quot;It&#39;s a push, wagers returned.&quot;;
						player.credits += this.$bets + this.$ante;
						break;
		case &quot;fold&quot; :	message += &quot;You fold and lose &quot; + formatCredits(this.$ante, true, true);
						break;
	}
	message += &quot;\n\nCredits: &quot; + formatCredits(player.credits, true, true);
	var options = {};
	if (player.credits &gt;= 3 * this.$ante)
		options[&quot;7_DEAL&quot;] = &quot;Deal again (&quot; + formatCredits(this.$ante, true, true) + &quot;)&quot;;
	options[&quot;8_BET&quot;] = &quot;Change ante&quot;;
	options[&quot;9_EXIT&quot;] = &quot;Exit&quot;;
	mission.runScreen({
		titleKey: &quot;hoopy-holdem-title&quot;,
		model: &quot;hoopy_casino_holdem_base&quot;,
		message: message,
		background: &quot;hoopy_table_bg.png&quot;,
		spinModel: false,
		choices: options,
		allowInterrupt: true,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;
	},
	function(choice) {
		switch(choice) {
			case &quot;7_DEAL&quot; : this.$play(this.$ante);
							return;
			case &quot;8_BET&quot; : this.$intro(1);
							return;
		};
	});
	this.$updateCards();
}

this.$updateCards = function() {
	for (var i = 0; i &lt; 9; i++) {
		var card = this.$cards[i];
		if (card.show)
			var fileName = &quot;hoopy_card_&quot; + card.suit + &quot;_&quot; + card.rank + &quot;.png&quot;;
		else var fileName = &quot;casino_holdem_card_diffuse.png&quot;;
		mission.displayModel.subEntities[i].setMaterials({&quot;casino_poker_card_diffuse.png&quot;: {diffuse_map: fileName, emission_map: fileName, emission_modulate_color: &quot;darkGrayColor&quot;}});
	}
}

this.$bestHand = function(start) {
	
	//make a new hand with new objects
	var hand = new Array();
	for (var i = start; i &lt; start + 7; i++) {
		var suits = [&quot;triangle&quot;, &quot;crescent&quot;, &quot;square&quot;, &quot;star&quot;];
		var card = new Object();
		card.value = this.$cards[i].rank;
		card.suit = suits.indexOf(this.$cards[i].suit);
		if (card.value === 1) card.value = 14;
		hand.push(card);
	}
	
	//order cards by suit
	hand.sort(function(a, b) {return a.suit - b.suit});

	//handle flushes first	
	if (hand[0].suit === hand[4].suit || hand[1].suit === hand[5].suit || hand[2].suit === hand[6].suit) {
		//suit of flush
		var suit = hand[2].suit;
		//remove wrong suit cards
		for (var i = 0; i &lt; 7; i++) {
			if (hand[6 - i].suit !== suit)
				hand.splice(6 - i, 1);
		}
		//order cards by value
		hand.sort(function(a, b) {return b.value - a.value})
		//handle possible ace by duplicating to a different value
		if (hand[0].value === 14) {
			card = new Object();
			card.value = 1;
			card.suit = suit;
			hand.push(card);
		}
		//look for a straight
		var straight = -1;
		var length = 0;
		for (var i = 0; i &lt; hand.length - 1; i++) {
			//tracking a straight
			if (hand[i].value - hand[i + 1].value === 1) length++;
			else if (hand[i].value - hand[i + 1].value != 0) length = 0;
			if (length === 4) {
				//highest straight starts from index i - 3
				straight = i - 3;
				break;
			}
		}
		//straight flush found
		if (straight &gt; -1) {
			hand = hand.splice(straight, 5);
			//royal flush
			if (hand[0].value === 14)
				return [hand, 9];
			//straight flush
			else return [hand, 8];
		}
		//a plain flush found
		else {
			//take five most valuable cards
			hand = hand.splice(0, 5);
			return [hand, 5];
		}
	}

	//order cards by value
	hand.sort(function(a, b) {return b.value - a.value});
	
	//handle possible ace by duplicating to a different value
	if (hand[0].value === 14) {
		card = new Object();
		card.value = 1;
		card.suit = hand[0].suit;
		hand.push(card);
	}

	//look for a straight
	var straight = -1;
	var length = 0;
	for (var i = 0; i &lt; hand.length - 1; i++) {
		//tracking a straight
		if (hand[i].value - hand[i + 1].value === 1) length++;
		else if (hand[i].value - hand[i + 1].value != 0) length = 0;
		if (length === 4) {
			//highest straight starts from index i - 3
			straight = i - 3;
			break;
		}
	}

	//straight found
	if (straight &gt; -1) {
		hand = hand.splice(straight, 5);
		return [hand, 4];
	}
	
	//remove possible added ace. this was needed for straight search
	if (hand[0].value === 14)
		hand.pop();

	//make a new array of the cards so that cards with the same value are grouped ot sub arrays
	var grouped = new Array();
	grouped.push([hand[0]]);
	for (var i = 1; i &lt; hand.length; i++) {
		//if there is a group for this card value, then push the card into it.
		if (hand[i].value === grouped[grouped.length - 1][0].value)
			grouped[grouped.length - 1].push(hand[i]);
		//otherwise create a new group
		else grouped.push([hand[i]]);
	}

	//sort grouped cards by group size
	grouped.sort(function(a, b) {return b.length - a.length});

	//four of a kind
	if (grouped[0].length === 4) {
		var newHand = grouped[0];
		var kicker = grouped[1][0];
		for (var i = 2; i &lt; grouped.length; i++) {
			if (grouped[i][0] &gt; kicker) kicker = grouped[i][0];
		}
		newHand.push(kicker);
		return [newHand, 7];
	}
	
	//three of a kind or full house
	if (grouped[0].length === 3) {
		var newHand = grouped[0];
		//full house
		if (grouped[1].length &gt; 1) {
			newHand.push(grouped[1][0]);
			newHand.push(grouped[1][1]);
			return [newHand, 6];
		}
		//three of a kind
		else {
			newHand.push(grouped[1][0]);
			newHand.push(grouped[2][0]);
			return [newHand, 3];
		}
	}
	
	//pair or two pair
	if (grouped[0].length === 2) {
		var newHand = grouped[0];
		//two pair
		if (grouped[1].length &gt; 1) {
			newHand.push(grouped[1][0]);
			newHand.push(grouped[1][1]);
			newHand.push(grouped[2][0]);
			return [newHand, 2];
		}
		//pair
		else {
			newHand.push(grouped[1][0]);
			newHand.push(grouped[2][0]);
			newHand.push(grouped[3][0]);
			return [newHand, 1];
		}
	}

	hand = hand.splice(0, 5);
	return [hand, 0];
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/hoopy_hoops.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;hoopy_casino&quot;;
this.author = &quot;Paul Wilkins (updated by Eric Walch, further updated by spara)&quot;;
this.copyright = &quot;(C) 2009 Paul Wilkins&quot;;
this.license     = &quot;CC BY-NC-SA 3.0&quot;; 

//add interface
this.startUpComplete = this.shipExitedWitchspace = function() {
	var casinos = system.shipsWithPrimaryRole(&quot;casinoship&quot;);
	if (casinos.length &gt; 0) {
		for (var i = 0; i &lt; casinos.length; i++) {
			casinos[i].setInterface(&quot;hoopy-hoops&quot;,{
				title: expandMissionText(&quot;hoopy-hoops-title&quot;),
				category: expandMissionText(&quot;hoopy-gambling-category&quot;),
				summary: expandMissionText(&quot;hoopy-hoops-summary&quot;),
				callback: this.$startGambling.bind(this)
			});
		}
	}
}

//init the hoops
this.shipDockedWithStation = function (station) {
	if (player.ship.docked &amp;&amp; station.primaryRole === &#39;casinoship&#39;) {
        missionVariables.hoopy_casino = &#39;NOT_NOW&#39;;
        this.setBoundaries();
    }
};

this.missionScreenOpportunity = function ()
{
    if (player.ship.docked &amp;&amp; player.ship.dockedStation.primaryRole === &#39;casinoship&#39;) 
    {
        this.gamble();
    }
};


this.setBoundaries = function () {
        /*
        In the legacy version the random distribution was bad. One could win after analysing the odds
        during some time. This is a feature that should stay in. So we prepare the gamble table now a bit.
        */
        this.boundary1 = 1 + Math.random() - Math.random();
        this.boundary2 = 2 + Math.random() - Math.random();
        if (this.boundary1 &gt; this.boundary2) this.boundary1 = this.boundary2;
        this.startCapital = player.credits;
};

this.$startGambling = function() {
	missionVariables.hoopy_casino = &#39;HOOPY_ENTER&#39;;
	this.gambleChoices(&#39;YES_HOOPY&#39;);
}

this.gamble = function () {
	/*
    if (missionVariables.hoopy_casino === &#39;HOOPY_REVISIT&#39;) {
        if (player.credits &gt;= 100) {
            mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_intro&#39;, overlay: &#39;hoopy_front.png&#39;, choicesKey: &#39;hoopy_casino_enter_yesno&#39;, music: &quot;hoopy_theme.ogg&quot;}, this.gambleChoices);
            missionVariables.hoopy_casino = &#39;HOOPY_ENTER&#39;;
            return;
        }
    }*/
    if (missionVariables.hoopy_casino === &#39;HOOPY_GAMEON&#39;) {
        mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_choices&#39;, overlay: &#39;hoopy_cover.png&#39;, choicesKey: &#39;hoopy_casino_pick_hoop&#39;, music: &quot;hoopy_theme.ogg&quot;}, this.gambleChoices);
        this.hoopy_casino_hoop = Math.random() * 3;
        missionVariables.hoopy_casino = &#39;HOOPY_MAKE_CHOICE&#39;;
        return;
    }
    if (player.credits &gt; this.startCapital + 2000) {
        mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_new_table&#39;, overlay: &#39;hoopy_front.png&#39;, choicesKey: &#39;hoopy_casino_new_table_yesno&#39;, music: &quot;hoopy_theme.ogg&quot;}, this.gambleChoices);
        missionVariables.hoopy_casino = &#39;HOOPY_NEW_TABLE&#39;;
        this.setBoundaries();
    } else {
        if (missionVariables.hoopy_casino === &#39;HOOPY_WINNER&#39;) {
            mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_win&#39;, overlay: this.hoopy_casino_image, choicesKey: &#39;hoopy_casino_replay_winner_yesno&#39;, music: &quot;hoopy_theme.ogg&quot;}, this.gambleChoices);
            player.credits += 100;
            missionVariables.hoopy_casino = &#39;HOOPY_REPLAY&#39;;
        }
        if (missionVariables.hoopy_casino === &#39;HOOPY_LOSER&#39;) {
            mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_loss&#39;, overlay: this.hoopy_casino_image, choicesKey: &#39;hoopy_casino_replay_loser_yesno&#39;, music: &quot;hoopy_theme.ogg&quot;}, this.gambleChoices);
            player.credits -= 100;
            missionVariables.hoopy_casino = &#39;HOOPY_REPLAY&#39;;
        }
    }
    if (missionVariables.hoopy_casino === &#39;NOT_NOW&#39;) {
        delete this.hoopy_casino_hoop;
        delete this.hoopy_casino_image;
        delete missionVariables.hoopy_casino;
    }
};
this.gambleChoices = function (choice){
    if (missionVariables.hoopy_casino === &#39;HOOPY_ENTER&#39;) {
        if (choice === &#39;YES_HOOPY&#39;) {
			if (player.credits &gt;= 100) {
				mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_desc&#39;, overlay: &#39;hoopy_clean.png&#39;, choicesKey: &#39;hoopy_casino_gamble_yesno&#39;, music: &quot;hoopy_theme.ogg&quot;}, this.gambleChoices);
				missionVariables.hoopy_casino = &#39;HOOPY_GAMBLE&#39;;
			}
			else {
				missionVariables.hoopy_casino = &#39;HOOPY_REPLAY&#39;;
				this.gambleChoices(&#39;YES_HOOPY&#39;);
				return;
			}
        } else if (choice === &#39;NO_HOOPY&#39;) {
            missionVariables.hoopy_casino = &#39;NOT_NOW&#39;;
        }
        return;
    }
    if (missionVariables.hoopy_casino === &#39;HOOPY_GAMBLE&#39;) {
        if (choice === &#39;0_HOOPY&#39;) {
            mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_desc&#39;, overlay: &#39;hoopy_clean.png&#39;, choicesKey: &#39;hoopy_casino_gamble_yesno&#39;, music: &quot;hoopy_theme.ogg&quot;}, this.gambleChoices);
        } else if (choice === &#39;YES_HOOPY&#39;) {
            missionVariables.hoopy_casino = &#39;HOOPY_GAMEON&#39;;
        } else if (choice === &#39;NO_HOOPY&#39;) {
            missionVariables.hoopy_casino = &#39;NOT_NOW&#39;;
        }
        return;
    }
    if (missionVariables.hoopy_casino === &#39;HOOPY_MAKE_CHOICE&#39;) {
        missionVariables.hoopy_casino = &#39;HOOPY_LOSER&#39;;
        if (this.hoopy_casino_hoop &lt; this.boundary1) {
			this.hoopy_casino_image = &#39;hoopy_Lwin.png&#39;;
            if (choice === &#39;LEFT_HOOPY&#39;) {
                missionVariables.hoopy_casino = &#39;HOOPY_WINNER&#39;;
            }
        }
        if (this.hoopy_casino_hoop &gt;= this.boundary1 &amp;&amp; this.hoopy_casino_hoop &lt; this.boundary2) {
			this.hoopy_casino_image = &#39;hoopy_Cwin.png&#39;;
            if (choice === &#39;MIDDLE_HOOPY&#39;) {
                missionVariables.hoopy_casino = &#39;HOOPY_WINNER&#39;;
            }
        }
        if (this.hoopy_casino_hoop &gt;= this.boundary2) {
			this.hoopy_casino_image = &#39;hoopy_Rwin.png&#39;;
            if (choice === &#39;RIGHT_HOOPY&#39;) {
                missionVariables.hoopy_casino = &#39;HOOPY_WINNER&#39;;
            }
        }
        return;
    }
    if (missionVariables.hoopy_casino === &#39;HOOPY_NEW_TABLE&#39;) {
        if (choice === &#39;NEW_TABLE_HOOPY&#39;) {
            mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_desc&#39;, overlay: &#39;hoopy_clean.png&#39;, choicesKey: &#39;hoopy_casino_gamble_yesno&#39;, music: &quot;hoopy_theme.ogg&quot;}, this.gambleChoices);
            missionVariables.hoopy_casino = &#39;HOOPY_GAMBLE&#39;;
        } else if (choice === &#39;NO_HOOPY&#39;) {
            missionVariables.hoopy_casino = &#39;NOT_NOW&#39;;
        }
        return;
    }
    if (missionVariables.hoopy_casino === &#39;HOOPY_REPLAY&#39;) {
        if (choice === &#39;0-WINNER_HOOPY&#39;) {
            mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_win&#39;, overlay: this.hoopy_casino_image, choicesKey: &#39;hoopy_casino_replay_winner_yesno&#39;, music: &quot;hoopy_theme.ogg&quot;}, this.gambleChoices);
        }
        if (choice === &#39;0-LOSER_HOOPY&#39;) {
			mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_loss&#39;, overlay: this.hoopy_casino_image, choicesKey: &#39;hoopy_casino_replay_loser_yesno&#39;, music: &quot;hoopy_theme.ogg&quot;}, this.gambleChoices);
        }
        if (choice === &#39;YES_HOOPY&#39;) {
            if (player.credits &gt;= 100) {
                mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_again&#39;, overlay: &#39;hoopy_clean.png&#39;, music: &quot;hoopy_theme.ogg&quot;});
                missionVariables.hoopy_casino = &#39;HOOPY_GAMEON&#39;;
            } else {
                mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_nofunds&#39;, overlay: &#39;hoopy_front.png&#39;, music: &quot;hoopy_theme.ogg&quot;});
                missionVariables.hoopy_casino = &#39;NOT_NOW&#39;;
            }
        }
        if (choice === &#39;NO_HOOPY&#39;) {
            mission.runScreen({title: &quot;Hoopy Casino&quot;, messageKey: &#39;hoopy_casino_goodbye&#39;, overlay: &#39;hoopy_front.png&#39;, music: &quot;hoopy_theme.ogg&quot;});
            missionVariables.hoopy_casino = &#39;NOT_NOW&#39;;
        }
	}    
};
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/hoopy_poker.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;hoopy_poker&quot;;
this.author = &quot;spara&quot;;
this.copyright = &quot;2014 spara&quot;;
this.license     = &quot;CC BY-NC-SA 4.0&quot;; 

this.payoffHands = [&quot;Jacks or Better&quot;,&quot;Two Pair&quot;,&quot;Three of a Kind&quot;,&quot;Straight&quot;,&quot;Flush&quot;,&quot;Full House&quot;,&quot;Four of a Kind&quot;,&quot;Straight Flush&quot;,&quot;Royal Flush&quot;];
this.payoffTable = [[10,20,30,40,60,90,250,500,2500],[20,40,60,80,120,180,500,1000,5000],[30,60,90,120,180,270,750,1500,7500],[40,80,120,160,240,360,1000,2000,10000],[50,100,150,200,300,450,1250,2500,40000]];

this.startUpComplete = this.shipExitedWitchspace = function() {
	var casinos = system.shipsWithPrimaryRole(&quot;casinoship&quot;);
	if (casinos.length &gt; 0) {
		for (var i = 0; i &lt; casinos.length; i++) {
			casinos[i].setInterface(&quot;hoopy-poker&quot;,{
				title: &quot;Video poker&quot;,
				category: expandMissionText(&quot;hoopy-gambling-category&quot;),
				summary: expandMissionText(&quot;hoopy-poker-summary&quot;),
				callback: this.$intro.bind(this)
			});
		}
	}
}

//init a new deck
this.$virginDeck = function() {
	var deck = new Array();
	var suits = [&quot;triangle&quot;, &quot;crescent&quot;, &quot;square&quot;, &quot;star&quot;];
	for (var i = 0; i &lt; 4; i++) {
		for (var j = 1; j &lt; 14; j++) {
			var card = new Object();
			card.suit = suits[i];
			card.rank = j;
			card.hold = 0; 
			deck.push(card);
		}
	}
	return deck;
}

//helper function for tabulating text on screen
this.$tabulate = function(line, width) {
	var hairSpace = String.fromCharCode(31);
	var space = defaultFont.measureString(&quot; &quot;);
	while (defaultFont.measureString(line) &lt; width - space)
		line += &quot; &quot;;
	while (defaultFont.measureString(line) &lt; width)
		line += hairSpace;
	return line;
}

//intro screen
this.$intro = function() {	
	//build and format the payoff table for screen
	var payoffMessage = this.$tabulate(&quot;Hand&quot;, 10);
	for (var i = 0; i &lt; 5; i++) {
		payoffMessage += formatCredits(10 * (i + 1), true, true);
		payoffMessage = this.$tabulate(payoffMessage, 10 + 4 * (i + 1));
	}
	payoffMessage = &quot;\n\n&quot; + payoffMessage + &quot;\n\n&quot;;
	for (i = 0; i &lt; this.payoffHands.length; i++) {
		var line = this.payoffHands[this.payoffHands.length - i - 1];
		line = this.$tabulate(line, 10);
		for (var j = 0; j &lt; 5; j++) {
			line = this.$tabulate(line, 10 + 4 * j);
			line += this.payoffTable[j][this.payoffHands.length - i - 1];
		}
		payoffMessage += line+&quot;\n&quot;;
	}
	
	//format player credits for screen
	var credits = expandMissionText(&quot;hoopy-credits&quot;)+formatCredits(player.credits, true, true);
	
	//gambling choices
	var options = {
		&quot;1_EXIT&quot; : &quot;Exit&quot;
	};
	if (player.credits &gt;= 10) {
		options[&quot;2_10&quot;] = formatCredits(10, true, true);
	}
	else credits += expandMissionText(&quot;hoopy-no-credit&quot;);
	if (player.credits &gt;= 20)
		options[&quot;3_20&quot;] = formatCredits(20, true, true);
	if (player.credits &gt;= 30)
		options[&quot;4_30&quot;] = formatCredits(30, true, true);
	if (player.credits &gt;= 40)
		options[&quot;5_40&quot;] = formatCredits(40, true, true);
	if (player.credits &gt;= 50)
		options[&quot;6_50&quot;] = formatCredits(50, true, true);
	
	
	mission.runScreen({
		titleKey: &quot;hoopy-poker-title&quot;,
		message: expandMissionText(&quot;hoopy-poker-intro-story&quot;) + payoffMessage + credits,
		model: &quot;hoopy_casino_poker_card_spin&quot;,
		background: &quot;hoopy_table_bg.png&quot;,
		choices: options,
		allowInterrupt: true,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;
	},
	function (choice) {
		if (choice === &quot;2_10&quot;) this.$play(10);
		else if (choice === &quot;3_20&quot;) this.$play(20);
		else if (choice === &quot;4_30&quot;) this.$play(30);
		else if (choice === &quot;5_40&quot;) this.$play(40);
		else if (choice === &quot;6_50&quot;) this.$play(50);
	}
	);
}

//first pay, then deal
this.$play = function(bet) {
	player.credits -= bet;
	//init a new deck and draw a hand (don&#39;t show it yet)
	this.$playDeck = this.$virginDeck();
	var hand = new Array();
	for (var i = 0; i &lt; 5; i++) hand.push(this.$drawCard());
	this.$deal(bet, hand);
}

//Deal
this.$deal = function(bet, hand, choice) {
	if (typeof choice === &#39;undefined&#39;) var choice = &quot;0_HOLD&quot;;
	var options = {
		&quot;0_HOLD&quot; : &quot;Hold/Cancel 1.&quot;,
		&quot;1_HOLD&quot; : &quot;Hold/Cancel 2.&quot;,
		&quot;2_HOLD&quot; : &quot;Hold/Cancel 3.&quot;,
		&quot;3_HOLD&quot; : &quot;Hold/Cancel 4.&quot;,
		&quot;4_HOLD&quot; : &quot;Hold/Cancel 5.&quot;,
		&quot;5_DEAL&quot; : &quot;Draw&quot;
	}
	mission.runScreen({
		titleKey: &quot;hoopy-poker-title&quot;,
		messageKey: &quot;hoopy-poker-deal-story&quot;,
		model: &quot;hoopy_casino_poker_card_base&quot;,
		background: &quot;hoopy_table_bg.png&quot;,
		spinModel: false,
		choices: options,
		initialChoicesKey: choice
	},
	function (choice) {
		if (choice === &quot;0_HOLD&quot;)
			hand[0].hold = (hand[0].hold + 1) % 2;
		else if (choice === &quot;1_HOLD&quot;)
			hand[1].hold = (hand[1].hold + 1) % 2;
		else if (choice === &quot;2_HOLD&quot;)
			hand[2].hold = (hand[2].hold + 1) % 2;
		else if (choice === &quot;3_HOLD&quot;)
			hand[3].hold = (hand[3].hold + 1) % 2;
		else if (choice === &quot;4_HOLD&quot;)
			hand[4].hold = (hand[4].hold + 1) % 2;
		else if (choice === &quot;5_DEAL&quot;) {
			this.$outCome(bet, hand);
			return;
		}
		this.$deal(bet, hand, choice);
		return;
	}
	);
	//update the cards on screen
	for (var i = 0; i &lt; 5; i++)
		this.$changeCard(i, hand[i]);
}

//draw &amp;&amp; outcome
this.$outCome = function(bet, hand) {
	//draw new cards
	for (var i = 0; i &lt; 5; i++) {
		if (!hand[i].hold)
			hand[i] = this.$drawCard();
		else hand[i].hold = 0;
	}
	//check for wins
	var result = this.winCheck(hand);
	//fail
	if (result === -1) {
		var sound = &quot;hoopy_lose.ogg&quot;;
		var resultText = expandMissionText(&quot;hoopy-poker-fail&quot;);
	}
	//win
	else {
		var win = this.payoffTable[(bet / 10 - 1)][result];
		var resultText = this.payoffHands[result] + &quot;, you win &quot; + formatCredits(win, false, true) + &quot;.&quot;
		player.credits += win;
		var sound = &quot;hoopy_win.ogg&quot;;
	}
	//format player credits for screen
	var credits = &quot;\n&quot; + expandMissionText(&quot;hoopy-credits&quot;)+formatCredits(player.credits, true, true) + &quot;\nBet: &quot; + formatCredits(bet, true, true) ;
	var options = {
		&quot;1_EXIT&quot; : &quot;Exit&quot;,
		&quot;2_AGAIN&quot; : &quot;Change bet&quot;,
	};
	if (player.credits &gt;= bet) options[&quot;3_DEAL&quot;] = &quot;Deal again&quot;;
	mission.runScreen({
		titleKey: &quot;hoopy-poker-title&quot;,
		message: resultText + credits,
		model: &quot;hoopy_casino_poker_card_base&quot;,
		background: &quot;hoopy_table_bg.png&quot;,
		spinModel: false,
		choices: options,
		music: sound,
		allowInterrupt: true,
		exitScreen: &quot;GUI_SCREEN_INTERFACES&quot;
	},
		function (choice) {
			if (choice === &quot;2_AGAIN&quot;) {
				this.$intro();
				return;
			}
			else if (choice === &quot;3_DEAL&quot;) {
				this.$play(bet);
				return;
			}
				
		}
	)
	//update the cards on screen
	for (var i = 0; i &lt; 5; i++)
		this.$changeCard(i, hand[i]);
}

//draws a card from the current deck in play
this.$drawCard = function() {
	return this.$playDeck.splice(Math.floor(this.$playDeck.length * Math.random()),1)[0];
}

//update the texture and position for a card
this.$changeCard = function(place, card) {
	var fileName = &quot;hoopy_card_&quot; + card.suit + &quot;_&quot; + card.rank + &quot;.png&quot;;
	mission.displayModel.subEntities[place].setMaterials({&quot;casino_poker_card_diffuse.png&quot;: {diffuse_map: fileName, emission_map: fileName, emission_modulate_color: &quot;darkGrayColor&quot;}});
	if (card.hold) {
		var position = mission.displayModel.subEntities[place].position;
		position[2] = 3;
		mission.displayModel.subEntities[place].position = position;
	}
}

//rules for a winning hand
this.winCheck = function(hand) {
	//work with a hand that has been ordered by rank
	var orderedHand = hand.concat();
	orderedHand.sort(function(a, b) {return a.rank - b.rank});
	
	//check for flush
	var suit = orderedHand[0].suit;
	var i = 0;
	var flush = false;
	for (i = 1; i &lt; 5; i++) {
		if (orderedHand[i].suit !== suit) {
			i = -1; 
			break;
		}
	}
	//flush found
	if (i !== -1) flush = true;
	
	//check for straight
	var prevRank = orderedHand[0].rank;
	var straight = false
	for (i = 1; i &lt; 5; i++) {
		if (orderedHand[i].rank - prevRank !== 1 &amp;&amp; (i !== 1 || orderedHand[i].rank !== 10 || prevRank !== 1)) {
			i = -1; 
			break;
		}
		prevRank = orderedHand[i].rank;
	}

	//straight found
	if (i !== -1) straight = true;
	
	//straight flush
	if (flush &amp;&amp; straight) {
		if (orderedHand[0].rank === 1 &amp;&amp; orderedHand[4].rank === 13)
			return 8;//royal_flush
		else return 7;//straight_flush
	}
	
	//flush 
	if (flush) return 4;//flush&quot;
	
	//straight
	if (straight) return 3;//straight
	
	//in the ordered list, for every adjacent two cards, check if they form a rank pair.
	prevRank = orderedHand[0].rank;
	var pairs = new Array();
	for (i = 1; i &lt; 5; i++) {
		if (orderedHand[i].rank === prevRank) pairs.push(i);
		prevRank = orderedHand[i].rank;
	}

	//four of a kind (3 adjacent pairs)
	//full house (3 adjacent pairs)
	if (pairs.length === 3) {
		if (orderedHand[1].rank === orderedHand[2].rank &amp;&amp; orderedHand[2].rank === orderedHand[3].rank)
			return 6;//four_of_a_kind
		else return 5;//full_house
	}

	//three of a kind (2 adjacent pairs)
	//two pair (2 adjacent pairs)
	if (pairs.length === 2) {
		if (pairs[1] - pairs[0] === 1)
			return 2;//three_of_a_kind
		else return 1;//two pair
	}
	
	//pair (jacks or better)
	if (pairs.length === 1) {
		if (orderedHand[pairs[0]].rank &gt; 10 || orderedHand[pairs[0]].rank === 1)
			return 0;
	}
	
	return -1;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/hoopy_populator.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;hoopy_populator&quot;;
this.author = &quot;Paul Wilkins (updated by Eric Walch, further updated by spara)&quot;;
this.copyright = &quot;(C) 2009 Paul Wilkins&quot;;
this.license     = &quot;CC BY-NC-SA 3.0&quot;; 

//add casino to system
this.systemWillPopulate = function (){
	// add in high tech level systems, but not in comunist systems. But, always in systems famous for their casinos.
	if (system.techLevel &gt;= 10 &amp;&amp; system.scrambledPseudoRandomNumber() &gt; 0.55 &amp;&amp; system.government != 4 || system.info.description.indexOf(&#39;hoopy casinos&#39;) &gt; -1) {
		//no main station, no casinos.
		if (system.mainStation) {
			var coords = system.mainStation.position.subtract(system.mainStation.position.direction().multiply(50000));
			system.setPopulator(&quot;hoopy_casino&quot;, {
				callback: function(pos) {			
					system.addShips(&#39;casinoship&#39;, 1, pos);
				}.bind(this),
				location: &quot;COORDINATES&quot;,
				coordinates: coords
			})
		}
	}
}
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
