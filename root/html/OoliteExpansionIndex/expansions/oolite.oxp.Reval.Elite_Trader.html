<html>
    <head>
        <title>Expansion Elite Trader</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Elite Trader</h1>

        <h2>Content</h2>
        <ul>
          
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">2 Equipment</a></li>
          <li><a href="#ships">5 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">5 Scripts</a></li>
        </ul>


        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Already a meta-game, the Guild of Elite Traders subverts Galcop and turns everything toward Trade. Perks include anti-masslock, witchpoint refuel, a forever-clean record, constant ship-enhancement, bonuses, new ship, lodges, cloak, fast dock; and Market scores count toward Elite. Progress in Grade brings a further edge. But - do not kill!</td>
                    <td>Already a meta-game, the Guild of Elite Traders subverts Galcop and turns everything toward Trade. Perks include anti-masslock, witchpoint refuel, a forever-clean record, constant ship-enhancement, bonuses, new ship, lodges, cloak, fast dock; and Market scores count toward Elite. Progress in Grade brings a further edge. But - do not kill!</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Reval.Elite_Trader</td>
                    <td>oolite.oxp.Reval.Elite_Trader</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Elite Trader</td>
                    <td>Elite Trader</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Mechanics</td>
                    <td>Mechanics</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Reval</td>
                    <td>Reval</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>1.19.3</td>
                    <td>1.19.3</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Elite_Trader_OXZ">http://wiki.alioth.net/index.php/Elite_Trader_OXZ</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/e/ee/Elite_Trader.oxz">https://wiki.alioth.net/img_auth.php/e/ee/Elite_Trader.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>CC-BY-NC-SA 4.0</td>
                    <td>CC-BY-NC-SA 4.0</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1671531180</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Elite%20Trader'>http://wiki.alioth.net/index.php/Elite%20Trader</a></p>
        <h3>ReadMe.txt</h3>
        <pre>Esteemed Commander,

The Galactic Guild of Elite Traders (G.E.T.) has studiously considered your application and is pleased to inform you of your admittance to our Order. We maintain Lodges in all systems of the Eight Charts, and you can be assured of a hearty welcome wherever your voyages now take you. 

May the GETTING exceed the Taking! - Refrain from combat and assume our gentle mantle, and reward will be equally forthcoming.

Yours most Truly,
Grand Master Exoloï¿½n of Inera.


Brother GETter,

The storied intergalactic Elite ranking is attainable for ship Captains of every disposition, peaceful or warlike. Eschew the space-lane on Station approach and watch your Grade soar as you dock with our Markets, trade skillfully, and doggedly ply the celestial Milk Run.

Note well that the ascending Grades of G.E.T. do not countenance the recondite practices of many of today&#39;s free traders. We are traditionalists. Contracts are frowned upon, as is opportunistic scooping and the sale of mined minerals and the dealing in precious stones and metals. Our Assessors will not credit you for such sales. We&#39;ll meet you on the Market floor or nowhere else. As one of our crasser pooker-playing Brothers once coined: if it ain&#39;t paid, the score&#39;s not made. We&#39;re about buying and selling.

As it forever has been, Market Observer and Market Inquirer, adjuncts to your calling, are almost de rigueur. Do not exit a space-dock without them!

Trade well! One day we&#39;ll meet for a toast in the Halls of Inera with the Exalted.

Your friend and mentor,
Dor Reval of Xexedi, Space Grocer.


PS. Much gratitude is due to spara, dybal, and another_commander for their encouragement, advice, and - above all - education of a Javascript neophyte.

Elite Trader is available from the Oolite Wiki at

http://wiki.alioth.net/img_auth.php/e/ee/Elite_Trader.oxz

and from the in-game Expansion Pack Manager.

Information:
http://wiki.alioth.net/index.php/File:Elite_Trader.oxz
-------------------------------------------------------

Version 1.9 
* makes total profit apply to the System as a whole: allowing for in-system trading, along with buying and selling at multiple stations in the same system.
* Cumulative profit is given alongside compliments on the Market screen.

Version 1.10

Introduces two G.E.T. entries to the F4 Interfaces screen:

* G.E.T. Master Advisory. The System Guild Master offers salutation and advice to trader acolytes.
* G.E.T. Max Trade Resetter offers the opportunity to set your Maximum Trade, as displayed on the Manifest screen, to the profit gained in the current system. Useful if the system glitched, or if you switched ships and now prefer a clean start.
* E.T. checks for the presence of Market Observer and, if found absent, adds a &#39;Trade (goods): xxx.xx cr&#39; line for each individual sale, after the manner of M.O.


Version 1.11

* G.E.T. strictures in respect to the _destruction_ of other ships have been tightened. Repeated ship-kills result in a permanent black mark, ruling out further speed, shield, and energy enhancements. It is perfectly acceptable, on the other hand, to damage an aggressor beyond repair and force him to disengage. No Guild penalty results from that form of self-defence.
* Augmented ship specs are reset to nominal after a given number of ship-kills.
* For straying Brothers, the Vow of Good Brotherhood makes its appearance on the F4 Interfaces screen: errant commanders are given the opportunity to reform. If accepted, all G.E.T. privileges are restored.


Version 1.12

* G.E.T. accepts a donation, a &#39;gift&#39;, comprising 1% of every member&#39;s profitable trade over 100 cr and 10% over 1000 cr. Donations determine the Brother&#39;s advancement in Grade and Title inside the Order, as well as being the prime source of G.E.T. wealth, power, and technical prowess.
* 23 Grades with associated Titles track the advancement of the Brother within the Guild. Grades stretch from &#39;Grocer&#39; (Grade 0) to &#39;Elite Grand Master Eternal&#39; (Grade 22). G.E.T. Grades have been liberally adapted from the 33 Degrees of Scottish Rite Freemasonry.
* A Brother&#39;s ethical standing is also noted on the Manifest screen: &#39;Good&#39;, &#39;Reformed&#39;, &#39;Errant&#39;, &#39;Bad&#39;, along with his donation to the current station, total donations, and Grade with Title.
* A full G.E.T. Ship Status Report has been added to the F4 Interfaces screen, showing the technical enhancements applied to the ship&#39;s systems since the Brother&#39;s induction. Both nominal and current specifications are noted for speed, thrust, shields, energy, and energy recharge rate. (Arrival Reports note only previous and revised specs while omitting thrust for reasons of space.)


Version 1.13

* Witchpoint fuelling for Good Brothers above probationary grade (facilitates fast trading between far-flung systems)
* Station contact (Assessor) named on Master Advisory screen
* Increased energy and shield recharge rate increments
* Improved consistency of donation display on Manifest


Version 1.14

* Master Advisory lists the System&#39;s planets with stations
*	Planets are numerically named on entering and leaving their gravity
	(eg. Larelace Prime, Lerelace II, Lerelace III, Lerelace IV, etc.)


Version 1.15

* Toggling weapons also toggles the anti-masslock system
* Guild stricture on gems and precious metals tightened 
* Advisory lists the system&#39;s stations (minus Rock Hermits)
* Advisory lists prices of system&#39;s key commodity, plus quantity


Version 1.16

* increased max_energy, max_energy_recharge, &amp; max_shield_recharge
* rectified determination of the 2 economic subdivisions (0..3,4..7)
* sundry optimizations - var replacing repeated properties etc.


Version	1.17 

* witchpoint comms Trade Advisory (where to sell) for GB &gt; Grade 1
* Guild Home greetings somewhat tailored to Brother&#39;s Grade &amp; Title
* max_thrust limit increased --&gt; 256
* further code optimizations - var for repeated properties etc.








</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_CLOAKING_DEVICE.html">Hull Shroud</a></td>
                    <td>yes</td>
                    <td align="right">100000</td>
                    <td align="center">10+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_ET_AUTODOCK.html">G.E.T. fast-docking facility</a></td>
                    <td>no</td>
                    <td align="right">50</td>
                    <td align="center">1+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/FE_constrictor2.html">Constrictor II</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/FE_constrictor2-guardian.html">Constrictor IIg</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/FE_constrictor2-player.html">FE_constrictor2-player</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/guild_lodge_template.html">guild_lodge_template</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/guild_lodge_tetrahedron_station.html">G.E.T. Guild Lodge</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. 
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/autodock_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	if (context != &quot;scripted&quot;) return false;
	return true
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/et_equipment_conditions.js</td>
                    <td><pre>&quot;use strict&quot;;

this.allowAwardEquipment = function(equipment, ship, context) {
	//if (context != &quot;scripted&quot;) return false;
	
	if (equipment == &quot;EQ_ET_AUTODOCK&quot;) return true;
	if (equipment == &quot;EQ_CLOAKING_DEVICE&quot;) return true;
	if (equipment == &quot;EQ_HULL_SHROUD&quot;) return true;

	return true;
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/et_hull_shroud_device.js</td>
                    <td><pre>/*
FE Shipyards hull shroud
*/

&quot;use strict&quot;;

this.name = &quot;Hull Shroud&quot;;
this.author	= &quot;Reval&quot;;


this.activated = function()
{
	player.ship.isCloaked = !player.ship.isCloaked;
	
	var hs = player.ship.isCloaked;
	var pc = player.commsMessage;
	var ac = &quot;&quot;;
	if (hs) ac=&quot;ACTIVE&quot;; else ac=&quot;inactive&quot;;
	pc(&quot;Hull shroud &quot;+ac,9);
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/et_script.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;Elite Trader&quot;;
this.author = &quot;Reval&quot;;
this.description = &quot;Already a meta-game, the Guild of Elite Traders subverts Galcop and turns everything toward Trade. Perks include anti-masslock, witchpoint refuel, a forever-clean record, constant ship-enhancement, bonuses, new ship, lodges, cloak, fast dock; and Market scores count toward Elite. Progress in Grade brings a further edge. But - do not kill!&quot;;
this.license = &quot;CC-BY-NC-SA 4.0&quot;;
this.version = &quot;1.19.3&quot;;


/* 

  Version 1.19.1
  --------------
  
  * A minor revision of the conditions for showing the &quot;noob Grocer&quot; text under G.E.T. Master Advisory. Previously dependent on the number of runs (6), now, once the Grocer has read and acknowleged the introductory text, G.E.T.&#39;s Master Advisory reverts to its true purpose of displaying the buy-prices of the system&#39;s primary commodities.
  
  
  Version 1.19
  ------------

 * Upon docking at a Lodge, G.E.T. will pay a &lt;b&gt;Boon of 100 cr&lt;/b&gt; in appreciation of your patronage of the system&#39;s principal Guild Home.
 * A new &lt;b&gt;F4 Interface&lt;/b&gt; exclusive to the Lodge: the &quot;&lt;u&gt;G.E.T. Guild Lodge Sales Advisory&lt;/u&gt;&quot;, showing sell prices for the two most traded goods at all stations insystem. Those above the Apprentice grade may go on availing themselves of the &lt;u&gt;Witchpoint Trade Advisory&lt;/u&gt; (giving only the single most-traded commodity prices), still a somewhat quicker option for the impatient trader.
 * NPC traffic will now be encountered going into and out of the Guild Lodge - assume most of these ships are Elite Traders!
 * Lodge Guardian Constrictor IIg craft will now respond to &lt;b&gt;S.O.S. signals&lt;/b&gt; from beleaguered vessels, along with any Galcop police present.
 * Lodge-tailored &lt;b&gt;welcome messages&lt;/b&gt; appear at the Guild Lodge after docking there.
 * G.E.T. has done away with Arrivals Screen refuel/repair/enhancement summaries in favour of &lt;u&gt;more succinct console messages&lt;/u&gt;, facilitating swifter passage to the Market. The Guilder is directed now to the &lt;b&gt;F4 Interfaces&lt;/b&gt; for fuller data on recent ship enhancements under &quot;&lt;u&gt;G.E.T. Ship Status Report&lt;/u&gt;&quot;.
 * Various persistent - and perhaps annoying - ET behavioural glitches have been remedied.
 * At every system&#39;s witchpoint you will find a &lt;b&gt;Guild Lodge&lt;/b&gt;. In keeping with G.E.T.&#39;s arcane and esoteric Order, these are small &lt;u&gt;pyramidal&lt;/u&gt; stations offering welcome, ceremonial, cameraderie, and a trading floor - but no shipyard. One of the Lodge&#39;s external faces sports Galcop insignia for obfuscatory purposes and to assure a small police presence. &lt;u&gt;Games may not be saved&lt;/u&gt; from inside a Lodge. The Guild Lodge flashes green and orange on your scanner.
 * An ancient Guild tradition is the deployment of &lt;b&gt;three guardian ships&lt;/b&gt;. Today, these are well-equipped Constrictor IIg models. A guardian will do nothing but patrol near the Lodge, unless disturbed. Guardians, in addition to the small (suborned) police presence which all Lodges attract, make a Guild Lodge&#39;s vicinity one of the safest - if not &lt;i&gt;the&lt;/i&gt; safest - in the entire system. Guardian ships flash blue and orange on your scanner.
 * The Guild accounts as a &lt;b&gt;gift&lt;/b&gt; the rescuing of any escape pod, be its occupant of the innocent or the guilty. Saving the helplessly adrift will gain a Guilder not only merit, but also, as befits a gift of this nature, a &lt;b&gt;5-point ship enhancement&lt;/b&gt; plus a real &lt;b&gt;Gift to the Guild of 1000 credits&lt;/b&gt; to further Grade advancement. This of course &lt;u&gt;on top of any bounty&lt;/u&gt; that Galcop deems you worthy of.
 * &quot;Cloaking technology&quot; - that &#39;Galcop advance&#39; much rumoured and whispered about - was, in fact, long ago an invention of the Guild. They called their device the &lt;b&gt;Hull Shroud&lt;/b&gt;. Needless to say, you, as a Guilder, can have it - at a price. Seek it at Stations with a high technological index.
 * The &lt;b&gt;Constrictor II&lt;/b&gt; - FE Shipyards&#39; &#39;black project&#39; - is no longer the restricted perk only of Grand Masters. You, as a lowly &#39;Master&#39; will now find it available, if you look hard. And it&#39;s not at all expensive! [nominal specs: thrust = 26; speed = 350; pylons = 4; capacity = 80 TC. Please note: this &lt;u&gt;exclusive ET ship&lt;/u&gt; is designed for parity with &lt;b&gt;FE Ships&lt;/b&gt;, not vanilla Oolite ships.]
 * G.E.T. will pay to all Guilders except Grocers a regular and periodic &lt;b&gt;Bonus&lt;/b&gt;. Guild bonuses are in gratitude for &quot;service, devotion, and fortitude.&quot; Bonuses are time-, Grade-, and performance-dependant: &lt;u&gt;the higher you are in Grade&lt;/u&gt; and the more &lt;u&gt;credits you have banked&lt;/u&gt;, the higher will be your Bonus.
 * G.E.T. owns to a new &lt;u&gt;sensitivity&lt;/u&gt; to their Guilders&#39; &lt;b&gt;species-gender&lt;/b&gt; - you can be addressed now as &quot;Sister&quot;, &quot;Brother&quot;, &quot;Sibling&quot; (bi-,&amp;nbsp;tri-&amp;nbsp;or null-sexed&amp;nbsp;persons), or just &#39;Guilder&#39; (the default).
 * As well as speedier Grade advancement, your &lt;b&gt;gifts&lt;/b&gt; to the Guild bring with them &lt;b&gt;3-point ship enhancements&lt;/b&gt;.
 * Practical &lt;b&gt;console advisories&lt;/b&gt; onstation for Grocers who have not yet made 4&amp;nbsp;runs.
 * G.E.T. begins to take account of &lt;b&gt;time&lt;/b&gt;...
 * &lt;b&gt;Time spent as a Good Guilder&lt;/b&gt; is recorded on your F5F5 Manifest in &lt;u&gt;Lave days&lt;/u&gt; (and Lave years).
 * &lt;b&gt;System-to-System Runs&lt;/b&gt; as a Good Guilder are numerically displayed on the F5F5 Manifest.
 * Main Station no longer mass-locks your ship on approach (so please take care you don&#39;t slam into it!) (Grade 1 and above)

   Version 1.18
   ------------
 * In spite of the addition of the new F4 page &#39;Gift to Guild&#39; (which speeds advancement in Grade), progression to the Elevated and Exalted Grades (10-22) has been made more arduous.
 * Donations are no longer limited to one per system: they are cumulative within the system.
 * &quot;Buber&#39;s Beats&quot; Milk Run guide for inductees on the F4 Interfaces screen.
 * &#39;Milk or Cream? - Buber&#39;s Beats&#39; - a comprehensive wiki section with solid guidance, a truncated version of which appears in-game.
 * Owing to a ballooning volume of Guild applications (blame TM!), the &#39;black box&#39; anti-Masslock device is now reserved for Probationary Grade 1 and above.
 * Buying and selling from and to multiple stations insystem is facilitated.
 * More data now appears on the G.E.T. F5 Mission screen.
 * Gifts and Last trade (with star, station, and goods) added to F5 Mission screen.
 * Since space allows it, a station&#39;s secondary legal commodity is now listed by the F4 Master Advisory along with the primary.
 * Much revision of the F4 Interfaces texts.
 * More immersive comms messages geared to Grocers.
 * Witchpoint Trade Advisory messages made more succinct.
 * A slight re-ordering and renaming of the G.E.T. Grades.
		
 (Please see https://wiki.alioth.net/index.php/Elite_Trader_OXZ)
		 
*/

	
this.playerSoldCargo = function(commodity, units, price) {
	var sale = 0, tp = &quot;&quot;, tm = &quot;&quot;, c=commodity,
	prec = ((c==&quot;gold&quot;)||(c==&quot;platinum&quot;)||(c==&quot;gem_stones&quot;));
	// Guild sales are conditional upon...
	var cond = ((this.$etLastPrice[c]&gt;0) &amp;&amp; (!prec));
	// selling preliminaries - update quantity and price
	if (cond) {
		sale = price * units;
		// this sale&#39;s profit &amp; total profit
		this.$etProfit = sale - this.$etLastBuy[c];
		// note the commodities sold
		if (this.$etProfit&gt;0) this.$etCommodities += c + &quot; &quot;;
		// allow for multiple station trades insystem (TEST!)
		//this.$etLastProfit = this.$etTotProfit;
		this.$etTotProfit += this.$etProfit;
		// allow for multiple station trades insystem (TEST!)
		this.$etLastProfit = this.$etTotProfit;
		// prepare trade messages
		tp=&quot;   ( &quot;+formatCredits(this.$etTotProfit/10,true,true)+&quot; )&quot;;
		tm=&quot;Trade (&quot;+c+&quot;): &quot;+formatCredits(this.$etProfit/10,true,true);
		/* max trade is calculated outside Market screen */
	}
	// see if we made a profit 
	this.$etMadeProfit = ((this.$etProfit&gt;0) &amp;&amp; (cond));

	// conditions for scoring
	this.$etOKtoScore = ((units &gt; 2) &amp;&amp; (!this.$etDone) &amp;&amp; (this.$etBoughtUnits&gt;0) &amp;&amp; (this.$etMadeProfit) &amp;&amp; (!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig) &amp;&amp; (!this.$etIsScooper));
	
	// decrement the manifest by # of units and price
	if (cond) {
		this.$etBoughtUnits -= units;
		this.$etBoughtPrice -= this.$etLastPrice[c] * units;
	}
	// display ship&#39;s cargo and its purchase value
	if ((price==this.$etLastPrice[c]) &amp;&amp; (!prec)) this._etPodsInHold(this.$etBoughtUnits);	

	var pm = player.consoleMessage;
	// credit a &quot;market killing&quot; on first profitable sell
	if (this.$etOKtoScore) {
		player.score++;
		this.$etPoints++;
		this.$etHasScored = true;
		pm(&quot;You made a killing!&quot;+tp);
		if (!this.$etMarketObserver) pm(tm);
		// for simplicity, only one score per station
		this.$etDone = true;
	// otherwise acknowledge a skillful trade if we&#39;re not just unloading
	} else if (this.$etMadeProfit &amp;&amp; (price!=this.$etLastPrice[c]) &amp;&amp; (this.$etStation!=this.$etLastStation)) {
		pm(&quot;Nice trade!&quot;+tp);
		if (!this.$etMarketObserver) pm(tm);
	}
}
	

this.playerBoughtCargo = function (commodity, units, price) {
	var c=commodity,
	prec = ((c==&quot;gold&quot;)||(c==&quot;platinum&quot;)||(c==&quot;gem_stones&quot;));
	// buying preliminaries - record quantity and price
	if (!prec) {
		this.$etBoughtUnits += units;
		this.$etBoughtPrice += price * units;
		this.$etLastBuy[c] = price * units;
		this.$etLastPrice[c] = price;
		// display ship&#39;s cargo and its purchase value
		this._etPodsInHold(this.$etBoughtUnits);
	}
}


this.guiScreenChanged = function(to, from) {
	var pm = player.consoleMessage;
	// update G.E.T. Status on Manifest screen
	if (from == &quot;GUI_SCREEN_MARKET&quot;) {
		// record last profit - for multiple station trades (TEST!)
		this.$etLastProfit=this.$etTotProfit;
		this._etGetMaxTrade();
		// deduct donation from player&#39;s credits
		if (this.$etProfit&gt;0) {
			this.$etDonation = this._etGetDonation(this.$etTotProfit);
			if (this.$etDonation&gt;0) {
				this.$etDonations += this.$etDonation;
				// donation is decicredits, so convert
				player.credits -= this.$etDonation/10; 
				pm(&quot;Your gift is accepted with appreciation.&quot;,5);
				pm(&quot;Advancement is secure!&quot;,5);
			}
		}
		// include donation in status report
		this._etShowStatus();
	} else
	if (to == &quot;GUI_SCREEN_MARKET&quot;) {
		// reset local individual profit
		if (!this.$etCheat) this.$etProfit=0;
		// a G.E.T. presence on the market floor
		pm(&quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;, 5);
		// show hold-status on entering Market
		var pods = this._etPodCount();
		this._etPodsInHold(pods);
		// advise player to unload and re-buy cargo after game-load w/ full hold
		if ((pods&gt;0) &amp;&amp; (this.$etBoughtPrice&lt;=0)) pm(&quot;Elite Trader: Please sell cargo and re-buy.&quot;,5); 
	} else
	if (to == &quot;GUI_SCREEN_MANIFEST&quot;) {
		// show best trade status on Manifest screen
		this._etShowStatus();
		// G.E.T. presence on the Manifest screen
		pm(&quot;Under the aegis of the &quot;+this.$etSystem+&quot; G.E.T&quot;, 10);
	} else 
	if (to == &quot;GUI_SCREEN_STATUS&quot;)
		if (!this.$etVowing) {
			if (this.$etIsWelcomed) {
				if (!this.$etMadeProfit)
					pm(&quot;We trust your stay at &quot;+this.$etSystem+&quot; proves profitable!&quot;, 10);
				else pm(this.$etSystem+&quot; is your lucky star!&quot;, 10);
			} else {
				// Welcome only said here!
				if (!this.$etIsWelcomed) this._etSayWelcome();
			} 
		} else this.$etVowing = false;
}


this.shipDockedWithStation = function(station) {
	this.$etLastStation = this.$etStation;
	this.$etStation = station;
	this.$etLastSystem = this.$etSystem;
	// clear flags and sold-quantities on docking
	this.$etDone = false;
	this.$etMadeProfit = false;
	this.$etHasScored = false;
	this.$etProfit = 0;
	// total profit is reset at WP exit
	this.$etCommodities = &quot;&quot;;
	// leave an identical ship at the shipyard
	// in case player wishes to reset its specs
	this._etCloneShip();
	var stan = player.ship.dockedStation.name;
	if (!this.$etBeenBellig) {
		// prep G.E.T. Advsory interface
		this._etPrepAdvisory(station);
		// prep G.E.T. Max Trade Resetter
		this._etPrepResetter(station);
		// prep G.E.T. Ship Status Report
		this._etPrepShipStatus(station);
		// prep G.E.T. Gift to Guild
		this._etPrepGift(station);
		// prep walkthrough
		this._etPrepBeats (station);
		// if at a Lodge, prep Sales Advisory
		if (stan==&quot;G.E.T. Guild Lodge&quot;)
			this._etPrepSales(station);
		// prep gender if not yet known
		if (!this.$etGendered)
			this._etPrepGender(station);
	} else this._etPrepVow(station);
	// generate G.E.T. contact name (Assessor)
	this.$etContact = randomName() + &quot; &quot; + randomName();
	// calculate monthly bonus (if any)
	var mb = this._etGetMBonus();
	var dy = this._etGetDays();
	var ld = this.$etLastBonusDay;
	if ((mb &gt; 0) &amp;&amp; (ld != dy)) {
		player.credits += mb;
		this.$etBonuses += mb;
		this.$etBonusCount ++;
		// prevent double bonus
		this.$etLastBonusDay = dy; 
	}
	// At least one Constrictor II customer model
	if (system.techLevel&gt;=10) this._etAddShip(&quot;FE_constrictor2-player&quot;, &quot;Constrictor II&quot;, 143000);
}


this.shipWillDockWithStation = function(station) {
	var pc = player.consoleMessage;
	// Boon for docking with a Guild Lodge
	if (station.name == &quot;G.E.T. Guild Lodge&quot;) { 
		if (!this.$etBooned) {
			player.credits+=100.0;
			pc(this.$etBro+&quot;, your Guild Boon has been given.&quot;);
			this.$etBooned = true;
		}
	}
	var p=player.ship;
	if ((!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig)) {
		// refuel a good Guilder&#39;s ship
		p.fuel = 7;
		// repair a good Guilder&#39;s ship
		p.serviceLevel = 100;
		pc(&quot;Ship refuelled and repaired...&quot;,9);
		// if the Brother&#39;s recent trades were satisfactory...
		if (this.$etHasScored) { 
			// incremental enhancements for the Guilder&#39;s ship
			this._etEnhanceShip(1);
			// report refuel, repair, and enhancement
			pc(&quot;Ship enhancements +1 - see F4 Interfaces.&quot;,9);
			pc(&quot; &quot;);
		}
	}
	// remove fast-docking equipment
	p.removeEquipment(&quot;EQ_ET_AUTODOCK&quot;);
	// reset station profit
	this.$etLastProfit=0;
}


this.shipWillLaunchFromStation = function(station) {
	// G.E.T. ensures the good Brother&#39;s record is always clean
	if ((!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig)) {
		player.ship.bounty = 0;
		// enable fast docking
		this._installAutoDock();
	}
	this.$etIsWelcomed = false;
}


this.shipLaunchedFromStation = function(stationLaunchedFrom) {
	if (!this.$etBeenBellig)
		player.commsMessage(&quot;The &quot;+this.$etSystem+&quot; G.E.T. Aegis wishes you clear lanes.&quot;, 6);
	// weapons offline is the G.E.T. approved setting
	//player.ship.weaponsOnline = false; // doesn&#39;t appear to be writable
}


this.playerStartedJumpCountdown = function(type, seconds) {
	if (!this.$etBeenBellig)
		player.commsMessage(&quot;Be careful out among the miscreants &quot;+this.$etBro+&quot;!&quot;,6);
	if ((!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig) &amp;&amp; (!this.$etIsScooper) &amp;&amp; (!player.ship.weaponsOnline)) player.ship.massLockable = this._etStrict();
}


this.shipEnteredStationAegis = function(station) {
	if (!this.$etBeenBellig)
		player.commsMessage(&quot;The Galactic Guild of Elite Traders welcomes you to &quot;+this.$etSystem+&quot; Aegis! We are at your disposal in the shipyard. Trade well!&quot;, 6);
	player.ship.massLockable = this._etStrict(); // true: no slamming into station
}


this.weaponsSystemsToggled = function(state) {
	// Strict mode for Grade 0, or not...
	if (this._etStrict()) {
		player.ship.massLockable = true;
		player.commsMessage(this.$etBro+&quot;, Grade 2 must be attained...&quot;,9);
		player.commsMessage(&quot;Please take care off-lane.&quot;,9);
	} else {
		// weapons online enables mass-locking
		player.ship.massLockable = state;
		if (state) var s=&quot;OFF&quot;; else var s=&quot;ON&quot;;
		player.commsMessage(&quot;Anti-masslock system &quot;+s);
	}
}


this.shipKilledOther = function(whom, damageType) {
	 // discount tins of SPAM and rocks
	 if ((whom.name!=&quot;SPAM&quot;) &amp;&amp; (whom.name!=&quot;Asteroid&quot;)) {
		pm = player.commsMessage;
		// G.E.T. disapproval
		pm(this.$etSystem+&quot; G.E.T. notes their Brother&#39;s lapse...&quot;);
		this.$etKillCount++;
		this.$etIsBellig = (this.$etKillCount&gt;0); // temporary
		// a single kill might be accidental, but 3? - unlikely!
		if (this.$etKillCount&gt;2) { 
			this.$etBeenBellig = true; // permanent - a blot on the record
			this._etFloorSpecs(); // ship specs back to nominal
			// refund donations
			player.credits += this.$etDonations/10;
			// and reset them
			this.$etDonations = 0.0;
			pm(&quot;Your gifts to the Guild have been returned.&quot;);
			pm(&quot;All G.E.T. privileges are rescinded.&quot;);
			pm(&quot;Vow to be a better Brother!&quot;);
		}
	}
}


this.shipScoopedOther = function(whom) {
     // G.E.T. disapproval
	player.commsMessage(this.$etSystem+&quot; G.E.T. notes their Brother&#39;s lapse...&quot;);
	this.$etIsScooper = true;
}


this.playerRescuedEscapePod = function(fee, reason, occupant) {
    pc=player.commsMessage;
	// G.E.T. accounts the saving of any miscreant a _gift_
	// the Guilder&#39;s selfless act does not go unrewarded
	player.credits += 1000.0;
	this._etEnhanceShip(5);
	pc(this.$etBro+&quot;, we account your saving of this miscreant a *gift*...&quot;,9);
	pc(&quot;Your selfless and noble act has not gone unrewarded!&quot;,9);
}


this.shipEnteredPlanetaryVicinity = function(planet) {
	player.commsMessage(&quot;Entering gravity of &quot;+this._etGetPlanetName(planet));
	// Weps will always masslock near planets
	if (player.ship.weaponsOnline) player.ship.massLockable = this._etStrict(); // no slamming into planet
}


this.shipExitedPlanetaryVicinity = function(planet) {
	player.commsMessage(&quot;Leaving gravity of &quot;+this._etGetPlanetName(planet));
	if ((!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig) &amp;&amp; (!this.$etIsScooper) &amp;&amp; (!player.ship.weaponsOnline)) player.ship.massLockable = this._etStrict();
}


this.shipExitedWitchspace = function() {
	// reset globals that require it
	this.$etSystem = System.systemNameForID(system.ID);
	this.$etIsWelcomed = false;
	if (this.$etKillCount&gt;0) this.$etKillCount--;
	this.$etIsBellig = (this.$etKillCount&gt;0);
	this.$etIsScooper = false;
	// total profit is for system
	this.$etTotProfit = 0;
	// (reset) for multiple station trades
	this.$etLastProfit = 0;
	this._etGetMaxTrade();
	// one donation and gift per system
	this.$etDonated = false;
	this.$etGifted = false;
	// build G.E.T. status screen
	this._etShowStatus();
	// witchpoint fuelling for GBs past probation
	var p=player.ship, pc=player.commsMessage;
	if ((!this.$etIsBellig) &amp;&amp; (!this.$etBeenBellig) 
		&amp;&amp; (!p.weaponsOnline) &amp;&amp; (this._etGetGrade()&gt;1)) {
		p.fuel = 7;
		pc(&quot;&quot;); // LF
		pc(&quot;Witchpoint fuelling complete.&quot;);
		pc(this.$etSystem+&quot; G.E.T. wishes their &quot;+this.$etBro+&quot; a peaceful jump.&quot;);
		// witchpoint Trade Advisory (where to sell)
		// (if MZ isn&#39;t present)
		if (!this.$etMZ)
			this._etCommsTradeAdvisory();
	}
	// increment number of sys-to-sys runs
	this.$etRuns+=1;
	// Guild Boon once per system
	this.$etBooned = false;
	// report miscreants in system
	var mis = system.countShipsWithPrimaryRole(&quot;pirate&quot;);
	if (!this.$etMZ) {
		pc(&quot;Miscreants in system: &quot;+mis,9);
		pc(&quot; &quot;);
	}
}


this.playerBoughtNewShip = function(ship, price) {
	// spec globals to ship&#39;s initial values
	this._etResetSpecs();
	this.$etShipChanged = true;
	this._etGetMaxTrade();
	this._etShowStatus();
}


this.playerWillSaveGame = function(message) {
	missionVariables.etSpeed = this.$etLastSpeed; 
	missionVariables.etThrust = this.$etLastThrust;
	missionVariables.etEnergy = this.$etLastEnergy;
	missionVariables.etShields = this.$etLastShields;
	missionVariables.etRecharge = this.$etLastRecharge;
	missionVariables.etERecharge = this.$etLastERecharge;
	missionVariables.etPoints = this.$etPoints;
	missionVariables.etKills = this.$etKillCount;
	missionVariables.etMaxTrade = this.$etMaxTrade;
	missionVariables.etMinTrade = this.$etMinTrade;
	missionVariables.etMaxTSystem = this.$etMaxTSystem;
	missionVariables.etMaxTGoods = this.$etMaxTGoods;
	missionVariables.etMaxTShip = this.$etMaxTShip;
	missionVariables.etMaxTShipName = this.$etMaxTShipName;
	missionVariables.etMaxTShipTC = this.$etMaxTShipTC;
	missionVariables.etVowCount = this.$etVowCount;
	missionVariables.etDonations = this.$etDonations;
	missionVariables.etGifts = this.$etGifts;
	missionVariables.etGiftCount = this.$etGiftCount;
	missionVariables.etGendered = this.$etGendered;
	missionVariables.etBro = this.$etBro; // gender!
	missionVariables.etRuns = this.$etRuns;
	missionVariables.etYears = this.$etYears;
	missionVariables.etDays = this.$etDays;
	missionVariables.etDaysStart = this.$etDaysStart; // set only once in script!
	missionVariables.etBonuses = this.$etBonuses;
	missionVariables.etBonusCount = this.$etBonusCount;
	missionVariables.etLastBonusDay= this.$etLastBonusDay;
	missionVariables.etNoob= this.$etNoob;
	// cannot save booleans as &quot;false/true&quot; - must convert
	// set only once at Guilder career start
	if (this.$etDaysStarted) var dstd=1; else var dstd=0;
	missionVariables.etDaysStarted = dstd;
	// cannot save booleans as &quot;false/true&quot; - must convert
	if (this.$etGendered) var gen=1; else var gen=0;
	missionVariables.etGendered = gen;
	// cannot save booleans as &quot;false/true&quot; - must convert
	if (this.$etStrict) var strct=1; else var strct=0;
	missionVariables.etStrict = strct;
	// cannot save booleans as &quot;false/true&quot; - must convert
	if (this.$etBeenBellig) var bb=1; else var bb=0;
	missionVariables.etBeenBellig = bb;
}


this.systemWillPopulate = function() {
	// add Guild Lodge and 3 Guardians
	var adds = system.legacy_addShipsWithinRadius;
	adds(&quot;lodge&quot;, 1, &quot;wpu&quot;, [0, 0, 0], 6400);
	adds(&quot;guardian&quot;, 3, &quot;wpu&quot;, [0, 0, 0], 6400);
}


this.startUpComplete = function () {
	var p = player.ship;
	this.$etSystem = System.systemNameForID(system.ID);
	this._etResetSpecs();
	// default is current ship
	this.$etMaxTShip = p.shipClassName;
	this.$etMaxTShipName = p.shipUniqueName;
	this.$etMaxTShipTC = p.cargoSpaceCapacity;
	// Load saved globals, if present
	var spd = missionVariables.etSpeed;
	var thr = missionVariables.etThrust;
	var ene = missionVariables.etEnergy;
	var shi = missionVariables.etShields;
	var rec = missionVariables.etRecharge;
	var rece = missionVariables.etERecharge;
	
	if (spd&gt;=this.$etInitialSpeed) this.$etLastSpeed = spd;
	if (thr&gt;=this.$etInitialThrust) this.$etLastThrust = thr;
	if (ene&gt;=this.$etInitialEnergy) this.$etLastEnergy = ene;
	if (shi&gt;=this.$etInitialShields) this.$etLastShields = shi;
	if (rec&gt;=this.$etInitialRecharge) this.$etLastRecharge = rec;
	if (rece&gt;=this.$etInitialERecharge) this.$etLastERecharge = rece;
	
	if (spd&gt;=this.$etInitialSpeed) p.maxSpeed = spd;
	if (thr&gt;=this.$etInitialThrust) p.maxThrust = thr;
	if (ene&gt;=this.$etInitialEnergy) p.maxEnergy = ene;
	if (shi&gt;=this.$etInitialShields) p.maxForwardShield = shi;
	if (rec&gt;=this.$etInitialRecharge) p.forwardShieldRechargeRate = rec;
	if (rece&gt;=this.$etInitialERecharge) p.energyRechargeRate = rece;
	// load points here too
	var pts = missionVariables.etPoints; if (pts&gt;0) this.$etPoints = pts;
	var kil = missionVariables.etKills; if (kil&gt;0) this.$etKillCount = kil; 
	var maxt = missionVariables.etMaxTrade; this.$etMaxTrade = maxt;
	var mint = missionVariables.etMinTrade; this.$etMinTrade = mint;
	var maxts = missionVariables.etMaxTSystem; this.$etMaxTSystem = maxts;
	var maxtg = missionVariables.etMaxTGoods; this.$etMaxTGoods = maxtg;
	var maxts = missionVariables.etMaxTShip; if (maxts!=&quot;&quot;) this.$etMaxTShip = maxts;
	var maxtn = missionVariables.etMaxTShipName; if (maxtn!=&quot;&quot;) this.$etMaxTShipName = maxtn;
	var maxtt = missionVariables.etMaxTShipTC; if (maxtt!=0) this.$etMaxTShipTC = maxtt;
	var vc = missionVariables.etVowCount; if (vc!=null) this.$etVowCount = vc;
	var dons = missionVariables.etDonations; if (dons!=null) this.$etDonations = dons;
	var gifts = missionVariables.etGifts; if (gifts!=null) this.$etGifts = gifts;
	var gcount = missionVariables.etGiftCount; if (gcount!=null) this.$etGiftCount=gcount;
	var bro = missionVariables.etBro; if (bro!=null) this.$etBro = bro;
	var runs = missionVariables.etRuns; if (runs!=null) this.$etRuns = runs;
	var yrs = missionVariables.etYears; if (yrs!=null) this.$etYears = yrs;
	var days = missionVariables.etDays; if (days!=null) this.$etDays = days;
	var dayst = missionVariables.etDaysStart; if (dayst!=null) this.$etDaysStart = dayst;
	var bons = missionVariables.etBonuses; if (bons!=null) this.$etBonuses = bons;
	var bc = missionVariables.etBonusCount; if (bc!=null) this.$etBonusCount = bc;
	var lbd = missionVariables.etLastBonusDay; if (lbd!=null) this.$etLastBonusDay = lbd;
	var noo = missionVariables.etNoob; if (noo!=null) this.$etNoob = noo;
	// have we started the clock? - permanent and persistent
	if (missionVariables.etDaysStarted != null) {
		var dstd=missionVariables.etDaysStarted;
		this.$etDaysStarted = (dstd == 1);
	}
	// cannot load booleans as &quot;true/false&quot; - must convert
	if (missionVariables.etBeenBellig != null) {
		var bb=missionVariables.etBeenBellig;
		this.$etBeenBellig = (bb == 1);
		// floor ship specs if the Brother went bad
		if (this.$etBeenBellig) this._etFloorSpecs();
	}
	// waive or allow Grade 0 strictures
	if (missionVariables.etStrict != null) {
		var strct=missionVariables.etStrict;
		this.$etStrict = (strct == 1);
	}
	// Gender-check (persistent)
	if (missionVariables.etGendered != null) {
		var gen=missionVariables.etGendered;
		this.$etGendered = (gen == 1);
	}
	// loading globals complete.
	if (this._etHasFE()) log(this.name, &quot;finds FE Ships present (&quot;+p.shipClassName+&quot;)&quot;);
	// dock ship
	var sta = p.dockedStation;
	this.shipDockedWithStation(sta);
	// welcome revenant back to station
	var pc = player.consoleMessage, s=this.$etSystem;
	if (this.$etRuns&gt;0) pc(&quot;Delighted to have you back at &quot;+s+&quot;, &quot;+this.$etBro+&quot;!&quot;,9);
	this._etGetMaxTrade();
	this._etShowStatus();
	var stan = player.ship.dockedStation.name;
	if (!this.$etBeenBellig) {
		// prep G.E.T. Advisory interface
		this._etPrepAdvisory(sta);
		// prep G.E.T. Max Trade Resetter
		this._etPrepResetter(sta);
		// prep G.E.T. Ship Status Report
		this._etPrepShipStatus(sta);
		// prep Gift solicitation
		this._etPrepGift (sta);
		// prep walkthrough
		this._etPrepBeats (sta);
		// if at a Guild Lodge, prep Sales Advisory
		if (stan==&quot;G.E.T. Guild Lodge&quot;)
			this._etPrepSales(sta);
		// conditionally, prep gender request
		if (!this.$etGendered) this._etPrepGender(sta);
	} else this._etPrepVow(sta);
	// set Grade Advance divisor according to present Grade
	var grade=this._etGetGrade();
	// determine strictness (anti-masslock on or off)
	this.$etStrict = this._etStrict();
	// start the career clock if not already started
	if (!this.$etDaysStarted) { 
		this.$etDaysStart = clock.days;
		this.$etDaysStarted = true;
	}
}


this.startUp = function() {
    log(this.name, &quot;Initialising OXP &quot; + this.name);
	// declare &amp; initialize globals
	this.$etMarketObserver = false;
	if (worldScripts[&quot;market_observer3&quot;]) 
		this.$etMarketObserver = true;
	this.$etMZ = false;
	if (worldScripts[&quot;Merchanter&#39;s Zeal&quot;]) 
		this.$etMZ = true;
	// TEST
	log(this.name, &quot;finds Merchanter&#39;s Zeal&quot;);
	this.$etNoob = &quot;yes&quot;;
	this.$etIsWelcomed = false;
	this.$etDone = false;
	this.$etMadeProfit = false;
	this.$etOKtoScore = false;
	this.$etHasScored = false;
	this.$etIsWelcomed = false;
	this.$etShipChanged = false;
	this.$etIsScooper = false;
	this.$etIsBellig = false; // temporary
	this.$etBeenBellig = false; // permanent
	this.$etDonated = false;
	this.$etGifted = false;
	this.$etKillCount = 0; // ship-kills
	this.$etPoints = 0; // G.E.T. Elite-points scored
	this.$etVowCount = 0;
	this.$etVowing = false; // controls post-vow message
	this.$etBoughtPrice = 0;
	this.$etBoughtUnits = 0;
	this.$etProfit = 0;
	this.$etTotProfit = 0;
	this.$etLastProfit = 0; // for multiple station trades insystem
	this.$etMaxTrade = 0;
	this.$etMinTrade = 1000000;
	this.$etDonation = 0.0; // donation on station profit
	this.$etDonations = 0.0; // total &#39;donations&#39; to G.E.T.
	this.$etGift = 0.0; // &#39;gift&#39; (voluntary) of station profit
	this.$etGifts = 0.0; // total &#39;gifts&#39; to Guild coffers
	this.$etGiftCount= 0; // how many gifts we&#39;ve given
	this.$etStrict=true; // waive or allow Grade 0 stricture
	this.$etSystem = &quot;&quot;;
	this.$etLastSystem = &quot;&quot;;
	this.$etNextSystem = &quot;&quot;;
	this.$etContact = &quot;&quot;; // named station contact (Assessor)
	this.$etCommodities = &quot;&quot;; // commodities sold
	this.$etMaxTSystem = &quot;&quot;; // best trade&#39;s systen
	this.$etMaxTGoods = &quot;&quot;; // best trade&#39;s commodity
	this.$etMaxTShip = &quot;&quot;; // best trade&#39;s ship class
	this.$etMaxTShipName = &quot;&quot;; // best trade&#39;s ship name
	this.$etMaxTShipTC = 0; // best trade&#39;s ship tonnage
	this.$etStation = new Object(); // ??
	this.$etLastStation = new Object(); // ??
	this.$etLastPrice = new Array();
	for (var c=0; c&lt;20; c++) this.$etLastPrice[c]=0;
	this.$etLastBuy = new Array();
	for (c=0; c&lt;20; c++) this.$etLastBuy[c]=0;
	
	this.$etInitialSpeed = 0;
	this.$etInitialThrust = 0;
	this.$etInitialEnergy = 0;
	this.$etInitialShields = 0;
	this.$etInitialRecharge = 0.0; // shields recharge
	this.$etInitialERecharge = 0.0; // energy recharge

	this.$etLastSpeed = 0.0; 
	this.$etLastThrust = 0;
	this.$etLastEnergy = 0;
	this.$etLastShields = 0;
	this.$etLastRecharge = 0.0;
	this.$etLastERecharge = 0.0;
	
	// constants
	this.$etLimitSpeed = 512;
	this.$etLimitThrust = 256;
	this.$etLimitEnergy = 1024;
	this.$etLimitShields = 512;
	this.$etLimitRecharge = 16.0; // shield-R should be half energy-R
	this.$etLimitERecharge = 32.0; 
	// 12,000 cr per Grade is a good compromise	
	this.$etGradeAdvance = 120000; 
	
	// G.E.T. Grade Titles
	this.$etGETTitle = [
	&quot;Grocer&quot;,
	&quot;Entered Apprentice&quot;,
	&quot;Fellowcrafter&quot;,
	&quot;Master Trader&quot;,
	&quot;Master Traveller&quot;,
	&quot;Perfect Master&quot;,
	&quot;Master of the Brazen Serpent&quot;,
	&quot;Provost and Judge&quot;,
	&quot;Intendant of the Orbital&quot;,
	&quot;Master of the Guild House&quot;,
	&quot;Master Elect&quot;,
	&quot;Sublime Master Elected&quot;,
	&quot;Master of Mercy&quot;, 
	&quot;Master of the Ninth Arch&quot;,
	&quot;Grand Elect Master&quot;,
	&quot;Knight of the East&quot;,
	&quot;Knight of the East and West&quot;,
	&quot;Knight of the Rosy Star&quot;,
	&quot;Friend and Brother Eternal&quot;,
	&quot;Prince of Inera&quot;,
	&quot;Sublime Keeper of the Galactic Secret&quot;, 
	&quot;Grand Master Supreme, Serene and Sublime&quot;,
	&quot;Elite Grand Master Everlasting&quot;
	];
	// Roman numerals for planet nomenclature
	this.$etRoman = [&quot;&quot;,&quot;I&quot;,&quot;II&quot;,&quot;III&quot;,&quot;IV&quot;,&quot;V&quot;,&quot;VI&quot;,&quot;VII&quot;,&quot;VIII&quot;,&quot;IX&quot;,&quot;X&quot;];
	// Industrial and Agricultural products
	this.$etIGoods = [&quot;computers&quot;,&quot;firearms&quot;,&quot;machinery&quot;,&quot;luxuries&quot;,&quot;alloys&quot;];
	this.$etAGoods = [&quot;furs&quot;,&quot;liquor_wines&quot;,&quot;radioactives&quot;,&quot;slaves&quot;,&quot;minerals&quot;,&quot;textiles&quot;,&quot;food&quot;];
	this.$etCheat = false; // toggle &#39;hidden feature&#39; for testing - default OFF
	// Brother or Sister?
	this.$etBro = &quot;Guilder&quot;; // switchable to &quot;Sister&quot;, &quot;Brother&quot;, or &quot;Sibling&quot;
	this.$etGendered = false; // true once imparted
	// number of system-to-system runs
	this.$etRuns = 0;
	// number of years as a Guilder
	this.$etYears = 0.0; // years passed since induction
	// constant: days in Lave Year - can (should?) be adjusted up/down
	this.$etLaveYear = 365;
	// days as a Guilder
	this.$etDays = 0; // days passed since G.E.T. induction
	this.$etDaysStart = 2084004; // day(s) _at_ G.E.T. induction
	this.$etDaysStarted = false; // have we started the G.E.T. clock?
	// total time or runs bonuses paid by G.E.T.
	this.$etBonuses = 0.0;
	this.$etBonusCount = 0;
	this.$etLastBonusDay = 0;
	// Guild Boon paid once per system
	this.$etBooned = false;
}


// are we being strict? (grade-dependent)
this._etStrict = function() {
	var strict = (this._etGetGrade() &lt;= 1);
	this.$etStrict = strict;
	return strict;
}


// list out ships in scanner range
this._etScanShips = function() {
	var pc = player.commsMessage;
	var ps = player.ship;
	var sc = ps.checkScanner(false);
	// if (ps.injectorsEngaged)
	for (var i=0; i&lt;sc.length; i++)
		pc(sc[i],9);
	pc(&quot; &quot;);
}


// obtain the G.E.T. numeric grade (from total donation)
this._etGetGrade = function() {
	var grade = 0;
	var lim=this.$etGETTitle.length-1;
	var don = this.$etDonations.toFixed(0); // use parseInt()?
	// set Grade Advance according to present grade
	grade = (don/this.$etGradeAdvance);
	grade = grade.toFixed(0); // use parseInt()?
	if (grade&gt;lim) grade=lim;
	return grade;
}


// # of cargo pods in ship&#39;s hold
this._etPodCount = function() {
	var result = 0, man=manifest.list;
	for (var i=0; i&lt;man.length; i++) {
		var q = man[i].quantity;
		if (q &gt; 0) result+= q;
	}	
	return result;
}


// is FE Ships Player installed?
this._etHasFE = function() {
	var str = player.ship.shipClassName;
	var n = str.search(&quot; FE&quot;);
	return (n&gt;-1);
}


// leave an identical ship at the shipyard
// in case player wishes to reset its specs
this._etCloneShip = function() {
	if (oolite.versionString&gt;&quot;1.88&quot;) {
		var pr = player.ship.price * 0.75;
		system.mainStation.addShipToShipyard({ 
			short_description: &quot;G.E.T. offers you this clone of your ship, to reset our augmented specs to nominal, should you desire a clean break.&quot;, 
			shipdata_key: player.ship.dataKey, 
			price: pr, 
			personality:0,
			extras:[&quot;&quot;]
		});
	}
}


// Brother&#39;s profit-donation to G.E.T
// * in decicredits *
this._etGetDonation = function(profit) {
	var donation = 0.0;
	if (!this.$etDonated) {
		if (profit&gt;100.0) // &gt; 10.0 cr
			// profit &gt; 100 cr = 1% donation
			if (profit&lt;=10000.0) { // &lt;= 1000.0 cr
			donation = profit * 0.01;
			// proft &gt; 1000 cr = 10% donation
			} else donation = profit * 0.1;
	}
	return donation;
}


// Brother&#39;s running max/min trades and commodities
this._etGetMaxTrade = function() {
	if (this.$etTotProfit&gt;this.$etMaxTrade) {
		this.$etMaxTrade=this.$etTotProfit;
		this.$etMaxTSystem=this.$etSystem;		
		this.$etMaxTGoods=this.$etCommodities;		
		// the ship we maxed it in
		var p = player.ship;
		this.$etMaxTShip = p.shipClassName;
		this.$etMaxTShipName = p.shipUniqueName;
		this.$etMaxTShipTC = p.cargoSpaceCapacity;
	}
	if (this.$etTotProfit&lt;this.$etMinTrade) this.$etMinTrade=this.$etTotProfit;
}


// Brother&#39;s standing, best trade, today&#39;s profit, donations etc --&gt; Manifest
this._etShowStatus = function() { 
	if (this.$etBeenBellig) var br = &quot;Bad&quot;; else
	if (this.$etIsBellig) var br = &quot;Errant&quot;; else
	if (this.$etVowCount&gt;0) var br = &quot;Reformed&quot;; else
		var br = &quot;Good&quot;; 
		var bro = this.$etBro; // gender!
	var pn = player.name;
	var statusBrother = br+&quot; &quot;+bro+&quot; &quot;+pn+&quot;, with &quot;+formatCredits(player.credits, true, true);
	// days or years as a Guilder
	var dg = this._etGetDays(); // this.$etDays-this.$etDaysStart; 
	var yg=this._etGetYears();
	var statusTime = &quot;Time as a &quot;+bro+&quot;: &quot;+dg+&quot; Lave days (&quot;+yg+&quot; LY)&quot;;
	// number of runs as a Guilder
	var runs=player.score;
	if (this.$etRuns&lt;=0) runs = player.score; 
		else runs=this.$etRuns; // (best guess or # of runs)  
	this.$etRuns = runs; // set here each time - belt&#39;n&#39;braces
	var statusRuns = &quot;System-to-System Runs: &quot;+runs; //this.$etRuns;
	// most profitable trade so far
	var statusTrade = &quot;Best trade: &quot; + formatCredits(this.$etMaxTrade/10, true, true ) + &quot; (&quot; + this.$etMaxTSystem + &quot; - &quot;+this.$etMaxTGoods+&quot;)&quot;;
	// ship + tonnage in which best trade was made
	var sn = this.$etMaxTShipName; 
	if ((sn==&quot;&quot;) || (sn==null)) sn = &quot;&quot;; else sn=&quot; &#39;&quot;+this.$etMaxTShipName+&quot;&#39;&quot;; 
	var statusShip = &quot;Ship: &quot;+this.$etMaxTShip+sn+&quot; (&quot;+this.$etMaxTShipTC+&quot; TC)&quot;;
	// present orbital (station)
	var ps=player.ship, po=&quot;none&quot;;
	if (ps.dockedStation!=null) po=ps.dockedStation.displayName; 
	var statusOrb = &quot;Orbit: &quot; + this.$etSystem +&quot; &quot;+po; 
	// last market trade
	var lp = this.$etLastProfit/10;
	var statusLastt = &quot;Last trade: &quot;+formatCredits(lp,true,true)+&quot; (&quot;+this.$etSystem+&quot; &quot;+po+&quot; - &quot;+this.$etCommodities+&quot;)&quot;;
	// total profit this system (so far)
	// allow for multiple market &amp; station trades insystem
	// (may not be the best method, but the simplest)
	if (this.$etLastProfit != this.$etTotProfit) this.$etTotProfit += this.$etLastProfit;
	var tp = this.$etTotProfit/10;
	var profitTotal = &quot;Profit here: &quot;+formatCredits(tp,true,true);
	// (monthly) time bonuses paid by G.E.T. to Guilder
	var mb = this.$etBonuses; var mbc = this.$etBonusCount;
	var statusBonus = &quot;Bonuses: &quot; + formatCredits(mb,true,true) + &quot; (&quot;+ mbc + &quot;)&quot;;
	// donation this station
	var don = this.$etDonation/10; 
	var statusDonation = &quot;Donation here: &quot;+formatCredits(don,true,true);
	// total donations as cr
	var dons = this.$etDonations/10;
	var statusDonations = &quot;Donations &amp; Gifts: &quot;+formatCredits(dons,true,true);
	// Gifts
	var gifts = this.$etGifts/10; 
	var gc=this.$etGiftCount;
	var statusGifts = &quot;Gifts: &quot;+formatCredits(gifts,true,true)+&quot; (&quot;+gc+&quot;)&quot;;
	// G.E.T. Grade and Title
	var grade = this._etGetGrade();
	var statusGrade = &quot;Grade &quot;+grade;
	var title = this.$etGETTitle[grade];
	statusGrade += &quot;: &quot;+title;
	// display the G.E.T. Status Report
	mission.setInstructions([&quot;G.E.T. Status:&quot;,statusBrother,statusTime,statusRuns,statusOrb,statusTrade,statusShip,statusLastt,profitTotal,statusBonus,statusDonation,statusDonations,statusGifts,statusGrade], this.name);
}


// add a specified ship to Main shipyard
this._etAddShip = function(id,name,pr) { 
	system.mainStation.addShipToShipyard({ 
		short_description: name+&quot;: standard customer model, price &quot;+formatCredits(pr,true,true)+&quot;.&quot;, 
		shipdata_key: id, 
		price: pr, 
		personality:0,
		extras:[&quot;&quot;]
	});
}


// enhance ship by &lt;points&gt; points
this._etEnhanceShip = function(points) {
	var p = player.ship;
	// incremental defensive enhancements for the Guilder&#39;s ship
	if (this.$etLastSpeed&lt;this.$etLimitSpeed) {
		// secure against possible O-drive corruption
		p.maxSpeed=this.$etLastSpeed+1.0;
		}
		if (this.$etLastThrust&lt;this.$etLimitThrust) {
			p.maxThrust+=points;
		}
		if (this.$etLastShields&lt;this.$etLimitShields) {
			p.maxForwardShield+=points;
			p.maxAftShield+=points;
		}
		if (this.$etLastEnergy&lt;this.$etLimitEnergy) {
			p.maxEnergy+=points;
		}
		if (this.$etLastRecharge&lt;this.$etLimitRecharge) {
			p.forwardShieldRechargeRate+=(points*0.05);
			p.aftShieldRechargeRate+=(points*0.05);
		}
		if (this.$etLastERecharge&lt;this.$etLimitERecharge) {
			p.energyRechargeRate+=(points*0.1);
		}
		// update last specs after increments
		this.$etLastSpeed=p.maxSpeed; 
		this.$etLastThrust=p.maxThrust;
		this.$etLastShields=p.maxForwardShield;
		this.$etLastEnergy=p.maxEnergy;
		this.$etLastRecharge=p.forwardShieldRechargeRate;
		this.$etLastERecharge=p.energyRechargeRate;
}


// nullify ship enhancements, setting specs to nominal
this._etFloorSpecs = function() {
	var p = player.ship;
	this.$etLastSpeed = this.$etInitialSpeed; 
	this.$etLastThrust = this.$etInitialThrust;
	this.$etLastShields = this.$etInitialShields;
	this.$etLastEnergy = this.$etInitialEnergy;
	this.$etLastRecharge = this.$etInitialRecharge;
	this.$etLastERecharge = this.$etInitialERecharge;

	p.maxSpeed = this.$etInitialSpeed;
	p.maxThrust = this.$etInitialThrust;
	p.maxForwardShield = this.$etInitialShields;
	p.maxAftShield = this.$etInitialShields;
	p.maxEnergy = this.$etInitialEnergy;
	p.forwardShieldRechargeRate = this.$etInitialRecharge;
	p.aftShieldRechargeRate = this.$etInitialRecharge;
	p.energyRechargeRate = this.$etInitialERecharge;
}


this._etResetSpecs = function() {
	var p = player.ship;
	this.$etLastSpeed = p.maxSpeed; 
	this.$etLastThrust = p.maxThrust;
	this.$etLastShields = p.maxForwardShield;
	this.$etLastEnergy = p.maxEnergy;
	this.$etLastRecharge = p.forwardShieldRechargeRate;
	this.$etLastERecharge = p.energyRechargeRate;
	// note ship&#39;s initial specs (for later comparisons)
	this.$etInitialSpeed = p.maxSpeed;
	this.$etInitialThrust = p.maxThrust;
	this.$etInitialShields = p.maxForwardShield;
	this.$etInitialEnergy = p.maxEnergy;
	this.$etInitialRecharge = p.forwardShieldRechargeRate;
	this.$etInitialERecharge = p.energyRechargeRate;
}


this._installAutoDock = function() {
	var p = player.ship;
	// give the non-straying Brother free fast-docking capability
	if (!this.$etIsBellig) {
		if (p.equipmentStatus(&quot;EQ_DOCK_COMP&quot;) != &quot;EQUIPMENT_OK&quot;) {
			p.awardEquipment(&quot;EQ_ET_AUTODOCK&quot;);
		}
	}
}


this._etSayWelcome = function() {
	var bro = this.$etBro;
	var pc = player.consoleMessage;
	var sta= player.ship.dockedStation;
	var isgl = (sta.name == &quot;G.E.T. Guild Lodge&quot;);
	// introductory welcome to newly inducted Grocers
	if (this.$etRuns&lt;1) {
		pc(&quot;The Galctic Guild of Elite Traders (G.E.T.)&quot;,9);
		pc(&quot;is highly pleased to bring you into our Order.&quot;,9);
		pc(&quot;We wish you great fortune and rapid advancement!&quot;,9);
		pc(&quot; &quot;);
	}
	// special messages on docking with a Guild Lodge
	if (isgl) {
		pc(&quot;Welcome, &quot;+bro+&quot;, to our humble &quot;+this.$etSystem+&quot; Guild Lodge!&quot;,9);
		pc(&quot;Receive our Boon and blessing...&quot;,9);
		pc(&quot;And do join us at our Ceremonial before you leave us!&quot;,9);
		pc(&quot; &quot;,9);
	} else {
		if (!this.$etBeenBellig)
			pc(&quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders welcomes you!&quot;, 5);
		if (!this.$etGendered)
			pc(&quot;Guilder, please hit F4 to impart your gender...&quot;, 9);
		if (this.$etRuns&lt;=4) {
			pc(&quot;Please check your F4 G.E.T. Interfaces often!&quot;,9);
			pc(&quot;Always check the F5-F5 Manifest on ending trading!&quot;,9);
			if (sta.isMainStation) {
				pc(&quot;Go to F4 Interface to register Name and Ship.&quot;,9);
				pc(&quot; &quot;);
			}
		}
	}
	// say welcome once only
	this.$etIsWelcomed = true;
}


// display ship&#39;s cargo and its purchase value
this._etPodsInHold = function(pods) {
	player.consoleMessage(&quot;In hold: &quot;+pods+&quot; pods ( &quot;+formatCredits(((this.$etBoughtPrice)/10),true,true)+&quot; )&quot;);
}


// planet name &amp; number by &#39;compare radius&#39; method
this._etGetPlanetName = function(plan) {
	var p=system.planets, name=&quot;&quot;,
	rad = plan.radius;
	if (rad!=null) {
		// run through planets in system...
		for (var i=0; i&lt;p.length; i++) {
			if (i&gt;0) {
				// if radii match, it&#39;s probably our planet
				if (rad===p[i].radius) name=p[i].name+&quot; &quot;+this.$etRoman[i+1];
			} else name=plan.name; // planet 0 is &#39;Prime&#39;
		}
	} else name = plan.name; // &#39;vanilla&#39; name
	return name;
}


this._etCommsTradeAdvisory = function() {
	// prices of system&#39;s key goods, plus quantity
	var ind = (system.economy&lt;4), s=system.stations,
	pm = player.commsMessage;
	pm(&quot;&quot;); // LF
	if (!ind) {
			for (var i=0; i&lt;s.length; i++) if (s[i].name!=&quot;Rock Hermit&quot;)
				pm(s[i].name + &quot;: Computers @ &quot; + this._etMarketPrice(s[i],&quot;computers&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;computers&quot;) + &quot;)&quot;,10);
		} else {
			for (var i=0; i&lt;s.length; i++) if (s[i].name!=&quot;Rock Hermit&quot;)
				pm(s[i].name + &quot;: Furs @ &quot; + this._etMarketPrice(s[i],&quot;furs&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;furs&quot;) + &quot;)&quot;,10);
		}
}


// number of days since first run
this._etGetDays = function() {
	var dys=0.0; 
	this.$etDaysStart=2084004.0;
	// output Lave days since induction
	this.$etDays = clock.days; // now
	dys=this.$etDays-this.$etDaysStart;
	dys=dys.toFixed(0);
	return dys;
}


// number of years since first run 
this._etGetYears = function() {
	var yrs=0.0;
	// compute Lave years since induction
	yrs=this._etGetDays();
	yrs=yrs/this.$etLaveYear;
	yrs=yrs.toFixed(3);
	return yrs;
}


// monthly bonus - grade- and credits-dependant 
this._etGetMBonus = function() {
	var bon = 0.0;
	var dys = this._etGetDays();
	// grade-dependant monthly bonus
	if ( (dys &gt; 0) &amp;&amp; ((dys % 30)==0) ) {
		var grd = this._etGetGrade();
		bon = (grd/22) * player.credits;
	}
	return bon;
}



// create G.E.T. Gift to Guild on the F4 Interfaces screen
this._etPrepGift = function(station) {
	station.setInterface(&quot;etGift&quot;,{
	title: &quot;G.E.T. Gift your Station Profit to the Guild&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Make a voluntary gift of your station profit to the Guild, to speed advancement and seal bonds.&quot;,
	callback: this._etShowGift.bind(this)
	});	
}


// Present the option to Gift Station profit to the Guild
this._etShowGift = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	parameters.message = &quot;The &quot;+this.$etSystem+&quot; Guild offers you the opportunity and privilege of advancing in Grade more speedily by magnanimously gifting to the G.E.T. coffers your entire profits gained here in our system - in this case &quot;+formatCredits(this.$etTotProfit/10, true, true)+&quot;. \n\n &quot;;

	parameters.message += this.$etBro+&quot; and friend, you will honour and distinguish both the Guild and yourself by rendering this further contribution to G.E.T. beneficence and hegemony... You will be assured of special welcome and expeditious service in every Guild House throughout the Eight Charts. Of this your Gift, Grand Master ExoloÃ¶n will learn.&quot;;
	
	parameters.choicesKey = &quot;etGiftChoices&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		var pc = player.commsMessage;
		var pcm= player.consoleMessage;
		if (choice === &quot;1_YES&quot;)  {
			if (!this.$etGifted) {
				if (this.$etTotProfit&gt;0) this.$etGiftCount+=1;
				this.$etGift = this.$etTotProfit;
				this.$etGifts+=this.$etGift;
				// note previous grade here
				this.$etDonations+=this.$etGift;
				this.$etGifted = true;
				// grant 3-point ship enhancement
				this._etEnhanceShip(3);
				// deduct gift from player&#39;s credits
				// donation is decicredits, so convert
				player.credits -= this.$etGift/10; 
				if (this.$etGift&gt;0) {
					pc(this.$etBro+&quot;, we thank you profusely for your munificence!&quot;,9);
					pc(&quot;Your speedy advancement is secure!&quot;,9);
					pcm(this.$etBro+&quot;, we grant you a 3-point ship enhancement.&quot;,9);
				} else pc(&quot;Blessings, &quot;+this.$etBro,9);
			} else pc(&quot;Please give to G.E.T. at your next port of call!&quot;,9);
			// update Manifest
			this._etShowStatus();
		}
	}
}


	
// create G.E.T. Best Trade Resetter on the F4 Interfaces screen
this._etPrepResetter = function(station) {
	station.setInterface(&quot;etResetter&quot;,{
	title: &quot;G.E.T. Best Trade Resetter&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Reset your Best Trade to the profit gained in this system.&quot;,
	callback: this._etShowResetter.bind(this)
	});	
}


// Present the option to reset Best Trade to the profit made here
this._etShowResetter = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	parameters.message = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders offers you the opportunity to reset your Best Trade, as displayed on your ship&#39;s Manifest screen, to the profit you have just gained here in our system - in this case &quot;+formatCredits(this.$etTotProfit/10, true, true)+&quot;. \n\n &quot;;

	parameters.message += &quot;In fact you would honour us by doing so...&quot;;
	
	parameters.choicesKey = &quot;etResetMaxTradeChoices&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  {
			this.$etMaxTrade=this.$etTotProfit;
			this.$etMaxTSystem=this.$etSystem;		
			this.$etMaxTGoods=this.$etCommodities;		
			// the ship we maxed it in
			var p=player.ship;
			this.$etMaxTShip = p.shipClassName;
			this.$etMaxTShipName = p.shipUniqueName;
			this.$etMaxTShipTC = p.cargoSpaceCapacity;
			player.commsMessage(&quot;Maximum Trade reset. Please check the Manifest.&quot;);
			// update Manifest
			this._etShowStatus();
		}
	}
}


// create G.E.T. Master Advisory on the F4 Interfaces screen
this._etPrepAdvisory = function(station) {
	station.setInterface(&quot;etAdvisory&quot;,{
	title: &quot;G.E.T. Master Advisory&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Salutation and advice from the Master of the &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;,
	callback: this._etShowAdvisory.bind(this)
	});	
}


// Salutation and advice from the station Guild Master
this._etShowAdvisory = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	var grade = this._etGetGrade(), title=this.$etGETTitle[grade], lim=this.$etGETTitle.length;
	var grovel =&quot;&quot;, pregrovel=&quot;&quot;;
	var greet = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders bids their &quot;+this.$etBro+&quot; &quot;+player.name+&quot; a hearty welcome to their Guild Home and trusts &quot;;
	if ((grade&gt;=5) &amp;&amp; (grade&lt;11)) { greet = title + &quot;, you honour our Guild Home by your visit! If only we had been better prepared for your arrival... &quot; + this.$etSystem + &quot; G.E.T. nevertheless hopes &quot;;
	grovel = &quot;Anything you might need, Master, they are here to serve you.&quot;; }
	if ((grade&gt;10)) { greet = title + &quot;! your worshipful presence humbles our poor and wretched Guild Home, yet your visit ennobles us! If only we had been informed that your Honour would be arriving... &quot; + this.$etSystem + &quot; G.E.T. nevertheless prays &quot;;
	grovel = &quot;Anything, anything you require, Exalted One, they are here to serve, as are we all.&quot;; }
	
	parameters.message = greet + &quot; this sojourn among us will be advantageous... Trade well! May the GETTING exceed the Taking! \n\n&quot;;
	
	// G.E.T. contact (Assessor)
	parameters.message += &quot;Master &quot; + this.$etContact + &quot; is your Assessor and contact for your stopover. &quot;+grovel+&quot; \n\n&quot;;
	
	// Planets with stations
	var plan = &quot;&quot;, p=system.planets, sta=&quot;&quot;, s=system.stations;
	var i = 0; // count the planets
	if ((p.length&gt;1) &amp;&amp; (this.$etNoob==&quot;no&quot;)) { 
		for (i=0; i&lt;p.length; i++) {
			if (i&gt;0) plan += p[i].name+&quot; &quot;+this.$etRoman[i+1]+&quot;  &quot;;
			else plan += p[i].name+&quot;  &quot;;
		}
		// don&#39;t say planets if too many stations (makes space!)
		if (i&lt;4)
			parameters.message += &quot;Our planets with stations are: &quot;+plan+&quot;\n\n&quot;; 
	
		/*for (i=0; i&lt;s.length; i++) if (s[i].name!=&quot;Rock Hermit&quot;) sta += s[i].name + &quot;  &quot;;
		parameters.message += &quot;Our stations are: &quot;+sta+&quot;\n\n&quot;;*/ 
	
		// prices of system&#39;s prime commodities, plus quantity
		var ind = (system.economy&lt;4);
		if (ind) {
			for (i=0; i&lt;s.length; i++) { 
				if (s[i].name!=&quot;Rock Hermit&quot;) { 
					parameters.message += &quot;Computers at our &quot;+ s[i].name + &quot; cost &quot; + this._etMarketPrice(s[i],&quot;computers&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;computers&quot;) + &quot;) \n&quot;;
					parameters.message += &quot;Luxuries at our &quot;+ s[i].name + &quot; cost &quot; + this._etMarketPrice(s[i],&quot;luxuries&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;luxuries&quot;) + &quot;) \n\n&quot;;
				}
			}
		} else {
			for (i=0; i&lt;s.length; i++) { 
				if (s[i].name!=&quot;Rock Hermit&quot;) {
					parameters.message += &quot;Furs at our &quot;+ s[i].name + &quot; cost &quot; + this._etMarketPrice(s[i],&quot;furs&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;furs&quot;) + &quot;) \n&quot;;
					parameters.message += &quot;Liquors at our &quot;+ s[i].name + &quot; cost &quot; + this._etMarketPrice(s[i],&quot;liquor_wines&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;liquor_wines&quot;) + &quot;) \n\n&quot;;
				}
			}
		}
		parameters.message += &quot;\n&quot;;
	}
	
	if (grade&lt;6)  parameters.message += &quot;To business, &quot;+this.$etBro+&quot;... &quot;; else
	if (grade&lt;11) parameters.message += &quot;To business, then, Friend and &quot;+this.$etBro+&quot;... &quot;; else
	if (grade&lt;lim) parameters.message += &quot;To business, then, o Perfected &quot;+this.$etBro+&quot; and - dare we hope? - Friend... &quot;;
	
	if (this.$etNoob==&quot;yes&quot;) {
		var p = player.ship;
		var sname = p.shipUniqueName; 
		var sclass = p.shipClassName;

		parameters.message += &quot;You may note with irony that G.E.T. cares little whether Galcop deems your goods illegal... We have small truck with that legislative body. With us, your record is always clean, and all trades legitimate in our eyes.  \n\n&quot;

		parameters.message += &quot;Words of advice are never amiss, you&#39;ll agree? &quot;;
		
		parameters.message += &quot;One abiding Rule governs our Order: Trade well, refrain from combat, aid your Brothers. Above all, do not kill. &quot;;
	
		parameters.message += &quot;Remember it - advance in Grade and wealth. Ignore it, and risk our silence. Then only Penance will bring you back. \n\n&quot;;
		
		if (this.$etStrict) var strctMsg = &quot;Above Grade 1, &quot;; else strctMsg=&quot;&quot;;
		parameters.message += &quot;Your craft has a &#39;weapons offline&#39; switch: &quot;+strctMsg+&quot;use it after witch and watch threats fly by with J-drive engaged. G.E.T. provides priority docking to all Brothers; in the shipyard, our Master mechs and techs are unrivalled. Your &quot;+sclass+&quot; will flourish! &quot;;
	} 
	else if (!this.$etMarketObserver) 
		parameters.message += &quot;As it forever has been, the Market Observer and Market Inquirer of Fra Spara are almost de rigueur. Do not exit a space-dock without these! Seek a Torus to Sun Drive and our Advanced Space Compass once you have your Large Cargo Bay and Goods Containers, obtaining which is now your prime concern. \n \n&quot;;

	parameters.choicesKey = &quot;etAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;) { 
			// we only need to read the noob text once!
			this.$etNoob = &quot;no&quot;;
			player.commsMessage(&quot;Luck in the Markets!&quot;);
		}
	}
}


// create G.E.T. Sales Advisory on the F4 Interfaces screen
this._etPrepSales = function(station) {
	station.setInterface(&quot;etSales&quot;,{
	title: &quot;G.E.T. Guild Lodge Sales Advisory&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Salutation and sales advice from the &quot;+this.$etSystem+&quot; Lodge Master&quot;,
	callback: this._etShowSales.bind(this)
	});	
}


// Sales advice from the Guild Lodge Master
this._etShowSales = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild Lodge&quot;;
	
	parameters.message = this.$etBro + &quot; &quot;+player.name+&quot;, we are honoured and delighted to welcome you to our humble Guild Lodge. As I&#39;m sure time presses on you, here without further ado are our system sell-prices for the most popular traded goods... \n\n&quot;;
	
	var plan = &quot;&quot;, p=system.planets, sta=&quot;&quot;, s=system.stations;
		// prices of system&#39;s prime commodities, plus quantity
		var ind = (system.economy&lt;4);
		if (ind) {
			for (var i=0; i&lt;s.length; i++) { 
				if (s[i].name!=&quot;Rock Hermit&quot;) { 
					parameters.message += &quot;Furs at our &quot;+ s[i].name + &quot; sell at &quot; + this._etMarketPrice(s[i],&quot;furs&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;furs&quot;) + &quot;) \n&quot;;
					parameters.message += &quot;Liquors at our &quot;+ s[i].name + &quot; sell at &quot; + this._etMarketPrice(s[i],&quot;liquor_wines&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;liquor_wines&quot;) + &quot;) \n\n&quot;;
				}
			}
		} else {
			for (var i=0; i&lt;s.length; i++) { 
				if (s[i].name!=&quot;Rock Hermit&quot;) {
					parameters.message += &quot;Computers at our &quot;+ s[i].name + &quot; sell at &quot; + this._etMarketPrice(s[i],&quot;computers&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;computers&quot;) + &quot;) \n&quot;;
					parameters.message += &quot;Luxuries at our &quot;+ s[i].name + &quot; sell at &quot; + this._etMarketPrice(s[i],&quot;luxuries&quot;) + &quot; (&quot; + this._etMarketQuantity(s[i],&quot;luxuries&quot;) + &quot;) \n\n&quot;;
				}
			}
		}
		parameters.message += &quot;\n&quot;;
	
	var grade=this._etGetGrade();
	if (grade&lt;6)  parameters.message += &quot;To business, &quot;+this.$etBro+&quot;... &quot;; else
	if (grade&lt;11) parameters.message += &quot;To business, then, Friend and &quot;+this.$etBro+&quot;... &quot;; else
	if (grade&lt;lim) parameters.message += &quot;To business, then, o Perfected &quot;+this.$etBro+&quot; and - dare we hope? - Friend... &quot;;
	

	parameters.choicesKey = &quot;etAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;Luck in the Markets!&quot;);
	}
}


// Vow of Good Brotherhood
this._etPrepVow = function(station) {
	station.setInterface(&quot;etVow&quot;,{
	title: &quot;G.E.T. Vow of Good Brotherhood&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Make a Vow of Good Brotherhood to the Master of the &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;,
	callback: this._etShowVow.bind(this)
	});	
}


// Present the option to make a Vow of Good Brotherhood
this._etShowVow = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	parameters.message = &quot;We observed with sadness your straying from the Path of Good Brotherhood. You have killed - not once, but multiple times. Yet we understand your urges and the weakness of the newly inducted. For this reason, the &quot;+this.$etSystem+&quot; Guild of Elite Traders offers you the opportunity to mend errant ways... \n\n &quot;;
	
	parameters.message += &quot;The Masters of the Guild are prepared to reinstate you as a full &quot;+this.$etBro+&quot; and restore all privileges of the G.E.T., indeed to forget your infractions, provided you demonstrate self-discipline and, above all, mercy in your future conduct on the space-lanes.\n\n &quot;;
	
	parameters.message += &quot;Remember the Rule: Do not kill. It is our only Rule. We do not ask why you broke it, but do demand that you respect and live by it. \n\n &quot;;
	
	parameters.message += &quot;Commander &quot;+player.name+&quot;, are you prepared now to renew your Vow of Good Brotherhood with the Guild? \n\n &quot;;

	this.$etVowing = true;
	parameters.choicesKey = &quot;etVowChoices&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  {
			// reinstate Brother&#39;s privileges
			this.$etIsBellig = false;
			this.$etBeenBellig = false;
			this.$etKillCount = 0;
			this.$etVowCount ++;
			player.ship.bounty = 0;
			player.consoleMessage(&quot;Then all is forgiven and we welcome you back.&quot;,5);
		} else player.consoleMessage(&quot;Then our backs must remain turned. Fare well.&quot;,5);
	}
}


// G.E.T. ship condition and status report
this._etPrepShipStatus = function(station) {
	station.setInterface(&quot;etShipStatus&quot;,{
	title: &quot;G.E.T. Ship Status Report&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;The current state of your G.E.T. ship enhancements.&quot;,
	callback: this._etShowShipStatus.bind(this)
	});	
}


// Display status of G.E.T. ship enhancements
this._etShowShipStatus = function() {
	var p = player.ship;
	var sname = p.shipUniqueName; 
	var sclass = p.shipClassName;
	
	if ((sname!=null) &amp;&amp; (sname!=&quot;&quot;)) sname = &quot; &#39;&quot;+sname+&quot;&#39; &quot;;
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; G.E.T. Shipyard&quot;;
	
	parameters.message = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders bids you welcome to our shipyard and hopes that our services to your fine &quot;+sclass+sname+&quot; meet with approval. Since your induction, technical enhancements to her systems have included: \n\n&quot;;

	parameters.message += &quot;Nominal speed: &quot;+this.$etInitialSpeed+&quot;  --&gt;&gt;  Current speed: &quot;+p.maxSpeed+&quot; \n\n&quot;;
	
	parameters.message += &quot;Nominal thrust: &quot;+this.$etInitialThrust+&quot;  --&gt;&gt;  Current thrust: &quot;+p.maxThrust+&quot; \n\n&quot;;
	
	parameters.message += &quot;Nominal shields: &quot;+this.$etInitialShields+&quot;  --&gt;&gt;  Current shields: &quot;+p.maxForwardShield+&quot; \n\n&quot;;
	
	parameters.message += &quot;Nominal energy: &quot;+this.$etInitialEnergy+&quot;  --&gt;&gt;  Current energy: &quot;+p.maxEnergy+&quot; \n\n&quot;;
		
	parameters.message += &quot;Nominal recharge: &quot;+this.$etInitialERecharge.toFixed(2)+&quot;  --&gt;&gt;  Current recharge: &quot;+p.energyRechargeRate.toFixed(2)+&quot; \n\n&quot;;

	parameters.choicesKey = &quot;etAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;Be safe in the Lane!&quot;);
	}
}


// price of a good at a given station, in cr
this._etMarketPrice = function(sta, good) {
	var price=0.0, mar=sta.market;
	price = mar[good].price/10;
	return price.toFixed(1);
}


// quantity of a good at a given station
this._etMarketQuantity = function(sta, good) {
	var quant=0, mar=sta.market;
	quant = mar[good].quantity;
	return quant;
}


/* Note: this helper function is from phkb&#39;s Equipment Storage OXP */
// returns the player&#39;s target system (1.80) or the next jump to their target system (1.82+)
this._TargetSystem = function _TargetSystem() {
	if (player.ship.hasOwnProperty(&quot;nextSystem&quot;)) return player.ship.nextSystem;

	var target = player.ship.targetSystem;

	if (oolite.compareVersion(&quot;1.81&quot;) &lt; 0 &amp;&amp; player.ship.hasEquipmentProviding(&quot;EQ_ADVANCED_NAVIGATIONAL_ARRAY&quot;) === true) {
		// in 1.81 or greater, the target system could be more than 7 ly away. It becomes, essentially, the final destination.
		// there could be multiple interim stop points between the current system and the target system.
		// the only way to get this info is to recreate a route using the same logic as entered on the ANA, and pick item 1
		// from the list. That should be the next destination in the list.
		if (system.ID === -1) {
			var myRoute = System.infoForSystem(galaxyNumber, this._lastSource).routeToSystem(System.infoForSystem(galaxyNumber, target), player.ship.routeMode);
		} else {
			var myRoute = System.infoForSystem(galaxyNumber, global.system.ID).routeToSystem(System.infoForSystem(galaxyNumber, target), player.ship.routeMode);
		}
		if (myRoute &amp;&amp; myRoute.route.length &gt;= 1) {
			target = myRoute.route[1];
		}
	}

	return target;
}



// create G.E.T. &#39;Buber&#39;s Beats&#39; page 
this._etPrepBeats = function(station) {
	station.setInterface(&quot;etBeats&quot;,{
	title: &quot;G.E.T. Milk or Cream? - Buber&#39;s Beats&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;Solid examples and advice from a favoured Brother with our exalted Grand Master&#39;s endorsement.&quot;,
	callback: this._etShowBeats.bind(this)
	});	
}


// Buber&#39;s Beats - walkthrough and advice
this._etShowBeats = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	parameters.message = &quot;Your Friend and Brother, Master Traveller Fens Buber, offers you these creamy beats with our exalted Grand Master&#39;s approval: \n\n&quot;;

	parameters.message += &quot;Spaceway L1/L2, Sector One, Galaxy One \n&quot;;
	parameters.message += &quot;----------------------------------------------------------- \n\n&quot;;

	parameters.message += &quot;0. (Lave--&gt;Zaonce--&gt;Isinor--&gt;) \n&quot;;
	parameters.message += &quot;1. Qutiri--&gt;Isinor--&gt;Ensoreus--&gt;Ararus \n&quot;;
	parameters.message += &quot;2. Zarece--&gt;Isence \n&quot;;
	parameters.message += &quot;3. Tiinlebi--&gt;Anlama--&gt;Begeabi \n&quot;;
	parameters.message += &quot;4. Xexedi--&gt;Laenin--&gt;Lerelace \n&quot;;
	parameters.message += &quot;5. Razaar--&gt;Zadies--&gt;Anarlaqu--&gt;Vetitice \n&quot;;
	parameters.message += &quot;6. Zasoceat--&gt;Riantiat--&gt;Teraed--&gt;Bivea--&gt;Enzaer \n&quot;;
	parameters.message += &quot;7. Tianve/Anle--&gt;Teanrebi \n&quot;;
	parameters.message += &quot;8. Malama--&gt;Qudira--&gt;Inines--&gt;Qudira--&gt;Esbiza \n\n&quot;;

	parameters.message += &quot;Repeat and vary at will, or do the grand tour of these 29 systems. Buy Computers (+luxuries) in Rich Industrials and Furs (+liquor-wines) in Poor Agriculturals. \n\n&quot;;

	parameters.choicesKey = &quot;etAcknowlege&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_YES&quot;)  player.commsMessage(&quot;Trade well and wisely, &quot;+this.$etBro+&quot;!&quot;);
	}
}



// Prepare Gender request
this._etPrepGender = function(station) {
	station.setInterface(&quot;etGender&quot;,{
	title: &quot;G.E.T. Your gender, gentle Guilder?&quot;,
	category: &quot;G.E.T.&quot;,
	summary: &quot;The Guild Master requests to know whether you are female, male, or bi-gendered.&quot;,
	callback: this._etShowGender.bind(this)
	});	
}


// Present the option to impart your gender
this._etShowGender = function() {
	
	var parameters = new Object();
	
	parameters.title = &quot;The &quot;+this.$etSystem+&quot; Guild of Elite Traders&quot;;
	
	parameters.message = &quot;Profuse and embarrassed apologies, but the Guild Master of &quot;+this.$etSystem+&quot; has been unable to determine your gender... Would you perhaps be willing to impart it to me, his assistant, so that no faux pas in future protocol will occur? \n\n &quot;;
	
	parameters.message += &quot;If female, we shall be pleased and honoured to call you &#39;Sister&#39;; if male - &#39;Brother&#39;; if bi-, tri-, or null-gendered - &#39;Sibling&#39;... or simply continue with &#39;Guilder&#39; if you prefer. \n &quot;;
	
	parameters.choicesKey = &quot;etGenderChoices&quot;;
	
	mission.runScreen(parameters, callback);	

	function callback(choice) {
		if (choice === &quot;1_FEMALE&quot;) this.$etBro=&quot;Sister&quot;; else
		if (choice === &quot;2_MALE&quot;) this.$etBro=&quot;Brother&quot;; else
		if ((choice === &quot;3_BOTH&quot;) || (choice== &quot;4_NULL&quot;)) this.$etBro=&quot;Sibling&quot;; else
			this.$etBro = &quot;Guilder&quot;;
		if (this.$etBro===&quot;Sibling&quot;) player.consoleMessage(&quot;Thank you. Then you shall be our &#39;Sibling&#39;.&quot;,7); else player.consoleMessage(&quot;Thank you &quot;+this.$etBro+&quot;. We will remember it.&quot;,7);
		this.$etGendered=true;
	}
}


</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/gl_market.js</td>
                    <td><pre>&quot;use strict&quot;;

this.name = &quot;gl-market&quot;;
this.author = &quot;Reval&quot;;

/* Thanks to Spara for producing this code! */
this.updateLocalCommodityDefinition = function(goodDefinition, station) {

	var distance = station.position.distanceTo(system.mainStation);
	
	//scale max price difference with distance
	//1000 km -&gt; 0.05, 5000 km -&gt; 0.15
	var maxPriceDiff = 0.000000025 * distance + 0.025;
	var priceDiff = Math.random() * maxPriceDiff;
	
	//cheaper or more expensive?
	var coinToss = Math.round(Math.random());
	if (coinToss === 0)  var priceMultiplier = 1 - priceDiff;
	else var priceMultiplier = 1 + priceDiff;
	
	goodDefinition.price *= priceMultiplier;
	
	//scale quantity with random +/- 100 % scale
	
	var quantityDiff = Math.random();
	var coinToss = Math.round(Math.random());
	if (coinToss === 0) var quantityMultiplier = 1 - quantityDiff;
	else var quantityMultiplier = 1 + quantityDiff;
	
	goodDefinition.quantity = Math.round(quantityMultiplier * goodDefinition.quantity);

	return goodDefinition;
};
</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
