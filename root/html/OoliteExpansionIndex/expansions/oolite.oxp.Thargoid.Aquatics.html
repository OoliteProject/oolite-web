<html>
    <head>
        <title>Expansion Aquatics</title>
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <table border="0" width="100%">
            <tr>
                <td>Back to <a href='../index.html'>Index</a></td>
                <td align="right"><small>Page generated: Oct 11, 2023, 3:16:49 PM</small></td>
            </tr>
        </table>

        <h1>Expansion Aquatics</h1>

        <h2>Content</h2>
        <ul>
          <li><a href="#warnings">Warnings</a></li>
          <li><a href="#manifest">Manifest</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#equipment">7 Equipment</a></li>
          <li><a href="#ships">57 Ships</a></li>
          <li><a href="#models">0 Models</a></li>
          <li><a href="#scripts">24 Scripts</a></li>
        </ul>

          <a name="warnings">
            <h2>Warnings</h2>
            <ol>
                <li>Tags mismatch between OXP Manifest and Expansion Manager at character position 0002 (RIGHT SQUARE BRACKET vs LATIN SMALL LETTER S)(&#39;[]&#39; vs &#39;[station, equipment, ships, mission]&#39;)</li>
                <li>Unknown key &#39;requires_oxp&#39; at https://wiki.alioth.net/img_auth.php/f/f1/Aquatics_2.30.oxz!manifest.plist</li>
            </ol>
          </a>

        <a name="manifest">
        <h2>Manifest</h2>
            <table border="1">
                <tr>
                    <th></th>
                    <th>from Expansion Manager's OXP list</th>
                    <th>from Expansion Manifest</th>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Various new ships, plus a system station with a mission</td>
                    <td>Various new ships, plus a system station with a mission</td>
                </tr>
                <tr>
                    <td>Identifier</td>
                    <td>oolite.oxp.Thargoid.Aquatics</td>
                    <td>oolite.oxp.Thargoid.Aquatics</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>Aquatics</td>
                    <td>Aquatics</td>
                </tr>
                <tr>
                    <td>Category</td>
                    <td>Ships</td>
                    <td>Ships</td>
                </tr>
                <tr>
                    <td>Author</td>
                    <td>Thargoid</td>
                    <td>Thargoid</td>
                </tr>
                <tr>
                    <td>Version</td>
                    <td>2.32</td>
                    <td>2.32</td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td></td>
                    <td>station, equipment, ships, mission</td>
                </tr>
                <tr>
                    <td>Required Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Maximum Oolite Version</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Required Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Optional Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Conflict Expansions</td>
                    <td>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>Information URL</td>
                    <td><a target="_blank" href="http://wiki.alioth.net/index.php/Aquatics_OXP">http://wiki.alioth.net/index.php/Aquatics_OXP</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>Download URL</td>
                    <td><a target="_blank" href="https://wiki.alioth.net/img_auth.php/f/f1/Aquatics_2.30.oxz">https://wiki.alioth.net/img_auth.php/f/f1/Aquatics_2.30.oxz</a></td>
                    <td><a target="_blank" href="">n/a</a></td>
                </tr>
                <tr>
                    <td>License</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                    <td>Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme file</td>
                </tr>
                <tr>
                    <td>File Size</td>
                    <td>n/a</td>
                </tr>
                <tr>
                    <td>Upload date</td>
                    <td>1610873511</td>
                </tr>
            </table>
                </a>

        <a name="documentation">
        <h2>Documentation</h2>
        <p>Also read <a href='http://wiki.alioth.net/index.php/Aquatics'>http://wiki.alioth.net/index.php/Aquatics</a></p>
        <h3>Aquatics v2.32 Readme &amp; License.txt</h3>
        <pre>Aquatics OXP by Thargoid.

New ships from the Aquarian Shipbuilding Corporation of Aqualina in Galaxy 3. 

Ships:

Manta Ray - A fast interceptor fighter. Popular with the military and Galcop as well as privateer traders. A player version of the ship is also available, a good alternative to the Cobra Mk III.
Shark - An escort fighter, cheaper but less formidable than it&#39;s big sister the Manta Ray. Often seen in an escort role for larger ships. Also available for use by the player, if a good but cheaper ship is needed.
Box - A smaller light escort ship, usually seen in convoy with the Man O&#39; War, which serves as a support tender and mobile base.
Man O&#39; War - Originally a versatile exploration ship used by the Aqualinians for first contact with neighbouring races. Now often seen plying the space lanes, although too large to dock with standard Coriolis and Dodec space stations. Usually accompanied by Box escorts.
Conger - A general purpose cargo hauler. Owing to its being often targetted by the less savoury elements in the galaxy, usually escorted in convoy by Shark fighters.
Hawksbill - General purpose tanker, most often seen hauling witchspace fuel. Often escorted due to the high value that a full load commands on the open market.



Update - Version 2.00 brings several new ships, a mission plus an easter egg or two ;)

Police &amp; Military Manta Ray - These ships now sport some additional weaponry compared to their civilian counterparts. Not available on the open market.
Barracuda - Small sleek fighter craft. Designed for minimal visibility and high speed, they are favoured by bounty hunters, escort pilots and law enforcement departments. Unfortunately also popular on the black market with less savoury types.
HammerHead Haulers - Magnificent hauler craft, carrying several cargo sleds at a time. The backbone of the inter-system transport and logistics network arm of the Corporation.
Cargo sled - As carried by the HammerHead, these sleds function as simple shifters for mass cargo containers. Unarmed and quite large, only designed for short-range journeys between their carrier and the system station.
Leviathan platform - With the rise of the Thargoid threat, system and witchpoint defense entities to guard against alien and hostile marauders.
Orca class Destroyer - Massive military ships. Well-armed and deadly, if a little on the slow side. Designed for heavy combat and military war campaigns.
Headquarters - A status symbol of the Corporation, their orbital HQ around Aqualina is a massive station which also serves as the main station for the system. Mainly for administration and R&amp;D, it also houses the Corporation&#39;s security and financial logistic arms plus full ship repair facilities and retail opportunities.

Mission - 

New mission for v2.00, chase down and destroy the hijacked AHC Kraken IV before it can leave the system. The good will of the Corporation and all that may entail plus a sizable credit bonus await the successful commander. Only available to commanders of Dangerous rank or above. Go and visit the HQ station in Aqualina for more details.

A save-game is included for those who just want to see the new station. Commander Visitor is docked and ready for the last leg of his journey to the Aqualina system. He is an old friend of the corporation, having already helped them out with the Kraken IV in the past.

Requirements -

This OXP also requires BigShips.oxp, which is included in the package. This will need to be unzipped separately and added to the AddOns folder. It is a populator for large traders (such as the Man O&#39; War and the Hawksbill), to prevent them overloading the spacelanes and from launching from and docking with the main stations. See the readme file within the zip file for details.

It needs Oolite 1.77 to run, and will not work with 1.76.1 or any lower version. 

--------------------------------------------------------------
External controls

The appearance of the system platforms can now be suppressed by external OXPs to prevent problems with missions. To do this simply set

worldScripts[&quot;aquatics_populator&quot;].allowInterstellar = false;

or 

worldScripts[&quot;aquatics_populator&quot;].allowPlatforms = false;

These will suppress the platforms appearance at either the next entry into interstellar space or into the next system respectively. Note that upon arrival the variables will self-reset.
--------------------------------------------------------------
License:

This OXP is released under the Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with the following clauses:

* Whilst you are free (and encouraged) to re-use any of the scripting, models or texturing in this OXP, the usage must be distinct from that within this OXP. Unique identifiers such as (but not limited to) unique shipdata.plist entity keys, mission variables, script names (this.name), equipment identity strings (EQ_), description list arrays and entity roles must not be re-used without prior agreement.
* rebundling of this OXP within another distribution is permitted as long as it is unchanged. The following derivates however are permitted and except from the above:
	* the conversion of files between XML and openStep.
	* the merging of files with other files of the same type from other OXPs.
* Even though it is not compulsory, if you are re-using any sizable or recognisable piece of this OXP, please let me know :)

--------------------------------------------------------------
Instructions:

Unzip the file, and then move the folder &quot;Aquatics 2.31.oxp&quot; to the AddOns directory of your Oolite installation, and also the enclosed zip file of bigShips oxp on which this OXP relies. Then start the game up and the ships should be added. 

--------------------------------------------------------------


Version history:

16/08/2008 - First release, version 1.00
18/08/2008 - Version 1.01, big-ships AI improvements suggested by Eric Walsh
31/08/2008 - Version 1.02, shipdata.plist refinement from Commander McLane&#39;s running of verify-OXP on it.
04/11/2008 - Version 1.03, update of scripting for v1.72 compatability.
24/01/2009 - Version 1.04, bugfix update to shipdata.plist and scripts.
18/05/2009 - Version 2.00, major OXP update.
19/05/2009 - Version 2.01, minor bugfix for Guardian system, plus change role of destroyer from police to hunter.
28/05/2009 - Version 2.02, a couple of minor bugfixes, plus some code tidying.
28/08/2009 - Version 2.10, update for Oolite 1.73 compatibility.
05/09/2009 - Version 2.11, tweak to adjust position of lasers on player ships.
18/03/2010 - Version 2.20, update for Oolite 1.74 (not compatible with earlier versions)
13/02/2011 - Version 2.21, removal of upper limit, to allow running with 1.75
24/02/2011 - Version 2.22, minor script adjustment for the hammerhead due to the removal of the -w orientation bug in 1.75
23/03/2011 - Version 2.23, script modification to remove problem with scripted commsMessages. Also increased range of platform turrets to 20km.
27/06/2011 - Version 2.24, script modification to allow external suppression of system platforms (for mission compatibility).
17/12/2011 - Version 2.25, shader update for Hammerhead to be compatible with newer ATI/AMD drivers.
08/01/2012 - Version 2.26, minor correction on turret ranges in shipdata.plist
29/01/2012 - Version 2.27, script change to remove score cheat, plus shipdata update of sub-ents.
31/03/2012 - Version 2.28, minor script adjustment for a missing variable set to properly allow system platforms.
08/01/2013 - Version 2.30, major update for Oolite 1.77 (not compatible with earlier versions).
10/10/2014 - Version 2.31, changes to the Aqualina system - separate HQ station and planetary ring station.

--------------------------------------------------------------

Acknowledgements:

V1.00 - With thanks to Ahruman, LittleBear and Eric Walsh for their assistance via the Oolite Bulletin forum when I got stuck, and to Lestradae for ship pricing advice and test-piloting.

V2.00 - Some texturing by PAGroove, and shaders by Griff. Company logo design by Deepspace. Everything else herein is my fault :)

V2.22 - A nod to Eric Walch for reminding me about the removal of the orientation -w bug in Oolite 1.75.

V2.24 - By request of Svengali.

V2.28 - With thanks to Cim.

V2.30 - More thanks to both Cim and Svengali for visual effect and break patterns in the HQ.</pre>
        </a>

        <a name="equipment">          
        <h2>Equipment</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Visible</th>
                    <th>Cost [deci-credits]</th>
                    <th>Tech-Level</th>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_AQUATICS_1_GUARDIAN.html">Guardian Defense System</a></td>
                    <td>yes</td>
                    <td align="right">50000</td>
                    <td align="center">13+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_AQUATICS_1_JAMMER_MINE.html">Thargon Jammer Mine</a></td>
                    <td>yes</td>
                    <td align="right">10000</td>
                    <td align="center">13+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_AQUATICS_1_TRIDENT_MISSILE.html">Trident Missile</a></td>
                    <td>yes</td>
                    <td align="right">5000</td>
                    <td align="center">13+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_AQUATICS_CLOAK.html">Cloaking Device</a></td>
                    <td>yes</td>
                    <td align="right">500000</td>
                    <td align="center">15+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_AQUATICS_GUARDIAN.html">Guardian Defense System</a></td>
                    <td>yes</td>
                    <td align="right">50000</td>
                    <td align="center">15+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_AQUATICS_JAMMER_MINE.html">Thargon Jammer Mine</a></td>
                    <td>yes</td>
                    <td align="right">10000</td>
                    <td align="center">15+</td>
                </tr>
                <tr>
                    <td><a href="../equipment/EQ_AQUATICS_TRIDENT_MISSILE.html">Trident Missile</a></td>
                    <td>yes</td>
                    <td align="right">5000</td>
                    <td align="center">15+</td>
                </tr>
            </table>
        </a>

        <a name="ships">    
        <h2>Ships</h2>
            <table>
                <tr>
                    <th>Name</th>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_ASCYards.html">Aquarian Shipbuilding Corp. Shipyards</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_HQ.html">Aquarian Shipbuilding Corp. HQ</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_HQDock.html">HQ Dock</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_barracuda.html">Barracuda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_barracuda-player.html">Barracuda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_barracuda-police.html">Police Barracuda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_barracuda-renegade.html">Renegade Barracuda</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_box-escort.html">Box Escort</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_boxRing.html">Box Escort Ring</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_burningFuel.html">Burning witchspace fuel</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_cargoSled.html">Cargo Sled</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_conger.html">Conger Cargo Hauler</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_congerPod1.html">Conger Pod 1</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_congerPod2.html">Conger Pod 2</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_congerPod3.html">Conger Pod 3</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_congerPod4.html">Conger Pod 4</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_destroyer.html">Orca Class Destroyer</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_fugu.html">Fugu Tanker</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_fuguTank.html">Fugu Tank</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_guardian.html">Guardian Drone</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_guardianPlayer.html">aquatics_guardianPlayer</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_hammerHead.html">HammerHead Hauler Carrier</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_hawksbill.html">Hawksbill Fuel Tanker</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_jammer.html">Thargon Jamming Mine</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_kraken.html">AHC Kraken IV (Hijacked)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_krakenBarracuda.html">Security Patrol</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_krakenGCManta.html">Security Patrol</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_krakenLeftLaser.html">aquatics_krakenLeftLaser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_krakenLeftTurret.html">aquatics_krakenLeftTurret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_krakenMilManta.html">Security Patrol</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_krakenRightLaser.html">aquatics_krakenRightLaser</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_krakenRightTurret.html">aquatics_krakenRightTurret</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_largeWreckage.html">Wreckage</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_manOWar.html">Man O&#39; War</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_manOWarInner.html">ManoWar Inner</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_manOWarOuter.html">ManoWar Outer</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_mantaRay.html">Manta Ray</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_mantaRay-military.html">Military Manta Ray</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_mantaRay-player.html">Manta Ray</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_mantaRay-police.html">GalCop Manta Ray</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_milMantaRay-player.html">Military Manta Ray</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_pirateDestroyer.html">Orca Class Destroyer (Hijacked)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_piratePlatform.html">Leviathan System Platform (Hijacked)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_platform.html">Leviathan System Platform</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_ringDock.html">Aquatics Ring Dock (Hidden)</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_ringGateway.html">Gateway Station</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_ringSegment.html">Ring Segment</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_shark.html">Shark</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_shark-escort.html">Shark Escort</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_shark-player.html">Shark</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_smallWreckage.html">Wreckage</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_subEntLaser.html">Weapons Platform Laser Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_subEntShipTurret.html">Ship Turret Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_subEntTurret.html">Weapons Platform Turret Mount</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_survivingWreckage.html">Wreckage</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_trident.html">Trident Missile</a></td>
                </tr>
                <tr>
                    <td><a href="../ships/aquatics_tridentTine.html">Trident Tine</a></td>
                </tr>
            </table>
        </a>

        <a name="models">    
        <h2>Models</h2>
            This expansion declares no models. This may be related to warnings.
        </a>

        <a name="scripts">    
        <h2>Scripts</h2>
            <table>
                <tr>
                    <th>Path</th>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_FX.js</td>
                    <td><pre>this.name			= &quot;aquatics_FX.js&quot;;
this.author			= &quot;Thargoid&quot;;
this.copyright		= &quot;Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme.txt.&quot;;
this.description	= &quot;Effect control script&quot;;
this.version		= &quot;2.31&quot;;

this.shipWillDockWithStation = function(station)
	{
	if(station.hasRole(&quot;aquatics_HQ&quot;))
		{		
		this.fx = system.addVisualEffect(&quot;aquatics_dockingFX&quot;,player.ship.position.add(player.ship.vectorForward.multiply(500)));
		this.lDoor = system.addVisualEffect(&quot;aquatics_lDoor&quot;,player.ship.position.add(player.ship.vectorForward.multiply(500)));
		this.rDoor = system.addVisualEffect(&quot;aquatics_rDoor&quot;,player.ship.position.add(player.ship.vectorForward.multiply(500)));
		} 
	}	
	
this.shipWillLaunchFromStation = function(station)
	{
	if(station.hasRole(&quot;aquatics_HQ&quot;))
		{ this.fx = system.addVisualEffect(&quot;aquatics_launchFX&quot;,player.ship.position.add(player.ship.vectorForward.multiply(250))); } 
	}	
	
this.shipLaunchedFromStation = function(station)
	{
	if(station.hasRole(&quot;aquatics_HQ&quot;))
		{
		this.lDoor = system.addVisualEffect(&quot;aquatics_lDoor&quot;,player.ship.position.add(player.ship.vectorForward.multiply(500)));
		this.rDoor = system.addVisualEffect(&quot;aquatics_rDoor&quot;,player.ship.position.add(player.ship.vectorForward.multiply(500)));
		this.lDoor.orientation = player.ship.orientation;
		this.rDoor.orientation = player.ship.orientation;
		}
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_HQ.js</td>
                    <td><pre>this.name			= &quot;aquatics_HQ.js&quot;;
this.author			= &quot;Thargoid&quot;;
this.copyright		= &quot;Creative Commons Attribution - Non-Commercial - Share Alike 3.0 license with clauses - see readme.txt.&quot;;
this.description	= &quot;Ship script for HQ station&quot;;
this.version		= &quot;2.31&quot;;

this.shipSpawned = function()
	{ this.ship.breakPattern = false; }	
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_congerPods.js</td>
                    <td><pre>this.name				= &quot;conger_script&quot;;
this.author				= &quot;Original script by Kaks (Kestrel&amp;Falcon OXP), mangled here by Thargoid with invaluable advice from Eric Walsh&quot;;
this.copyright			= &quot;Creative Commons: attribution, non-commercial, sharealike.&quot;;
this.description		= &quot;Conger ship cargo pod actions and reactions&quot;;
this.version			= &quot;2.31&quot;;
&quot;use strict&quot;;

this.subpleas={
	&#39;aquatics_congerPod1&#39;:&#39;[aquatics_pod-1-destroyed]&#39;,&#39;aquatics_congerPod2&#39;:&#39;[aquatics_pod-2-destroyed]&#39;,
	&#39;aquatics_congerPod3&#39;:&#39;[aquatics_pod-3-destroyed]&#39;,&#39;aquatics_congerPod4&#39;:&#39;[aquatics_pod-4-destroyed]&#39;};

	
this.shipSpawned = function()
	{
	let e = this.ship.subEntities;
	if(!e) { return; }
	e.items = function(){for (let i = 0; i &lt; this.length; i++) yield this[i];}
	for (let i in e.items()) {
		i.script.plea = this.subpleas[i.primaryRole];
		i.script.owner = this.ship;
		i.script.shipDied = function(whom)
			{
			this.owner.spawn(&#39;cargopod&#39;, Math.ceil(Math.random()*10));
			if(whom.isPlayer)
				{ this.owner.commsMessage(expandDescription(this.plea)); }
			};
	}
}

this.shipDied = function()
	{ this.ship.spawn(&#39;alloy&#39;, Math.ceil(Math.random()*6)); }


</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_destroyer.js</td>
                    <td><pre>this.name					= &quot;aquatics_destroyer&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Ship script for Orca Destroyer&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

this.findTarget = function()
	{
	function isBadGuy(entity) 
		{ 
		return (entity &amp;&amp; entity.isValid &amp;&amp; entity.isShip &amp;&amp; (entity.isThargoid || entity.isPirate));
		}

	var targets = system.filteredEntities(this, isBadGuy, this.ship, this.ship.scannerRange);
	if(targets.length &gt; 0)
		{
		this.ship.target = targets[0];
		this.ship.reactToAIMessage(&quot;HOSTILE_FOUND&quot;);
		}
	}

this.collided = function()
	{
	if(this.ship.energy &lt; this.ship.maxEnergy * 0.95)
		{
		this.ship.energy = this.ship.maxEnergy * 0.95;
		}
	}

this.collisionOn = function()
	{
	delete this.collided;
	}

this.switchAI = function()
	{
	this.ship.switchAI(&quot;aquatics_destroyerAI.plist&quot;);
	}

this.shipDied = function(who,why)
	{
	this.largeCount = (Math.ceil(Math.random() * 4) - 1); // between 0-3 large pieces of wreckage
	this.smallCount = (Math.ceil(Math.random() * 9) - 1); // between 0-8 small pieces of wreckage
	this.fuelCount = (Math.ceil(Math.random() * 30) + 30); // between 31-40 burning fuel entities

	this.ship.spawn(&quot;aquatics_burningFuel&quot;, this.fuelCount); // spawn the burning fuel

	if(Math.random() &gt; 0.33) //  2 in 3 chance of a piece of non-exploding wreckage
		{
		this.ship.spawn(&quot;aquatics_survivingWreckage&quot;, 1); // spawn the surviving piece of wreckage
		}

	if(this.largeCount &gt; 0) // if there is large wreckage
		{
		this.ship.spawn(&quot;aquatics_largeWreckage&quot;, this.largeCount); // spawn the large pieces of exploding wreckage
		}

	if(this.smallCount &gt; 0) // if there is small wreckage
		{
		this.ship.spawn(&quot;aquatics_smallWreckage&quot;, this.smallCount); // spawn the small pieces of exploding wreckage
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_dockingFX.js</td>
                    <td><pre>this.name = &quot;planetFall_dockingFX&quot;;
this.author = &quot;Thargoid&quot;;
this.copyright = &quot;CC-by&quot;;
this.description = &quot;FX script&quot;;
this.version = &quot;2.31&quot;;
&quot;use strict&quot;;

this.effectSpawned = function()
	{
	this.distance = 750;
	this.visualEffect.position = player.ship.position.add(player.ship.vectorForward.multiply(this.distance));
	this.visualEffect.orientation = player.ship.orientation;
	this.lifetime = 0;
	this.firstFrame = true;
	if(this.visualEffect.subEntities &amp;&amp; this.visualEffect.subEntities.length &gt; 0)
		{ // randomise the docked ships
		var listCounter = this.visualEffect.subEntities.length ; // reset the counter
		for(listCounter = this.visualEffect.subEntities.length - 1;listCounter&gt;=0;listCounter--)
			{ if(Math.random() &lt; 0.3) { this.visualEffect.subEntities[listCounter].remove(); } }
		}	
	this.callback = addFrameCallback(this.doorPosition.bind(this));
	}

this.effectRemoved = function()
	{ removeFrameCallback(this.callback); }
	
this.doorPosition = function(delta)
	{
	if(this.firstFrame)
		{
		this.firstFrame = false;
		return;
		}
	
	if(!player.ship.isValid || this.lifetime &gt; 2.5) 
		{ 
		this.visualEffect.remove();
		return;
		}
	if(!delta) { return; }
	if(this.lifetime &lt; 1)
		{ this.visualEffect.position = player.ship.position.add(player.ship.vectorForward.multiply(this.distance));}
	else
		{ this.visualEffect.position = player.ship.position.add(player.ship.vectorForward.multiply(this.distance - (((this.lifetime - 1) / 1.5) * 750))); }
	this.visualEffect.orientation = player.ship.orientation;
	this.lifetime += delta;
	return;
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_equipment.js</td>
                    <td><pre>this.name					= &quot;aquatics_equipment&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Controls equipment availablity in Aquatics.&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

this.startUp = function()
	{
	if(!missionVariables.aquatics_timer &amp;&amp; missionVariables.aquatics_reputation &amp;&amp; missionVariables.aquatics_reputation &gt; 0)
		{
		missionVariables.aquatics_timer = clock.days;
		}
	}

this.shipExitedWitchspace = function()
	{
	if(!missionVariables.aquatics_timer)
		{
		return;
		}

	if((clock.days - missionVariables.aquatics_timer &gt; 50) &amp;&amp; (missionVariables.aquatics_reputation == 1) )
		{
		missionVariables.aquatics_reputation = 2;
		}

	if((clock.days - missionVariables.aquatics_timer &gt; 150) &amp;&amp; (missionVariables.aquatics_reputation == 0) )
		{
		missionVariables.aquatics_reputation = 2;
		}

	if(missionVariables.aquatics_reputation == 2)
		{
		delete this.shipExitedWitchspace;
		}
	}

this.shipWillDockWithStation = this.shipWillEnterWitchspace = function()
	{
	missionVariables.aquatics_guardianActive = null;
	var guardian = system.shipsWithRole(&quot;aquatics_guardianPlayer&quot;) 
	for (var i = 0; i &lt; guardian.length; i++) 
		{ 
		guardian[i].remove() 
		missionVariables.aquatics_guardianCount += 1; 
		}

	}

this.alertConditionChanged = function()
	{
	if(player.ship.equipmentStatus(&quot;EQ_AQUATICS_GUARDIAN&quot;) == &quot;EQUIPMENT_UNAVAILABLE&quot; &amp;&amp; player.ship.equipmentStatus(&quot;EQ_AQUATICS_1_GUARDIAN&quot;) == &quot;EQUIPMENT_UNAVAILABLE&quot;) // if system is not installed
		{
		return;
		}

	if(missionVariables.aquatics_guardianActive &amp;&amp; player.alertCondition &lt; 3) // if alert = yellow/green and Guardians are deployed
		{
		player.consoleMessage(&quot;Guardian System Deactivated&quot;, 2);
		this.shipWillDockWithStation(); // perform same code as when docking, to remove the guardians
		return;
		}

	if(player.alertCondition == 3 &amp;&amp; player.alertHostiles &amp;&amp; !missionVariables.aquatics_guardianActive) // if red alert by hostiles and the Guardians aren&#39;t deployed
		{
		if(missionVariables.aquatics_guardianCount &gt; 0)
			{
			for(var i=0; i &lt; missionVariables.aquatics_guardianCount; i++)
				{
				player.ship.ejectItem(&quot;aquatics_guardianPlayer&quot;);
				}
			player.consoleMessage(&quot;Guardian System Activated&quot;, 2);
			missionVariables.aquatics_guardianCount = 0;
			missionVariables.aquatics_guardianActive = true;
			return;
			}
		else
			{
			if(player.ship.equipmentStatus(&quot;EQ_AQUATICS_GUARDIAN&quot;) == &quot;EQUIPMENT_OK&quot;)
				{
				player.ship.setEquipmentStatus(&quot;EQ_AQUATICS_GUARDIAN&quot;, &quot;EQUIPMENT_DAMAGED&quot;);
				return;
				}
			else
				{
				player.ship.setEquipmentStatus(&quot;EQ_AQUATICS_1_GUARDIAN&quot;, &quot;EQUIPMENT_DAMAGED&quot;);
				return;
				}

			}
		}
	
	}

this.playerBoughtEquipment = function(equipment)
	{
	switch(equipment)
		{
		case &quot;EQ_AQUATICS_GUARDIAN&quot;:
		case &quot;EQ_AQUATICS_1_GUARDIAN&quot;:
			{
			missionVariables.aquatics_guardianCount = 2;
			missionVariables.aquatics_guardianActive = null;
			break;
			}

		case &quot;EQ_AQUATICS_CLOAK&quot;:
			{
			player.ship.removeEquipment(&quot;EQ_AQUATICS_CLOAK&quot;);
			player.ship.awardEquipment(&quot;EQ_CLOAKING_DEVICE&quot;);
			if(EquipmentInfo.infoForKey(&quot;EQ_CLOAKING_DEVICE&quot;).effectiveTechLevel === 99)
				{EquipmentInfo.infoForKey(&quot;EQ_CLOAKING_DEVICE&quot;).effectiveTechLevel = 14;} // make cloak repairable at tech 14 (in-game 15).
			break;
			}
		}
	}

this.equipmentDamaged = this.equipmentDestroyed = function(equipment)
	{
	if(equipment == &quot;EQ_AQUATICS_GUARDIAN&quot; || equipment == &quot;EQ_AQUATICS_1_GUARDIAN&quot;)
		{
		player.consoleMessage(&quot;Guardian System Offline&quot;, 3);
		this.shipWillDockWithStation(); 
		missionVariables.aquatics_guardianCount = 0;
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_fireworks.js</td>
                    <td><pre>this.name				= &quot;aquatics_fireworks&quot;;
this.author				= &quot;Thargoid&quot;;
this.copyright			= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description		= &quot;Adds explosive fireworks to the ships death&quot;;
this.version			= &quot;2.31&quot;;
&quot;use strict&quot;;

this.shipDied = function(who, why)
	{
	this.fuelCount = 5 + Math.ceil(Math.random() * 10);
	this.largeCount = Math.ceil(Math.random() * 3);
	this.smallCount = 1 + Math.ceil(Math.random() * 5);
	if(this.ship.hasRole(&quot;aquatics_hawksbill&quot;))
		{
		this.fuelCount *= 4; // well the Hawksbill is a fuel tanker ;)
		}

	system.addShips(&quot;aquatics_burningFuel&quot;, this.fuelCount, this.ship.position, 10);
	system.addShips(&quot;aquatics_smallWreckage&quot;, this.smallCount, this.ship.position, 5);

	if(this.largeCount &gt; 0)
		{
		system.addShips(&quot;aquatics_largeWreckage&quot;, this.largeCount, this.ship.position, 5);
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_guardianPlayer.js</td>
                    <td><pre>this.name					= &quot;aquatics_guardianPlayer&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;AI-actions script for the guardian drones for the player ship&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

this.locatePlayer = function()
	{
	this.playerArray = system.shipsWithPrimaryRole(&quot;player&quot;);
	if(this.playerArray.length == 0) // where&#39;d they go?
		{
		missionVariables.aquatics_guardianActive = &quot;false&quot;; 
		this.ship.remove(); // If no player, then we can remove the drone.
		}
	else
		{
		this.ship.target = this.playerArray[0];
		this.ship.reactToAIMessage(&quot;PLAYER_FOUND&quot;);
		}
	}

this.checkPlayerSpeed = function()
	{
	if(player.ship.speed &lt; 1000)
		{ this.ship.reactToAIMessage(&quot;PLAYER_SUBSONIC&quot;); }
	else
		{ this.ship.reactToAIMessage(&quot;PLAYER_SUPERSONIC&quot;); }
	}

this.findPlayerHostiles = function()
	{
	function isHostileToPlayer(entity) 
		{ 
		return (entity.isThargoid || (entity.isShip &amp;&amp; entity.target &amp;&amp; entity.target == player.ship &amp;&amp; entity.hasHostileTarget));
		}
	if(this.ship.target == player.ship &amp;&amp; player.ship.target &amp;&amp; player.ship.target.bounty &gt; 10)
		{
		this.ship.target = player.ship.target;
		this.ship.reactToAIMessage(&quot;HOSTILE_FOUND&quot;);
		}
	else
		{
		var targets = system.filteredEntities(this, isHostileToPlayer, this.ship, this.ship.scannerRange);
		if(targets.length &gt; 0)
			{
			this.ship.target = targets[0];
			this.ship.reactToAIMessage(&quot;HOSTILE_FOUND&quot;);
			}
		else
			{ this.ship.reactToAIMessage(&quot;NO_HOSTILE_FOUND&quot;); }
		}
	}

this.fireCheck = function()
	{
	if(this.ship.target &amp;&amp; (this.ship.target.hasRole(&quot;aquatics_guardianPlayer&quot;) || this.ship.target.isPlayer))
		{ this.ship.reactToAIMessage(&quot;FRIENDLY_FIRE&quot;); }
	else
		{ this.ship.reactToAIMessage(&quot;ENEMY_FIRE&quot;); }
	}

this.shipTargetDestroyed = function(target)
	{
	if(target.primaryRole == &quot;constrictor&quot; &amp;&amp; missionVariables.conhunt &amp;&amp; missionVariables.conhunt == &quot;STAGE_1&quot;)
		{ missionVariables.conhunt = &quot;CONSTRICTOR_DESTROYED&quot;; } // just in case an escort kills the constrictor, let&#39;s not break the mission for the player...
		
	if(target.isRock || target.isBoulder || target.isCargo || target.isDerelict || target.isWeapon)
		{ return; }
	
	player.score += 1;
	player.credits += target.bounty;
	player.consoleMessage(&quot;Guardian kill - &quot; + target.name + &quot; : &quot; + target.bounty + &quot;₢ awarded.&quot;, 5);
	log(&quot;Guardian kill - &quot; + target.name + &quot; : &quot; + target.bounty);
	}	

this.shipDied = function(whom,why)
	{
	if(missionVariables.aquatics_guardianActive == &quot;true&quot;) // if the drone was killed whilst in-flight
		{ player.consoleMessage(&quot;Guardian drone lost.&quot;, 3); }
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_hammerHead.js</td>
                    <td><pre>this.name					= &quot;aquatics_hammerHead&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Aquatics Hammerhead script.&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

this.shipSpawned = function()
	{
	this.nameShip();
	this.randomiseCargo();
	if(Math.random() &gt; 0.75)
		{ this.ship.switchAI(&quot;aquatics_haulerWitchAI.plist&quot;); }
	}

this.nameShip = function()
	{
	this.shipTitle = expandDescription(&#39;[aquatics_haulerName]&#39;);
	if(Math.random() &gt; 0.25)
		{ this.shipTitle = this.shipTitle + expandDescription(&#39;[aquatics_haulerNumber]&#39;); }

	if(this.shipTitle === &quot;Kraken IV&quot;) // that name is reserved for the special mission ship
		{ this.nameShip(); }

	this.ship.displayName = &quot;AHC &quot; + this.shipTitle;
	}

this.randomiseCargo = function()
	{
	if(Math.random() &lt; (Math.random() / 3) &amp;&amp; this.ship.subEntities &amp;&amp; this.ship.subEntities.length &gt; 2)
		{
		this.ship.subEntities[0].remove();
		this.randomiseCargo();
		}
	}

this.beginUnload = function()
	{ this.ship.commsMessage(&quot;WARNING - This is the HammerHead class hauler AHC &quot; + this.shipTitle + &quot;. Please exercise caution around this region as we are beginning our unloading process.&quot;); }

this.endUnload = function()
	{ this.ship.commsMessage(&quot;This is the AHC &quot; + this.shipTitle + &quot;. Our unloading for &quot; + system.name + &quot; is now completed.&quot;); }

this.chooseDestination = function() // if we&#39;ve got some cargo sleds left, go to witchpoint and jump somewhere else, if not sunskim to get rid of hauler.
	{
	if(this.ship.subEntities &amp;&amp; this.ship.subEntities.length &gt; 0)
		{ this.ship.switchAI(&quot;aquatics_haulerWitchAI.plist&quot;); }
	else
		{ this.ship.switchAI(&quot;route2sunskimAI.plist&quot;); }
	}

this.launchSled = function()
	{
	if(this.ship.subEntities &amp;&amp; this.ship.subEntities.length &gt; 0)
		{
		if(Math.random() &gt; 0.5)
			{
			this.subPosition = this.ship.subEntities[0].position;
			this.subOrientation = this.ship.subEntities[0].orientation;
			this.ship.subEntities[0].remove();
			let subSled = this.ship.spawnOne(&quot;aquatics_cargoSled&quot;); 
			subSled.position = this.localToGlobal(this.subPosition); 
			subSled.orientation = this.subOrientation.multiply(this.ship.orientation); 
			subSled.switchAI(&quot;aquatics_launchAI.plist&quot;); 
			if(Math.random() &lt; 0.1) // 1 in 20 chance per sled launch that hauler stops unloading and take some sleds away with it.
				{
				this.endUnload();
				this.ship.AIState = &quot;IDLE&quot;;
				}	
			}
		}
	else
		{
		this.endUnload();
		this.ship.AIState = &quot;IDLE&quot;; // if we unload everything, then no need to come back here and we can prepare to leave.
		}
	}

this.localToGlobal = function(position)
	{ // sub-ent position is relative to mother, but for swapping we need the absolute global position
	let orientation = this.ship.orientation;
	return this.ship.position.add(position.rotateBy(orientation));
	}

this.shipDied = function(who,why)
	{
	this.largeCount = (Math.ceil(Math.random() * 4) - 1); // between 0-3 large pieces of wreckage
	this.smallCount = (Math.ceil(Math.random() * 9) - 1); // between 0-8 small pieces of wreckage
	this.fuelCount = (Math.ceil(Math.random() * 30) + 30); // between 31-40 burning fuel entities

	this.ship.spawn(&quot;aquatics_burningFuel&quot;, this.fuelCount); // spawn the burning fuel

	if(Math.random() &gt; 0.33) //  2 in 3 chance of a piece of non-exploding wreckage
		{ this.ship.spawn(&quot;aquatics_survivingWreckage&quot;, 1); } // spawn the surviving piece of wreckage

	if(this.largeCount &gt; 0) // if there is large wreckage
		{ this.ship.spawn(&quot;aquatics_largeWreckage&quot;, this.largeCount); } // spawn the large pieces of exploding wreckage

	if(this.smallCount &gt; 0) // if there is small wreckage
		{ this.ship.spawn(&quot;aquatics_smallWreckage&quot;, this.smallCount); } // spawn the small pieces of exploding wreckage
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_hammerSled.js</td>
                    <td><pre>this.name					= &quot;aquatics_hammerSled&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Aquatics cargo sled script.&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

this.collided = function()
	{
	if(this.ship.energy &lt; this.ship.maxEnergy * 0.95)
		{ this.ship.energy = this.ship.maxEnergy * 0.95; }
	}

this.collisionOn = function()
	{ delete this.collided; }

this.switchAI = function()
	{ this.ship.switchAI(&quot;dockingAI.plist&quot;); }

this.shipDied = function(who,why)
	{
	if(!who)
		{ return; }

	this.carriedCargo = Math.ceil((Math.random() * 30) + 5);
	this.ship.spawn(&quot;cargopod&quot;, this.carriedCargo);

	this.smallCount = (Math.ceil(Math.random() * 5) - 1); // between 0-4 small pieces of wreckage
	this.fuelCount = (Math.ceil(Math.random() * 20) + 10); // between 11-30 burning fuel entities

	this.ship.spawn(&quot;aquatics_burningFuel&quot;, this.fuelCount); // spawn the burning fuel

	if(this.smallCount &gt; 0) // if there is small wreckage
		{ this.ship.spawn(&quot;aquatics_smallWreckage&quot;, this.smallCount); } // spawn the small pieces of exploding wreckage
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_jammer.js</td>
                    <td><pre>this.name           = &quot;aquatics_jammer&quot;;
this.author         = &quot;Thargoid&quot;;
this.copyright      = &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description    = &quot;Ship script for Thargon jammer mine&quot;;
this.version        = &quot;2.31&quot;;
&quot;use strict&quot;;

this.performJamming = function() 
	{ 
	this.ship.commsMessage(&quot;Activated.&quot;);

	function isThargon(entity) 
		{ return (entity.isShip &amp;&amp; (entity.primaryRole == &quot;thargon&quot; || entity.primaryRole == &quot;tharglet&quot; || entity.primaryRole == &quot;CT_thargon&quot;)); }

	var thargonArray = system.filteredEntities(this, isThargon, this.ship, 25600)
	if(thargonArray.length &gt; 0)

	var thargCounter = 0 ; // reset the counter
	for(thargCounter = 0; thargCounter &lt; thargonArray.length; thargCounter++)
		{
		this.jamChance = (this.ship.position.distanceTo(thargonArray[thargCounter].position)) / 25600;
		this.diceRole = Math.random();
		if(this.diceRole &gt; this.jamChance)
			{ thargonArray[thargCounter].switchAI(&quot;aquatics_uncontrolledThargonAI.plist&quot;); }
		}
	}

</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_kraken.js</td>
                    <td><pre>this.name					= &quot;aquatics_kraken&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Script for mission of stolen Kraken IV hauler.&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

function aquatics_localMines(entity) { 
	var isWeapon = entity.isWeapon, 
		isActive = entity.AI !== &quot;aquatics_deactivatedAI.plist&quot;, 
		mines = [&quot;EQ_QC_MINE&quot;, &quot;EQ_RMB_CASCADE_MISSILE&quot;, &quot;EQ_RMB_LAW_MISSILE&quot;, &quot;EQ_RMB_OVERRIDE_MISSILE&quot;, 
			&quot;energy-bomb&quot;, &quot;EQ_NUKE2_MISSILE&quot;, &quot;EQ_HARPOON_NUKE2_MISSILE&quot;, &quot;EQ_PHOTON_MISSILE&quot;, &quot;RANDOM_HITS_MINE&quot;], 
		isLocalMine = mines.some(function (element, i, array) {return entity.hasRole(element);}); 
	return isWeapon &amp;&amp; isActive &amp;&amp; isLocalMine; 
	} 

this.shipSpawned = function()
	{
	if(this.scanTimer)
		{ this.scanTimer.start(); }
	else
		{ this.scanTimer = new Timer(this, this.mineScan, 0, 4.75); }
	}	
	
this.mineScan = function()
	{
	this.mineArray = system.filteredEntities(this, aquatics_localMines, this.ship, 25600);
	
	if(this.mineArray.length &gt; 0)
		{
		player.consoleMessage(&quot;Cascade suppression field detected&quot;, 6);
		this.mineArray.forEach(function (mine) 
			{
			mine.setAI(&quot;aquatics_deactivatedAI.plist&quot;); 
			mine.displayName = &quot;Disarmed &quot; + mine.displayName;
			mine.scannerDisplayColor1 = &quot;whiteColor&quot;;
			mine.scannerDisplayColor2 = &quot;whiteColor&quot;;
			}
			)
		}
	}
	
this.findTargets = function()
	{
	function isHostileTarget(entity) 
		{ 
		return (entity.isShip &amp;&amp; (entity.isPlayer || entity.isPolice || entity.isThargoid));
		}
	var targets = system.filteredEntities(this, isHostileTarget, this.ship, 25600);
	if(targets.length &gt; 0)
		{
		this.ship.target = targets[0];
		this.ship.reactToAIMessage(&quot;TARGET_FOUND&quot;);
		}
	else
		{
		this.ship.reactToAIMessage(&quot;NOTHING_FOUND&quot;);
		}
	}

this.shipExitedWitchspace = this.leftSystem = function()
	{
	missionVariables.aquatics_krakenMission = &quot;FAILED&quot;;
	mission.setInstructionsKey(&quot;aquatics_krakenShortFailure&quot;, &quot;aquatics_populator&quot;);
	this.ship.switchAI(&quot;sunSkimExitAI.plist&quot;);
	}

this.shipDied = function(who,why)
	{
	if(missionVariables.aquatics_krakenMission == &quot;BEGUN&quot;) // if the ship was killed whilst the mission was active - success
		{
		missionVariables.aquatics_krakenMission = &quot;SUCCEEDED&quot;;
		mission.setInstructionsKey(&quot;aquatics_krakenShortSuccess&quot;, &quot;aquatics_populator&quot;);
		}

	this.largeCount = (Math.ceil(Math.random() * 6) - 1); // between 0-5 large pieces of wreckage
	this.smallCount = (Math.ceil(Math.random() * 16) - 1); // between 0-15 small pieces of wreckage
	this.fuelCount = (Math.ceil(Math.random() * 30) + 30); // between 31-60 burning fuel entities

	this.ship.spawn(&quot;aquatics_burningFuel&quot;, this.fuelCount); // spawn the burning fuel

	if(Math.random() &gt; 0.33) //  2 in 3 chance of a piece of non-exploding wreckage
		{ this.ship.spawn(&quot;aquatics_survivingWreckage&quot;, 1); } // spawn the surviving piece of wreckage

	if(this.largeCount &gt; 0) // if there is large wreckage
		{ this.ship.spawn(&quot;aquatics_largeWreckage&quot;, this.largeCount); } // spawn the large pieces of exploding wreckage

	if(this.smallCount &gt; 0) // if there is small wreckage
		{ this.ship.spawn(&quot;aquatics_smallWreckage&quot;, this.smallCount); } // spawn the small pieces of exploding wreckage
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_krakenPolice.js</td>
                    <td><pre>this.name					= &quot;aquatics_krakenPolice&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;AI-actions script for the police ships tasked to help kill the Kraken&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

this.locateKraken = function()
	{
	this.krakenArray = system.shipsWithPrimaryRole(&quot;aquatics_kraken&quot;);
	if(this.krakenArray.length &gt; 0) // found it! Now let&#39;s go in for the kill
		{
		this.ship.target = this.krakenArray[0];
		this.ship.reactToAIMessage(&quot;KRAKEN_FOUND&quot;);
		}
	else // Kraken has been destroyer or left the system, so we can go back to the day job
		{
		this.ship.switchAI(&quot;route1patrolAI.plist&quot;);
		this.ship.displayName = this.ship.scriptInfo.ship_name;
		}
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_lDoor.js</td>
                    <td><pre>this.name = &quot;planetFall_lDoor&quot;;
this.author = &quot;Thargoid&quot;;
this.copyright = &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description = &quot;FX script&quot;;
this.version = &quot;2.31&quot;;
&quot;use strict&quot;;

this.effectSpawned = function()
	{
	this.distance = 500;
	this.visualEffect.position = player.ship.position.add(player.ship.vectorForward.multiply(this.distance));
	this.visualEffect.orientation = player.ship.orientation;
	this.lifetime = 0;
	this.callback = addFrameCallback(this.doorPosition.bind(this));
	}

this.effectRemoved = function()
	{ removeFrameCallback(this.callback); }
	
this.doorPosition = function(delta)
	{
	if(!player.ship.isValid || this.lifetime &gt; 2) 
		{ 
		this.visualEffect.remove();
		return;
		}
	if(!delta) { return; }
	this.visualEffect.position = player.ship.position.add(player.ship.vectorForward.multiply(this.distance));
	this.visualEffect.position = this.visualEffect.position.subtract(player.ship.vectorRight.multiply((lifetime / 2) * 250));
	this.visualEffect.orientation = player.ship.orientation;
	this.lifetime += delta;
	return;
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_largeWreck.js</td>
                    <td><pre>this.name 					= &quot;aquatics_largeWreck&quot;; 
this.author 				= &quot;Thargoid&quot;; 
this.copyright 				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;; 
this.description 			= &quot;Break-up of larger wreckage into small ones&quot;; 
this.version 				= &quot;2.31&quot;; 
&quot;use strict&quot;;

this.shipDied = function()
	{
	this.subSmallCount = (Math.ceil(Math.random() * 5) - 2); // between 0 (-1) and 3 pieces of small wreckage spawned from large one
	if(this.subSmallCount &gt; 0) // if we have a positive amount of small wreckage
		{
		this.ship.spawn(&quot;aquatics_smallWreckage&quot;, this.subSmallCount); // spawn the small wreckage
		}
	this.fuelCount = (Math.ceil(Math.random() * 10)); // between 1-10 burning fuel entities
	this.ship.spawn(&quot;aquatics_burningFuel&quot;, this.fuelCount); // spawn the burning fuel
	delete this.shipDied;
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_launchFX.js</td>
                    <td><pre>this.name = &quot;planetFall_launchFX&quot;;
this.author = &quot;Thargoid&quot;;
this.copyright = &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description = &quot;FX script&quot;;
this.version = &quot;2.31&quot;;
&quot;use strict&quot;;

this.effectSpawned = function()
	{
	this.distance = 250;
	this.visualEffect.position = player.ship.position.add(player.ship.vectorForward.multiply(this.distance));
	this.visualEffect.orientation = player.ship.orientation;
	this.visualEffect.orientation = this.visualEffect.orientation.rotate(this.visualEffect.vectorUp, Math.PI);
	this.lifetime = 0;
	this.firstFrame = true;
	this.callback = addFrameCallback(this.doorPosition.bind(this));
	}

this.effectRemoved = function()
	{ removeFrameCallback(this.callback); }
	
this.doorPosition = function(delta)
	{
	if(this.firstFrame)
		{
		this.firstFrame = false;
		return;
		}
		
	if(!player.ship.isValid || this.lifetime &gt; 2.5) 
		{ 
		this.visualEffect.remove();
		return;
		}
	if(!delta) { return; }
	this.visualEffect.position = player.ship.position.add(player.ship.vectorForward.multiply(this.distance - ((this.lifetime / 2.5) * 250))); 
	this.visualEffect.orientation = player.ship.orientation;
	this.visualEffect.orientation = this.visualEffect.orientation.rotate(this.visualEffect.vectorUp, Math.PI);
	this.lifetime += delta;
	return;
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_pirateDestroyer.js</td>
                    <td><pre>this.name					= &quot;aquatics_pirateDestroyer&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Ship script for Orca Destroyer(stolen)&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

this.findTarget = function()
	{
	function isBadGuy(entity) 
		{ return (entity &amp;&amp; entity.isValid &amp;&amp; entity.isShip &amp;&amp; (entity.isPlayer || entity.isPolice || entity.isTrader || entity.isCloaked)); }

	var targets = system.filteredEntities(this, isBadGuy, this.ship, this.ship.scannerRange);
	if(targets.length &gt; 0)
		{
		this.ship.target = targets[0];
		this.ship.reactToAIMessage(&quot;HOSTILE_FOUND&quot;);
		}
	}

this.collided = function()
	{
	if(this.ship.energy &lt; this.ship.maxEnergy * 0.95)
		{ this.ship.energy = this.ship.maxEnergy * 0.95; }
	}

this.collisionOn = function()
	{ delete this.collided; }

this.switchAI = function()
	{ this.ship.switchAI(&quot;aquatics_destroyerAI.plist&quot;); }

this.checkRange = function()
	{
	var kraken = system.shipsWithRole(&quot;aquatics_kraken&quot;);
	if(kraken.length == 0 || this.ship.position.distanceTo(kraken[0].position) &gt; 100)
		{ this.ship.switchAI(&quot;aquatics_destroyerAI.plist&quot;); }
	}

this.shipDied = function(who,why)
	{
	this.largeCount = (Math.ceil(Math.random() * 4) - 1); // between 0-3 large pieces of wreckage
	this.smallCount = (Math.ceil(Math.random() * 9) - 1); // between 0-8 small pieces of wreckage
	this.fuelCount = (Math.ceil(Math.random() * 30) + 30); // between 31-40 burning fuel entities

	this.ship.spawn(&quot;aquatics_burningFuel&quot;, this.fuelCount); // spawn the burning fuel

	if(Math.random() &gt; 0.33) //  2 in 3 chance of a piece of non-exploding wreckage
		{ this.ship.spawn(&quot;aquatics_survivingWreckage&quot;, 1); } // spawn the surviving piece of wreckage

	if(this.largeCount &gt; 0) // if there is large wreckage
		{ this.ship.spawn(&quot;aquatics_largeWreckage&quot;, this.largeCount); } // spawn the large pieces of exploding wreckage

	if(this.smallCount &gt; 0) // if there is small wreckage
		{ this.ship.spawn(&quot;aquatics_smallWreckage&quot;, this.smallCount); } // spawn the small pieces of exploding wreckage
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_piratePlatform.js</td>
                    <td><pre>this.name					= &quot;aquatics_piratePlatform&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Ship script for Leviathan Weapons Platform (stolen)&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

this.findTarget = function()
	{
	function isBadGuy(entity) 
		{ 
		return (entity &amp;&amp; entity.isValid &amp;&amp; entity.isShip &amp;&amp; (entity.isPlayer || entity.isPolice || entity.isCloaked || entity.isThargoid || entity.isPirate || entity.bounty &gt; 49));
		}

	var targets = system.filteredEntities(this, isBadGuy, this.ship, this.ship.scannerRange);
	if(targets.length &gt; 0)
		{
		this.ship.target = targets[0];
		this.ship.reactToAIMessage(&quot;HOSTILE_FOUND&quot;);
		}
	}

this.shipDied = function(who,why)
	{
	if(this.ship.isSubEntity &amp;&amp; this.ship.owner &amp;&amp; this.ship.owner.hasRole(&quot;aquatics_kraken&quot;))
		{
		this.krakenCleanUp();
		}

	this.largeCount = (Math.ceil(Math.random() * 4) - 1); // between 0-3 large pieces of wreckage
	this.smallCount = (Math.ceil(Math.random() * 9) - 1); // between 0-8 small pieces of wreckage
	this.fuelCount = (Math.ceil(Math.random() * 30) + 30); // between 31-40 burning fuel entities

	this.ship.spawn(&quot;aquatics_burningFuel&quot;, this.fuelCount); // spawn the burning fuel

	if(Math.random() &gt; 0.33) //  2 in 3 chance of a piece of non-exploding wreckage
		{ this.ship.spawn(&quot;aquatics_survivingWreckage&quot;, 1); } // spawn the surviving piece of wreckage

	if(this.largeCount &gt; 0) // if there is large wreckage
		{ this.ship.spawn(&quot;aquatics_largeWreckage&quot;, this.largeCount); } // spawn the large pieces of exploding wreckage

	if(this.smallCount &gt; 0) // if there is small wreckage
		{ this.ship.spawn(&quot;aquatics_smallWreckage&quot;, this.smallCount); } // spawn the small pieces of exploding wreckage
	}

this.krakenCleanUp = function()
	{
	if(this.ship.position.x &lt; 0)	// if this is the left hand platform
		{
		var subCounter = 0 ; 	// reset the counter
		var ownerSubCount = this.ship.owner.subEntities.length - 1;
		for(subCounter = ownerSubCount; subCounter &gt;= 0; subCounter--)
			{
			if(this.ship.owner.subEntities[subCounter].hasRole(&quot;aquatics_krakenLeftSubEnt&quot;))
				{
				this.ship.owner.subEntities[subCounter].remove();
				}
			}

		}
	else 					// if this was the right hand platform
		{
		var subCounter = 0 ; 	// reset the counter
		var ownerSubCount = this.ship.owner.subEntities.length - 1;
		for(subCounter = ownerSubCount; subCounter &gt;= 0; subCounter--)
			{
			if(this.ship.owner.subEntities[subCounter].hasRole(&quot;aquatics_krakenRightSubEnt&quot;))
				{
				this.ship.owner.subEntities[subCounter].remove();
				}
			}

		}

	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_platform.js</td>
                    <td><pre>this.name					= &quot;aquatics_platform&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Ship script for Leviathan Weapons Platform (normal)&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

this.findTarget = function()
	{
	function isBadGuy(entity) 
		{ 
		return (entity &amp;&amp; entity.isValid &amp;&amp; entity.isShip &amp;&amp; (!entity.scanClass == &quot;CLASS_CARGO&quot;) &amp;&amp; (entity.isThargoid || entity.isPirate || entity.bounty &gt; 49));
		}

	var targets = system.filteredEntities(this, isBadGuy, this.ship, this.ship.scannerRange);
	if(targets.length &gt; 0)
		{
		this.ship.target = targets[0];
		this.ship.reactToAIMessage(&quot;HOSTILE_FOUND&quot;);
		}
	}

this.switchAI = function()
	{ this.ship.switchAI(&quot;aquatics_platformAI.plist&quot;); }

this.shipDied = function(who,why)
	{
	this.largeCount = (Math.ceil(Math.random() * 4) - 1); // between 0-3 large pieces of wreckage
	this.smallCount = (Math.ceil(Math.random() * 9) - 1); // between 0-8 small pieces of wreckage
	this.fuelCount = (Math.ceil(Math.random() * 30) + 30); // between 31-40 burning fuel entities

	this.ship.spawn(&quot;aquatics_burningFuel&quot;, this.fuelCount); // spawn the burning fuel

	if(Math.random() &gt; 0.33) //  2 in 3 chance of a piece of non-exploding wreckage
		{ this.ship.spawn(&quot;aquatics_survivingWreckage&quot;, 1); } // spawn the surviving piece of wreckage

	if(this.largeCount &gt; 0) // if there is large wreckage
		{ this.ship.spawn(&quot;aquatics_largeWreckage&quot;, this.largeCount); } // spawn the large pieces of exploding wreckage

	if(this.smallCount &gt; 0) // if there is small wreckage
		{ this.ship.spawn(&quot;aquatics_smallWreckage&quot;, this.smallCount); } // spawn the small pieces of exploding wreckage
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_populator.js</td>
                    <td><pre>this.name					= &quot;aquatics_populator&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Adds the hammerhead haulers and platforms, plus runs the mission offering.&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

/*
External control of adding system platforms in systems and interstellar space is now available to other OXPs.
To use simply set worldScripts[&quot;aquatics_populator&quot;].allowInterstellar = false or worldScripts[&quot;aquatics_populator&quot;].allowPlatforms = false to suppress their appearance in the next system or IS entry. They will self reset to true upon arrival after the set-up is blocked.
*/

this.startUp = function()
	{
	this.allowInterstellar = true;
	this.allowPlatforms = true;
	this.platformMessage = null;
	this.launchFlag = null;
	missionVariables.aquatics_cloakRandom = Math.random();
	}

this.systemWillPopulate = function()	
	{
	this.addHauler();
	this.addPlatforms();
	this.addHQ();
	}
	
this.interstellarSpaceWillPopulate = function()
	{ this.addPlatforms(); }
	
this.shipWillEnterWitchspace = function()
	{
	this.platformMessage = null;
	this.launchFlag = null;

	if(galaxyNumber == 2 &amp;&amp; system.ID == 99 &amp;&amp; worldScripts.PlanetFall) // if Planetfall is loaded and we&#39;re leaving Aqualina
		{ worldScripts.PlanetFall.planetFallOverride = null; } // reset the override 

	if(missionVariables.aquatics_krakenMission == &quot;BEGUN&quot;)
		{
		missionVariables.aquatics_krakenMission = &quot;FAILED&quot;;
		mission.setInstructionsKey(null);
		}
	}

this.shipWillExitWitchspace = function()
	{
	if(missionVariables.aquatics_reputation &lt; 0 &amp;&amp; Math.random() &gt; 0.5)
		{ missionVariables.aquatics_reputation++; }
	}

this.shipWillLaunchFromStation = function(station)
	{
	this.launchFlag = true;
	
	if(galaxyNumber == 2 &amp;&amp; system.ID == 99 &amp;&amp; station.hasRole(&quot;aquatics_HQ&quot;))
		{
		if(missionVariables.aquatics_krakenMission == &quot;BRIEFING_1&quot; || missionVariables.aquatics_krakenMission == &quot;BRIEFING_2&quot; || missionVariables.aquatics_krakenMission == &quot;IMMEDIATE_OFFER&quot;)
			{ missionVariables.aquatics_krakenMission = &quot;MAKE_OFFER&quot;; }

		if(missionVariables.aquatics_krakenMission == &quot;NOT_WELCOME&quot; || missionVariables.aquatics_krakenMission == &quot;KICK_OUT&quot;)
			{ missionVariables.aquatics_krakenMission = &quot;CASE_CLOSED&quot;; }
			
		if(worldScripts.PlanetFall) // if Planetfall is loaded
			{ worldScripts.PlanetFall.planetFallOverride = true; } // set the override, so only external OXP locations appear 

		if(missionVariables.aquatics_krakenMission == &quot;BEGUN&quot; &amp;&amp; system.countShipsWithRole(&quot;aquatics_kraken&quot;) == 0)
			{ this.addKraken(); } 
		}
	}

this.shipLaunchedFromStation = this.shipEnteredStationAegis = function()
	{
	if(this.platformMessage == true)
		{
		player.commsMessage(&quot;ALERT! This is &quot; + system.name + &quot; station. Communication has been lost with the system platform. We are investigating, please proceed with extreme caution!&quot;, 6);
		this.platformMessage = null;
		}
	}

this.addHQ = function()
	{
	if(galaxyNumber == 2 &amp;&amp; system.ID == 99 &amp;&amp; system.countShipsWithRole(&quot;aquatics_HQ&quot;) == 0)
		{
//		this.$spawnedHQ = system.addShipsToRoute(&quot;aquatics_HQ&quot;, 1, 0.9, &quot;sp&quot;)

		var x_coord = system.scrambledPseudoRandomNumber(12) * 25E3;
		var y_coord = system.scrambledPseudoRandomNumber(13) * 25E3;
		var z_coord = system.mainPlanet.radius + (0.15 * (system.sun.position.distanceTo(system.mainPlanet.position) - system.sun.radius - system.mainPlanet.radius));
		var exactPosition = Vector3D(x_coord, y_coord, z_coord).fromCoordinateSystem(&quot;psm&quot;);

		system.setPopulator(&quot;aquatics_HQ&quot;, {
			callback: function(pos) {			
				this.$spawnedHQ = system.addShips(&quot;aquatics_HQ&quot;, 1, pos, 0);					
				system.addShips(&quot;aquatics_platform&quot;, 1, this.$spawnedHQ[0].position.add([20000,0,0]));
				system.addShips(&quot;aquatics_platform&quot;, 1, this.$spawnedHQ[0].position.add([-20000,0,0]));
			}.bind(this),
			location: &quot;COORDINATES&quot;,
			coordinates: exactPosition,
			deterministic: true
			}
		)
		
		if(worldScripts.PlanetFall) // if Planetfall is loaded
			{ worldScripts.PlanetFall.planetFallOverride = true;} // set the override, so only external OXP locations appear
		
		system.addShips(&quot;aquatics_platform&quot;, 1, [0, 0, 0], 22000);
		}	
	}
	
this.addHauler = function()
	{
	if(this.launchFlag || worldScripts[&quot;bigShips_populator&quot;]) // don&#39;t place anything if we&#39;ve already tried to populate the system or bigShips can handle it
		{ return; }
	
	if(Math.random() &lt; (0.1 + ((system.techLevel + system.government)/50)) )
		{
		this.zDistance = ((Math.random() * 0.75) + 0.15);
		system.addShipsToRoute(&quot;aquatics_hammerHead&quot;, 1, this.zDistance, &quot;pw&quot;);
		log(this.name, &quot;Hammerhead hauler added to the &quot; + system.name + &quot; system by populator script.&quot;);
		}
	}

this.addPlatforms = function()
	{
	if(system.isInterstellarSpace)
		{
		if(Math.random() &lt; 0.05 &amp;&amp; this.allowInterstellar)
			{
			system.addShips(&quot;aquatics_platform&quot;, 1, player.ship.position, 20000);
			log(this.name, &quot;System platform added in interstellar space by populator script.&quot;);
			}
		this.allowInterstellar = true;	
		return;
		}

	if(this.launchFlag || this.allowPlatforms === false) 
		{ // don&#39;t place anything if the system is going nova, we&#39;ve already tried to populate the system or the external block is set
		this.allowPlatforms = true;
		return;
		}
	
	if(galaxyNumber == 2 &amp;&amp; system.ID == 99) // if we&#39;re at Aqualina 
		{ return; } // no need to go any further for this system
		

	if(Math.random() &lt; ((system.techLevel + system.government)/100))
		{
		system.addShips(&quot;aquatics_platform&quot;, 1, [0, 0, 0], 22000);
		log(this.name, &quot;System platform near the &quot; + system.name + &quot; witchpoint.&quot;);
		}


	if(Math.random() &lt; ((system.techLevel + system.government)/50))
		{
		if(Math.random() &lt; 0.05)
			{
			system.addShips(&quot;aquatics_piratePlatform&quot;, 1, system.mainStation.position, 22000);
			system.addShips(&quot;aquatics_destroyer&quot;, 1, system.mainStation.position, 22000);
			system.addShips(&quot;aquatics_defender&quot;, 2, system.mainStation.position, 22000);
			this.platformMessage = true;
			}
		else
			{
			system.addShips(&quot;aquatics_platform&quot;, 1, system.mainStation.position, 22000);
			this.platformMessage = null;
			}
		}
	}

this.addKraken = function()
	{
	this.zDistance = ((Math.random() * 0.4) + 0.4);
	system.addShipsToRoute(&quot;aquatics_kraken&quot;, 1, this.zDistance, &quot;pw&quot;);

	var addCounter = 0 ; 	// reset the counter
	var policeCount = Math.ceil(Math.random() * 3) + 1; // random number between 2 and 4
	for(addCounter = 0; addCounter &lt; policeCount; addCounter++) // add police tasked to pursue and destroy the Kraken
		{
		this.zDistance = ((Math.random() * 0.9) + 0.05);
		system.addShipsToRoute(&quot;aquatics_krakenPolice&quot;, 1, this.zDistance, &quot;pw&quot;); 
		}

	log(this.name, &quot;AHC Kraken and &quot; + policeCount + &quot; pursuing security forces added to Aqualina system by populator script.&quot;);
	}

// mission-related events below here.

this.shipDockedWithStation = function(station)
	{
	if(galaxyNumber == 2 &amp;&amp; system.ID == 99 &amp;&amp; station.hasRole(&quot;aquatics_HQ&quot;)) // if we&#39;re docked at the HQ
		{
		missionVariables.aquatics_cloakRandom = Math.random();

		if(player.score &gt; 511 &amp;&amp; missionVariables.aquatics_krakenMission == &quot;UNAVAILABLE&quot;)
			{
			missionVariables.aquatics_krakenMission = &quot;MAKE_OFFER&quot;;
			}
		}
	}
	
this.notWelcome = function()
	{
	missionVariables.aquatics_krakenMission = &quot;CASE_CLOSED&quot;;
	player.ship.launch();
	}
	
this.missionChoice = function(choice)
	{
	switch(choice)
		{
		case &quot;AQUATICS_1_ACCEPTED&quot;:
			{
			missionVariables.aquatics_krakenMission = &quot;BRIEFING_1&quot;;
			mission.runScreen({title: &quot;Mission Briefing&quot;, messageKey:&quot;aquatics_krakenBriefing1&quot;, background:&quot;aquatics_logo.png&quot;}, this.missionChoice);
			mission.setInstructionsKey(&quot;aquatics_krakenShortHunt&quot;);
			break;
			}

		case &quot;AQUATICS_2_REJECTED&quot;:
			{
			mission.runScreen({title: &quot;Are you sure?&quot;, messageKey:&quot;aquatics_firstDecline&quot;, background:&quot;aquatics_logo.png&quot;, choicesKey:&quot;aquatics_secondChoice&quot;}, this.missionChoice);
			break;
			}

		case &quot;AQUATICS_3_REJECTED&quot;:
			{
			missionVariables.aquatics_krakenMission = &quot;KICK_OUT&quot;
			mission.runScreen({title: &quot;Well if that&#39;s your attitude!&quot;, messageKey:&quot;aquatics_secondDecline&quot;, background:&quot;aquatics_logo.png&quot;});
			break;
			}
		}
	}

this.missionScreenOpportunity = function()
	{
	if(galaxyNumber == 2 &amp;&amp; system.ID == 99 &amp;&amp; player.ship.docked &amp;&amp; player.ship.dockedStation.hasRole(&quot;aquatics_HQ&quot;)) // if we&#39;re docked at the HQ
		{

		if(guiScreen == &quot;GUI_SCREEN_MISSION&quot;) // if something else has taken the mission screen.
			{
			return;
			}

		if(missionVariables.aquatics_reputation &lt; 0)
			{
			mission.runScreen({title: &quot;Uh-oh!&quot;, messageKey:&quot;aquatics_notWelcome&quot;, background:&quot;aquatics_logo.png&quot;}, this.notWelcome);
			return;
			}

		switch(missionVariables.aquatics_krakenMission)
			{
			case &quot;KICK_OUT&quot;: // if we&#39;ve rejected the mission
				{
				missionVariables.aquatics_reputation = -10;
				this.notWelcome();
				return;
				}
			
			case &quot;MAKE_OFFER&quot;: // if we&#39;ve been here before, but didn&#39;t have high enough rank
				{
				mission.runScreen({title: &quot;Time for a beer, but...&quot;, messageKey:&quot;aquatics_initialOffer&quot;, background:&quot;aquatics_logo.png&quot;, choicesKey:&quot;aquatics_firstChoice&quot;}, this.missionChoice);
				break;
				}

			case &quot;FAILED&quot;: // Kraken jumped out of system (failed)
				{
				mission.setInstructionsKey(null);
				missionVariables.aquatics_krakenMission = &quot;CASE_CLOSED&quot;;
				mission.runScreen({title: &quot;Mission Failed&quot;, messageKey:&quot;aquatics_krakenFailure&quot;, background:&quot;aquatics_logo.png&quot;});
				break;
				}

			case &quot;SUCCEEDED&quot;: // Kraken destroyed during mission (success)
				{
				mission.setInstructionsKey(null);
				missionVariables.aquatics_krakenMission = &quot;CASE_CLOSED&quot;;
				missionVariables.aquatics_reputation = 1;
				mission.runScreen({title: &quot;Mission Accomplished&quot;, messageKey:&quot;aquatics_krakenSuccess&quot;, background:&quot;aquatics_logo.png&quot;});
				break;
				}
				
			case &quot;BRIEFING_2&quot;:
				{
				missionVariables.aquatics_krakenMission = &quot;BEGUN&quot;;
				mission.runScreen({title: &quot;Mission Briefing&quot;, messageKey:&quot;aquatics_krakenBriefing3&quot;, background:&quot;aquatics_logo.png&quot;});
				return;
				break;
				}

			case &quot;BRIEFING_1&quot;:
				{
				missionVariables.aquatics_krakenMission = &quot;BRIEFING_2&quot;;
				mission.runScreen({title: &quot;Mission Briefing&quot;, messageKey:&quot;aquatics_krakenBriefing2&quot;, model:&quot;aquatics_kraken&quot;});
				return;
				break;
				}

			case &quot;IMMEDIATE_OFFER&quot;:
				{
				missionVariables.aquatics_krakenMission = &quot;MAKE_OFFER&quot;;
				this.missionScreenOpportunity();
				return;
				break;
				}	

			default: // anything else, including first visit to HQ
				{
				if(!missionVariables.aquatics_krakenMission)
					{
					if(player.score &gt; 511)
						{
						missionVariables.aquatics_krakenMission = &quot;IMMEDIATE_OFFER&quot;;
						}
					else
						{ 
						missionVariables.aquatics_krakenMission = &quot;UNAVAILABLE&quot;;
						}

					missionVariables.aquatics_timer = clock.days;  // start the equipment appearance clock
					mission.runScreen({title: &quot;Welcome to Aqualina!&quot;, messageKey:&quot;aquatics_firstVisit&quot;, background:&quot;aquatics_logo.png&quot;});
					}
				break;
				}
			}
		}
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_rDoor.js</td>
                    <td><pre>this.name = &quot;planetFall_rDoor&quot;;
this.author = &quot;Thargoid&quot;;
this.copyright = &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description = &quot;FX script&quot;;
this.version = &quot;2.31&quot;;
&quot;use strict&quot;;

this.effectSpawned = function()
	{
	this.distance = 500;
	this.visualEffect.position = player.ship.position.add(player.ship.vectorForward.multiply(this.distance));
	this.visualEffect.orientation = player.ship.orientation;
	this.lifetime = 0;
	this.callback = addFrameCallback(this.doorPosition.bind(this));
	}

this.effectRemoved = function()
	{ removeFrameCallback(this.callback); }
	
this.doorPosition = function(delta)
	{
	if(!player.ship.isValid || this.lifetime &gt; 2) 
		{ 
		this.visualEffect.remove();
		return;
		}
	if(!delta) { return; }
	this.visualEffect.position = player.ship.position.add(player.ship.vectorForward.multiply(this.distance));
	this.visualEffect.position = this.visualEffect.position.add(player.ship.vectorRight.multiply((lifetime / 2) * 250));
	this.visualEffect.orientation = player.ship.orientation;
	this.lifetime += delta;
	return;
	}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_ringScript.js</td>
                    <td><pre>this.name					= &quot;aquatics_ringScript.js&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Script to add ring of blocks around system main planet in Aqualina system&quot;;
this.version				= &quot;2.31&quot;;

this.systemWillPopulate = function()
	{
	if(galaxyNumber !== 2 || system.ID !== 99 || !system.mainPlanet || !system.mainStation) 
		{ return; }
	
	var spawnPosition = system.mainPlanet.position;

	this.ringGroup = new ShipGroup(&quot;ringGroup&quot;);
	
	system.setPopulator(&quot;aquatics_Ring&quot;, {
		callback: function(pos) {			
			this.$sectionLength = 6000; // orbit circumference divided by segment width (5000m) plus a 1000m gap on each side to prevent collisions (2000m total gap between segments)
			this.$gateCount = 4;
			this.$ringHeight = ((system.mainPlanet.position.distanceTo(system.mainStation.position) - system.mainPlanet.radius) / 2) + system.mainPlanet.radius; // ring orbits half-way between planet surface and main station
			this.$segmentNumber = (2 * Math.PI * this.$ringHeight) / this.$sectionLength; 
			this.$gateFrequency = Math.floor(this.$segmentNumber / this.$gateCount);
			this.$basePosition =  pos;

			this.$segmentNumber = Math.floor(this.$segmentNumber); // ensure we&#39;re not trying to spawn a fraction of a segment
			this.$ringHeight = (this.$sectionLength * this.$segmentNumber) /  (2 * Math.PI);
		
			let $vecForward = system.mainPlanet.orientation.vectorForward();
			let $vecUp = system.mainPlanet.orientation.vectorUp();
			let $vecRight = system.mainPlanet.orientation.vectorRight();
	
			let $segmentCounter = 0;
			for($segmentCounter = 0; $segmentCounter &lt; this.$segmentNumber; $segmentCounter++)
				{
				this.$segmentAngle = 2 * Math.PI * ($segmentCounter / this.$segmentNumber);
				this.$jointAngle = 2 * Math.PI * (($segmentCounter + 0.5) / this.$segmentNumber);

				this.$segmentPosition = this.$basePosition.add($vecRight.multiply(this.$ringHeight * Math.sin(this.$segmentAngle))).add($vecForward.multiply(this.$ringHeight * Math.cos(this.$segmentAngle)));

				this.$jointPosition = this.$basePosition.add($vecRight.multiply(this.$ringHeight * Math.sin(this.$jointAngle))).add($vecForward.multiply(this.$ringHeight * Math.cos(this.$jointAngle)));
		
				this.$gateFlag = $segmentCounter / this.$gateFrequency;
				if($segmentCounter &gt; 0 &amp;&amp; (this.$gateFlag == Math.floor(this.$gateFlag)))
					{ 
					this.$nextSegment = system.addShips(&quot;aquatics_ringGateway&quot;, 1, this.$segmentPosition, 0); 
					this.$nextSegment[0].displayName = (&quot;Ring Gateway &quot; + (Math.floor(this.$gateFlag)) + &quot;&quot;);	
					this.$nextSegment[0].group = this.ringGroup;
					}
				else
					{ 
					this.$nextSegment = system.addShips(&quot;aquatics_ringSegment&quot;, 1, this.$segmentPosition, 0); 
					this.$nextSegment[0].group = this.ringGroup;}

				this.$nextSegment[0].orientation = system.mainPlanet.orientation.rotate($vecUp, (this.$segmentAngle * -1));
				this.$nextSegment[0].script.$spawnOrientation = this.$nextSegment[0].orientation;
				this.$nextSegment[0].script.$spawnPosition = this.$nextSegment[0].position;

				// add the joints in between segments
				this.$nextJoint = system.addVisualEffect(&quot;aquatics_ringJoint&quot;, this.$jointPosition);
				this.$nextJoint.orientation = system.mainPlanet.orientation.rotate($vecUp, (this.$jointAngle * -1));
				this.$nextJoint.group = this.ringGroup;
				}
			}.bind(this),
		location: &quot;COORDINATES&quot;,
		coordinates: spawnPosition,
		deterministic: true
		}
	)	
}
</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_ringSegment.js</td>
                    <td><pre>this.name					= &quot;aquatics_ringSegment.js&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Positioning ship script for ring segments.&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

this.shipTakingDamage = function(amount, whom, type)
	{
	if(type &amp;&amp; type === &quot;scrape damage&quot;)
		{
		this.ship.position = this.$spawnPosition;
		this.ship.orientation = this.$spawnOrientation;
		if(amount) { this.ship.energy += amount; }
		}
	}
	
this.shipDied = function(whom, why)
	{
log(this.name, &quot;whom - &quot; + whom + &quot;, why - &quot; + why);	
	if(why &amp;&amp; why !==&quot;removed&quot;)
		{
		let newSegment = this.ship.spawnOne(this.ship.primaryRole);
		newSegment.position = this.ship.position;
		newSegment.orientation = this.ship.orientation;
		newSegment.name = this.ship.name;
		newSegment.displayName = this.ship.displayName;
		}
	}</pre></td>
                </tr>
                <tr>
                    <td valign="top">Scripts/aquatics_trident.js</td>
                    <td><pre>this.name					= &quot;aquatics_trident&quot;;
this.author					= &quot;Thargoid&quot;;
this.copyright				= &quot;Creative Commons: attribution, non-commercial, sharealike with clauses - see readme.txt&quot;;
this.description			= &quot;Ship script for the trident missile&quot;;
this.version				= &quot;2.31&quot;;
&quot;use strict&quot;;

this.spawnTines = function() 
	{ 
	var loopCounter = 0 ; // reset the counter
	for(loopCounter = 0; loopCounter &lt; 9; loopCounter++)
		{
		var Tine = this.ship.spawnOne(&quot;aquatics_tridentTine&quot;);
		this.xDistance = ((Math.random() * 40) - 20);
		this.yDistance = ((Math.random() * 40) - 20);
		Tine.setPosition(this.ship.position.add([this.xDistance, this.yDistance, 0]));
		Tine.setOrientation(this.ship.orientation); 
		Tine.target = this.ship.target;
		}
	} 

</pre></td>
                </tr>
            </table>
        </a>
    </body>
</html>
